<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.1">
    <meta name="project" content="Erlang System Documentation v28.0.1">


<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=28&q=">
<meta name="major-vsn" content="28">
<link rel="canonical" href="https://www.erlang.org/doc/system/sup_princ.html" />
<meta name="exdoc:autocomplete" content="off">
    <title>Supervisor Behaviour — Erlang System Documentation v28.0.1</title>

    <link rel="stylesheet" href="dist/html-erlang-ZK43ZOAC.css" />

    <script defer src="dist/sidebar_items-09F1912C.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Erlang System Documentation" />
        </a>

      <div>
        <a href="../index.html" class="sidebar-projectName" translate="no">
Erlang System Documentation
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v28.0.1
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Erlang System Documentation</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>Supervisor Behaviour</h1>


      <a href="https://github.com/erlang/otp/blob/OTP-28.0.1/system/doc/design_principles/sup_princ.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<p>It is recommended to read this section alongside <a href="../apps/stdlib/supervisor.html"><code class="inline">supervisor</code></a> in STDLIB.</p><h2 id="supervision-principles" class="section-heading"><a href="#supervision-principles" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Supervision Principles</span></h2><p>A supervisor is responsible for starting, stopping, and monitoring its child
processes. The basic idea of a supervisor is that it is to keep its child
processes alive by restarting them when necessary.</p><p>Which child processes to start and monitor is specified by a list of
<a href="sup_princ.html#spec">child specifications</a>. The child processes are started in
the order specified by this list, and are terminated in the reverse order.</p><h2 id="example" class="section-heading"><a href="#example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example</span></h2><p>The callback module for a supervisor starting the server from
<a href="gen_server_concepts.html#ex">gen_server Behaviour</a> can look as follows:</p><p><a href="" id="ex"></a></p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="8062145908-1">(</span><span class="ss">ch_sup</span><span class="p" data-group-id="8062145908-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">behaviour</span><span class="p" data-group-id="8062145908-2">(</span><span class="ss">supervisor</span><span class="p" data-group-id="8062145908-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="8062145908-3">(</span><span class="p" data-group-id="8062145908-4">[</span><span class="ss">start_link</span><span class="p">/</span><span class="mi">0</span><span class="p" data-group-id="8062145908-4">]</span><span class="p" data-group-id="8062145908-3">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="8062145908-5">(</span><span class="p" data-group-id="8062145908-6">[</span><span class="ss">init</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="8062145908-6">]</span><span class="p" data-group-id="8062145908-5">)</span><span class="p">.</span><span class="w">

</span><span class="nf">start_link</span><span class="p" data-group-id="8062145908-7">(</span><span class="p" data-group-id="8062145908-7">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">supervisor</span><span class="p">:</span><span class="nf">start_link</span><span class="p" data-group-id="8062145908-8">(</span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8062145908-9">[</span><span class="p" data-group-id="8062145908-9">]</span><span class="p" data-group-id="8062145908-8">)</span><span class="p">.</span><span class="w">

</span><span class="nf">init</span><span class="p" data-group-id="8062145908-10">(</span><span class="p">_</span><span class="n">Args</span><span class="p" data-group-id="8062145908-10">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">SupFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8062145908-11">#{</span><span class="ss">strategy</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">one_for_one</span><span class="p">,</span><span class="w"> </span><span class="ss">intensity</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">period</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p" data-group-id="8062145908-11">}</span><span class="p">,</span><span class="w">
    </span><span class="n">ChildSpecs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8062145908-12">[</span><span class="p" data-group-id="8062145908-13">#{</span><span class="ss">id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">ch3</span><span class="p">,</span><span class="w">
                    </span><span class="ss">start</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="8062145908-14">{</span><span class="ss">ch3</span><span class="p">,</span><span class="w"> </span><span class="ss">start_link</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8062145908-15">[</span><span class="p" data-group-id="8062145908-15">]</span><span class="p" data-group-id="8062145908-14">}</span><span class="p">,</span><span class="w">
                    </span><span class="ss">restart</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">permanent</span><span class="p">,</span><span class="w">
                    </span><span class="ss">shutdown</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">brutal_kill</span><span class="p">,</span><span class="w">
                    </span><span class="ss">type</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">worker</span><span class="p">,</span><span class="w">
                    </span><span class="ss">modules</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="8062145908-16">[</span><span class="ss">ch3</span><span class="p" data-group-id="8062145908-16">]</span><span class="p" data-group-id="8062145908-13">}</span><span class="p" data-group-id="8062145908-12">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8062145908-17">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8062145908-18">{</span><span class="n">SupFlags</span><span class="p">,</span><span class="w"> </span><span class="n">ChildSpecs</span><span class="p" data-group-id="8062145908-18">}</span><span class="p" data-group-id="8062145908-17">}</span><span class="p">.</span></code></pre><p>The <code class="inline">SupFlags</code> variable in the return value from <code class="inline">init/1</code> represents the
<a href="sup_princ.html#flags">supervisor flags</a>.</p><p>The <code class="inline">ChildSpecs</code> variable in the return value from <code class="inline">init/1</code> is a list of
<a href="sup_princ.html#spec">child specifications</a>.</p><p><a href="" id="flags"></a></p><h2 id="supervisor-flags" class="section-heading"><a href="#supervisor-flags" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Supervisor Flags</span></h2><p>This is the type definition for the supervisor flags:</p><pre><code class="makeup erlang" translate="no"><span class="nf">sup_flags</span><span class="p" data-group-id="1174111888-1">(</span><span class="p" data-group-id="1174111888-1">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1174111888-2">#{</span><span class="ss">strategy</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">strategy</span><span class="p" data-group-id="1174111888-3">(</span><span class="p" data-group-id="1174111888-3">)</span><span class="p">,</span><span class="w">           </span><span class="c1">% optional</span><span class="w">
                </span><span class="ss">intensity</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">non_neg_integer</span><span class="p" data-group-id="1174111888-4">(</span><span class="p" data-group-id="1174111888-4">)</span><span class="p">,</span><span class="w">   </span><span class="c1">% optional</span><span class="w">
                </span><span class="ss">period</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">pos_integer</span><span class="p" data-group-id="1174111888-5">(</span><span class="p" data-group-id="1174111888-5">)</span><span class="p">,</span><span class="w">          </span><span class="c1">% optional</span><span class="w">
                </span><span class="ss">auto_shutdown</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">auto_shutdown</span><span class="p" data-group-id="1174111888-6">(</span><span class="p" data-group-id="1174111888-6">)</span><span class="p" data-group-id="1174111888-2">}</span><span class="w"> </span><span class="c1">% optional</span><span class="w">
    </span><span class="nf">strategy</span><span class="p" data-group-id="1174111888-7">(</span><span class="p" data-group-id="1174111888-7">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">one_for_all</span><span class="w">
               </span><span class="p">|</span><span class="w"> </span><span class="ss">one_for_one</span><span class="w">
               </span><span class="p">|</span><span class="w"> </span><span class="ss">rest_for_one</span><span class="w">
               </span><span class="p">|</span><span class="w"> </span><span class="ss">simple_one_for_one</span><span class="w">
    </span><span class="nf">auto_shutdown</span><span class="p" data-group-id="1174111888-8">(</span><span class="p" data-group-id="1174111888-8">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">never</span><span class="w">
                    </span><span class="p">|</span><span class="w"> </span><span class="ss">any_significant</span><span class="w">
                    </span><span class="p">|</span><span class="w"> </span><span class="ss">all_significant</span></code></pre><ul><li><code class="inline">strategy</code> specifies the <a href="sup_princ.html#strategy">restart strategy</a>.</li><li><code class="inline">intensity</code> and <code class="inline">period</code> specify the
<a href="sup_princ.html#max_intensity">maximum restart intensity</a>.</li><li><code class="inline">auto_shutdown</code> specifies whether and when a supervisor should
<a href="sup_princ.html#automatic-shutdown">automatically shut itself down</a>.</li></ul><p><a href="" id="strategy"></a></p><h2 id="restart-strategy" class="section-heading"><a href="#restart-strategy" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Restart Strategy</span></h2><p>The restart strategy is specified by the <code class="inline">strategy</code> key in the supervisor flags
map returned by the callback function <code class="inline">init</code>:</p><pre><code class="text">SupFlags = #{strategy =&gt; Strategy, ...}</code></pre><p>The <code class="inline">strategy</code> key is optional in this map. If it is not given, it defaults to
<code class="inline">one_for_one</code>.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p>For simplicity, the diagrams shown in this section display a setup where all
the depicted children are assumed to have a
<a href="sup_princ.html#restart">restart type</a> of <code class="inline">permanent</code>.</p></section><h3 id="one_for_one" class="section-heading"><a href="#one_for_one" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">one_for_one</span></h3><p>If a child process terminates, only that process is restarted.</p><pre><code class="mermaid">---
title: One For One Supervision
---
flowchart TD
    subgraph Legend
        direction LR
        t(( )) ~~~ l1[Terminated Process]
        p(( )) ~~~ l2[Process Restarted by the Supervisor]
    end

    subgraph graph[&quot; &quot;]
        s[Supervisor]
        s --- p1((P1))
        s --- p2((P2))
        s --- p3((P3))
        s --- pn((Pn))
    end

    classDef term fill:#ff8888,color:black;
    classDef restarted stroke:#00aa00,stroke-width:3px;
    classDef legend fill-opacity:0,stroke-width:0px;

    class p2,t term;
    class p2,p restarted;
    class l1,l2 legend;</code></pre><h3 id="one_for_all" class="section-heading"><a href="#one_for_all" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">one_for_all</span></h3><p>If a child process terminates, all remaining child processes are
terminated. Subsequently, all child processes, including the
terminated one, are restarted.</p><pre><code class="mermaid">---
title: One For All Supervision
---
flowchart TD
    subgraph Legend
        direction LR
        t(( )) ~~~ l1[Terminated Process]
        st(( )) ~~~ l2[Process Terminated by the Supervisor]
        p(( )) ~~~ l3[Process Restarted by the Supervisor]
        l4[&quot;Note:

           Processes are terminated right to left
           Processes are restarted left to right&quot;]

    end

    subgraph graph[&quot; &quot;]
        s[Supervisor]
        s --- p1((P1))
        s --- p2((P2))
        s --- p3((P3))
        s --- pn((Pn))
    end

    classDef term fill:#ff8888,color:black;
    classDef sterm fill:#ffaa00,color:black;
    classDef restarted stroke:#00aa00,stroke-width:3px;
    classDef legend fill-opacity:0,stroke-width:0px;

    class p2,t term;
    class p1,p3,pn,st sterm;
    class p1,p2,p3,pn,p restarted;
    class l1,l2,l3,l4 legend;</code></pre><h3 id="rest_for_one" class="section-heading"><a href="#rest_for_one" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">rest_for_one</span></h3><p>If a child process terminates, the child processes after the
terminated process in start order are terminated. Subsequently, the
terminated child process and the remaining child processes are
restarted.</p><pre><code class="mermaid">---
title: Rest For One Supervision
---
flowchart TD
    subgraph Legend
        direction LR
        t(( )) ~~~ l1[Terminated Process]
        st(( )) ~~~ l2[Process Terminated by the Supervisor]
        p(( )) ~~~ l3[Process Restarted by the Supervisor]
        l4[&quot;Note:

           Processes are terminated right to left
           Processes are restarted left to right&quot;]

    end

    subgraph graph[&quot; &quot;]
        s[Supervisor]
        s --- p1((P1))
        s --- p2((P2))
        s --- p3((P3))
        s --- pn((Pn))
    end

    classDef term fill:#ff8888,color:black;
    classDef sterm fill:#ffaa00,color:black;
    classDef restarted stroke:#00aa00,stroke-width:3px;
    classDef legend fill-opacity:0,stroke-width:0px;

    class p2,t term;
    class p3,pn,st sterm;
    class p2,p3,pn,p restarted;
    class l1,l2,l3,l4 legend;</code></pre><h3 id="simple_one_for_one" class="section-heading"><a href="#simple_one_for_one" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">simple_one_for_one</span></h3><p>See <a href="sup_princ.html#simple">simple-one-for-one supervisors</a>.</p><p><a href="" id="max_intensity"></a></p><h2 id="maximum-restart-intensity" class="section-heading"><a href="#maximum-restart-intensity" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Maximum Restart Intensity</span></h2><p>The supervisors have a built-in mechanism to limit the number of restarts which
can occur in a given time interval. This is specified by the two keys
<code class="inline">intensity</code> and <code class="inline">period</code> in the supervisor flags map returned by the callback
function <code class="inline">init</code>:</p><pre><code class="text">SupFlags = #{intensity =&gt; MaxR, period =&gt; MaxT, ...}</code></pre><p>If more than <code class="inline">MaxR</code> number of restarts occur in the last <code class="inline">MaxT</code> seconds, the
supervisor terminates all the child processes and then itself. The termination
reason for the supervisor itself in that case will be <code class="inline">shutdown</code>.</p><p>When the supervisor terminates, then the next higher-level supervisor takes some
action. It either restarts the terminated supervisor or terminates itself.</p><p>The intention of the restart mechanism is to prevent a situation where a process
repeatedly dies for the same reason, only to be restarted again.</p><p>The keys <code class="inline">intensity</code> and <code class="inline">period</code> are optional in the supervisor flags map. If
they are not given, they default to <code class="inline">1</code> and <code class="inline">5</code>, respectively.</p><h3 id="tuning-the-intensity-and-period" class="section-heading"><a href="#tuning-the-intensity-and-period" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Tuning the intensity and period</span></h3><p>The default values were chosen to be safe for most systems, even with
deep supervision hierarchies, but you will probably want to tune the
settings for your particular use case.</p><p>First, the intensity decides how big bursts of restarts you want to tolerate.
For example, you might want to accept a burst of at most 5 or 10 attempts, even
within the same second, if it results in a successful restart.</p><p>Second, you need to consider the sustained failure rate, if crashes keep
happening but not often enough to make the supervisor give up. If you set
intensity to 10 and set the period as low as 1, the supervisor will allow child
processes to keep restarting up to 10 times per second, forever, filling your
logs with crash reports until someone intervenes manually.</p><p>You should therefore set the period to be long enough that you can accept that
the supervisor keeps going at that rate. For example, if an intensity value
of 5 is chosen, setting the period to 30 seconds will give you at
most one restart per 6 seconds for any longer period of time, which means that
your logs will not fill up too quickly, and you will have a chance to observe the
failures and apply a fix.</p><p>These choices depend a lot on your problem domain. If you do not have real time
monitoring and ability to fix problems quickly, for example in an embedded
system, you might want to accept at most one restart per minute before the
supervisor should give up and escalate to the next level to try to clear the
error automatically. On the other hand, if it is more important that you keep
trying even at a high failure rate, you might want a sustained rate of as much
as 1-2 restarts per second.</p><p>Avoiding common mistakes:</p><ul><li><p>Do not forget to consider the burst rate. If you set intensity to 1 and period
to 6, it gives the same sustained error rate as 5/30 or 10/60, but will not
allow even 2 restart attempts in quick succession. This is probably not what
you wanted.</p></li><li><p>Do not set the period to a very high value if you want to tolerate bursts. If
you set intensity to 5 and period to 3600 (one hour), the supervisor will
allow a short burst of 5 restarts, but then gives up if it sees another single
restart almost an hour later. You probably want to regard those crashes as
separate incidents, so setting the period to 5 or 10 minutes will be more
reasonable.</p></li><li><p>If your application has multiple levels of supervision, do not set
the restart intensities to the same values on all levels. Keep in mind that
the total number of restarts (before the top level supervisor gives up and
terminates the application) will be the product of the intensity values of all
the supervisors above the failing child process.</p><p>For example, if the top level allows 10 restarts, and the next level also
allows 10, a crashing child below that level will be restarted 100 times,
which is probably excessive. Allowing at most 3 restarts for the top level
supervisor might be a better choice in this case.</p></li></ul><h2 id="automatic-shutdown" class="section-heading"><a href="#automatic-shutdown" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Automatic Shutdown</span></h2><p>A supervisor can be configured to automatically shut itself down when
<a href="sup_princ.html#significant_child">significant children</a> terminate.</p><p>This is useful when a supervisor represents a work unit of cooperating children,
as opposed to independent workers. When the work unit has finished its work,
that is, when any or all significant child processes have terminated, the
supervisor should then shut down by terminating all remaining child processes in
reverse start order according to the respective shutdown specifications, and
then itself.</p><p>Automatic shutdown is specified by the <code class="inline">auto_shutdown</code> key in the supervisor
flags map returned by the callback function <code class="inline">init</code>:</p><pre><code class="text">SupFlags = #{auto_shutdown =&gt; AutoShutdown, ...}</code></pre><p>The <code class="inline">auto_shutdown</code> key is optional in this map. If it is not given, it defaults
to <code class="inline">never</code>.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p>The automatic shutdown facility only applies when significant children
terminate by themselves, not when their termination was caused by
the supervisor. Specifically, neither the termination of a child as a
consequence of a sibling's termination in the <code class="inline">one_for_all</code> or <code class="inline">rest_for_one</code>
strategies nor the manual termination of a child by
<a href="../apps/stdlib/supervisor.html#terminate_child/2"><code class="inline">supervisor:terminate_child/2</code></a> will trigger an automatic shutdown.</p></section><h3 id="never" class="section-heading"><a href="#never" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">never</span></h3><p>Automatic shutdown is disabled.</p><p>In this mode, specifying significant children is not accepted. If the
child specs returned from <code class="inline">init</code> contain significant children, the
supervisor will refuse to start. Attempts to start significant
children dynamically will be rejected.</p><p>This is the default setting.</p><h3 id="any_significant" class="section-heading"><a href="#any_significant" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">any_significant</span></h3><p>The supervisor will automatically shut itself down when <em>any</em> significant child
terminates, that is, when a transient significant child terminates normally or
when a temporary significant child terminates normally or abnormally.</p><h3 id="all_significant" class="section-heading"><a href="#all_significant" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">all_significant</span></h3><p>The supervisor will automatically shut itself down when <em>all</em> significant
children have terminated, that is, when the <em>last active</em> significant child
terminates. The same rules as for <code class="inline">any_significant</code> apply.</p><section role="note" class="admonition warning"><h4 class="admonition-title warning">Warning</h4><p>The automatic shutdown feature was introduced in OTP 24.0, but applications
using this feature will also compile and run with older OTP versions.</p><p>However, such applications, when compiled with an OTP version that predates
the appearance of the automatic shutdown feature, will leak processes because
the automatic shutdowns they rely on will not happen.</p><p>It is up to implementors to take proper precautions if they expect that their
applications may be compiled with older OTP versions.</p></section><section role="note" class="admonition warning"><h4 class="admonition-title warning">Warning</h4><p>Top supervisors of <a href="applications.html">Applications</a> should not be configured
for automatic shutdown, because when the top supervisor exits, the application
terminates. If the application is <code class="inline">permanent</code>, all other applications and the
runtime system are terminated as well.</p></section><section role="note" class="admonition warning"><h4 class="admonition-title warning">Warning</h4><p>Supervisors configured for automatic shutdown should not be made
<a href="sup_princ.html#restart">permanent</a> children of their respective parent
supervisors, as they would be restarted immediately after having automatically
shut down, only to shut down automatically again after a while, and may thus
exhaust the <a href="sup_princ.html#max_intensity">Maximum Restart Intensity</a> of the
parent supervisor.</p></section><p><a href="" id="spec"></a></p><h2 id="child-specification" class="section-heading"><a href="#child-specification" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Child Specification</span></h2><p>The type definition for a child specification is as follows:</p><pre><code class="makeup erlang" translate="no"><span class="nf">child_spec</span><span class="p" data-group-id="5630257466-1">(</span><span class="p" data-group-id="5630257466-1">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5630257466-2">#{</span><span class="ss">id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">child_id</span><span class="p" data-group-id="5630257466-3">(</span><span class="p" data-group-id="5630257466-3">)</span><span class="p">,</span><span class="w">             </span><span class="c1">% mandatory</span><span class="w">
                 </span><span class="ss">start</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">mfargs</span><span class="p" data-group-id="5630257466-4">(</span><span class="p" data-group-id="5630257466-4">)</span><span class="p">,</span><span class="w">            </span><span class="c1">% mandatory</span><span class="w">
                 </span><span class="ss">restart</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">restart</span><span class="p" data-group-id="5630257466-5">(</span><span class="p" data-group-id="5630257466-5">)</span><span class="p">,</span><span class="w">         </span><span class="c1">% optional</span><span class="w">
                 </span><span class="ss">significant</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">significant</span><span class="p" data-group-id="5630257466-6">(</span><span class="p" data-group-id="5630257466-6">)</span><span class="p">,</span><span class="w"> </span><span class="c1">% optional</span><span class="w">
                 </span><span class="ss">shutdown</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">shutdown</span><span class="p" data-group-id="5630257466-7">(</span><span class="p" data-group-id="5630257466-7">)</span><span class="p">,</span><span class="w">       </span><span class="c1">% optional</span><span class="w">
                 </span><span class="ss">type</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">worker</span><span class="p" data-group-id="5630257466-8">(</span><span class="p" data-group-id="5630257466-8">)</span><span class="p">,</span><span class="w">             </span><span class="c1">% optional</span><span class="w">
                 </span><span class="ss">modules</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">modules</span><span class="p" data-group-id="5630257466-9">(</span><span class="p" data-group-id="5630257466-9">)</span><span class="p" data-group-id="5630257466-2">}</span><span class="w">         </span><span class="c1">% optional</span><span class="w">
    </span><span class="nf">child_id</span><span class="p" data-group-id="5630257466-10">(</span><span class="p" data-group-id="5630257466-10">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="5630257466-11">(</span><span class="p" data-group-id="5630257466-11">)</span><span class="w">
    </span><span class="nf">mfargs</span><span class="p" data-group-id="5630257466-12">(</span><span class="p" data-group-id="5630257466-12">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5630257466-13">{</span><span class="n">M</span><span class="w"> </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="nf">module</span><span class="p" data-group-id="5630257466-14">(</span><span class="p" data-group-id="5630257466-14">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="nf">atom</span><span class="p" data-group-id="5630257466-15">(</span><span class="p" data-group-id="5630257466-15">)</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5630257466-16">[</span><span class="nf">term</span><span class="p" data-group-id="5630257466-17">(</span><span class="p" data-group-id="5630257466-17">)</span><span class="p" data-group-id="5630257466-16">]</span><span class="p" data-group-id="5630257466-13">}</span><span class="w">
    </span><span class="nf">modules</span><span class="p" data-group-id="5630257466-18">(</span><span class="p" data-group-id="5630257466-18">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5630257466-19">[</span><span class="nf">module</span><span class="p" data-group-id="5630257466-20">(</span><span class="p" data-group-id="5630257466-20">)</span><span class="p" data-group-id="5630257466-19">]</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="ss">dynamic</span><span class="w">
    </span><span class="nf">restart</span><span class="p" data-group-id="5630257466-21">(</span><span class="p" data-group-id="5630257466-21">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">permanent</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="ss">transient</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="ss">temporary</span><span class="w">
    </span><span class="nf">significant</span><span class="p" data-group-id="5630257466-22">(</span><span class="p" data-group-id="5630257466-22">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">boolean</span><span class="p" data-group-id="5630257466-23">(</span><span class="p" data-group-id="5630257466-23">)</span><span class="w">
    </span><span class="nf">shutdown</span><span class="p" data-group-id="5630257466-24">(</span><span class="p" data-group-id="5630257466-24">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">brutal_kill</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">timeout</span><span class="p" data-group-id="5630257466-25">(</span><span class="p" data-group-id="5630257466-25">)</span><span class="w">
    </span><span class="nf">worker</span><span class="p" data-group-id="5630257466-26">(</span><span class="p" data-group-id="5630257466-26">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">worker</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="ss">supervisor</span></code></pre><ul><li><p><code class="inline">id</code> is used to identify the child specification internally by the supervisor.</p><p>The <code class="inline">id</code> key is mandatory.</p><p>Note that this identifier occasionally has been called &quot;name&quot;. As far as
possible, the terms &quot;identifier&quot; or &quot;id&quot; are now used but in order to keep
backwards compatibility, some occurrences of &quot;name&quot; can still be found, for
example in error messages.</p></li><li><p><code class="inline">start</code> defines the function call used to start the child process. It is a
module-function-arguments tuple used as <a href="../apps/erts/erlang.html#apply/3"><code class="inline">apply(M, F, A)</code></a>.</p><p>It is to be (or result in) a call to any of the following:</p><ul><li><a href="../apps/stdlib/supervisor.html#start_link/3"><code class="inline">supervisor:start_link/2,3</code></a></li><li><a href="../apps/stdlib/gen_server.html#start_link/4"><code class="inline">gen_server:start_link/3,4</code></a></li><li><a href="../apps/stdlib/gen_statem.html#start_link/4"><code class="inline">gen_statem:start_link/3,4</code></a></li><li><a href="../apps/stdlib/gen_event.html#start_link/2"><code class="inline">gen_event:start_link/0,1,2</code></a></li><li>A function compliant with these functions. For details, see
<a href="../apps/stdlib/supervisor.html"><code class="inline">supervisor</code></a>.</li></ul><p>The <code class="inline">start</code> key is mandatory.</p></li><li><p><a href="" id="restart"></a> <code class="inline">restart</code> defines when a terminated child process is to be
restarted.</p><ul><li>A <code class="inline">permanent</code> child process is always restarted.</li><li>A <code class="inline">temporary</code> child process is never restarted (not even when the supervisor
restart strategy is <code class="inline">rest_for_one</code> or <code class="inline">one_for_all</code> and a sibling death
causes the temporary process to be terminated).</li><li>A <code class="inline">transient</code> child process is restarted only if it terminates abnormally,
that is, with an exit reason other than <code class="inline">normal</code>, <code class="inline">shutdown</code>, or
<code class="inline">{shutdown,Term}</code>.</li></ul><p>The <code class="inline">restart</code> key is optional. If it is not given, the default value
<code class="inline">permanent</code> will be used.</p></li><li><p><a href="" id="significant_child"></a> <code class="inline">significant</code> defines whether a child is considered
significant for <a href="sup_princ.html#automatic-shutdown">automatic self-shutdown</a> of
the supervisor.</p><p>It is invalid to set this option to <code class="inline">true</code> for a child with
<a href="sup_princ.html#restart">restart type</a> <code class="inline">permanent</code> or in a supervisor with
<a href="sup_princ.html#automatic-shutdown">auto_shutdown</a> set to <code class="inline">never</code>.</p></li><li><p><a href="" id="shutdown"></a> <code class="inline">shutdown</code> defines how a child process is to be terminated.</p><ul><li><code class="inline">brutal_kill</code> means that the child process is unconditionally terminated
using <a href="../apps/erts/erlang.html#exit/2"><code class="inline">exit(Child, kill)</code></a>.</li><li>An integer time-out value means that the supervisor tells the child process
to terminate by calling <a href="../apps/erts/erlang.html#exit/2"><code class="inline">exit(Child, shutdown)</code></a> and then waits
for an exit signal back. If no exit signal is received within the specified
time, the child process is unconditionally terminated using
<a href="../apps/erts/erlang.html#exit/2"><code class="inline">exit(Child, kill)</code></a>.</li><li>If the child process is another supervisor, it should be set to <code class="inline">infinity</code>
to give the subtree enough time to shut down. It is also allowed to set it
to <code class="inline">infinity</code> if the child process is a worker.</li></ul><section role="note" class="admonition warning"><h4 class="admonition-title warning">Warning</h4><p>Setting the shutdown time to anything other than <code class="inline">infinity</code> for a child of
type <code class="inline">supervisor</code> can cause a race condition where the child in question
unlinks its own children, but fails to terminate them before it is killed.</p><p>Be careful when setting the shutdown time to <code class="inline">infinity</code> when the child
process is a worker. Because, in this situation, the termination of the
supervision tree depends on the child process; it must be implemented in a
safe way and its cleanup procedure must always return.</p></section><p>The <code class="inline">shutdown</code> key is optional. If it is not given, and the child is of type
<code class="inline">worker</code>, the default value <code class="inline">5000</code> will be used; if the child is of type
<code class="inline">supervisor</code>, the default value <code class="inline">infinity</code> will be used.</p></li><li><p><code class="inline">type</code> specifies whether the child process is a supervisor or a worker.</p><p>The <code class="inline">type</code> key is optional. If it is not given, the default value <code class="inline">worker</code>
will be used.</p></li><li><p><code class="inline">modules</code> has to be a list consisting of a single element. The value
of that element depends on the behaviour of the process:</p><ul><li>If the child process is a <code class="inline">gen_event</code>, the element has to be the atom
<code class="inline">dynamic</code>.</li><li>Otherwise, the element should be <code class="inline">Module</code>, where <code class="inline">Module</code> is the
name of the callback module.</li></ul><p>This information is used by the release handler during upgrades and
downgrades; see <a href="release_handling.html">Release Handling</a>.</p><p>The <code class="inline">modules</code> key is optional. If it is not given, it defaults to <code class="inline">[M]</code>, where
<code class="inline">M</code> comes from the child's start <code class="inline">{M,F,A}</code>.</p></li></ul><p><em>Example:</em> The child specification to start the server <code class="inline">ch3</code> in the previous
example look as follows:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="8247129648-1">#{</span><span class="ss">id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">ch3</span><span class="p">,</span><span class="w">
  </span><span class="ss">start</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="8247129648-2">{</span><span class="ss">ch3</span><span class="p">,</span><span class="w"> </span><span class="ss">start_link</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8247129648-3">[</span><span class="p" data-group-id="8247129648-3">]</span><span class="p" data-group-id="8247129648-2">}</span><span class="p">,</span><span class="w">
  </span><span class="ss">restart</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">permanent</span><span class="p">,</span><span class="w">
  </span><span class="ss">shutdown</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">brutal_kill</span><span class="p">,</span><span class="w">
  </span><span class="ss">type</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">worker</span><span class="p">,</span><span class="w">
  </span><span class="ss">modules</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="8247129648-4">[</span><span class="ss">ch3</span><span class="p" data-group-id="8247129648-4">]</span><span class="p" data-group-id="8247129648-1">}</span></code></pre><p>or simplified, relying on the default values:</p><pre><code class="text">#{id =&gt; ch3,
  start =&gt; {ch3, start_link, []},
  shutdown =&gt; brutal_kill}</code></pre><p>Example: A child specification to start the event manager from the chapter about
<a href="events.html#mgr">gen_event</a>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="8772370287-1">#{</span><span class="ss">id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">error_man</span><span class="p">,</span><span class="w">
  </span><span class="ss">start</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="8772370287-2">{</span><span class="ss">gen_event</span><span class="p">,</span><span class="w"> </span><span class="ss">start_link</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8772370287-3">[</span><span class="p" data-group-id="8772370287-4">{</span><span class="ss">local</span><span class="p">,</span><span class="w"> </span><span class="ss">error_man</span><span class="p" data-group-id="8772370287-4">}</span><span class="p" data-group-id="8772370287-3">]</span><span class="p" data-group-id="8772370287-2">}</span><span class="p">,</span><span class="w">
  </span><span class="ss">modules</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">dynamic</span><span class="p" data-group-id="8772370287-1">}</span></code></pre><p>Both server and event manager are registered processes which can be expected to
be always accessible. Thus they are specified to be <code class="inline">permanent</code>.</p><p><code class="inline">ch3</code> does not need to do any cleaning up before termination. Thus, no shutdown
time is needed, but <code class="inline">brutal_kill</code> is sufficient. <code class="inline">error_man</code> can need some time
for the event handlers to clean up, thus the shutdown time is set to 5000 ms
(which is the default value).</p><p>Example: A child specification to start another supervisor:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="0532329271-1">#{</span><span class="ss">id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">sup</span><span class="p">,</span><span class="w">
  </span><span class="ss">start</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="0532329271-2">{</span><span class="ss">sup</span><span class="p">,</span><span class="w"> </span><span class="ss">start_link</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0532329271-3">[</span><span class="p" data-group-id="0532329271-3">]</span><span class="p" data-group-id="0532329271-2">}</span><span class="p">,</span><span class="w">
  </span><span class="ss">restart</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">transient</span><span class="p">,</span><span class="w">
  </span><span class="ss">type</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">supervisor</span><span class="p" data-group-id="0532329271-1">}</span><span class="w"> </span><span class="c1">% will cause default shutdown=&gt;infinity</span></code></pre><p><a href="" id="super_tree"></a></p><h2 id="starting-a-supervisor" class="section-heading"><a href="#starting-a-supervisor" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Starting a Supervisor</span></h2><p>In the previous example, the supervisor is started by calling
<code class="inline">ch_sup:start_link()</code>:</p><pre><code class="makeup erlang" translate="no"><span class="nf">start_link</span><span class="p" data-group-id="5776114523-1">(</span><span class="p" data-group-id="5776114523-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">supervisor</span><span class="p">:</span><span class="nf">start_link</span><span class="p" data-group-id="5776114523-2">(</span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5776114523-3">[</span><span class="p" data-group-id="5776114523-3">]</span><span class="p" data-group-id="5776114523-2">)</span><span class="p">.</span></code></pre><p><code class="inline">ch_sup:start_link</code> calls function <a href="../apps/stdlib/supervisor.html#start_link/2"><code class="inline">supervisor:start_link/2</code></a>, which spawns and
links to a new process, a supervisor.</p><ul><li>The first argument, <code class="inline">ch_sup</code>, is the name of the callback module, that is, the
module where the <code class="inline">init</code> callback function is located.</li><li>The second argument, <code class="inline">[]</code>, is a term that is passed as is to the callback
function <code class="inline">init</code>. Here, <code class="inline">init</code> does not need any data and ignores the argument.</li></ul><p>In this case, the supervisor is not registered. Instead its pid must be used. A
name can be specified by calling
<a href="../apps/stdlib/supervisor.html#start_link/3"><code class="inline">supervisor:start_link({local, Name}, Module, Args)</code></a>
or
<a href="../apps/stdlib/supervisor.html#start_link/3"><code class="inline">supervisor:start_link({global, Name}, Module, Args)</code></a>.</p><p>The new supervisor process calls the callback function <code class="inline">ch_sup:init([])</code>. <code class="inline">init</code>
has to return <code class="inline">{ok, {SupFlags, ChildSpecs}}</code>:</p><pre><code class="makeup erlang" translate="no"><span class="nf">init</span><span class="p" data-group-id="4676652130-1">(</span><span class="p">_</span><span class="n">Args</span><span class="p" data-group-id="4676652130-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">SupFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4676652130-2">#{</span><span class="p" data-group-id="4676652130-2">}</span><span class="p">,</span><span class="w">
    </span><span class="n">ChildSpecs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4676652130-3">[</span><span class="p" data-group-id="4676652130-4">#{</span><span class="ss">id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">ch3</span><span class="p">,</span><span class="w">
                    </span><span class="ss">start</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="4676652130-5">{</span><span class="ss">ch3</span><span class="p">,</span><span class="w"> </span><span class="ss">start_link</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4676652130-6">[</span><span class="p" data-group-id="4676652130-6">]</span><span class="p" data-group-id="4676652130-5">}</span><span class="p">,</span><span class="w">
                    </span><span class="ss">shutdown</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">brutal_kill</span><span class="p" data-group-id="4676652130-4">}</span><span class="p" data-group-id="4676652130-3">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4676652130-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4676652130-8">{</span><span class="n">SupFlags</span><span class="p">,</span><span class="w"> </span><span class="n">ChildSpecs</span><span class="p" data-group-id="4676652130-8">}</span><span class="p" data-group-id="4676652130-7">}</span><span class="p">.</span></code></pre><p>Subsequently, the supervisor starts its child processes according to the child
specifications in the start specification. In this case there is a single child
process, called <code class="inline">ch3</code>.</p><p><a href="../apps/stdlib/supervisor.html#start_link/3"><code class="inline">supervisor:start_link/3</code></a> is synchronous. It does not return until all child
processes have been started.</p><h2 id="adding-a-child-process" class="section-heading"><a href="#adding-a-child-process" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Adding a Child Process</span></h2><p>In addition to the static supervision tree as defined by the child
specifications, dynamic child processes can be added to an existing
supervisor by calling <a href="../apps/stdlib/supervisor.html#start_child/2"><code class="inline">supervisor:start_child(Sup, ChildSpec)</code></a>.</p><p><code class="inline">Sup</code> is the pid, or name, of the supervisor. <code class="inline">ChildSpec</code> is a
<a href="sup_princ.html#spec">child specification</a>.</p><p>Child processes added using <code class="inline">start_child/2</code> behave in the same way as the other
child processes, with one important exception: if a supervisor dies and is
recreated, then all child processes that were dynamically added to the
supervisor are lost.</p><h2 id="stopping-a-child-process" class="section-heading"><a href="#stopping-a-child-process" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Stopping a Child Process</span></h2><p>Any child process, static or dynamic, can be stopped in accordance with the
shutdown specification by calling
<a href="../apps/stdlib/supervisor.html#terminate_child/2"><code class="inline">supervisor:terminate_child(Sup, Id)</code></a>.</p><p>Stopping a <a href="sup_princ.html#significant_child">significant child</a> of a supervisor
configured for <a href="sup_princ.html#automatic-shutdown">automatic shutdown</a> will not
trigger an automatic shutdown.</p><p>The child specification for a stopped child process is deleted by
calling <a href="../apps/stdlib/supervisor.html#delete_child/2"><code class="inline">supervisor:delete_child(Sup, Id)</code></a>.</p><p><code class="inline">Sup</code> is the pid, or name, of the supervisor. <code class="inline">Id</code> is the value associated with
the <code class="inline">id</code> key in the <a href="sup_princ.html#spec">child specification</a>.</p><p>As with dynamically added child processes, the effects of deleting a static
child process are lost if the supervisor itself restarts.</p><p><a href="" id="simple"></a></p><h2 id="simplified-one_for_one-supervisors" class="section-heading"><a href="#simplified-one_for_one-supervisors" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Simplified one_for_one Supervisors</span></h2><p>A supervisor with restart strategy <code class="inline">simple_one_for_one</code> is a simplified
<code class="inline">one_for_one</code> supervisor, where all child processes are dynamically added
instances of the same process.</p><p>The following is an example of a callback module for a <code class="inline">simple_one_for_one</code>
supervisor:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4422418845-1">(</span><span class="ss">simple_sup</span><span class="p" data-group-id="4422418845-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">behaviour</span><span class="p" data-group-id="4422418845-2">(</span><span class="ss">supervisor</span><span class="p" data-group-id="4422418845-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4422418845-3">(</span><span class="p" data-group-id="4422418845-4">[</span><span class="ss">start_link</span><span class="p">/</span><span class="mi">0</span><span class="p" data-group-id="4422418845-4">]</span><span class="p" data-group-id="4422418845-3">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4422418845-5">(</span><span class="p" data-group-id="4422418845-6">[</span><span class="ss">init</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="4422418845-6">]</span><span class="p" data-group-id="4422418845-5">)</span><span class="p">.</span><span class="w">

</span><span class="nf">start_link</span><span class="p" data-group-id="4422418845-7">(</span><span class="p" data-group-id="4422418845-7">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">supervisor</span><span class="p">:</span><span class="nf">start_link</span><span class="p" data-group-id="4422418845-8">(</span><span class="ss">simple_sup</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4422418845-9">[</span><span class="p" data-group-id="4422418845-9">]</span><span class="p" data-group-id="4422418845-8">)</span><span class="p">.</span><span class="w">

</span><span class="nf">init</span><span class="p" data-group-id="4422418845-10">(</span><span class="p">_</span><span class="n">Args</span><span class="p" data-group-id="4422418845-10">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">SupFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4422418845-11">#{</span><span class="ss">strategy</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">simple_one_for_one</span><span class="p">,</span><span class="w">
                 </span><span class="ss">intensity</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                 </span><span class="ss">period</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="4422418845-11">}</span><span class="p">,</span><span class="w">
    </span><span class="n">ChildSpecs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4422418845-12">[</span><span class="p" data-group-id="4422418845-13">#{</span><span class="ss">id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">call</span><span class="p">,</span><span class="w">
                    </span><span class="ss">start</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="4422418845-14">{</span><span class="ss">call</span><span class="p">,</span><span class="w"> </span><span class="ss">start_link</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4422418845-15">[</span><span class="p" data-group-id="4422418845-15">]</span><span class="p" data-group-id="4422418845-14">}</span><span class="p">,</span><span class="w">
                    </span><span class="ss">shutdown</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">brutal_kill</span><span class="p" data-group-id="4422418845-13">}</span><span class="p" data-group-id="4422418845-12">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4422418845-16">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4422418845-17">{</span><span class="n">SupFlags</span><span class="p">,</span><span class="w"> </span><span class="n">ChildSpecs</span><span class="p" data-group-id="4422418845-17">}</span><span class="p" data-group-id="4422418845-16">}</span><span class="p">.</span></code></pre><p>When started, the supervisor does not start any child
processes. Instead, all child processes need to be added dynamically by
calling <a href="../apps/stdlib/supervisor.html#start_child/2"><code class="inline">supervisor:start_child(Sup, List)</code></a>.</p><p><code class="inline">Sup</code> is the pid, or name, of the supervisor. <code class="inline">List</code> is an arbitrary list of
terms, which are added to the list of arguments specified in the child
specification. If the start function is specified as <code class="inline">{M, F, A}</code>, the child
process is started by calling <a href="../apps/erts/erlang.html#apply/3"><code class="inline">apply(M, F, A++List)</code></a>.</p><p>For example, adding a child to <code class="inline">simple_sup</code> above:</p><pre><code class="text">supervisor:start_child(Pid, [id1])</code></pre><p>The result is that the child process is started by calling
<a href="../apps/erts/erlang.html#apply/3"><code class="inline">apply(call, start_link, []++[id1])</code></a>, or actually:</p><pre><code class="text">call:start_link(id1)</code></pre><p>A child under a <code class="inline">simple_one_for_one</code> supervisor can be terminated with the
following:</p><pre><code class="text">supervisor:terminate_child(Sup, Pid)</code></pre><p><code class="inline">Sup</code> is the pid, or name, of the supervisor and <code class="inline">Pid</code> is the pid of the child.</p><p>Because a <code class="inline">simple_one_for_one</code> supervisor can have many children, it shuts them
all down asynchronously. This means that the children will do their cleanup in
parallel and therefore the order in which they are stopped is not defined.</p><p>Starting, restarting, and manually terminating children are synchronous operations
which are executed in the context of the supervisor process. This means
that the supervisor process will be blocked while it is performing any of those
operations. Child processes are responsible for keeping their start and shutdown
phases as short as possible.</p><h2 id="stopping" class="section-heading"><a href="#stopping" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Stopping</span></h2><p>Since the supervisor is part of a supervision tree, it is
automatically terminated by its supervisor. When asked to shut down, a
supervisor terminates all child processes in reverse start order
according to the respective shutdown specifications before terminating
itself.</p><p>If the supervisor is configured for
<a href="sup_princ.html#automatic-shutdown">automatic shutdown</a> on termination of any or
all <a href="sup_princ.html#significant_child">significant children</a>, it will shut down
itself when any or the last active significant child terminates, respectively.
The shutdown itself follows the same procedure as described above, that is, the
supervisor terminates all remaining child processes in reverse start order
before terminating itself.</p><h3 id="manual-stopping-versus-automatic-shutdown" class="section-heading"><a href="#manual-stopping-versus-automatic-shutdown" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Manual stopping versus Automatic Shutdown</span></h3><p>For several reasons, a supervisor should not be stopped manually via
<a href="../apps/stdlib/supervisor.html#terminate_child/2"><code class="inline">supervisor:terminate_child/2</code></a> from a child located in its own tree.</p><ol><li>The child process will have to know the pids or registered names not only of
the supervisor it wants to stop, but also that of the supervisor's parent
supervisor, in order to tell the parent supervisor to stop the supervisor it
wants to stop. This can make restructuring a supervision tree difficult.</li><li><a href="../apps/stdlib/supervisor.html#terminate_child/2"><code class="inline">supervisor:terminate_child/2</code></a> is a blocking call that will only return after
the parent supervisor has finished the shutdown of the supervisor that should
be stopped. Unless the call is made from a spawned process, this will result
in a deadlock, as the supervisor waits for the child to exit as part of its
shutdown procedure, whereas the child waits for the supervisor to shut down.
If the child is trapping exits, this deadlock will last until the
<a href="sup_princ.html#shutdown">shutdown</a> timeout for the child expires.</li><li>When a supervisor is stopping a child, it will wait for the shutdown to
complete before accepting other calls, that is, the supervisor will be
unresponsive until then. If the termination takes some time to complete,
especially when the considerations outlined in the previous point were not
taken into account carefully, said supervisor might become unresponsive for a
long time.</li></ol><p>Instead, it is generally a better approach to rely on
<a href="sup_princ.html#automatic-shutdown">Automatic Shutdown</a>.</p><ol><li>A child process does not need to know anything about its supervisor and its
respective parent, not even that it is part of a supervision tree in the
first place. It is instead only the supervisor which hosts the child who must
know which of its children are <a href="sup_princ.html#significant_child">significant</a>
ones, and when to shut itself down.</li><li>A child process does not need to do anything special to shut down the work
unit it is part of. All it needs to do is terminate normally when it has
finished the task it was started for.</li><li>A supervisor that is automatically shutting itself down will perform the
required shutdown steps fully independent of its parent supervisor. The
parent supervisor will only notice that its child supervisor has terminated
in the end. As the parent supervisor is not involved in the shutdown process,
it will not be blocked.</li></ol>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="events.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
gen_event Behaviour
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="spec_proc.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
sys and proc_lib
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Erlang System Documentation.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright © 1996-2025 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js"></script>
  <script>
  let initialized = false;

  window.addEventListener("exdoc:loaded", () => {
      if (!initialized) {
      mermaid.initialize({
          startOnLoad: false,
          theme: document.body.className.includes("dark") ? "dark" : "default"
      });
      initialized = true;
      }

      let id = 0;
      for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
          graphEl.innerHTML = svg;
          bindFunctions?.(graphEl);
          preEl.insertAdjacentElement("afterend", graphEl);
          preEl.remove();
      });
      }
  });
  </script>

  </body>
</html>
