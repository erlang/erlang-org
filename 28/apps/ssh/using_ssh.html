<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.1">
    <meta name="project" content="ssh v5.3.1">


<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=28&q=">
<meta name="major-vsn" content="28">
<link rel="canonical" href="https://www.erlang.org/doc/apps/ssh/using_ssh.html" />
    <title>Examples — ssh v5.3.1</title>

    <link rel="stylesheet" href="dist/html-erlang-ZK43ZOAC.css" />

    <script defer src="dist/sidebar_items-02FA5E5B.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="ssh" />
        </a>

      <div>
        <a href="../../index.html" class="sidebar-projectName" translate="no">
ssh
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v5.3.1
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of ssh</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>Examples</h1>


      <a href="https://github.com/erlang/otp/blob/OTP-28.0.1/lib/ssh/doc/guides/using_ssh.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<p>The following examples use the utility function <a href="ssh.html#start/0"><code class="inline">ssh:start/0</code></a> to start all
needed applications (<code class="inline">crypto</code>, <code class="inline">public_key</code>, and <code class="inline">ssh</code>). All examples are run in
an Erlang shell, or in a bash shell, using <strong>OpenSSH</strong> to illustrate how the <code class="inline">ssh</code>
application can be used. The examples are run as the user <code class="inline">otptest</code> on a local
network where the user is authorized to log in over <code class="inline">ssh</code> to the host <strong>ssh.example.com</strong>.</p><p>If nothing else is stated, it is presumed that the <code class="inline">otptest</code> user has an entry
in the <strong>authorized_keys</strong> file of <strong>ssh.example.com</strong> (allowed to log in over <code class="inline">ssh</code> without
entering a password). Also, <strong>ssh.example.com</strong> is a known host in the <code class="inline">known_hosts</code> file
of the user <code class="inline">otptest</code>. This means that host-verification can be done without
user-interaction.</p><h2 id="using-the-erlang-ssh-terminal-client" class="section-heading"><a href="#using-the-erlang-ssh-terminal-client" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Using the Erlang ssh Terminal Client</span></h2><p>The user <code class="inline">otptest</code>, which has bash as default shell, uses the <a href="ssh.html#shell/1"><code class="inline">ssh:shell/1</code></a>
client to connect to the <strong>OpenSSH</strong> daemon running on a host called <strong>ssh.example.com</strong>:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="9359443351-1">(</span><span class="p" data-group-id="9359443351-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
2&gt; </span><span class="p" data-group-id="9359443351-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="p" data-group-id="9359443351-2">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">shell</span><span class="p" data-group-id="9359443351-3">(</span><span class="s">&quot;ssh.example.com&quot;</span><span class="p" data-group-id="9359443351-3">)</span><span class="p">.</span><span class="w">
</span><span class="ss">otptest@ssh</span><span class="p">.</span><span class="ss">example</span><span class="p">.</span><span class="nc">com</span><span class="p">:</span><span class="o">&gt;</span><span class="w"> </span><span class="ss">pwd</span><span class="w">
</span><span class="o">/</span><span class="ss">home</span><span class="o">/</span><span class="ss">otptest</span><span class="w">
</span><span class="ss">otptest@ssh</span><span class="p">.</span><span class="ss">example</span><span class="p">.</span><span class="nc">com</span><span class="p">:</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">exit</span><span class="w">
</span><span class="ss">logout</span><span class="w">
</span><span class="mi">3</span><span class="o">&gt;</span></code></pre><h2 id="running-an-erlang-ssh-daemon" class="section-heading"><a href="#running-an-erlang-ssh-daemon" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Running an Erlang ssh Daemon</span></h2><p>The <a href="ssh_file.html#t:system_dir_daemon_option/0"><code class="inline">system_dir</code></a> option must be a
directory containing a host key file and it defaults to <code class="inline">/etc/ssh</code>. For details,
see Section Configuration in <a href="ssh_app.html">ssh</a>.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p>Normally, the <code class="inline">/etc/ssh</code> directory is only readable by root.</p></section><p>The option <a href="ssh_file.html#t:user_dir_common_option/0"><code class="inline">user_dir</code></a> defaults to
directory <code class="inline">~/.ssh</code>.</p><p><em>Step 1.</em> To run the example without root privileges, generate new keys and host
keys:</p><pre><code class="text">$bash&gt; ssh-keygen -t rsa -f /tmp/ssh_daemon/ssh_host_rsa_key
[...]
$bash&gt; ssh-keygen -t rsa -f /tmp/otptest_user/.ssh/id_rsa
[...]</code></pre><p><em>Step 2.</em> Create the file <code class="inline">/tmp/otptest_user/.ssh/authorized_keys</code> and add the
content of <code class="inline">/tmp/otptest_user/.ssh/id_rsa.pub</code>.</p><p><a href="" id="start-daemon-step3"></a></p><p><em>Step 3.</em> Start the Erlang <code class="inline">ssh</code> daemon:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="4226262856-1">(</span><span class="p" data-group-id="4226262856-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
2&gt; </span><span class="p" data-group-id="4226262856-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Sshd</span><span class="p" data-group-id="4226262856-2">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">daemon</span><span class="p" data-group-id="4226262856-3">(</span><span class="mi">8989</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4226262856-4">[</span><span class="p" data-group-id="4226262856-5">{</span><span class="ss">system_dir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/ssh_daemon&quot;</span><span class="p" data-group-id="4226262856-5">}</span><span class="p">,</span><span class="w">
                                  </span><span class="p" data-group-id="4226262856-6">{</span><span class="ss">user_dir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/otptest_user/.ssh&quot;</span><span class="p" data-group-id="4226262856-6">}</span><span class="p" data-group-id="4226262856-4">]</span><span class="p" data-group-id="4226262856-3">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="4226262856-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.54</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="4226262856-7">}</span><span class="w">
</span><span class="mi">3</span><span class="o">&gt;</span></code></pre><p><em>Step 4.</em> Use the <strong>OpenSSH</strong> client from a shell to connect to the Erlang <code class="inline">ssh</code>
daemon:</p><pre><code class="text">$bash&gt; ssh ssh.example.com -p 8989  -i /tmp/otptest_user/.ssh/id_rsa \
                  -o UserKnownHostsFile=/tmp/otptest_user/.ssh/known_hosts
The authenticity of host 'ssh.example.com' can't be established.
RSA key fingerprint is 14:81:80:50:b1:1f:57:dd:93:a8:2d:2f:dd:90:ae:a8.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added 'ssh.example.com' (RSA) to the list of known hosts.
Eshell V5.10  (abort with ^G)
1&gt;</code></pre><p>There are two ways of shutting down an <code class="inline">ssh</code> daemon, see <em>Step 5a</em> and <em>Step
5b</em>.</p><p><em>Step 5a.</em> Shut down the Erlang <code class="inline">ssh</code> daemon so that it stops the listener but
leaves existing connections, started by the listener, operational:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">3&gt; </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">stop_listener</span><span class="p" data-group-id="0453445257-1">(</span><span class="n">Sshd</span><span class="p" data-group-id="0453445257-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="w">
</span><span class="mi">4</span><span class="o">&gt;</span></code></pre><p><em>Step 5b.</em> Shut down the Erlang <code class="inline">ssh</code> daemon so that it stops the listener and
all connections started by the listener:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">3&gt; </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">stop_daemon</span><span class="p" data-group-id="3862142314-1">(</span><span class="n">Sshd</span><span class="p" data-group-id="3862142314-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="w">
</span><span class="mi">4</span><span class="o">&gt;</span></code></pre><h2 id="one-time-execution" class="section-heading"><a href="#one-time-execution" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">One-Time Execution</span></h2><p><a href="" id="simple-client-example"></a></p><h3 id="erlang-client-contacting-os-standard-ssh-server" class="section-heading"><a href="#erlang-client-contacting-os-standard-ssh-server" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erlang client contacting OS standard ssh server</span></h3><p>In the following example, the Erlang shell is the client process that receives
the channel replies as Erlang messages.</p><p>Do an one-time execution of a remote OS command (&quot;pwd&quot;) over <code class="inline">ssh</code> to the ssh
server of the OS at the host &quot;ssh.example.com&quot;:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="8993531904-1">(</span><span class="p" data-group-id="8993531904-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
2&gt; </span><span class="p" data-group-id="8993531904-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ConnectionRef</span><span class="p" data-group-id="8993531904-2">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="8993531904-3">(</span><span class="s">&quot;ssh.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8993531904-4">[</span><span class="p" data-group-id="8993531904-4">]</span><span class="p" data-group-id="8993531904-3">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="8993531904-5">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.57</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="8993531904-5">}</span><span class="gp unselectable">
3&gt; </span><span class="p" data-group-id="8993531904-6">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p" data-group-id="8993531904-6">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">session_channel</span><span class="p" data-group-id="8993531904-7">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="8993531904-7">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="8993531904-8">{</span><span class="ss">ok</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="8993531904-8">}</span><span class="gp unselectable">
4&gt; </span><span class="ss">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">exec</span><span class="p" data-group-id="8993531904-9">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;pwd&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="8993531904-9">)</span><span class="p">.</span><span class="gp unselectable">
5&gt; </span><span class="nf">flush</span><span class="p" data-group-id="8993531904-10">(</span><span class="p" data-group-id="8993531904-10">)</span><span class="p">.</span><span class="w"> </span><span class="c1">% Get all pending messages. NOTE: ordering may vary!</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="8993531904-11">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.57</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="8993531904-12">{</span><span class="ss">data</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="p" data-group-id="8993531904-13">&lt;&lt;</span><span class="s">&quot;/home/otptest\n&quot;</span><span class="p" data-group-id="8993531904-13">&gt;&gt;</span><span class="p" data-group-id="8993531904-12">}</span><span class="p" data-group-id="8993531904-11">}</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="8993531904-14">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.57</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="8993531904-15">{</span><span class="ss">eof</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="8993531904-15">}</span><span class="p" data-group-id="8993531904-14">}</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="8993531904-16">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.57</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="8993531904-17">{</span><span class="ss">exit_status</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="8993531904-17">}</span><span class="p" data-group-id="8993531904-16">}</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="8993531904-18">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.57</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="8993531904-19">{</span><span class="ss">closed</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="8993531904-19">}</span><span class="p" data-group-id="8993531904-18">}</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
6&gt; </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">connection_info</span><span class="p" data-group-id="8993531904-20">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="ss">channels</span><span class="p" data-group-id="8993531904-20">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="8993531904-21">{</span><span class="ss">channels</span><span class="p">,</span><span class="p" data-group-id="8993531904-22">[</span><span class="p" data-group-id="8993531904-22">]</span><span class="p" data-group-id="8993531904-21">}</span><span class="w">
</span><span class="mi">7</span><span class="o">&gt;</span></code></pre><p>See <a href="ssh_connection.html"><code class="inline">ssh_connection</code></a> and <a href="ssh_connection.html#exec/4"><code class="inline">ssh_connection:exec/4</code></a> for finding documentation of
the channel messages.</p><p>To collect the channel messages in a program, use <code class="inline">receive...end</code> instead of
<code class="inline">flush/1</code>:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">5&gt; </span><span class="k">receive</span><span class="gp unselectable">
5&gt; </span><span class="w">    </span><span class="p" data-group-id="4998138341-1">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="w"> </span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4998138341-2">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="n">Type</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4998138341-2">}</span><span class="p" data-group-id="4998138341-1">}</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">-&gt;</span><span class="gp unselectable">
5&gt; </span><span class="w">        </span><span class="p" data-group-id="4998138341-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="n">Result</span><span class="p" data-group-id="4998138341-3">}</span><span class="gp unselectable">
5&gt; </span><span class="w">    </span><span class="p" data-group-id="4998138341-4">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="w"> </span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4998138341-5">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="n">Type</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4998138341-5">}</span><span class="p" data-group-id="4998138341-4">}</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">-&gt;</span><span class="gp unselectable">
5&gt; </span><span class="w">        </span><span class="p" data-group-id="4998138341-6">{</span><span class="ss">error</span><span class="p">,</span><span class="n">Result</span><span class="p" data-group-id="4998138341-6">}</span><span class="gp unselectable">
5&gt; </span><span class="k">end</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="4998138341-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="4998138341-8">&lt;&lt;</span><span class="s">&quot;/home/otptest\n&quot;</span><span class="p" data-group-id="4998138341-8">&gt;&gt;</span><span class="p" data-group-id="4998138341-7">}</span><span class="w">
</span><span class="mi">6</span><span class="o">&gt;</span></code></pre><p>Note that only the exec channel is closed after the one-time execution. The
connection is still up and can handle previously opened channels. It is also
possible to open a new channel:</p><pre><code class="makeup erlang" translate="no"><span class="c1">% try to open a new channel to check if the ConnectionRef is still open</span><span class="gp unselectable">
7&gt; </span><span class="p" data-group-id="9825380852-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">NewChannelId</span><span class="p" data-group-id="9825380852-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">session_channel</span><span class="p" data-group-id="9825380852-2">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="9825380852-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9825380852-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="9825380852-3">}</span><span class="w">
</span><span class="mi">8</span><span class="o">&gt;</span></code></pre><p>To close the connection, call the function
<a href="ssh.html#close/1"><code class="inline">ssh:close(ConnectionRef)</code></a>. As an alternative, set the option
<a href="ssh.html#t:max_idle_time_common_option/0"><code class="inline">{idle_time, 1}</code></a> when opening the
connection. This will cause the connection to be closed automatically when there
are no channels open for the specified time period, in this case 1 ms.</p><h3 id="os-standard-client-and-erlang-daemon-server" class="section-heading"><a href="#os-standard-client-and-erlang-daemon-server" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">OS standard client and Erlang daemon (server)</span></h3><p>An Erlang SSH daemon could be called for one-time execution of a &quot;command&quot;. The
&quot;command&quot; must be as if entered into the erlang shell, that is a sequence of
Erlang <a href="../../system/expressions.html">expressions</a> ended by a period (.). Variables
bound in that sequence will keep their bindings throughout the expression
sequence. The bindings are disposed when the result is returned.</p><p>Here is an example of a suitable expression sequence:</p><pre><code class="makeup erlang" translate="no"><span class="n">A</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p" data-group-id="1785261459-1">(</span><span class="n">A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">B</span><span class="p" data-group-id="1785261459-1">)</span><span class="p">.</span></code></pre><p>It evaluates to <code class="inline">true</code> if submitted to the Erlang daemon started in
<a href="using_ssh.html#start-daemon-step3">Step 3</a> above:</p><pre><code class="text">$bash&gt; ssh ssh.example.com -p 8989 &quot;A=1, B=2, 3 == (A + B).&quot;
true
$bash&gt;</code></pre><p>The same example but now using the Erlang ssh client to contact the Erlang
server:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="p" data-group-id="8839953716-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ConnectionRef</span><span class="p" data-group-id="8839953716-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="8839953716-2">(</span><span class="s">&quot;ssh.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">8989</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8839953716-3">[</span><span class="p" data-group-id="8839953716-3">]</span><span class="p" data-group-id="8839953716-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="8839953716-4">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.216</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="8839953716-4">}</span><span class="gp unselectable">
2&gt; </span><span class="p" data-group-id="8839953716-5">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p" data-group-id="8839953716-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">session_channel</span><span class="p" data-group-id="8839953716-6">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="8839953716-6">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="8839953716-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="8839953716-7">}</span><span class="gp unselectable">
3&gt; </span><span class="ss">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">exec</span><span class="p" data-group-id="8839953716-8">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w">
                                 </span><span class="s">&quot;A=1, B=2, 3 == (A + B).&quot;</span><span class="p">,</span><span class="w">
                                 </span><span class="ss">infinity</span><span class="p" data-group-id="8839953716-8">)</span><span class="p">.</span><span class="w">
</span><span class="ss">success</span><span class="gp unselectable">
4&gt; </span><span class="nf">flush</span><span class="p" data-group-id="8839953716-9">(</span><span class="p" data-group-id="8839953716-9">)</span><span class="p">.</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="8839953716-10">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.216</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="8839953716-11">{</span><span class="ss">data</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="p" data-group-id="8839953716-12">&lt;&lt;</span><span class="s">&quot;true&quot;</span><span class="p" data-group-id="8839953716-12">&gt;&gt;</span><span class="p" data-group-id="8839953716-11">}</span><span class="p" data-group-id="8839953716-10">}</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="8839953716-13">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.216</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="8839953716-14">{</span><span class="ss">exit_status</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="8839953716-14">}</span><span class="p" data-group-id="8839953716-13">}</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="8839953716-15">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.216</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="8839953716-16">{</span><span class="ss">eof</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="8839953716-16">}</span><span class="p" data-group-id="8839953716-15">}</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="8839953716-17">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.216</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="8839953716-18">{</span><span class="ss">closed</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="8839953716-18">}</span><span class="p" data-group-id="8839953716-17">}</span><span class="w">
</span><span class="ss">ok</span><span class="w">
</span><span class="mi">5</span><span class="o">&gt;</span></code></pre><p>Note that Erlang shell specific functions and control sequences like for example
<code class="inline">h().</code> are not supported.</p><h3 id="i-o-from-a-function-called-in-an-erlang-ssh-daemon" class="section-heading"><a href="#i-o-from-a-function-called-in-an-erlang-ssh-daemon" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">I/O from a function called in an Erlang ssh daemon</span></h3><p>Output to stdout on the server side is also displayed as well as the resulting
term from the function call:</p><pre><code class="text">$bash&gt; ssh ssh.example.com -p 8989 'io:format(&quot;Hello!~n~nHow are ~p?~n&quot;,[you]).'
Hello!

How are you?
ok
$bash&gt;</code></pre><p>And similar for reading from stdin. As an example we use <a href="../../apps/stdlib/io.html#read/1"><code class="inline">io:read/1</code></a> which
displays the argument as a prompt on stdout, reads a term from stdin and returns
it in an ok-tuple:</p><pre><code class="text">$bash&gt; ssh ssh.example.com -p 8989 'io:read(&quot;write something: &quot;).'
write something: [a,b,c].
{ok,[a,b,c]}
$bash&gt;</code></pre><p>The same example but using the Erlang ssh client:</p><pre><code class="makeup erlang" translate="no"><span class="w">
</span><span class="n">Eshell</span><span class="w"> </span><span class="n">V10</span><span class="p">.</span><span class="mf">5.2</span><span class="w">  </span><span class="p" data-group-id="1796020392-1">(</span><span class="ss">abort</span><span class="w"> </span><span class="ss">with</span><span class="w"> </span><span class="err">^</span><span class="n">G</span><span class="p" data-group-id="1796020392-1">)</span><span class="gp unselectable">
1&gt; </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="1796020392-2">(</span><span class="p" data-group-id="1796020392-2">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
2&gt; </span><span class="p" data-group-id="1796020392-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ConnectionRef</span><span class="p" data-group-id="1796020392-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="1796020392-4">(</span><span class="ss">loopback</span><span class="p">,</span><span class="w"> </span><span class="mi">8989</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1796020392-5">[</span><span class="p" data-group-id="1796020392-5">]</span><span class="p" data-group-id="1796020392-4">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="1796020392-6">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.92</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="1796020392-6">}</span><span class="gp unselectable">
3&gt; </span><span class="p" data-group-id="1796020392-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p" data-group-id="1796020392-7">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">session_channel</span><span class="p" data-group-id="1796020392-8">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="1796020392-8">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="1796020392-9">{</span><span class="ss">ok</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="1796020392-9">}</span><span class="gp unselectable">
4&gt; </span><span class="ss">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">exec</span><span class="p" data-group-id="1796020392-10">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w">
                                 </span><span class="s">&quot;io:read(\&quot;write something: \&quot;).&quot;</span><span class="p">,</span><span class="w">
                                 </span><span class="ss">infinity</span><span class="p" data-group-id="1796020392-10">)</span><span class="p">.</span><span class="w">
</span><span class="ss">success</span><span class="gp unselectable">
5&gt; </span><span class="nf">flush</span><span class="p" data-group-id="1796020392-11">(</span><span class="p" data-group-id="1796020392-11">)</span><span class="p">.</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="1796020392-12">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.92</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="1796020392-13">{</span><span class="ss">data</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="p" data-group-id="1796020392-14">&lt;&lt;</span><span class="s">&quot;write something: &quot;</span><span class="p" data-group-id="1796020392-14">&gt;&gt;</span><span class="p" data-group-id="1796020392-13">}</span><span class="p" data-group-id="1796020392-12">}</span><span class="w">
</span><span class="ss">ok</span><span class="w">
</span><span class="c1">% All data is sent as binaries with string contents:</span><span class="gp unselectable">
6&gt; </span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1796020392-15">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1796020392-16">&lt;&lt;</span><span class="s">&quot;[a,b,c].&quot;</span><span class="p" data-group-id="1796020392-16">&gt;&gt;</span><span class="p" data-group-id="1796020392-15">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
7&gt; </span><span class="nf">flush</span><span class="p" data-group-id="1796020392-17">(</span><span class="p" data-group-id="1796020392-17">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="w">
</span><span class="c1">%% Nothing is received, because the io:read/1</span><span class="w">
</span><span class="c1">%% requires the input line to end with a newline.</span><span class="w">

</span><span class="c1">%% Send a newline (it could have been included in the last send):</span><span class="gp unselectable">
8&gt; </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1796020392-18">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1796020392-19">&lt;&lt;</span><span class="s">&quot;\n&quot;</span><span class="p" data-group-id="1796020392-19">&gt;&gt;</span><span class="p" data-group-id="1796020392-18">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
9&gt; </span><span class="nf">flush</span><span class="p" data-group-id="1796020392-20">(</span><span class="p" data-group-id="1796020392-20">)</span><span class="p">.</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="1796020392-21">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.92</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="1796020392-22">{</span><span class="ss">data</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="p" data-group-id="1796020392-23">&lt;&lt;</span><span class="s">&quot;{ok,[a,b,c]}&quot;</span><span class="p" data-group-id="1796020392-23">&gt;&gt;</span><span class="p" data-group-id="1796020392-22">}</span><span class="p" data-group-id="1796020392-21">}</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="1796020392-24">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.92</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="1796020392-25">{</span><span class="ss">exit_status</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="1796020392-25">}</span><span class="p" data-group-id="1796020392-24">}</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="1796020392-26">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.92</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="1796020392-27">{</span><span class="ss">eof</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="1796020392-27">}</span><span class="p" data-group-id="1796020392-26">}</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="1796020392-28">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.92</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="1796020392-29">{</span><span class="ss">closed</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="1796020392-29">}</span><span class="p" data-group-id="1796020392-28">}</span><span class="w">
</span><span class="ss">ok</span><span class="w">
</span><span class="mi">10</span><span class="o">&gt;</span></code></pre><h3 id="configuring-the-server-s-daemon-s-command-execution" class="section-heading"><a href="#configuring-the-server-s-daemon-s-command-execution" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Configuring the server's (daemon's) command execution</span></h3><p>Every time a daemon <a href="using_ssh.html#running-an-erlang-ssh-daemon">is started</a>, it
enables one-time execution of commands as described in the
<a href="using_ssh.html#simple-client-example">previous section</a> unless explicitly
disabled.</p><p>There is often a need to configure some other exec evaluator to tailor the input
language or restrict the possible functions to call. There are two ways of doing
this which will be shown with examples below. See
<a href="ssh.html#daemon/2">ssh:daemon/2,3</a> and
<a href="ssh.html#t:exec_daemon_option/0">exec_daemon_option()</a> for details.</p><p>Examples of the two ways to configure the exec evaluator:</p><ol><li>Disable one-time execution.<br/>To modify the daemon start example above to reject one-time execution
requests, we change <a href="using_ssh.html#start-daemon-step3">Step 3</a> by adding the
option <code class="inline">{exec, disabled}</code> to:</li></ol><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="3435332286-1">(</span><span class="p" data-group-id="3435332286-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
2&gt; </span><span class="p" data-group-id="3435332286-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Sshd</span><span class="p" data-group-id="3435332286-2">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">daemon</span><span class="p" data-group-id="3435332286-3">(</span><span class="mi">8989</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3435332286-4">[</span><span class="p" data-group-id="3435332286-5">{</span><span class="ss">system_dir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/ssh_daemon&quot;</span><span class="p" data-group-id="3435332286-5">}</span><span class="p">,</span><span class="w">
                                  </span><span class="p" data-group-id="3435332286-6">{</span><span class="ss">user_dir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/otptest_user/.ssh&quot;</span><span class="p" data-group-id="3435332286-6">}</span><span class="p">,</span><span class="w">
                                  </span><span class="p" data-group-id="3435332286-7">{</span><span class="ss">exec</span><span class="p">,</span><span class="w"> </span><span class="ss">disabled</span><span class="p" data-group-id="3435332286-7">}</span><span class="w">
                                 </span><span class="p" data-group-id="3435332286-4">]</span><span class="p" data-group-id="3435332286-3">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="3435332286-8">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.54</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="3435332286-8">}</span><span class="w">
</span><span class="mi">3</span><span class="o">&gt;</span></code></pre><p>A call to that daemon will return the text &quot;Prohibited.&quot; on stderr (depending on
the client and OS), and the exit status 255:</p><pre><code class="text">$bash&gt; ssh ssh.example.com -p 8989 &quot;test.&quot;
Prohibited.
$bash&gt; echo $?
255
$bash&gt;</code></pre><p>And the Erlang client library also returns the text &quot;Prohibited.&quot; on data type 1
instead of the normal 0 and exit status 255:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">2&gt; </span><span class="p" data-group-id="8814784424-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ConnectionRef</span><span class="p" data-group-id="8814784424-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="8814784424-2">(</span><span class="ss">loopback</span><span class="p">,</span><span class="w"> </span><span class="mi">8989</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8814784424-3">[</span><span class="p" data-group-id="8814784424-3">]</span><span class="p" data-group-id="8814784424-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="8814784424-4">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.92</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="8814784424-4">}</span><span class="gp unselectable">
3&gt; </span><span class="p" data-group-id="8814784424-5">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p" data-group-id="8814784424-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">session_channel</span><span class="p" data-group-id="8814784424-6">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="8814784424-6">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="8814784424-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="8814784424-7">}</span><span class="gp unselectable">
4&gt; </span><span class="ss">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">exec</span><span class="p" data-group-id="8814784424-8">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test.&quot;</span><span class="w">
</span><span class="ss">success</span><span class="gp unselectable">
5&gt; </span><span class="nf">flush</span><span class="p" data-group-id="8814784424-9">(</span><span class="p" data-group-id="8814784424-9">)</span><span class="p">.</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="8814784424-10">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.106</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="8814784424-11">{</span><span class="ss">data</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="p" data-group-id="8814784424-12">&lt;&lt;</span><span class="s">&quot;Prohibited.&quot;</span><span class="p" data-group-id="8814784424-12">&gt;&gt;</span><span class="p" data-group-id="8814784424-11">}</span><span class="p" data-group-id="8814784424-10">}</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="8814784424-13">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.106</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="8814784424-14">{</span><span class="ss">exit_status</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p" data-group-id="8814784424-14">}</span><span class="p" data-group-id="8814784424-13">}</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="8814784424-15">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.106</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="8814784424-16">{</span><span class="ss">eof</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="8814784424-16">}</span><span class="p" data-group-id="8814784424-15">}</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="8814784424-17">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.106</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="8814784424-18">{</span><span class="ss">closed</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="8814784424-18">}</span><span class="p" data-group-id="8814784424-17">}</span><span class="w">
</span><span class="ss">ok</span><span class="w">
</span><span class="mi">6</span><span class="o">&gt;</span></code></pre><ol><li>Install an alternative evaluator.<br/>Start the damon with a reference to a <code class="inline">fun()</code> that handles the evaluation:</li></ol><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="0856619705-1">(</span><span class="p" data-group-id="0856619705-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
2&gt; </span><span class="n">MyEvaluator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="0856619705-2">(</span><span class="s">&quot;1&quot;</span><span class="p" data-group-id="0856619705-2">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="0856619705-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="ss">some_value</span><span class="p" data-group-id="0856619705-3">}</span><span class="p">;</span><span class="w">
                    </span><span class="p" data-group-id="0856619705-4">(</span><span class="s">&quot;2&quot;</span><span class="p" data-group-id="0856619705-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="0856619705-5">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="ss">some_other_value</span><span class="p" data-group-id="0856619705-5">}</span><span class="p">;</span><span class="w">
                    </span><span class="p" data-group-id="0856619705-6">(</span><span class="s">&quot;3&quot;</span><span class="p" data-group-id="0856619705-6">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="0856619705-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p" data-group-id="0856619705-7">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">read</span><span class="p" data-group-id="0856619705-8">(</span><span class="s">&quot;input erlang term&gt;&gt; &quot;</span><span class="p" data-group-id="0856619705-8">)</span><span class="p">,</span><span class="w">
                             </span><span class="p" data-group-id="0856619705-9">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p" data-group-id="0856619705-9">}</span><span class="p">;</span><span class="w">
                    </span><span class="p" data-group-id="0856619705-10">(</span><span class="n">Err</span><span class="p" data-group-id="0856619705-10">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="0856619705-11">{</span><span class="ss">error</span><span class="p">,</span><span class="p" data-group-id="0856619705-12">{</span><span class="ss">bad_input</span><span class="p">,</span><span class="n">Err</span><span class="p" data-group-id="0856619705-12">}</span><span class="p" data-group-id="0856619705-11">}</span><span class="w">
                 </span><span class="k">end</span><span class="p">.</span><span class="gp unselectable">
3&gt; </span><span class="p" data-group-id="0856619705-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Sshd</span><span class="p" data-group-id="0856619705-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">daemon</span><span class="p" data-group-id="0856619705-14">(</span><span class="mi">1234</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0856619705-15">[</span><span class="p" data-group-id="0856619705-16">{</span><span class="ss">system_dir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/ssh_daemon&quot;</span><span class="p" data-group-id="0856619705-16">}</span><span class="p">,</span><span class="w">
                                  </span><span class="p" data-group-id="0856619705-17">{</span><span class="ss">user_dir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/otptest_user/.ssh&quot;</span><span class="p" data-group-id="0856619705-17">}</span><span class="p">,</span><span class="w">
                                  </span><span class="p" data-group-id="0856619705-18">{</span><span class="ss">exec</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0856619705-19">{</span><span class="ss">direct</span><span class="p">,</span><span class="n">MyEvaluator</span><span class="p" data-group-id="0856619705-19">}</span><span class="p" data-group-id="0856619705-18">}</span><span class="w">
                                 </span><span class="p" data-group-id="0856619705-15">]</span><span class="p" data-group-id="0856619705-14">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="0856619705-20">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.275</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="0856619705-20">}</span><span class="w">
</span><span class="mi">4</span><span class="o">&gt;</span></code></pre><p>and call it:</p><pre><code class="text">$bash&gt; ssh localhost -p 1234 1
some_value
$bash&gt; ssh localhost -p 1234 2
some_other_value
# I/O works:
$bash&gt; ssh localhost -p 1234 3
input erlang term&gt;&gt; abc.
abc
# Check that Erlang evaluation is disabled:
$bash&gt; ssh localhost -p 1234 1+ 2.
**Error** {bad_input,&quot;1+ 2.&quot;}
$bash&gt;</code></pre><p>Note that spaces are preserved and that no point (.) is needed at the end - that
was required by the default evaluator.</p><p>The error return in the Erlang client (The text as data type 1 and exit_status
255):</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">2&gt; </span><span class="p" data-group-id="4467311514-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ConnectionRef</span><span class="p" data-group-id="4467311514-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="4467311514-2">(</span><span class="ss">loopback</span><span class="p">,</span><span class="w"> </span><span class="mi">1234</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4467311514-3">[</span><span class="p" data-group-id="4467311514-3">]</span><span class="p" data-group-id="4467311514-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="4467311514-4">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.92</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="4467311514-4">}</span><span class="gp unselectable">
3&gt; </span><span class="p" data-group-id="4467311514-5">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p" data-group-id="4467311514-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">session_channel</span><span class="p" data-group-id="4467311514-6">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="4467311514-6">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="4467311514-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="4467311514-7">}</span><span class="gp unselectable">
4&gt; </span><span class="ss">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">exec</span><span class="p" data-group-id="4467311514-8">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1+ 2.&quot;</span><span class="p" data-group-id="4467311514-8">)</span><span class="p">.</span><span class="w">
</span><span class="ss">success</span><span class="gp unselectable">
5&gt; </span><span class="nf">flush</span><span class="p" data-group-id="4467311514-9">(</span><span class="p" data-group-id="4467311514-9">)</span><span class="p">.</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="4467311514-10">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.106</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="4467311514-11">{</span><span class="ss">data</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="p" data-group-id="4467311514-12">&lt;&lt;</span><span class="s">&quot;**Error** {bad_input,\&quot;1+ 2.\&quot;}&quot;</span><span class="p" data-group-id="4467311514-12">&gt;&gt;</span><span class="p" data-group-id="4467311514-11">}</span><span class="p" data-group-id="4467311514-10">}</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="4467311514-13">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.106</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="4467311514-14">{</span><span class="ss">exit_status</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p" data-group-id="4467311514-14">}</span><span class="p" data-group-id="4467311514-13">}</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="4467311514-15">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.106</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="4467311514-16">{</span><span class="ss">eof</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="4467311514-16">}</span><span class="p" data-group-id="4467311514-15">}</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="4467311514-17">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.106</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="4467311514-18">{</span><span class="ss">closed</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="4467311514-18">}</span><span class="p" data-group-id="4467311514-17">}</span><span class="w">
</span><span class="ss">ok</span><span class="w">
</span><span class="mi">6</span><span class="o">&gt;</span></code></pre><p>The <code class="inline">fun()</code> in the exec option could take up to three arguments (<code class="inline">Cmd</code>, <code class="inline">User</code>
and <code class="inline">ClientAddress</code>). See the
<a href="ssh.html#t:exec_daemon_option/0">exec_daemon_option()</a> for the details.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p>An old, discouraged and undocumented way of installing an alternative
evaluator exists.</p><p>It still works, but lacks for example I/O possibility. It is because of that
compatibility we need the <code class="inline">{direct,...}</code> construction.</p></section><h2 id="sftp-server" class="section-heading"><a href="#sftp-server" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">SFTP Server</span></h2><p>Start the Erlang <code class="inline">ssh</code> daemon with the SFTP subsystem:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="8290302832-1">(</span><span class="p" data-group-id="8290302832-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
2&gt; </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">daemon</span><span class="p" data-group-id="8290302832-2">(</span><span class="mi">8989</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8290302832-3">[</span><span class="p" data-group-id="8290302832-4">{</span><span class="ss">system_dir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/ssh_daemon&quot;</span><span class="p" data-group-id="8290302832-4">}</span><span class="p">,</span><span class="w">
                     </span><span class="p" data-group-id="8290302832-5">{</span><span class="ss">user_dir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/otptest_user/.ssh&quot;</span><span class="p" data-group-id="8290302832-5">}</span><span class="p">,</span><span class="w">
                     </span><span class="p" data-group-id="8290302832-6">{</span><span class="ss">subsystems</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8290302832-7">[</span><span class="nc">ssh_sftpd</span><span class="p">:</span><span class="nf">subsystem_spec</span><span class="p" data-group-id="8290302832-8">(</span><span class="w">
                                            </span><span class="p" data-group-id="8290302832-9">[</span><span class="p" data-group-id="8290302832-10">{</span><span class="ss">cwd</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/sftp/example&quot;</span><span class="p" data-group-id="8290302832-10">}</span><span class="p" data-group-id="8290302832-9">]</span><span class="p" data-group-id="8290302832-8">)</span><span class="w">
                                  </span><span class="p" data-group-id="8290302832-7">]</span><span class="p" data-group-id="8290302832-6">}</span><span class="p" data-group-id="8290302832-3">]</span><span class="p" data-group-id="8290302832-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="8290302832-11">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.54</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="8290302832-11">}</span><span class="w">
</span><span class="mi">3</span><span class="o">&gt;</span></code></pre><p>Run the OpenSSH SFTP client:</p><pre><code class="text">$bash&gt; sftp -oPort=8989 -o IdentityFile=/tmp/otptest_user/.ssh/id_rsa \
            -o UserKnownHostsFile=/tmp/otptest_user/.ssh/known_hosts ssh.example.com
Connecting to ssh.example.com...
sftp&gt; pwd
Remote working directory: /tmp/sftp/example
sftp&gt;</code></pre><h2 id="sftp-client" class="section-heading"><a href="#sftp-client" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">SFTP Client</span></h2><p>Fetch a file with the Erlang SFTP client:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="5155597087-1">(</span><span class="p" data-group-id="5155597087-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
2&gt; </span><span class="p" data-group-id="5155597087-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelPid</span><span class="p">,</span><span class="w"> </span><span class="n">Connection</span><span class="p" data-group-id="5155597087-2">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_sftp</span><span class="p">:</span><span class="nf">start_channel</span><span class="p" data-group-id="5155597087-3">(</span><span class="s">&quot;ssh.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5155597087-4">[</span><span class="p" data-group-id="5155597087-4">]</span><span class="p" data-group-id="5155597087-3">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="5155597087-5">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.57</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.51</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="5155597087-5">}</span><span class="gp unselectable">
3&gt; </span><span class="nc">ssh_sftp</span><span class="p">:</span><span class="nf">read_file</span><span class="p" data-group-id="5155597087-6">(</span><span class="n">ChannelPid</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/home/otptest/test.txt&quot;</span><span class="p" data-group-id="5155597087-6">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="5155597087-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="5155597087-8">&lt;&lt;</span><span class="s">&quot;This is a test file\n&quot;</span><span class="p" data-group-id="5155597087-8">&gt;&gt;</span><span class="p" data-group-id="5155597087-7">}</span></code></pre><h2 id="sftp-client-with-tar-compression" class="section-heading"><a href="#sftp-client-with-tar-compression" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">SFTP Client with TAR Compression</span></h2><h3 id="basic-example" class="section-heading"><a href="#basic-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Basic example</span></h3><p>This is an example of writing and then reading a tar file:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="1312310227-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="n">HandleWrite</span><span class="p" data-group-id="1312310227-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_sftp</span><span class="p">:</span><span class="nf">open_tar</span><span class="p" data-group-id="1312310227-2">(</span><span class="n">ChannelPid</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="ss">tar_file_name</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1312310227-3">[</span><span class="ss">write</span><span class="p" data-group-id="1312310227-3">]</span><span class="p" data-group-id="1312310227-2">)</span><span class="p">,</span><span class="w">
</span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erl_tar</span><span class="p">:</span><span class="nf">add</span><span class="p" data-group-id="1312310227-4">(</span><span class="n">HandleWrite</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w"> </span><span class="p" data-group-id="1312310227-4">)</span><span class="p">,</span><span class="w">
</span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erl_tar</span><span class="p">:</span><span class="nf">add</span><span class="p" data-group-id="1312310227-5">(</span><span class="n">HandleWrite</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w"> </span><span class="p" data-group-id="1312310227-5">)</span><span class="p">,</span><span class="w">
</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erl_tar</span><span class="p">:</span><span class="nf">add</span><span class="p" data-group-id="1312310227-6">(</span><span class="n">HandleWrite</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w"> </span><span class="p" data-group-id="1312310227-6">)</span><span class="p">,</span><span class="w">
</span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erl_tar</span><span class="p">:</span><span class="nf">close</span><span class="p" data-group-id="1312310227-7">(</span><span class="n">HandleWrite</span><span class="p" data-group-id="1312310227-7">)</span><span class="p">,</span><span class="w">

</span><span class="c1">%% And for reading</span><span class="w">
</span><span class="p" data-group-id="1312310227-8">{</span><span class="ss">ok</span><span class="p">,</span><span class="n">HandleRead</span><span class="p" data-group-id="1312310227-8">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_sftp</span><span class="p">:</span><span class="nf">open_tar</span><span class="p" data-group-id="1312310227-9">(</span><span class="n">ChannelPid</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="ss">tar_file_name</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1312310227-10">[</span><span class="ss">read</span><span class="p" data-group-id="1312310227-10">]</span><span class="p" data-group-id="1312310227-9">)</span><span class="p">,</span><span class="w">
</span><span class="p" data-group-id="1312310227-11">{</span><span class="ss">ok</span><span class="p">,</span><span class="n">NameValueList</span><span class="p" data-group-id="1312310227-11">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erl_tar</span><span class="p">:</span><span class="nf">extract</span><span class="p" data-group-id="1312310227-12">(</span><span class="n">HandleRead</span><span class="p">,</span><span class="p" data-group-id="1312310227-13">[</span><span class="nb">memory</span><span class="p" data-group-id="1312310227-13">]</span><span class="p" data-group-id="1312310227-12">)</span><span class="p">,</span><span class="w">
</span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erl_tar</span><span class="p">:</span><span class="nf">close</span><span class="p" data-group-id="1312310227-14">(</span><span class="n">HandleRead</span><span class="p" data-group-id="1312310227-14">)</span><span class="p">,</span></code></pre><h3 id="example-with-encryption" class="section-heading"><a href="#example-with-encryption" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example with encryption</span></h3><p>The previous <a href="using_ssh.html#basic-example">Basic example</a> can be extended with
encryption and decryption as follows:</p><pre><code class="makeup erlang" translate="no"><span class="c1">%% First three parameters depending on which crypto type we select:</span><span class="w">
</span><span class="n">Key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8828378339-1">&lt;&lt;</span><span class="s">&quot;This is a 256 bit key. abcdefghi&quot;</span><span class="p" data-group-id="8828378339-1">&gt;&gt;</span><span class="p">,</span><span class="w">
</span><span class="n">Ivec0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">crypto</span><span class="p">:</span><span class="nf">strong_rand_bytes</span><span class="p" data-group-id="8828378339-2">(</span><span class="mi">16</span><span class="p" data-group-id="8828378339-2">)</span><span class="p">,</span><span class="w">
</span><span class="n">DataSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w">  </span><span class="c1">% DataSize rem 16 = 0 for aes_cbc</span><span class="w">

</span><span class="c1">%% Initialization of the CryptoState, in this case it is the Ivector.</span><span class="w">
</span><span class="n">InitFun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="8828378339-3">(</span><span class="p" data-group-id="8828378339-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="8828378339-4">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Ivec0</span><span class="p">,</span><span class="w"> </span><span class="n">DataSize</span><span class="p" data-group-id="8828378339-4">}</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">

</span><span class="c1">%% How to encrypt:</span><span class="w">
</span><span class="n">EncryptFun</span><span class="w"> </span><span class="o">=</span><span class="w">
    </span><span class="nf">fun</span><span class="p" data-group-id="8828378339-5">(</span><span class="n">PlainBin</span><span class="p">,</span><span class="n">Ivec</span><span class="p" data-group-id="8828378339-5">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
        </span><span class="n">EncryptedBin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">crypto</span><span class="p">:</span><span class="nf">block_encrypt</span><span class="p" data-group-id="8828378339-6">(</span><span class="ss">aes_cbc256</span><span class="p">,</span><span class="w"> </span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="n">Ivec</span><span class="p">,</span><span class="w"> </span><span class="n">PlainBin</span><span class="p" data-group-id="8828378339-6">)</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="8828378339-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">EncryptedBin</span><span class="p">,</span><span class="w"> </span><span class="nc">crypto</span><span class="p">:</span><span class="nf">next_iv</span><span class="p" data-group-id="8828378339-8">(</span><span class="ss">aes_cbc</span><span class="p">,</span><span class="n">EncryptedBin</span><span class="p" data-group-id="8828378339-8">)</span><span class="p" data-group-id="8828378339-7">}</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">

</span><span class="c1">%% What to do with the very last block:</span><span class="w">
</span><span class="n">CloseFun</span><span class="w"> </span><span class="o">=</span><span class="w">
    </span><span class="nf">fun</span><span class="p" data-group-id="8828378339-9">(</span><span class="n">PlainBin</span><span class="p">,</span><span class="w"> </span><span class="n">Ivec</span><span class="p" data-group-id="8828378339-9">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
        </span><span class="n">EncryptedBin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">crypto</span><span class="p">:</span><span class="nf">block_encrypt</span><span class="p" data-group-id="8828378339-10">(</span><span class="ss">aes_cbc256</span><span class="p">,</span><span class="w"> </span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="n">Ivec</span><span class="p">,</span><span class="w">
                                            </span><span class="nf">pad</span><span class="p" data-group-id="8828378339-11">(</span><span class="mi">16</span><span class="p">,</span><span class="n">PlainBin</span><span class="p" data-group-id="8828378339-11">)</span><span class="w"> </span><span class="c1">%% Last chunk</span><span class="w">
                                           </span><span class="p" data-group-id="8828378339-10">)</span><span class="p">,</span><span class="w">
       </span><span class="p" data-group-id="8828378339-12">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">EncryptedBin</span><span class="p" data-group-id="8828378339-12">}</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">

</span><span class="n">Cw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8828378339-13">{</span><span class="n">InitFun</span><span class="p">,</span><span class="n">EncryptFun</span><span class="p">,</span><span class="n">CloseFun</span><span class="p" data-group-id="8828378339-13">}</span><span class="p">,</span><span class="w">
</span><span class="p" data-group-id="8828378339-14">{</span><span class="ss">ok</span><span class="p">,</span><span class="n">HandleWrite</span><span class="p" data-group-id="8828378339-14">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_sftp</span><span class="p">:</span><span class="nf">open_tar</span><span class="p" data-group-id="8828378339-15">(</span><span class="n">ChannelPid</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="ss">tar_file_name</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8828378339-16">[</span><span class="ss">write</span><span class="p">,</span><span class="p" data-group-id="8828378339-17">{</span><span class="ss">crypto</span><span class="p">,</span><span class="n">Cw</span><span class="p" data-group-id="8828378339-17">}</span><span class="p" data-group-id="8828378339-16">]</span><span class="p" data-group-id="8828378339-15">)</span><span class="p">,</span><span class="w">
</span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erl_tar</span><span class="p">:</span><span class="nf">add</span><span class="p" data-group-id="8828378339-18">(</span><span class="n">HandleWrite</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w"> </span><span class="p" data-group-id="8828378339-18">)</span><span class="p">,</span><span class="w">
</span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erl_tar</span><span class="p">:</span><span class="nf">add</span><span class="p" data-group-id="8828378339-19">(</span><span class="n">HandleWrite</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w"> </span><span class="p" data-group-id="8828378339-19">)</span><span class="p">,</span><span class="w">
</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erl_tar</span><span class="p">:</span><span class="nf">add</span><span class="p" data-group-id="8828378339-20">(</span><span class="n">HandleWrite</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w"> </span><span class="p" data-group-id="8828378339-20">)</span><span class="p">,</span><span class="w">
</span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erl_tar</span><span class="p">:</span><span class="nf">close</span><span class="p" data-group-id="8828378339-21">(</span><span class="n">HandleWrite</span><span class="p" data-group-id="8828378339-21">)</span><span class="p">,</span><span class="w">

</span><span class="c1">%% And for decryption (in this crypto example we could use the same InitFun</span><span class="w">
</span><span class="c1">%% as for encryption):</span><span class="w">
</span><span class="n">DecryptFun</span><span class="w"> </span><span class="o">=</span><span class="w">
    </span><span class="nf">fun</span><span class="p" data-group-id="8828378339-22">(</span><span class="n">EncryptedBin</span><span class="p">,</span><span class="n">Ivec</span><span class="p" data-group-id="8828378339-22">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
        </span><span class="n">PlainBin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">crypto</span><span class="p">:</span><span class="nf">block_decrypt</span><span class="p" data-group-id="8828378339-23">(</span><span class="ss">aes_cbc256</span><span class="p">,</span><span class="w"> </span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="n">Ivec</span><span class="p">,</span><span class="w"> </span><span class="n">EncryptedBin</span><span class="p" data-group-id="8828378339-23">)</span><span class="p">,</span><span class="w">
       </span><span class="p" data-group-id="8828378339-24">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">PlainBin</span><span class="p">,</span><span class="w"> </span><span class="nc">crypto</span><span class="p">:</span><span class="nf">next_iv</span><span class="p" data-group-id="8828378339-25">(</span><span class="ss">aes_cbc</span><span class="p">,</span><span class="n">EncryptedBin</span><span class="p" data-group-id="8828378339-25">)</span><span class="p" data-group-id="8828378339-24">}</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">

</span><span class="n">Cr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8828378339-26">{</span><span class="n">InitFun</span><span class="p">,</span><span class="n">DecryptFun</span><span class="p" data-group-id="8828378339-26">}</span><span class="p">,</span><span class="w">
</span><span class="p" data-group-id="8828378339-27">{</span><span class="ss">ok</span><span class="p">,</span><span class="n">HandleRead</span><span class="p" data-group-id="8828378339-27">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_sftp</span><span class="p">:</span><span class="nf">open_tar</span><span class="p" data-group-id="8828378339-28">(</span><span class="n">ChannelPid</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="ss">tar_file_name</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8828378339-29">[</span><span class="ss">read</span><span class="p">,</span><span class="p" data-group-id="8828378339-30">{</span><span class="ss">crypto</span><span class="p">,</span><span class="n">Cr</span><span class="p" data-group-id="8828378339-30">}</span><span class="p" data-group-id="8828378339-29">]</span><span class="p" data-group-id="8828378339-28">)</span><span class="p">,</span><span class="w">
</span><span class="p" data-group-id="8828378339-31">{</span><span class="ss">ok</span><span class="p">,</span><span class="n">NameValueList</span><span class="p" data-group-id="8828378339-31">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erl_tar</span><span class="p">:</span><span class="nf">extract</span><span class="p" data-group-id="8828378339-32">(</span><span class="n">HandleRead</span><span class="p">,</span><span class="p" data-group-id="8828378339-33">[</span><span class="nb">memory</span><span class="p" data-group-id="8828378339-33">]</span><span class="p" data-group-id="8828378339-32">)</span><span class="p">,</span><span class="w">
</span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erl_tar</span><span class="p">:</span><span class="nf">close</span><span class="p" data-group-id="8828378339-34">(</span><span class="n">HandleRead</span><span class="p" data-group-id="8828378339-34">)</span><span class="p">,</span></code></pre><p><a href="" id="usersguide_creating_a_subsystem"></a></p><h2 id="creating-a-subsystem" class="section-heading"><a href="#creating-a-subsystem" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Creating a Subsystem</span></h2><p>A small <code class="inline">ssh</code> subsystem that echoes N bytes can be implemented as shown in the
following example:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7330519721-1">(</span><span class="ss">ssh_echo_server</span><span class="p" data-group-id="7330519721-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">behaviour</span><span class="p" data-group-id="7330519721-2">(</span><span class="ss">ssh_server_channel</span><span class="p" data-group-id="7330519721-2">)</span><span class="p">.</span><span class="w"> </span><span class="c1">% replaces ssh_daemon_channel</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7330519721-3">(</span><span class="ss">state</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7330519721-4">{</span><span class="w">
	  </span><span class="ss">n</span><span class="p">,</span><span class="w">
	  </span><span class="ss">id</span><span class="p">,</span><span class="w">
	  </span><span class="ss">cm</span><span class="w">
	 </span><span class="p" data-group-id="7330519721-4">}</span><span class="p" data-group-id="7330519721-3">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7330519721-5">(</span><span class="p" data-group-id="7330519721-6">[</span><span class="ss">init</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">handle_msg</span><span class="p">/</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">handle_ssh_msg</span><span class="p">/</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">terminate</span><span class="p">/</span><span class="mi">2</span><span class="p" data-group-id="7330519721-6">]</span><span class="p" data-group-id="7330519721-5">)</span><span class="p">.</span><span class="w">

</span><span class="nf">init</span><span class="p" data-group-id="7330519721-7">(</span><span class="p" data-group-id="7330519721-8">[</span><span class="n">N</span><span class="p" data-group-id="7330519721-8">]</span><span class="p" data-group-id="7330519721-7">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7330519721-9">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">state</span><span class="p" data-group-id="7330519721-10">{</span><span class="ss">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="p" data-group-id="7330519721-10">}</span><span class="p" data-group-id="7330519721-9">}</span><span class="p">.</span><span class="w">

</span><span class="nf">handle_msg</span><span class="p" data-group-id="7330519721-11">(</span><span class="p" data-group-id="7330519721-12">{</span><span class="ss">ssh_channel_up</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="n">ConnectionManager</span><span class="p" data-group-id="7330519721-12">}</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p" data-group-id="7330519721-11">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7330519721-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="o">#</span><span class="ss">state</span><span class="p" data-group-id="7330519721-14">{</span><span class="ss">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w">
		     </span><span class="ss">cm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConnectionManager</span><span class="p" data-group-id="7330519721-14">}</span><span class="p" data-group-id="7330519721-13">}</span><span class="p">.</span><span class="w">

</span><span class="nf">handle_ssh_msg</span><span class="p" data-group-id="7330519721-15">(</span><span class="p" data-group-id="7330519721-16">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="w"> </span><span class="n">CM</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7330519721-17">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7330519721-17">}</span><span class="p" data-group-id="7330519721-16">}</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">state</span><span class="p" data-group-id="7330519721-18">{</span><span class="ss">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="p" data-group-id="7330519721-18">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">State</span><span class="p" data-group-id="7330519721-15">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">size</span><span class="p" data-group-id="7330519721-19">(</span><span class="n">Data</span><span class="p" data-group-id="7330519721-19">)</span><span class="p">,</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">of</span><span class="w">
	</span><span class="ss">true</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
	   </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7330519721-20">(</span><span class="n">CM</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7330519721-20">)</span><span class="p">,</span><span class="w">
	   </span><span class="p" data-group-id="7330519721-21">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="o">#</span><span class="ss">state</span><span class="p" data-group-id="7330519721-22">{</span><span class="ss">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="p" data-group-id="7330519721-22">}</span><span class="p" data-group-id="7330519721-21">}</span><span class="p">;</span><span class="w">
	</span><span class="ss">false</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
	   </span><span class="p" data-group-id="7330519721-23">&lt;&lt;</span><span class="n">SendData</span><span class="p">:</span><span class="n">N</span><span class="o">/</span><span class="ss">binary</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="o">/</span><span class="ss">binary</span><span class="p" data-group-id="7330519721-23">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="p">,</span><span class="w">
           </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7330519721-24">(</span><span class="n">CM</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="n">SendData</span><span class="p" data-group-id="7330519721-24">)</span><span class="p">,</span><span class="w">
           </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">send_eof</span><span class="p" data-group-id="7330519721-25">(</span><span class="n">CM</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p" data-group-id="7330519721-25">)</span><span class="p">,</span><span class="w">
	   </span><span class="p" data-group-id="7330519721-26">{</span><span class="ss">stop</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p" data-group-id="7330519721-26">}</span><span class="w">
    </span><span class="k">end</span><span class="p">;</span><span class="w">
</span><span class="nf">handle_ssh_msg</span><span class="p" data-group-id="7330519721-27">(</span><span class="p" data-group-id="7330519721-28">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">ConnectionManager</span><span class="p">,</span><span class="w">
		</span><span class="p" data-group-id="7330519721-29">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7330519721-29">}</span><span class="p" data-group-id="7330519721-28">}</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p" data-group-id="7330519721-27">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">error_logger</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7330519721-30">(</span><span class="ss">standard_error</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; </span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7330519721-31">[</span><span class="nf">binary_to_list</span><span class="p" data-group-id="7330519721-32">(</span><span class="n">Data</span><span class="p" data-group-id="7330519721-32">)</span><span class="p" data-group-id="7330519721-31">]</span><span class="p" data-group-id="7330519721-30">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7330519721-33">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p" data-group-id="7330519721-33">}</span><span class="p">;</span><span class="w">

</span><span class="nf">handle_ssh_msg</span><span class="p" data-group-id="7330519721-34">(</span><span class="p" data-group-id="7330519721-35">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">ConnectionManager</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7330519721-36">{</span><span class="ss">eof</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">ChannelId</span><span class="p" data-group-id="7330519721-36">}</span><span class="p" data-group-id="7330519721-35">}</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p" data-group-id="7330519721-34">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7330519721-37">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p" data-group-id="7330519721-37">}</span><span class="p">;</span><span class="w">

</span><span class="nf">handle_ssh_msg</span><span class="p" data-group-id="7330519721-38">(</span><span class="p" data-group-id="7330519721-39">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7330519721-40">{</span><span class="ss">signal</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p" data-group-id="7330519721-40">}</span><span class="p" data-group-id="7330519721-39">}</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p" data-group-id="7330519721-38">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% Ignore signals according to RFC 4254 section 6.9.</span><span class="w">
    </span><span class="p" data-group-id="7330519721-41">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p" data-group-id="7330519721-41">}</span><span class="p">;</span><span class="w">

</span><span class="nf">handle_ssh_msg</span><span class="p" data-group-id="7330519721-42">(</span><span class="p" data-group-id="7330519721-43">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7330519721-44">{</span><span class="ss">exit_signal</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p" data-group-id="7330519721-44">}</span><span class="p" data-group-id="7330519721-43">}</span><span class="p">,</span><span class="w">
	       </span><span class="n">State</span><span class="p" data-group-id="7330519721-42">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7330519721-45">{</span><span class="ss">stop</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w">  </span><span class="n">State</span><span class="p" data-group-id="7330519721-45">}</span><span class="p">;</span><span class="w">

</span><span class="nf">handle_ssh_msg</span><span class="p" data-group-id="7330519721-46">(</span><span class="p" data-group-id="7330519721-47">{</span><span class="ss">ssh_cm</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7330519721-48">{</span><span class="ss">exit_status</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Status</span><span class="p" data-group-id="7330519721-48">}</span><span class="p" data-group-id="7330519721-47">}</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p" data-group-id="7330519721-46">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7330519721-49">{</span><span class="ss">stop</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p" data-group-id="7330519721-49">}</span><span class="p">.</span><span class="w">

</span><span class="nf">terminate</span><span class="p" data-group-id="7330519721-50">(</span><span class="p">_</span><span class="n">Reason</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">State</span><span class="p" data-group-id="7330519721-50">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span></code></pre><p>The subsystem can be run on the host <strong>ssh.example.com</strong> with the generated keys, as
described in Section
<a href="using_ssh.html#running-an-erlang-ssh-daemon">Running an Erlang ssh Daemon</a>:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="0305004635-1">(</span><span class="p" data-group-id="0305004635-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
2&gt; </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">daemon</span><span class="p" data-group-id="0305004635-2">(</span><span class="mi">8989</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0305004635-3">[</span><span class="p" data-group-id="0305004635-4">{</span><span class="ss">system_dir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/ssh_daemon&quot;</span><span class="p" data-group-id="0305004635-4">}</span><span class="p">,</span><span class="w">
                     </span><span class="p" data-group-id="0305004635-5">{</span><span class="ss">user_dir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/otptest_user/.ssh&quot;</span><span class="p" data-group-id="0305004635-5">}</span><span class="w">
                     </span><span class="p" data-group-id="0305004635-6">{</span><span class="ss">subsystems</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0305004635-7">[</span><span class="p" data-group-id="0305004635-8">{</span><span class="s">&quot;echo_n&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0305004635-9">{</span><span class="ss">ssh_echo_server</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0305004635-10">[</span><span class="mi">10</span><span class="p" data-group-id="0305004635-10">]</span><span class="p" data-group-id="0305004635-9">}</span><span class="p" data-group-id="0305004635-8">}</span><span class="p" data-group-id="0305004635-7">]</span><span class="p" data-group-id="0305004635-6">}</span><span class="p" data-group-id="0305004635-3">]</span><span class="p" data-group-id="0305004635-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="0305004635-11">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.54</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="0305004635-11">}</span><span class="w">
</span><span class="mi">3</span><span class="o">&gt;</span></code></pre><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="3417018928-1">(</span><span class="p" data-group-id="3417018928-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
2&gt; </span><span class="p" data-group-id="3417018928-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ConnectionRef</span><span class="p" data-group-id="3417018928-2">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="3417018928-3">(</span><span class="s">&quot;ssh.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">8989</span><span class="p">,</span><span class="w">
                                    </span><span class="p" data-group-id="3417018928-4">[</span><span class="p" data-group-id="3417018928-5">{</span><span class="ss">user_dir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/otptest_user/.ssh&quot;</span><span class="p" data-group-id="3417018928-5">}</span><span class="p" data-group-id="3417018928-4">]</span><span class="p" data-group-id="3417018928-3">)</span><span class="p">.</span><span class="w">
 </span><span class="p" data-group-id="3417018928-6">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.57</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="3417018928-6">}</span><span class="gp unselectable">
3&gt; </span><span class="p" data-group-id="3417018928-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p" data-group-id="3417018928-7">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">session_channel</span><span class="p" data-group-id="3417018928-8">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="3417018928-8">)</span><span class="p">.</span><span class="gp unselectable">
4&gt; </span><span class="ss">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">subsystem</span><span class="p" data-group-id="3417018928-9">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;echo_n&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="3417018928-9">)</span><span class="p">.</span><span class="gp unselectable">
5&gt; </span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="3417018928-10">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0123456789&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="3417018928-10">)</span><span class="p">.</span><span class="gp unselectable">
6&gt; </span><span class="nf">flush</span><span class="p" data-group-id="3417018928-11">(</span><span class="p" data-group-id="3417018928-11">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="3417018928-12">{</span><span class="ss">ssh_msg</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="mf">0.57</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3417018928-13">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0123456789&quot;</span><span class="p" data-group-id="3417018928-13">}</span><span class="p" data-group-id="3417018928-12">}</span><span class="w">
</span><span class="p" data-group-id="3417018928-14">{</span><span class="ss">ssh_msg</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="mf">0.57</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3417018928-15">{</span><span class="ss">eof</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="3417018928-15">}</span><span class="p" data-group-id="3417018928-14">}</span><span class="w">
</span><span class="p" data-group-id="3417018928-16">{</span><span class="ss">ssh_msg</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="mf">0.57</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3417018928-17">{</span><span class="ss">closed</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="3417018928-17">}</span><span class="p" data-group-id="3417018928-16">}</span><span class="gp unselectable">
7&gt; </span><span class="p" data-group-id="3417018928-18">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="ss">closed</span><span class="p" data-group-id="3417018928-18">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssh_connection</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="3417018928-19">(</span><span class="n">ConnectionRef</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelId</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;10&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="3417018928-19">)</span><span class="p">.</span></code></pre><p>See also <a href="ssh_client_channel.html"><code class="inline">ssh_client_channel</code></a> (replaces ssh_channel(3)).</p>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="introduction.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
SSH Protocol Introduction
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="terminology.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Terminology
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="ssh.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright © 1996-2025 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js"></script>
  <script>
  let initialized = false;

  window.addEventListener("exdoc:loaded", () => {
      if (!initialized) {
      mermaid.initialize({
          startOnLoad: false,
          theme: document.body.className.includes("dark") ? "dark" : "default"
      });
      initialized = true;
      }

      let id = 0;
      for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
          graphEl.innerHTML = svg;
          bindFunctions?.(graphEl);
          preEl.insertAdjacentElement("afterend", graphEl);
          preEl.remove();
      });
      }
  });
  </script>

  </body>
</html>
