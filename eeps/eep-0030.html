<!DOCTYPE html>
<html lang="en">



<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Allow pinning of website on windows -->
    <meta name="application-name" content="Erlang.org">
    <meta name="msapplication-tooltip" content="The official home of the Erlang Programming Language">
    <meta name="msapplication-starturl" content="/" >

    <!-- Make the site look nicer on facebook -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Erlang.org">
    <meta property="og:title" content="Welcome to Erlang.org">
    <meta property="og:description" content="The official home of the Erlang Programming Language">
    <meta property="og:image" content="https://beta.erlang.org/assets/img/erlang-228x200.png">
    <meta property="og:image:secure_url" content="https://beta.erlang.org/assets/img/erlang-228x200.png">
    <meta property="og:url" content="https://beta.erlang.org/">

    <!-- Twitter metadata -->
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Index" />
    <meta name="twitter:site" content="@erlang_org" />

    <!-- Rich data for google search -->
    <script type="application/ld+json">
{"@type":"WebSite","url":"https://erlang.org/","headline":"Eep 0030 - Erlang/OTP","name":"Erlang.org","sameAs":["https://twitter.com/erlang_org","https://github.com/erlang/otp"],"@context":"https://schema.org"}</script>

    <title>Eep 0030 - Erlang/OTP</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- tells iOS browsers to not show telephone numbers as links -->
    <meta name="format-detection" content="telephone=no">

    <meta name="application-name" content="Erlang.org">
    <meta name="description" content="The official home of the Erlang Programming Language">
    <meta name="keywords" content="Erlang programming language functional parallel distributed documentation download community">
    <!-- https://www.rssboard.org/rss-autodiscovery -->
    <link rel="alternate" type="application/atom+xml" title="News Atom Feed" href="https://beta.erlang.org/news.xml" />
    <link rel="alternate" type="application/atom+xml" title="Blog Atom Feed" href="https://beta.erlang.org/blog.xml" />
    
    <link rel="stylesheet" href="/assets/css/main.css">
</head>

<body>
    <header class="navbar navbar-expand-lg navbar-light bg-body">
        <nav class="container">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="/"><img
                    src="/assets/img/erlang.png" class="img-fluid" width="60" alt="Erlang.org main page"/></a>
            <div class="collapse navbar-collapse fw-bold" id="navbarSupportedContent">
                <ul class="navbar-nav text-uppercase me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="/downloads">Download</a></li>
                    <li class="nav-item"><a class="nav-link" href="/docs">Documentation</a></li>
                    <li class="nav-item"><a class="nav-link" href="/community">Community</a></li>
                    <li class="nav-item"><a class="nav-link" href="/news">News</a></li>
                    <li class="nav-item"><a class="nav-link" href="/blog">Blog</a></li>
                    <li class="nav-item"><a class="nav-link" href="/eep">EEP</a></li>
                    <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
                </ul>
                <form class="d-flex" role="search" method="get" action="https://duckduckgo.com/">
                    <input type="hidden" name="sites" value="erlang.org">
                    <input class="form-control me-2" id="searchfield" name="q" type="search" placeholder="Search erlang.org"
                        aria-label="Search">
                    <button class="btn btn-outline-primary" type="submit">Search</button>
                </form>
            </div>
        </nav>
    </header>
    <div class="container border-top pt-4">
    <div class="row-lg">
        <div class="col-lg-10 offset-lg-1">
            <div class="card">
                <div class="card-body">
                    <dl class="mb-0 dl-single">
                        <dt>Author:</dt>
                        <dd>
                            Richard A. O&#39;Keefe &lt;ok(at)cs(dot)otago(dot)ac(dot)nz&gt;
                            
                            
                        </dd>
                        
                        <dt>Status:</dt>
                        <dd>Final/R13A/R14A Proposal is implemented in OTP release R13A and R14A</dd>
                        <dt>Type:</dt>
                        <dd>Standards Track</dd>
                        
                        
                        <dt>Created:</dt>
                        <dd>10-Jul-2008</dd>
                        
                        <dt>Erlang-Version:</dt>
                        <dd>R12B-4</dd>
                        
                        
                        
                        
                    </dl>
                </div>
            </div>
            <div class="border-top mt-4">
                
                <h2 id="eep-30-maximum-and-minimum">
        
        
          EEP 30: Maximum and Minimum <a href="#eep-30-maximum-and-minimum">#</a>
        
        
      </h2>
    
      <h1 id="abstract">
        
        
          Abstract <a href="#abstract">#</a>
        
        
      </h1>
    

<p>Add maximum and minimum core functions.</p>
      <h1 id="specification">
        
        
          Specification <a href="#specification">#</a>
        
        
      </h1>
    

<p>Currently the Erlang language has no built-in support for
the maximum and minimum operations.  So we add new functions</p>

<p><code>erlang:min(E1, E2)</code>  with the same effects and value as</p>

<pre><code class="language-erlang">(T1 = E1, T2 = E2, if T1 &gt; T2 -&gt; T2 ; true -&gt; T1 end)
</code></pre>

<p><code>erlang:max(E1, E2)</code>  with the same effects and value as</p>

<pre><code class="language-erlang">(T1 = E1, T2 = E2, if T1 &gt; T2 -&gt; T1 ; true -&gt; T2 end)
</code></pre>

<p>except that we expect them to be implemented using single VM
instructions, and we expect HiPE to use conditional moves on
machines that have them.</p>

<p>The <code>erlang:</code> module prefix on <code>max/2</code> (respectively <code>min/2</code>) can
be omitted if and only if there is no locally defined <code>max/2</code>
(respectively <code>min/2</code>).</p>
      <h1 id="motivation">
        
        
          Motivation <a href="#motivation">#</a>
        
        
      </h1>
    

<p>Maximum and minimum are extremely useful operations.
The fact that there is no standard way to express them in Erlang
has had the predictable result:  there are definitions of <code>max/2</code>
in <code>tool_utils</code>, <code>tv_pg_gridfcns</code>, <code>tv_pb</code>, <code>tv_comm_func</code>,
<code>ssh_connection_handler</code>, <code>bssh_connection_handler</code>, <code>ssh_cli</code>,
<code>hipe_arm</code>, <code>hipe_schedule</code>, <code>hipe_ultra_prio</code>, <code>hipe_ppc_frame</code>,
<code>?HIPE_X86_FRAME</code> (presumably one each for 32- and 64-bit PCs),
<code>hipe_sparc_frame</code>, <code>erl_recomment</code>, <code>erl_syntax_lib</code>, <code>appmon_info</code>,
oh, the list goes on and on.  There are dozens of copies.
There are nearly as many copies of <code>min/2</code>.  And that’s leaving
aside possible copies with different names.</p>

<p>Not only are the operations useful, they can be implemented
more efficiently by the compiler than by the programmer.
If <code>X &lt; Y</code> can be a VM instruction, so can <code>min</code> and <code>max</code>.
Here’s a first draft implementation:</p>

<pre><code class="language-erlang">OpCase(i_minimum): {
    r(0) = CMP_GT(tmp_arg1, tmp_arg2)) ? tmp_arg1 : tmp_arg2;
    Next(1);
}
OpCase(i_maximum): {
    r(0) = CMP_GT(tmp_arg1, tmp_arg2)) ? tmp_arg2 : tmp_arg1;
    Next(1);
}
</code></pre>

<p>Beware: untested code!  Amongst other things, I don’t know all the
places that need to be updated, or how, when new instructions are
added.  These instructions are intended to be preceded by an
<code>i_fetch</code> instruction the way &lt; and its other friends are.</p>

<p>This is much cheaper than an Erlang function call, and it’s much
easier for HiPE to recognise when a maximum or minimum of two
floating point numbers is involved and can be turned into a
compare and a conditional move.</p>

<p>The most important thing is the barrier to thought that is
removed.  When I’m writing Fortran, I know that max and min have
been there for decades, and I use those operations freely.
When I’m writing C, I know that those operations are not there,
and that there are problems with the conventional macros, so
I avoid them.  As an experiment, I added max() and min() functions
to the version of AWK that I maintain.  It was easy, and the
result is that I now have a lot of AWK code that can’t be run by
anything else, because the operations are so handy.  Erlang has
no <em>documented</em> maximum or minimum functions other than those in
the <code>lists</code> module, and writing <code>lists:max([X,Y])</code> is sufficiently
painful to deter all but the most determined.</p>
      <h1 id="rationale">
        
        
          Rationale <a href="#rationale">#</a>
        
        
      </h1>
    

<p>Function or operator?</p>

<p>I believe that there are excellent reasons to use the standard
<code>/\</code> and <code>\/</code> symbols from <a href="http://mathworld.wolfram.com/Lattice.html" title="Lattice Algebra">lattice</a> theory.  However, discussion in
the EEPs mailing list showed that the community was divided
into</p>

<ul>
  <li>people who were familiar with the operators</li>
  <li>people who insisted that they were only Boolean operators</li>
  <li>people who didn’t get them at all because they weren’t C.</li>
</ul>

<p>The ready availability of the operations as a standard part of
the language is much more important than what they are called,
so the second draft of this EEP switched to built in functions
in order to increase acceptance.</p>

<p>The argument which finally settled it for me was the
internationalisation one:  Japanese programmers may be using
keyboards where <code>\</code> means or screens where <code>\</code> displays as Yen,
so <code>/\</code> and <code>\/</code> just won’t work for them.</p>

<p>We cannot use <code>max</code> and <code>min</code> as operators because the compiler
will not let you use a symbol as both an operator and a function
name, and there are lots and lots of uses of <code>max</code> and <code>min</code> as
function names.  That’s precisely the problem we’re trying to
address here.  So they have to be function names.</p>

<p>There is no great difficulty in adding new functions to the
<code>erlang:</code> module.</p>

<p>I don’t want to write the <code>erlang:</code> prefix here.  There is
nothing new in making the <code>erlang:</code> prefix for some functions
optional either.</p>

<p>What we want is for existing modules with their own definitions
of <code>max/2</code> and/or <code>min/2</code> to remain legal, and then to be upgraded
simply by removing the redundant definitions.</p>

<p>Imagine that you want to find the bounding box for a set
of 2D points.  (This is adapted from code in Wings3D.)</p>

<pre><code class="language-erlang">bounding_box([{X0,Y0}|Pts]) -&gt;
    bounding_box(Pts, X0,X0, Y0,Y0).

bounding_box([{X,Y}|Pts], Xlo,Xhi, Ylo,Yhi) -&gt;
    if X &lt; Xlo -&gt; Xlo1 = X,   Xhi1 = Xhi
     ; X &gt; Xhi -&gt; Xlo1 = Xlo, Xhi1 = X
     ; true    -&gt; Xlo1 = Xlo, Xhi1 = Xhi
    end,
    if Y &lt; Ylo -&gt; Ylo1 = Y,   Yhi1 = Yhi
     ; Y &gt; Yhi -&gt; Ylo1 = Ylo, Yhi1 = Y
     ; true    -&gt; Ylo1 = Ylo, Yhi1 = Yhi
    end,
    bounding_box(Pts, Xlo1,Xhi1, Ylo1,Yhi1);
bounding_box([], Xlo,Xhi, Ylo,Yhi) -&gt;
    {{Xlo,Ylo}, {Xhi,Yhi}}.
</code></pre>

<p>With maximum and minimum operators, this becomes</p>

<pre><code class="language-erlang">bounding_box([{X,Y}|Pts], Xlo,Xhi, Ylo,Yhi) -&gt;
    bounding_box(Pts, min(X,Xlo), max(X,Xhi),
              min(Y,Ylo), max(Y,Yhi));
bounding_box([], Xlo,Xhi, Ylo,Yhi) -&gt;
    {{Xlo,Ylo}, {Xhi,Yhi}}.
</code></pre>
      <h1 id="backwards-compatibility">
        
        
          Backwards Compatibility <a href="#backwards-compatibility">#</a>
        
        
      </h1>
    

<p>No issues.  Where a module already has <code>max/2</code> or <code>min/2</code>,
the <code>erlang:</code> prefix is required to get the new function.</p>
      <h1 id="reference-implementation">
        
        
          Reference Implementation <a href="#reference-implementation">#</a>
        
        
      </h1>
    

<p>I don’t understand BEAM or the compiler well enough to
provide one, but the instruction definitions above are
offered as evidence that it should not be hard for those
who do.  If this EEP is accepted I will be happy to write
the documentation for these operators.</p>
      <h1 id="copyright">
        
        
          Copyright <a href="#copyright">#</a>
        
        
      </h1>
    

<p>This document has been placed in the public domain.</p>

            </div>
        </div>
    </div>
</div>
<script src="/assets/js/prismjs/prism.js"></script>
<script src="/assets/js/prismjs/components/prism-erlang.js"></script>
    <footer class="container-fluid footer text-center border-top border-bottom">
        <div>
            <a href="/downloads.html" title="DOWNLOAD"><img src="/assets/img/download.png" alt="Download Erlang/OTP"></a>
        </div>
        <div>
            <a href="http://www.github.com/erlang/otp"><img
                    src="/assets/img/GitHub-Mark-32px.png" alt="Erlang/OTP on Github"></a>
        </div>
        
        <div>
            <a href="http://www.twitter.com/erlang_org"><img src="/assets/img/twitter.png"
                    width="32" alt="Erlang/OTP twitter"></a>
        </div>
    </footer>
    <script src="/assets/js/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>