<!DOCTYPE html>
<html lang="en">



<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Allow pinning of website on windows -->
    <meta name="application-name" content="Erlang.org">
    <meta name="msapplication-tooltip" content="The official home of the Erlang Programming Language">
    <meta name="msapplication-starturl" content="/" >

    <!-- Make the site look nicer on facebook -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Erlang.org">
    <meta property="og:title" content="Welcome to Erlang.org">
    <meta property="og:description" content="The official home of the Erlang Programming Language">
    <meta property="og:image" content="https://beta.erlang.org/assets/img/erlang-228x200.png">
    <meta property="og:image:secure_url" content="https://beta.erlang.org/assets/img/erlang-228x200.png">
    <meta property="og:url" content="https://beta.erlang.org/">

    <!-- Twitter metadata -->
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Index" />
    <meta name="twitter:site" content="@erlang_org" />

    <!-- Rich data for google search -->
    <script type="application/ld+json">
{"@type":"WebSite","url":"https://erlang.org/","headline":"Eep 0016 - Erlang/OTP","name":"Erlang.org","sameAs":["https://twitter.com/erlang_org","https://github.com/erlang/otp"],"@context":"https://schema.org"}</script>

    <title>Eep 0016 - Erlang/OTP</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- tells iOS browsers to not show telephone numbers as links -->
    <meta name="format-detection" content="telephone=no">

    <meta name="application-name" content="Erlang.org">
    <meta name="description" content="The official home of the Erlang Programming Language">
    <meta name="keywords" content="Erlang programming language functional parallel distributed documentation download community">
    <!-- https://www.rssboard.org/rss-autodiscovery -->
    <link rel="alternate" type="application/atom+xml" title="News Atom Feed" href="https://beta.erlang.org/news.xml" />
    <link rel="alternate" type="application/atom+xml" title="Blog Atom Feed" href="https://beta.erlang.org/blog.xml" />
    
    <link rel="stylesheet" href="/assets/css/main.css">
</head>

<body>
    <header class="navbar navbar-expand-lg navbar-light bg-body">
        <nav class="container">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="/"><img
                    src="/assets/img/erlang.png" class="img-fluid" width="60" alt="Erlang.org main page"/></a>
            <div class="collapse navbar-collapse fw-bold" id="navbarSupportedContent">
                <ul class="navbar-nav text-uppercase me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="/downloads">Download</a></li>
                    <li class="nav-item"><a class="nav-link" href="/docs">Documentation</a></li>
                    <li class="nav-item"><a class="nav-link" href="/community">Community</a></li>
                    <li class="nav-item"><a class="nav-link" href="/news">News</a></li>
                    <li class="nav-item"><a class="nav-link" href="/blog">Blog</a></li>
                    <li class="nav-item"><a class="nav-link" href="/eep">EEP</a></li>
                    <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
                </ul>
                <form class="d-flex" role="search" method="get" action="https://duckduckgo.com/">
                    <input type="hidden" name="sites" value="erlang.org">
                    <input class="form-control me-2" id="searchfield" name="q" type="search" placeholder="Search erlang.org"
                        aria-label="Search">
                    <button class="btn btn-outline-primary" type="submit">Search</button>
                </form>
            </div>
        </nav>
    </header>
    <div class="container border-top pt-4">
    <div class="row-lg">
        <div class="col-lg-10 offset-lg-1">
            <div class="card">
                <div class="card-body">
                    <dl class="mb-0 dl-single">
                        <dt>Author:</dt>
                        <dd>
                            Richard A. O&#39;Keefe &lt;ok(at)cs(dot)otago(dot)ac(dot)nz&gt;
                            
                            
                        </dd>
                        
                        <dt>Status:</dt>
                        <dd>Draft </dd>
                        <dt>Type:</dt>
                        <dd>Standards Track</dd>
                        
                        
                        <dt>Created:</dt>
                        <dd>23-Jul-2008</dd>
                        
                        <dt>Erlang-Version:</dt>
                        <dd>R12B-4</dd>
                        
                        
                        
                        
                    </dl>
                </div>
            </div>
            <div class="border-top mt-4">
                
                <h2 id="eep-16-is_between3">
        
        
          EEP 16: is_between/3 <a href="#eep-16-is_between3">#</a>
        
        
      </h2>
    
      <h1 id="abstract">
        
        
          Abstract <a href="#abstract">#</a>
        
        
      </h1>
    

<p>There should be a new built in function for guards,</p>

<pre><code class="language-erlang">is_between(Term, Lower_Bound, Upper_Bound)
</code></pre>

<p>which succeeds when <code>Term</code>, <code>Lower_Bound</code>, and <code>Upper_Bound</code>
are all integers, and <code>Lower_Bound =&lt; Term =&lt; Upper_Bound</code>.</p>
      <h1 id="specification">
        
        
          Specification <a href="#specification">#</a>
        
        
      </h1>
    

<p>A new guard BIF is added.</p>

<pre><code class="language-erlang">is_between(Term, LB, UB)
</code></pre>

<p>In expression use, if LB or UB is not an integer,
a badarith exception is thrown, just like an attempt to
do remainder or bitwise operations on non-integer arguments.
In guard use, that exception becomes failure.</p>

<p>This is a type test which succeeds (or returns true) if
Term is an integer and lies between LB and UB inclusive,
and fails (or returns false) for other values of Term.</p>

<p>As an expression, it has the same effect as</p>

<pre><code class="language-erlang">( X = Term, Y = LB, Z = UB,
  Y bor Z,
  ( is_integer(X), X &gt;= Y, X =&lt; Z )
)
</code></pre>

<p>where X, Y, and Z are new variables that are not exported.</p>

<p>In particular,</p>

<pre><code class="language-erlang">is_integer(tom, dick, harry)
</code></pre>

<p>should raise an exception, not return false, as <code>is_integer(Term)</code>
is only tested after LB and UB have been found to be integers.</p>

<p>As a guard test, it has the same effect as</p>

<pre><code class="language-erlang">( X = Term, Y = LB, Z = UB,
  is_integer(Y), is_integer(Z), is_integer(X),
  X &gt;= Y, X =&lt; Z
)
</code></pre>

<p>would have, were that allowed.  However, it admits a much
more efficient implementation.</p>
      <h1 id="motivation">
        
        
          Motivation <a href="#motivation">#</a>
        
        
      </h1>
    

<p>Currently some people test whether a variable is a byte thus:</p>

<pre><code class="language-erlang">-define(is_byte(X), (X &gt;= 0 andalso X =&lt; 255)).
</code></pre>

<p>This is actual current practice.  However, it fails to check
that <code>X</code> is an integer, so <code>?is_byte(1.5)</code> succeeds, it may
evaluate <code>X</code> twice, so <code>?is_byte((Pid ! 0))</code> will send two messages,
not the expected one, and the current Erlang compiler generates
noticeably worse code in guards for ‘andalso’ and ‘orelse’ than
it does for ‘,’ and ‘;’.</p>

<p>It is also useful to test whether a subscript is in range,</p>

<pre><code class="language-erlang">-define(in_range(X, T), (X &gt;= 1 andalso X =&lt; size(T))).
</code></pre>

<p>which has similar problems.</p>

<p>Using <code>is_between</code>, we can replace these definitions with</p>

<pre><code class="language-erlang">-define(is_byte(X),     is_between(X, 0, 255)).
-define(in_range(X, T), is_between(X, 1, size(T))).
</code></pre>

<p>which are free of those problems</p>
      <h1 id="rationale">
        
        
          Rationale <a href="#rationale">#</a>
        
        
      </h1>
    

<p>One alternative to this design would be to follow the example
of Common Lisp (and the even earlier example of the systems
programming language on HP 3000s) and allow</p>

<pre><code class="language-erlang">E1 =&lt; E2 =&lt; E3      % (&lt;= E1 E2 E3) in Lisp
</code></pre>

<p>(and possibly also</p>

<pre><code class="language-erlang">E1 =&lt; E2 &lt;  E3
E1 &lt;  E2 =&lt; E3
E1 &lt;  E2 &lt;  E3)     % (&lt;  E1 E2 E3) in Lisp
</code></pre>

<p>as guards and expressions, evaluating each expression exactl
once.  I am very fond of this syntax and would be pleased to
see it.  This would resolve the double evaluation of <code>E2</code>, the
possible non-evaluation of <code>E3</code>, and the inefficiency of ‘andalso’.
However, it would not address the problem that a byte or an
index is not just a NUMBER in a certain range, but an INTEGER.
If Erlang had multiple comparison syntax, there would still be
a use for <code>is_between/3</code>.</p>
      <h1 id="backwards-compatibility">
        
        
          Backwards Compatibility <a href="#backwards-compatibility">#</a>
        
        
      </h1>
    

<p>Code that defines a function named <code>is_between/3</code> will be
affected.  Since the Erlang compiler parses an entire
module before semantic analysis, it’s easy to</p>

<ul>
  <li>check for a definition of <code>is_between/3</code></li>
  <li>warn if one is present</li>
  <li>disable the new built-in in such a case.</li>
</ul>
      <h1 id="reference-implementation">
        
        
          Reference Implementation <a href="#reference-implementation">#</a>
        
        
      </h1>
    

<p>There is none.  However, we can sketch one.
Two new BEAM instructions are required:</p>

<pre><code class="language-erlang">{test,is_between,Lbl,[Src1,Src2,Src3]}
{bif,is_between,?,[Src1,Src2,Src3],Dst}
</code></pre>

<p>The test does</p>

<pre><code class="language-erlang">if Src2 is not an integer, goto Lbl.
if Src3 is not an integer, goto Lbl.
if Src1 is not an integer, goto Lbl.
if Src1 &lt; Src2, goto Lbl.
if Src3 &lt; Src1, goto Lbl.
</code></pre>

<p>The bif does</p>

<pre><code class="language-erlang">if Src2 is not an integer, except!
if Src3 is not an integer, except!
if Src1 is not an integer
or Src1 &lt; Src2
or Src3 &lt; Src1
then move 'false' to Dst
else move 'true'  to Dst.
</code></pre>

<p>Nothing here is fundamentally new, and only my unfamiliarity with
how to add instructions to the emulator prevents me doing it.  And
my total ignorance of how to tell HiPE about them!</p>

<p>There might be some point in having variants of these instructions
for use when Src2 and Src3 are integer literals; I would certainly
expect HiPE to elide redundant tests here.</p>

<p>The compiler would simply recognise <code>is_between/3</code> and emit the
appropriate BEAM rather like it recognises <code>is_atom/1</code>.
My ignorance of how to extend the emulator is exceeded by my
ignorance of how to extend the compiler.  Certainly we’d need</p>

<pre><code class="language-erlang">...
is_bif(erlang, is_between, 3) -&gt; true;
...
is_guard_bif(erlang, is_between, 3) -&gt; true;
...
is_pure(erlang, is_between, 3) -&gt; true;
...
</code></pre>

<p>(but NOT an <code>is_safe</code> rule) in <code>erl_bifs.erl</code>.  Or would we?  I’ve
not been able to figure out where <code>is_guard_bif/3</code> is called.
There will need to be a new entry in genop.tab as well.
Ohhh, <code>erl_internal.erl</code> is in <code>.../stdlib</code>, not <code>.../compiler</code>.
OK, so a couple of functions in <code>erl_internal.erl</code> need to be patched
to recognise <code>is_between/3</code>; what needs changing to generate BEAM?
The annoying thing is that if I knew my way around the compiler,
it would be easier to add this than to write it up.</p>

<p>Here’s some text to go in the documentation:</p>

<blockquote class='blockquote'>
  <pre><code>is_integer(Term, LB, UB) -&gt; bool()

Types:
    Term = term()
    LB = integer()
    UB = integer()
</code></pre>

  <p>Returns true if Term is an integer lying between LB
and UB inclusive (LB =&lt; Term, Term =&lt; UB); otherwise
returns false.  In an expression, raises an exception
if LB or UB is not an integer.  Having UB &lt; LB is not
an error.</p>

  <p>Allowed in guard tests.</p>
</blockquote>
      <h1 id="copyright">
        
        
          Copyright <a href="#copyright">#</a>
        
        
      </h1>
    

<p>This document has been placed in the public domain.</p>

            </div>
        </div>
    </div>
</div>
<script src="/assets/js/prismjs/prism.js"></script>
<script src="/assets/js/prismjs/components/prism-erlang.js"></script>
    <footer class="container-fluid footer text-center border-top border-bottom">
        <div>
            <a href="/downloads.html" title="DOWNLOAD"><img src="/assets/img/download.png" alt="Download Erlang/OTP"></a>
        </div>
        <div>
            <a href="http://www.github.com/erlang/otp"><img
                    src="/assets/img/GitHub-Mark-32px.png" alt="Erlang/OTP on Github"></a>
        </div>
        
        <div>
            <a href="http://www.twitter.com/erlang_org"><img src="/assets/img/twitter.png"
                    width="32" alt="Erlang/OTP twitter"></a>
        </div>
    </footer>
    <script src="/assets/js/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>