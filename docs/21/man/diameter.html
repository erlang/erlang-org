<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:erl="http://erlang.org" xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../otp_doc.css" type="text/css">
<title>Erlang -- diameter(3)</title>
</head>
<body>
<div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../js/erlresolvelinks.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function getWinHeight() {
                var myHeight = 0;
                if( typeof( window.innerHeight ) == 'number' ) {
                  //Non-IE
                  myHeight = window.innerHeight;
                } else if( document.documentElement && ( document.documentElement.clientWidth ||
                                                         document.documentElement.clientHeight ) ) {
                  //IE 6+ in 'standards compliant mode'
                  myHeight = document.documentElement.clientHeight;
                } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
                  //IE 4 compatible
                  myHeight = document.body.clientHeight;
                }
                return myHeight;
              }

              function setscrollpos() {
                var objf=document.getElementById('loadscrollpos');
                 document.getElementById("leftnav").scrollTop = objf.offsetTop - getWinHeight()/2;
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //--></script><div id="leftnav"><div class="innertube">
<div class="erlang-logo-wrapper"><a href="../index.html"><img alt="Erlang Logo" src="../erlang-logo.png" class="erlang-logo"></a></div>
<p class="section-title">Diameter</p>
<p class="section-subtitle">Reference Manual</p>
<p class="section-version">Version 2.2.1</p>
<ul class="panel-sections">
<li><a href="../apps/diameter/users_guide.html">User's Guide</a></li>
<li><a href="../apps/diameter/index.html">Reference Manual</a></li>
<li><a href="../apps/diameter/release_notes.html">Release Notes</a></li>
<li><a href="../apps/diameter/diameter.pdf">PDF</a></li>
<li><a href="../index.html">Top</a></li>
</ul>
<ul class="expand-collapse-items">
<li><a href="javascript:openAllFlips()">Expand All</a></li>
<li><a href="javascript:closeAllFlips()">Contract All</a></li>
</ul>
<h3>Table of Contents</h3>
<ul class="flipMenu">
<li id="loadscrollpos" title="diameter " expanded="true">diameter<ul>
<li><a href="diameter.html">
                  Top of manual page
                </a></li>
    <li title="add_transport-2"><a href="diameter.html#add_transport-2">add_transport/2</a></li>
    <li title="call-4"><a href="diameter.html#call-4">call/4</a></li>
    <li title="origin_state_id-0"><a href="diameter.html#origin_state_id-0">origin_state_id/0</a></li>
    <li title="remove_transport-2"><a href="diameter.html#remove_transport-2">remove_transport/2</a></li>
    <li title="service_info-2"><a href="diameter.html#service_info-2">service_info/2</a></li>
    <li title="services-0"><a href="diameter.html#services-0">services/0</a></li>
    <li title="session_id-1"><a href="diameter.html#session_id-1">session_id/1</a></li>
    <li title="start-0"><a href="diameter.html#start-0">start/0</a></li>
    <li title="start_service-2"><a href="diameter.html#start_service-2">start_service/2</a></li>
    <li title="stop-0"><a href="diameter.html#stop-0">stop/0</a></li>
    <li title="stop_service-1"><a href="diameter.html#stop_service-1">stop_service/1</a></li>
    <li title="subscribe-1"><a href="diameter.html#subscribe-1">subscribe/1</a></li>
    <li title="unsubscribe-1"><a href="diameter.html#unsubscribe-1">unsubscribe/1</a></li>
    </ul>
</li>
<li title="diameterc"><a href="diameterc.html">diameterc</a></li>
<li id="no" title="diameter_app " expanded="false">diameter_app<ul>
<li><a href="diameter_app.html">
                  Top of manual page
                </a></li>
    <li title="Mod:handle_answer-4"><a href="diameter_app.html#Mod:handle_answer-4">Mod:handle_answer/4</a></li>
    <li title="Mod:handle_error-4"><a href="diameter_app.html#Mod:handle_error-4">Mod:handle_error/4</a></li>
    <li title="Mod:handle_request-3"><a href="diameter_app.html#Mod:handle_request-3">Mod:handle_request/3</a></li>
    <li title="Mod:peer_down-3"><a href="diameter_app.html#Mod:peer_down-3">Mod:peer_down/3</a></li>
    <li title="Mod:peer_up-3"><a href="diameter_app.html#Mod:peer_up-3">Mod:peer_up/3</a></li>
    <li title="Mod:pick_peer-4"><a href="diameter_app.html#Mod:pick_peer-4">Mod:pick_peer/4</a></li>
    <li title="Mod:prepare_request-3"><a href="diameter_app.html#Mod:prepare_request-3">Mod:prepare_request/3</a></li>
    <li title="Mod:prepare_retransmit-3"><a href="diameter_app.html#Mod:prepare_retransmit-3">Mod:prepare_retransmit/3</a></li>
    </ul>
</li>
<li id="no" title="diameter_codec " expanded="false">diameter_codec<ul>
<li><a href="diameter_codec.html">
                  Top of manual page
                </a></li>
    <li title="decode-2"><a href="diameter_codec.html#decode-2">decode/2</a></li>
    <li title="encode-2"><a href="diameter_codec.html#encode-2">encode/2</a></li>
    </ul>
</li>
<li title="diameter_dict"><a href="diameter_dict.html">diameter_dict</a></li>
<li id="no" title="diameter_make " expanded="false">diameter_make<ul>
<li><a href="diameter_make.html">
                  Top of manual page
                </a></li>
    <li title="codec-2"><a href="diameter_make.html#codec-2">codec/2</a></li>
    <li title="flatten-1"><a href="diameter_make.html#flatten-1">flatten/1</a></li>
    <li title="format-1"><a href="diameter_make.html#format-1">format/1</a></li>
    <li title="format_error-1"><a href="diameter_make.html#format_error-1">format_error/1</a></li>
    </ul>
</li>
<li id="no" title="diameter_transport " expanded="false">diameter_transport<ul>
<li><a href="diameter_transport.html">
                  Top of manual page
                </a></li>
    <li title="Mod:start-3"><a href="diameter_transport.html#Mod:start-3">Mod:start/3</a></li>
    </ul>
</li>
<li id="no" title="diameter_tcp " expanded="false">diameter_tcp<ul>
<li><a href="diameter_tcp.html">
                  Top of manual page
                </a></li>
    <li title="start-3"><a href="diameter_tcp.html#start-3">start/3</a></li>
    </ul>
</li>
<li id="no" title="diameter_sctp " expanded="false">diameter_sctp<ul>
<li><a href="diameter_sctp.html">
                  Top of manual page
                </a></li>
    <li title="start-3"><a href="diameter_sctp.html#start-3">start/3</a></li>
    </ul>
</li>
</ul>
</div></div>
<div id="content">
<div class="innertube">
<!-- refpage --><center><h1>diameter</h1></center>





<h3><span onMouseOver="document.getElementById('ghlink-module-idm1136').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-module-idm1136').style.visibility = 'hidden';"><span id="ghlink-module-idm1136"></span><a class="title_link" name="module" href="#module">Module</a></span></h3>
<div class="REFBODY module-body">diameter</div>
<h3><span onMouseOver="document.getElementById('ghlink-module-summary-idm1137').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-module-summary-idm1137').style.visibility = 'hidden';"><span id="ghlink-module-summary-idm1137"></span><a class="title_link" name="module-summary" href="#module-summary">Module Summary</a></span></h3>
<div class="REFBODY module-summary-body">Main API of the diameter application.</div>
<h3><span onMouseOver="document.getElementById('ghlink-since-idm1137').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-since-idm1137').style.visibility = 'hidden';"><span id="ghlink-since-idm1137"></span><a class="title_link" name="since" href="#since">Since</a></span></h3>
<div class="REFBODY module-since">
	Module diameter was introduced in
	OTP R14B03.
      </div>

<h3><span onMouseOver="document.getElementById('ghlink-description-idm1138').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-description-idm1138').style.visibility = 'hidden';"><span id="ghlink-description-idm1138" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L63" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="description" href="#description">Description</a></span></h3>
<div class="REFBODY description-body"><p>
<p>
This module provides the interface with which a user can
implement a Diameter node that sends and receives messages using the
Diameter protocol as defined in RFC 6733.</p>

<p>
Basic usage consists of creating a representation of a
locally implemented Diameter node and its capabilities with
<span class="bold_code bc-17"><a href="#start_service-2">start_service/2</a></span>, adding transport capability using
<span class="bold_code bc-17"><a href="#add_transport-2">add_transport/2</a></span> and sending Diameter
requests and receiving Diameter answers with <span class="bold_code bc-17"><a href="#call-4">call/4</a></span>.
Incoming Diameter requests are communicated as callbacks to a
<span class="bold_code bc-19"><a href="diameter_app.html">diameter_app(3)</a></span> callback modules as
specified in the service configuration.</p>

<p>
Beware the difference between <strong>diameter</strong> (not capitalized) and
<strong>Diameter</strong> (capitalized).
The former refers to the Erlang application named diameter whose main
api is defined here, the latter to Diameter protocol in the sense of
RFC 6733.</p>

<p>
The diameter application must be started before calling most functions
in this module.</p>

</p></div>



<h3><span onMouseOver="document.getElementById('ghlink-data-types-idm1149').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-data-types-idm1149').style.visibility = 'hidden';"><span id="ghlink-data-types-idm1149" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L94" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="data-types" href="#data-types">DATA TYPES</a></span></h3>
<div class="REFBODY rb-3">


<dl>

<dt><strong><span class="code">Address()</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">DiameterIdentity()</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">Grouped()</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">OctetString()</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">Time()</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">Unsigned32()</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">UTF8String()</span></strong></dt>
<dd>
<p>
Types corresponding to RFC 6733 AVP Data Formats.
Defined in <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">diameter_dict(4)</a></span>.</p>

<a name="application_alias"></a>
</dd>

<dt><strong><span class="code">application_alias() = term()</span></strong></dt>
<dd>
<p>
Name identifying a Diameter application in
service configuration.
Passed to <span class="bold_code bc-17"><a href="#call-4">call/4</a></span> when sending requests
defined by the application.</p>

<a name="application_module"></a>
</dd>

<dt><strong><span class="code">application_module() = Mod
                             | [Mod | ExtraArgs]
                             | #diameter_callback{}</span></strong></dt>
<dd>
<div class="example"><pre>
Mod = atom()
ExtraArgs = list()
</pre></div>

<p>
Module implementing the callback interface defined in <span class="bold_code bc-19"><a href="diameter_app.html">diameter_app(3)</a></span>,
along with any
extra arguments to be appended to those documented.
Note that extra arguments specific to an outgoing request can be
specified to <span class="bold_code bc-17"><a href="#call-4">call/4</a></span>, in which case
those are appended to any module-specific extra arguments.</p>

<p>
Specifying a <span class="code">#diameter_callback{}</span> record allows individual
functions to be configured in place of the usual <span class="bold_code bc-19"><a href="diameter_app.html">diameter_app(3)</a></span> callbacks.
See <span class="code">diameter_callback.erl</span> for details.</p>

<a name="application_opt"></a>
</dd>

<dt><strong><span class="code">application_opt()</span></strong></dt>
<dd>

<p>
Options defining a Diameter application.
Has one of the following types.</p>

<dl>

<dt><strong><span class="code">{alias, <span class="bold_code bc-17"><a href="#application_alias">application_alias()</a></span>}</span></strong></dt>
<dd>
<p>
Unique identifier for the application in the scope of the
service.
Defaults to the value of the <span class="code">dictionary</span> option.</p>
</dd>

<dt><strong><span class="code">{dictionary, atom()}</span></strong></dt>
<dd>
<p>
Name of an encode/decode module for the Diameter
messages defined by the application.
These modules are generated from files whose format is documented in
<span class="bold_code bc-19"><a href="diameter_dict.html">diameter_dict(4)</a></span>.</p>
</dd>

<dt><strong><span class="code">{module, <span class="bold_code bc-17"><a href="#application_module">application_module()</a></span>}</span></strong></dt>
<dd>
<p>
Callback module in which messages of the Diameter application are
handled.
See <span class="bold_code bc-19"><a href="diameter_app.html">diameter_app(3)</a></span> for the required interface and semantics.</p>
</dd>

<dt><strong><span class="code">{state, term()}</span></strong></dt>
<dd>
<p>
Initial callback state.
The prevailing state is passed to some
<span class="bold_code bc-19"><a href="diameter_app.html">diameter_app(3)</a></span>
callbacks, which can then return a new state.
Defaults to the value of the <span class="code">alias</span> option.</p>
</dd>

<dt><strong><span class="code">{call_mutates_state, true|false}</span></strong></dt>
<dd>
<p>
Whether or not the <span class="bold_code bc-15"><a href="diameter_app.html#Mod:pick_peer-4">pick_peer/4</a></span>
application callback can modify the application state.
Defaults to <span class="code">false</span>.</p>

<div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
<p>
<span class="bold_code bc-15"><a href="diameter_app.html#Mod:pick_peer-4">pick_peer/4</a></span> callbacks are serialized when this option is <span class="code">true</span>,
which is a potential performance bottleneck.
A simple Diameter client may suffer no ill effects from using mutable
state but a server or agent that responds to incoming request should
probably avoid it.</p>
</p></div>
</div>
</dd>

<dt><strong><span class="code">{answer_errors, callback|report|discard}</span></strong></dt>
<dd>
<p>
Manner in which incoming answer messages containing
decode errors are handled.</p>

<p>
If <span class="code">callback</span> then errors result in a <span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_answer-4">handle_answer/4</a></span>
callback in the same fashion as for <span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_request-3">handle_request/3</a></span>, with
errors communicated in the <span class="code">errors</span> field of the
<span class="code">#diameter_packet{}</span> passed to the callback.
If <span class="code">report</span> then an answer containing errors is discarded
without a callback and a warning report is written to the log.
If <span class="code">discard</span> then an answer containing errors is silently
discarded without a callback.
In both the <span class="code">report</span> and <span class="code">discard</span> cases the return value
for the <span class="bold_code bc-17"><a href="#call-4">call/4</a></span> invocation in
question is as if a callback had taken place and returned
<span class="code">{error, failure}</span>.</p>

<p>
Defaults to <span class="code">discard</span>.</p>
</dd>

<dt><strong><span class="code">{request_errors, answer_3xxx|answer|callback}</span></strong></dt>
<dd>
<p>
Manner in which incoming requests are handled when an
error other than 3007 (DIAMETER_APPLICATION_UNSUPPORTED, which cannot
be associated with an application callback module), is detected.</p>

<p>
If <span class="code">answer_3xxx</span> then requests are answered without a
<span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_request-3">handle_request/3</a></span> callback taking place.
If <span class="code">answer</span> then even 5xxx errors are answered without a
callback unless the connection in question has configured the RFC 3588
common dictionary as noted below.
If <span class="code">callback</span> then a <span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_request-3">handle_request/3</a></span> callback always takes
place and its return value determines the answer sent to the peer, if
any.</p>

<p>
Defaults to <span class="code">answer_3xxx</span>.</p>

<div class="note">
<div class="label">Note</div>
<div class="content"><p>
<p>
Answers sent by diameter set the E-bit in the Diameter Header.
Since RFC 3588 allows only 3xxx result codes in an
<span class="code">answer-message</span>, <span class="code">answer</span> has the same semantics as
<span class="code">answer_3xxx</span> when the transport in question has
been configured with <span class="code">diameter_gen_base_rfc3588</span> as its common
dictionary.
Since RFC 6733 allows both 3xxx and 5xxx result codes in an
<span class="code">answer-message</span>, a transport with
<span class="code">diameter_gen_base_rfc6733</span> as its common dictionary does
distinguish between <span class="code">answer_3xxx</span> and <span class="code">answer</span>.</p>
</p></div>
</div>
</dd>

</dl>

<a name="call_opt"></a>
</dd>

<dt><strong><span class="code">call_opt()</span></strong></dt>
<dd>

<p>
Options available to <span class="bold_code bc-17"><a href="#call-4">call/4</a></span> when
sending an outgoing Diameter request.
Has one of the following types.</p>

<dl>

<dt><strong><span class="code">{extra, list()}</span></strong></dt>
<dd>
<p>
Extra arguments to append to callbacks to the callback
module in question.
These are appended to any extra arguments configured on the callback
itself.
Multiple options append to the argument list.</p>
</dd>

<dt><strong><span class="code">{filter, <span class="bold_code bc-17"><a href="#peer_filter">peer_filter()</a></span>}</span></strong></dt>
<dd>
<p>
Filter to apply to the list of available peers before passing it to
the <span class="bold_code bc-15"><a href="diameter_app.html#Mod:pick_peer-4">pick_peer/4</a></span> callback for the application in question.
Multiple options are equivalent a single <span class="code">all</span> filter on the
corresponding list of filters.
Defaults to <span class="code">none</span>.</p>
</dd>

<dt><strong><span class="code">{peer, <span class="bold_code bc-15"><a href="diameter_app.html#peer_ref">diameter_app:peer_ref()</a></span>}</span></strong></dt>
<dd>
<p>
Peer to which the request in question can be sent, preempting the
selection of peers having advertised support for the Diameter
application in question.
Multiple options can be specified, and their order is
respected in the candidate lists passed to a subsequent
<span class="bold_code bc-15"><a href="diameter_app.html#Mod:pick_peer-4">pick_peer/4</a></span> callback.</p>
</dd>

<dt><strong><span class="code">{timeout, <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Unsigned32()</a></span>}</span></strong></dt>
<dd>
<p>
Number of milliseconds after which the request should
timeout.
Defaults to 5000.</p>
</dd>

<dt><strong><span class="code">detach</span></strong></dt>
<dd>
<p>
Cause <span class="bold_code bc-17"><a href="#call-4">call/4</a></span> to return <span class="code">ok</span> as
soon as the request in
question has been encoded, instead of waiting for and returning
the result from a subsequent <span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_answer-4">handle_answer/4</a></span> or
<span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_error-4">handle_error/4</a></span> callback.</p>
</dd>

</dl>

<p>
An invalid option will cause <span class="bold_code bc-17"><a href="#call-4">call/4</a></span> to fail.</p>

<a name="capability"></a>
</dd>

<dt><strong><span class="code">capability()</span></strong></dt>
<dd>

<p>
AVP values sent in outgoing CER or CEA messages during capabilities
exchange.
Can be configured both on a service and a transport, values
on the latter taking precedence.
Has one of the following types.</p>

<dl>

<dt><strong><span class="code">{'Origin-Host', <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">DiameterIdentity()</a></span>}</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">{'Origin-Realm', <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">DiameterIdentity()</a></span>}</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">{'Host-IP-Address', [<span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Address()</a></span>]}</span></strong></dt>
<dd>
<p>
An address list is available to the start function of a
<span class="bold_code bc-19"><a href="diameter_transport.html">transport module</a></span>, which
can return a new list for use in the subsequent CER or CEA.
Host-IP-Address need not be specified if the transport module in
question communicates an address list as described in
<span class="bold_code bc-19"><a href="diameter_transport.html">diameter_transport(3)</a></span></p>
</dd>

<dt><strong><span class="code">{'Vendor-Id', <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Unsigned32()</a></span>}</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">{'Product-Name', <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">UTF8String()</a></span>}</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">{'Origin-State-Id', <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Unsigned32()</a></span>}</span></strong></dt>
<dd>
<p>
Origin-State-Id is optional but, if configured, will be included in
outgoing CER/CEA and DWR/DWA messages.
Setting a value of <span class="code">0</span> (zero) is equivalent to not setting a
value, as documented in RFC 6733.
The function <span class="bold_code bc-17"><a href="#origin_state_id-0">origin_state_id/0</a></span>
can be used as to retrieve a value that is computed when the diameter
application is started.</p>
</dd>

<dt><strong><span class="code">{'Supported-Vendor-Id', [<span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Unsigned32()</a></span>]}</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">{'Auth-Application-Id', [<span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Unsigned32()</a></span>]}</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">{'Inband-Security-Id', [<span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Unsigned32()</a></span>]}</span></strong></dt>
<dd>
<p>
Inband-Security-Id defaults to the empty list, which is equivalent to a
list containing only 0 (NO_INBAND_SECURITY).
If 1 (TLS) is specified then TLS is selected if the CER/CEA received
from the peer offers it.</p>
</dd>

<dt><strong><span class="code">{'Acct-Application-Id', [<span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Unsigned32()</a></span>]}</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">{'Vendor-Specific-Application-Id', [<span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Grouped()</a></span>]}</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">{'Firmware-Revision', <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Unsigned32()</a></span>}</span></strong></dt>
<dd></dd>

</dl>

<p>
Note that each tuple communicates one or more AVP values.
It is an error to specify duplicate tuples.</p>

<a name="eval"></a>
</dd>

<dt><strong><span class="code">eval() = {M,F,A} | fun() | [eval() | A]</span></strong></dt>
<dd>
<p>
An expression that can be evaluated as a function in the following
sense.</p>

<div class="example"><pre>
eval([{M,F,A} | T]) -&gt;
    apply(M, F, T ++ A);
eval([[F|A] | T]) -&gt;
    eval([F | T ++ A]);
eval([F|A]) -&gt;
    apply(F, A);
eval(F) -&gt;
    eval([F]).
</pre></div>

<p>
Applying an <span class="code"><span class="bold_code bc-17"><a href="#eval">eval()</a></span></span>
<span class="code">E</span> to an argument list <span class="code">A</span>
is meant in the sense of <span class="code">eval([E|A])</span>.</p>

<div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
<p>
Beware of using fun expressions of the form <span class="code">fun Name/Arity</span> in
situations in which the fun is not short-lived
and code is to be upgraded at runtime since any processes retaining
such a fun will have a reference to old code.
In particular, such a value is typically inappropriate in
configuration passed to <span class="bold_code bc-17"><a href="#start_service-2">start_service/2</a></span> or <span class="bold_code bc-17"><a href="#add_transport-2">add_transport/2</a></span>.</p>
</p></div>
</div>

<a name="peer_filter"></a>
</dd>

<dt><strong><span class="code">peer_filter() = term()</span></strong></dt>
<dd>
<p>
Filter passed to <span class="bold_code bc-17"><a href="#call-4">call/4</a></span> in order to select candidate peers for a
<span class="bold_code bc-15"><a href="diameter_app.html#Mod:pick_peer-4">pick_peer/4</a></span> callback.
Has one of the following types.</p>

<dl>

<dt><strong><span class="code">none</span></strong></dt>
<dd>
<p>
Matches any peer.
This is a convenience that provides a filter equivalent to no
filter.</p>
</dd>

<dt><strong><span class="code">host</span></strong></dt>
<dd>
<p>
Matches only those peers whose Origin-Host has the same value
as Destination-Host in the outgoing request in question,
or any peer if the request does not contain
a Destination-Host AVP.</p>
</dd>

<dt><strong><span class="code">realm</span></strong></dt>
<dd>
<p>
Matches only those peers whose Origin-Realm has the same value
as Destination-Realm in the outgoing request in question,
or any peer if the request does not contain
a Destination-Realm AVP.</p>
</dd>

<dt><strong><span class="code">{host, any|<span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">DiameterIdentity()</a></span>}</span></strong></dt>
<dd>
<p>
Matches only those peers whose Origin-Host has the
specified value, or all peers if the atom <span class="code">any</span>.</p>
</dd>

<dt><strong><span class="code">{realm, any|<span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">DiameterIdentity()</a></span>}</span></strong></dt>
<dd>
<p>
Matches only those peers whose Origin-Realm has the
specified value, or all peers if the atom <span class="code">any</span>.</p>
</dd>

<dt><strong><span class="code">{eval, <span class="bold_code bc-17"><a href="#eval">eval()</a></span>}</span></strong></dt>
<dd>
<p>
Matches only those peers for which the specified
<span class="code"><span class="bold_code bc-17"><a href="#eval">eval()</a></span></span> returns
<span class="code">true</span> when applied to the connection's <span class="code">diameter_caps</span>
record.
Any other return value or exception is equivalent to <span class="code">false</span>.</p>
</dd>

<dt><strong><span class="code">{neg, <span class="bold_code bc-17"><a href="#peer_filter">peer_filter()</a></span>}</span></strong></dt>
<dd>
<p>
Matches only those peers not matched by the specified filter.</p>
</dd>

<dt><strong><span class="code">{all, [<span class="bold_code bc-17"><a href="#peer_filter">peer_filter()</a></span>]}</span></strong></dt>
<dd>
<p>
Matches only those peers matched by each filter in the specified list.</p>
</dd>

<dt><strong><span class="code">{any, [<span class="bold_code bc-17"><a href="#peer_filter">peer_filter()</a></span>]}</span></strong></dt>
<dd>
<p>
Matches only those peers matched by at least one filter in the
specified list.
The resulting list will be in match order, peers matching the
first filter of the list sorting before those matched by the second,
and so on.</p>
</dd>

<dt><strong><span class="code">{first, [<span class="bold_code bc-17"><a href="#peer_filter">peer_filter()</a></span>]}</span></strong></dt>
<dd>
<p>
Like <span class="code">any</span>, but stops at the first filter for which there are
matches, which can be much more efficient when there are many peers.
For example, the following filter causes only peers best matching
both the host and realm filters to be presented.</p>

<div class="example"><pre>
{first, [{all, [host, realm]}, realm]}
</pre></div>
</dd>

</dl>

<p>
An invalid filter is equivalent to <span class="code">{any,[]}</span>, a filter
that matches no peer.</p>

<div class="note">
<div class="label">Note</div>
<div class="content"><p>
<p>
The <span class="code">host</span> and <span class="code">realm</span> filters cause the Destination-Host
and Destination-Realm AVPs to be extracted from the
outgoing request, assuming it to be a record- or list-valued
<span class="code"><span class="bold_code bc-15"><a href="diameter_codec.html#message">diameter_codec:message()</a></span></span>, and assuming at most one of each AVP.
If this is not the case then the <span class="code">{host|realm, <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">DiameterIdentity()</a></span>}</span>
filters must be used to achieve the desired result.
An empty <span class="code"><span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">DiameterIdentity()</a></span></span>
(which should not be typical)
matches all hosts/realms for the purposes of filtering.</p>
</p></div>
</div>

<div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
<p>
A <span class="code">host</span> filter is not typically desirable when setting
Destination-Host since it will remove peer agents from the
candidates list.</p>
</p></div>
</div>

<a name="service_event"></a>
</dd>
<dt><strong><span class="code">service_event() = #diameter_event{service = <span class="bold_code bc-17"><a href="#service_name">service_name()</a></span>,
                                          info = <span class="bold_code bc-17"><a href="#service_event_info">service_event_info()</a></span>}</span></strong></dt>
<dd>
<p>
An event message sent to processes that have subscribed to these using
<span class="bold_code bc-17"><a href="#subscribe-1">subscribe/1</a></span>.</p>

<a name="service_event_info"></a>
</dd>

<dt><strong><span class="code">service_event_info() = term()</span></strong></dt>

<dd>

<p>
The <span class="code">info</span> field of a <span class="bold_code bc-17"><a href="#service_event">service_event()</a></span> record.
Can have one of the following types.</p>

<dl>

<dt><strong><span class="code">start</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">stop</span></strong></dt>
<dd>
<p>
The service is being started or stopped.
No event precedes a <span class="code">start</span> event.
No event follows a <span class="code">stop</span> event, and this event
implies the termination of all transport processes.</p>
</dd>

<dt><strong><span class="code">{up, Ref, Peer, Config, Pkt}</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">{up, Ref, Peer, Config}</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">{down, Ref, Peer, Config}</span></strong></dt>
<dd>
<div class="example"><pre>
Ref    = <span class="bold_code bc-17"><a href="#transport_ref">transport_ref()</a></span>
Peer   = <span class="bold_code bc-15"><a href="diameter_app.html#peer">diameter_app:peer()</a></span>
Config = {connect|listen, [<span class="bold_code bc-17"><a href="#transport_opt">transport_opt()</a></span>]}
Pkt    = #diameter_packet{}
</pre></div>

<p>
The RFC 3539 watchdog state machine has
transitioned into (<span class="code">up</span>) or out of (<span class="code">down</span>) the OKAY
state.
If a <span class="code">#diameter_packet{}</span> is present in an <span class="code">up</span> event
then there has been a capabilities exchange on a newly established
transport connection and the record contains the received CER or
CEA.</p>

<p>
Note that a single <span class="code">up</span> or <span class="code">down</span> event for a given peer
corresponds to multiple <span class="bold_code bc-15"><a href="diameter_app.html#Mod:peer_up-3">peer_up/3</a></span> or <span class="bold_code bc-15"><a href="diameter_app.html#Mod:peer_down-3">peer_down/3</a></span>
callbacks, one for each of the Diameter applications negotiated during
capabilities exchange.
That is, the event communicates connectivity with the
peer as a whole while the callbacks communicate connectivity with
respect to individual Diameter applications.</p>
</dd>

<dt><strong><span class="code">{reconnect, Ref, Opts}</span></strong></dt>
<dd>
<div class="example"><pre>
Ref  = <span class="bold_code bc-17"><a href="#transport_ref">transport_ref()</a></span>
Opts = [<span class="bold_code bc-17"><a href="#transport_opt">transport_opt()</a></span>]
</pre></div>

<p>
A connecting transport is attempting to establish/reestablish a
transport connection with a peer following <span class="bold_code bc-17"><a href="#connect_timer">connect_timer</a></span> or
<span class="bold_code bc-17"><a href="#watchdog_timer">watchdog_timer</a></span> expiry.</p>
</dd>

<dt><strong><span class="code">{closed, Ref, Reason, Config}</span></strong></dt>
<dd>
<div class="example"><pre>
Ref = <span class="bold_code bc-17"><a href="#transport_ref">transport_ref()</a></span>
Config = {connect|listen, [<span class="bold_code bc-17"><a href="#transport_opt">transport_opt()</a></span>]}
</pre></div>

<p>
Capabilities exchange has failed.
<span class="code">Reason</span> can have one of the following types.</p>

<dl>

<dt><strong><span class="code">{'CER', Result, Caps, Pkt}</span></strong></dt>
<dd>
<div class="example"><pre>
Result = ResultCode | {capabilities_cb, CB, ResultCode|discard}
Caps = #diameter_caps{}
Pkt  = #diameter_packet{}
ResultCode = integer()
CB = <span class="bold_code bc-17"><a href="#eval">eval()</a></span>
</pre></div>

<p>
An incoming CER has been answered with the indicated result code, or
discarded.
<span class="code">Caps</span> contains pairs of values, for the local node and remote
peer respectively.
<span class="code">Pkt</span> contains the CER in question.
In the case of rejection by a capabilities callback, the tuple
contains the rejecting callback.</p>
</dd>

<dt><strong><span class="code">{'CER', Caps, {ResultCode, Pkt}}</span></strong></dt>
<dd>
<div class="example"><pre>
ResultCode = integer()
Caps = #diameter_caps{}
Pkt  = #diameter_packet{}
</pre></div>

<p>
An incoming CER contained errors and has been answered with the
indicated result code.
<span class="code">Caps</span> contains values for the local node only.
<span class="code">Pkt</span> contains the CER in question.</p>
</dd>

<dt><strong><span class="code">{'CER', timeout}</span></strong></dt>
<dd>
<p>
An expected CER was not received within <span class="bold_code bc-17"><a href="#capx_timeout">capx_timeout</a></span> of
connection establishment.</p>
</dd>

<dt><strong><span class="code">{'CEA', Result, Caps, Pkt}</span></strong></dt>
<dd>
<div class="example"><pre>
Result = ResultCode | atom() | {capabilities_cb, CB, ResultCode|discard}
Caps = #diameter_caps{}
Pkt  = #diameter_packet{}
ResultCode = integer()
</pre></div>

<p>
An incoming CEA has been rejected for the indicated reason.
An integer-valued <span class="code">Result</span> indicates the result code sent
by the peer.
<span class="code">Caps</span> contains pairs of values for the local node and remote
peer.
<span class="code">Pkt</span> contains the CEA in question.
In the case of rejection by a capabilities callback, the tuple
contains the rejecting callback.</p>
</dd>

<dt><strong><span class="code">{'CEA', Caps, Pkt}</span></strong></dt>
<dd>
<div class="example"><pre>
Caps = #diameter_caps{}
Pkt  = #diameter_packet{}
</pre></div>

<p>
An incoming CEA contained errors and has been rejected.
<span class="code">Caps</span> contains only values for the local node.
<span class="code">Pkt</span> contains the CEA in question.</p>
</dd>

<dt><strong><span class="code">{'CEA', timeout}</span></strong></dt>
<dd>
<p>
An expected CEA was not received within <span class="bold_code bc-17"><a href="#capx_timeout">capx_timeout</a></span>
of connection establishment.</p>
</dd>

</dl>
</dd>

<dt><strong><span class="code">{watchdog, Ref, PeerRef, {From, To}, Config}</span></strong></dt>
<dd>
<div class="example"><pre>
Ref = <span class="bold_code bc-17"><a href="#transport_ref">transport_ref()</a></span>
PeerRef = <span class="bold_code bc-15"><a href="diameter_app.html#peer_ref">diameter_app:peer_ref()</a></span>
From, To = initial | okay | suspect | down | reopen
Config = {connect|listen, [transport_opt()]}
</pre></div>

<p>
An RFC 3539 watchdog state machine has changed state.</p>
</dd>

<dt><strong><span class="code">any()</span></strong></dt>
<dd>
<p>
For forward compatibility, a subscriber should be prepared to receive
info fields of forms other than the above.</p>
</dd>

</dl>

<a name="service_name"></a>
</dd>

<dt><strong><span class="code">service_name() = term()</span></strong></dt>
<dd>
<p>
Name of a service as passed to <span class="bold_code bc-17"><a href="#start_service-2">start_service/2</a></span> and with which the
service is identified.
There can be at most one service with a given name on a given node.
Note that <span class="bold_code bc-13"><a href="erlang.html#make_ref-0">erlang:make_ref/0</a></span>
can be used to generate a service name that is somewhat unique.</p>

<a name="service_opt"></a>
</dd>

<dt><strong><span class="code">service_opt()</span></strong></dt>
<dd>
<p>
Option passed to <span class="bold_code bc-17"><a href="#start_service-2">start_service/2</a></span>.
Can be any <span class="code"><span class="bold_code bc-17"><a href="#capability">capability()</a></span></span> as well as the following.</p>

<dl>

<dt><strong><span class="code">{application, [<span class="bold_code bc-17"><a href="#application_opt">application_opt()</a></span>]}</span></strong></dt>
<dd>
<p>
A Diameter application supported by the service.</p>

<p>
A service must configure one tuple for each Diameter
application it intends to support.
For an outgoing request, the relevant <span class="code"><span class="bold_code bc-17"><a href="#application_alias">application_alias()</a></span></span> is
passed to <span class="bold_code bc-17"><a href="#call-4">call/4</a></span>, while for an
incoming request the application identifier in the message
header determines the application, the identifier being specified in
the application's <span class="bold_code bc-19"><a href="diameter_dict.html">dictionary</a></span> file.</p>

<div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
<p>
The capabilities advertised by a node must match its configured
applications. In particular, <span class="code">application</span> configuration must
be matched by corresponding <span class="bold_code bc-17"><a href="#capability">capability()</a></span> configuration, of
*-Application-Id AVPs in particular.</p>
</p></div>
</div>

</dd>

<dt><strong>
<a name="decode_format"></a>
<span class="code">{decode_format, record | list | map | none}</span></strong></dt>
<dd>
<p>
The format of decoded messages and grouped AVPs in the <span class="code">msg</span> field
of diameter_packet records and <span class="code">value</span> field of diameter_avp
records respectively.
If <span class="code">record</span> then a record whose definition is generated from the
dictionary file in question.
If <span class="code">list</span> or <span class="code">map</span> then a <span class="code">[Name | Avps]</span> pair where
<span class="code">Avps</span> is a list of AVP name/values pairs or a map keyed on
AVP names respectively.
If <span class="code">none</span> then the atom-value message name, or <span class="code">undefined</span>
for a Grouped AVP.
See also <span class="bold_code bc-15"><a href="diameter_codec.html#message">diameter_codec:message()</a></span>.</p>

<p>
Defaults to <span class="code">record</span>.</p>

<div class="note">
<div class="label">Note</div>
<div class="content"><p>
<p>
AVPs are decoded into a list of diameter_avp records in <span class="code">avps</span>
field of diameter_packet records independently of
<span class="code">decode_format</span>.</p>
</p></div>
</div>

</dd>

<dt><strong><span class="code">{restrict_connections, false
                             | node
                             | nodes
                             | [node()]
                             | eval()}</span></strong></dt>
<dd>
<p>
The degree to which the service allows multiple transport
connections to the same peer, as identified by its Origin-Host
at capabilities exchange.</p>

<p>
If <span class="code">[node()]</span> then a connection is rejected if another already
exists on any of the specified nodes.
Types <span class="code">false</span>, <span class="code">node</span>, <span class="code">nodes</span> and
<span class="bold_code bc-17"><a href="#eval">eval()</a></span> are equivalent to
<span class="code">[]</span>, <span class="code">[node()]</span>, <span class="code">[node()|nodes()]</span> and the
evaluated value respectively, evaluation of each expression taking
place whenever a new connection is to be established.
Note that <span class="code">false</span> allows an unlimited number of connections to be
established with the same peer.</p>

<p>
Multiple connections are independent and governed
by their own peer and watchdog state machines.</p>

<p>
Defaults to <span class="code">nodes</span>.</p>
</dd>

<dt><strong><span class="code">{sequence, {H,N} | <span class="bold_code bc-17"><a href="#eval">eval()</a></span>}</span></strong></dt>
<dd>
<p>
A constant value <span class="code">H</span> for the topmost <span class="code">32-N</span> bits of
of 32-bit End-to-End and Hop-by-Hop Identifiers generated
by the service, either explicitly or as a return value of a function
to be evaluated at <span class="bold_code bc-17"><a href="#start_service-2">start_service/2</a></span>.
In particular, an identifier <span class="code">Id</span> is mapped to a new identifier
as follows.</p>
<div class="example"><pre>
(H bsl N) bor (Id band ((1 bsl N) - 1))
</pre></div>
<p>
Note that RFC 6733 requires that End-to-End Identifiers remain unique
for a period of at least 4 minutes and that this and the call rate
places a lower bound on appropriate values of <span class="code">N</span>:
at a rate of <span class="code">R</span> requests per second, an <span class="code">N</span>-bit counter
traverses all of its values in <span class="code">(1 bsl N) div (R*60)</span> minutes, so
the bound is <span class="code">4*R*60 =&lt; 1 bsl N</span>.</p>

<p><span class="code">N</span> must lie in the range <span class="code">0..32</span> and <span class="code">H</span> must be a
non-negative integer less than <span class="code">1 bsl (32-N)</span>.</p>

<p>
Defaults to <span class="code">{0,32}</span>.</p>

<div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
<p>
Multiple Erlang nodes implementing the same Diameter node should
be configured with different sequence masks to ensure that each node
uses a unique range of End-to-End and Hop-by-Hop Identifiers for
outgoing requests.</p>
</p></div>
</div>
</dd>

<dt><strong><span class="code">{share_peers, boolean() | [node()] | eval()}</span></strong></dt>
<dd>
<p>
Nodes to which peer connections established on the local
Erlang node are communicated.
Shared peers become available in the remote candidates list passed to
<span class="bold_code bc-15"><a href="diameter_app.html#Mod:pick_peer-4">pick_peer/4</a></span> callbacks on remote nodes whose services are
configured to use them: see <span class="code">use_shared_peers</span> below.</p>

<p>
If <span class="code">false</span> then peers are not shared.
If <span class="code">[node()]</span> then peers are shared with the specified list of
nodes.
If <span class="code">eval()</span> then peers are shared with the nodes returned
by the specified function, evaluated whenever a peer connection
becomes available or a remote service requests information about local
connections.
The value <span class="code">true</span> is equivalent to <span class="code">fun <span class="bold_code bc-13"><a href="erlang.html#nodes-0">erlang:nodes/0</a></span></span>.
The value <span class="code">node()</span> in a list is ignored, so a collection of
services can all be configured to share with the same list of
nodes.</p>

<p>
Defaults to <span class="code">false</span>.</p>

<div class="note">
<div class="label">Note</div>
<div class="content"><p>
<p>
Peers are only shared with services of the same name for the purpose
of sending outgoing requests.
Since the value of the <span class="bold_code bc-17"><a href="#application_opt">application_opt()</a></span> <span class="code">alias</span>, passed to
<span class="bold_code bc-17"><a href="#call-4">call/4</a></span>, is the handle for identifying a peer as a suitable
candidate, services that share peers must use the same aliases to
identify their supported applications.
They should typically also configure identical <span class="bold_code bc-17"><a href="#capabilities">capabilities()</a></span>, since
by sharing peer connections they are distributing the implementation
of a single Diameter node across multiple Erlang nodes.</p>
</p></div>
</div>
</dd>

<dt><strong>
<a name="strict_arities"></a><span class="code">{strict_arities, boolean()
                                               | encode
                                               | decode}</span></strong></dt>
<dd>
<p>
Whether or not to require that the number of AVPs in a message or
grouped AVP agree with those specified in the dictionary in question
when passing messages to <span class="bold_code bc-19"><a href="diameter_app.html">diameter_app(3)</a></span> callbacks.
If <span class="code">true</span> then mismatches in an outgoing messages cause message
encoding to fail, while mismatches in an incoming message are reported
as 5005/5009 errors in the errors field of the diameter_packet record
passed to <span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_request-3">handle_request/3</a></span> or <span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_answer-4">handle_answer/4</a></span> callbacks.
If <span class="code">false</span> then neither error is enforced/detected.
If <span class="code">encode</span> or <span class="code">decode</span> then errors are only
enforced/detected on outgoing or incoming messages respectively.</p>

<p>
Defaults to <span class="code">true</span>.</p>

<div class="note">
<div class="label">Note</div>
<div class="content"><p>
<p>
Disabling arity checks affects the form of messages at encode/decode.
In particular, decoded AVPs are represented as lists of values,
regardless of the AVP's arity (ie. expected number in the message/AVP
grammar in question), and values are expected to be supplied as lists
at encode.
This differs from the historic decode behaviour of representing AVPs
of arity 1 as bare values, not wrapped in a list.</p>
</p></div>
</div>
</dd>

<dt><strong>
<a name="string_decode"></a><span class="code">{string_decode, boolean()}</span></strong></dt>
<dd>
<p>
Whether or not to decode AVPs of type <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">OctetString()</a></span> and its
derived types <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">DiameterIdentity()</a></span>, <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">DiameterURI()</a></span>,
<span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">IPFilterRule()</a></span>, <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">QoSFilterRule()</a></span>, and <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">UTF8String()</a></span>.
If <span class="code">true</span> then AVPs of these types are decoded to string().
If <span class="code">false</span> then values are retained as binary().</p>

<p>
Defaults to <span class="code">true</span>.</p>

<div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
<p>
This option should be set to <span class="code">false</span>
since a sufficiently malicious peer can otherwise cause large amounts
of memory to be consumed when decoded Diameter messages are passed
between processes.
The default value is for backwards compatibility.</p>
</p></div>
</div>

</dd>

<dt><strong>
<a name="traffic_counters"></a><span class="code">{traffic_counters, boolean()}</span></strong></dt>
<dd>
<p>
Whether or not to count application-specific messages; those for which
<span class="bold_code bc-19"><a href="diameter_app.html">diameter_app(3)</a></span> callbacks take place.
If false then only messages handled by diameter itself are counted:
CER/CEA, DWR/DWA, DPR/DPA.</p>

<p>
Defaults to <span class="code">true</span>.</p>

<div class="note">
<div class="label">Note</div>
<div class="content"><p>
<p>
Disabling counters is a performance improvement, but means that the
omitted counters are not returned by <span class="bold_code bc-17"><a href="#service_info-2">service_info/2</a></span>.</p>
</p></div>
</div>

</dd>

<dt><strong><span class="code">{use_shared_peers, boolean() | [node()] | eval()}</span></strong></dt>
<dd>
<p>
Nodes from which communicated peers are made available in
the remote candidates list of <span class="bold_code bc-15"><a href="diameter_app.html#Mod:pick_peer-4">pick_peer/4</a></span> callbacks.</p>

<p>
If <span class="code">false</span> then remote peers are not used.
If <span class="code">[node()]</span> then only peers from the specified list of nodes
are used.
If <span class="code">eval()</span> then only peers returned by the specified
function are used, evaluated whenever a remote service communicates
information about an available peer connection.
The value <span class="code">true</span> is equivalent to <span class="code">fun <span class="bold_code bc-13"><a href="erlang.html#nodes-0">erlang:nodes/0</a></span></span>.
The value <span class="code">node()</span> in a list is ignored.</p>

<p>
Defaults to <span class="code">false</span>.</p>

<div class="note">
<div class="label">Note</div>
<div class="content"><p>
<p>
A service that does not use shared peers will always pass the empty
list as the second argument of <span class="bold_code bc-15"><a href="diameter_app.html#Mod:pick_peer-4">pick_peer/4</a></span> callbacks.</p>
</p></div>
</div>

<div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
<p>
Sending a request over a peer connection on a remote node is less
efficient than sending it over a local connection.
It may be preferable to make use of the <span class="bold_code bc-17"><a href="#service_opt">service_opt()</a></span>
<span class="code">restrict_connections</span> and maintain a dedicated connection on
each node from which requests are sent.</p>
</p></div>
</div>
</dd>

<dt><strong><span class="code"><span class="bold_code bc-17"><a href="#transport_opt">transport_opt()</a></span></span></strong></dt>
<dd>
<p>
Any transport option except <span class="code">applications</span> or
<span class="code">capabilities</span>.
Used as defaults for transport configuration, values passed to
<span class="bold_code bc-17"><a href="#add_transport-2">add_transport/2</a></span> overriding values configured on the service.</p>
</dd>

</dl>

<a name="transport_opt"></a>
</dd>

<dt><strong><span class="code">transport_opt()</span></strong></dt>
<dd>
<p>
Option passed to <span class="bold_code bc-17"><a href="#add_transport-2">add_transport/2</a></span>.
Has one of the following types.</p>

<dl>

<dt><strong>
<a name="applications"></a><span class="code">{applications, [<span class="bold_code bc-17"><a href="#application_alias">application_alias()</a></span>]}</span></strong></dt>
<dd>
<p>
Diameter applications to which the transport should be restricted.
Defaults to all applications configured on the service in question.
Applications not configured on the service in question are ignored.</p>

<div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
<p>
The capabilities advertised by a node must match its configured
applications.
In particular, setting <span class="code">applications</span> on a transport typically
implies having to set matching *-Application-Id AVPs in a
<span class="bold_code bc-17"><a href="#capabilities">capabilities()</a></span> tuple.</p>
</p></div>
</div>

</dd>

<dt><strong>
<a name="avp_dictionaries"></a><span class="code">{avp_dictionaries, [module()]}</span></strong></dt>
<dd>
<p>
A list of alternate dictionary modules with which to encode/decode
AVPs that are not defined by the dictionary of the application in
question.
At decode, such AVPs are represented as diameter_avp records in the
<span class="code">'AVP'</span> field of a decoded message or Grouped AVP, the first
alternate that succeeds in decoding the AVP setting the record's value
field.
At encode, values in an <span class="code">'AVP'</span> list can be passed as AVP
name/value 2-tuples, and it is an encode error for no alternate to
define the AVP of such a tuple.</p>

<p>
Defaults to the empty list.</p>

<div class="note">
<div class="label">Note</div>
<div class="content"><p>
<p>
The motivation for alternate dictionaries is RFC 7683, Diameter
Overload Indication Conveyance (DOIC), which defines AVPs to
be piggybacked onto existing application messages rather than defining
an application of its own.
The DOIC dictionary is provided by the diameter application, as module
<span class="code">diameter_gen_doic_rfc7683</span>, but alternate dictionaries can be
used to encode/decode any set of AVPs not known to an application
dictionary.</p>
</p></div>
</div>
</dd>

<dt><strong>
<a name="capabilities"></a><span class="code">{capabilities, [<span class="bold_code bc-17"><a href="#capability">capability()</a></span>]}</span></strong></dt>
<dd>
<p>
AVPs used to construct outgoing CER/CEA messages.
Values take precedence over any specified on the service in
question.</p>

<p>
Specifying a capability as a transport option
may be particularly appropriate for Inband-Security-Id, in case
TLS is desired over TCP as implemented by <span class="bold_code bc-19"><a href="diameter_tcp.html">diameter_tcp(3)</a></span>.</p>
</dd>

<dt><strong>
<a name="capabilities_cb"></a><span class="code">{capabilities_cb, <span class="bold_code bc-17"><a href="#eval">eval()</a></span>}</span></strong></dt>
<dd>
<p>
Callback invoked upon reception of CER/CEA during capabilities
exchange in order to ask whether or not the connection should
be accepted.
Applied to the <span class="code"><span class="bold_code bc-17"><a href="#transport_ref">transport_ref()</a></span></span> and
<span class="code">#diameter_caps{}</span> record of the connection.</p>

<p>
The return value can have one of the following types.</p>

<dl>
<dt><strong><span class="code">ok</span></strong></dt>
<dd>
<p>
Accept the connection.</p>
</dd>

<dt><strong><span class="code">integer()</span></strong></dt>
<dd>
<p>
Causes an incoming CER to be answered with the specified Result-Code.</p>
</dd>

<dt><strong><span class="code">discard</span></strong></dt>
<dd>
<p>
Causes an incoming CER to be discarded without CEA being sent.</p>
</dd>

<dt><strong><span class="code">unknown</span></strong></dt>
<dd>
<p>
Equivalent to returning <span class="code">3010</span>, DIAMETER_UNKNOWN_PEER.</p>
</dd>
</dl>

<p>
Returning anything but <span class="code">ok</span> or a 2xxx series result
code causes the transport connection to be broken.
Multiple <span class="bold_code bc-17"><a href="#capabilities_cb">capabilities_cb</a></span>
options can be specified, in which
case the corresponding callbacks are applied until either all return
<span class="code">ok</span> or one does not.</p>
</dd>

<dt><strong>
<a name="capx_timeout"></a><span class="code">{capx_timeout, <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Unsigned32()</a></span>}</span></strong></dt>
<dd>
<p>
Number of milliseconds after which a transport process having an
established transport connection will be terminated if the expected
capabilities exchange message (CER or CEA) is not received from the peer.
For a connecting transport, the timing of connection attempts is
governed by <span class="bold_code bc-17"><a href="#connect_timer">connect_timer</a></span> or <span class="bold_code bc-17"><a href="#watchdog_timer">watchdog_timer</a></span> expiry.
For a listening transport, the peer determines the timing.</p>

<p>
Defaults to 10000.</p>
</dd>

<dt><strong>
<a name="connect_timer"></a><span class="code">{connect_timer, Tc}</span></strong></dt>
<dd>
<div class="example"><pre>
Tc = <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Unsigned32()</a></span>
</pre></div>

<p>
For a connecting transport, the RFC 6733 Tc timer, in milliseconds.
This timer determines the frequency with which a transport
attempts to establish an initial connection with its peer
following transport configuration.
Once an initial connection has been
established, <span class="bold_code bc-17"><a href="#watchdog_timer">watchdog_timer</a></span> determines the frequency of
reconnection attempts, as required by RFC 3539.</p>

<p>
For a listening transport, the timer specifies the time after which a
previously connected peer will be forgotten: a connection after this time is
regarded as an initial connection rather than reestablishment,
causing the RFC 3539 state machine to pass to state OKAY rather than
REOPEN.
Note that these semantics are not governed by the RFC and
that a listening transport's <span class="bold_code bc-17"><a href="#connect_timer">connect_timer</a></span> should be greater
than its peer's Tw plus jitter.</p>

<p>
Defaults to 30000 for a connecting transport and 60000 for a listening
transport.</p>
</dd>

<dt><strong>
<a name="disconnect_cb"></a><span class="code">{disconnect_cb, <span class="bold_code bc-17"><a href="#eval">eval()</a></span>}</span></strong></dt>
<dd>
<p>
Callback invoked prior to terminating the transport process of a
transport connection having watchdog state <span class="code">OKAY</span>.
Applied to <span class="code">application|service|transport</span> and the
<span class="code"><span class="bold_code bc-17"><a href="#transport_ref">transport_ref()</a></span></span> and <span class="code"><span class="bold_code bc-15"><a href="diameter_app.html#peer">diameter_app:peer()</a></span></span> in question:
<span class="code">application</span> indicates that the diameter application is
being stopped, <span class="code">service</span> that the service in question is being
stopped by <span class="bold_code bc-17"><a href="#stop_service-1">stop_service/1</a></span>, and <span class="code">transport</span> that the transport in
question is being removed by <span class="bold_code bc-17"><a href="#remove_transport-2">remove_transport/2</a></span>.</p>

<p>
The return value can have one of the following types.</p>

<dl>
<dt><strong><span class="code">{dpr, [option()]}</span></strong></dt>
<dd>
<p>
Send Disconnect-Peer-Request to the peer, the transport
process being terminated following reception of
Disconnect-Peer-Answer or timeout.
An <span class="code">option()</span> can be one of the following.</p>

<dl>
<dt><strong><span class="code">{cause, 0|rebooting|1|busy|2|goaway}</span></strong></dt>
<dd>
<p>
Disconnect-Cause to send, <span class="code">REBOOTING</span>, <span class="code">BUSY</span> and
<span class="code">DO_NOT_WANT_TO_TALK_TO_YOU</span> respectively.
Defaults to <span class="code">rebooting</span> for <span class="code">Reason=service|application</span> and
<span class="code">goaway</span> for <span class="code">Reason=transport</span>.</p>
</dd>

<dt><strong><span class="code">{timeout, <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Unsigned32()</a></span>}</span></strong></dt>
<dd>
<p>
Number of milliseconds after which the transport process is
terminated if DPA has not been received.
Defaults to the value of <span class="bold_code bc-17"><a href="#dpa_timeout">dpa_timeout</a></span>.</p>
</dd>
</dl>
</dd>

<dt><strong><span class="code">dpr</span></strong></dt>
<dd>
<p>
Equivalent to <span class="code">{dpr, []}</span>.</p>
</dd>

<dt><strong><span class="code">close</span></strong></dt>
<dd>
<p>
Terminate the transport process without
Disconnect-Peer-Request being sent to the peer.</p>
</dd>

<dt><strong><span class="code">ignore</span></strong></dt>
<dd>
<p>
Equivalent to not having configured the callback.</p>
</dd>
</dl>

<p>
Multiple <span class="bold_code bc-17"><a href="#disconnect_cb">disconnect_cb</a></span>
options can be specified, in which
case the corresponding callbacks are applied until one of them returns
a value other than <span class="code">ignore</span>.
All callbacks returning <span class="code">ignore</span> is equivalent to not having
configured them.</p>

<p>
Defaults to a single callback returning <span class="code">dpr</span>.</p>
</dd>

<dt><strong>
<a name="dpa_timeout"></a><span class="code">{dpa_timeout, <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Unsigned32()</a></span>}</span></strong></dt>
<dd>
<p>
Number of milliseconds after which a transport connection is
terminated following an outgoing DPR if DPA is not received.</p>

<p>
Defaults to 1000.</p>
</dd>

<dt><strong>
<a name="dpr_timeout"></a><span class="code">{dpr_timeout, <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Unsigned32()</a></span>}</span></strong></dt>
<dd>
<p>
Number of milliseconds after which a transport connection is
terminated following an incoming DPR if the peer does not close the
connection.</p>

<p>
Defaults to 5000.</p>
</dd>

<dt><strong>
<a name="incoming_maxlen"></a><span class="code">{incoming_maxlen, 0..16777215}</span></strong></dt>
<dd>
<p>
Bound on the expected size of incoming Diameter messages.
Messages larger than the specified number of bytes are discarded.</p>

<p>
Defaults to <span class="code">16777215</span>, the maximum value of the 24-bit Message
Length field in a Diameter Header.</p>

</dd>

<dt><strong>
<a name="length_errors"></a><span class="code">{length_errors, exit|handle|discard}</span></strong></dt>
<dd>
<p>
How to deal with errors in the Message Length field of the
Diameter Header in an incoming message.
An error in this context is that the length is not at least 20 bytes
(the length of a Header), is not a multiple of 4 (a valid length) or
is not the length of the message in question, as received over the
transport interface documented in <span class="bold_code bc-19"><a href="diameter_transport.html">diameter_transport(3)</a></span>.</p>

<p>
If <span class="code">exit</span> then the transport process in question exits.
If <span class="code">handle</span> then the message is processed as usual, a resulting
<span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_request-3">handle_request/3</a></span> or <span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_answer-4">handle_answer/4</a></span> callback (if one takes
place) indicating the <span class="code">5015</span> error (DIAMETER_INVALID_MESSAGE_LENGTH).
If <span class="code">discard</span> then the message in question is silently discarded.</p>

<p>
Defaults to <span class="code">exit</span>.</p>

<div class="note">
<div class="label">Note</div>
<div class="content"><p>
<p>
The default value reflects the fact that a transport module for a
stream-oriented transport like TCP may not be able to recover from a
message length error since such a transport must use the Message
Length header to divide the incoming byte stream into individual
Diameter messages.
An invalid length leaves it with no reliable way to rediscover message
boundaries, which may result in the failure of subsequent messages.
See <span class="bold_code bc-19"><a href="diameter_tcp.html">diameter_tcp(3)</a></span> for the behaviour of that module.</p>
</p></div>
</div>
</dd>

<dt><strong><span class="code">{pool_size, pos_integer()}</span></strong></dt>
<dd>
<p>
Number of transport processes to start.
For a listening transport, determines the size of the pool of
accepting transport processes, a larger number being desirable for
processing multiple concurrent peer connection attempts.
For a connecting transport, determines the number of connections to
the peer in question that will be attempted to be establshed:
the <span class="bold_code bc-17"><a href="#service_opt">service_opt()</a></span>: <span class="code">restrict_connections</span> should also be
configured on the service in question to allow multiple connections to
the same peer.</p>

</dd>

<dt><strong>
<a name="spawn_opt"></a><span class="code">{spawn_opt, [term()] | {M,F,A}}</span></strong></dt>
<dd>
<p>
An options list passed to <span class="bold_code bc-13"><a href="erlang.html#spawn_opt-2">erlang:spawn_opt/2</a></span> to spawn a handler process for an
incoming Diameter request on the local node, or an MFA that returns
the pid of a handler process.</p>

<p>
Options <span class="code">monitor</span> and <span class="code">link</span> are ignored in the list-valued
case.
An MFA is applied with an additional term prepended to its argument
list, and should return either the pid of the handler process that
invokes <span class="code">diameter_traffic:request/1</span> on the term in order to
process the request, or the atom <span class="code">discard</span>.
The handler process need not be local, but diameter must be started on
the remote node.</p>

<p>
Defaults to the empty list.</p>
</dd>

<dt><strong>
<a name="strict_capx"></a><span class="code">{strict_capx, boolean()]}</span></strong></dt>
<dd>
<p>
Whether or not to enforce the RFC 6733 requirement that any message
before capabilities exchange should close the peer connection.
If false then unexpected messages are discarded.</p>

<p>
Defaults to true.
Changing this results in non-standard behaviour, but can be useful in
case peers are known to be behave badly.</p>
</dd>

<dt><strong>
<a name="strict_mbit"></a><span class="code">{strict_mbit, boolean()}</span></strong></dt>
<dd>
<p>
Whether or not to regard an AVP setting the M-bit as erroneous when
the command grammar in question does not explicitly allow the AVP.
If <span class="code">true</span> then such AVPs are regarded as 5001 errors,
DIAMETER_AVP_UNSUPPORTED.
If <span class="code">false</span> then the M-bit is ignored and policing
it becomes the receiver's responsibility.</p>

<p>
Defaults to <span class="code">true</span>.</p>

<div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
<p>
RFC 6733 is unclear about the semantics of the M-bit.
One the one hand, the CCF specification in section 3.2 documents AVP
in a command grammar as meaning <strong>any</strong> arbitrary AVP; on the
other hand, 1.3.4 states that AVPs setting the M-bit cannot be added
to an existing command: the modified command must instead be
placed in a new Diameter application.</p>
<p>
The reason for the latter is presumably interoperability:
allowing arbitrary AVPs setting the M-bit in a command makes its
interpretation implementation-dependent, since there's no
guarantee that all implementations will understand the same set of
arbitrary AVPs in the context of a given command.
However, interpreting <span class="code">AVP</span> in a command grammar as any
AVP, regardless of M-bit, renders 1.3.4 meaningless, since the receiver
can simply ignore any AVP it thinks isn't relevant, regardless of the
sender's intent.</p>
<p>
Beware of confusing mandatory in the sense of the M-bit with mandatory
in the sense of the command grammar.
The former is a semantic requirement: that the receiver understand the
semantics of the AVP in the context in question.
The latter is a syntactic requirement: whether or not the AVP must
occur in the message in question.</p>
</p></div>
</div>

</dd>

<dt><strong>
<a name="transport_config"></a><span class="code">{transport_config, term()}</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">{transport_config, term(), <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Unsigned32()</a></span> | infinity}</span></strong></dt>
<dd>
<p>
Term passed as the third argument to the <span class="bold_code bc-15"><a href="diameter_transport.html#Mod:start-3">start/3</a></span> function of
the relevant <span class="bold_code bc-19"><a href="diameter_transport.html">transport module</a></span> in order to
start a transport process.
Defaults to the empty list.</p>

<p>
The 3-tuple form additionally specifies an interval, in milliseconds,
after which a started transport process should be terminated if it has
not yet established a connection.
For example, the following options on a connecting transport
request a connection with one peer over SCTP or another
(typically the same) over TCP.</p>

<div class="example"><pre>
{transport_module, diameter_sctp}
{transport_config, SctpOpts, 5000}
{transport_module, diameter_tcp}
{transport_config, TcpOpts}
</pre></div>

<p>
To listen on both SCTP and TCP, define one transport for each.</p>
</dd>

<dt><strong>
<a name="transport_module"></a><span class="code">{transport_module, atom()}</span></strong></dt>
<dd>
<p>
Module implementing a transport process as defined in <span class="bold_code bc-19"><a href="diameter_transport.html">diameter_transport(3)</a></span>.
Defaults to <span class="code">diameter_tcp</span>.</p>

<p>
Multiple <span class="code">transport_module</span> and <span class="bold_code bc-17"><a href="#transport_config">transport_config</a></span>
options are allowed.
The order of these is significant in this case (and only in this case),
a <span class="code">transport_module</span> being paired with the first
<span class="bold_code bc-17"><a href="#transport_config">transport_config</a></span>
following it in the options list, or the default value for trailing
modules.
Transport starts will be attempted with each of the
modules in order until one establishes a connection within the
corresponding timeout (see below) or all fail.</p>
</dd>

<dt><strong>
<a name="watchdog_config"></a><span class="code">{watchdog_config,
                       [{okay|suspect, non_neg_integer()}]}</span></strong></dt>
<dd>
<p>
Configuration that alters the behaviour of the watchdog
state machine.
On key <span class="code">okay</span>, the non-negative number of answered DWR
messages before transitioning from REOPEN to OKAY.
On key <span class="code">suspect</span>, the number of watchdog timeouts before
transitioning from OKAY to SUSPECT when DWR is unanswered, or 0 to
not make the transition.</p>

<p>
Defaults to <span class="code">[{okay, 3}, {suspect, 1}]</span>.
Not specifying a key is equivalent to specifying
the default value for that key.</p>
<div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
<p>
The default value is as required by RFC 3539: changing it results
in non-standard behaviour that should only be used to simulate
misbehaving nodes during test.</p>
</p></div>
</div>
</dd>

<dt><strong>
<a name="watchdog_timer"></a><span class="code">{watchdog_timer, TwInit}</span></strong></dt>
<dd>
<div class="example"><pre>
TwInit = <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Unsigned32()</a></span>
       | {M,F,A}
</pre></div>

<p>
The RFC 3539 watchdog timer.
An integer value is interpreted as the RFC's TwInit in milliseconds,
a jitter of  2 seconds being added at each rearming of the
timer to compute the RFC's Tw.
An MFA is expected to return the RFC's Tw directly, with jitter
applied, allowing the jitter calculation to be performed by
the callback.</p>

<p>
An integer value must be at least 6000 as required by RFC 3539.
Defaults to 30000.</p>
</dd>

</dl>

<p>
Unrecognized options are silently ignored but are returned unmodified
by <span class="bold_code bc-17"><a href="#service_info-2">service_info/2</a></span> and can be referred to
in predicate functions passed to <span class="bold_code bc-17"><a href="#remove_transport-2">remove_transport/2</a></span>.</p>

</dd>

<dt><strong>
<a name="transport_ref"></a><span class="code">transport_ref() = reference()</span></strong></dt>
<dd>
<p>
Reference returned by <span class="bold_code bc-17"><a href="#add_transport-2">add_transport/2</a></span> that
identifies the configuration.</p>
</dd>

</dl>

</div>

<h3><span onMouseOver="document.getElementById('ghlink-exports-idm2058').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-exports-idm2058').style.visibility = 'hidden';"><span id="ghlink-exports-idm2058"></span><a class="title_link" name="exports" href="#exports">Exports</a></span></h3>
<div class="exports-body">



<table class="func-table"><tr class="func-tr">
<td class="func-td"><div class="bold_code fun-type"><span onMouseOver="document.getElementById('ghlink-add_transport-2-idm2060').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-add_transport-2-idm2060').style.visibility = 'hidden';"><span id="ghlink-add_transport-2-idm2060" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L1588" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="add_transport-2" href="#add_transport-2">add_transport(SvcName, {connect|listen, [Opt]})
        -&gt; {ok, Ref} | {error, Reason}</a></span></div></td>
<td class="func-since-td"><span class="since">OTP R14B03</span></td>
</tr></table>
<div class="REFBODY rb-5">
<h3 class="func-types-title">Types</h3>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">SvcName = <span class="bold_code bc-17"><a href="#service_name">service_name()</a></span></span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">Opt = <span class="bold_code bc-17"><a href="#transport_opt">transport_opt()</a></span></span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">Ref = <span class="bold_code bc-17"><a href="#transport_ref">transport_ref()</a></span></span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">Reason = term()</span><br>
</div>
</div>
<div class="REFBODY rb-7"><p>
<p>
Add transport capability to a service.</p>

<p>
The service will start transport processes as required in order to
establish a connection with the peer, either by connecting to the peer
(<span class="code">connect</span>) or by  accepting incoming connection requests
(<span class="code">listen</span>).
A connecting transport establishes transport connections with at most
one peer, an listening transport potentially with many.</p>

<p>
The diameter application takes responsibility for exchanging
CER/CEA with the peer.
Upon successful completion of capabilities exchange the service
calls each relevant application module's <span class="bold_code bc-15"><a href="diameter_app.html#Mod:peer_up-3">peer_up/3</a></span> callback
after which the caller can exchange Diameter messages with the peer over
the transport.
In addition to CER/CEA, the service takes responsibility for the
handling of DWR/DWA and required by RFC 3539, as well as for DPR/DPA.</p>

<p>
The returned reference uniquely identifies the transport within the
scope of the service.
Note that the function returns before a transport connection has been
established.</p>

<div class="note">
<div class="label">Note</div>
<div class="content"><p>
<p>
It is not an error to add a transport to a service that has not yet
been configured: a service can be started after configuring
its transports.</p>
</p></div>
</div>

</p></div>



<table class="func-table"><tr class="func-tr">
<td class="func-td"><div class="bold_code fun-type"><span onMouseOver="document.getElementById('ghlink-call-4-idm2081').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-call-4-idm2081').style.visibility = 'hidden';"><span id="ghlink-call-4-idm2081" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L1638" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="call-4" href="#call-4">call(SvcName, App, Request, [Opt]) -&gt; Answer | ok | {error, Reason}</a></span></div></td>
<td class="func-since-td"><span class="since">OTP R14B03</span></td>
</tr></table>
<div class="REFBODY rb-5">
<h3 class="func-types-title">Types</h3>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">SvcName = <span class="bold_code bc-17"><a href="#service_name">service_name()</a></span></span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">App = <span class="bold_code bc-17"><a href="#application_alias">application_alias()</a></span></span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">Request = <span class="bold_code bc-15"><a href="diameter_codec.html#message">diameter_codec:message()</a></span></span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">Answer = term()</span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">Opt = <span class="bold_code bc-17"><a href="#call_opt">call_opt()</a></span></span><br>
</div>
</div>
<div class="REFBODY rb-7"><p>
<p>
Send a Diameter request message.</p>

<p>
<span class="code">App</span> specifies the Diameter application in which the request is
defined and callbacks to the corresponding callback module
will follow as described below and in <span class="bold_code bc-19"><a href="diameter_app.html">diameter_app(3)</a></span>.
Unless the <span class="code">detach</span> option is specified, the call returns either
when an answer message is received from the peer or an error occurs.
In the answer case, the return value is as returned by a
<span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_answer-4">handle_answer/4</a></span> callback.
In the error case, whether or not the error is returned directly
by diameter or from a <span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_error-4">handle_error/4</a></span>
callback depends on whether or not the outgoing request is
successfully encoded for transmission to the peer, the cases being
documented below.</p>

<p>
If there are no suitable peers, or if
<span class="bold_code bc-15"><a href="diameter_app.html#Mod:pick_peer-4">pick_peer/4</a></span>
rejects them by returning <span class="code">false</span>, then <span class="code">{error,no_connection}</span>
is returned.
Otherwise <span class="bold_code bc-15"><a href="diameter_app.html#Mod:pick_peer-4">pick_peer/4</a></span> is followed by a
<span class="bold_code bc-15"><a href="diameter_app.html#Mod:prepare_request-3">prepare_request/3</a></span> callback, the message is encoded and then sent.</p>

<p>
There are several error cases which may prevent an
answer from being received and passed to a
<span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_answer-4">handle_answer/4</a></span> callback:</p>

<ul>

<li>
<p>
If the initial encode of the outgoing request
fails, then the request process fails and <span class="code">{error,encode}</span>
is returned.</p>
</li>

<li>
<p>
If the request is successfully encoded and sent but
the answer times out then a
<span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_error-4">handle_error/4</a></span> callback takes place with <span class="code">Reason = timeout</span>.</p>
</li>

<li>
<p>
If the request is successfully encoded and sent but the service in
question is stopped before an answer is received then a
<span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_error-4">handle_error/4</a></span> callback takes place with <span class="code">Reason = cancel</span>.</p>
</li>

<li>
<p>
If the transport connection with the peer goes down after the request
has been sent but before an answer has been received then an attempt
is made to resend the request to an alternate peer.
If no such peer is available, or if the subsequent
<span class="bold_code bc-15"><a href="diameter_app.html#Mod:pick_peer-4">pick_peer/4</a></span> callback rejects the candidates, then a
<span class="bold_code bc-15"><a href="diameter_app.html#Mod:handle_error-4">handle_error/4</a></span> callback takes place with <span class="code">Reason = failover</span>.
If a peer is selected then a <span class="bold_code bc-15"><a href="diameter_app.html#Mod:prepare_retransmit-3">prepare_retransmit/3</a></span>
callback takes place, after which the semantics are the same as
following an initial <span class="bold_code bc-15"><a href="diameter_app.html#Mod:prepare_request-3">prepare_request/3</a></span> callback.</p>
</li>

<li>
<p>
If an encode error takes place during
retransmission then the request process fails and
<span class="code">{error,failure}</span> is returned.</p>
</li>

<li>
<p>
If an application callback made in processing the request fails
(pick_peer, prepare_request, prepare_retransmit,
handle_answer or handle_error) then either
<span class="code">{error,encode}</span> or <span class="code">{error,failure}</span>
is returned depending on whether or not there has been an
attempt to send the request over the transport.</p>
</li>

</ul>

<p>
Note that <span class="code">{error,encode}</span> is the only return value which
guarantees that the request has <strong>not</strong> been sent over the
transport connection.</p>

</p></div>



<table class="func-table"><tr class="func-tr">
<td class="func-td"><div class="bold_code fun-type"><span onMouseOver="document.getElementById('ghlink-origin_state_id-0-idm2139').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-origin_state_id-0-idm2139').style.visibility = 'hidden';"><span id="ghlink-origin_state_id-0-idm2139" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L1744" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="origin_state_id-0" href="#origin_state_id-0">origin_state_id() -&gt; Unsigned32()</a></span></div></td>
<td class="func-since-td"><span class="since">OTP R14B03</span></td>
</tr></table>
<div class="REFBODY rb-7"><p>
<p>
Return a reasonable value for use as Origin-State-Id in
outgoing messages.</p>

<p>
The value returned is the number of seconds since 19680120T031408Z,
the first value that can be encoded as a Diameter <span class="code"><span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">Time()</a></span></span>,
at the time the diameter application was started.</p>

</p></div>



<table class="func-table"><tr class="func-tr">
<td class="func-td"><div class="bold_code fun-type"><span onMouseOver="document.getElementById('ghlink-remove_transport-2-idm2148').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-remove_transport-2-idm2148').style.visibility = 'hidden';"><span id="ghlink-remove_transport-2-idm2148" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L1762" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="remove_transport-2" href="#remove_transport-2">remove_transport(SvcName, Pred) -&gt; ok | {error, Reason}</a></span></div></td>
<td class="func-since-td"><span class="since">OTP R14B03</span></td>
</tr></table>
<div class="REFBODY rb-5">
<h3 class="func-types-title">Types</h3>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">SvcName = <span class="bold_code bc-17"><a href="#service_name">service_name()</a></span></span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">Pred = Fun | MFA | <span class="bold_code bc-17"><a href="#transport_ref">transport_ref()</a></span> | list() | true | false</span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type"></span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">Fun = fun((<span class="bold_code bc-17"><a href="#transport_ref">transport_ref()</a></span>, connect|listen, list()) -&gt; boolean())</span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type"> | fun((<span class="bold_code bc-17"><a href="#transport_ref">transport_ref()</a></span>, list()) -&gt; boolean())</span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type"> | fun((list()) -&gt; boolean())</span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">MFA = {atom(), atom(), list()}</span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">Reason = term()</span><br>
</div>
</div>
<div class="REFBODY rb-7"><p>
<p>
Remove previously added transports.</p>

<p>
<span class="code">Pred</span> determines which transports to remove.
An arity-3-valued <span class="code">Pred</span> removes all transports for which
<span class="code">Pred(Ref, Type, Opts)</span> returns <span class="code">true</span>, where <span class="code">Type</span> and
<span class="code">Opts</span> are as passed to <span class="bold_code bc-17"><a href="#add_transport-2">add_transport/2</a></span> and <span class="code">Ref</span> is
as returned by it.
The remaining forms are equivalent to an arity-3 fun as follows.</p>

<div class="example"><pre>
Pred = fun(transport_ref(), list()):  fun(Ref, _, Opts) -&gt; Pred(Ref, Opts) end
Pred = fun(list()):                   fun(_, _, Opts) -&gt; Pred(Opts) end
Pred = transport_ref():               fun(Ref, _, _)  -&gt; Pred == Ref end
Pred = list():                        fun(_, _, Opts) -&gt; [] == Pred -- Opts end
Pred = true:                          fun(_, _, _) -&gt; true end
Pred = false:                         fun(_, _, _) -&gt; false end
Pred = {M,F,A}:  fun(Ref, Type, Opts) -&gt; apply(M, F, [Ref, Type, Opts | A]) end
</pre></div>

<p>
Removing a transport causes the corresponding transport processes to
be terminated.
Whether or not a DPR message is sent to a peer is
controlled by value of <span class="bold_code bc-17"><a href="#disconnect_cb">disconnect_cb</a></span>
configured on the transport.</p>

</p></div>



<table class="func-table"><tr class="func-tr">
<td class="func-td"><div class="bold_code fun-type"><span onMouseOver="document.getElementById('ghlink-service_info-2-idm2178').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-service_info-2-idm2178').style.visibility = 'hidden';"><span id="ghlink-service_info-2-idm2178" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L1809" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="service_info-2" href="#service_info-2">service_info(SvcName, Info) -&gt; term()</a></span></div></td>
<td class="func-since-td"><span class="since">OTP R14B03</span></td>
</tr></table>
<div class="REFBODY rb-5">
<h3 class="func-types-title">Types</h3>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">SvcName = <span class="bold_code bc-17"><a href="#service_name">service_name()</a></span></span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">Info = Item | [Info]</span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">Item = atom()</span><br>
</div>
</div>
<div class="REFBODY rb-7"><p>
<p>
Return information about a started service.
Requesting info for an unknown service causes <span class="code">undefined</span> to be
returned.
Requesting a list of items causes a tagged list to be
returned.</p>

<p>
<span class="code">Item</span> can be one of the following.</p>

<dl>

<dt><strong><span class="code">'Origin-Host'</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">'Origin-Realm'</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">'Vendor-Id'</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">'Product-Name'</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">'Origin-State-Id'</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">'Host-IP-Address'</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">'Supported-Vendor'</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">'Auth-Application-Id'</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">'Inband-Security-Id'</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">'Acct-Application-Id'</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">'Vendor-Specific-Application-Id'</span></strong></dt>
<dd></dd>
<dt><strong><span class="code">'Firmware-Revision'</span></strong></dt>
<dd>
<p>
Return a capability value as configured with <span class="bold_code bc-17"><a href="#start_service-2">start_service/2</a></span>.</p>
</dd>

<dt><strong><span class="code">applications</span></strong></dt>
<dd>
<p>
Return the list of applications as configured with <span class="bold_code bc-17"><a href="#start_service-2">start_service/2</a></span>.
</p>
</dd>

<dt><strong><span class="code">capabilities</span></strong></dt>
<dd>
<p>
Return a tagged list of all capabilities values as configured with
<span class="bold_code bc-17"><a href="#start_service-2">start_service/2</a></span>.</p>
</dd>

<dt><strong><span class="code">transport</span></strong></dt>
<dd>
<p>
Return a list containing one entry for each of the service's transport
as configured with <span class="bold_code bc-17"><a href="#add_transport-2">add_transport/2</a></span>.
Each entry is a tagged list containing both configuration and
information about established peer connections.
An example return value with for a client service with Origin-Host
"client.example.com" configured with a single transport connected to
"server.example.com" might look as follows.</p>

<div class="example"><pre>
[[{ref,#Ref&lt;0.0.0.93&gt;},
  {type,connect},
  {options,[{transport_module,diameter_tcp},
            {transport_config,[{ip,{127,0,0,1}},
                               {raddr,{127,0,0,1}},
                               {rport,3868},
                               {reuseaddr,true}]}]},
  {watchdog,{&lt;0.66.0&gt;,-576460736368485571,okay}},
  {peer,{&lt;0.67.0&gt;,-576460736357885808}},
  {apps,[{0,common}]},
  {caps,[{origin_host,{"client.example.com","server.example.com"}},
         {origin_realm,{"example.com","example.com"}},
         {host_ip_address,{[{127,0,0,1}],[{127,0,0,1}]}},
         {vendor_id,{0,193}},
         {product_name,{"Client","Server"}},
         {origin_state_id,{[],[]}},
         {supported_vendor_id,{[],[]}},
         {auth_application_id,{[0],[0]}},
         {inband_security_id,{[],[0]}},
         {acct_application_id,{[],[]}},
         {vendor_specific_application_id,{[],[]}},
         {firmware_revision,{[],[]}},
         {avp,{[],[]}}]},
  {port,[{owner,&lt;0.69.0&gt;},
         {module,diameter_tcp},
         {socket,{{127,0,0,1},48758}},
         {peer,{{127,0,0,1},3868}},
         {statistics,[{recv_oct,656},
                      {recv_cnt,6},
                      {recv_max,148},
                      {recv_avg,109},
                      {recv_dvi,19},
                      {send_oct,836},
                      {send_cnt,6},
                      {send_max,184},
                      {send_avg,139},
                      {send_pend,0}]}]},
  {statistics,[{{{0,258,0},recv},3},
               {{{0,258,1},send},3},
               {{{0,258,0},recv,{'Result-Code',2001}},3},
               {{{0,257,0},recv},1},
               {{{0,257,1},send},1},
               {{{0,257,0},recv,{'Result-Code',2001}},1},
               {{{0,280,1},recv},2},
               {{{0,280,0},send},2},
               {{{0,280,0},send,{'Result-Code',2001}},2}]}]]
</pre></div>

<p>
Here <span class="code">ref</span> is a <span class="code"><span class="bold_code bc-17"><a href="#transport_ref">transport_ref()</a></span></span> and <span class="code">options</span>
the corresponding <span class="code"><span class="bold_code bc-17"><a href="#transport_opt">transport_opt()</a></span></span> list passed to
<span class="bold_code bc-17"><a href="#add_transport-2">add_transport/2</a></span>.
The <span class="code">watchdog</span> entry shows the state of a connection's RFC 3539 watchdog
state machine.
The <span class="code">peer</span> entry identifies the <span class="code"><span class="bold_code bc-15"><a href="diameter_app.html#peer_ref">diameter_app:peer_ref()</a></span></span> for
which there will have been <span class="bold_code bc-15"><a href="diameter_app.html#Mod:peer_up-3">peer_up/3</a></span> callbacks for the
Diameter applications identified by the <span class="code">apps</span> entry,
<span class="code">common</span> being the <span class="code"><span class="bold_code bc-17"><a href="#application_alias">application_alias()</a></span></span>.
The <span class="code">caps</span> entry identifies the capabilities sent by the local
node and received from the peer during capabilities exchange.
The <span class="code">port</span> entry displays socket-level information about the
transport connection.
The <span class="code">statistics</span> entry presents Diameter-level counters,
an entry like <span class="code">{{{0,280,1},recv},2}</span> saying that the client has
received 2 DWR messages: <span class="code">{0,280,1} = {Application_Id, Command_Code,
R_Flag}</span>.</p>

<p>
Note that <span class="code">watchdog</span>, <span class="code">peer</span>, <span class="code">apps</span>, <span class="code">caps</span>
and <span class="code">port</span> entries depend on connectivity
with the peer and may not be present.
Note also that the <span class="code">statistics</span> entry presents values accumulated
during the lifetime of the transport configuration.</p>

<p>
A listening transport presents its information slightly differently
since there may be multiple accepted connections for the same
<span class="code"><span class="bold_code bc-17"><a href="#transport_ref">transport_ref()</a></span></span>.
The <span class="code">transport</span> info returned by a server with a single client
connection might look as follows.</p>

<div class="example"><pre>
[[{ref,#Ref&lt;0.0.0.61&gt;},
  {type,listen},
  {options,[{transport_module,diameter_tcp},
            {transport_config,[{reuseaddr,true},
                               {ip,{127,0,0,1}},
                               {port,3868}]}]},
  {accept,[[{watchdog,{&lt;0.56.0&gt;,-576460739249514012,okay}},
            {peer,{&lt;0.58.0&gt;,-576460638229179167}},
            {apps,[{0,common}]},
            {caps,[{origin_host,{"server.example.com","client.example.com"}},
                   {origin_realm,{"example.com","example.com"}},
                   {host_ip_address,{[{127,0,0,1}],[{127,0,0,1}]}},
                   {vendor_id,{193,0}},
                   {product_name,{"Server","Client"}},
                   {origin_state_id,{[],[]}},
                   {supported_vendor_id,{[],[]}},
                   {auth_application_id,{[0],[0]}},
                   {inband_security_id,{[],[]}},
                   {acct_application_id,{[],[]}},
                   {vendor_specific_application_id,{[],[]}},
                   {firmware_revision,{[],[]}},
                   {avp,{[],[]}}]},
            {port,[{owner,&lt;0.62.0&gt;},
                   {module,diameter_tcp},
                   {socket,{{127,0,0,1},3868}},
                   {peer,{{127,0,0,1},48758}},
                   {statistics,[{recv_oct,1576},
                                {recv_cnt,16},
                                {recv_max,184},
                                {recv_avg,98},
                                {recv_dvi,26},
                                {send_oct,1396},
                                {send_cnt,16},
                                {send_max,148},
                                {send_avg,87},
                                {send_pend,0}]}]}],
           [{watchdog,{&lt;0.72.0&gt;,-576460638229717546,initial}}]]},
  {statistics,[{{{0,280,0},recv},7},
               {{{0,280,1},send},7},
               {{{0,280,0},recv,{'Result-Code',2001}},7},
               {{{0,258,1},recv},3},
               {{{0,258,0},send},3},
               {{{0,258,0},send,{'Result-Code',2001}},3},
               {{{0,280,1},recv},5},
               {{{0,280,0},send},5},
               {{{0,280,0},send,{'Result-Code',2001}},5},
               {{{0,257,1},recv},1},
               {{{0,257,0},send},1},
               {{{0,257,0},send,{'Result-Code',2001}},1}]}]]
</pre></div>

<p>
The information presented here is as in the <span class="code">connect</span> case except
that the client connections are grouped under an <span class="code">accept</span> tuple.</p>

<p>
Whether or not the <span class="bold_code bc-17"><a href="#transport_opt">transport_opt()</a></span> <span class="code">pool_size</span> has been
configured affects the format
of the listing in the case of a connecting transport, since a value
greater than 1 implies multiple transport processes for the same
<span class="code"><span class="bold_code bc-17"><a href="#transport_ref">transport_ref()</a></span></span>, as in the listening case.
The format in this case is similar to the listening case, with a
<span class="code">pool</span> tuple in place of an <span class="code">accept</span> tuple.</p>

</dd>

<dt><strong><span class="code">connections</span></strong></dt>
<dd>
<p>
Return a list containing one entry for every established transport
connection whose watchdog state machine is not in the <span class="code">down</span>
state.
This is a flat view of <span class="code">transport</span> info which lists only active
connections and for which Diameter-level statistics are accumulated
only for the lifetime of the transport connection.
A return value for the server above might look as follows.</p>

<div class="example"><pre>
[[{ref,#Ref&lt;0.0.0.61&gt;},
  {type,accept},
  {options,[{transport_module,diameter_tcp},
            {transport_config,[{reuseaddr,true},
                               {ip,{127,0,0,1}},
                               {port,3868}]}]},
  {watchdog,{&lt;0.56.0&gt;,-576460739249514012,okay}},
  {peer,{&lt;0.58.0&gt;,-576460638229179167}},
  {apps,[{0,common}]},
  {caps,[{origin_host,{"server.example.com","client.example.com"}},
         {origin_realm,{"example.com","example.com"}},
         {host_ip_address,{[{127,0,0,1}],[{127,0,0,1}]}},
         {vendor_id,{193,0}},
         {product_name,{"Server","Client"}},
         {origin_state_id,{[],[]}},
         {supported_vendor_id,{[],[]}},
         {auth_application_id,{[0],[0]}},
         {inband_security_id,{[],[]}},
         {acct_application_id,{[],[]}},
         {vendor_specific_application_id,{[],[]}},
         {firmware_revision,{[],[]}},
         {avp,{[],[]}}]},
  {port,[{owner,&lt;0.62.0&gt;},
         {module,diameter_tcp},
         {socket,{{127,0,0,1},3868}},
         {peer,{{127,0,0,1},48758}},
         {statistics,[{recv_oct,10124},
                      {recv_cnt,132},
                      {recv_max,184},
                      {recv_avg,76},
                      {recv_dvi,9},
                      {send_oct,10016},
                      {send_cnt,132},
                      {send_max,148},
                      {send_avg,75},
                      {send_pend,0}]}]},
  {statistics,[{{{0,280,0},recv},62},
               {{{0,280,1},send},62},
               {{{0,280,0},recv,{'Result-Code',2001}},62},
               {{{0,258,1},recv},3},
               {{{0,258,0},send},3},
               {{{0,258,0},send,{'Result-Code',2001}},3},
               {{{0,280,1},recv},66},
               {{{0,280,0},send},66},
               {{{0,280,0},send,{'Result-Code',2001}},66},
               {{{0,257,1},recv},1},
               {{{0,257,0},send},1},
               {{{0,257,0},send,{'Result-Code',2001}},1}]}]]
</pre></div>

<p>
Note that there may be multiple entries with the same <span class="code">ref</span>, in
contrast to <span class="code">transport</span> info.</p>
</dd>

<dt><strong><span class="code">statistics</span></strong></dt>
<dd>
<p>
Return a <span class="code">{{Counter, Ref}, non_neg_integer()}</span> list of counter values.
<span class="code">Ref</span> can be either a <span class="code"><span class="bold_code bc-17"><a href="#transport_ref">transport_ref()</a></span></span>
or a <span class="code"><span class="bold_code bc-15"><a href="diameter_app.html#peer_ref">diameter_app:peer_ref()</a></span></span>.
Entries for the latter are folded into corresponding entries for the
former as peer connections go down.
Entries for both are removed at <span class="bold_code bc-17"><a href="#remove_transport-2">remove_transport/2</a></span>.
The Diameter-level statistics returned by <span class="code">transport</span> and
<span class="code">connections</span> info are based upon these entries.</p>
</dd>

<dt><strong><span class="code"><span class="bold_code bc-15"><a href="diameter_app.html#peer_ref">diameter_app:peer_ref()</a></span></span></strong></dt>
<dd>
<p>
Return transport configuration associated with a single peer, as
passed to <span class="bold_code bc-17"><a href="#add_transport-2">add_transport/2</a></span>.
The returned list is empty if the peer is unknown.
Otherwise it contains the <span class="code">ref</span>, <span class="code">type</span> and <span class="code">options</span>
tuples as in <span class="code">transport</span> and <span class="code">connections</span> info above.
For example:</p>

<div class="example"><pre>
[{ref,#Ref&lt;0.0.0.61&gt;},
 {type,accept},
 {options,[{transport_module,diameter_tcp},
           {transport_config,[{reuseaddr,true},
                              {ip,{127,0,0,1}},
                              {port,3868}]}]}]
</pre></div>
</dd>

</dl>

</p></div>



<table class="func-table"><tr class="func-tr">
<td class="func-td"><div class="bold_code fun-type"><span onMouseOver="document.getElementById('ghlink-services-0-idm2325').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-services-0-idm2325').style.visibility = 'hidden';"><span id="ghlink-services-0-idm2325" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L2128" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="services-0" href="#services-0">services() -&gt; [SvcName]</a></span></div></td>
<td class="func-since-td"><span class="since">OTP R14B03</span></td>
</tr></table>
<div class="REFBODY rb-5">
<h3 class="func-types-title">Types</h3>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">SvcName = <span class="bold_code bc-17"><a href="#service_name">service_name()</a></span></span><br>
</div>
</div>
<div class="REFBODY rb-7"><p>
<p>
Return the list of started services.</p>

</p></div>



<table class="func-table"><tr class="func-tr">
<td class="func-td"><div class="bold_code fun-type"><span onMouseOver="document.getElementById('ghlink-session_id-1-idm2333').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-session_id-1-idm2333').style.visibility = 'hidden';"><span id="ghlink-session_id-1-idm2333" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L2143" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="session_id-1" href="#session_id-1">session_id(Ident) -&gt; OctetString()</a></span></div></td>
<td class="func-since-td"><span class="since">OTP R14B03</span></td>
</tr></table>
<div class="REFBODY rb-5">
<h3 class="func-types-title">Types</h3>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">Ident = <span class="bold_code bc-15"><a href="diameter_dict.html#DATA_TYPES">DiameterIdentity()</a></span></span><br>
</div>
</div>
<div class="REFBODY rb-7"><p>
<p>
Return a value for a Session-Id AVP.</p>

<p>
The value has the form required by section 8.8 of RFC 6733.
Ident should be the Origin-Host of the peer from which
the message containing the returned value will be sent.</p>

</p></div>


<table class="func-table"><tr class="func-tr">
<td class="func-td"><div class="bold_code fun-type"><span onMouseOver="document.getElementById('ghlink-start-0-idm2343').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-start-0-idm2343').style.visibility = 'hidden';"><span id="ghlink-start-0-idm2343" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L2162" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="start-0" href="#start-0">start() -&gt; ok | {error, Reason}</a></span></div></td>
<td class="func-since-td"><span class="since">OTP R14B03</span></td>
</tr></table>
<div class="REFBODY rb-7"><p>
<p>
Start the diameter application.</p>

<p>
The diameter application must be started before starting a service.
In a production system this is typically accomplished by a boot
file, not by calling <span class="code">start/0</span> explicitly.</p>

</p></div>


<table class="func-table"><tr class="func-tr">
<td class="func-td"><div class="bold_code fun-type"><span onMouseOver="document.getElementById('ghlink-start_service-2-idm2350').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-start_service-2-idm2350').style.visibility = 'hidden';"><span id="ghlink-start_service-2-idm2350" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L2178" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="start_service-2" href="#start_service-2">start_service(SvcName, Options) -&gt; ok | {error, Reason}</a></span></div></td>
<td class="func-since-td"><span class="since">OTP R14B03</span></td>
</tr></table>
<div class="REFBODY rb-5">
<h3 class="func-types-title">Types</h3>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">SvcName = <span class="bold_code bc-17"><a href="#service_name">service_name()</a></span></span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">Options = [<span class="bold_code bc-17"><a href="#service_opt">service_opt()</a></span>]</span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">Reason  = term()</span><br>
</div>
</div>
<div class="REFBODY rb-7"><p>
<p>
Start a diameter service.</p>

<p>
A service defines a locally-implemented Diameter node, specifying the
capabilities to be advertised during capabilities exchange.
Transports are added to a service using <span class="bold_code bc-17"><a href="#add_transport-2">add_transport/2</a></span>.
</p>

<div class="note">
<div class="label">Note</div>
<div class="content"><p>
<p>
A transport can both override its service's
capabilities and restrict its supported Diameter applications so
"service = Diameter node as identified by Origin-Host" is not
necessarily the case.</p>
</p></div>
</div>

</p></div>


<table class="func-table"><tr class="func-tr">
<td class="func-td"><div class="bold_code fun-type"><span onMouseOver="document.getElementById('ghlink-stop-0-idm2365').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-stop-0-idm2365').style.visibility = 'hidden';"><span id="ghlink-stop-0-idm2365" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L2208" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="stop-0" href="#stop-0">stop() -&gt; ok | {error, Reason}</a></span></div></td>
<td class="func-since-td"><span class="since">OTP R14B03</span></td>
</tr></table>
<div class="REFBODY rb-7"><p>
<p>
Stop the diameter application.</p>

<p>
</p>

</p></div>


<table class="func-table"><tr class="func-tr">
<td class="func-td"><div class="bold_code fun-type"><span onMouseOver="document.getElementById('ghlink-stop_service-1-idm2371').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-stop_service-1-idm2371').style.visibility = 'hidden';"><span id="ghlink-stop_service-1-idm2371" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L2222" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="stop_service-1" href="#stop_service-1">stop_service(SvcName) -&gt; ok | {error, Reason}</a></span></div></td>
<td class="func-since-td"><span class="since">OTP R14B03</span></td>
</tr></table>
<div class="REFBODY rb-5">
<h3 class="func-types-title">Types</h3>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">SvcName = <span class="bold_code bc-17"><a href="#service_name">service_name()</a></span></span><br>
</div>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">Reason = term()</span><br>
</div>
</div>
<div class="REFBODY rb-7"><p>
<p>
Stop a diameter service.</p>

<p>
Stopping a service causes all associated transport connections to be
broken.
A DPR message will be sent as in the case of <span class="bold_code bc-17"><a href="#remove_transport-2">remove_transport/2</a></span>.</p>

<div class="note">
<div class="label">Note</div>
<div class="content"><p>
<p>
Stopping a service does not remove any associated transports:
<span class="bold_code bc-17"><a href="#remove_transport-2">remove_transport/2</a></span> must
be called to remove transport configuration.</p>
</p></div>
</div>

</p></div>



<table class="func-table"><tr class="func-tr">
<td class="func-td"><div class="bold_code fun-type"><span onMouseOver="document.getElementById('ghlink-subscribe-1-idm2385').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-subscribe-1-idm2385').style.visibility = 'hidden';"><span id="ghlink-subscribe-1-idm2385" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L2250" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="subscribe-1" href="#subscribe-1">subscribe(SvcName) -&gt; true</a></span></div></td>
<td class="func-since-td"><span class="since">OTP R14B03</span></td>
</tr></table>
<div class="REFBODY rb-5">
<h3 class="func-types-title">Types</h3>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">SvcName = <span class="bold_code bc-17"><a href="#service_name">service_name()</a></span></span><br>
</div>
</div>
<div class="REFBODY rb-7"><p>
<p>
Subscribe to <span class="code"><span class="bold_code bc-17"><a href="#service_event">service_event()</a></span></span> messages from
a service.</p>

<p>
It is not an error to subscribe to events from a service
that does not yet exist.
Doing so before adding transports is required to guarantee the
reception of all transport-related events.</p>

</p></div>



<table class="func-table"><tr class="func-tr">
<td class="func-td"><div class="bold_code fun-type"><span onMouseOver="document.getElementById('ghlink-unsubscribe-1-idm2396').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-unsubscribe-1-idm2396').style.visibility = 'hidden';"><span id="ghlink-unsubscribe-1-idm2396" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L2272" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="unsubscribe-1" href="#unsubscribe-1">unsubscribe(SvcName) -&gt; true</a></span></div></td>
<td class="func-since-td"><span class="since">OTP R14B03</span></td>
</tr></table>
<div class="REFBODY rb-5">
<h3 class="func-types-title">Types</h3>
<div class="REFTYPES rt-4">
<span class="bold_code fun-param-type">SvcName = <span class="bold_code bc-17"><a href="#service_name">service_name()</a></span></span><br>
</div>
</div>
<div class="REFBODY rb-7"><p>
<p>
Unsubscribe to event messages from a service.</p>

</p></div>

</div>



<h3><span onMouseOver="document.getElementById('ghlink-see-also-idm2403').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-see-also-idm2403').style.visibility = 'hidden';"><span id="ghlink-see-also-idm2403" class="ghlink"><a href="https://github.com/erlang/otp/edit/maint/lib/diameter/doc/src/diameter.xml#L2289" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil"></span></a></span><a class="title_link" name="see-also" href="#see-also">SEE ALSO</a></span></h3>
<div class="REFBODY rb-3">


<p>
<span class="bold_code bc-19"><a href="diameter_app.html">diameter_app(3)</a></span>, <span class="bold_code bc-19"><a href="diameter_transport.html">diameter_transport(3)</a></span>, <span class="bold_code bc-19"><a href="diameter_dict.html">diameter_dict(4)</a></span></p>

</div>

</div>
<div class="footer">
<hr>
<p>Copyright  2011-2021 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script type="text/javascript">window.__otpTopDocDir = '../js/';</script><script type="text/javascript" src="../js/highlight.js"></script>
</body>
</html>
