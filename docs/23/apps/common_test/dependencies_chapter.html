<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:erl="http://erlang.org" xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../../otp_doc.css" type="text/css">
<title>Erlang -- Dependencies between Test Cases and Suites</title>
</head>
<body>
<div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../../js/erlresolvelinks.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function getWinHeight() {
                var myHeight = 0;
                if( typeof( window.innerHeight ) == 'number' ) {
                  //Non-IE
                  myHeight = window.innerHeight;
                } else if( document.documentElement && ( document.documentElement.clientWidth ||
                                                         document.documentElement.clientHeight ) ) {
                  //IE 6+ in 'standards compliant mode'
                  myHeight = document.documentElement.clientHeight;
                } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
                  //IE 4 compatible
                  myHeight = document.body.clientHeight;
                }
                return myHeight;
              }

              function setscrollpos() {
                var objf=document.getElementById('loadscrollpos');
                 document.getElementById("leftnav").scrollTop = objf.offsetTop - getWinHeight()/2;
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //--></script><div id="leftnav"><div class="leftnav-tube">
<div class="erlang-logo-wrapper"><a href="../../index.html"><img alt="Erlang Logo" src="../../erlang-logo.png" class="erlang-logo"></a></div>
<p class="section-title">Common Test</p>
<p class="section-subtitle">User's Guide</p>
<p class="section-version">Version 1.20.2.2</p>
<ul class="panel-sections">
<li><a href="users_guide.html">User's Guide</a></li>
<li><a href="index.html">Reference Manual</a></li>
<li><a href="release_notes.html">Release Notes</a></li>
<li><a href="common_test.pdf">PDF</a></li>
<li><a href="../../index.html">Top</a></li>
</ul>
<ul class="expand-collapse-items">
<li><a href="javascript:openAllFlips()">Expand All</a></li>
<li><a href="javascript:closeAllFlips()">Contract All</a></li>
</ul>
<h3>Chapters</h3>
<ul class="flipMenu" imagePath="../../js/flipmenu">
<li id="no" title="Introduction" expanded="false">Introduction<ul>
<li><a href="introduction.html">
              Top of chapter
            </a></li>
<li title="Scope"><a href="introduction.html#scope">Scope</a></li>
<li title="Prerequisites"><a href="introduction.html#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li id="no" title="Common Test Basics" expanded="false">Common Test Basics<ul>
<li><a href="basics_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="basics_chapter.html#general">General</a></li>
<li title="Test Suite Organisation"><a href="basics_chapter.html#test-suite-organisation">Test Suite Organisation</a></li>
<li title="Support Libraries"><a href="basics_chapter.html#support-libraries">Support Libraries</a></li>
<li title="Suites and Test Cases"><a href="basics_chapter.html#suites-and-test-cases">Suites and Test Cases</a></li>
<li title="External Interfaces"><a href="basics_chapter.html#external-interfaces">External Interfaces</a></li>
</ul>
</li>
<li id="no" title="Getting Started" expanded="false">Getting Started<ul>
<li><a href="getting_started_chapter.html">
              Top of chapter
            </a></li>
<li title="Introduction for Newcomers"><a href="getting_started_chapter.html#introduction-for-newcomers">Introduction for Newcomers</a></li>
<li title="Test Case Execution"><a href="getting_started_chapter.html#test-case-execution">Test Case Execution</a></li>
<li title="A Simple Test Suite"><a href="getting_started_chapter.html#a-simple-test-suite">A Simple Test Suite</a></li>
<li title="A Test Suite with Configuration Functions"><a href="getting_started_chapter.html#a-test-suite-with-configuration-functions">A Test Suite with Configuration Functions</a></li>
<li title="Questions and Answers"><a href="getting_started_chapter.html#questions-and-answers">Questions and Answers</a></li>
</ul>
</li>
<li id="no" title="Installation" expanded="false">Installation<ul>
<li><a href="install_chapter.html">
              Top of chapter
            </a></li>
<li title="General Information"><a href="install_chapter.html#general-information">General Information</a></li>
</ul>
</li>
<li id="no" title="Writing Test Suites" expanded="false">Writing Test Suites<ul>
<li><a href="write_test_chapter.html">
              Top of chapter
            </a></li>
<li title="Support for Test Suite Authors"><a href="write_test_chapter.html#support-for-test-suite-authors">Support for Test Suite Authors</a></li>
<li title="Test Suites"><a href="write_test_chapter.html#test-suites">Test Suites</a></li>
<li title="Init and End per Suite"><a href="write_test_chapter.html#init-and-end-per-suite">Init and End per Suite</a></li>
<li title="Init and End per Test Case"><a href="write_test_chapter.html#init-and-end-per-test-case">Init and End per Test Case</a></li>
<li title="Test Cases"><a href="write_test_chapter.html#test-cases">Test Cases</a></li>
<li title="Test Case Information Function"><a href="write_test_chapter.html#test-case-information-function">Test Case Information Function</a></li>
<li title="Test Suite Information Function"><a href="write_test_chapter.html#test-suite-information-function">Test Suite Information Function</a></li>
<li title="Test Case Groups"><a href="write_test_chapter.html#test-case-groups">Test Case Groups</a></li>
<li title="Parallel Property and Nested Groups"><a href="write_test_chapter.html#parallel-property-and-nested-groups">Parallel Property and Nested Groups</a></li>
<li title="Parallel Test Cases and I/O"><a href="write_test_chapter.html#parallel-test-cases-and-i-o">Parallel Test Cases and I/O</a></li>
<li title="Repeated Groups"><a href="write_test_chapter.html#repeated-groups">Repeated Groups</a></li>
<li title="Shuffled Test Case Order"><a href="write_test_chapter.html#shuffled-test-case-order">Shuffled Test Case Order</a></li>
<li title="Group Information Function"><a href="write_test_chapter.html#group-information-function">Group Information Function</a></li>
<li title="Information Functions for Init- and End-Configuration"><a href="write_test_chapter.html#information-functions-for-init--and-end-configuration">Information Functions for Init- and End-Configuration</a></li>
<li title="Data and Private Directories"><a href="write_test_chapter.html#data-and-private-directories">Data and Private Directories</a></li>
<li title="Execution Environment"><a href="write_test_chapter.html#execution-environment">Execution Environment</a></li>
<li title="Timetrap Time-Outs"><a href="write_test_chapter.html#timetrap-time-outs">Timetrap Time-Outs</a></li>
<li title="Logging - Categories and Verbosity Levels"><a href="write_test_chapter.html#logging---categories-and-verbosity-levels">Logging - Categories and Verbosity Levels</a></li>
<li title="Illegal Dependencies"><a href="write_test_chapter.html#illegal-dependencies">Illegal Dependencies</a></li>
</ul>
</li>
<li id="no" title="Test Structure" expanded="false">Test Structure<ul>
<li><a href="test_structure_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="test_structure_chapter.html#general">General</a></li>
<li title="Skipping Test Cases"><a href="test_structure_chapter.html#skipping-test-cases">Skipping Test Cases</a></li>
<li title="Definition of Terms"><a href="test_structure_chapter.html#definition-of-terms">Definition of Terms</a></li>
</ul>
</li>
<li id="no" title="Examples and Templates" expanded="false">Examples and Templates<ul>
<li><a href="example_chapter.html">
              Top of chapter
            </a></li>
<li title="Test Suite Example"><a href="example_chapter.html#test-suite-example">Test Suite Example</a></li>
<li title="Test Suite Templates"><a href="example_chapter.html#test-suite-templates">Test Suite Templates</a></li>
</ul>
</li>
<li id="no" title="Running Tests and Analyzing Results" expanded="false">Running Tests and Analyzing Results<ul>
<li><a href="run_test_chapter.html">
              Top of chapter
            </a></li>
<li title="Using the Common Test Framework"><a href="run_test_chapter.html#using-the-common-test-framework">Using the Common Test Framework</a></li>
<li title="Automatic Compilation of Test Suites and Help Modules"><a href="run_test_chapter.html#automatic-compilation-of-test-suites-and-help-modules">Automatic Compilation of Test Suites and Help Modules</a></li>
<li title="Running Tests from the OS Command Line"><a href="run_test_chapter.html#running-tests-from-the-os-command-line">Running Tests from the OS Command Line</a></li>
<li title="Running Tests from the Erlang Shell or from an Erlang Program"><a href="run_test_chapter.html#running-tests-from-the-erlang-shell-or-from-an-erlang-program">Running Tests from the Erlang Shell or from an Erlang Program</a></li>
<li title="Test Case Group Execution"><a href="run_test_chapter.html#test-case-group-execution">Test Case Group Execution</a></li>
<li title="Running the Interactive Shell Mode"><a href="run_test_chapter.html#running-the-interactive-shell-mode">Running the Interactive Shell Mode</a></li>
<li title="Step-by-Step Execution of Test Cases with the Erlang Debugger"><a href="run_test_chapter.html#step-by-step-execution-of-test-cases-with-the-erlang-debugger">Step-by-Step Execution of Test Cases with the Erlang Debugger</a></li>
<li title="Test Specifications"><a href="run_test_chapter.html#test-specifications">Test Specifications</a></li>
<li title="Log Files"><a href="run_test_chapter.html#log-files">Log Files</a></li>
<li title="HTML Style Sheets"><a href="run_test_chapter.html#html-style-sheets">HTML Style Sheets</a></li>
<li title="Repeating Tests"><a href="run_test_chapter.html#repeating-tests">Repeating Tests</a></li>
<li title="Silent Connections"><a href="run_test_chapter.html#silent-connections">Silent Connections</a></li>
</ul>
</li>
<li id="no" title="External Configuration Data" expanded="false">External Configuration Data<ul>
<li><a href="config_file_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="config_file_chapter.html#general">General</a></li>
<li title="Syntax"><a href="config_file_chapter.html#syntax">Syntax</a></li>
<li title="Requiring and Reading Configuration Data"><a href="config_file_chapter.html#requiring-and-reading-configuration-data">Requiring and Reading Configuration Data</a></li>
<li title="Using Configuration Variables Defined in Multiple Files"><a href="config_file_chapter.html#using-configuration-variables-defined-in-multiple-files">Using Configuration Variables Defined in Multiple Files</a></li>
<li title="Encrypted Configuration Files"><a href="config_file_chapter.html#encrypted-configuration-files">Encrypted Configuration Files</a></li>
<li title="Opening Connections Using Configuration Data"><a href="config_file_chapter.html#opening-connections-using-configuration-data">Opening Connections Using Configuration Data</a></li>
<li title="User-Specific Configuration Data Formats"><a href="config_file_chapter.html#user-specific-configuration-data-formats">User-Specific Configuration Data Formats</a></li>
<li title="Examples of Configuration Data Handling"><a href="config_file_chapter.html#examples-of-configuration-data-handling">Examples of Configuration Data Handling</a></li>
<li title="Example of User-Specific Configuration Handler"><a href="config_file_chapter.html#example-of-user-specific-configuration-handler">Example of User-Specific Configuration Handler</a></li>
</ul>
</li>
<li id="no" title="Code Coverage Analysis" expanded="false">Code Coverage Analysis<ul>
<li><a href="cover_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="cover_chapter.html#general">General</a></li>
<li title="Use"><a href="cover_chapter.html#use">Use</a></li>
<li title="Stopping the Cover Tool When Tests Are Completed"><a href="cover_chapter.html#stopping-the-cover-tool-when-tests-are-completed">Stopping the Cover Tool When Tests Are Completed</a></li>
<li title="The Cover Specification File"><a href="cover_chapter.html#the-cover-specification-file">The Cover Specification File</a></li>
<li title="Cross Cover Analysis"><a href="cover_chapter.html#cross-cover-analysis">Cross Cover Analysis</a></li>
<li title="Logging"><a href="cover_chapter.html#logging">Logging</a></li>
</ul>
</li>
<li id="no" title="Using Common Test for Large-Scale Testing" expanded="false">Using Common Test for Large-Scale Testing<ul>
<li><a href="ct_master_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="ct_master_chapter.html#general">General</a></li>
<li title="Use"><a href="ct_master_chapter.html#use">Use</a></li>
<li title="Test Specifications"><a href="ct_master_chapter.html#test-specifications">Test Specifications</a></li>
<li title="Automatic Startup of Test Target Nodes"><a href="ct_master_chapter.html#automatic-startup-of-test-target-nodes">Automatic Startup of Test Target Nodes</a></li>
</ul>
</li>
<li id="no" title="Event Handling" expanded="false">Event Handling<ul>
<li><a href="event_handler_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="event_handler_chapter.html#general">General</a></li>
<li title="Use"><a href="event_handler_chapter.html#use">Use</a></li>
</ul>
</li>
<li id="loadscrollpos" title="Dependencies between Test Cases and Suites" expanded="true">Dependencies between Test Cases and Suites<ul>
<li><a href="dependencies_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="dependencies_chapter.html#general">General</a></li>
<li title="Saving Configuration Data"><a href="dependencies_chapter.html#saving-configuration-data">Saving Configuration Data</a></li>
<li title="Sequences"><a href="dependencies_chapter.html#sequences">Sequences</a></li>
</ul>
</li>
<li id="no" title="Common Test Hooks" expanded="false">Common Test Hooks<ul>
<li><a href="ct_hooks_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="ct_hooks_chapter.html#general">General</a></li>
<li title="Installing a CTH"><a href="ct_hooks_chapter.html#installing-a-cth">Installing a CTH</a></li>
<li title="CTH Scope"><a href="ct_hooks_chapter.html#cth-scope">CTH Scope</a></li>
<li title="Manipulating Tests"><a href="ct_hooks_chapter.html#manipulating-tests">Manipulating Tests</a></li>
<li title="Synchronizing External User Applications with Common Test"><a href="ct_hooks_chapter.html#synchronizing-external-user-applications-with-common-test">Synchronizing External User Applications with Common Test</a></li>
<li title="Example CTH"><a href="ct_hooks_chapter.html#example-cth">Example CTH</a></li>
<li title="Built-In CTHs"><a href="ct_hooks_chapter.html#built-in-cths">Built-In CTHs</a></li>
</ul>
</li>
<li id="no" title="Some Thoughts about Testing" expanded="false">Some Thoughts about Testing<ul>
<li><a href="why_test_chapter.html">
              Top of chapter
            </a></li>
<li title="Goals"><a href="why_test_chapter.html#goals">Goals</a></li>
<li title="What to Test"><a href="why_test_chapter.html#what-to-test">What to Test</a></li>
</ul>
</li>
<li id="no" title="Common Test's Property Testing Support: ct_property_test" expanded="false">Common Test's Property Testing Support: ct_property_test<ul>
<li><a href="ct_property_test_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="ct_property_test_chapter.html#general">General</a></li>
<li title="What Is Supported?"><a href="ct_property_test_chapter.html#what-is-supported-">What Is Supported?</a></li>
<li title="Introductory Example"><a href="ct_property_test_chapter.html#introductory-example">Introductory Example</a></li>
<li title="A stateful testing example"><a href="ct_property_test_chapter.html#a-stateful-testing-example">A stateful testing example</a></li>
</ul>
</li>
</ul>
</div></div>
<div id="content">
<div class="innertube">
<h1>13 Dependencies between Test Cases and Suites</h1>
  

  <h3><span onMouseOver="document.getElementById('ghlink-general-idm3210').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-general-idm3210').style.visibility = 'hidden';"><a class="title_link" name="general">13.1 
          General</a><span id="ghlink-general-idm3210" class="ghlink-after"><a href="#general" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/common_test/doc/src/dependencies_chapter.xml#L33" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></span></h3>
    
    <p>When creating test suites, it is strongly recommended to not
      create dependencies between test cases, that is, letting test cases
      depend on the result of previous test cases. There are various
      reasons for this, such as, the following:</p>

    <ul>
      <li>It makes it impossible to run test cases individually.</li>
      <li>It makes it impossible to run test cases in a different order.</li>
      <li>It makes debugging difficult (as a fault can be
	the result of a problem in a different test case than the one failing).</li>
      <li>There are no good and explicit ways to declare dependencies, so 
	it can be difficult to see and understand these in test suite 
	code and in test logs.</li>
      <li>Extending, restructuring, and maintaining test suites with 
	test case dependencies is difficult.</li>      
    </ul>
    
    <p>There are often sufficient means to work around the need for test 
      case dependencies. Generally, the problem is related to the state of 
      the System Under Test (SUT). The action of one test case can change the 
      system state. For some other test case to run properly, this new state 
      must be known.</p>

    <p>Instead of passing data between test cases, it is recommended
      that the test cases read the state from the SUT and perform assertions
      (that is, let the test case run if the state is as expected, otherwise reset or fail).
      It is also recommended to use the state to set variables necessary for the 
      test case to execute properly. Common actions can often be implemented as 
      library functions for test cases to call to set the SUT in a required state. 
      (Such common actions can also be separately tested, if necessary,
      to ensure that they work as expected). It is sometimes also possible, 
      but not always desirable, to group tests together in one test case, that is,
      let a test case perform a "scenario" test (a test consisting of subtests).</p>

    <p>Consider, for example, a server application under test. The following 
      functionality is to be tested:</p>
    
    <ul>
      <li>Starting the server</li>
      <li>Configuring the server</li>
      <li>Connecting a client to the server</li>
      <li>Disconnecting a client from the server</li>
      <li>Stopping the server</li>
    </ul>

    <p>There are obvious dependencies between the listed functions. The server cannot 
      be configured if it has not first been started, a client connot be connectd until 
      the server is properly configured, and so on. If we want to have one test 
      case for each function, we might be tempted to try to always run the
      test cases in the stated order and carry possible data (identities, handles,
      and so on) between the cases and therefore introduce dependencies between them.</p>

      <p>To avoid this, we can consider starting and stopping the server for every test.
      We can thus implement the start and stop action as common functions to be 
      called from 
      <span class="bold_code bc-15"><a href="../../man/ct_suite.html#Module:init_per_testcase-2"><span class="code">init_per_testcase</span></a></span> and 
      <span class="bold_code bc-15"><a href="../../man/ct_suite.html#Module:end_per_testcase-2"><span class="code">end_per_testcase</span></a></span>. 
      (Remember to test the start and stop functionality separately.) 
      The configuration can also be implemented as a common function, maybe grouped 
      with the start function. Finally, the testing of connecting and disconnecting a 
      client can be grouped into one test case. The resulting suite can look as
      follows:</p>

    <div class="example"><pre>      
 -module(my_server_SUITE).
 -compile(export_all).
 -include_lib("ct.hrl").

 %%% init and end functions...

 suite() -&gt; [{require,my_server_cfg}].

 init_per_testcase(start_and_stop, Config) -&gt;
     Config;

 init_per_testcase(config, Config) -&gt;
     [{server_pid,start_server()} | Config];

 init_per_testcase(_, Config) -&gt;
     ServerPid = start_server(),
     configure_server(),
     [{server_pid,ServerPid} | Config].

 end_per_testcase(start_and_stop, _) -&gt;
     ok;

 end_per_testcase(_, _) -&gt;
     ServerPid = ?config(server_pid),
     stop_server(ServerPid).

 %%% test cases...

 all() -&gt; [start_and_stop, config, connect_and_disconnect].

 %% test that starting and stopping works
 start_and_stop(_) -&gt;
     ServerPid = start_server(),
     stop_server(ServerPid).

 %% configuration test
 config(Config) -&gt;
     ServerPid = ?config(server_pid, Config),
     configure_server(ServerPid).

 %% test connecting and disconnecting client
 connect_and_disconnect(Config) -&gt;
     ServerPid = ?config(server_pid, Config),
     {ok,SessionId} = my_server:connect(ServerPid),
     ok = my_server:disconnect(ServerPid, SessionId).

 %%% common functions...

 start_server() -&gt;
     {ok,ServerPid} = my_server:start(),
     ServerPid.

 stop_server(ServerPid) -&gt;
     ok = my_server:stop(),
     ok.

 configure_server(ServerPid) -&gt;
     ServerCfgData = ct:get_config(my_server_cfg),
     ok = my_server:configure(ServerPid, ServerCfgData),
     ok.</pre></div>

    

    <h3>
<a name="save_config"></a><span onMouseOver="document.getElementById('ghlink-saving-configuration-data-idm3235').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-saving-configuration-data-idm3235').style.visibility = 'hidden';"><a class="title_link" name="saving-configuration-data">13.2 
          Saving Configuration Data</a><span id="ghlink-saving-configuration-data-idm3235" class="ghlink-after"><a href="#saving-configuration-data" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/common_test/doc/src/dependencies_chapter.xml#L162" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></span>
</h3>
    
      

      <p>Sometimes it is impossible, or infeasible, to
	implement independent test cases. Maybe it is not possible to read the 
	SUT state. Maybe resetting the SUT is impossible and it takes too long time
	to restart the system. In situations where test case dependency is necessary,
	CT offers a structured way to carry data from one test case to the next. The
	same mechanism can also be used to carry data from one test suite to the next.</p>

      <p>The mechanism for passing data is called <span class="code">save_config</span>. The idea is that
	one test case (or suite) can save the current value of <span class="code">Config</span>, or any list of
	key-value tuples, so that the next executing test case (or test suite) can read it. 
	The configuration data is not saved permanently but can only be passed from one 
        case (or suite) to the next.</p>

      <p>To save <span class="code">Config</span> data, return tuple <span class="code">{save_config,ConfigList}</span>
         from <span class="code">end_per_testcase</span> or from the main test case function.</p>

      <p>To read data saved by a previous test case, use macro <span class="code">config</span> with a 
	<span class="code">saved_config</span> key as follows:</p>
      
      <p><span class="code">{Saver,ConfigList} = ?config(saved_config, Config)</span></p>

      <p><span class="code">Saver</span> (<span class="code">atom()</span>) is the name of the previous test case (where the
	data was saved). The <span class="code">config</span> macro can be used to extract particular data
	also from the recalled <span class="code">ConfigList</span>. It is strongly recommended that 
	<span class="code">Saver</span> is always matched to the expected name of the saving test case. 
	This way, problems because of restructuring of the test suite can be avoided. 
	Also, it makes the dependency more explicit and the test suite easier to read 
        and maintain.</p>

      <p>To pass data from one test suite to another, the same mechanism is used. The data
	is to be saved by finction
	<span class="bold_code bc-15"><a href="../../man/ct_suite.html#Module:end_per_suite-1"><span class="code">end_per_suite</span></a></span> 
	and read by function
	<span class="bold_code bc-15"><a href="../../man/ct_suite.html#Module:init_per_suite-1"><span class="code">init_per_suite</span></a></span>
	in the suite that follows. When passing data between suites, <span class="code">Saver</span> carries the 
	name of the test suite.</p>

      <p><strong>Example:</strong></p>
      
      <div class="example"><pre>
 -module(server_b_SUITE).
 -compile(export_all).
 -include_lib("ct.hrl").

 %%% init and end functions...

 init_per_suite(Config) -&gt;
     %% read config saved by previous test suite
     {server_a_SUITE,OldConfig} = ?config(saved_config, Config),
     %% extract server identity (comes from server_a_SUITE)
     ServerId = ?config(server_id, OldConfig),
     SessionId = connect_to_server(ServerId),
     [{ids,{ServerId,SessionId}} | Config].

 end_per_suite(Config) -&gt;
     %% save config for server_c_SUITE (session_id and server_id)
     {save_config,Config}

 %%% test cases...

 all() -&gt; [allocate, deallocate].

 allocate(Config) -&gt;
     {ServerId,SessionId} = ?config(ids, Config),
     {ok,Handle} = allocate_resource(ServerId, SessionId),
     %% save handle for deallocation test
     NewConfig = [{handle,Handle}],
     {save_config,NewConfig}.

 deallocate(Config) -&gt;
     {ServerId,SessionId} = ?config(ids, Config),
     {allocate,OldConfig} = ?config(saved_config, Config),
     Handle = ?config(handle, OldConfig),
     ok = deallocate_resource(ServerId, SessionId, Handle).</pre></div>

      <p>To save <span class="code">Config</span> data from a test case that is to be
        skipped, return tuple 
      <span class="code">{skip_and_save,Reason,ConfigList}</span>.</p>

      <p>The result is that the test case is skipped with <span class="code">Reason</span> printed to
      the log file (as described earlier) and <span class="code">ConfigList</span> is saved 
      for the next test case. <span class="code">ConfigList</span> can be read using 
      <span class="code">?config(saved_config, Config)</span>, as described earlier. <span class="code">skip_and_save</span>
      can also be returned from <span class="code">init_per_suite</span>. In this case, the saved data can
      be read by <span class="code">init_per_suite</span> in the suite that follows.</p>
    

    <h3>
<a name="sequences"></a><span onMouseOver="document.getElementById('ghlink-sequences-idm3277').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-sequences-idm3277').style.visibility = 'hidden';"><a class="title_link" name="sequences">13.3 
          Sequences</a><span id="ghlink-sequences-idm3277" class="ghlink-after"><a href="#sequences" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/common_test/doc/src/dependencies_chapter.xml#L253" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></span>
</h3>
    
      

      <p>Sometimes test cases depend on each other so that
	if one case fails, the following tests are not to be executed.
        Typically, if the <span class="code">save_config</span> facility is used and a test 
	case that is expected to save data crashes, the following 
	case cannot run. <span class="code">Common Test</span> offers a way to declare such dependencies, 
	called sequences.</p>

      <p>A sequence of test cases is defined as a test case group
        with a <span class="code">sequence</span> property. Test case groups are defined
	through function <span class="code">groups/0</span> in the test suite (for details, see section
	<span class="bold_code bc-15"><a href="write_test_chapter.html#test_case_groups">Test Case Groups</a></span>.</p>

      <p>For example, to ensure that if <span class="code">allocate</span>
	in <span class="code">server_b_SUITE</span> crashes, <span class="code">deallocate</span> is skipped,
	the following sequence can be defined:</p>
      
      <div class="example"><pre>
 groups() -&gt; [{alloc_and_dealloc, [sequence], [alloc,dealloc]}].</pre></div>

      <p>Assume that the suite contains the test case <span class="code">get_resource_status</span> 
	that is independent of the other two cases, then function <span class="code">all</span> can 
	look as follows:</p>

      <div class="example"><pre>
 all() -&gt; [{group,alloc_and_dealloc}, get_resource_status].</pre></div>

      <p>If <span class="code">alloc</span> succeeds, <span class="code">dealloc</span> is also executed. If <span class="code">alloc</span> fails
	however, <span class="code">dealloc</span> is not executed but marked as <span class="code">SKIPPED</span> in the HTML log. 
	<span class="code">get_resource_status</span> runs no matter what happens to the <span class="code">alloc_and_dealloc</span>
	cases.</p>

      <p>Test cases in a sequence are executed in order until all succeed or 
	one fails. If one fails, all following cases in the sequence are skipped.
	The cases in the sequence that have succeeded up to that point are reported as 
	successful in the log. Any number of sequences can be specified.</p>
	<p><strong>Example:</strong></p>

      <div class="example"><pre>
 groups() -&gt; [{scenarioA, [sequence], [testA1, testA2]}, 
              {scenarioB, [sequence], [testB1, testB2, testB3]}].

 all() -&gt; [test1, 
           test2, 
           {group,scenarioA}, 
	   test3, 
           {group,scenarioB}, 
           test4].</pre></div>

      <p>A sequence group can have subgroups. Such subgroups can have 
        any property, that is, they are not required to also be sequences. If you want the 
	status of the subgroup to affect the sequence on the level above, return 
	<span class="code">{return_group_result,Status}</span> from 
	<span class="bold_code bc-15"><a href="../../man/ct_suite.html#Module:end_per_group-2"><span class="code">end_per_group/2</span></a></span>, 
	as described in section
	<span class="bold_code bc-15"><a href="write_test_chapter.html#repeated_groups">Repeated Groups</a></span>
	in Writing Test Suites.
	A failed subgroup (<span class="code">Status == failed</span>) causes the execution of a 
	sequence to fail in the	same way a test case does.</p>
    
</div>
<div class="footer">
<hr>
<p>Copyright © 2003-2021 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script type="text/javascript">window.__otpTopDocDir = '../../js/';</script><script type="text/javascript" src="../../js/highlight.js"></script>
</body>
</html>
