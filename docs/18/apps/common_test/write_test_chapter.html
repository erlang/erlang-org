<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../../otp_doc.css" type="text/css">
<title>Erlang -- Writing Test Suites</title>
</head>
<body bgcolor="white" text="#000000" link="#0000ff" vlink="#ff00ff" alink="#ff0000"><div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../../js/erlresolvelinks.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function getWinHeight() {
                var myHeight = 0;
                if( typeof( window.innerHeight ) == 'number' ) {
                  //Non-IE
                  myHeight = window.innerHeight;
                } else if( document.documentElement && ( document.documentElement.clientWidth ||
                                                         document.documentElement.clientHeight ) ) {
                  //IE 6+ in 'standards compliant mode'
                  myHeight = document.documentElement.clientHeight;
                } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
                  //IE 4 compatible
                  myHeight = document.body.clientHeight;
                }
                return myHeight;
              }

              function setscrollpos() {
                var objf=document.getElementById('loadscrollpos');
                 document.getElementById("leftnav").scrollTop = objf.offsetTop - getWinHeight()/2;
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //--></script><div id="leftnav"><div class="innertube">
<img alt="Erlang logo" src="../../erlang-logo.png"><br><small><a href="users_guide.html">User's Guide</a><br><a href="index.html">Reference Manual</a><br><a href="release_notes.html">Release Notes</a><br><a href="common_test.pdf">PDF</a><br><a href="../../index.html">Top</a></small><p><strong>Common Test</strong><br><strong>User's Guide</strong><br><small>Version 1.12</small></p>
<br><a href="javascript:openAllFlips()">Expand All</a><br><a href="javascript:closeAllFlips()">Contract All</a><p><small><strong>Chapters</strong></small></p>
<ul class="flipMenu" imagePath="../../js/flipmenu">
<li id="no" title="Introduction" expanded="false">Introduction<ul>
<li><a href="introduction.html">
              Top of chapter
            </a></li>
<li title="Scope"><a href="introduction.html#id61477">Scope</a></li>
<li title="Prerequisites"><a href="introduction.html#id61932">Prerequisites</a></li>
</ul>
</li>
<li id="no" title="Common Test Basics" expanded="false">Common Test Basics<ul>
<li><a href="basics_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="basics_chapter.html#id56619">General</a></li>
<li title="Test Suite Organisation"><a href="basics_chapter.html#id59157">Test Suite Organisation</a></li>
<li title="Support Libraries"><a href="basics_chapter.html#id67513">Support Libraries</a></li>
<li title="Suites and Test Cases"><a href="basics_chapter.html#id56610">Suites and Test Cases</a></li>
<li title="External Interfaces"><a href="basics_chapter.html#id64806">External Interfaces</a></li>
</ul>
</li>
<li id="no" title="Getting Started" expanded="false">Getting Started<ul>
<li><a href="getting_started_chapter.html">
              Top of chapter
            </a></li>
<li title="Introduction for Newcomers"><a href="getting_started_chapter.html#id63529">Introduction for Newcomers</a></li>
<li title="Test Case Execution"><a href="getting_started_chapter.html#id69403">Test Case Execution</a></li>
<li title="A Simple Test Suite"><a href="getting_started_chapter.html#id64054">A Simple Test Suite</a></li>
<li title="A Test Suite with Configuration Functions"><a href="getting_started_chapter.html#id62519">A Test Suite with Configuration Functions</a></li>
<li title="Questions and Answers"><a href="getting_started_chapter.html#id69030">Questions and Answers</a></li>
</ul>
</li>
<li id="no" title="Installation" expanded="false">Installation<ul>
<li><a href="install_chapter.html">
              Top of chapter
            </a></li>
<li title="General Information"><a href="install_chapter.html#id75238">General Information</a></li>
</ul>
</li>
<li id="loadscrollpos" title="Writing Test Suites" expanded="true">Writing Test Suites<ul>
<li><a href="write_test_chapter.html">
              Top of chapter
            </a></li>
<li title="Support for Test Suite Authors"><a href="write_test_chapter.html#id68804">Support for Test Suite Authors</a></li>
<li title="Test Suites"><a href="write_test_chapter.html#id68868">Test Suites</a></li>
<li title="Init and End per Suite"><a href="write_test_chapter.html#id68917">Init and End per Suite</a></li>
<li title="Init and End per Test Case"><a href="write_test_chapter.html#id74324">Init and End per Test Case</a></li>
<li title="Test Cases"><a href="write_test_chapter.html#id74622">Test Cases</a></li>
<li title="Test Case Information Function"><a href="write_test_chapter.html#id74809">Test Case Information Function</a></li>
<li title="Test Suite Information Function"><a href="write_test_chapter.html#id75006">Test Suite Information Function</a></li>
<li title="Test Case Groups"><a href="write_test_chapter.html#id76177">Test Case Groups</a></li>
<li title="Parallel Property and Nested Groups"><a href="write_test_chapter.html#id76612">Parallel Property and Nested Groups</a></li>
<li title="Parallel Test Cases and I/O"><a href="write_test_chapter.html#id76648">Parallel Test Cases and I/O</a></li>
<li title="Repeated Groups"><a href="write_test_chapter.html#id76702">Repeated Groups</a></li>
<li title="Shuffled Test Case Order"><a href="write_test_chapter.html#id76856">Shuffled Test Case Order</a></li>
<li title="Group Information Function"><a href="write_test_chapter.html#id76921">Group Information Function</a></li>
<li title="Information Functions for Init- and End-Configuration"><a href="write_test_chapter.html#id76963">Information Functions for Init- and End-Configuration</a></li>
<li title="Data and Private Directories"><a href="write_test_chapter.html#id77038">Data and Private Directories</a></li>
<li title="Execution Environment"><a href="write_test_chapter.html#id77195">Execution Environment</a></li>
<li title="Timetrap Time-Outs"><a href="write_test_chapter.html#id77232">Timetrap Time-Outs</a></li>
<li title="Logging - Categories and Verbosity Levels"><a href="write_test_chapter.html#id77433">Logging - Categories and Verbosity Levels</a></li>
<li title="Illegal Dependencies"><a href="write_test_chapter.html#id77745">Illegal Dependencies</a></li>
</ul>
</li>
<li id="no" title="Test Structure" expanded="false">Test Structure<ul>
<li><a href="test_structure_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="test_structure_chapter.html#id77938">General</a></li>
<li title="Skipping Test Cases"><a href="test_structure_chapter.html#id77957">Skipping Test Cases</a></li>
<li title="Definition of Terms"><a href="test_structure_chapter.html#id78036">Definition of Terms</a></li>
</ul>
</li>
<li id="no" title="Examples and Templates" expanded="false">Examples and Templates<ul>
<li><a href="example_chapter.html">
              Top of chapter
            </a></li>
<li title="Test Suite Example"><a href="example_chapter.html#id78347">Test Suite Example</a></li>
<li title="Test Suite Templates"><a href="example_chapter.html#id78400">Test Suite Templates</a></li>
</ul>
</li>
<li id="no" title="Running Tests and Analyzing Results" expanded="false">Running Tests and Analyzing Results<ul>
<li><a href="run_test_chapter.html">
              Top of chapter
            </a></li>
<li title="Using the Common Test Framework"><a href="run_test_chapter.html#id78595">Using the Common Test Framework</a></li>
<li title="Automatic Compilation of Test Suites and Help Modules"><a href="run_test_chapter.html#id78638">Automatic Compilation of Test Suites and Help Modules</a></li>
<li title="Running Tests from the OS Command Line"><a href="run_test_chapter.html#id78832">Running Tests from the OS Command Line</a></li>
<li title="Running Tests from the Erlang Shell or from an Erlang Program"><a href="run_test_chapter.html#id79514">Running Tests from the Erlang Shell or from an Erlang Program</a></li>
<li title="Test Case Group Execution"><a href="run_test_chapter.html#id79690">Test Case Group Execution</a></li>
<li title="Running the Interactive Shell Mode"><a href="run_test_chapter.html#id80196">Running the Interactive Shell Mode</a></li>
<li title="Step-by-Step Execution of Test Cases with the Erlang Debugger"><a href="run_test_chapter.html#id80419">Step-by-Step Execution of Test Cases with the Erlang Debugger</a></li>
<li title="Test Specifications"><a href="run_test_chapter.html#id80547">Test Specifications</a></li>
<li title="Running Tests from the Web-Based GUI"><a href="run_test_chapter.html#id81528">Running Tests from the Web-Based GUI</a></li>
<li title="Log Files"><a href="run_test_chapter.html#id81639">Log Files</a></li>
<li title="HTML Style Sheets"><a href="run_test_chapter.html#id82115">HTML Style Sheets</a></li>
<li title="Repeating Tests"><a href="run_test_chapter.html#id82293">Repeating Tests</a></li>
<li title="Silent Connections"><a href="run_test_chapter.html#id82658">Silent Connections</a></li>
</ul>
</li>
<li id="no" title="External Configuration Data" expanded="false">External Configuration Data<ul>
<li><a href="config_file_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="config_file_chapter.html#id82894">General</a></li>
<li title="Syntax"><a href="config_file_chapter.html#id82937">Syntax</a></li>
<li title="Requiring and Reading Configuration Data"><a href="config_file_chapter.html#id82961">Requiring and Reading Configuration Data</a></li>
<li title="Using Configuration Variables Defined in Multiple Files"><a href="config_file_chapter.html#id83093">Using Configuration Variables Defined in Multiple Files</a></li>
<li title="Encrypted Configuration Files"><a href="config_file_chapter.html#id83118">Encrypted Configuration Files</a></li>
<li title="Opening Connections Using Configuration Data"><a href="config_file_chapter.html#id83181">Opening Connections Using Configuration Data</a></li>
<li title="User-Specific Configuration Data Formats"><a href="config_file_chapter.html#id83252">User-Specific Configuration Data Formats</a></li>
<li title="Examples of Configuration Data Handling"><a href="config_file_chapter.html#id83469">Examples of Configuration Data Handling</a></li>
<li title="Example of User-Specific Configuration Handler"><a href="config_file_chapter.html#id83524">Example of User-Specific Configuration Handler</a></li>
</ul>
</li>
<li id="no" title="Code Coverage Analysis" expanded="false">Code Coverage Analysis<ul>
<li><a href="cover_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="cover_chapter.html#id83651">General</a></li>
<li title="Use"><a href="cover_chapter.html#id83685">Use</a></li>
<li title="Stopping the Cover Tool When Tests Are Completed"><a href="cover_chapter.html#id83800">Stopping the Cover Tool When Tests Are Completed</a></li>
<li title="The Cover Specification File"><a href="cover_chapter.html#id83861">The Cover Specification File</a></li>
<li title="Cross Cover Analysis"><a href="cover_chapter.html#id83925">Cross Cover Analysis</a></li>
<li title="Logging"><a href="cover_chapter.html#id84152">Logging</a></li>
</ul>
</li>
<li id="no" title="Using Common Test for Large-Scale Testing" expanded="false">Using Common Test for Large-Scale Testing<ul>
<li><a href="ct_master_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="ct_master_chapter.html#id84240">General</a></li>
<li title="Use"><a href="ct_master_chapter.html#id84318">Use</a></li>
<li title="Test Specifications"><a href="ct_master_chapter.html#id84511">Test Specifications</a></li>
<li title="Automatic Startup of Test Target Nodes"><a href="ct_master_chapter.html#id84762">Automatic Startup of Test Target Nodes</a></li>
</ul>
</li>
<li id="no" title="Event Handling" expanded="false">Event Handling<ul>
<li><a href="event_handler_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="event_handler_chapter.html#id84972">General</a></li>
<li title="Use"><a href="event_handler_chapter.html#id85113">Use</a></li>
</ul>
</li>
<li id="no" title="Dependencies between Test Cases and Suites" expanded="false">Dependencies between Test Cases and Suites<ul>
<li><a href="dependencies_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="dependencies_chapter.html#id86232">General</a></li>
<li title="Saving Configuration Data"><a href="dependencies_chapter.html#id86369">Saving Configuration Data</a></li>
<li title="Sequences"><a href="dependencies_chapter.html#id86542">Sequences</a></li>
</ul>
</li>
<li id="no" title="Common Test Hooks" expanded="false">Common Test Hooks<ul>
<li><a href="ct_hooks_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="ct_hooks_chapter.html#id86749">General</a></li>
<li title="Installing a CTH"><a href="ct_hooks_chapter.html#id86809">Installing a CTH</a></li>
<li title="CTH Scope"><a href="ct_hooks_chapter.html#id86991">CTH Scope</a></li>
<li title="Manipulating Tests"><a href="ct_hooks_chapter.html#id87353">Manipulating Tests</a></li>
<li title="Synchronizing External User Applications with Common Test"><a href="ct_hooks_chapter.html#id87717">Synchronizing External User Applications with Common Test</a></li>
<li title="Example CTH"><a href="ct_hooks_chapter.html#id87794">Example CTH</a></li>
<li title="Built-In CTHs"><a href="ct_hooks_chapter.html#id87855">Built-In CTHs</a></li>
</ul>
</li>
<li id="no" title="Some Thoughts about Testing" expanded="false">Some Thoughts about Testing<ul>
<li><a href="why_test_chapter.html">
              Top of chapter
            </a></li>
<li title="Goals"><a href="why_test_chapter.html#id88055">Goals</a></li>
<li title="What to Test"><a href="why_test_chapter.html#id88075">What to Test</a></li>
</ul>
</li>
</ul>
</div></div>
<div id="content">
<div class="innertube">
<h1>5 Writing Test Suites</h1>
  
         
  <h3><a name="id68804">5.1 
        Support for Test Suite Authors</a></h3>
    <a name="intro"></a>
    

    <p>The <span class="bold_code"><a href="../../man/ct.html"><span class="code">ct</span></a></span> module provides the main 
    interface for writing test cases. This includes for example, the following:</p>

    <ul>
      <li>Functions for printing and logging</li>
      <li>Functions for reading configuration data</li>
      <li>Function for terminating a test case with error reason</li>
      <li>Function for adding comments to the HTML overview page</li>
    </ul>

    <p>For details about these functions, see module <span class="bold_code"><a href="../../man/ct.html"><span class="code">ct</span></a></span>.</p>
    
    <p>The <span class="code">Common Test</span> application also includes other modules named 
      <span class="code">ct_&lt;component&gt;</span>, which
      provide various support, mainly simplified use of communication
      protocols such as RPC, SNMP, FTP, Telnet, and others.</p>

  

  <h3><a name="id68868">5.2 
        Test Suites</a></h3>
    
    
    <p>A test suite is an ordinary Erlang module that contains test
      cases. It is recommended that the module has a name on the form
      <span class="code">*_SUITE.erl</span>. Otherwise, the directory and auto compilation 
      function in <span class="code">Common Test</span> cannot locate it (at least not by default).
    </p>

    <p>It is also recommended that the <span class="code">ct.hrl</span> header file is included
      in all test suite modules.
    </p>

    <p>Each test suite module must export function 
    <span class="bold_code"><a href="../../man/common_test.html#Module:all-0"><span class="code">all/0</span></a></span>,
      which returns the list of all test case groups and test cases 
      to be executed in that module. 
    </p>

    <p>The callback functions to be implemented by the test suite are
      all listed in module <span class="bold_code"><a href="../../man/common_test.html">common_test
      </a></span>. They are also described in more detail later in this User's Guide.
    </p>

  

  <h3><a name="id68917">5.3 
        Init and End per Suite</a></h3>
    

    <p>Each test suite module can contain the optional configuration functions
    <span class="bold_code"><a href="../../man/common_test.html#Module:init_per_suite-1"><span class="code">init_per_suite/1</span></a></span>
    and <span class="bold_code"><a href="../../man/common_test.html#Module:end_per_suite-1"><span class="code">end_per_suite/1</span></a></span>. 
    If the init function is defined, so must the end function be.
    </p>    

    <p>If <span class="code">init_per_suite</span> exists, it is called initially before the
    test cases are executed. It typically contains initializations common
    for all test cases in the suite, which are only to be performed once. 
    <span class="code">init_per_suite</span> is recommended for setting up and verifying state 
    and environment on the System Under Test (SUT) or the <span class="code">Common Test</span> 
    host node, or both, so that the test cases in the suite executes correctly. 
    The following are examples of initial configuration operations:
    </p>
    <ul>
      <li>Opening a connection to the SUT</li>
      <li>Initializing a database</li>
      <li>Running an installation script</li>
    </ul>

    <p><span class="code">end_per_suite</span> is called as the final stage of the test suite execution
    (after the last test case has finished). The function is meant to be used 
    for cleaning up after <span class="code">init_per_suite</span>. 
    </p>
    
    <p><span class="code">init_per_suite</span> and <span class="code">end_per_suite</span> execute on dedicated
    Erlang processes, just like the test cases do. The result of these functions
    is however not included in the test run statistics of successful, failed, and
    skipped cases.
    </p>

    <p>The argument to <span class="code">init_per_suite</span> is <span class="code">Config</span>, that is, the
    same key-value list of runtime configuration data that each test case takes
    as input argument. <span class="code">init_per_suite</span> can modify this parameter with 
    information that the test cases need. The possibly modified <span class="code">Config</span>
    list is the return value of the function.
    </p>

    <p>If <span class="code">init_per_suite</span> fails, all test cases in the test
    suite are skipped automatically (so called <strong>auto skipped</strong>), 
    including <span class="code">end_per_suite</span>.
    </p>
    
    <p>Notice that if <span class="code">init_per_suite</span> and <span class="code">end_per_suite</span> do not exist
      in the suite, <span class="code">Common Test</span> calls dummy functions (with the same names)
      instead, so that output generated by hook functions can be saved to the log
      files for these dummies. For details, see
      <span class="bold_code"><a href="ct_hooks_chapter.html#manipulating">Common Test Hooks</a></span>.
    </p>
  

  <h3><a name="id74324">5.4 
        Init and End per Test Case</a></h3>
  <a name="per_testcase"></a>
    

    <p>Each test suite module can contain the optional configuration functions
    <span class="bold_code"><a href="../../man/common_test.html#Module:init_per_testcase-2"><span class="code">init_per_testcase/2</span></a></span>
    and <span class="bold_code"><a href="../../man/common_test.html#Module:end_per_testcase-2"><span class="code">end_per_testcase/2</span></a></span>. 
    If the init function is defined, so must the end function be.</p>

    <p>If <span class="code">init_per_testcase</span> exists, it is called before each
    test case in the suite. It typically contains initialization that
    must be done for each test case (analog to <span class="code">init_per_suite</span> for the 
    suite).</p>

    <p><span class="code">end_per_testcase/2</span> is called after each test case has
    finished, enabling cleanup after <span class="code">init_per_testcase</span>.</p>

    <p>The first argument to these functions is the name of the test
    case. This value can be used with pattern matching in function clauses
    or conditional expressions to choose different initialization and cleanup
    routines for different test cases, or perform the same routine for many,
    or all, test cases.</p>

    <p>The second argument is the <span class="code">Config</span> key-value list of runtime
    configuration data, which has the same value as the list returned by
    <span class="code">init_per_suite</span>. <span class="code">init_per_testcase/2</span> can modify this
    parameter or return it "as is". The return value of <span class="code">init_per_testcase/2</span> 
    is passed as parameter <span class="code">Config</span> to the test case itself.</p>
	  
    <p>The return value of <span class="code">end_per_testcase/2</span> is ignored by the
    test server, with exception of the 
    <span class="bold_code"><a href="dependencies_chapter.html#save_config"><span class="code">save_config</span></a></span>
    and <span class="code">fail</span> tuple.</p>

    <p><span class="code">end_per_testcase</span> can check if the test case was successful. 
    (which in turn can determine how cleanup is to be performed). 
    This is done by reading the value tagged with <span class="code">tc_status</span> from 
    <span class="code">Config</span>. The value is one of the following:
    </p>
    <ul>
       <li>
       <p><span class="code">ok</span></p>
       </li>
       <li>
	 <p><span class="code">{failed,Reason}</span></p>
	 <p>where <span class="code">Reason</span> is <span class="code">timetrap_timeout</span>, information from <span class="code">exit/1</span>, 
       or details of a runtime error</p>
</li>
       <li>
       <p><span class="code">{skipped,Reason}</span></p>
       <p>where <span class="code">Reason</span> is a user-specific term</p>
</li>
     </ul>

    <p>Function <span class="code">end_per_testcase/2</span> is even called if a
      test case terminates because of a call to 
      <span class="bold_code"><a href="../../man/ct.html#abort_current_testcase-1"><span class="code">ct:abort_current_testcase/1</span></a></span>,
      or after a timetrap time-out. However, <span class="code">end_per_testcase</span>
      then executes on a different process than the test case
      function. In this situation, <span class="code">end_per_testcase</span> cannot
      change the reason for test case termination by returning <span class="code">{fail,Reason}</span>
      or save data with <span class="code">{save_config,Data}</span>.</p>

    <p>The test case is skipped in the following two cases:
    </p>
    <ul>
       <li>If <span class="code">init_per_testcase</span> crashes (called <strong>auto skipped</strong>).</li>
       <li>If <span class="code">init_per_testcase</span> returns a tuple <span class="code">{skip,Reason}</span> 
       (called <strong>user skipped</strong>).</li>
     </ul>
    <p>The test case can also be marked as failed without executing it
    by returning a tuple <span class="code">{fail,Reason}</span> from <span class="code">init_per_testcase</span>.</p>

    <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>If <span class="code">init_per_testcase</span> crashes, or returns <span class="code">{skip,Reason}</span>
    or <span class="code">{fail,Reason}</span>, function <span class="code">end_per_testcase</span> is not called.
    </p></p></div>
</div>

    <p>If it is determined during execution of <span class="code">end_per_testcase</span> that
    the status of a successful test case is to be changed to failed, 
    <span class="code">end_per_testcase</span> can return the tuple <span class="code">{fail,Reason}</span>
    (where <span class="code">Reason</span> describes why the test case fails).</p>

    <p>As <span class="code">init_per_testcase</span> and <span class="code">end_per_testcase</span> execute on the
    same Erlang process as the test case, printouts from these
    configuration functions are included in the test case log file.</p>
  

  <h3><a name="id74622">5.5 
        Test Cases</a></h3>
    <a name="test_cases"></a>
    
    
    <p>The smallest unit that the test server is concerned with is a
      test case. Each test case can test many things, for
      example, make several calls to the same interface function with
      different parameters.
    </p>
      
    <p>The author can choose to put many or few tests into each test
      case. Some things to keep in mind follows:
    </p>      
 <ul>
       <li><p>Many small test cases tend to result in extra, and possibly
      duplicated code, as well as slow test execution because of
      large overhead for initializations and cleanups. Avoid duplicated 
      code, for example, by using common help functions. Otherwise,
      the resulting suite becomes difficult to read and understand, and
      expensive to maintain.
    </p></li>
       <li>
<p>Larger test cases make it harder to tell what went wrong if it
      fails. Also, large portions of test code risk being skipped
      when errors occur.</p>
       </li>
      <li><p>Readability and maintainability suffer 
      when test cases become too large and extensive. It is not certain 
      that the resulting log files reflect very well the  number of tests 
      performed.
    </p></li>
     </ul>

    <p>The test case function takes one argument, <span class="code">Config</span>, which
      contains configuration information such as <span class="code">data_dir</span> and
      <span class="code">priv_dir</span>. (For details about these, see section 
      <span class="bold_code"><a href="#data_priv_dir">Data and Private Directories</a></span>.
      The value of <span class="code">Config</span> at the time of the call, is the same 
      as the return value from <span class="code">init_per_testcase</span>, mentioned earlier.
    </p>

    <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>The test case function argument <span class="code">Config</span> is not to be 
	confused with the information that can be retrieved from the
	configuration files (using <span class="bold_code"><a href="../../man/ct.html#get_config-1"><span class="code">
	ct:get_config/1/2</span></a></span>). The test case argument <span class="code">Config</span>
	is to be used for runtime configuration of the test suite and the 
	test cases, while configuration files are to contain data 
	related to the SUT. These two types of configuration data are handled 
	differently.</p></p></div>
</div>
    
    <p>As parameter <span class="code">Config</span> is a list of key-value tuples, that is,
    a data type called a property list, it can be handled by the
    <span class="bold_code"><a href="../../man/proplists.html"><span class="code">stdlib:proplists</span></a></span> module. 
    A value can, for example, be searched for and returned with function 
    <span class="bold_code"><a href="../../man/proplists.html#get_value-2"><span class="code">proplists:get_value/2</span></a></span>.
    Also, or alternatively, the general <span class="bold_code"><a href="../../man/lists.html"><span class="code">stdlib:lists</span></a></span> 
    module contains useful functions. Normally, the only operations 
    performed on <span class="code">Config</span> is insert (adding a tuple to the head of the list) 
    and lookup. <span class="code">Common Test</span> provides a simple macro named <span class="code">?config</span>, 
    which returns a value of an item in <span class="code">Config</span> given the key (exactly like 
    <span class="code">proplists:get_value</span>). Example: <span class="code">PrivDir = ?config(priv_dir, Config)</span>.
    </p>

    <p>If the test case function crashes or exits purposely, it is considered 
    <strong>failed</strong>. If it returns a value (no matter what value), it is 
    considered successful. An exception to this rule is the return value 
    <span class="code">{skip,Reason}</span>. If this tuple is returned, the test case is considered 
    skipped and is logged as such.</p> 

    <p>If the test case returns the tuple <span class="code">{comment,Comment}</span>, the case
    is considered successful and <span class="code">Comment</span> is printed in the overview 
    log file. This is equal to calling 
    <span class="bold_code"><a href="../../man/ct.html#comment-1"><span class="code">ct:comment(Comment)</span></a></span>.
    </p>

  

  <h3><a name="id74809">5.6 
        Test Case Information Function</a></h3>
    <a name="info_function"></a>
      
      
      <p>For each test case function there can be an extra function
	with the same name but without arguments. This is the test case
	information function. It is expected to return a list of tagged 
	tuples that specifies various properties regarding the test case.
      </p>
      
      <p>The following tags have special meaning:</p>
      <dl>
	<dt><strong><span class="code">timetrap</span></strong></dt>
	<dd>
	  <p>
	    Sets the maximum time the test case is allowed to execute. If
	    this time is exceeded, the test case fails with
	    reason <span class="code">timetrap_timeout</span>. Notice that <span class="code">init_per_testcase</span> 
	    and <span class="code">end_per_testcase</span> are included in the timetrap time.
	    For details, see section 
	    <span class="bold_code"><a href="write_test_chapter.html#timetraps">Timetrap Time-Outs</a></span>.
	  </p>
	</dd>
	<dt><strong><span class="code">userdata</span></strong></dt>
	<dd>
	  <p>
	    Specifies any data related to the test case. This
	    data can be retrieved at any time using the 
	    <span class="bold_code"><a href="../../man/ct.html#userdata-3"><span class="code">ct:userdata/3</span></a></span>
	    utility function.
	  </p>
	</dd>
	<dt><strong><span class="code">silent_connections</span></strong></dt>
	<dd>
	  <p>
	    For details, see section 
	    <span class="bold_code"><a href="run_test_chapter.html#silent_connections">Silent Connections</a></span>.
	  </p>
	</dd>
	<dt><strong><span class="code">require</span></strong></dt>
	<dd>
	  <p>
	    Specifies configuration variables required by the
	    test case. If the required configuration variables are not
	    found in any of the test system configuration files, the test case is
	    skipped.</p> 
	  <p>
	    A required variable can also be given a default value to 
	    be used if the variable is not found in any configuration file. To specify 
	    a default value, add a tuple on the form 
	    <span class="code">{default_config,ConfigVariableName,Value}</span> to the test case information list 
	    (the position in the list is irrelevant).
	    </p>
	    <p><strong>Examples:</strong></p>
      
	  <div class="example"><pre>
 testcase1() -&gt; 
     [{require, ftp},
      {default_config, ftp, [{ftp, "my_ftp_host"},
                             {username, "aladdin"},
                             {password, "sesame"}]}}].</pre></div>

	  <div class="example"><pre>
 testcase2() -&gt; 
     [{require, unix_telnet, unix},
      {require, {unix, [telnet, username, password]}},
      {default_config, unix, [{telnet, "my_telnet_host"},
                              {username, "aladdin"},
                              {password, "sesame"}]}}].</pre></div>
	</dd>
      </dl>

	<p>For more information about <span class="code">require</span>, see section
	<span class="bold_code"><a href="config_file_chapter.html#require_config_data">
	Requiring and Reading Configuration Data</a></span>
	in section External Configuration Data and function 
	<span class="bold_code"><a href="../../man/ct.html#require-1"><span class="code">ct:require/1/2</span></a></span>.</p>

      <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>Specifying a default value for a required variable can result
	  in a test case always getting executed. This might not be a desired behavior.</p>
      </p></div>
</div>  
    
      <p>If <span class="code">timetrap</span> or <span class="code">require</span>, or both, is not set specifically for
	a particular test case, default values specified by function
	<span class="bold_code"><a href="../../man/common_test.html#Module:suite-0"><span class="code">suite/0</span></a></span> 
	are used.
      </p>

      <p>Tags other than the earlier mentioned are ignored by the test server.
      </p>

      <p>
	An example of a test case information function follows:
      </p>
      <div class="example"><pre>
 reboot_node() -&gt;
     [
      {timetrap,{seconds,60}},
      {require,interfaces},
      {userdata,
          [{description,"System Upgrade: RpuAddition Normal RebootNode"},
           {fts,"http://someserver.ericsson.se/test_doc4711.pdf"}]}                  
     ].</pre></div>

  

  <h3><a name="id75006">5.7 
        Test Suite Information Function</a></h3>
    <a name="suite"></a>
    

      <p>Function <span class="bold_code"><a href="../../man/common_test.html#Module:suite-0"><span class="code">suite/0</span></a></span> 
        can, for example, be used in a test suite module to set a default 
	<span class="code">timetrap</span> value and to <span class="code">require</span> external configuration data. 
	If a test case, or a group information function also specifies any of the information tags, it
	overrides the default values set by <span class="code">suite/0</span>. For details, 
	see 
	<span class="bold_code"><a href="#info_function">Test Case Information Function</a></span> and
	<span class="bold_code"><a href="#test_case_groups">Test Case Groups</a></span>.
      </p>
      
      <p>The following options can also be specified with the suite information list:</p>
      <ul>
	<li>
<span class="code">stylesheet</span>, 
	  see <span class="bold_code"><a href="run_test_chapter.html#html_stylesheet">HTML Style Sheets</a></span>
</li>
	<li>
<span class="code">userdata</span>, 
	  see <span class="bold_code"><a href="#info_function">Test Case Information Function</a></span>
</li>
	<li>
<span class="code">silent_connections</span>, 
	  see <span class="bold_code"><a href="run_test_chapter.html#silent_connections">Silent Connections</a></span>
</li>
      </ul>

       <p>
	An example of the suite information function follows:
      </p>
      <div class="example"><pre>
 suite() -&gt;
     [
      {timetrap,{minutes,10}},
      {require,global_names},
      {userdata,[{info,"This suite tests database transactions."}]},
      {silent_connections,[telnet]},
      {stylesheet,"db_testing.css"}
     ].</pre></div>    
    
  

  <h3><a name="id76177">5.8 
        Test Case Groups</a></h3>
    <a name="test_case_groups"></a>
    
    <p>A test case group is a set of test cases sharing configuration 
    functions and execution properties. Test case groups are defined by
    function 
    <span class="bold_code"><a href="../../man/common_test.html#Module:groups-0"><span class="code">groups/0</span></a></span>
    according to the following syntax:</p>
    <div class="example"><pre>
 groups() -&gt; GroupDefs

 Types:

 GroupDefs = [GroupDef]
 GroupDef = {GroupName,Properties,GroupsAndTestCases}
 GroupName = atom()
 GroupsAndTestCases = [GroupDef | {group,GroupName} | TestCase]
 TestCase = atom()</pre></div>

    <p><span class="code">GroupName</span> is the name of the group and must be unique within
    the test suite module. Groups can be nested, by including a group definition 
    within the <span class="code">GroupsAndTestCases</span> list of another group. 
    <span class="code">Properties</span> is the list of execution 
    properties for the group. The possible values are as follows:</p>
    <div class="example"><pre>
 Properties = [parallel | sequence | Shuffle | {RepeatType,N}]
 Shuffle = shuffle | {shuffle,Seed}
 Seed = {integer(),integer(),integer()}
 RepeatType = repeat | repeat_until_all_ok | repeat_until_all_fail |
              repeat_until_any_ok | repeat_until_any_fail
 N = integer() | forever</pre></div>

    <p><strong>Explanations:</strong></p>
    <dl>
       <dt><strong><span class="code">parallel</span></strong></dt>
       <dd><p><span class="code">Common Test</span> executes all test cases in the group in parallel.</p></dd>
       <dt><strong><span class="code">sequence</span></strong></dt>
       <dd><p>The cases are executed in a sequence as described in section
    <span class="bold_code"><a href="dependencies_chapter.html#sequences">Sequences</a></span> in section
    Dependencies Between Test Cases and Suites.</p></dd>
       <dt><strong><span class="code">shuffle</span></strong></dt>
       <dd><p>The cases in the group are executed in random order.</p></dd>
       <dt><strong><span class="code">repeat</span></strong></dt>
       <dd><p>Orders <span class="code">Common Test</span> to repeat execution of the cases in the 
       group a given number of times, or until any, or all, cases fail or succeed.</p></dd>
     </dl>
      
    <p><strong>Example:</strong></p>
    <div class="example"><pre>
 groups() -&gt; [{group1, [parallel], [test1a,test1b]},
              {group2, [shuffle,sequence], [test2a,test2b,test2c]}].</pre></div>

    <p>To specify in which order groups are to be executed (also with respect
    to test cases that are not part of any group), add tuples on the form 
    <span class="code">{group,GroupName}</span> to the <span class="code">all/0</span> list.</p>
    <p><strong>Example:</strong></p>
    <div class="example"><pre>
 all() -&gt; [testcase1, {group,group1}, testcase2, {group,group2}].</pre></div>

    <p>Execution properties with a group tuple in 
    <span class="code">all/0</span>: <span class="code">{group,GroupName,Properties}</span> can also be specified. 
      These properties override those specified in the group definition (see
      <span class="code">groups/0</span> earlier). This way, the same set of tests can be run,
      but with different properties, without having to make copies of the group
      definition in question.</p>

    <p>If a group contains subgroups, the execution properties for these can
      also be specified in the group tuple:
      <span class="code">{group,GroupName,Properties,SubGroups}</span>
      Where, <span class="code">SubGroups</span> is a list of tuples, <span class="code">{GroupName,Properties}</span> or
      <span class="code">{GroupName,Properties,SubGroups}</span> representing the subgroups.
      Any subgroups defined in <span class="code">group/0</span> for a group, that are not specified
      in the <span class="code">SubGroups</span> list, executes with their predefined
      properties.</p>

    <p><strong>Example:</strong></p>
    <div class="example"><pre>
 groups() -&gt; {tests1, [], [{tests2, [], [t2a,t2b]},
                           {tests3, [], [t31,t3b]}]}.</pre></div>
    <p>To execute group <span class="code">tests1</span> twice with different properties for <span class="code">tests2</span>
      each time:</p>
    <div class="example"><pre>
 all() -&gt;
    [{group, tests1, default, [{tests2, [parallel]}]},
     {group, tests1, default, [{tests2, [shuffle,{repeat,10}]}]}].</pre></div>
    <p>This is equivalent to the following specification:</p>
    <div class="example"><pre>
 all() -&gt;
    [{group, tests1, default, [{tests2, [parallel]},
                               {tests3, default}]},
     {group, tests1, default, [{tests2, [shuffle,{repeat,10}]},
                               {tests3, default}]}].</pre></div>
    <p>Value <span class="code">default</span> states that the predefined properties
      are to be used.</p>
    <p>The following example shows how to override properties in a scenario
      with deeply nested groups:</p>
    <div class="example"><pre>
 groups() -&gt;
    [{tests1, [], [{group, tests2}]},
     {tests2, [], [{group, tests3}]},
     {tests3, [{repeat,2}], [t3a,t3b,t3c]}].

 all() -&gt;
    [{group, tests1, default, 
      [{tests2, default,
        [{tests3, [parallel,{repeat,100}]}]}]}].</pre></div>

    <p>The described syntax can also be used in test specifications
      to change group properties at the time of execution,
      without having to edit the test suite. For more information, see
      section <span class="bold_code"><a href="run_test_chapter.html#test_specifications">Test
      Specifications</a></span> in section Running Tests and Analyzing Results.</p>

    <p>As illustrated, properties can be combined. If, for example,
      <span class="code">shuffle</span>, <span class="code">repeat_until_any_fail</span>, and <span class="code">sequence</span>
      are all specified, the test cases in the group are executed
      repeatedly, and in random order, until a test case fails. Then
      execution is immediately stopped and the remaining cases are skipped.</p>

    <p>Before execution of a group begins, the configuration function
    <span class="bold_code"><a href="../../man/common_test.html#Module:init_per_group-2"><span class="code">init_per_group(GroupName, Config)</span></a></span> 
    is called. The list of tuples returned from this function is passed to the 
    test cases in the usual manner by argument <span class="code">Config</span>. 
    <span class="code">init_per_group/2</span> is meant to be used for initializations common 
    for the test cases in the group. After execution of the group is finished, function
    <span class="bold_code"><a href="../../man/common_test.html#Module:end_per_group-2"><span class="code">end_per_group(GroupName, Config)</span></a></span> 
    is called. This function is meant to be used for cleaning up after 
    <span class="code">init_per_group/2</span>.</p>

    <p>Whenever a group is executed, if <span class="code">init_per_group</span> and
      <span class="code">end_per_group</span> do not exist in the suite, <span class="code">Common Test</span> calls
      dummy functions (with the same names) instead. Output generated by
      hook functions are saved to the log files for these dummies.
      For more information, see section 
      <span class="bold_code"><a href="ct_hooks_chapter.html#manipulating">Manipulating Tests</a></span>
      in section Common Test Hooks.
    </p>

    <div class="note">
<div class="label">Note</div>
<div class="content"><p><p><span class="code">init_per_testcase/2</span> and <span class="code">end_per_testcase/2</span>
    are always called for each individual test case, no matter if the case 
    belongs to a group or not.</p></p></div>
</div>

    <p>The properties for a group are always printed in the top of the HTML log 
    for <span class="code">init_per_group/2</span>. The total execution time for a group is
    included at the bottom of the log for <span class="code">end_per_group/2</span>.</p>

    <p>Test case groups can be nested so sets of groups can be 
    configured with the same <span class="code">init_per_group/2</span> and <span class="code">end_per_group/2</span>
    functions. Nested groups can be defined by including a group definition,
    or a group name reference, in the test case list of another group.</p>
    <p><strong>Example:</strong></p>
    <div class="example"><pre>
 groups() -&gt; [{group1, [shuffle], [test1a,
                                   {group2, [], [test2a,test2b]},
                                   test1b]},
              {group3, [], [{group,group4},
                            {group,group5}]},
              {group4, [parallel], [test4a,test4b]},
              {group5, [sequence], [test5a,test5b,test5c]}].</pre></div>

    <p>In the previous example, if <span class="code">all/0</span> returns group name references
    in the order <span class="code">[{group,group1},{group,group3}]</span>, the order of the 
    configuration functions and test cases becomes the following (notice that
    <span class="code">init_per_testcase/2</span> and <span class="code">end_per_testcase/2:</span> are also
    always called, but not included in this example for simplification):</p>
    <div class="example"><pre>
 init_per_group(group1, Config) -&gt; Config1  (*)
      test1a(Config1)
      init_per_group(group2, Config1) -&gt; Config2
           test2a(Config2), test2b(Config2)
      end_per_group(group2, Config2)
      test1b(Config1)
 end_per_group(group1, Config1) 
 init_per_group(group3, Config) -&gt; Config3
      init_per_group(group4, Config3) -&gt; Config4
           test4a(Config4), test4b(Config4)  (**)
      end_per_group(group4, Config4)
      init_per_group(group5, Config3) -&gt; Config5
           test5a(Config5), test5b(Config5), test5c(Config5)
      end_per_group(group5, Config5)
 end_per_group(group3, Config3)</pre></div>

    <p>(*) The order of test case <span class="code">test1a</span>, <span class="code">test1b</span>, and <span class="code">group2</span> is
        undefined, as <span class="code">group1</span> has a shuffle property.</p>
    <p>(**) These cases are not executed in order, but in parallel.</p>
    <p>Properties are not inherited from top-level groups to nested 
    subgroups. For instance, in the previous example, the test cases in <span class="code">group2</span> 
    are not executed in random order (which is the property of <span class="code">group1</span>).</p>
  

  <h3><a name="id76612">5.9 
        Parallel Property and Nested Groups</a></h3>
    
    <p>If a group has a parallel property, its test cases are spawned
    simultaneously and get executed in parallel. However, a test case is not 
    allowed to execute in parallel with <span class="code">end_per_group/2</span>, which means
    that the time to execute a parallel group is equal to the
    execution time of the slowest test case in the group. A negative side
    effect of running test cases in parallel is that the HTML summary pages
    are not updated with links to the individual test case logs until function 
    <span class="code">end_per_group/2</span> for the group has finished.</p>

    <p>A group nested under a parallel group starts executing in parallel 
    with previous (parallel) test cases (no matter what properties the nested 
    group has). However, as test cases are never executed in parallel with 
    <span class="code">init_per_group/2</span> or <span class="code">end_per_group/2</span> of the same group, it is 
    only after a nested group has finished that remaining parallel cases 
    in the previous group become spawned.</p>
  

  <h3><a name="id76648">5.10 
        Parallel Test Cases and I/O</a></h3>
    
    <p>A parallel test case has a private I/O server as its group leader. 
      (For a description of the group leader concept, see
      <span class="bold_code"><a href="../../apps/erts/index.html"><span class="code">ERTS</span></a></span>). 
      The central I/O server process, which handles the output from 
      regular test cases and configuration functions, does not respond to I/O messages
      during execution of parallel groups. This is important to understand
      to avoid certain traps, like the following:</p>
    <p>If a process, <span class="code">P</span>, is spawned during execution of, for example,
      <span class="code">init_per_suite/1</span>, it inherits the group leader of the
      <span class="code">init_per_suite</span> process. This group leader is the central I/O server
      process mentioned earlier. If, at a later time, <strong>during parallel test case
      execution</strong>, some event triggers process <span class="code">P</span> to call
      <span class="code">io:format/1/2</span>, that call never returns (as the group leader
      is in a non-responsive state) and causes <span class="code">P</span> to hang.
    </p>
  

  <h3><a name="id76702">5.11 
        Repeated Groups</a></h3>
    
    <a name="repeated_groups"></a>
    <p>A test case group can be repeated a certain number of times
    (specified by an integer) or indefinitely (specified by <span class="code">forever</span>).
    The repetition can also be stopped too early if any or all cases
    fail or succeed, that is, if any of the properties <span class="code">repeat_until_any_fail</span>,
    <span class="code">repeat_until_any_ok</span>, <span class="code">repeat_until_all_fail</span>, or 
    <span class="code">repeat_until_all_ok</span> is used. If the basic <span class="code">repeat</span>
    property is used, status of test cases is irrelevant for the repeat 
    operation.</p>
    
    <p>The status of a subgroup can be returned (<span class="code">ok</span> or
    <span class="code">failed</span>), to affect the execution of the group on the level above. 
    This is accomplished by, in <span class="code">end_per_group/2</span>, looking up the value
    of <span class="code">tc_group_properties</span> in the <span class="code">Config</span> list and checking the
    result of the test cases in the group. If status <span class="code">failed</span> is to be
    returned from the group as a result, <span class="code">end_per_group/2</span> is to return
    the value <span class="code">{return_group_result,failed}</span>. The status of a subgroup
    is taken into account by <span class="code">Common Test</span> when evaluating if execution of a
    group is to be repeated or not (unless the basic <span class="code">repeat</span>
    property is used).</p>

    <p>The value of <span class="code">tc_group_properties</span> is a list of status tuples, 
    each with the key <span class="code">ok</span>, <span class="code">skipped</span>, and <span class="code">failed</span>. The
    value of a status tuple is a list with names of test cases 
    that have been executed with the corresponding status as result.</p>

    <p>The following is an example of how to return the status from a group:</p>
    <div class="example"><pre>
 end_per_group(_Group, Config) -&gt;
     Status = ?config(tc_group_result, Config),
     case proplists:get_value(failed, Status) of
         [] -&gt;                                   % no failed cases 
             {return_group_result,ok};
         _Failed -&gt;                              % one or more failed
             {return_group_result,failed}
     end.</pre></div>

    <p>It is also possible, in <span class="code">end_per_group/2</span>, to check the status of
    a subgroup (maybe to determine what status the current group is to
    return). This is as simple as illustrated in the previous example, only the
    group name is stored in a tuple <span class="code">{group_result,GroupName}</span>,
    which can be searched for in the status lists.</p>
    <p><strong>Example:</strong></p>
    <div class="example"><pre>
 end_per_group(group1, Config) -&gt;
     Status = ?config(tc_group_result, Config),
     Failed = proplists:get_value(failed, Status),
     case lists:member({group_result,group2}, Failed) of
           true -&gt;
               {return_group_result,failed};
           false -&gt;                                                    
               {return_group_result,ok}
     end; 
 ...</pre></div>

    <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>When a test case group is repeated, the configuration 
    functions <span class="code">init_per_group/2</span> and <span class="code">end_per_group/2</span> are 
    also always called with each repetition.</p></p></div>
</div>
  

  <h3><a name="id76856">5.12 
        Shuffled Test Case Order</a></h3>
    
    <p>The order in which test cases in a group are executed is under normal
    circumstances the same as the order specified in the test case list 
    in the group definition. With property <span class="code">shuffle</span> set, however,
    <span class="code">Common Test</span> instead executes the test cases in random order.</p>

    <p>You can provide a seed value (a tuple of three integers) with
    the shuffle property <span class="code">{shuffle,Seed}</span>. This way, the same shuffling
    order can be created every time the group is executed. If no seed value
    is specified, <span class="code">Common Test</span> creates a "random" seed for the shuffling operation 
    (using the return value of <span class="code">erlang:timestamp/0</span>). The seed value is always
    printed to the <span class="code">init_per_group/2</span> log file so that it can be used to
    recreate the same execution order in a subsequent test run.</p>

    <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>If a shuffled test case group is repeated, the seed is not
    reset between turns.</p></p></div>
</div>

    <p>If a subgroup is specified in a group with a <span class="code">shuffle</span> property,
    the execution order of this subgroup in relation to the test cases 
    (and other subgroups) in the group, is random. The order of the
    test cases in the subgroup is however not random (unless the 
    subgroup has a <span class="code">shuffle</span> property).</p>
  

  <h3><a name="id76921">5.13 
        Group Information Function</a></h3>
    <a name="group_info"></a>
    

      <p>The test case group information function, <span class="code">group(GroupName)</span>,
	serves the same purpose as the suite- and test case information
	functions previously described. However, the scope for
	the group information function, is all test cases and subgroups in the
	group in question (<span class="code">GroupName</span>).</p>
      <p><strong>Example:</strong></p>
      <div class="example"><pre>
 group(connection_tests) -&gt;
    [{require,login_data},
     {timetrap,1000}].</pre></div>
	
      <p>The group information properties override those set with the
	suite information function, and can in turn be overridden by test
	case information properties. For a list of valid information properties 
	and more general information, see the
	<span class="bold_code"><a href="#info_function">Test Case Information Function</a></span>.
      </p>
  

  <h3><a name="id76963">5.14 
        Information Functions for Init- and End-Configuration</a></h3>
    
      <p>Information functions can also be used for functions <span class="code">init_per_suite</span>,
	<span class="code">end_per_suite</span>, <span class="code">init_per_group</span>, and <span class="code">end_per_group</span>,
	and they work the same way as with the
	<span class="bold_code"><a href="#info_function">Test Case Information Function</a></span>. 
	This is useful, for example, for setting timetraps and requiring 
	external configuration data relevant only for the configuration 
	function in question (without affecting properties set for groups 
      and test cases in the suite).</p>

      <p>The information function <span class="code">init/end_per_suite()</span> is called for
	<span class="code">init/end_per_suite(Config)</span>, and information function
	<span class="code">init/end_per_group(GroupName)</span> is called for
	<span class="code">init/end_per_group(GroupName,Config)</span>. However, information functions
	cannot be used with <span class="code">init/end_per_testcase(TestCase, Config)</span>,
	as these configuration functions execute on the test case process
	and use the same properties as the test case (that is, the properties
	set by the test case information function, <span class="code">TestCase()</span>). For a list 
	of valid information properties and more general information, see the
	<span class="bold_code"><a href="#info_function">Test Case Information Function</a></span>.
      </p>
  

  <h3><a name="id77038">5.15 
        Data and Private Directories</a></h3>
    <a name="data_priv_dir"></a>
    

    <p>In the data directory, <span class="code">data_dir</span>, the test module has 
      its own files needed for the testing. The name of <span class="code">data_dir</span> 
      is the the name of the test suite followed by <span class="code">"_data"</span>. 
      For example, <span class="code">"some_path/foo_SUITE.beam"</span> has the data directory
      <span class="code">"some_path/foo_SUITE_data/"</span>. Use this directory for portability,
      that is, to avoid hardcoding directory names in your suite. As the data
      directory is stored in the same directory as your test suite, you can
      rely on its existence at runtime, even if the path to your
      test suite directory has changed between test suite implementation and
      execution.
    </p>
    <p>
      <span class="code">priv_dir</span> is the private directory for the test cases.
      This directory can be used whenever a test case (or configuration function)
      needs to write something to file. The name of the private directory is
      generated by <span class="code">Common Test</span>, which also creates the directory.
    </p>
    <p>By default, <span class="code">Common Test</span> creates one central private directory
      per test run, shared by all test cases. This is not always suitable.
      Especially if the same test cases are executed multiple times during
      a test run (that is, if they belong to a test case group with property
      <span class="code">repeat</span>) and there is a risk that files in the private directory get
      overwritten. Under these circumstances, <span class="code">Common Test</span> can be 
      configured to create one dedicated private directory per
      test case and execution instead. This is accomplished with
      the flag/option <span class="code">create_priv_dir</span> (to be used with the
      <span class="bold_code"><a href="../../man/ct_run.html"><span class="code">ct_run</span></a></span> program, the 
      <span class="bold_code"><a href="../../man/ct.html#run_test-1"><span class="code">ct:run_test/1</span></a></span> function, or
      as test specification term). There are three possible values
      for this option as follows:
     </p>
      <ul>
	<li><span class="code">auto_per_run</span></li>
	<li><span class="code">auto_per_tc</span></li>
	<li><span class="code">manual_per_tc</span></li>
      </ul>
     <p>
      The first value indicates the default <span class="code">priv_dir</span> behavior, that is,
      one private directory created per test run. The two latter
      values tell <span class="code">Common Test</span> to generate a unique test directory name
      per test case and execution. If the auto version is used, <strong>all</strong>
      private directories are created automatically. This can become very 
      inefficient for test runs with many test cases or repetitions, or both. 
      Therefore, if the manual version is used instead, the test case must tell 
      <span class="code">Common Test</span> to create <span class="code">priv_dir</span> when it needs it.
      It does this by calling the function 
      <span class="bold_code"><a href="../../man/ct.html#make_priv_dir-0"><span class="code">ct:make_priv_dir/0</span></a></span>.
      </p>

      <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>Do not depend on the current working directory for
	  reading and writing data files, as this is not portable. All 
	  scratch files are to be written in the <span class="code">priv_dir</span> and all 
	  data files are to be located in <span class="code">data_dir</span>. Also, 
	  the <span class="code">Common Test</span> server sets the current working directory to 
	  the test case log directory at the start of every case.
    </p></p></div>
</div>

  

  <h3><a name="id77195">5.16 
        Execution Environment</a></h3>
    

    <p>Each test case is executed by a dedicated Erlang process. The
      process is spawned when the test case starts, and terminated when
      the test case is finished. The configuration functions 
      <span class="code">init_per_testcase</span> and <span class="code">end_per_testcase</span> execute on the 
      same process as the test case.
    </p>

    <p>The configuration functions <span class="code">init_per_suite</span> and 
      <span class="code">end_per_suite</span> execute, like test cases, on dedicated Erlang
      processes.
    </p>
  

  <h3><a name="id77232">5.17 
        Timetrap Time-Outs</a></h3>
    <a name="timetraps"></a>
    
    <p>The default time limit for a test case is 30 minutes, unless a
    <span class="code">timetrap</span> is specified either by the suite-, group-,
    or test case information function. The timetrap time-out value defined by
    <span class="code">suite/0</span> is the value that is used for each test case
    in the suite (and for the configuration functions
    <span class="code">init_per_suite/1</span>, <span class="code">end_per_suite/1</span>, <span class="code">init_per_group/2</span>,
    and <span class="code">end_per_group/2</span>). A timetrap value defined by
    <span class="code">group(GroupName)</span> overrides one defined by <span class="code">suite()</span>
    and is used for each test case in group <span class="code">GroupName</span>, and any
    of its subgroups. If a timetrap value is defined by <span class="code">group/1</span>
    for a subgroup, it overrides that of its higher level groups. Timetrap
    values set by individual test cases (by the test case information
    function) override both group- and suite- level timetraps.</p>
    
    <p>A timetrap can also be set or reset dynamically during the
    execution of a test case, or configuration function. 
    This is done by calling
    <span class="bold_code"><a href="../../man/ct.html#timetrap-1"><span class="code">ct:timetrap/1</span></a></span>. 
    This function cancels the current timetrap and starts a new one 
    (that stays active until time-out, or end of the current function).</p>
    
    <p>Timetrap values can be extended with a multiplier value specified at
    startup with option <span class="code">multiply_timetraps</span>. It is also possible
    to let the test server decide to scale up timetrap time-out values
    automatically. That is, if tools such as <span class="code">cover</span> or <span class="code">trace</span> 
    are running during the test. This feature is disabled by default and 
    can be enabled with start option <span class="code">scale_timetraps</span>.</p>
    
    <p>If a test case needs to suspend itself for a time that also gets
    multipled by <span class="code">multiply_timetraps</span> (and possibly also scaled up if
    <span class="code">scale_timetraps</span> is enabled), the function 
    <span class="bold_code"><a href="../../man/ct.html#sleep-1"><span class="code">ct:sleep/1</span></a></span>
    can be used (instead of, for example, <span class="code">timer:sleep/1</span>).</p>
    
    <p>A function (<span class="code">fun/0</span> or <span class="code">{Mod,Func,Args}</span> (MFA) tuple) can be 
    specified as timetrap value in the suite-, group- and test case information 
    function, and as argument to function 
    <span class="bold_code"><a href="../../man/ct.html#timetrap-1"><span class="code">ct:timetrap/1</span></a></span>.</p>
    <p><strong>Examples:</strong></p>

    <p><span class="code">{timetrap,{my_test_utils,timetrap,[?MODULE,system_start]}}</span></p>
    <p><span class="code">ct:timetrap(fun() -&gt; my_timetrap(TestCaseName, Config) end)</span></p>

    <p>The user timetrap function can be used for two things as follows:</p>
    <ul>
      <li>To act as a timetrap. The time-out is triggered when the
      function returns.</li>
      <li>To return a timetrap time value (other than a function).</li>
    </ul>
    <p>Before execution of the timetrap function (which is performed
    on a parallel, dedicated timetrap process), <span class="code">Common Test</span> cancels
    any previously set timer for the test case or configuration function.    
    When the timetrap function returns, the time-out is triggered, <strong>unless</strong>
    the return value is a valid timetrap time, such as an integer,
    or a <span class="code">{SecMinOrHourTag,Time}</span> tuple (for details, see module
    <span class="bold_code"><a href="../../man/common_test.html">common_test</a></span>). If a time value 
    is returned, a new timetrap is started to generate a time-out after 
    the specified time.</p>

    <p>The user timetrap function can return a time value after a delay.
    The effective timetrap time is then the delay time <strong>plus</strong> the
    returned time.</p>
  

  <h3><a name="id77433">5.18 
        Logging - Categories and Verbosity Levels</a></h3>
    <a name="logging"></a>
    
    <p><span class="code">Common Test</span> provides the following three main functions for 
    printing strings:</p>
    <ul>
      <li><span class="code">ct:log(Category, Importance, Format, FormatArgs, Opts)</span></li>
      <li><span class="code">ct:print(Category, Importance, Format, FormatArgs)</span></li>
      <li><span class="code">ct:pal(Category, Importance, Format, FormatArgs)</span></li>
    </ul>
    <p>The <span class="bold_code"><a href="../../man/ct.html#log-1"><span class="code">log/1,2,3,4,5</span></a></span> function 
    prints a string to the test case log file. 
    The <span class="bold_code"><a href="../../man/ct.html#print-1"><span class="code">print/1,2,3,4</span></a></span> function 
    prints the string to screen.
    The <span class="bold_code"><a href="../../man/ct.html#pal-1"><span class="code">pal/1,2,3,4</span></a></span> function 
    prints the same string both to file and screen. The functions are described 
    in module <span class="bold_code"><a href="../../man/ct.html">ct</a></span>.
    </p>

    <p>The optional <span class="code">Category</span> argument can be used to categorize the
    log printout. Categories can be used for two things as follows:</p>
    <ul>
      <li>To compare the importance of the printout to a specific
      verbosity level.</li>
      <li>To format the printout according to a user-specific HTML
      Style Sheet (CSS).</li>
    </ul>

    <p>Argument <span class="code">Importance</span> specifies a level of importance
    that, compared to a verbosity level (general and/or set per category),
    determines if the printout is to be visible. <span class="code">Importance</span>
    is any integer in the range 0..99. Predefined constants
    exist in the <span class="code">ct.hrl</span> header file. The default importance level,
    <span class="code">?STD_IMPORTANCE</span> (used if argument <span class="code">Importance</span> is not
    provided), is 50. This is also the importance used for standard I/O,
    for example, from printouts made with <span class="code">io:format/2</span>, 
    <span class="code">io:put_chars/1</span>, and so on.</p>

    <p><span class="code">Importance</span> is compared to a verbosity level set by the
    <span class="code">verbosity</span> start flag/option. The verbosity level can be set per
    category or generally, or both. The default verbosity level, 
    <span class="code">?STD_VERBOSITY</span>, is 50, that is, all standard I/O gets printed. 
    If a lower verbosity level is set, standard I/O printouts are ignored. 
    <span class="code">Common Test</span> performs the following test:</p>
    <div class="example"><pre>
 Importance &gt;= (100-VerbosityLevel)</pre></div>
    <p>This also means that verbosity level 0 effectively turns all logging off
    (except from printouts made by <span class="code">Common Test</span> itself).</p>

    <p>The general verbosity level is not associated with any particular
    category. This level sets the threshold for the standard I/O printouts,
    uncategorized <span class="code">ct:log/print/pal</span> printouts, and
    printouts for categories with undefined verbosity level.</p>

    <p><strong>Examples:</strong></p>
    <p>Some printouts during test case execution:</p>
    <div class="example"><pre>  
 io:format("1. Standard IO, importance = ~w~n", [?STD_IMPORTANCE]),
 ct:log("2. Uncategorized, importance = ~w", [?STD_IMPORTANCE]),
 ct:log(info, "3. Categorized info, importance = ~w", [?STD_IMPORTANCE]]),
 ct:log(info, ?LOW_IMPORTANCE, "4. Categorized info, importance = ~w", [?LOW_IMPORTANCE]),
 ct:log(error, "5. Categorized error, importance = ~w", [?HI_IMPORTANCE]),
 ct:log(error, ?HI_IMPORTANCE, "6. Categorized error, importance = ~w", [?MAX_IMPORTANCE]),</pre></div>

   <p>If starting the test without specifying any verbosity levels as follows:</p>
   <div class="example"><pre>
 $ ct_run ...</pre></div>
   <p>the following is printed:</p>
   <div class="example"><pre>
 1. Standard IO, importance = 50
 2. Uncategorized, importance = 50
 3. Categorized info, importance = 50
 5. Categorized error, importance = 75
 6. Categorized error, importance = 99</pre></div>

   <p>If starting the test with:</p>
   <div class="example"><pre>
 $ ct_run -verbosity 1 and info 75</pre></div>
   <p>the following is printed:</p>
   <div class="example"><pre>
 3. Categorized info, importance = 50
 4. Categorized info, importance = 25
 6. Categorized error, importance = 99</pre></div>

    <p>The arguments <span class="code">Format</span> and <span class="code">FormatArgs</span> in <span class="code">ct:log/print/pal</span> are
    always passed on to the <span class="code">stdlib</span> function <span class="code">io:format/3</span> (For details,
    see the <span class="bold_code"><a href="../../man/io.html"><span class="code">stdlib:io</span></a></span> manual page).</p>

    <p><span class="code">ct:pal/4</span> and <span class="code">ct:log/5</span> add headers to strings being printed to the
    log file. The strings are also wrapped in div tags with a CSS class
    attribute, so that stylesheet formatting can be applied. To disable this feature for
    a printout (i.e. to get a result similar to using <span class="code">io:format/2</span>),
    call <span class="code">ct:log/5</span> with the <span class="code">no_css</span> option.</p>

    <p>How categories can be mapped to CSS tags is documented in section
    <span class="bold_code"><a href="run_test_chapter.html#html_stylesheet">HTML Style Sheets</a></span>
    in section Running Tests and Analyzing Results.</p>
    
    <p>Common Test will escape special HTML characters (&lt;, &gt; and &amp;) in printouts
    to the log file made with <span class="code">ct:pal/4</span> and <span class="code">io:format/2</span>. In order to print
    strings with HTML tags to the log, use the <span class="code">ct:log/5</span> function. The character escaping
    feature is per default disabled for <span class="code">ct:log/5</span>, but can be enabled with the
    <span class="code">esc_chars</span> option.</p>

    <p>For more information about log files, see section
    <span class="bold_code"><a href="run_test_chapter.html#log_files">Log Files</a></span> 
    in section Running Tests and Analyzing Results.</p>
  
  
  <h3><a name="id77745">5.19 
        Illegal Dependencies</a></h3>
    

    <p>Even though it is highly efficient to write test suites with
      the <span class="code">Common Test</span> framework, mistakes can be made,
      mainly because of illegal dependencies. Some of the 
      more frequent mistakes from our own experience with running the 
      Erlang/OTP test suites follows:</p>

    <ul>
	<li>
<p>Depending on current directory, and writing there:</p>
	    
	    <p>This is a common error in test suites. It is assumed that
	      the current directory is the same as the author used as
	      current directory when the test case was developed. Many test
	      cases even try to write scratch files to this directory. Instead
	      <span class="code">data_dir</span> and <span class="code">priv_dir</span> are to be used to locate 
	      data and for writing scratch files.
	    </p>
	</li>

	<li>
<p>Depending on execution order:</p>
	
	    <p>During development of test suites, make no assumptions on the 
	    execution order of the test cases or suites. For example, a test 
	    case must not assume that a server it depends on is already 
	    started by a previous test case. Reasons for this follows:
	    </p>
	    <ul>
	      <li>The user/operator can specify the order at will, and maybe
	      a different execution order is sometimes more relevant or 
	      efficient.</li>
	      <li>If the user specifies a whole directory of test suites 
	      for the test, the execution order of the suites depends on 
	      how the files are listed by the operating system, which varies 
	      between systems.</li>
	      <li>If a user wants to run only a subset of a test suite, 
	      there is no way one test case could successfully depend on 
	      another.</li>
	    </ul>
	</li>

	<li>
<p>Depending on Unix:</p>
	    
	    <p>Running Unix commands through <span class="code">os:cmd</span> are likely 
	    not to work on non-Unix platforms.
	    </p>
	</li>

	<li>
<p>Nested test cases:</p>

	    <p>Starting a test case from another not only tests the same
	      thing twice, but also makes it harder to follow what is being 
	      tested. Also, if the called test case fails for some
	      reason, so do the caller. This way, one error gives cause to
	      several error reports, which is to be avoided.
	    </p>
	    <p>Functionality common for many test case functions can be 
	       implemented in common help functions. If these functions are 
	       useful for test cases across suites, put the help functions 
	       into common help modules.
	    </p>
	</li>
	
      <li>
<p>Failure to crash or exit when things go wrong:</p>
	    
	    <p>Making requests without checking that the return value
	      indicates success can be OK if the test case fails
	      later, but it is never acceptable just to print an error
	      message (into the log file) and return successfully. Such test 
	      cases do harm, as they create a false sense of security when 
	      overviewing the test results.
	    </p>
	</li>

      <li>
<p>Messing up for subsequent test cases:</p>
	
	    <p>Test cases are to restore as much of the execution
	      environment as possible, so that subsequent test cases
	      do not crash because of their execution order. 
	      The function 
	      <span class="bold_code"><a href="../../man/common_test.html#Module:end_per_testcase-2"><span class="code">end_per_testcase</span></a></span> 
	      is suitable for this.
	    </p>
	</li>
    </ul>
  
</div>
<div class="footer">
<hr>
<p>Copyright © 2003-2016 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div></body>
</html>
