<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:erl="http://erlang.org" xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<link rel="stylesheet" href="../otp_doc.css" type="text/css">
<title>Erlang -- Maps</title>
</head>
<body>
<div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../js/erlresolvelinks.js"></script><script id="js3" type="text/javascript" src="../js/topbar.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function setscrollpos() {
                var objf = document.getElementById('loadscrollpos');
                if (objf) {
                  document.getElementById("leftnav").firstChild.scrollTop = objf.offsetTop - 10;
                }
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //-->
</script><div class="topbar">
<div class="topbar-expand "><button onclick="toggleDisplay();"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="Capa_1" viewBox="0 0 54 54" width="24" height="24"><g><path style="fill:#000000;" d="M27,54c-0.552,0-1-0.448-1-1V8c0-0.552,0.448-1,1-1s1,0.448,1,1v45C28,53.552,27.552,54,27,54z"></path><path style="fill:#000000;" d="M11,25c-0.256,0-0.512-0.098-0.707-0.293c-0.391-0.391-0.391-1.023,0-1.414l16-16                                      c0.391-0.391,1.023-0.391,1.414,0s0.391,1.023,0,1.414l-16,16C11.512,24.902,11.256,25,11,25z"></path><path style="fill:#000000;" d="M43,25c-0.256,0-0.512-0.098-0.707-0.293l-16-16c-0.391-0.391-0.391-1.023,0-1.414                                      s1.023-0.391,1.414,0l16,16c0.391,0.391,0.391,1.023,0,1.414C43.512,24.902,43.256,25,43,25z"></path><path style="fill:#000000;" d="M43,2H11c-0.552,0-1-0.448-1-1s0.448-1,1-1h32c0.552,0,1,0.448,1,1S43.552,2,43,2z"></path></g></svg></button></div>
<div class="topbar-title"><h1 id="Maps">5 
                Maps</h1></div>
<div class="search-expand "></div>
</div>
<aside class="hide-mobile" id="leftnav"><nav class="leftnav-tube"><div class="erlang-logo-wrapper"><a href="../index.html"><img alt="Erlang Logo" src="../erlang-logo.png" class="erlang-logo"></a></div>
<p class="section-title">Efficiency Guide</p>
<p class="section-subtitle">User's Guide</p>
<p class="section-version">Version 12.1.2</p>
<ul class="panel-sections">
<li><a href="users_guide.html">User's Guide</a></li>
<li><a href="../pdf/otp-system-documentation.pdf">PDF</a></li>
<li><a href="../index.html">Top</a></li>
</ul>
<ul class="expand-collapse-items">
<li><a href="javascript:openAllFlips()">Expand All</a></li>
<li><a href="javascript:closeAllFlips()">Contract All</a></li>
</ul>
<h3 id="chapters">Chapters</h3>
<ul class="flipMenu" imagePath="../js/flipmenu">
<li id="no" title="Introduction" expanded="false">Introduction<ul>
<li><a href="introduction.html">
              Top of chapter
            </a></li>
<li title="Purpose"><a href="introduction.html#purpose">Purpose</a></li>
<li title="Prerequisites"><a href="introduction.html#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li id="no" title="The Seven Myths of Erlang Performance" expanded="false">The Seven Myths of Erlang Performance<ul>
<li><a href="myths.html">
              Top of chapter
            </a></li>
<li title="Myth: Tail-Recursive Functions are Much Faster
    Than Recursive Functions"><a href="myths.html#myth--tail-recursive-functions-are-much-faster-----than-recursive-functions">Myth: Tail-Recursive Functions are Much Faster
    Than Recursive Functions</a></li>
<li title='Myth: Operator "++" is Always Bad'><a href="myths.html#myth--operator--++--is-always-bad">Myth: Operator "++" is Always Bad</a></li>
<li title="Myth: Strings are Slow"><a href="myths.html#myth--strings-are-slow">Myth: Strings are Slow</a></li>
<li title="Myth: Repairing a Dets File is Very Slow"><a href="myths.html#myth--repairing-a-dets-file-is-very-slow">Myth: Repairing a Dets File is Very Slow</a></li>
<li title="Myth: BEAM is a Stack-Based Byte-Code Virtual Machine
    (and Therefore Slow)"><a href="myths.html#myth--beam-is-a-stack-based-byte-code-virtual-machine------and-therefore-slow-">Myth: BEAM is a Stack-Based Byte-Code Virtual Machine
    (and Therefore Slow)</a></li>
<li title='Myth: Use "_" to Speed Up Your Program When a Variable
    is Not Used'><a href="myths.html#myth--use--_--to-speed-up-your-program-when-a-variable-----is-not-used">Myth: Use "_" to Speed Up Your Program When a Variable
    is Not Used</a></li>
<li title="Myth: A NIF Always Speeds Up Your Program"><a href="myths.html#myth--a-nif-always-speeds-up-your-program">Myth: A NIF Always Speeds Up Your Program</a></li>
</ul>
</li>
<li id="no" title="Common Caveats" expanded="false">Common Caveats<ul>
<li><a href="commoncaveats.html">
              Top of chapter
            </a></li>
<li title="Timer Module"><a href="commoncaveats.html#timer-module">Timer Module</a></li>
<li title="Accidental Copying and Loss of Sharing"><a href="commoncaveats.html#accidental-copying-and-loss-of-sharing">Accidental Copying and Loss of Sharing</a></li>
<li title="list_to_atom/1"><a href="commoncaveats.html#list_to_atom-1">list_to_atom/1</a></li>
<li title="length/1"><a href="commoncaveats.html#length-1">length/1</a></li>
<li title="setelement/3"><a href="commoncaveats.html#setelement-3">setelement/3</a></li>
<li title="size/1"><a href="commoncaveats.html#size-1">size/1</a></li>
<li title="split_binary/2"><a href="commoncaveats.html#split_binary-2">split_binary/2</a></li>
</ul>
</li>
<li id="no" title="Constructing and Matching Binaries" expanded="false">Constructing and Matching Binaries<ul>
<li><a href="binaryhandling.html">
              Top of chapter
            </a></li>
<li title="How Binaries are Implemented"><a href="binaryhandling.html#how-binaries-are-implemented">How Binaries are Implemented</a></li>
<li title="Constructing Binaries"><a href="binaryhandling.html#constructing-binaries">Constructing Binaries</a></li>
<li title="Matching Binaries"><a href="binaryhandling.html#matching-binaries">Matching Binaries</a></li>
<li title="Historical Note"><a href="binaryhandling.html#historical-note">Historical Note</a></li>
</ul>
</li>
<li id="loadscrollpos" title="Maps" expanded="true">Maps<ul>
<li><a href="maps.html">
              Top of chapter
            </a></li>
<li title="Maps or Records?"><a href="maps.html#maps-or-records-">Maps or Records?</a></li>
<li title="Using Maps as an Alternative to Records"><a href="maps.html#using-maps-as-an-alternative-to-records">Using Maps as an Alternative to Records</a></li>
<li title="Using Maps as Dictionaries"><a href="maps.html#using-maps-as-dictionaries">Using Maps as Dictionaries</a></li>
<li title="Using Maps as Sets"><a href="maps.html#using-maps-as-sets">Using Maps as Sets</a></li>
<li title="How Maps are Implemented"><a href="maps.html#how-maps-are-implemented">How Maps are Implemented</a></li>
<li title="Using the Map Syntax"><a href="maps.html#using-the-map-syntax">Using the Map Syntax</a></li>
<li title="Using the Functions in the maps Module"><a href="maps.html#using-the-functions-in-the-maps-module">Using the Functions in the maps Module</a></li>
</ul>
</li>
<li id="no" title="List Handling" expanded="false">List Handling<ul>
<li><a href="listHandling.html">
              Top of chapter
            </a></li>
<li title="Creating a List"><a href="listHandling.html#creating-a-list">Creating a List</a></li>
<li title="List Comprehensions"><a href="listHandling.html#list-comprehensions">List Comprehensions</a></li>
<li title="Deep and Flat Lists"><a href="listHandling.html#deep-and-flat-lists">Deep and Flat Lists</a></li>
<li title="Recursive List Functions"><a href="listHandling.html#recursive-list-functions">Recursive List Functions</a></li>
</ul>
</li>
<li id="no" title="Functions" expanded="false">Functions<ul>
<li><a href="functions.html">
              Top of chapter
            </a></li>
<li title="Pattern Matching"><a href="functions.html#pattern-matching">Pattern Matching</a></li>
<li title="Function Calls"><a href="functions.html#function-calls">Function Calls</a></li>
<li title="Memory Usage in Recursion"><a href="functions.html#memory-usage-in-recursion">Memory Usage in Recursion</a></li>
</ul>
</li>
<li id="no" title="Tables and Databases" expanded="false">Tables and Databases<ul>
<li><a href="tablesDatabases.html">
              Top of chapter
            </a></li>
<li title="Ets, Dets, and Mnesia"><a href="tablesDatabases.html#ets,-dets,-and-mnesia">Ets, Dets, and Mnesia</a></li>
<li title="Ets-Specific"><a href="tablesDatabases.html#ets-specific">Ets-Specific</a></li>
<li title="Mnesia-Specific"><a href="tablesDatabases.html#mnesia-specific">Mnesia-Specific</a></li>
</ul>
</li>
<li id="no" title="Processes" expanded="false">Processes<ul>
<li><a href="processes.html">
              Top of chapter
            </a></li>
<li title="Creating an Erlang Process"><a href="processes.html#creating-an-erlang-process">Creating an Erlang Process</a></li>
<li title="Sending Messages"><a href="processes.html#sending-messages">Sending Messages</a></li>
<li title="Receiving messages"><a href="processes.html#receiving-messages">Receiving messages</a></li>
<li title="Literal Pool"><a href="processes.html#literal-pool">Literal Pool</a></li>
<li title="Loss of Sharing"><a href="processes.html#loss-of-sharing">Loss of Sharing</a></li>
<li title="SMP Emulator"><a href="processes.html#smp-emulator">SMP Emulator</a></li>
</ul>
</li>
<li id="no" title="Drivers" expanded="false">Drivers<ul>
<li><a href="drivers.html">
              Top of chapter
            </a></li>
<li title="Drivers and Concurrency"><a href="drivers.html#drivers-and-concurrency">Drivers and Concurrency</a></li>
<li title="Avoiding Copying Binaries When Calling a Driver"><a href="drivers.html#avoiding-copying-binaries-when-calling-a-driver">Avoiding Copying Binaries When Calling a Driver</a></li>
<li title="Returning Small Binaries from a Driver"><a href="drivers.html#returning-small-binaries-from-a-driver">Returning Small Binaries from a Driver</a></li>
<li title="Returning Large Binaries without Copying from a Driver"><a href="drivers.html#returning-large-binaries-without-copying-from-a-driver">Returning Large Binaries without Copying from a Driver</a></li>
</ul>
</li>
<li id="no" title="Advanced" expanded="false">Advanced<ul>
<li><a href="advanced.html">
              Top of chapter
            </a></li>
<li title="Memory"><a href="advanced.html#memory">Memory</a></li>
<li title="System Limits"><a href="advanced.html#system-limits">System Limits</a></li>
</ul>
</li>
<li id="no" title="Profiling" expanded="false">Profiling<ul>
<li><a href="profiling.html">
              Top of chapter
            </a></li>
<li title="Do Not Guess About Performance - Profile"><a href="profiling.html#do-not-guess-about-performance---profile">Do Not Guess About Performance - Profile</a></li>
<li title="Memory profiling"><a href="profiling.html#memory-profiling">Memory profiling</a></li>
<li title="Large Systems"><a href="profiling.html#large-systems">Large Systems</a></li>
<li title="What to Look For"><a href="profiling.html#what-to-look-for">What to Look For</a></li>
<li title="Tools"><a href="profiling.html#tools">Tools</a></li>
<li title="Benchmarking"><a href="profiling.html#benchmarking">Benchmarking</a></li>
</ul>
</li>
<li id="no" title="Retired Myths" expanded="false">Retired Myths<ul>
<li><a href="retired_myths.html">
              Top of chapter
            </a></li>
<li title="Myth: Funs are Slow"><a href="retired_myths.html#myth--funs-are-slow">Myth: Funs are Slow</a></li>
<li title="Myth: List Comprehensions are Slow"><a href="retired_myths.html#myth--list-comprehensions-are-slow">Myth: List Comprehensions are Slow</a></li>
<li title='Myth: List subtraction ("--" operator) is slow'><a href="retired_myths.html#myth--list-subtraction-------operator--is-slow">Myth: List subtraction ("--" operator) is slow</a></li>
</ul>
</li>
</ul></nav></aside><div id="content">
<div class="innertube">
<h1 id="Maps">5 Maps</h1>
  

  <p>This guide to using maps efficiently starts with a brief section
  on the choice between records or maps, followed by three sections
  giving concrete (but brief) advice on using maps as an alternative to
  records, as dictionaries, and as sets. The remaining sections dig
  deeper, looking at how maps are implemented, the map syntax, and
  finally the functions in the <span class="bold_code bc-18"><a href="../man/maps.html">maps</a></span> module.</p>

  <p>Terminology used in this chapter:</p>
  <ul>
    <li>A map with at most 32 elements will informally be called a
    <strong>small map</strong>.</li>
    <li>A map with more than 32 elements will informally be called a
    <strong>large map</strong>.</li>
  </ul>

  <h3 id="maps-or-records-" class="title-link" onMouseOver="document.getElementById('ghlink-maps-or-records--idm477').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-or-records--idm477').style.visibility = 'hidden';">
<div class="title-name">5.1 
        Maps or Records?</div>
<div class="title-anchors"><span id="ghlink-maps-or-records--idm477" class="ghlink-after"><a href="#maps-or-records-" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L48" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>If the advice in this chapter is followed, the performance of
    records compared to using small maps instead of records is
    expected to be similar. Therefore, the choice between records and
    maps should be based on the desired properties of the data
    structure and not performance.</p>

    <p>The advantages of records compared to maps are:</p>

    <ul>
      <li>If the name of a record field is misspelled, there will be
      a compilation error. If a map key is misspelled, the compiler
      will give no warning and program will fail in some way when it
      is run.</li>

      <li>Records will use slightly less memory than maps, and
      performance is expected to be <strong>slightly</strong> better than maps
      in most circumstances.</li>
    </ul>

    <p>The disadvantage of records compared to maps is that if a new
    field is added to a record, all code that uses that record must be
    recompiled. Because of that, it is recommended to only use records
    within a unit of code that can easily be recompiled all at once, for
    example within a single application or single module.</p>
  

  <h3 id="using-maps-as-an-alternative-to-records" class="title-link" onMouseOver="document.getElementById('ghlink-using-maps-as-an-alternative-to-records-idm486').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-using-maps-as-an-alternative-to-records-idm486').style.visibility = 'hidden';">
<div class="title-name">5.2 
        Using Maps as an Alternative to Records</div>
<div class="title-anchors"><span id="ghlink-using-maps-as-an-alternative-to-records-idm486" class="ghlink-after"><a href="#using-maps-as-an-alternative-to-records" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L76" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    

    <ul>
      <li><p>Use the map syntax instead of the functions in
      the <span class="bold_code bc-18"><a href="../man/maps.html">maps</a></span> module.</p></li>

      <li><p>Avoid having more than 32 elements in the
      map. As soon as there are more than 32 elements in the map,
      it will require more memory and keys can no longer be shared
      with other instances of the map.</p></li>

      <li><p>When creating a new map, always create it with all keys
      that will ever be used. To maximize sharing of keys (thus
      minimizing memory use), create a single function that constructs
      the map using the map syntax and always use it.</p></li>

      <li><p>Always update the map using the
      <span class="code">:=</span> operator (that is, requiring that an element with
      that key already exists). The <span class="code">:=</span> operator is slightly
      more efficient, and it helps catching mispellings of
      keys.</p></li>

      <li><p>Whenever possible, match multiple map elements at
      once.</p></li>

      <li><p>Whenever possible, update multiple map elements at
      once.</p></li>

      <li><p>Avoid default values and the <span class="bold_code bc-13"><a href="../man/maps.html#get-3">maps:get/3</a></span> function. If
      there are default values, sharing of keys between different
      instances of the map will be less effective, and it is not
      possible to match multiple elements having default values in one
      go. The <span class="code">maps:get/3</span> function is <span class="bold_code bc-17"><a href="#maps_get_3">implemented in Erlang</a></span>, making it
      less efficient than <span class="code">maps:get/2</span> or the map matching
      syntax.</p></li>

      <li>
<p>To avoid having to deal with a map that may lack some keys,
      <span class="bold_code bc-13"><a href="../man/maps.html#merge-2">maps:merge/2</a></span>
      can efficiently add multiple default values. For example:</p>
      <div class="example example-erl"><pre>      DefaultMap = #{shoe_size =&gt; 42, editor =&gt; emacs},
      MapWithDefaultsApplied = maps:merge(DefaultMap, OtherMap)</pre></div>
      </li>
    </ul>
  

  <h3 id="using-maps-as-dictionaries" class="title-link" onMouseOver="document.getElementById('ghlink-using-maps-as-dictionaries-idm514').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-using-maps-as-dictionaries-idm514').style.visibility = 'hidden';">
<div class="title-name">5.3 
        Using Maps as Dictionaries</div>
<div class="title-anchors"><span id="ghlink-using-maps-as-dictionaries-idm514" class="ghlink-after"><a href="#using-maps-as-dictionaries" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L125" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    

    <p>Using a map as a dictionary implies the following usage pattern:</p>
    <ul>
      <li><p>Keys are usually variables not known at compile-time.</p></li>
      <li><p>There can be any number of elements in the map.</p></li>
      <li><p>Usually, no more than one element is looked up or
      updated at once.</p></li>
    </ul>

    <p>Given that usage pattern, the difference in performance between
    using the map syntax and the maps module is usually
    small. Therefore, which one to use is mostly a matter of
    taste.</p>

    <p>Maps are usually the most efficient dictionary data structure,
    with a few exceptions:</p>

    <ul>
      <li><p>If it is necessary to frequently convert a
      dictionary to a sorted list, or from a sorted list to a
      dictionary, using <span class="bold_code bc-18"><a href="../man/gb_trees.html">gb_trees</a></span>
      can be a better choice.</p></li>

      <li><p>If all keys are non-negative integers, the <span class="bold_code bc-18"><a href="../man/array.html">array</a></span> module can be a better
      choice.</p></li>
    </ul>
  

  <h3 id="using-maps-as-sets" class="title-link" onMouseOver="document.getElementById('ghlink-using-maps-as-sets-idm533').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-using-maps-as-sets-idm533').style.visibility = 'hidden';">
<div class="title-name">5.4 
        Using Maps as Sets</div>
<div class="title-anchors"><span id="ghlink-using-maps-as-sets-idm533" class="ghlink-after"><a href="#using-maps-as-sets" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L156" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    

    <p>Starting in OTP 24, the <span class="bold_code bc-18"><a href="../man/sets.html">sets</a></span> module
    has an option to represent sets as maps. Examples:</p>

    <div class="example example-erl"><pre>1&gt; sets:new([{version,2}]).
#{}
2&gt; sets:from_list([x,y,z], [{version,2}]).
#{x =&gt; [],y =&gt; [],z =&gt; []}</pre></div>

    <p><span class="code">sets</span> backed by maps is generally the most efficient set
    representation, with a few possible exceptions:</p>

    <ul>
      <li><p><span class="bold_code bc-13"><a href="../man/ordsets.html#intersection-2">ordsets:intersection/2</a></span>
      can be more efficient than <span class="bold_code bc-13"><a href="../man/sets.html#intersection-2">sets:intersection/2</a></span>.
      If the intersection operation is frequently used and operations
      that operate on a single element in a set (such as
      <span class="code">is_element/2</span>) are avoided, <span class="bold_code bc-18"><a href="../man/ordsets.html">ordsets</a></span> can be a better
      choice than <span class="bold_code bc-18"><a href="../man/sets.html">sets</a></span>.</p></li>

      <li><p>If the intersection operation is frequently used and operations
      that operate on a single element in a set (such as
      <span class="code">is_element/2</span>) must also be efficient, <span class="bold_code bc-18"><a href="../man/gb_sets.html">gb_sets</a></span> can potentially be a
      better choice than <span class="bold_code bc-18"><a href="../man/sets.html">sets</a></span>.</p></li>

      <li><p>If the elements of the set are integers in a fairly
      compact range, the set can be represented as an integer where
      each bit represents an element in the set. The union operation
      is performed by <span class="code">bor</span> and the intersection operation by
      <span class="code">band</span>.</p></li>
    </ul>
  

  <h3 id="how-maps-are-implemented" class="title-link" onMouseOver="document.getElementById('ghlink-how-maps-are-implemented-idm557').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-how-maps-are-implemented-idm557').style.visibility = 'hidden';">
<div class="title-name">5.5 
        How Maps are Implemented</div>
<div class="title-anchors"><span id="ghlink-how-maps-are-implemented-idm557" class="ghlink-after"><a href="#how-maps-are-implemented" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L196" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>Internally, maps have two distinct representations depending on
    the number of elements in the map. The representation changes
    when a map grows beyond 32 elements, or when it shrinks to 32
    elements or less.</p>

    <ul>
      <li>A map with at most 32 elements has a compact
      representation, making it suitable as an alternative to
      records.</li>
      <li>A map with more than 32 elements is represented as a tree
      that can be efficiently searched and updated regardless of how
      many elements there are.</li>
    </ul>

    <h4 id="how-small-maps-are-implemented" class="title-link" onMouseOver="document.getElementById('ghlink-how-small-maps-are-implemented-idm563').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-how-small-maps-are-implemented-idm563').style.visibility = 'hidden';">
<div class="title-name">How Small Maps are Implemented</div>
<div class="title-anchors"><span id="ghlink-how-small-maps-are-implemented-idm563" class="ghlink-after"><a href="#how-small-maps-are-implemented" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L212" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>A small map looks like this inside the runtime system:</p>
      <div class="doc-table-wrapper">
<table class="doc-table"><tr>
          <td align="left" valign="middle"><span class="code">FLATMAP</span></td>
          <td align="left" valign="middle"><strong>N</strong></td>
          <td align="left" valign="middle"><strong>Keys</strong></td>
          <td align="left" valign="middle"><strong>Value1</strong></td>
          <td align="left" valign="middle"><strong>. . .</strong></td>
          <td align="left" valign="middle"><strong>ValueN</strong></td>
        </tr></table>
<p class="doc-table-caption">Table
        5.1:
         
        The representation of a small map</p>
</div>

      <dl>
        <dt><strong><span class="code">FLATMAP</span></strong></dt>
        <dd>The tag for a small map (called <strong>flat map</strong> in
        the source code for the runtime system).</dd>

        <dt><strong>N</strong></dt>
        <dd>The number of elements in the map.</dd>

        <dt><strong>Keys</strong></dt>
        <dd>A tuple with keys of the map: <span class="code">{Key1,...,KeyN}</span>. The
        keys are sorted.</dd>

        <dt><strong>Value1</strong></dt>
        <dd>The value corresponding to the first key in the key tuple.</dd>

        <dt><strong>ValueN</strong></dt>
        <dd>The value corresponding to the last key in the key tuple.</dd>
      </dl>

      <p>As an example, let us look at how the map <span class="code">#{a =&gt; foo, z =&gt; bar}</span>
      is represented:</p>

      <div class="doc-table-wrapper">
<table class="doc-table"><tr>
          <td align="left" valign="middle"><span class="code">FLATMAP</span></td>
          <td align="left" valign="middle"><strong>2</strong></td>
          <td align="left" valign="middle"><strong>{a,z}</strong></td>
          <td align="left" valign="middle"><strong>foo</strong></td>
          <td align="left" valign="middle"><strong>bar</strong></td>
        </tr></table>
<p class="doc-table-caption">Table
        5.2:
         
        #{a =&gt; foo, z =&gt; bar}</p>
</div>

      <p>Let us update the map: <span class="code">M#{q =&gt; baz}</span>. The map now looks
      like this:</p>

      <div class="doc-table-wrapper">
<table class="doc-table"><tr>
          <td align="left" valign="middle"><span class="code">FLATMAP</span></td>
          <td align="left" valign="middle"><strong>3</strong></td>
          <td align="left" valign="middle"><strong>{a,q,z}</strong></td>
          <td align="left" valign="middle"><strong>foo</strong></td>
          <td align="left" valign="middle"><strong>baz</strong></td>
          <td align="left" valign="middle"><strong>bar</strong></td>
        </tr></table>
<p class="doc-table-caption">Table
        5.3:
         
        #{a =&gt; foo, q =&gt; baz, z =&gt; bar}</p>
</div>

      <p>Finally, change the value of one element: <span class="code">M#{z :=
      bird}</span>. The map now looks like this:</p>

      <div class="doc-table-wrapper">
<table class="doc-table"><tr>
          <td align="left" valign="middle"><span class="code">FLATMAP</span></td>
          <td align="left" valign="middle"><strong>3</strong></td>
          <td align="left" valign="middle"><strong>{a,q,z}</strong></td>
          <td align="left" valign="middle"><strong>foo</strong></td>
          <td align="left" valign="middle"><strong>baz</strong></td>
          <td align="left" valign="middle"><strong>bird</strong></td>
        </tr></table>
<p class="doc-table-caption">Table
        5.4:
         
        #{a =&gt; foo, q =&gt; baz, z =&gt; bird}</p>
</div>

      <p>When the value for an existing key is updated, the key tuple is not
      updated, allowing the key tuple to be shared with other instances of the
      map that have the same keys. In fact, the key tuple can be shared between all
      maps with the same keys with some care. To arrange that, define a function that
      returns a map. For example:</p>

      <div class="example example-erl"><pre>new() -&gt;
    #{a =&gt; default, b =&gt; default, c =&gt; default}.</pre></div>

      <p>Defined like this, the key tuple <span class="code">{a,b,c}</span> will be a
      global literal. To ensure that the key tuple is shared
      when creating an instance of the map, always call
      <span class="code">new()</span> and modify the returned map:</p>

      <div class="example example-erl"><pre>    (SOME_MODULE:new())#{a := 42}.</pre></div>

      <p>Using the map syntax with small maps is particularly
      efficient. As long as the keys are known at compile-time, the
      map is updated in one go, making the time to update a map
      essentially constant regardless of the number of keys
      updated. The same goes for matching. (When the keys are
      variables, one or more of the keys could be identical, so the
      operations need to be performed sequentially from left to
      right.)</p>

      <p>The memory size for a small map is the size of all keys and values
      plus 5 words. See <span class="bold_code bc-15"><a href="advanced.html#memory">Advanced</a></span>
      for more information about memory sizes.</p>
    

    <h4 id="how-large-maps-are-implemented" class="title-link" onMouseOver="document.getElementById('ghlink-how-large-maps-are-implemented-idm653').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-how-large-maps-are-implemented-idm653').style.visibility = 'hidden';">
<div class="title-name">How Large Maps are Implemented</div>
<div class="title-anchors"><span id="ghlink-how-large-maps-are-implemented-idm653" class="ghlink-after"><a href="#how-large-maps-are-implemented" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L322" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      

      <p>A map with more than 32 elements is implemented as a <span class="bold_code bc-20"><a href="https://en.wikipedia.org/wiki/Hash_array_mapped_trie">Hash
      array mapped trie (HAMT)</a></span>. A large map can be efficiently
      searched and updated regardless of the number of elements in the
      map.</p>

      <p>There is less performance to be gained by matching or
      updating multiple elements using the map syntax on a large map
      compared to a small map. The execution time is roughly proportional
      to the number of elements matched or updated.</p>

      <p>The storage overhead for a large map is higher than for a
      small map. For a large map, the extra number of words besides
      the keys and values is roughly proportional to the number of
      elements. For a map with 33 elements the overhead is at
      least 53 heap words according to the formula in <span class="bold_code bc-15"><a href="advanced.html#memory">Advanced</a></span> (compared to 5
      extra words for a small map regardless of the number of
      elements).</p>

      <p>When a large map is updated, the updated map and the original
      map will share common parts of the HAMT, but sharing will never
      be as effective as the best possible sharing of the key tuple
      for small maps.</p>

      <p>Therefore, if maps are used instead of records and it is
      expected that many instances of the map will be created, it is
      more efficient from a memory standpoint to avoid using large
      maps (for example, by grouping related map elements into sub
      maps to reduce the number of elements).</p>
    
  

  <h3 id="using-the-map-syntax" class="title-link" onMouseOver="document.getElementById('ghlink-using-the-map-syntax-idm662').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-using-the-map-syntax-idm662').style.visibility = 'hidden';">
<div class="title-name">5.6 
        Using the Map Syntax</div>
<div class="title-anchors"><span id="ghlink-using-the-map-syntax-idm662" class="ghlink-after"><a href="#using-the-map-syntax" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L358" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    

    <p>Using the map syntax is usually slightly more efficient than
    using the corresponding function in the <span class="bold_code bc-18"><a href="../man/maps.html">maps</a></span> module.</p>

    <p>The gain in efficiency for the map syntax is more noticeable
    for the following operations that can only be achieved using the
    map syntax:</p>

    <ul>
      <li><p>Matching multiple literal keys</p></li>
      <li><p>Updating multiple literal keys</p></li>
      <li><p>Adding multiple literal keys to a map</p></li>
    </ul>

    <p>For example:</p>

    <p><strong>DO</strong></p>
    <div class="example example-erl"><pre>    Map = Map1#{x := X, y := Y, z := Z}</pre></div>

    <p><strong>DO NOT</strong></p>
    <div class="example example-erl"><pre>    Map2 = maps:update(x, X, Map1),
    Map3 = maps:update(y, Y, Map2),
    Map = maps:update(z, Z, Map3)</pre></div>

    <p>If the map is a small map, the first example runs roughly
    three times as fast.</p>

    <p>Note that for variable keys, the elements are updated
    sequentially from left to right. For example, given the following
    update with variable keys:</p>

    <div class="example example-erl"><pre>    Map = Map1#{Key1 := X, Key2 := Y, Key3 := Z}</pre></div>

    <p>the compiler rewrites it like this to ensure that the updates
    are applied from left to right:</p>

    <div class="example example-erl"><pre>    Map2 = Map1#{Key1 := X},
    Map3 = Map2#{Key2 := Y},
    Map = Map3#{Key3 := Z}</pre></div>

    <p>If a key is known to exist in a map, using the <span class="code">:=</span>
    operator is slightly more efficient than using the <span class="code">=&gt;</span>
    operator for a small map.</p>
  

  <h3 id="using-the-functions-in-the-maps-module" class="title-link" onMouseOver="document.getElementById('ghlink-using-the-functions-in-the-maps-module-idm689').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-using-the-functions-in-the-maps-module-idm689').style.visibility = 'hidden';">
<div class="title-name">5.7 
        Using the Functions in the maps Module</div>
<div class="title-anchors"><span id="ghlink-using-the-functions-in-the-maps-module-idm689" class="ghlink-after"><a href="#using-the-functions-in-the-maps-module" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L410" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    

    <p>Here follows some notes about most of the functions in the
    <span class="code">maps</span> module. For each function, the implementation language
    (C or Erlang) is stated. The reason we mention the language is
    that it gives an hint about how efficient the function is:</p>

    <ul>
      <li><p>If a function is implemented in C, it is pretty much
      impossible to implement the same functionality more efficiently
      in Erlang.</p></li>

      <li>
<p>However, it might be possible to beat the <span class="code">maps</span>
      modules functions implemented in Erlang, because they are
      generally implemented in a way that attempts to make the performance
      reasonable for all possible inputs.</p>

      <p>For example, <span class="bold_code bc-13"><a href="../man/maps.html#map-2">maps:map/2</a></span> iterates over
      all elements of the map, calling the mapping fun, collects the
      updated map elements in a list, and finally converts the list
      back to a map using <span class="bold_code bc-13"><a href="../man/maps.html#from_list-1">maps:from_list/1</a></span>. If
      it is known that at most one percent of the values in the map
      will change, it can be more efficient to update only the
      changed values.</p>
</li>
    </ul>

    <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>The implementation details given in this section can
    change in the future.</p></p></div>
</div>

    <h4 id="maps-filter-2" class="title-link" onMouseOver="document.getElementById('ghlink-maps-filter-2-idm704').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-filter-2-idm704').style.visibility = 'hidden';">
<div class="title-name">maps:filter/2</div>
<div class="title-anchors"><span id="ghlink-maps-filter-2-idm704" class="ghlink-after"><a href="#maps-filter-2" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L442" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#filter-2">maps:filter/2</a></span>
      is implemented in Erlang. It creates a new map using <span class="bold_code bc-13"><a href="../man/maps.html#from_list-1">maps:from_list/1</a></span>. If
      it is known that only a minority of the values will be removed,
      it can be more efficient to avoid <span class="code">maps:filter/2</span> and write
      a function that will use <span class="bold_code bc-13"><a href="../man/maps.html#remove-2">maps:remove/3</a></span> to remove
      the unwanted values.</p>
    

    <h4 id="maps-filtermap-2" class="title-link" onMouseOver="document.getElementById('ghlink-maps-filtermap-2-idm711').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-filtermap-2-idm711').style.visibility = 'hidden';">
<div class="title-name">maps:filtermap/2</div>
<div class="title-anchors"><span id="ghlink-maps-filtermap-2-idm711" class="ghlink-after"><a href="#maps-filtermap-2" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L454" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#filtermap-2">maps:filtermap/2</a></span> is
      implemented in Erlang. It creates a new map using <span class="bold_code bc-13"><a href="../man/maps.html#from_list-1">maps:from_list/1</a></span>. See
      the notes for <span class="code">maps:map/2</span> and <span class="code">maps:filter/2</span> for
      hints on how to implement a more efficient version.</p>
    

    <h4 id="maps-find-2" class="title-link" onMouseOver="document.getElementById('ghlink-maps-find-2-idm718').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-find-2-idm718').style.visibility = 'hidden';">
<div class="title-name">maps:find/2</div>
<div class="title-anchors"><span id="ghlink-maps-find-2-idm718" class="ghlink-after"><a href="#maps-find-2" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L464" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#find-2">maps:find/2</a></span> is
      implemented in C.</p>
      <p>Using the map matching syntax instead of <span class="code">maps:find/2</span>
      will be slightly more efficient since building an
      <span class="code">{ok,Value}</span> tuple will be avoided.</p>
    

    <h4 id="maps-get-2" class="title-link" onMouseOver="document.getElementById('ghlink-maps-get-2-idm725').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-get-2-idm725').style.visibility = 'hidden';">
<div class="title-name">maps:get/2</div>
<div class="title-anchors"><span id="ghlink-maps-get-2-idm725" class="ghlink-after"><a href="#maps-get-2" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L473" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>As an optimization, the compiler will rewrite a call to <span class="bold_code bc-13"><a href="../man/maps.html#get-2">maps:get/2</a></span> to a call to the
      guard BIF <span class="bold_code bc-13"><a href="../man/erlang.html#map_get-2">map_get/2</a></span>. A call to a
      guard BIF is more efficient than calls to other BIFs, making the
      performance similar to using the map matching syntax.</p>

      <p>If the map is small and the keys are constants known at
      compile-time, using the map matching syntax will be more
      efficient than multiple calls to <span class="code">maps:get/2</span>.</p>
    

    <a name="maps_get_3"></a><h4 id="maps-get-3" class="title-link" onMouseOver="document.getElementById('ghlink-maps-get-3-idm732').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-get-3-idm732').style.visibility = 'hidden';">
<div class="title-name">maps:get/3</div>
<div class="title-anchors"><span id="ghlink-maps-get-3-idm732" class="ghlink-after"><a href="#maps-get-3" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L487" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#get-3">maps:get/3</a></span>
      is implemented in Erlang essentially like this:</p>

      <div class="example example-erl"><pre>get(Key, Map, Default) -&gt;
    case Map of
        #{Key := Value} -&gt; Value;
        #{} -&gt; Default
    end.</pre></div>

      <p>Therefore, a call <span class="code">maps:get/3</span> is more expensive than a
      call to <span class="code">maps:get/2</span>.</p>

      <p>If a small map is used as alternative to using a record,
      instead of calling <span class="code">maps:get/3</span> multiple times to handle
      default values, consider putting the default values in a map and
      merging that map with the other map:</p>

      <div class="example example-erl"><pre>    DefaultMap = #{Key1 =&gt; Value2, Key2 =&gt; Value2, ..., KeyN =&gt; ValueN},
    MapWithDefaultsApplied = maps:merge(DefaultMap, OtherMap)</pre></div>

      <p>Whether that is faster than calling <span class="code">maps:get/3</span>
      multiple times depends on the size of the map and the number of
      default values.</p>
    

    <h4 id="maps-intersect-2,-maps-intersect_with-3" class="title-link" onMouseOver="document.getElementById('ghlink-maps-intersect-2,-maps-intersect_with-3-idm746').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-intersect-2,-maps-intersect_with-3-idm746').style.visibility = 'hidden';">
<div class="title-name">maps:intersect/2, maps:intersect_with/3</div>
<div class="title-anchors"><span id="ghlink-maps-intersect-2,-maps-intersect_with-3-idm746" class="ghlink-after"><a href="#maps-intersect-2,-maps-intersect_with-3" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L517" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#intersect-2">maps:intersect/2</a></span> and
      <span class="bold_code bc-13"><a href="../man/maps.html#intersect_with-3">maps:intersect_with/3</a></span>
      are implemented in Erlang. They both create new maps using <span class="bold_code bc-13"><a href="../man/maps.html#from_list-1">maps:from_list/1</a></span>.</p>

      <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>A map is usually the most efficient way to implement a
      set, but an exception is the intersection operation, where
      <span class="bold_code bc-13"><a href="../man/ordsets.html#intersection-2">ordsets:intersection/2</a></span>
      used on <span class="bold_code bc-18"><a href="../man/ordsets.html">ordsets</a></span> can be more
      efficient than <span class="code">maps:intersect/2</span> on sets implemented as maps.</p></p></div>
</div>
    

    <h4 id="maps-from_list-1" class="title-link" onMouseOver="document.getElementById('ghlink-maps-from_list-1-idm757').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-from_list-1-idm757').style.visibility = 'hidden';">
<div class="title-name">maps:from_list/1</div>
<div class="title-anchors"><span id="ghlink-maps-from_list-1-idm757" class="ghlink-after"><a href="#maps-from_list-1" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L532" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#from_list-1">maps:from_list/1</a></span> is
      implemented in C.</p>
    

    <h4 id="maps-from_keys-2" class="title-link" onMouseOver="document.getElementById('ghlink-maps-from_keys-2-idm761').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-from_keys-2-idm761').style.visibility = 'hidden';">
<div class="title-name">maps:from_keys/2</div>
<div class="title-anchors"><span id="ghlink-maps-from_keys-2-idm761" class="ghlink-after"><a href="#maps-from_keys-2" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L538" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#from_keys-2">maps:from_keys/2</a></span> is
      implemented in C.</p>
    

    <h4 id="maps-is_key-2" class="title-link" onMouseOver="document.getElementById('ghlink-maps-is_key-2-idm765').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-is_key-2-idm765').style.visibility = 'hidden';">
<div class="title-name">maps:is_key/2</div>
<div class="title-anchors"><span id="ghlink-maps-is_key-2-idm765" class="ghlink-after"><a href="#maps-is_key-2" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L544" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>As an optimization, the compiler rewrites calls to <span class="bold_code bc-13"><a href="../man/maps.html#is_key-2">maps:is_key/2</a></span> to calls
      to the guard BIF <span class="bold_code bc-13"><a href="../man/erlang.html#is_map_key-2">is_map_key/2</a></span>. A call
      to a guard BIF is more efficient than calls to other BIFs,
      making the performance similar to using the map matching syntax.</p>
    

    <h4 id="maps-iterator-1" class="title-link" onMouseOver="document.getElementById('ghlink-maps-iterator-1-idm770').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-iterator-1-idm770').style.visibility = 'hidden';">
<div class="title-name">maps:iterator/1</div>
<div class="title-anchors"><span id="ghlink-maps-iterator-1-idm770" class="ghlink-after"><a href="#maps-iterator-1" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L554" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#iterator-1">maps:iterator/1</a></span>
      is efficiently implemented in C and Erlang.</p>
    

    <h4 id="maps-keys-1" class="title-link" onMouseOver="document.getElementById('ghlink-maps-keys-1-idm774').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-keys-1-idm774').style.visibility = 'hidden';">
<div class="title-name">maps:keys/1</div>
<div class="title-anchors"><span id="ghlink-maps-keys-1-idm774" class="ghlink-after"><a href="#maps-keys-1" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L560" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#keys-1">maps:keys/1</a></span> is
      implemented in C. If the resulting list needs to be ordered, use
      <span class="bold_code bc-13"><a href="../man/lists.html#sort-1">lists:sort/1</a></span> to
      sort the result.</p>
    

    <h4 id="maps-map-2" class="title-link" onMouseOver="document.getElementById('ghlink-maps-map-2-idm779').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-map-2-idm779').style.visibility = 'hidden';">
<div class="title-name">maps:map/2</div>
<div class="title-anchors"><span id="ghlink-maps-map-2-idm779" class="ghlink-after"><a href="#maps-map-2" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L568" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#map-2">maps:map/2</a></span> is
      implemented in Erlang. It creates a new map using <span class="bold_code bc-13"><a href="../man/maps.html#from_list-1">maps:from_list/1</a></span>. If
      it is known that only a minority of the values will be updated,
      it can be more efficient to avoid <span class="code">maps:map/2</span> and write a
      function that will call <span class="bold_code bc-13"><a href="../man/maps.html#update-3">maps:update/3</a></span> to update
      only the values that have changed.</p>
    

    <h4 id="maps-merge-2" class="title-link" onMouseOver="document.getElementById('ghlink-maps-merge-2-idm786').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-merge-2-idm786').style.visibility = 'hidden';">
<div class="title-name">maps:merge/2</div>
<div class="title-anchors"><span id="ghlink-maps-merge-2-idm786" class="ghlink-after"><a href="#maps-merge-2" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L580" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#merge-2">maps:merge/2</a></span>
      is implemented in C.</p>
    

    <h4 id="maps-merge_with-3" class="title-link" onMouseOver="document.getElementById('ghlink-maps-merge_with-3-idm790').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-merge_with-3-idm790').style.visibility = 'hidden';">
<div class="title-name">maps:merge_with/3</div>
<div class="title-anchors"><span id="ghlink-maps-merge_with-3-idm790" class="ghlink-after"><a href="#maps-merge_with-3" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L586" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#merge_with-3">maps:merge_with/3</a></span>
      is implemented in Erlang. It updates and returns the larger of the
      two maps.</p>
    

    <h4 id="maps-new-0" class="title-link" onMouseOver="document.getElementById('ghlink-maps-new-0-idm794').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-new-0-idm794').style.visibility = 'hidden';">
<div class="title-name">maps:new/0</div>
<div class="title-anchors"><span id="ghlink-maps-new-0-idm794" class="ghlink-after"><a href="#maps-new-0" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L593" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>The compiler rewrites a call to <span class="bold_code bc-13"><a href="../man/maps.html#new-0">maps:new/0</a></span> to using the
      syntax <span class="code">#{}</span> for constructing an empty map.</p>
    

    <h4 id="maps-next-1" class="title-link" onMouseOver="document.getElementById('ghlink-maps-next-1-idm799').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-next-1-idm799').style.visibility = 'hidden';">
<div class="title-name">maps:next/1</div>
<div class="title-anchors"><span id="ghlink-maps-next-1-idm799" class="ghlink-after"><a href="#maps-next-1" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L600" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#next-1">maps:next/1</a></span>
      is efficiently implemented in C and Erlang.</p>
    

    <h4 id="maps-put-3" class="title-link" onMouseOver="document.getElementById('ghlink-maps-put-3-idm803').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-put-3-idm803').style.visibility = 'hidden';">
<div class="title-name">maps:put/3</div>
<div class="title-anchors"><span id="ghlink-maps-put-3-idm803" class="ghlink-after"><a href="#maps-put-3" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L606" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#put-3">maps:put/3</a></span> is
      implemented in C.</p>
      <p>If the key is known to already exist in the map, <span class="bold_code bc-13"><a href="../man/maps.html#update-3">maps:update/3</a></span> is
      slightly more efficient than <span class="code">maps:put/3</span>.</p>
      <p>If the keys are constants known at compile-time, using the
      map update syntax with the <span class="code">=&gt;</span> operator is more
      efficient than multiple calls to <span class="code">maps:put/3</span>,
      especially for small maps.</p>
    

    <h4 id="maps-remove-2" class="title-link" onMouseOver="document.getElementById('ghlink-maps-remove-2-idm813').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-remove-2-idm813').style.visibility = 'hidden';">
<div class="title-name">maps:remove/2</div>
<div class="title-anchors"><span id="ghlink-maps-remove-2-idm813" class="ghlink-after"><a href="#maps-remove-2" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L619" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#remove-2">maps:remove/2</a></span>
      is implemented in C.</p>
    

    <h4 id="maps-size-1" class="title-link" onMouseOver="document.getElementById('ghlink-maps-size-1-idm817').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-size-1-idm817').style.visibility = 'hidden';">
<div class="title-name">maps:size/1</div>
<div class="title-anchors"><span id="ghlink-maps-size-1-idm817" class="ghlink-after"><a href="#maps-size-1" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L625" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>As an optimization, the compiler rewrites calls to
      <span class="bold_code bc-13"><a href="../man/maps.html#size-1">maps:size/1</a></span>
      to calls to the guard BIF <span class="bold_code bc-13"><a href="../man/erlang.html#map_size-1">map_size/1</a></span>.
      Calls to guard BIFs are more efficient than calls to other BIFs.</p>
    

    <h4 id="maps-take-2" class="title-link" onMouseOver="document.getElementById('ghlink-maps-take-2-idm822').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-take-2-idm822').style.visibility = 'hidden';">
<div class="title-name">maps:take/2</div>
<div class="title-anchors"><span id="ghlink-maps-take-2-idm822" class="ghlink-after"><a href="#maps-take-2" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L634" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#take-2">maps:take/2</a></span>
      is implemented in C.</p>
    

    <h4 id="maps-to_list-1" class="title-link" onMouseOver="document.getElementById('ghlink-maps-to_list-1-idm826').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-to_list-1-idm826').style.visibility = 'hidden';">
<div class="title-name">maps:to_list/1</div>
<div class="title-anchors"><span id="ghlink-maps-to_list-1-idm826" class="ghlink-after"><a href="#maps-to_list-1" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L640" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#to_list-1">maps:to_list/1</a></span> is
      efficiently implemented in C and Erlang. If the resulting list
      needs to be ordered, use <span class="bold_code bc-13"><a href="../man/lists.html#sort-1">lists:sort/1</a></span> to sort
      the result.</p>

      <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>Maps are usually more performant than <span class="bold_code bc-18"><a href="../man/gb_trees.html">gb_trees</a></span>, but if it is
      necessary to frequently convert to and from sorted lists,
      <span class="code">gb_trees</span> can be a better choice.</p></p></div>
</div>
    

    <h4 id="maps-update-3" class="title-link" onMouseOver="document.getElementById('ghlink-maps-update-3-idm835').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-update-3-idm835').style.visibility = 'hidden';">
<div class="title-name">maps:update/3</div>
<div class="title-anchors"><span id="ghlink-maps-update-3-idm835" class="ghlink-after"><a href="#maps-update-3" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L655" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#update-3">maps:update/3</a></span>
      is implemented in C.</p>

      <p>If the keys are constants known at compile-time, using the
      map update syntax with the <span class="code">:=</span> operator is more
      efficient than multiple calls to <span class="code">maps:update/3</span>,
      especially for small maps.</p>
    

    <h4 id="maps-values-1" class="title-link" onMouseOver="document.getElementById('ghlink-maps-values-1-idm842').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-values-1-idm842').style.visibility = 'hidden';">
<div class="title-name">maps:values/1</div>
<div class="title-anchors"><span id="ghlink-maps-values-1-idm842" class="ghlink-after"><a href="#maps-values-1" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L666" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#values-1">maps:values/1</a></span>
      is implemented in C.</p>
    

    <h4 id="maps-with-2" class="title-link" onMouseOver="document.getElementById('ghlink-maps-with-2-idm846').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-with-2-idm846').style.visibility = 'hidden';">
<div class="title-name">maps:with/2</div>
<div class="title-anchors"><span id="ghlink-maps-with-2-idm846" class="ghlink-after"><a href="#maps-with-2" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L672" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#with-2">maps:with/2</a></span>
      is implemented in Erlang. It creates a new map using <span class="bold_code bc-13"><a href="../man/maps.html#from_list-1">maps:from_list/1</a></span>.</p>
    

    <h4 id="maps-without-2" class="title-link" onMouseOver="document.getElementById('ghlink-maps-without-2-idm851').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maps-without-2-idm851').style.visibility = 'hidden';">
<div class="title-name">maps:without/2</div>
<div class="title-anchors"><span id="ghlink-maps-without-2-idm851" class="ghlink-after"><a href="#maps-without-2" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/maps.xml#L679" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p><span class="bold_code bc-13"><a href="../man/maps.html#without-2">maps:without/2</a></span>
      is implemented in Erlang. It returns a modified copy of the
      input map.</p>
    
  
</div>
<div class="footer">
<hr>
<p>Copyright © 2001-2021 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script type="text/javascript">window.__otpTopDocDir = '../js/';</script><script type="text/javascript" src="../js/highlight.js"></script>
</body>
</html>
