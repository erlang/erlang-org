<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:erl="http://erlang.org" xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<link rel="stylesheet" href="../otp_doc.css" type="text/css">
<title>Erlang -- Supervisor Behaviour</title>
</head>
<body>
<div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../js/erlresolvelinks.js"></script><script id="js3" type="text/javascript" src="../js/topbar.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function setscrollpos() {
                var objf = document.getElementById('loadscrollpos');
                if (objf) {
                  document.getElementById("leftnav").firstChild.scrollTop = objf.offsetTop - 10;
                }
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //-->
</script><div class="topbar">
<div class="topbar-expand "><button onclick="toggleDisplay();"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="Capa_1" viewBox="0 0 54 54" width="24" height="24"><g><path style="fill:#000000;" d="M27,54c-0.552,0-1-0.448-1-1V8c0-0.552,0.448-1,1-1s1,0.448,1,1v45C28,53.552,27.552,54,27,54z"></path><path style="fill:#000000;" d="M11,25c-0.256,0-0.512-0.098-0.707-0.293c-0.391-0.391-0.391-1.023,0-1.414l16-16                                      c0.391-0.391,1.023-0.391,1.414,0s0.391,1.023,0,1.414l-16,16C11.512,24.902,11.256,25,11,25z"></path><path style="fill:#000000;" d="M43,25c-0.256,0-0.512-0.098-0.707-0.293l-16-16c-0.391-0.391-0.391-1.023,0-1.414                                      s1.023-0.391,1.414,0l16,16c0.391,0.391,0.391,1.023,0,1.414C43.512,24.902,43.256,25,43,25z"></path><path style="fill:#000000;" d="M43,2H11c-0.552,0-1-0.448-1-1s0.448-1,1-1h32c0.552,0,1,0.448,1,1S43.552,2,43,2z"></path></g></svg></button></div>
<div class="topbar-title"><h1 id="Supervisor Behaviour">5 
                Supervisor Behaviour</h1></div>
<div class="search-expand ">        <button id="docsearch-mobile">
            <svg fill="#000000" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="24" height="24"><path d="M 21 3 C 11.621094 3 4 10.621094 4 20 C 4 29.378906 11.621094 37 21 37 C 24.710938 37 28.140625 35.804688 30.9375 33.78125 L 44.09375 46.90625 L 46.90625 44.09375 L 33.90625 31.0625 C 36.460938 28.085938 38 24.222656 38 20 C 38 10.621094 30.378906 3 21 3 Z M 21 5 C 29.296875 5 36 11.703125 36 20 C 36 28.296875 29.296875 35 21 35 C 12.703125 35 6 28.296875 6 20 C 6 11.703125 12.703125 5 21 5 Z"/></svg>
        </button>
</div>
</div>
<aside class="hide-mobile" id="leftnav"><nav class="leftnav-tube"><div class="erlang-logo-wrapper"><a href="../index.html"><img alt="Erlang Logo" src="../erlang-logo.png" class="erlang-logo"></a></div>
<p class="section-title">OTP Design Principles</p>
<p class="section-subtitle">User's Guide</p>
<p class="section-version">Version 12.1.2</p>
<ul class="panel-sections">
<li><a href="users_guide.html">User's Guide</a></li>
<li><a href="../pdf/otp-system-documentation.pdf">PDF</a></li>
<li><a href="../index.html">Top</a></li>
</ul>
<div id="docsearch"></div>
<ul class="expand-collapse-items">
<li><a href="javascript:openAllFlips()">Expand All</a></li>
<li><a href="javascript:closeAllFlips()">Contract All</a></li>
</ul>
<h3 id="chapters">Chapters</h3>
<ul class="flipMenu" imagePath="../js/flipmenu">
<li id="no" title="Overview" expanded="false">Overview<ul>
<li><a href="des_princ.html">
              Top of chapter
            </a></li>
<li title="Supervision Trees"><a href="des_princ.html#supervision-trees">Supervision Trees</a></li>
<li title="Behaviours"><a href="des_princ.html#behaviours">Behaviours</a></li>
<li title="Applications"><a href="des_princ.html#applications">Applications</a></li>
<li title="Releases"><a href="des_princ.html#releases">Releases</a></li>
<li title="Release Handling"><a href="des_princ.html#release-handling">Release Handling</a></li>
</ul>
</li>
<li id="no" title="gen_server Behaviour" expanded="false">gen_server Behaviour<ul>
<li><a href="gen_server_concepts.html">
              Top of chapter
            </a></li>
<li title="Client-Server Principles"><a href="gen_server_concepts.html#client-server-principles">Client-Server Principles</a></li>
<li title="Example"><a href="gen_server_concepts.html#example">Example</a></li>
<li title="Starting a Gen_Server"><a href="gen_server_concepts.html#starting-a-gen_server">Starting a Gen_Server</a></li>
<li title="Synchronous Requests - Call"><a href="gen_server_concepts.html#synchronous-requests---call">Synchronous Requests - Call</a></li>
<li title="Asynchronous Requests - Cast"><a href="gen_server_concepts.html#asynchronous-requests---cast">Asynchronous Requests - Cast</a></li>
<li title="Stopping"><a href="gen_server_concepts.html#stopping">Stopping</a></li>
<li title="Handling Other Messages"><a href="gen_server_concepts.html#handling-other-messages">Handling Other Messages</a></li>
</ul>
</li>
<li id="no" title="gen_statem Behaviour" expanded="false">gen_statem Behaviour<ul>
<li><a href="statem.html">
              Top of chapter
            </a></li>
<li title="Event-Driven State Machines"><a href="statem.html#event-driven-state-machines">Event-Driven State Machines</a></li>
<li title="When to use gen_statem"><a href="statem.html#when-to-use-gen_statem">When to use gen_statem</a></li>
<li title="Callback Module"><a href="statem.html#callback-module">Callback Module</a></li>
<li title="Callback Modes"><a href="statem.html#callback-modes">Callback Modes</a></li>
<li title="State Callback"><a href="statem.html#state-callback">State Callback</a></li>
<li title="Transition Actions"><a href="statem.html#transition-actions">Transition Actions</a></li>
<li title="Event Types and Event Content"><a href="statem.html#event-types-and-event-content">Event Types and Event Content</a></li>
<li title="State Enter Calls"><a href="statem.html#state-enter-calls">State Enter Calls</a></li>
<li title="Time-Outs"><a href="statem.html#time-outs">Time-Outs</a></li>
<li title="Example"><a href="statem.html#example">Example</a></li>
<li title="Starting gen_statem"><a href="statem.html#starting-gen_statem">Starting gen_statem</a></li>
<li title="Handling Events"><a href="statem.html#handling-events">Handling Events</a></li>
<li title="State Time-Outs"><a href="statem.html#state-time-outs">State Time-Outs</a></li>
<li title="All State Events"><a href="statem.html#all-state-events">All State Events</a></li>
<li title="One State Callback"><a href="statem.html#one-state-callback">One State Callback</a></li>
<li title="Stopping"><a href="statem.html#stopping">Stopping</a></li>
<li title="Event Time-Outs"><a href="statem.html#event-time-outs">Event Time-Outs</a></li>
<li title="Generic Time-Outs"><a href="statem.html#generic-time-outs">Generic Time-Outs</a></li>
<li title="Erlang Timers"><a href="statem.html#erlang-timers">Erlang Timers</a></li>
<li title="Postponing Events"><a href="statem.html#postponing-events">Postponing Events</a></li>
<li title="State Enter Actions"><a href="statem.html#state-enter-actions">State Enter Actions</a></li>
<li title="Inserted Events"><a href="statem.html#inserted-events">Inserted Events</a></li>
<li title="Example Revisited"><a href="statem.html#example-revisited">Example Revisited</a></li>
<li title="Filter the State"><a href="statem.html#filter-the-state">Filter the State</a></li>
<li title="Complex State"><a href="statem.html#complex-state">Complex State</a></li>
<li title="Hibernation"><a href="statem.html#hibernation">Hibernation</a></li>
</ul>
</li>
<li id="no" title="gen_event Behaviour" expanded="false">gen_event Behaviour<ul>
<li><a href="events.html">
              Top of chapter
            </a></li>
<li title="Event Handling Principles"><a href="events.html#event-handling-principles">Event Handling Principles</a></li>
<li title="Example"><a href="events.html#example">Example</a></li>
<li title="Starting an Event Manager"><a href="events.html#starting-an-event-manager">Starting an Event Manager</a></li>
<li title="Adding an Event Handler"><a href="events.html#adding-an-event-handler">Adding an Event Handler</a></li>
<li title="Notifying about Events"><a href="events.html#notifying-about-events">Notifying about Events</a></li>
<li title="Deleting an Event Handler"><a href="events.html#deleting-an-event-handler">Deleting an Event Handler</a></li>
<li title="Stopping"><a href="events.html#stopping">Stopping</a></li>
<li title="Handling Other Messages"><a href="events.html#handling-other-messages">Handling Other Messages</a></li>
</ul>
</li>
<li id="loadscrollpos" title="Supervisor Behaviour" expanded="true">Supervisor Behaviour<ul>
<li><a href="sup_princ.html">
              Top of chapter
            </a></li>
<li title="Supervision Principles"><a href="sup_princ.html#supervision-principles">Supervision Principles</a></li>
<li title="Example"><a href="sup_princ.html#example">Example</a></li>
<li title="Supervisor Flags"><a href="sup_princ.html#supervisor-flags">Supervisor Flags</a></li>
<li title="Restart Strategy"><a href="sup_princ.html#restart-strategy">Restart Strategy</a></li>
<li title="Maximum Restart Intensity"><a href="sup_princ.html#maximum-restart-intensity">Maximum Restart Intensity</a></li>
<li title="Automatic Shutdown"><a href="sup_princ.html#automatic-shutdown">Automatic Shutdown</a></li>
<li title="Child Specification"><a href="sup_princ.html#child-specification">Child Specification</a></li>
<li title="Starting a Supervisor"><a href="sup_princ.html#starting-a-supervisor">Starting a Supervisor</a></li>
<li title="Adding a Child Process"><a href="sup_princ.html#adding-a-child-process">Adding a Child Process</a></li>
<li title="Stopping a Child Process"><a href="sup_princ.html#stopping-a-child-process">Stopping a Child Process</a></li>
<li title="Simplified one_for_one Supervisors"><a href="sup_princ.html#simplified-one_for_one-supervisors">Simplified one_for_one Supervisors</a></li>
<li title="Stopping"><a href="sup_princ.html#stopping">Stopping</a></li>
</ul>
</li>
<li id="no" title="sys and proc_lib" expanded="false">sys and proc_lib<ul>
<li><a href="spec_proc.html">
              Top of chapter
            </a></li>
<li title="Simple Debugging"><a href="spec_proc.html#simple-debugging">Simple Debugging</a></li>
<li title="Special Processes"><a href="spec_proc.html#special-processes">Special Processes</a></li>
<li title="User-Defined Behaviours"><a href="spec_proc.html#user-defined-behaviours">User-Defined Behaviours</a></li>
</ul>
</li>
<li id="no" title="Applications" expanded="false">Applications<ul>
<li><a href="applications.html">
              Top of chapter
            </a></li>
<li title="Application Concept"><a href="applications.html#application-concept">Application Concept</a></li>
<li title="Application Callback Module"><a href="applications.html#application-callback-module">Application Callback Module</a></li>
<li title="Application Resource File"><a href="applications.html#application-resource-file">Application Resource File</a></li>
<li title="Directory Structure"><a href="applications.html#directory-structure">Directory Structure</a></li>
<li title="Application Controller"><a href="applications.html#application-controller">Application Controller</a></li>
<li title="Loading and Unloading Applications"><a href="applications.html#loading-and-unloading-applications">Loading and Unloading Applications</a></li>
<li title="Starting and Stopping Applications"><a href="applications.html#starting-and-stopping-applications">Starting and Stopping Applications</a></li>
<li title="Configuring an Application"><a href="applications.html#configuring-an-application">Configuring an Application</a></li>
<li title="Application Start Types"><a href="applications.html#application-start-types">Application Start Types</a></li>
</ul>
</li>
<li id="no" title="Included Applications" expanded="false">Included Applications<ul>
<li><a href="included_applications.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="included_applications.html#introduction">Introduction</a></li>
<li title="Specifying Included Applications"><a href="included_applications.html#specifying-included-applications">Specifying Included Applications</a></li>
<li title="Synchronizing Processes during Startup"><a href="included_applications.html#synchronizing-processes-during-startup">Synchronizing Processes during Startup</a></li>
</ul>
</li>
<li id="no" title="Distributed Applications" expanded="false">Distributed Applications<ul>
<li><a href="distributed_applications.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="distributed_applications.html#introduction">Introduction</a></li>
<li title="Specifying Distributed Applications"><a href="distributed_applications.html#specifying-distributed-applications">Specifying Distributed Applications</a></li>
<li title="Starting and Stopping Distributed Applications"><a href="distributed_applications.html#starting-and-stopping-distributed-applications">Starting and Stopping Distributed Applications</a></li>
<li title="Failover"><a href="distributed_applications.html#failover">Failover</a></li>
<li title="Takeover"><a href="distributed_applications.html#takeover">Takeover</a></li>
</ul>
</li>
<li id="no" title="Releases" expanded="false">Releases<ul>
<li><a href="release_structure.html">
              Top of chapter
            </a></li>
<li title="Release Concept"><a href="release_structure.html#release-concept">Release Concept</a></li>
<li title="Release Resource File"><a href="release_structure.html#release-resource-file">Release Resource File</a></li>
<li title="Generating Boot Scripts"><a href="release_structure.html#generating-boot-scripts">Generating Boot Scripts</a></li>
<li title="Creating a Release Package"><a href="release_structure.html#creating-a-release-package">Creating a Release Package</a></li>
<li title="Directory Structure"><a href="release_structure.html#directory-structure">Directory Structure</a></li>
</ul>
</li>
<li id="no" title="Release Handling" expanded="false">Release Handling<ul>
<li><a href="release_handling.html">
              Top of chapter
            </a></li>
<li title="Release Handling Principles"><a href="release_handling.html#release-handling-principles">Release Handling Principles</a></li>
<li title="Requirements"><a href="release_handling.html#requirements">Requirements</a></li>
<li title="Distributed Systems"><a href="release_handling.html#distributed-systems">Distributed Systems</a></li>
<li title="Release Handling Instructions"><a href="release_handling.html#release-handling-instructions">Release Handling Instructions</a></li>
<li title="Application Upgrade File"><a href="release_handling.html#application-upgrade-file">Application Upgrade File</a></li>
<li title="Release Upgrade File"><a href="release_handling.html#release-upgrade-file">Release Upgrade File</a></li>
<li title="Installing a Release"><a href="release_handling.html#installing-a-release">Installing a Release</a></li>
<li title="Updating Application Specifications"><a href="release_handling.html#updating-application-specifications">Updating Application Specifications</a></li>
</ul>
</li>
<li id="no" title="Appup Cookbook" expanded="false">Appup Cookbook<ul>
<li><a href="appup_cookbook.html">
              Top of chapter
            </a></li>
<li title="Changing a Functional Module"><a href="appup_cookbook.html#changing-a-functional-module">Changing a Functional Module</a></li>
<li title="Changing a Residence Module"><a href="appup_cookbook.html#changing-a-residence-module">Changing a Residence Module</a></li>
<li title="Changing a Callback Module"><a href="appup_cookbook.html#changing-a-callback-module">Changing a Callback Module</a></li>
<li title="Changing Internal State"><a href="appup_cookbook.html#changing-internal-state">Changing Internal State</a></li>
<li title="Module Dependencies"><a href="appup_cookbook.html#module-dependencies">Module Dependencies</a></li>
<li title="Changing Code for a Special Process"><a href="appup_cookbook.html#changing-code-for-a-special-process">Changing Code for a Special Process</a></li>
<li title="Changing a Supervisor"><a href="appup_cookbook.html#changing-a-supervisor">Changing a Supervisor</a></li>
<li title="Adding or Deleting a Module"><a href="appup_cookbook.html#adding-or-deleting-a-module">Adding or Deleting a Module</a></li>
<li title="Starting or Terminating a Process"><a href="appup_cookbook.html#starting-or-terminating-a-process">Starting or Terminating a Process</a></li>
<li title="Adding or Removing an Application"><a href="appup_cookbook.html#adding-or-removing-an-application">Adding or Removing an Application</a></li>
<li title="Restarting an Application"><a href="appup_cookbook.html#restarting-an-application">Restarting an Application</a></li>
<li title="Changing an Application Specification"><a href="appup_cookbook.html#changing-an-application-specification">Changing an Application Specification</a></li>
<li title="Changing Application Configuration"><a href="appup_cookbook.html#changing-application-configuration">Changing Application Configuration</a></li>
<li title="Changing Included Applications"><a href="appup_cookbook.html#changing-included-applications">Changing Included Applications</a></li>
<li title="Changing Non-Erlang Code"><a href="appup_cookbook.html#changing-non-erlang-code">Changing Non-Erlang Code</a></li>
<li title="Emulator Restart and Upgrade"><a href="appup_cookbook.html#emulator-restart-and-upgrade">Emulator Restart and Upgrade</a></li>
<li title="Emulator Upgrade From Pre OTP R15"><a href="appup_cookbook.html#emulator-upgrade-from-pre-otp-r15">Emulator Upgrade From Pre OTP R15</a></li>
</ul>
</li>
</ul></nav></aside><div id="content">
<div class="innertube">
<h1 id="Supervisor Behaviour">5 Supervisor Behaviour</h1>
  
  <p>This section should be read with the
    <span class="bold_code bc-18"><a href="../man/supervisor.html">supervisor(3)</a></span> manual page
    in STDLIB, where all details about the supervisor
    behaviour is given.</p>

  <h3 id="supervision-principles" class="title-link" onMouseOver="document.getElementById('ghlink-supervision-principles-idm1555').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-supervision-principles-idm1555').style.visibility = 'hidden';">
<div class="title-name">5.1 
        Supervision Principles</div>
<div class="title-anchors"><span id="ghlink-supervision-principles-idm1555" class="ghlink-after"><a href="#supervision-principles" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L37" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>A supervisor is responsible for starting, stopping, and
      monitoring its child processes. The basic idea of a supervisor is
      that it is to keep its child processes alive by restarting them
      when necessary.</p>
    <p>Which child processes to start and monitor is specified by a
      list of <span class="bold_code bc-17"><a href="#spec">child specifications</a></span>.
      The child processes are started in the order specified by this
      list, and terminated in the reversed order.</p>
  

  <h3 id="example" class="title-link" onMouseOver="document.getElementById('ghlink-example-idm1560').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-example-idm1560').style.visibility = 'hidden';">
<div class="title-name">5.2 
        Example</div>
<div class="title-anchors"><span id="ghlink-example-idm1560" class="ghlink-after"><a href="#example" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L49" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>The callback module for a supervisor starting the server from
    <span class="bold_code bc-15"><a href="gen_server_concepts.html#ex">gen_server Behaviour</a></span>
    can look as follows:</p>
    <a name="ex"></a>
    <div class="example example-none"><pre>-module(ch_sup).
-behaviour(supervisor).

-export([start_link/0]).
-export([init/1]).

start_link() -&gt;
    supervisor:start_link(ch_sup, []).

init(_Args) -&gt;
    SupFlags = #{strategy =&gt; one_for_one, intensity =&gt; 1, period =&gt; 5},
    ChildSpecs = [#{id =&gt; ch3,
                    start =&gt; {ch3, start_link, []},
                    restart =&gt; permanent,
                    shutdown =&gt; brutal_kill,
                    type =&gt; worker,
                    modules =&gt; [cg3]}],
    {ok, {SupFlags, ChildSpecs}}.</pre></div>
    <p>The <span class="code">SupFlags</span> variable in the return value
      from <span class="code">init/1</span> represents
      the <span class="bold_code bc-17"><a href="#flags">supervisor flags</a></span>.</p>
    <p>The <span class="code">ChildSpecs</span> variable in the return value
      from <span class="code">init/1</span> is a list of <span class="bold_code bc-17"><a href="#spec">child
      specifications</a></span>.</p>
  

  <a name="flags"></a><h3 id="supervisor-flags" class="title-link" onMouseOver="document.getElementById('ghlink-supervisor-flags-idm1574').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-supervisor-flags-idm1574').style.visibility = 'hidden';">
<div class="title-name">5.3 
        Supervisor Flags</div>
<div class="title-anchors"><span id="ghlink-supervisor-flags-idm1574" class="ghlink-after"><a href="#supervisor-flags" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L82" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    
    <p>This is the type definition for the supervisor flags:</p>
    <div class="example example-none"><pre>sup_flags() = #{strategy =&gt; strategy(),           % optional
                intensity =&gt; non_neg_integer(),   % optional
                period =&gt; pos_integer(),          % optional
                auto_shutdown =&gt; auto_shutdown()} % optional
    strategy() = one_for_all
               | one_for_one
               | rest_for_one
               | simple_one_for_one
    auto_shutdown() = never
                    | any_significant
                    | all_significant</pre></div>
    <ul>
      <li>
	<p><span class="code">strategy</span> specifies
	  the <span class="bold_code bc-17"><a href="#strategy">restart
	  strategy</a></span>.</p>
      </li>
      <li>
	<p><span class="code">intensity</span> and <span class="code">period</span> specify
	  the <span class="bold_code bc-17"><a href="#max_intensity">maximum restart
	  intensity</a></span>.</p>
      </li>
      <li>
        <p><span class="code">auto_shutdown</span> specifies if and when a supervisor should
          <span class="bold_code bc-17"><a href="#automatic-shutdown">automatically shut itself
          down</a></span>.</p>
      </li>
    </ul>
  

  <a name="strategy"></a><h3 id="restart-strategy" class="title-link" onMouseOver="document.getElementById('ghlink-restart-strategy-idm1593').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-restart-strategy-idm1593').style.visibility = 'hidden';">
<div class="title-name">5.4 
        Restart Strategy</div>
<div class="title-anchors"><span id="ghlink-restart-strategy-idm1593" class="ghlink-after"><a href="#restart-strategy" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L117" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    
    <p> The restart strategy is specified by
      the <span class="code">strategy</span> key in the supervisor flags map returned by
      the callback function <span class="code">init</span>:</p>
    <div class="example example-none"><pre>SupFlags = #{strategy =&gt; Strategy, ...}</pre></div>
    <p>The <span class="code">strategy</span> key is optional in this map. If it is not
      given, it defaults to <span class="code">one_for_one</span>.</p>

    <div class="note">
<div class="label">Note</div>
<div class="content"><p>
      <p>For simplicity, the diagrams shown in this section display a
        setup where all the depicted children are assumed to have
        a <span class="bold_code bc-17"><a href="#restart">restart type</a></span> of
        <span class="code">permanent</span>.</p>
    </p></div>
</div>

    <h4 id="one_for_one" class="title-link" onMouseOver="document.getElementById('ghlink-one_for_one-idm1607').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-one_for_one-idm1607').style.visibility = 'hidden';">
<div class="title-name">one_for_one</div>
<div class="title-anchors"><span id="ghlink-one_for_one-idm1607" class="ghlink-after"><a href="#one_for_one" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L135" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>If a child process terminates, only that process is restarted.</p>
      <a name="sup4"></a>
      <div class="doc-image-wrapper">
<object alt="IMAGE MISSING" data="../design_principles/sup-one_for_one.svg" class="doc-svg doc-image"></object>
        <p class="doc-image-caption">Figure
        5.1:
         
        One_For_One Supervision</p>
      </div>
    

    <h4 id="one_for_all" class="title-link" onMouseOver="document.getElementById('ghlink-one_for_all-idm1613').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-one_for_all-idm1613').style.visibility = 'hidden';">
<div class="title-name">one_for_all</div>
<div class="title-anchors"><span id="ghlink-one_for_all-idm1613" class="ghlink-after"><a href="#one_for_all" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L144" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>If a child process terminates, all other child processes are
        terminated, and then all child processes, including
        the terminated one, are restarted.</p>
      <a name="sup5"></a>
      <div class="doc-image-wrapper">
<object alt="IMAGE MISSING" data="../design_principles/sup-one_for_all.svg" class="doc-svg doc-image"></object>
        <p class="doc-image-caption">Figure
        5.2:
         
        One_For_All Supervision</p>
      </div>
    

    <h4 id="rest_for_one" class="title-link" onMouseOver="document.getElementById('ghlink-rest_for_one-idm1619').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-rest_for_one-idm1619').style.visibility = 'hidden';">
<div class="title-name">rest_for_one</div>
<div class="title-anchors"><span id="ghlink-rest_for_one-idm1619" class="ghlink-after"><a href="#rest_for_one" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L155" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>If a child process terminates, the rest of the child
        processes (that is, the child processes after the terminated
        process in start order) are terminated. Then the terminated
        child process and the rest of the child processes are restarted.</p>
      <a name="sup6"></a>
      <div class="doc-image-wrapper">
<object alt="IMAGE MISSING" data="../design_principles/sup-rest_for_one.svg" class="doc-svg doc-image"></object>
        <p class="doc-image-caption">Figure
        5.3:
         
        Rest_For_One Supervision</p>
      </div>
    

     <h4 id="simple_one_for_one" class="title-link" onMouseOver="document.getElementById('ghlink-simple_one_for_one-idm1625').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-simple_one_for_one-idm1625').style.visibility = 'hidden';">
<div class="title-name">simple_one_for_one</div>
<div class="title-anchors"><span id="ghlink-simple_one_for_one-idm1625" class="ghlink-after"><a href="#simple_one_for_one" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L167" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>See <span class="bold_code bc-17"><a href="#simple">simple-one-for-one
	  supervisors</a></span>.</p>
    
  

  <a name="max_intensity"></a><h3 id="maximum-restart-intensity" class="title-link" onMouseOver="document.getElementById('ghlink-maximum-restart-intensity-idm1629').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-maximum-restart-intensity-idm1629').style.visibility = 'hidden';">
<div class="title-name">5.5 
        Maximum Restart Intensity</div>
<div class="title-anchors"><span id="ghlink-maximum-restart-intensity-idm1629" class="ghlink-after"><a href="#maximum-restart-intensity" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L174" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    
    <p>The supervisors have a built-in mechanism to limit the number of
      restarts which can occur in a given time interval. This is
      specified by the two keys <span class="code">intensity</span> and
      <span class="code">period</span> in the supervisor flags map returned by the
      callback function <span class="code">init</span>:</p>
    <div class="example example-none"><pre>SupFlags = #{intensity =&gt; MaxR, period =&gt; MaxT, ...}</pre></div>
    <p>If more than <span class="code">MaxR</span> number of restarts occur in the last
      <span class="code">MaxT</span> seconds, the supervisor terminates all the child
      processes and then itself.
      The termination reason for the supervisor itself in that case will be
      <span class="code">shutdown</span>.</p>
    <p>When the supervisor terminates, then the next higher-level
      supervisor takes some action. It either restarts the terminated
      supervisor or terminates itself.</p>
    <p>The intention of the restart mechanism is to prevent a situation
      where a process repeatedly dies for the same reason, only to be
      restarted again.</p>
    <p>The keys <span class="code">intensity</span> and <span class="code">period</span> are optional in the
      supervisor flags map. If they are not given, they default
      to <span class="code">1</span> and <span class="code">5</span>, respectively.</p>
    <h4 id="tuning-the-intensity-and-period" class="title-link" onMouseOver="document.getElementById('ghlink-tuning-the-intensity-and-period-idm1648').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-tuning-the-intensity-and-period-idm1648').style.visibility = 'hidden';">
<div class="title-name">Tuning the intensity and period</div>
<div class="title-anchors"><span id="ghlink-tuning-the-intensity-and-period-idm1648" class="ghlink-after"><a href="#tuning-the-intensity-and-period" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L198" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>The default values are 1 restart per 5 seconds. This was chosen to
        be safe for most systems, even with deep supervision hierarchies,
        but you will probably want to tune the settings for your particular
        use case.</p>
      <p>First, the intensity decides how big bursts of restarts you want
        to tolerate. For example, you might want to accept a burst of at
        most 5 or 10 attempts, even within the same second, if it results
        in a successful restart.</p>
      <p>Second, you need to consider the sustained failure rate, if
        crashes keep happening but not often enough to make the supervisor
        give up. If you set intensity to 10 and set the period as low as 1,
        the supervisor will allow child processes to keep restarting up to
        10 times per second, forever, filling your logs with crash reports
        until someone intervenes manually.</p>
      <p>You should therefore set the period to be long enough that you can
        accept that the supervisor keeps going at that rate. For example,
        if you have picked an intensity value of 5, then setting the period
        to 30 seconds will give you at most one restart per 6 seconds for
        any longer period of time, which means that your logs won't fill up
        too quickly, and you will have a chance to observe the failures and
        apply a fix.</p>
      <p>These choices depend a lot on your problem domain. If you don't
        have real time monitoring and ability to fix problems quickly, for
        example in an embedded system, you might want to accept at most
        one restart per minute before the supervisor should give up and
        escalate to the next level to try to clear the error automatically.
        On the other hand, if it is more important that you keep trying
        even at a high failure rate, you might want a sustained rate of as
        much as 1-2 restarts per second.</p>
      <p>Avoiding common mistakes:</p>
      <ul>
        <li>
          <p>Do not forget to consider the burst rate. If you set intensity
            to 1 and period to 6, it gives the same sustained error rate as
            5/30 or 10/60, but will not allow even 2 restart attempts in
            quick succession. This is probably not what you wanted.</p>
        </li>
        <li>
          <p>Do not set the period to a very high value if you want to
            tolerate bursts. If you set intensity to 5 and period to 3600
            (one hour), the supervisor will allow a short burst of 5
            restarts, but then gives up if it sees another single restart
            almost an hour later. You probably want to regard those crashes
            as separate incidents, so setting the period to 5 or 10 minutes
            will be more reasonable.</p>
        </li>
        <li>
          <p>If your application has multiple levels of supervision, then
            do not simply set the restart intensities to the same values on
            all levels. Keep in mind that the total number of restarts
            (before the top level supervisor gives up and terminates the
            application) will be the product of the intensity values of all
            the supervisors above the failing child process.</p>
          <p>For example, if the top level allows 10 restarts, and the next
            level also allows 10, a crashing child below that level will be
            restarted 100 times, which is probably excessive. Allowing at
            most 3 restarts for the top level supervisor might be a better
            choice in this case.</p>
        </li>
      </ul>
    
  

  <h3 id="automatic-shutdown" class="title-link" onMouseOver="document.getElementById('ghlink-automatic-shutdown-idm1664').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-automatic-shutdown-idm1664').style.visibility = 'hidden';">
<div class="title-name">5.6 
        Automatic Shutdown</div>
<div class="title-anchors"><span id="ghlink-automatic-shutdown-idm1664" class="ghlink-after"><a href="#automatic-shutdown" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L263" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>A supervisor can be configured to automatically shut itself down when
      <span class="bold_code bc-17"><a href="#significant_child">significant children</a></span>
      terminate.</p>
    <p>This is useful when a supervisor represents a work unit
      of cooperating children, as opposed to independent workers. When
      the work unit has finished its work, that is, when any or all
      significant child processes have terminated, the supervisor
      should then shut down by terminating all remaining child
      processes in reverse start order according to the respective shutdown
      specifications, and then itself.</p>
    <p>Automatic shutdown is specified by the <span class="code">auto_shutdown</span> key in the
      supervisor flags map returned by the callback function <span class="code">init</span>:</p>
    <div class="example example-none"><pre>SupFlags = #{auto_shutdown =&gt; AutoShutdown, ...}</pre></div>
    <p>The <span class="code">auto_shutdown</span> key is optional in this map. If it is not
      given, it defaults to <span class="code">never</span>.</p>
    <div class="note">
<div class="label">Note</div>
<div class="content"><p>
      <p>The automatic shutdown facility only applies when significant children
        terminate by themselves, that is, when their termination was not
        caused by means of the supervisor. Specifically, neither the
        termination of a child as a consequence of a sibling's death in the
        <span class="code">one_for_all</span> or <span class="code">rest_for_one</span> strategies nor the manual
        termination of a child by means of <span class="code">supervisor:terminate_child/2</span>
        will trigger an automatic shutdown.</p>
    </p></div>
</div>

    <h4 id="never" class="title-link" onMouseOver="document.getElementById('ghlink-never-idm1681').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-never-idm1681').style.visibility = 'hidden';">
<div class="title-name">never</div>
<div class="title-anchors"><span id="ghlink-never-idm1681" class="ghlink-after"><a href="#never" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L291" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>Automatic shutdown is disabled.</p>
      <p>In this mode, significant children are not accepted. If the
        child specs returned from <span class="code">init</span> contains significant
        children, the supervisor will refuse to start. Attempts to
        start significant children dynamically will be rejected.</p>
      <p>This is the default setting.</p>
    

    <h4 id="any_significant" class="title-link" onMouseOver="document.getElementById('ghlink-any_significant-idm1687').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-any_significant-idm1687').style.visibility = 'hidden';">
<div class="title-name">any_significant</div>
<div class="title-anchors"><span id="ghlink-any_significant-idm1687" class="ghlink-after"><a href="#any_significant" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L301" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>The supervisor will automatically shut itself down when
        <strong>any</strong> significant child terminates, that is, when a
        transient significant child terminates normally or when a
        temporary significant child terminates normally or
        abnormally.</p>
    

    <h4 id="all_significant" class="title-link" onMouseOver="document.getElementById('ghlink-all_significant-idm1691').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-all_significant-idm1691').style.visibility = 'hidden';">
<div class="title-name">all_significant</div>
<div class="title-anchors"><span id="ghlink-all_significant-idm1691" class="ghlink-after"><a href="#all_significant" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L310" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>The supervisor will automatically shut itself down when
        <strong>all</strong> significant children have terminated, that is,
        when the <strong>last active</strong> significant child terminates.
        The same rules as for <span class="code">any_significant</span> apply.</p>
    

    <div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
      <p>The automatic shutdown feature appeared in OTP 24.0, but
        applications using this feature will also compile and
        run with older OTP versions.</p>
      <p>However, such applications, when compiled with an OTP version
        that predates the appearance of the automatic shutdown feature,
        will leak processes because the automatic shutdowns they rely
        on will not happen.</p>
      <p>It is up to implementors to take proper precautions if they
        expect that their applications may be compiled with older OTP
        versions.</p>
    </p></div>
</div>

    <div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
      <p>Top supervisors of <span class="bold_code bc-19"><a href="applications.html">Applications</a></span>
        should not be configured for automatic shutdown, because when the top
        supervisor exits, the application terminates. If the application is
        <span class="code">permanent</span>, all other applications and the runtime system
        are terminated, also.</p>
    </p></div>
</div>

    <div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
      <p>Supervisors configured for automatic shutdown should not be
        made <span class="bold_code bc-17"><a href="#restart">permanent</a></span> children
        of their respective parent supervisors, as they would be restarted
        immediately after having automatically shut down, only to shut down
        automatically again after a while, and may thus exhaust the
        <span class="bold_code bc-17"><a href="#max_intensity">Maximum Restart Intensity</a></span>
        of the parent supervisor.</p>
    </p></div>
</div>
  

  <a name="spec"></a><h3 id="child-specification" class="title-link" onMouseOver="document.getElementById('ghlink-child-specification-idm1709').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-child-specification-idm1709').style.visibility = 'hidden';">
<div class="title-name">5.7 
        Child Specification</div>
<div class="title-anchors"><span id="ghlink-child-specification-idm1709" class="ghlink-after"><a href="#child-specification" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L350" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    
    <p>The type definition for a child specification is as follows:</p>
    <div class="example example-none"><pre>child_spec() = #{id =&gt; child_id(),             % mandatory
                 start =&gt; mfargs(),            % mandatory
                 restart =&gt; restart(),         % optional
                 significant =&gt; significant(), % optional
                 shutdown =&gt; shutdown(),       % optional
                 type =&gt; worker(),             % optional
                 modules =&gt; modules()}         % optional
    child_id() = term()
    mfargs() = {M :: module(), F :: atom(), A :: [term()]}
    modules() = [module()] | dynamic
    restart() = permanent | transient | temporary
    significant() = boolean()
    shutdown() = brutal_kill | timeout()
    worker() = worker | supervisor</pre></div>
    <ul>
      <li>
        <p><span class="code">id</span> is used to identify the child
          specification internally by the supervisor.</p>
	<p>The <span class="code">id</span> key is mandatory.</p>
	<p>Note that this identifier occasionally has been called
	  "name". As far as possible, the terms "identifier" or "id"
	  are now used but in order to keep backwards compatibility,
	  some occurences of "name" can still be found, for example
	  in error messages.</p>
      </li>
      <li>
        <p><span class="code">start</span> defines the function call used to start
          the child process. It is a module-function-arguments tuple
          used as <span class="code">apply(M, F, A)</span>.</p>
        <p>It is to be (or result in) a call to any of the following:</p>
	<ul>
	  <li><span class="code">supervisor:start_link</span></li>
	  <li><span class="code">gen_server:start_link</span></li>
	  <li><span class="code">gen_statem:start_link</span></li>
	  <li><span class="code">gen_event:start_link</span></li>
	  <li>A function compliant with these functions. For details,
	  see the <span class="code">supervisor(3)</span> manual page.</li>
	</ul>
	<p>The <span class="code">start</span> key is mandatory.</p>
      </li>
      <li>
        <a name="restart"></a>
        <p><span class="code">restart</span> defines when a terminated child process is to
          be restarted.</p>
        <ul>
          <li>A <span class="code">permanent</span> child process is always restarted.</li>
          <li>A <span class="code">temporary</span> child process is never restarted
          (not even when the supervisor restart strategy
          is <span class="code">rest_for_one</span> or <span class="code">one_for_all</span> and a sibling
          death causes the temporary process to be terminated).</li>
          <li>A <span class="code">transient</span> child process is restarted only if it
	  terminates abnormally, that is, with an exit reason other than
          <span class="code">normal</span>, <span class="code">shutdown</span>, or <span class="code">{shutdown,Term}</span>.</li>
        </ul>
	<p>The <span class="code">restart</span> key is optional. If it is not given, the
	  default value <span class="code">permanent</span> will be used.</p>
      </li>
      <li>
        <a name="significant_child"></a>
        <p><span class="code">significant</span> defines if a child is considered significant
          for <span class="bold_code bc-17"><a href="#automatic-shutdown">automatic
          self-shutdown</a></span> of the supervisor.</p>
        <p>It is invalid to set this option to <span class="code">true</span> for a child
          with <span class="bold_code bc-17"><a href="#restart">restart type</a></span>
          <span class="code">permanent</span> or in a supervisor with
          <span class="bold_code bc-17"><a href="#automatic-shutdown">auto_shutdown</a></span>
          set to <span class="code">never</span>.</p>
      </li>
      <li>
        <a name="shutdown"></a>
        <p><span class="code">shutdown</span> defines how a child process is to be
          terminated.</p>
        <ul>
          <li>
<span class="code">brutal_kill</span> means that the child process is
           unconditionally terminated using <span class="code">exit(Child, kill)</span>.</li>
          <li>An integer time-out value means that the supervisor tells
           the child process to terminate by calling
          <span class="code">exit(Child, shutdown)</span> and then waits for an exit
           signal back. If no exit signal is received within
           the specified time, the child process is unconditionally
           terminated using <span class="code">exit(Child, kill)</span>.</li>
          <li>If the child process is another supervisor, it must be
           set to <span class="code">infinity</span> to give the subtree enough time to
           shut down. It is also allowed to set it to <span class="code">infinity</span>,
           if the child process is a worker. See the warning below:</li>
        </ul>
        <div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
	  <p>Setting the shutdown time to anything other
	    than <span class="code">infinity</span> for a child of type <span class="code">supervisor</span>
	    can cause a race condition where the child in question
	    unlinks its own children, but fails to terminate them
	    before it is killed.</p>
          <p>Be careful when setting the shutdown time to
          <span class="code">infinity</span> when the child process is a worker. Because, in this
          situation, the termination of the supervision tree depends on the
          child process; it must be implemented in a safe way and its cleanup
          procedure must always return.</p>
        </p></div>
</div>
	<p>The <span class="code">shutdown</span> key is optional. If it is not given,
	  and the child is of type <span class="code">worker</span>, the default value
	  <span class="code">5000</span> will be used; if the child is of type
	  <span class="code">supervisor</span>, the default value <span class="code">infinity</span> will be
	  used.</p>
      </li>
      <li>
        <p><span class="code">type</span> specifies if the child process is a supervisor or
          a worker.</p>
	<p>The <span class="code">type</span> key is optional. If it is not given, the
	  default value <span class="code">worker</span> will be used.</p>
      </li>
      <li>
        <p><span class="code">modules</span> are to be a list with one element
          <span class="code">[Module]</span>, where <span class="code">Module</span> is the name of
          the callback module, if the child process is a supervisor,
          gen_server, gen_statem.
	  If the child process is a gen_event,
          the value shall be <span class="code">dynamic</span>.</p>
        <p>This information is used by the release handler during
          upgrades and downgrades, see
          <span class="bold_code bc-19"><a href="release_handling.html">Release Handling</a></span>.</p>
	<p>The <span class="code">modules</span> key is optional. If it is not given, it
	  defaults to <span class="code">[M]</span>, where <span class="code">M</span> comes from the
	  child's start <span class="code">{M,F,A}</span>.</p>
      </li>
    </ul>
    <p><strong>Example:</strong> The child specification to start the server
    <span class="code">ch3</span> in the previous example look as follows:</p>
    <div class="example example-none"><pre>#{id =&gt; ch3,
  start =&gt; {ch3, start_link, []},
  restart =&gt; permanent,
  shutdown =&gt; brutal_kill,
  type =&gt; worker,
  modules =&gt; [ch3]}</pre></div>
    <p>or simplified, relying on the default values:</p>
    <div class="example example-none"><pre>#{id =&gt; ch3,
  start =&gt; {ch3, start_link, []}
  shutdown =&gt; brutal_kill}</pre></div>
    <p>Example: A child specification to start the event manager from
      the chapter about
      <span class="bold_code bc-15"><a href="events.html#mgr">gen_event</a></span>:</p>
    <div class="example example-none"><pre>#{id =&gt; error_man,
  start =&gt; {gen_event, start_link, [{local, error_man}]},
  modules =&gt; dynamic}</pre></div>
    <p>Both server and event manager are registered processes which
      can be expected to be always accessible. Thus they are
      specified to be <span class="code">permanent</span>.</p>
    <p><span class="code">ch3</span> does not need to do any cleaning up before
      termination. Thus, no shutdown time is needed, but
      <span class="code">brutal_kill</span> is sufficient. <span class="code">error_man</span> can
      need some time for the event handlers to clean up, thus
      the shutdown time is set to 5000 ms (which is the default
      value).</p>
    <p>Example: A child specification to start another supervisor:</p>
    <div class="example example-none"><pre>#{id =&gt; sup,
  start =&gt; {sup, start_link, []},
  restart =&gt; transient,
  type =&gt; supervisor} % will cause default shutdown=&gt;infinity</pre></div>
  

  <a name="super_tree"></a><h3 id="starting-a-supervisor" class="title-link" onMouseOver="document.getElementById('ghlink-starting-a-supervisor-idm1831').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-starting-a-supervisor-idm1831').style.visibility = 'hidden';">
<div class="title-name">5.8 
        Starting a Supervisor</div>
<div class="title-anchors"><span id="ghlink-starting-a-supervisor-idm1831" class="ghlink-after"><a href="#starting-a-supervisor" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L518" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    
    <p>In the previous example, the supervisor is started by calling
      <span class="code">ch_sup:start_link()</span>:</p>
    <div class="example example-none"><pre>start_link() -&gt;
    supervisor:start_link(ch_sup, []).</pre></div>
    <p><span class="code">ch_sup:start_link</span> calls function
    <span class="code">supervisor:start_link/2</span>, which spawns and links to a new
    process, a supervisor.</p>
    <ul>
      <li>The first argument, <span class="code">ch_sup</span>, is the name of
       the callback module, that is, the module where the <span class="code">init</span>
       callback function is located.</li>
      <li>The second argument, <span class="code">[]</span>, is a term that is passed
       as is to
       the callback function <span class="code">init</span>. Here, <span class="code">init</span> does not
       need any indata and ignores the argument.</li>
    </ul>
    <p>In this case, the supervisor is not registered. Instead its pid
      must be used. A name can be specified by calling
      <span class="code">supervisor:start_link({local, Name}, Module, Args)</span> or
      <span class="code">supervisor:start_link({global, Name}, Module, Args)</span>.</p>
    <p>The new supervisor process calls the callback function
      <span class="code">ch_sup:init([])</span>. <span class="code">init</span> shall return
      <span class="code">{ok, {SupFlags, ChildSpecs}}</span>:</p>
    <div class="example example-none"><pre>init(_Args) -&gt;
    SupFlags = #{},
    ChildSpecs = [#{id =&gt; ch3,
                    start =&gt; {ch3, start_link, []},
                    shutdown =&gt; brutal_kill}],
    {ok, {SupFlags, ChildSpecs}}.</pre></div>
    <p>The supervisor then starts all its child processes according to
      the child specifications in the start specification. In this case
      there is one child process, <span class="code">ch3</span>.</p>
    <p><span class="code">supervisor:start_link</span> is synchronous. It does
      not return until all child processes have been started.</p>
  

  <h3 id="adding-a-child-process" class="title-link" onMouseOver="document.getElementById('ghlink-adding-a-child-process-idm1860').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-adding-a-child-process-idm1860').style.visibility = 'hidden';">
<div class="title-name">5.9 
        Adding a Child Process</div>
<div class="title-anchors"><span id="ghlink-adding-a-child-process-idm1860" class="ghlink-after"><a href="#adding-a-child-process" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L559" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>In addition to the static supervision tree, dynamic child
    processes can be added to an existing supervisor with the following
    call:</p>
    <div class="example example-none"><pre>supervisor:start_child(Sup, ChildSpec)</pre></div>
    <p><span class="code">Sup</span> is the pid, or name, of the supervisor.
    <span class="code">ChildSpec</span> is a
    <span class="bold_code bc-17"><a href="#spec">child specification</a></span>.</p>
    <p>Child processes added using <span class="code">start_child/2</span> behave in
      the same way as the other child processes, with the an important
      exception: if a supervisor dies and is recreated, then
      all child processes that were dynamically added to the supervisor
      are lost.</p>
  

  <h3 id="stopping-a-child-process" class="title-link" onMouseOver="document.getElementById('ghlink-stopping-a-child-process-idm1870').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-stopping-a-child-process-idm1870').style.visibility = 'hidden';">
<div class="title-name">5.10 
        Stopping a Child Process</div>
<div class="title-anchors"><span id="ghlink-stopping-a-child-process-idm1870" class="ghlink-after"><a href="#stopping-a-child-process" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L576" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>Any child process, static or dynamic, can be stopped in
      accordance with the shutdown specification:</p>
    <div class="example example-none"><pre>supervisor:terminate_child(Sup, Id)</pre></div>
    <p>Stopping a <span class="bold_code bc-17"><a href="#significant_child">significant
      child</a></span> of a supervisor configured for
      <span class="bold_code bc-17"><a href="#automatic-shutdown">automatic shutdown</a></span>
      will not trigger an automatic shutdown.</p>
    <p>The child specification for a stopped child process is deleted
      with the following call:</p>
    <div class="example example-none"><pre>supervisor:delete_child(Sup, Id)</pre></div>
    <p><span class="code">Sup</span> is the pid, or name, of the supervisor.
      <span class="code">Id</span> is the value associated with the <span class="code">id</span> key in
      the <span class="bold_code bc-17"><a href="#spec">child specification</a></span>.</p>
    <p>As with dynamically added child processes, the effects of
      deleting a static child process are lost if the supervisor itself
      restarts.</p>
  

  <a name="simple"></a><h3 id="simplified-one_for_one-supervisors" class="title-link" onMouseOver="document.getElementById('ghlink-simplified-one_for_one-supervisors-idm1885').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-simplified-one_for_one-supervisors-idm1885').style.visibility = 'hidden';">
<div class="title-name">5.11 
        Simplified one_for_one Supervisors</div>
<div class="title-anchors"><span id="ghlink-simplified-one_for_one-supervisors-idm1885" class="ghlink-after"><a href="#simplified-one_for_one-supervisors" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L598" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    
    <p>A supervisor with restart strategy <span class="code">simple_one_for_one</span> is
      a simplified <span class="code">one_for_one</span> supervisor, where all child
      processes are dynamically added instances of the same process.</p>
    <p>The following is an example of a callback module for a
    <span class="code">simple_one_for_one</span> supervisor:</p>
    <div class="example example-none"><pre>-module(simple_sup).
-behaviour(supervisor).

-export([start_link/0]).
-export([init/1]).

start_link() -&gt;
    supervisor:start_link(simple_sup, []).

init(_Args) -&gt;
    SupFlags = #{strategy =&gt; simple_one_for_one,
                 intensity =&gt; 0,
                 period =&gt; 1},
    ChildSpecs = [#{id =&gt; call,
                    start =&gt; {call, start_link, []},
                    shutdown =&gt; brutal_kill}],
    {ok, {SupFlags, ChildSpecs}}.</pre></div>
    <p>When started, the supervisor does not start any child processes.
      Instead, all child processes are added dynamically by calling:</p>
    <div class="example example-none"><pre>supervisor:start_child(Sup, List)</pre></div>
    <p><span class="code">Sup</span> is the pid, or name, of the supervisor.
      <span class="code">List</span> is an arbitrary list of terms, which are added to
      the list of arguments specified in the child specification. If
      the start function is specified as <span class="code">{M, F, A}</span>,
      the child process is started by calling
      <span class="code">apply(M, F, A++List)</span>.</p>
    <p>For example, adding a child to <span class="code">simple_sup</span> above:</p>
    <div class="example example-none"><pre>supervisor:start_child(Pid, [id1])</pre></div>
    <p>The result is that the child process is started by calling
      <span class="code">apply(call, start_link, []++[id1])</span>, or actually:</p>
    <div class="example example-none"><pre>call:start_link(id1)</pre></div>
    <p>A child under a <span class="code">simple_one_for_one</span> supervisor can be
    terminated with the following:</p>
    <div class="example example-none"><pre>supervisor:terminate_child(Sup, Pid)</pre></div>
    <p><span class="code">Sup</span> is the pid, or name, of the supervisor and
    <span class="code">Pid</span> is the pid of the child.</p>
    <p>Because a <span class="code">simple_one_for_one</span> supervisor can have many
      children, it shuts them all down asynchronously. This means that
      the children will do their cleanup in parallel and therefore the
      order in which they are stopped is not defined.</p>
  

  <h3 id="stopping" class="title-link" onMouseOver="document.getElementById('ghlink-stopping-idm1915').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-stopping-idm1915').style.visibility = 'hidden';">
<div class="title-name">5.12 
        Stopping</div>
<div class="title-anchors"><span id="ghlink-stopping-idm1915" class="ghlink-after"><a href="#stopping" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L653" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>Since the supervisor is part of a supervision tree, it is
      automatically terminated by its supervisor. When asked to
      shut down, it terminates all child processes in reversed start
      order according to the respective shutdown specifications, and
      then terminates itself.</p>
    <p>If the supervisor is configured for
      <span class="bold_code bc-17"><a href="#automatic-shutdown">automatic
      shutdown</a></span> on termination of any or all
      <span class="bold_code bc-17"><a href="#significant_child">significant children</a></span>,
      it will shut down itself when any or the last active significant
      child terminates, respectively. The shutdown itself follows
      the same procedure as described above, that is, the supervisor
      terminates all remaining child processes in reversed start
      order, and then terminates itself.</p>
    <h4 id="manual-stopping-versus-automatic-shutdown" class="title-link" onMouseOver="document.getElementById('ghlink-manual-stopping-versus-automatic-shutdown-idm1921').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-manual-stopping-versus-automatic-shutdown-idm1921').style.visibility = 'hidden';">
<div class="title-name">Manual stopping versus Automatic Shutdown</div>
<div class="title-anchors"><span id="ghlink-manual-stopping-versus-automatic-shutdown-idm1921" class="ghlink-after"><a href="#manual-stopping-versus-automatic-shutdown" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/design_principles/sup_princ.xml#L669" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>For several reasons, a supervisor should not be stopped
        manually via <span class="bold_code bc-13"><a href="../man/supervisor.html#terminate_child-2">
        <span class="code">supervisor:terminate_child/2</span></a></span> from a child located
        in its own tree.</p>
      <ol>
        <li>
          <p>The child process will have to know the pids or registered
            names not only of the supervisor it wants to stop, but also
            that of the supervisor's parent supervisor, in order to tell
            the parent supervisor to stop the supervisor it wants to stop.
            This can make restructuring a supervision tree difficult.</p>
        </li>
        <li>
          <p><span class="bold_code bc-13"><a href="../man/supervisor.html#terminate_child-2">
            <span class="code">supervisor:terminate_child/2</span></a></span> is a blocking
            call that will only return after the parent supervisor has
            finished the shutdown of the supervisor that should be stopped.
            Unless the call is made from a spawned process, this will
            result in a deadlock, as the supervisor waits for the child
            to exit as part of its shutdown procedure, whereas the
            child waits for the supervisor to shut down. If the child is
            trapping exits, this deadlock will last until the
            <span class="bold_code bc-17"><a href="#shutdown">shutdown</a></span>
            timeout for the child expires.</p>
        </li>
        <li>
          <p>When a supervisor is stopping a child, it will wait for the
            shutdown to complete before accepting other calls, that is,
            the supervisor will be unresponsive until then. If the
            termination takes some time to complete, especially when
            the considerations outlined in the previous point were not
            taken into account carefully, said supervisor might become
            unresponsive for a long time.</p>
        </li>
      </ol>
      <p>Instead, it is generally a better approach to rely on 
        <span class="bold_code bc-17"><a href="#automatic-shutdown">Automatic
        Shutdown</a></span>.</p>
      <ol>
        <li>
          <p>A child process does not need to know anything about its
            supervisor and its respective parent, not even that it is
            part of a supervision tree in the first place. It is instead
            only the supervisor which hosts the child who must know
            which of its children are
            <span class="bold_code bc-17"><a href="#significant_child">significant</a></span>
            ones, and when to shut itself down.</p>
        </li>
        <li>
          <p>A child process does not need to do anything special to
            shut down the work unit it is part of. All it needs to do
            is terminate normally when it has finished the task it was
            started for.</p>
        </li>
        <li>
          <p>A supervisor that is automatically shutting itself down
            will perform the required shutdown steps fully independent
            of its parent supervisor. The parent supervisor will only
            notice that its child supervisor has terminated in the end.
            As the parent supervisor is not involved in the shutdown
            process, it will not be blocked.</p>
        </li>
      </ol>
    
  
</div>
<div class="footer">
<hr>
<p>Copyright © 1997-2021 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script type="text/javascript">window.__otpTopDocDir = '../js/';</script><script type="text/javascript" src="../js/highlight.js"></script>
<script src="/assets/js/doc-search.bundle.js"></script>
</body>
</html>
