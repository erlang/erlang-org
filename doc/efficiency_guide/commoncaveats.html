<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:erl="http://erlang.org" xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<link rel="stylesheet" href="../otp_doc.css" type="text/css">
<title>Erlang -- Common Caveats</title>
</head>
<body>
<div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../js/erlresolvelinks.js"></script><script id="js3" type="text/javascript" src="../js/topbar.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function setscrollpos() {
                var objf = document.getElementById('loadscrollpos');
                if (objf) {
                  document.getElementById("leftnav").firstChild.scrollTop = objf.offsetTop - 10;
                }
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //-->
</script><div class="topbar">
<div class="topbar-expand "><button onclick="toggleDisplay();"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="Capa_1" viewBox="0 0 54 54" width="24" height="24"><g><path style="fill:#000000;" d="M27,54c-0.552,0-1-0.448-1-1V8c0-0.552,0.448-1,1-1s1,0.448,1,1v45C28,53.552,27.552,54,27,54z"></path><path style="fill:#000000;" d="M11,25c-0.256,0-0.512-0.098-0.707-0.293c-0.391-0.391-0.391-1.023,0-1.414l16-16                                      c0.391-0.391,1.023-0.391,1.414,0s0.391,1.023,0,1.414l-16,16C11.512,24.902,11.256,25,11,25z"></path><path style="fill:#000000;" d="M43,25c-0.256,0-0.512-0.098-0.707-0.293l-16-16c-0.391-0.391-0.391-1.023,0-1.414                                      s1.023-0.391,1.414,0l16,16c0.391,0.391,0.391,1.023,0,1.414C43.512,24.902,43.256,25,43,25z"></path><path style="fill:#000000;" d="M43,2H11c-0.552,0-1-0.448-1-1s0.448-1,1-1h32c0.552,0,1,0.448,1,1S43.552,2,43,2z"></path></g></svg></button></div>
<div class="topbar-title"><h1 id="Common Caveats">3 
                Common Caveats</h1></div>
<div class="search-expand ">        <button id="docsearch-mobile">
            <svg fill="#000000" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="24" height="24"><path d="M 21 3 C 11.621094 3 4 10.621094 4 20 C 4 29.378906 11.621094 37 21 37 C 24.710938 37 28.140625 35.804688 30.9375 33.78125 L 44.09375 46.90625 L 46.90625 44.09375 L 33.90625 31.0625 C 36.460938 28.085938 38 24.222656 38 20 C 38 10.621094 30.378906 3 21 3 Z M 21 5 C 29.296875 5 36 11.703125 36 20 C 36 28.296875 29.296875 35 21 35 C 12.703125 35 6 28.296875 6 20 C 6 11.703125 12.703125 5 21 5 Z"/></svg>
        </button>
</div>
</div>
<aside class="hide-mobile" id="leftnav"><nav class="leftnav-tube"><div class="erlang-logo-wrapper"><a href="../index.html"><img alt="Erlang Logo" src="../erlang-logo.png" class="erlang-logo"></a></div>
<p class="section-title">Efficiency Guide</p>
<p class="section-subtitle">User's Guide</p>
<p class="section-version">Version 12.1.2</p>
<ul class="panel-sections">
<li><a href="users_guide.html">User's Guide</a></li>
<li><a href="../pdf/otp-system-documentation.pdf">PDF</a></li>
<li><a href="../index.html">Top</a></li>
</ul>
<div id="docsearch"></div>
<ul class="expand-collapse-items">
<li><a href="javascript:openAllFlips()">Expand All</a></li>
<li><a href="javascript:closeAllFlips()">Contract All</a></li>
</ul>
<h3 id="chapters">Chapters</h3>
<ul class="flipMenu" imagePath="../js/flipmenu">
<li id="no" title="Introduction" expanded="false">Introduction<ul>
<li><a href="introduction.html">
              Top of chapter
            </a></li>
<li title="Purpose"><a href="introduction.html#purpose">Purpose</a></li>
<li title="Prerequisites"><a href="introduction.html#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li id="no" title="The Seven Myths of Erlang Performance" expanded="false">The Seven Myths of Erlang Performance<ul>
<li><a href="myths.html">
              Top of chapter
            </a></li>
<li title="Myth: Tail-Recursive Functions are Much Faster
    Than Recursive Functions"><a href="myths.html#myth--tail-recursive-functions-are-much-faster-----than-recursive-functions">Myth: Tail-Recursive Functions are Much Faster
    Than Recursive Functions</a></li>
<li title='Myth: Operator "++" is Always Bad'><a href="myths.html#myth--operator--++--is-always-bad">Myth: Operator "++" is Always Bad</a></li>
<li title="Myth: Strings are Slow"><a href="myths.html#myth--strings-are-slow">Myth: Strings are Slow</a></li>
<li title="Myth: Repairing a Dets File is Very Slow"><a href="myths.html#myth--repairing-a-dets-file-is-very-slow">Myth: Repairing a Dets File is Very Slow</a></li>
<li title="Myth: BEAM is a Stack-Based Byte-Code Virtual Machine
    (and Therefore Slow)"><a href="myths.html#myth--beam-is-a-stack-based-byte-code-virtual-machine------and-therefore-slow-">Myth: BEAM is a Stack-Based Byte-Code Virtual Machine
    (and Therefore Slow)</a></li>
<li title='Myth: Use "_" to Speed Up Your Program When a Variable
    is Not Used'><a href="myths.html#myth--use--_--to-speed-up-your-program-when-a-variable-----is-not-used">Myth: Use "_" to Speed Up Your Program When a Variable
    is Not Used</a></li>
<li title="Myth: A NIF Always Speeds Up Your Program"><a href="myths.html#myth--a-nif-always-speeds-up-your-program">Myth: A NIF Always Speeds Up Your Program</a></li>
</ul>
</li>
<li id="loadscrollpos" title="Common Caveats" expanded="true">Common Caveats<ul>
<li><a href="commoncaveats.html">
              Top of chapter
            </a></li>
<li title="Timer Module"><a href="commoncaveats.html#timer-module">Timer Module</a></li>
<li title="Accidental Copying and Loss of Sharing"><a href="commoncaveats.html#accidental-copying-and-loss-of-sharing">Accidental Copying and Loss of Sharing</a></li>
<li title="list_to_atom/1"><a href="commoncaveats.html#list_to_atom-1">list_to_atom/1</a></li>
<li title="length/1"><a href="commoncaveats.html#length-1">length/1</a></li>
<li title="setelement/3"><a href="commoncaveats.html#setelement-3">setelement/3</a></li>
<li title="size/1"><a href="commoncaveats.html#size-1">size/1</a></li>
<li title="split_binary/2"><a href="commoncaveats.html#split_binary-2">split_binary/2</a></li>
</ul>
</li>
<li id="no" title="Constructing and Matching Binaries" expanded="false">Constructing and Matching Binaries<ul>
<li><a href="binaryhandling.html">
              Top of chapter
            </a></li>
<li title="How Binaries are Implemented"><a href="binaryhandling.html#how-binaries-are-implemented">How Binaries are Implemented</a></li>
<li title="Constructing Binaries"><a href="binaryhandling.html#constructing-binaries">Constructing Binaries</a></li>
<li title="Matching Binaries"><a href="binaryhandling.html#matching-binaries">Matching Binaries</a></li>
<li title="Historical Note"><a href="binaryhandling.html#historical-note">Historical Note</a></li>
</ul>
</li>
<li id="no" title="Maps" expanded="false">Maps<ul>
<li><a href="maps.html">
              Top of chapter
            </a></li>
<li title="Maps or Records?"><a href="maps.html#maps-or-records-">Maps or Records?</a></li>
<li title="Using Maps as an Alternative to Records"><a href="maps.html#using-maps-as-an-alternative-to-records">Using Maps as an Alternative to Records</a></li>
<li title="Using Maps as Dictionaries"><a href="maps.html#using-maps-as-dictionaries">Using Maps as Dictionaries</a></li>
<li title="Using Maps as Sets"><a href="maps.html#using-maps-as-sets">Using Maps as Sets</a></li>
<li title="How Maps are Implemented"><a href="maps.html#how-maps-are-implemented">How Maps are Implemented</a></li>
<li title="Using the Map Syntax"><a href="maps.html#using-the-map-syntax">Using the Map Syntax</a></li>
<li title="Using the Functions in the maps Module"><a href="maps.html#using-the-functions-in-the-maps-module">Using the Functions in the maps Module</a></li>
</ul>
</li>
<li id="no" title="List Handling" expanded="false">List Handling<ul>
<li><a href="listHandling.html">
              Top of chapter
            </a></li>
<li title="Creating a List"><a href="listHandling.html#creating-a-list">Creating a List</a></li>
<li title="List Comprehensions"><a href="listHandling.html#list-comprehensions">List Comprehensions</a></li>
<li title="Deep and Flat Lists"><a href="listHandling.html#deep-and-flat-lists">Deep and Flat Lists</a></li>
<li title="Recursive List Functions"><a href="listHandling.html#recursive-list-functions">Recursive List Functions</a></li>
</ul>
</li>
<li id="no" title="Functions" expanded="false">Functions<ul>
<li><a href="functions.html">
              Top of chapter
            </a></li>
<li title="Pattern Matching"><a href="functions.html#pattern-matching">Pattern Matching</a></li>
<li title="Function Calls"><a href="functions.html#function-calls">Function Calls</a></li>
<li title="Memory Usage in Recursion"><a href="functions.html#memory-usage-in-recursion">Memory Usage in Recursion</a></li>
</ul>
</li>
<li id="no" title="Tables and Databases" expanded="false">Tables and Databases<ul>
<li><a href="tablesDatabases.html">
              Top of chapter
            </a></li>
<li title="Ets, Dets, and Mnesia"><a href="tablesDatabases.html#ets,-dets,-and-mnesia">Ets, Dets, and Mnesia</a></li>
<li title="Ets-Specific"><a href="tablesDatabases.html#ets-specific">Ets-Specific</a></li>
<li title="Mnesia-Specific"><a href="tablesDatabases.html#mnesia-specific">Mnesia-Specific</a></li>
</ul>
</li>
<li id="no" title="Processes" expanded="false">Processes<ul>
<li><a href="processes.html">
              Top of chapter
            </a></li>
<li title="Creating an Erlang Process"><a href="processes.html#creating-an-erlang-process">Creating an Erlang Process</a></li>
<li title="Sending Messages"><a href="processes.html#sending-messages">Sending Messages</a></li>
<li title="Receiving messages"><a href="processes.html#receiving-messages">Receiving messages</a></li>
<li title="Literal Pool"><a href="processes.html#literal-pool">Literal Pool</a></li>
<li title="Loss of Sharing"><a href="processes.html#loss-of-sharing">Loss of Sharing</a></li>
<li title="SMP Emulator"><a href="processes.html#smp-emulator">SMP Emulator</a></li>
</ul>
</li>
<li id="no" title="Drivers" expanded="false">Drivers<ul>
<li><a href="drivers.html">
              Top of chapter
            </a></li>
<li title="Drivers and Concurrency"><a href="drivers.html#drivers-and-concurrency">Drivers and Concurrency</a></li>
<li title="Avoiding Copying Binaries When Calling a Driver"><a href="drivers.html#avoiding-copying-binaries-when-calling-a-driver">Avoiding Copying Binaries When Calling a Driver</a></li>
<li title="Returning Small Binaries from a Driver"><a href="drivers.html#returning-small-binaries-from-a-driver">Returning Small Binaries from a Driver</a></li>
<li title="Returning Large Binaries without Copying from a Driver"><a href="drivers.html#returning-large-binaries-without-copying-from-a-driver">Returning Large Binaries without Copying from a Driver</a></li>
</ul>
</li>
<li id="no" title="Advanced" expanded="false">Advanced<ul>
<li><a href="advanced.html">
              Top of chapter
            </a></li>
<li title="Memory"><a href="advanced.html#memory">Memory</a></li>
<li title="System Limits"><a href="advanced.html#system-limits">System Limits</a></li>
</ul>
</li>
<li id="no" title="Profiling" expanded="false">Profiling<ul>
<li><a href="profiling.html">
              Top of chapter
            </a></li>
<li title="Do Not Guess About Performance - Profile"><a href="profiling.html#do-not-guess-about-performance---profile">Do Not Guess About Performance - Profile</a></li>
<li title="Memory profiling"><a href="profiling.html#memory-profiling">Memory profiling</a></li>
<li title="Large Systems"><a href="profiling.html#large-systems">Large Systems</a></li>
<li title="What to Look For"><a href="profiling.html#what-to-look-for">What to Look For</a></li>
<li title="Tools"><a href="profiling.html#tools">Tools</a></li>
<li title="Benchmarking"><a href="profiling.html#benchmarking">Benchmarking</a></li>
</ul>
</li>
<li id="no" title="Retired Myths" expanded="false">Retired Myths<ul>
<li><a href="retired_myths.html">
              Top of chapter
            </a></li>
<li title="Myth: Funs are Slow"><a href="retired_myths.html#myth--funs-are-slow">Myth: Funs are Slow</a></li>
<li title="Myth: List Comprehensions are Slow"><a href="retired_myths.html#myth--list-comprehensions-are-slow">Myth: List Comprehensions are Slow</a></li>
<li title='Myth: List subtraction ("--" operator) is slow'><a href="retired_myths.html#myth--list-subtraction-------operator--is-slow">Myth: List subtraction ("--" operator) is slow</a></li>
</ul>
</li>
</ul></nav></aside><div id="content">
<div class="innertube">
<h1 id="Common Caveats">3 Common Caveats</h1>
  

  <p>This section lists a few modules and BIFs to watch out for, not only
  from a performance point of view.</p>

  <h3 id="timer-module" class="title-link" onMouseOver="document.getElementById('ghlink-timer-module-idm142').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-timer-module-idm142').style.visibility = 'hidden';">
<div class="title-name">3.1 
        Timer Module</div>
<div class="title-anchors"><span id="ghlink-timer-module-idm142" class="ghlink-after"><a href="#timer-module" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/commoncaveats.xmlsrc#L35" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
     

     <p>Creating timers using <span class="bold_code bc-13"><a href="../man/erlang.html#send_after-3">erlang:send_after/3</a></span>
     and
     <span class="bold_code bc-13"><a href="../man/erlang.html#start_timer-3">erlang:start_timer/3</a></span>,
     is much more efficient than using the timers provided by the
     <span class="bold_code bc-18"><a href="../man/timer.html">timer</a></span> module in STDLIB.
     The <span class="code">timer</span> module uses a separate process to manage the timers.
     That process can easily become overloaded if many processes
     create and cancel timers frequently.</p>

     <p>The functions in the <span class="code">timer</span> module that do not manage timers
     (such as <span class="code">timer:tc/3</span> or <span class="code">timer:sleep/1</span>), do not call the
     timer-server process and are therefore harmless.</p>
  

  <h3 id="accidental-copying-and-loss-of-sharing" class="title-link" onMouseOver="document.getElementById('ghlink-accidental-copying-and-loss-of-sharing-idm153').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-accidental-copying-and-loss-of-sharing-idm153').style.visibility = 'hidden';">
<div class="title-name">3.2 
        Accidental Copying and Loss of Sharing</div>
<div class="title-anchors"><span id="ghlink-accidental-copying-and-loss-of-sharing-idm153" class="ghlink-after"><a href="#accidental-copying-and-loss-of-sharing" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/commoncaveats.xmlsrc#L53" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    

    <p>When spawning a new process using a fun, one can accidentally
    copy more data to the process than intended. For example:</p>

    <p><strong>DO NOT</strong></p>
<div class="example example-none"><pre>accidental1(State) -&gt;
    spawn(fun() -&gt;
                  io:format("~p\n", [State#state.info])
          end).</pre></div>
    <p>The code in the fun will extract one element from the record
    and print it. The rest of the <span class="code">state</span> record is not used.
    However, when the <span class="code">spawn/1</span> function is executed, the entire
    record is copied to the newly created process.</p>

    <p>The same kind of problem can happen with a map:</p>
    <p><strong>DO NOT</strong></p>
<div class="example example-none"><pre>accidental2(State) -&gt;
    spawn(fun() -&gt;
                  io:format("~p\n", [map_get(info, State)])
          end).</pre></div>
    <p>In the following example (part of a module implementing the
    <span class="bold_code bc-18"><a href="../man/gen_server.html">gen_server</a></span> behavior)
    the created fun is sent to another process:</p>

    <p><strong>DO NOT</strong></p>
<div class="example example-none"><pre>handle_call(give_me_a_fun, _From, State) -&gt;
    Fun = fun() -&gt; State#state.size =:= 42 end,
    {reply, Fun, State}.</pre></div>
    <p>How bad that unnecessary copy is depends on the contents of
    the record or the map.</p>

    <p>For example, if the <span class="code">state</span> record is initialized like
    this:</p>
<div class="example example-none"><pre>init1() -&gt;
    #state{data=lists:seq(1, 10000)}.</pre></div>
    <p>a list with 10000 elements (or about 20000 heap words) will be
    copied to the newly created process.</p>

    <p>An unncessary copy of 10000 element list can be bad enough, but it
    can get even worse if the <span class="code">state</span> record contains <strong>shared subterms</strong>.
    Here is a simple example of a term with a shared subterm:</p>

    <div class="example example-erl"><pre>{SubTerm, SubTerm}</pre></div>

    <p>When a term is copied to another process, sharing of subterms
    will be lost and the copied term can be many times larger than the
    original term. For example:</p>

<div class="example example-none"><pre>init2() -&gt;
    SharedSubTerms = lists:foldl(fun(_, A) -&gt; [A|A] end, [0], lists:seq(1, 15)),
    #state{data=Shared}.</pre></div>
    <p>In the process that calls <span class="code">init2/0</span>, the size of the
    <span class="code">data</span> field in the <span class="code">state</span> record will be 32 heap
    words. When the record is copied to the newly created process,
    sharing will be lost and the size of the copied <span class="code">data</span> field
    will be 131070 heap words. More details about <span class="bold_code bc-15"><a href="processes.html#loss-of-sharing">loss off sharing</a></span> are
    found in a later section.</p>

    <p>To avoid the problem, outside of the fun extract only the
    fields of the record that are actually used:</p>

    <p><strong>DO</strong></p>
<div class="example example-none"><pre>fixed_accidental1(State) -&gt;
    Info = State#state.info,
    spawn(fun() -&gt;
                  io:format("~p\n", [Info])
          end).</pre></div>
    <p>Similarly, outside of the fun extract only the map elements
    that are actually used:</p>

    <p><strong>DO</strong></p>
<div class="example example-none"><pre>fixed_accidental2(State) -&gt;
    Info = map_get(info, State),
    spawn(fun() -&gt;
                  io:format("~p\n", [Info])
          end).</pre></div>  

  <h3 id="list_to_atom-1" class="title-link" onMouseOver="document.getElementById('ghlink-list_to_atom-1-idm196').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-list_to_atom-1-idm196').style.visibility = 'hidden';">
<div class="title-name">3.3 
        list_to_atom/1</div>
<div class="title-anchors"><span id="ghlink-list_to_atom-1-idm196" class="ghlink-after"><a href="#list_to_atom-1" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/commoncaveats.xmlsrc#L122" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    

    <p>Atoms are not garbage-collected. Once an atom is created, it is never
    removed. The emulator terminates if the limit for the number
    of atoms (1,048,576 by default) is reached.</p>

    <p>Therefore, converting arbitrary input strings to atoms can be
    dangerous in a system that runs continuously.
    If only certain well-defined atoms are allowed as input,
    <span class="bold_code bc-13"><a href="../man/erlang.html#list_to_existing_atom-1">list_to_existing_atom/1</a></span>
    can be used
    to guard against a denial-of-service attack. (All atoms that are allowed
    must have been created earlier, for example, by simply using all of them
    in a module and loading that module.)</p>

    <p>Using <span class="code">list_to_atom/1</span> to construct an atom that is passed to
    <span class="code">apply/3</span> as follows, is quite expensive and not recommended
    in time-critical code:</p>
    <div class="example example-erl"><pre>apply(list_to_atom("some_prefix"++Var), foo, Args)</pre></div>
  

  <h3 id="length-1" class="title-link" onMouseOver="document.getElementById('ghlink-length-1-idm205').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-length-1-idm205').style.visibility = 'hidden';">
<div class="title-name">3.4 
        length/1</div>
<div class="title-anchors"><span id="ghlink-length-1-idm205" class="ghlink-after"><a href="#length-1" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/commoncaveats.xmlsrc#L145" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    

    <p>The time for calculating the length of a list is proportional to the
    length of the list, as opposed to <span class="code">tuple_size/1</span>, <span class="code">byte_size/1</span>,
    and <span class="code">bit_size/1</span>, which all execute in constant time.</p>

    <p>Normally, there is no need to worry about the speed of <span class="code">length/1</span>,
    because it is efficiently implemented in C. In time-critical code,
    you might want to avoid it if the input list could potentially be very
    long.</p>

    <p>Some uses of <span class="code">length/1</span> can be replaced by matching.
    For example, the following code:</p>
    <div class="example example-erl"><pre>foo(L) when length(L) &gt;= 3 -&gt;
    ...</pre></div>

    <p>can be rewritten to:</p>
    <div class="example example-erl"><pre>foo([_,_,_|_]=L) -&gt;
   ...</pre></div>

   <p>One slight difference is that <span class="code">length(L)</span> fails if <span class="code">L</span>
   is an improper list, while the pattern in the second code fragment
   accepts an improper list.</p>
  

  <h3 id="setelement-3" class="title-link" onMouseOver="document.getElementById('ghlink-setelement-3-idm221').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-setelement-3-idm221').style.visibility = 'hidden';">
<div class="title-name">3.5 
        setelement/3</div>
<div class="title-anchors"><span id="ghlink-setelement-3-idm221" class="ghlink-after"><a href="#setelement-3" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/commoncaveats.xmlsrc#L173" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    

    <p><span class="bold_code bc-13"><a href="../man/erlang.html#setelement-3">setelement/3</a></span>
    copies the tuple it modifies. Therefore, updating a tuple in a loop
    using <span class="code">setelement/3</span> creates a new copy of the tuple every time.</p>

    <p>There is one exception to the rule that the tuple is copied.
    If the compiler clearly can see that destructively updating the tuple would
    give the same result as if the tuple was copied, the call to
    <span class="code">setelement/3</span> is replaced with a special destructive <span class="code">setelement</span>
    instruction. In the following code sequence, the first <span class="code">setelement/3</span>
    call copies the tuple and modifies the ninth element:</p>
    <div class="example example-erl"><pre>multiple_setelement(T0) -&gt;
    T1 = setelement(9, T0, bar),
    T2 = setelement(7, T1, foobar),
    setelement(5, T2, new_value).</pre></div>

    <p>The two following <span class="code">setelement/3</span> calls modify
    the tuple in place.</p>

    <p>For the optimization to be applied, <strong>all</strong> the followings conditions
    must be true:</p>

    <ul>
    <li>The indices must be integer literals, not variables or expressions.</li>
    <li>The indices must be given in descending order.</li>
    <li>There must be no calls to another function in between the calls to
    <span class="code">setelement/3</span>.</li>
    <li>The tuple returned from one <span class="code">setelement/3</span> call must only be used
    in the subsequent call to <span class="code">setelement/3</span>.</li>
    </ul>

    <p>If the code cannot be structured as in the <span class="code">multiple_setelement/1</span>
    example, the best way to modify multiple elements in a large tuple is to
    convert the tuple to a list, modify the list, and convert it back to
    a tuple.</p>
  

  <h3 id="size-1" class="title-link" onMouseOver="document.getElementById('ghlink-size-1-idm245').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-size-1-idm245').style.visibility = 'hidden';">
<div class="title-name">3.6 
        size/1</div>
<div class="title-anchors"><span id="ghlink-size-1-idm245" class="ghlink-after"><a href="#size-1" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/commoncaveats.xmlsrc#L213" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    

    <p><span class="code">size/1</span> returns the size for both tuples and binaries.</p>

    <p>Using the BIFs <span class="code">tuple_size/1</span> and <span class="code">byte_size/1</span>
    gives the compiler and the runtime system more opportunities for
    optimization. Another advantage is that the BIFs give Dialyzer more
    type information.</p>
  

  <h3 id="split_binary-2" class="title-link" onMouseOver="document.getElementById('ghlink-split_binary-2-idm252').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-split_binary-2-idm252').style.visibility = 'hidden';">
<div class="title-name">3.7 
        split_binary/2</div>
<div class="title-anchors"><span id="ghlink-split_binary-2-idm252" class="ghlink-after"><a href="#split_binary-2" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/system/doc/efficiency_guide/commoncaveats.xmlsrc#L224" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
      <p>It is usually more efficient to split a binary using matching
      instead of calling the <span class="code">split_binary/2</span> function.
      Furthermore, mixing bit syntax matching and <span class="code">split_binary/2</span>
      can prevent some optimizations of bit syntax matching.</p>

        <p><strong>DO</strong></p>
        <div class="example example-none"><pre>        &lt;&lt;Bin1:Num/binary,Bin2/binary&gt;&gt; = Bin,</pre></div>
        <p><strong>DO NOT</strong></p>
        <div class="example example-none"><pre>        {Bin1,Bin2} = split_binary(Bin, Num)</pre></div>
   
</div>
<div class="footer">
<hr>
<p>Copyright © 2001-2021 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script type="text/javascript">window.__otpTopDocDir = '../js/';</script><script type="text/javascript" src="../js/highlight.js"></script>
<script src="/assets/js/doc-search.bundle.js"></script>
</body>
</html>
