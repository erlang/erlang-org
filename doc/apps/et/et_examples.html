<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:erl="http://erlang.org" xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<link rel="stylesheet" href="../../otp_doc.css" type="text/css">
<title>Erlang -- Advanced examples</title>
</head>
<body>
<div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../../js/erlresolvelinks.js"></script><script id="js3" type="text/javascript" src="../../../../doc/js/topbar.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function setscrollpos() {
                var objf = document.getElementById('loadscrollpos');
                if (objf) {
                  document.getElementById("leftnav").firstChild.scrollTop = objf.offsetTop - 10;
                }
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //-->
</script><div class="topbar">
<div class="topbar-expand "><button onclick="toggleDisplay();"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="Capa_1" viewBox="0 0 54 54" width="24" height="24"><g><path style="fill:#000000;" d="M27,54c-0.552,0-1-0.448-1-1V8c0-0.552,0.448-1,1-1s1,0.448,1,1v45C28,53.552,27.552,54,27,54z"></path><path style="fill:#000000;" d="M11,25c-0.256,0-0.512-0.098-0.707-0.293c-0.391-0.391-0.391-1.023,0-1.414l16-16                                      c0.391-0.391,1.023-0.391,1.414,0s0.391,1.023,0,1.414l-16,16C11.512,24.902,11.256,25,11,25z"></path><path style="fill:#000000;" d="M43,25c-0.256,0-0.512-0.098-0.707-0.293l-16-16c-0.391-0.391-0.391-1.023,0-1.414                                      s1.023-0.391,1.414,0l16,16c0.391,0.391,0.391,1.023,0,1.414C43.512,24.902,43.256,25,43,25z"></path><path style="fill:#000000;" d="M43,2H11c-0.552,0-1-0.448-1-1s0.448-1,1-1h32c0.552,0,1,0.448,1,1S43.552,2,43,2z"></path></g></svg></button></div>
<div class="topbar-title"><h1 id="Advanced examples">4 
                Advanced examples</h1></div>
<div class="search-expand ">        <button id="docsearch-mobile">
            <svg fill="#000000" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="24" height="24"><path d="M 21 3 C 11.621094 3 4 10.621094 4 20 C 4 29.378906 11.621094 37 21 37 C 24.710938 37 28.140625 35.804688 30.9375 33.78125 L 44.09375 46.90625 L 46.90625 44.09375 L 33.90625 31.0625 C 36.460938 28.085938 38 24.222656 38 20 C 38 10.621094 30.378906 3 21 3 Z M 21 5 C 29.296875 5 36 11.703125 36 20 C 36 28.296875 29.296875 35 21 35 C 12.703125 35 6 28.296875 6 20 C 6 11.703125 12.703125 5 21 5 Z"/></svg>
        </button>
</div>
</div>
<aside class="hide-mobile" id="leftnav"><nav class="leftnav-tube"><div class="erlang-logo-wrapper"><a href="../../index.html"><img alt="Erlang Logo" src="../../erlang-logo.png" class="erlang-logo"></a></div>
<p class="section-title">Event Tracer (ET)</p>
<p class="section-subtitle">User's Guide</p>
<p class="section-version">Version 1.6.5</p>
<ul class="panel-sections">
<li><a href="users_guide.html">User's Guide</a></li>
<li><a href="index.html">Reference Manual</a></li>
<li><a href="notes.html">Release Notes</a></li>
<li><a href="et.pdf">PDF</a></li>
<li><a href="../../index.html">Top</a></li>
</ul>
<div id="docsearch"></div>
<ul class="expand-collapse-items">
<li><a href="javascript:openAllFlips()">Expand All</a></li>
<li><a href="javascript:closeAllFlips()">Contract All</a></li>
</ul>
<h3 id="chapters">Chapters</h3>
<ul class="flipMenu" imagePath="../../js/flipmenu">
<li id="no" title="Introduction" expanded="false">Introduction<ul>
<li><a href="et_intro.html">
              Top of chapter
            </a></li>
<li title="Scope and Purpose"><a href="et_intro.html#scope-and-purpose">Scope and Purpose</a></li>
<li title="Prerequisites"><a href="et_intro.html#prerequisites">Prerequisites</a></li>
<li title="About This Manual"><a href="et_intro.html#about-this-manual">About This Manual</a></li>
<li title="Where to Find More Information"><a href="et_intro.html#where-to-find-more-information">Where to Find More Information</a></li>
</ul>
</li>
<li id="no" title="Tutorial" expanded="false">Tutorial<ul>
<li><a href="et_tutorial.html">
              Top of chapter
            </a></li>
<li title="Visualizing Message Sequence Charts"><a href="et_tutorial.html#visualizing-message-sequence-charts">Visualizing Message Sequence Charts</a></li>
<li title="Four Modules"><a href="et_tutorial.html#four-modules">Four Modules</a></li>
<li title="The Event Tracer Interface"><a href="et_tutorial.html#the-event-tracer-interface">The Event Tracer Interface</a></li>
<li title="The Collector and Viewer"><a href="et_tutorial.html#the-collector-and-viewer">The Collector and Viewer</a></li>
<li title="The Selector"><a href="et_tutorial.html#the-selector">The Selector</a></li>
<li title="How To Put It Together"><a href="et_tutorial.html#how-to-put-it-together">How To Put It Together</a></li>
</ul>
</li>
<li id="no" title="Description" expanded="false">Description<ul>
<li><a href="et_desc.html">
              Top of chapter
            </a></li>
<li title="Overview"><a href="et_desc.html#overview">Overview</a></li>
<li title="Filters and dictionary"><a href="et_desc.html#filters-and-dictionary">Filters and dictionary</a></li>
<li title="Trace clients"><a href="et_desc.html#trace-clients">Trace clients</a></li>
<li title="Global tracing"><a href="et_desc.html#global-tracing">Global tracing</a></li>
<li title="Viewer window"><a href="et_desc.html#viewer-window">Viewer window</a></li>
<li title="Configuration"><a href="et_desc.html#configuration">Configuration</a></li>
<li title="Contents viewer window"><a href="et_desc.html#contents-viewer-window">Contents viewer window</a></li>
</ul>
</li>
<li id="loadscrollpos" title="Advanced examples" expanded="true">Advanced examples<ul>
<li><a href="et_examples.html">
              Top of chapter
            </a></li>
<li title="A simulated Mnesia transaction"><a href="et_examples.html#a-simulated-mnesia-transaction">A simulated Mnesia transaction</a></li>
<li title="Some convenient functions used in the Mnesia transaction
    example"><a href="et_examples.html#some-convenient-functions-used-in-the-mnesia-transaction-----example">Some convenient functions used in the Mnesia transaction
    example</a></li>
<li title="Erlang trace of a real Mnesia transaction"><a href="et_examples.html#erlang-trace-of-a-real-mnesia-transaction">Erlang trace of a real Mnesia transaction</a></li>
<li title="Erlang trace of Megaco startup"><a href="et_examples.html#erlang-trace-of-megaco-startup">Erlang trace of Megaco startup</a></li>
</ul>
</li>
</ul></nav></aside><div id="content">
<div class="innertube">
<h1 id="Advanced examples">4 Advanced examples</h1>
  

  <h3 id="a-simulated-mnesia-transaction" class="title-link" onMouseOver="document.getElementById('ghlink-a-simulated-mnesia-transaction-idm799').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-a-simulated-mnesia-transaction-idm799').style.visibility = 'hidden';">
<div class="title-name">4.1 
        A simulated Mnesia transaction</div>
<div class="title-anchors"><span id="ghlink-a-simulated-mnesia-transaction-idm799" class="ghlink-after"><a href="#a-simulated-mnesia-transaction" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/et/doc/src/et_examples.xmlsrc#L36" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>The Erlang code for running the simulated <span class="code">Mnesia</span> transaction
    example in the previous chapter is included in the
    <span class="code">et/examples/et_demo.erl</span> file:</p>

    <p></p>

<div class="example example-none"><pre>sim_trans() -&gt;
    sim_trans([]).

sim_trans(ExtraOptions) -&gt;
    Options = [{dict_insert, {filter, mgr_actors}, fun mgr_actors/1}],
    {ok, Viewer} = et_viewer:start_link(Options ++ ExtraOptions),
    Collector = et_viewer:get_collector_pid(Viewer),
    et_collector:report_event(Collector, 60, my_shell, mnesia_tm, start_outer, 
                              "Start outer transaction"),
    et_collector:report_event(Collector, 40, mnesia_tm, my_shell, new_tid, 
                              "New transaction id is 4711"),
    et_collector:report_event(Collector, 20, my_shell, mnesia_locker, try_write_lock, 
                              "Acquire write lock for {my_tab, key}"),
    et_collector:report_event(Collector, 10, mnesia_locker, my_shell, granted,
                              "You got the write lock for {my_tab, key}"),
    et_collector:report_event(Collector, 60, my_shell, do_commit,
                              "Perform  transaction commit"),
    et_collector:report_event(Collector, 40, my_shell, mnesia_locker, release_tid,
                              "Release all locks for transaction 4711"),
    et_collector:report_event(Collector, 60, my_shell, mnesia_tm, delete_transaction,
                              "End of outer transaction"),
    et_collector:report_event(Collector, 20, my_shell, end_outer,
                              "Transaction returned {atomic, ok}"),
    {collector, Collector}.</pre></div>
    <p></p>

<div class="example example-none"><pre>mgr_actors(E) when is_record(E, event) -&gt;
    Actor = fun(A) -&gt;
               case A of
                   mnesia_tm     -&gt; trans_mgr;
                   mnesia_locker -&gt; lock_mgr;
                   _             -&gt; A
               end
            end,
    {true, E#event{from = Actor(E#event.from),
                   to = Actor(E#event.to),
                   contents = [{orig_from, E#event.from},
                               {orig_to,   E#event.to},
                               {orig_contents, E#event.contents}]}}.</pre></div>
    <p>If you invoke the <span class="code">et_demo:sim_trans()</span> function, a
    <span class="code">Viewer</span> window will pop up and the sequence trace will be
    almost the same as if the following <span class="code">Mnesia</span> transaction
    would have been run:</p>

    <p></p>

    <div class="example example-none"><pre>mnesia:transaction(fun() -&gt; mnesia:write({my_tab, key, val}) end).</pre></div>

    <p>And the viewer window will look like:</p>

    <p></p>

    <div class="example example-none"><pre>Erlang R13B03 (erts-5.7.4) [64-bit] [smp:4:4] [rq:4] [async-threads:0] [kernel-poll:false]

Eshell V5.7.4  (abort with ^G)
1&gt; {ok, Viewer} = et_viewer:start([]).
{ok,&lt;0.40.0&gt;;}
2&gt; et_demo:sim_trans().
{ok,{table_handle,&lt;0.45.0&gt;,24596,trace_ts,
     #Fun&lt;et_collector.0.62831470&gt;}}</pre></div>

    <p></p>

    <div class="doc-image-wrapper">
<img alt="IMAGE MISSING" src="sim_trans.png" class="doc-image">
      <p class="doc-image-caption">Figure
        4.1:
         
        A simulated Mnesia transaction which writes one record</p>
    </div>

  

  <h3 id="some-convenient-functions-used-in-the-mnesia-transaction-----example" class="title-link" onMouseOver="document.getElementById('ghlink-some-convenient-functions-used-in-the-mnesia-transaction-----example-idm820').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-some-convenient-functions-used-in-the-mnesia-transaction-----example-idm820').style.visibility = 'hidden';">
<div class="title-name">4.2 
        Some convenient functions used in the Mnesia transaction
    example</div>
<div class="title-anchors"><span id="ghlink-some-convenient-functions-used-in-the-mnesia-transaction-----example-idm820" class="ghlink-after"><a href="#some-convenient-functions-used-in-the-mnesia-transaction-----example" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/et/doc/src/et_examples.xmlsrc#L82" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    

    <p>The <span class="code">module_as_actor</span> filter converts the <span class="code">Event
    Records</span> so the module names becomes actors and the invoked
    functions becomes labels. If the information about who the caller
    was it will be displayed as an arrow directed from the caller to
    the callee. The <span class="code">[{message, {caller}}, {return_trace}]</span>
    options to <span class="code">dbg:tpl/2</span> function will imply the necessary
    information in the Erlang traces.  Here follows the
    <span class="code">module_as_actor</span> filter:</p>


    <p></p>

<div class="example example-none"><pre>module_as_actor(E) when is_record(E, event) -&gt;
    case lists:keysearch(mfa, 1, E#event.contents) of
        {value, {mfa, {M, F, _A}}} -&gt;
            case lists:keysearch(pam_result, 1, E#event.contents) of
                {value, {pam_result, {M2, _F2, _A2}}} -&gt;
                    {true, E#event{label = F, from = M2, to = M}};
                _ -&gt;
                    {true, E#event{label = F, from = M, to = M}}
            end;
        _ -&gt;
            false
    end.</pre></div>
    <p>The <span class="code">plain_process_info</span> filter does not alter the
    <span class="code">Event Records</span>.  It merely ensures that the event not
    related to processes are skipped:</p>

    <p></p>

<div class="example example-none"><pre>plain_process_info(E) when is_record(E, event) -&gt;
    case E#event.label of
        send                          -&gt; true;
        send_to_non_existing_process  -&gt; true;
        'receive'                     -&gt; true;
        spawn                         -&gt; true;
        exit                          -&gt; true;
        link                          -&gt; true;
        unlink                        -&gt; true;
        getting_linked                -&gt; true;
        {seq_send, _Label}            -&gt; true;
        {seq_receive, _Label}         -&gt; true;
        {seq_print, _Label}           -&gt; true;
        {drop, _N}                    -&gt; true;
        _                             -&gt; false
    end.</pre></div>
    <p>The <span class="code">plain_process_info_nolink</span> filter does not alter the
    <span class="code">Event Records</span>. It do makes use of the
    <span class="code">plain_process_info</span> , but do also ensure that the process
    info related to linking and unlinking is skipped:</p>

    <p></p>

<div class="example example-none"><pre>plain_process_info_nolink(E) when is_record(E, event) -&gt;
    (E#event.label /= link) and
    (E#event.label /= unlink) and
    (E#event.label /= getting_linked) and
    plain_process_info(E). </pre></div>
    <p>In order to simplify the startup of an <span class="code">et_viewer</span> process
    with the filters mentioned above, plus some others (that also are
    found in <span class="code">et/examples/et_demo.erl</span> src/et_collector.erl the
    <span class="code">et_demo:start/0,1</span> functions can be used:</p>

    <p></p>

<div class="example example-none"><pre>start() -&gt;
    start([]).

start(ExtraOptions) -&gt;
    Options = [{trace_global, true},
               {parent_pid, undefined},
               {max_actors, infinity},
               {max_events, 1000},
               {active_filter, module_as_actor}],
    et_viewer:start_link(filters() ++ Options ++ ExtraOptions).</pre></div>
    <p>A simple one-liner starts the tool:</p>

    <div class="example example-none"><pre>          erl -pa ../examples -s et_demo</pre></div>

    <p>The filters are included by the following parameters:</p>

    <p></p>

<div class="example example-none"><pre>filters() -&gt;
    [{dict_insert, {filter, module_as_actor},
                   fun module_as_actor/1},
     {dict_insert, {filter, plain_process_info},
                   fun plain_process_info/1},
     {dict_insert, {filter, plain_process_info_nolink},
                   fun plain_process_info_nolink/1},
     {dict_insert, {filter, named_process_info},
                   fun named_process_info/1},
     {dict_insert, {filter, named_process_info_nolink},
                   fun named_process_info_nolink/1},
     {dict_insert, {filter, node_process_info},
                   fun node_process_info/1},
     {dict_insert, {filter, node_process_info_nolink},
                   fun node_process_info_nolink/1},
     {dict_insert, {filter, application_as_actor},
                   fun application_as_actor/1}
    ].</pre></div>
  

  <h3 id="erlang-trace-of-a-real-mnesia-transaction" class="title-link" onMouseOver="document.getElementById('ghlink-erlang-trace-of-a-real-mnesia-transaction-idm852').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-erlang-trace-of-a-real-mnesia-transaction-idm852').style.visibility = 'hidden';">
<div class="title-name">4.3 
        Erlang trace of a real Mnesia transaction</div>
<div class="title-anchors"><span id="ghlink-erlang-trace-of-a-real-mnesia-transaction-idm852" class="ghlink-after"><a href="#erlang-trace-of-a-real-mnesia-transaction" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/et/doc/src/et_examples.xmlsrc#L139" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    

    <p>The following piece of code <span class="code">et_demo:trace_mnesia/0</span>
    activates call tracing of both local and external function calls
    for all modules in the <span class="code">Mnesia</span> application. The call traces
    are configured cover all processes (both existing and those that
    are spawned in the future) and include timestamps for trace
    data. It do also activate tracing of process related events for
    <span class="code">Mnesia</span>'s static processes plus the calling process (that is
    your shell). Please, observe that the <span class="code">whereis/1</span> call in the
    following code requires that both the traced <span class="code">Mnesia</span>
    application and the <span class="code">et_viewer</span> is running on the same
    node:</p>

    <p></p>

<div class="example example-none"><pre>trace_mnesia() -&gt;
    Modules = mnesia:ms(),
    Spec = [{message, {caller}}, {return_trace}],
    Flags = [send, 'receive', procs, timestamp],
    dbg:p(all, [call, timestamp]),
    [dbg:tpl(M, [{'_', [], Spec}]) || M &lt;- Modules],
    LocallyRunningServers = [M || M &lt;- Modules, whereis(M) /= undefined],
    [dbg:p(whereis(RS), Flags) || RS &lt;- LocallyRunningServers],
    dbg:p(self(), Flags),
    LocallyRunningServers.</pre></div>
    <p>The <span class="code">et_demo:live_trans/0</span> function starts the global
    <span class="code">Collector</span>, starts a <span class="code">Viewer</span>, starts <span class="code">Mnesia</span>,
    creates a local table, activates tracing (as described above) and
    registers the shell process is as 'my_shell' for clarity. Finally
    a simple <span class="code">Mnesia</span> transaction that writes a single record
    is run:</p>

    <p></p>

<div class="example example-none"><pre>live_trans() -&gt;
    live_trans([]).

live_trans(ExtraOptions) -&gt;
    Options = [{title, "Mnesia tracer"},
	       {hide_actions, true},
	       {active_filter, named_process_info_nolink}],
    et_demo:start(Options ++ ExtraOptions),
    mnesia:start(),
    mnesia:create_table(my_tab, [{ram_copies, [node()]}]),
    et_demo:trace_mnesia(),
    register(my_shell, self()),

    mnesia:transaction(fun() -&gt; mnesia:write({my_tab, key, val}) end).</pre></div>
    <p>Now we run the <span class="code">et_demo:live_trans/0</span> function:</p>

    <p></p>

    <div class="example example-none"><pre>erl -pa ../examples
Erlang R13B03 (erts-5.7.4) [64-bit] [smp:4:4] [rq:4]
                           [async-threads:0] [kernel-poll:false]

Eshell V5.7.4  (abort with ^G)
1&gt; et_demo:live_trans().
{atomic,ok}</pre></div>

    <p>Please, explore the different filters in order to see how the traced
      transaction can be seen from different point of views:</p>

    <div class="doc-image-wrapper">
<img alt="IMAGE MISSING" src="live_trans.png" class="doc-image">
      <p class="doc-image-caption">Figure
        4.2:
         
        A real Mnesia transaction which writes one record</p>
    </div>

  

  <h3 id="erlang-trace-of-megaco-startup" class="title-link" onMouseOver="document.getElementById('ghlink-erlang-trace-of-megaco-startup-idm878').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-erlang-trace-of-megaco-startup-idm878').style.visibility = 'hidden';">
<div class="title-name">4.4 
        Erlang trace of Megaco startup</div>
<div class="title-anchors"><span id="ghlink-erlang-trace-of-megaco-startup-idm878" class="ghlink-after"><a href="#erlang-trace-of-megaco-startup" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/et/doc/src/et_examples.xmlsrc#L191" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    

    <p>The <span class="code">Event Tracer (ET)</span> tool was initially written in
    order to demonstrate how messages where sent over the
    <span class="code">Megaco</span> protocol. This were back in the old days before the
    standard bodies of <span class="code">IETF</span> and <span class="code">ITU</span> had approved
    <span class="code">Megaco</span> (also called <span class="code">H.248</span>) as an international
    standard.</p>

    <p>In the <span class="code">Megaco</span> application of Erlang/OTP, the code is
    carefully instrumented with calls to <span class="code">et:trace_me/5</span>. For
    each call a detail level is given in order to enable dynamic
    control of the trace level in a simple manner.</p>

    <p>The <span class="code">megaco_filter</span> module implements a customized filter
    for <span class="code">Megaco</span> messages. It does also make use of
    <span class="code">trace_global</span> combined with usage of the
    <span class="code">trace_pattern</span>:</p>

    <p></p>

    <div class="example example-none"><pre>-module(megaco_filter).
-export([start/0]).

start() -&gt;
    Options =
        [{event_order, event_ts},
         {scale, 3},
         {max_actors, infinity},
         {trace_pattern, {megaco, max}},
         {trace_global, true},
         {dict_insert, {filter, megaco_filter}, fun filter/1},
         {active_filter, megaco_filter},
         {title, "Megaco tracer - Erlang/OTP"}],
    et_viewer:start(Options).</pre></div>

    <p>First we start an Erlang node with a global <span class="code">Collector</span>
    and its <span class="code">Viewer</span>.</p>

    <p></p>

    <div class="example example-none"><pre>erl -sname observer
Erlang R13B03 (erts-5.7.4) [64-bit] [smp:4:4] [rq:4] [async-threads:0] [kernel-poll:false]

Eshell V5.7.4  (abort with ^G)
(observer@falco)1&gt; megaco_filter:start().
{ok,&lt;0.48.0&gt;}</pre></div>

    <p>Secondly we start another Erlang node which we connect the
    observer node, before we start the application that we want to
    trace. In this case we start a Media Gateway Controller that
    listens for both TCP and UDP on the text and binary ports for
    Megaco:</p>

    <p></p>

    <div class="example example-none"><pre>erl -sname mgc -pa ../../megaco/examples/simple
Erlang R13B03 (erts-5.7.4) [64-bit] [smp:4:4] [rq:4] [async-threads:0] [kernel-poll:false]

Eshell V5.7.4  (abort with ^G)
(mgc@falco)1&gt; net:ping(observer@falco).
pong
(mgc@falco)2&gt; megaco:start().
ok
(mgc@falco)3&gt; megaco_simple_mgc:start().
{ok,[{ok,2944,
         {megaco_receive_handle,{deviceName,"controller"},
                                megaco_pretty_text_encoder,[],megaco_tcp,dynamic}},
     {ok,2944,
         {megaco_receive_handle,{deviceName,"controller"},
                                megaco_pretty_text_encoder,[],megaco_udp,dynamic}},
     {ok,2945,
         {megaco_receive_handle,{deviceName,"controller"},
                                megaco_binary_encoder,[],megaco_tcp,dynamic}},
     {ok,2945,
         {megaco_receive_handle,{deviceName,"controller"},
                                megaco_binary_encoder,[],megaco_udp,dynamic}}]}</pre></div>

    <p>And finally we start an Erlang node for the Media Gateways and
    connect to the observer node. Each Media Gateway connects to the
    controller and sends an initial Service Change message. The
    controller accepts the gateways and sends a reply to each one
    using the same transport mechanism and message encoding according
    to the preference of each gateway. That is all combinations of
    TCP/IP transport, UDP/IP transport, text encoding and ASN.1 BER
    encoding:</p>

    <p></p>

    <div class="example example-none"><pre>Erlang R13B03 (erts-5.7.4) [64-bit] [smp:4:4] [rq:4] [async-threads:0] [kernel-poll:false]

Eshell V5.7.4  (abort with ^G)
(mg@falco)1&gt; net:ping(observer@falco).
pong
(mg@falco)2&gt; megaco_simple_mg:start().
[{{deviceName,"gateway_tt"},
  {error,{start_user,megaco_not_started}}},
 {{deviceName,"gateway_tb"},
  {error,{start_user,megaco_not_started}}},
 {{deviceName,"gateway_ut"},
  {error,{start_user,megaco_not_started}}},
 {{deviceName,"gateway_ub"},
  {error,{start_user,megaco_not_started}}}]
(mg@falco)3&gt; megaco:start().
ok
(mg@falco)4&gt; megaco_simple_mg:start().
[{{deviceName,"gateway_tt"},
  {1,
   {ok,[{'ActionReply',0,asn1_NOVALUE,asn1_NOVALUE,
            [{serviceChangeReply,
                 {'ServiceChangeReply',
                     [{megaco_term_id,false,["root"]}],
                     {serviceChangeResParms,
                         {'ServiceChangeResParm',
                             {deviceName,"controller"},
                             asn1_NOVALUE,asn1_NOVALUE,asn1_NOVALUE,
                             asn1_NOVALUE}}}}]}]}}},
 {{deviceName,"gateway_tb"},
  {1,
   {ok,[{'ActionReply',0,asn1_NOVALUE,asn1_NOVALUE,
            [{serviceChangeReply,
                 {'ServiceChangeReply',
                     [{megaco_term_id,false,["root"]}],
                     {serviceChangeResParms,
                         {'ServiceChangeResParm',
                             {deviceName,"controller"},
                             asn1_NOVALUE,asn1_NOVALUE,asn1_NOVALUE,
                             asn1_NOVALUE}}}}]}]}}},
 {{deviceName,"gateway_ut"},
  {1,
   {ok,[{'ActionReply',0,asn1_NOVALUE,asn1_NOVALUE,
            [{serviceChangeReply,
                 {'ServiceChangeReply',
                     [{megaco_term_id,false,["root"]}],
                     {serviceChangeResParms,
                         {'ServiceChangeResParm',
                             {deviceName,"controller"},
                             asn1_NOVALUE,asn1_NOVALUE,asn1_NOVALUE,
                             asn1_NOVALUE}}}}]}]}}},
 {{deviceName,"gateway_ub"},
  {1,
   {ok,[{'ActionReply',0,asn1_NOVALUE,asn1_NOVALUE,
            [{serviceChangeReply,
                 {'ServiceChangeReply',
                     [{megaco_term_id,false,["root"]}],
                     {serviceChangeResParms,
                         {'ServiceChangeResParm',
                             {deviceName,"controller"},
                             asn1_NOVALUE,asn1_NOVALUE,
                             asn1_NOVALUE,...}}}}]}]}}}]</pre></div>

    <p>The <span class="code">Megaco</span> adopted viewer looks like this, when we have clicked
    on the <strong>[gateway_tt]</strong> actor name in order to only display the events
    regarding that actor:</p>
    
    <div class="doc-image-wrapper">
<img alt="IMAGE MISSING" src="megaco_tracer.png" class="doc-image">
      <p class="doc-image-caption">Figure
        4.3:
         
        The viewer adopted for Megaco</p>
    </div>

    <p>A pretty printed <span class="code">Megaco</span> message looks like this:</p>

    <div class="doc-image-wrapper">
<img alt="IMAGE MISSING" src="megaco_filter.png" class="doc-image">
      <p class="doc-image-caption">Figure
        4.4:
         
        A textual Megaco message</p>
    </div>

    <p>And the corresponding internal form for the same <span class="code">Megaco</span> message
    looks like this:</p>

    <div class="doc-image-wrapper">
<img alt="IMAGE MISSING" src="megaco_collector.png" class="doc-image">
      <p class="doc-image-caption">Figure
        4.5:
         
        The internal form of a Megaco message</p>
    </div>

  

</div>
<div class="footer">
<hr>
<p>Copyright © 2002-2021 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script type="text/javascript">window.__otpTopDocDir = '../../js/';</script><script type="text/javascript" src="../../js/highlight.js"></script>
<script src="/assets/js/doc-search.bundle.js"></script>
</body>
</html>
