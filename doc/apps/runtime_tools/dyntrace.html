<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.1">
    <meta name="project" content="runtime_tools v2.3">


<meta name="major-vsn" content="28">
<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=28&q=">
<link rel="canonical" href="https://www.erlang.org/doc/apps/runtime_tools/dyntrace.html" />
    <title>dyntrace — runtime_tools v2.3</title>

    <link rel="stylesheet" href="dist/html-erlang-ZK43ZOAC.css" />

    <script defer src="dist/sidebar_items-DFA571A8.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="runtime_tools" />
        </a>

      <div>
        <a href="../../index.html" class="sidebar-projectName" translate="no">
runtime_tools
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v2.3
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-module" id="main" data-type="modules">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of runtime_tools</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>
      <span translate="no">dyntrace</span> 
      <small class="app-vsn" translate="no">(runtime_tools v2.3)</small>

    </h1>

      <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L23" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


    <section id="moduledoc">
<p>Interface to dynamic tracing</p><p>This module implements interfaces to dynamic tracing, should such be compiled
into the virtual machine. For a standard and/or commercial build, no dynamic
tracing is available, in which case none of the functions in this module is
usable or give any effect.</p><p>Should dynamic tracing be enabled in the current build, either by configuring
with <code class="inline">./configure --with-dynamic-trace=dtrace</code> or with
<code class="inline">./configure --with-dynamic-trace=systemtap</code>, the module can be used for two
things:</p><ul><li>Trigger the user-probe <code class="inline">user_trace_i4s4</code> in the NIF library <code class="inline">dyntrace.so</code> by
calling <code class="inline">dyntrace:p/{1,2,3,4,5,6,7,8}</code>.</li><li>Set a user specified tag that will be present in the trace messages of both
the <code class="inline">efile_drv</code> and the user-probe mentioned above.</li></ul><p>Both building with dynamic trace probes and using them is experimental and
unsupported by Erlang/OTP. It is included as an option for the developer to
trace and debug performance issues in their systems.</p><p>The original implementation is mostly done by Scott Lystiger Fritchie as an Open
Source Contribution and it should be viewed as such even though the source for
dynamic tracing as well as this module is included in the main distribution.
However, the ability to use dynamic tracing of the virtual machine is a very
valuable contribution which OTP has every intention to maintain as a tool for
the developer.</p><p>How to write <code class="inline">d</code> programs or <code class="inline">systemtap</code> scripts can be learned from books and
from a lot of pages on the Internet. This manual page does not include any
documentation about using the dynamic trace tools of respective platform.
However, the <code class="inline">examples</code> directory of the <code class="inline">runtime_tools</code> application contains
comprehensive examples of both <code class="inline">d</code> and <code class="inline">systemtap</code> programs that will help you
get started. Another source of information is the <a href="dtrace.html">dtrace</a> and
<a href="systemtap.html">systemtap</a> chapters in the Runtime Tools Users' Guide.</p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:probe_arg/0" data-no-tooltip="" translate="no">probe_arg()</a>

      </div>

    </div>

</div>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#available/0" data-no-tooltip="" translate="no">available()</a>

      </div>

        <div class="summary-synopsis"><p>This function uses the NIF library to determine if dynamic tracing is available.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_tag/0" data-no-tooltip="" translate="no">get_tag()</a>

      </div>

        <div class="summary-synopsis"><p>This function returns the user tag set in the current process. If no tag is set
or dynamic tracing is not available, it returns <code class="inline">undefined</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#p/0" data-no-tooltip="" translate="no">p()</a>

      </div>

        <div class="summary-synopsis"><p>Calling this function triggers the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing only the user tag and
zeroes/empty strings in all other fields.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#p/1" data-no-tooltip="" translate="no">p(Arg)</a>

      </div>

        <div class="summary-synopsis"><p>Calling this function will trigger the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
<code class="inline">dyntrace</code> NIF module, sending a trace message containing the user tag and the
integer or string parameter in the first integer/string field.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#p/2" data-no-tooltip="" translate="no">p(Arg1, Arg2)</a>

      </div>

        <div class="summary-synopsis"><p>Calling this function will trigger the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing the user tag and the
<a><code class="inline">integer()</code></a> or <a><code class="inline">string()</code></a> parameters as the
first fields of their respective type.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#p/3" data-no-tooltip="" translate="no">p(Arg1, Arg2, Arg3)</a>

      </div>

        <div class="summary-synopsis"><p>Calling this function will trigger the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing the user tag and the
<a><code class="inline">integer()</code></a> or <a><code class="inline">string()</code></a> parameters as the
first fields of their respective type.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#p/4" data-no-tooltip="" translate="no">p(Arg1, Arg2, Arg3, Arg4)</a>

      </div>

        <div class="summary-synopsis"><p>Calling this function will trigger the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing the user tag and the
<a><code class="inline">integer()</code></a> or <a><code class="inline">string()</code></a> parameters as the
first fields of their respective type.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#p/5" data-no-tooltip="" translate="no">p(Int, Arg1, Arg2, Arg3, String)</a>

      </div>

        <div class="summary-synopsis"><p>Calling this function will trigger the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing the user tag and the
<a><code class="inline">integer()</code></a> or <a><code class="inline">string()</code></a> parameters as the
first fields of their respective type.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#p/6" data-no-tooltip="" translate="no">p(Int1, Int2, Arg1, Arg2, String1, String2)</a>

      </div>

        <div class="summary-synopsis"><p>Calling this function will trigger the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing the user tag and the
<a><code class="inline">integer()</code></a> or <a><code class="inline">string()</code></a> parameters as the
first fields of their respective type.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#p/7" data-no-tooltip="" translate="no">p(Int1, Int2, Int3, Arg, String1, String2, String4)</a>

      </div>

        <div class="summary-synopsis"><p>Calling this function will trigger the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing the user tag and the
<a><code class="inline">integer()</code></a> or <a><code class="inline">string()</code></a> parameters as the
first fields of their respective type.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#p/8" data-no-tooltip="" translate="no">p(Int1, Int2, Int3, Int4, String1, String2, String3, String4)</a>

      </div>

        <div class="summary-synopsis"><p>Calling this function will trigger the &quot;user&quot; trace <code class="inline">probe user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing all the
<a><code class="inline">integer()</code></a> and <a><code class="inline">string()</code></a> parameters
provided, as well as any user tag set in the current process.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#put_tag/1" data-no-tooltip="" translate="no">put_tag(Item)</a>

      </div>

        <div class="summary-synopsis"><p>This function sets the user tag of the current process.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#restore_tag/1" data-no-tooltip="" translate="no">restore_tag(TagData)</a>

      </div>

        <div class="summary-synopsis"><p>Restores the previous state of user tags and their spreading as it was before a
call to <a><code class="inline">spread_tag/1</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#spread_tag/1" data-no-tooltip="" translate="no">spread_tag(boolean())</a>

      </div>

        <div class="summary-synopsis"><p>This function controls if user tags are to be spread to other processes with the
next message.</p></div>

    </div>

</div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Types</span>
    </h1>
    <div class="types-list">
<section class="detail" id="t:probe_arg/0">

  <div class="detail-header">
    <a href="#t:probe_arg/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">probe_arg()</h1>

        <span class="note">(not exported)</span>

        <span class="note">(since OTP R15B01)</span>


        <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L140" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> probe_arg() :: <a href="../../apps/erts/erlang.html#t:integer/0">integer</a>() | <a href="../../apps/erts/erlang.html#t:iolist/0">iolist</a>().</pre>

      </div>


  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="available/0">

  <div class="detail-header">
    <a href="#available/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">available()</h1>

        <span class="note">(since OTP R15B01)</span>


        <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L210" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> available() -> true | false.</pre>

      </div>

<p>This function uses the NIF library to determine if dynamic tracing is available.</p><p>This function will throw an exception if the <code class="inline">dyntrace</code> NIF library could not be
loaded by the <code class="inline">on_load</code> function in this module.</p><p>Use <a href="../../apps/erts/erlang.html#system_info_dynamic_trace"><code class="inline">erlang:system_info(dynamic_trace)</code></a>
to determine whether the run-time system supports dynamic tracing.</p>
  </section>
</section>
<section class="detail" id="get_tag/0">

  <div class="detail-header">
    <a href="#get_tag/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_tag()</h1>

        <span class="note">(since OTP R15B01)</span>


        <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L677" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> get_tag() -> <a href="../../apps/erts/erlang.html#t:binary/0">binary</a>() | undefined.</pre>

      </div>

<p>This function returns the user tag set in the current process. If no tag is set
or dynamic tracing is not available, it returns <code class="inline">undefined</code>.</p><p>This function returns the user tag set in the current process or, if no user tag
is present, the last user tag sent to the process together with a message (in
the same way as <a href="../../apps/kernel/seq_trace.html">sequential trace tokens</a> are spread to other
processes together with messages. For an explanation of how user tags can be
spread together with messages, see <a href="#spread_tag/1"><code class="inline">spread_tag/1</code></a>. If no tag is found or dynamic
tracing is not available, it returns <code class="inline">undefined</code></p>
  </section>
</section>
<section class="detail" id="p/0">

  <div class="detail-header">
    <a href="#p/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">p()</h1>

        <span class="note">(since OTP R15B01)</span>


        <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L324" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> p() -> true | false | error | badarg.</pre>

      </div>

<p>Calling this function triggers the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing only the user tag and
zeroes/empty strings in all other fields.</p>
  </section>
</section>
<section class="detail" id="p/1">

  <div class="detail-header">
    <a href="#p/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">p(Arg)</h1>

        <span class="note">(since OTP R15B01)</span>


        <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L337" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> p(<a href="#t:probe_arg/0">probe_arg</a>()) -> true | false | error | badarg.</pre>

      </div>

<p>Calling this function will trigger the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
<code class="inline">dyntrace</code> NIF module, sending a trace message containing the user tag and the
integer or string parameter in the first integer/string field.</p>
  </section>
</section>
<section class="detail" id="p/2">

  <div class="detail-header">
    <a href="#p/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">p(Arg1, Arg2)</h1>

        <span class="note">(since OTP R15B01)</span>


        <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L368" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> p(<a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>()) -> true | false | error | badarg.</pre>

      </div>

<p>Calling this function will trigger the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing the user tag and the
<a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> or <a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a> parameters as the
first fields of their respective type.</p><p><a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> parameters should be put before any
<a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a> parameters.</p><p>That is, the following calls work:</p><ul><li><a href="#p/2"><code class="inline">dyntrace:p(1, &quot;Hello&quot;)</code></a></li><li><a href="#p/2"><code class="inline">dyntrace:p(1, 1)</code></a></li><li><a href="#p/2"><code class="inline">dyntrace:p(&quot;Hello&quot;, &quot;Again&quot;)</code></a></li></ul><p>The following call is invalid because the string argument comes before the
integer argument:</p><ul><li><a href="#p/2"><code class="inline">dyntrace:p(&quot;Hello&quot;, 1)</code></a></li></ul>
  </section>
</section>
<section class="detail" id="p/3">

  <div class="detail-header">
    <a href="#p/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">p(Arg1, Arg2, Arg3)</h1>

        <span class="note">(since OTP R15B01)</span>


        <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L389" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> p(<a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>()) -> true | false | error | badarg.</pre>

      </div>

<p>Calling this function will trigger the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing the user tag and the
<a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> or <a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a> parameters as the
first fields of their respective type.</p><p><a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> parameters should be put before any
<a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a> parameters.</p>
  </section>
</section>
<section class="detail" id="p/4">

  <div class="detail-header">
    <a href="#p/4" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">p(Arg1, Arg2, Arg3, Arg4)</h1>

        <span class="note">(since OTP R15B01)</span>


        <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L413" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> p(<a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>()) -> true | false | error | badarg.</pre>

      </div>

<p>Calling this function will trigger the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing the user tag and the
<a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> or <a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a> parameters as the
first fields of their respective type.</p><p><a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> parameters should be put before any
<a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a> parameters.</p>
  </section>
</section>
<section class="detail" id="p/5">

  <div class="detail-header">
    <a href="#p/5" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">p(Int, Arg1, Arg2, Arg3, String)</h1>

        <span class="note">(since OTP R15B01)</span>


        <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L444" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> p(<a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>()) ->
           true | false | error | badarg.</pre>

      </div>

<p>Calling this function will trigger the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing the user tag and the
<a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> or <a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a> parameters as the
first fields of their respective type.</p><p><a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> parameters should be put before any
<a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a> parameters.</p><p>There can be no more than four parameters of each type,
so the first parameter must be of type <a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> and
the last parameter of type <a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a>.</p>
  </section>
</section>
<section class="detail" id="p/6">

  <div class="detail-header">
    <a href="#p/6" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">p(Int1, Int2, Arg1, Arg2, String1, String2)</h1>

        <span class="note">(since OTP R15B01)</span>


        <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L473" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> p(<a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>()) ->
           true | false | error | badarg.</pre>

      </div>

<p>Calling this function will trigger the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing the user tag and the
<a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> or <a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a> parameters as the
first fields of their respective type.</p><p><a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> parameters should be put before any
<a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a> parameters.</p><p>There can be no more than four parameters of each type,
so the first two parameters must be of type <a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> and
the last two of type <a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a>.</p>
  </section>
</section>
<section class="detail" id="p/7">

  <div class="detail-header">
    <a href="#p/7" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">p(Int1, Int2, Int3, Arg, String1, String2, String4)</h1>

        <span class="note">(since OTP R15B01)</span>


        <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L500" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> p(<a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>(), <a href="#t:probe_arg/0">probe_arg</a>()) ->
           true | false | error | badarg.</pre>

      </div>

<p>Calling this function will trigger the &quot;user&quot; trace probe <code class="inline">user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing the user tag and the
<a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> or <a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a> parameters as the
first fields of their respective type.</p><p><a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> parameters should be put before any
<a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a> parameters.</p><p>There can be no more than four parameters of each type,
so the first three parameters must be of type <a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> and
the last three of type <a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a>.</p>
  </section>
</section>
<section class="detail" id="p/8">

  <div class="detail-header">
    <a href="#p/8" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">p(Int1, Int2, Int3, Int4, String1, String2, String3, String4)</h1>

        <span class="note">(since OTP R15B01)</span>


        <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L518" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> p(<a href="#t:probe_arg/0">probe_arg</a>(),
        <a href="#t:probe_arg/0">probe_arg</a>(),
        <a href="#t:probe_arg/0">probe_arg</a>(),
        <a href="#t:probe_arg/0">probe_arg</a>(),
        <a href="#t:probe_arg/0">probe_arg</a>(),
        <a href="#t:probe_arg/0">probe_arg</a>(),
        <a href="#t:probe_arg/0">probe_arg</a>(),
        <a href="#t:probe_arg/0">probe_arg</a>()) ->
           true | false | error | badarg.</pre>

      </div>

<p>Calling this function will trigger the &quot;user&quot; trace <code class="inline">probe user_trace_i4s4</code> in the
dyntrace NIF module, sending a trace message containing all the
<a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer()</code></a> and <a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string()</code></a> parameters
provided, as well as any user tag set in the current process.</p>
  </section>
</section>
<section class="detail" id="put_tag/1">

  <div class="detail-header">
    <a href="#put_tag/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">put_tag(Item)</h1>

        <span class="note">(since OTP R15B01)</span>


        <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L661" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> put_tag(undefined | <a href="../../apps/erts/erlang.html#t:iodata/0">iodata</a>()) -> <a href="../../apps/erts/erlang.html#t:binary/0">binary</a>() | undefined.</pre>

      </div>

<p>This function sets the user tag of the current process.</p><p>The user tag is a <a href="../../apps/erts/erlang.html#t:binary/0"><code class="inline">binary()</code></a>, but can be specified as
any <a href="../../apps/erts/erlang.html#t:iodata/0"><code class="inline">iodata()</code></a>, which is automatically converted to a
binary by this function.</p><p>The user tag is provided to the user probes triggered by calls top
<code class="inline">dyntrace:p/{1,2,3,4,5,6,7,8}</code> as well as probes in the <code class="inline">efile</code> driver. In the
future, user tags might be added to more probes.</p><p>The old user tag (if any) is returned, or <code class="inline">undefined</code> if no user tag was present,
or dynamic tracing is not enabled.</p>
  </section>
</section>
<section class="detail" id="restore_tag/1">

  <div class="detail-header">
    <a href="#restore_tag/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">restore_tag(TagData)</h1>

        <span class="note">(since OTP R15B01)</span>


        <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L760" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> restore_tag(true | {<a href="../../apps/erts/erlang.html#t:non_neg_integer/0">non_neg_integer</a>(), <a href="../../apps/erts/erlang.html#t:binary/0">binary</a>() | []}) -> true.</pre>

      </div>

<p>Restores the previous state of user tags and their spreading as it was before a
call to <a href="#spread_tag/1"><code class="inline">spread_tag/1</code></a>.</p><p>Note that the restoring is not limited to the same process; one can
utilize this to turn off spreding in one process and restore it in a
newly created process that is is actually going to send messages:</p><pre><code class="makeup erlang" translate="no"><span class="nf">f</span><span class="p" data-group-id="8581143311-1">(</span><span class="p" data-group-id="8581143311-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">TagData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">dyntrace</span><span class="p">:</span><span class="nf">spread_tag</span><span class="p" data-group-id="8581143311-2">(</span><span class="ss">false</span><span class="p" data-group-id="8581143311-2">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">spawn</span><span class="p" data-group-id="8581143311-3">(</span><span class="nf">fun</span><span class="p" data-group-id="8581143311-4">(</span><span class="p" data-group-id="8581143311-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
             </span><span class="nc">dyntrace</span><span class="p">:</span><span class="nf">restore_tag</span><span class="p" data-group-id="8581143311-5">(</span><span class="n">TagData</span><span class="p" data-group-id="8581143311-5">)</span><span class="p">,</span><span class="w">
             </span><span class="nf">do_something</span><span class="p" data-group-id="8581143311-6">(</span><span class="p" data-group-id="8581143311-6">)</span><span class="w">
          </span><span class="k">end</span><span class="p" data-group-id="8581143311-3">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_something_else</span><span class="p" data-group-id="8581143311-7">(</span><span class="p" data-group-id="8581143311-7">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">dyntrace</span><span class="p">:</span><span class="nf">restore_tag</span><span class="p" data-group-id="8581143311-8">(</span><span class="n">TagData</span><span class="p" data-group-id="8581143311-8">)</span><span class="p">.</span></code></pre><p>Correctly handling user tags and their spreading might take some effort, as
Erlang programs tend to send and receive messages so that sometimes the user tag
gets lost due to various things, like double receives or communication with a
port (ports do not handle user tags, in the same way as they do not handle
regular sequential trace tokens).</p>
  </section>
</section>
<section class="detail" id="spread_tag/1">

  <div class="detail-header">
    <a href="#spread_tag/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">spread_tag(boolean())</h1>

        <span class="note">(since OTP R15B01)</span>


        <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/src/dyntrace.erl#L728" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> spread_tag(<a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()) -> true | {<a href="../../apps/erts/erlang.html#t:non_neg_integer/0">non_neg_integer</a>(), <a href="../../apps/erts/erlang.html#t:binary/0">binary</a>() | []}.</pre>

      </div>

<p>This function controls if user tags are to be spread to other processes with the
next message.</p><p>Spreading of user tags work like spreading of sequential trace
tokens, so that a received user tag will be active in the process until the next
message arrives (if that message does not also contain the user tag).</p><p>This functionality is used when a client process communicates with a file
i/o-server to spread the user tag to the I/O-server and then down to the
<code class="inline">efile</code> driver. By using <a href="#spread_tag/1"><code class="inline">spread_tag/1</code></a> and
<a href="#restore_tag/1"><code class="inline">restore_tag/1</code></a>, one can enable or disable spreading of user
tags to other processes and then restore the previous state of the user tag. The
TagData returned from this call contains all previous information so the state
(including any previously spread user tags) will be completely restored by a
later call to <a href="#restore_tag/1"><code class="inline">restore_tag/1</code></a>.</p><p>The <a href="../../apps/kernel/file.html"><code class="inline">file</code></a> module already spreads tags, so there is no need to manually call
this function to get user tags spread to the <code class="inline">efile</code> driver through that module.</p><p>The most use of this function would be if one, for example, uses the <a href="../../apps/stdlib/io.html"><code class="inline">io</code></a> module
to communicate with an I/O-server for a regular file, such as in the following
example:</p><pre><code class="makeup erlang" translate="no"><span class="nf">f</span><span class="p" data-group-id="9287497775-1">(</span><span class="p" data-group-id="9287497775-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
   </span><span class="p" data-group-id="9287497775-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9287497775-2">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">file</span><span class="p">:</span><span class="nf">open</span><span class="p" data-group-id="9287497775-3">(</span><span class="s">&quot;test.tst&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9287497775-4">[</span><span class="ss">write</span><span class="p" data-group-id="9287497775-4">]</span><span class="p" data-group-id="9287497775-3">)</span><span class="p">,</span><span class="w">
   </span><span class="n">Saved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">dyntrace</span><span class="p">:</span><span class="nf">spread_tag</span><span class="p" data-group-id="9287497775-5">(</span><span class="ss">true</span><span class="p" data-group-id="9287497775-5">)</span><span class="p">,</span><span class="w">
   </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9287497775-6">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello world!&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9287497775-7">[</span><span class="p" data-group-id="9287497775-7">]</span><span class="p" data-group-id="9287497775-6">)</span><span class="p">,</span><span class="w">
   </span><span class="nc">dyntrace</span><span class="p">:</span><span class="nf">restore_tag</span><span class="p" data-group-id="9287497775-8">(</span><span class="n">Saved</span><span class="p" data-group-id="9287497775-8">)</span><span class="p">,</span><span class="w">
   </span><span class="nc">file</span><span class="p">:</span><span class="nf">close</span><span class="p" data-group-id="9287497775-9">(</span><span class="n">F</span><span class="p" data-group-id="9287497775-9">)</span><span class="p">.</span></code></pre><p>In this example, any user tag set in the calling process will be spread to the
I/O-server when the <a href="../../apps/stdlib/io.html#format/3"><code class="inline">io:format/3</code></a> call is done.</p>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="runtime_tools.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright © 1996-2025 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js"></script>
  <script>
  let initialized = false;

  window.addEventListener("exdoc:loaded", () => {
      if (!initialized) {
      mermaid.initialize({
          startOnLoad: false,
          theme: document.body.className.includes("dark") ? "dark" : "default"
      });
      initialized = true;
      }

      let id = 0;
      for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
          graphEl.innerHTML = svg;
          bindFunctions?.(graphEl);
          preEl.insertAdjacentElement("afterend", graphEl);
          preEl.remove();
      });
      }
  });
  </script>

  </body>
</html>
