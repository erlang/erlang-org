<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.1">
    <meta name="project" content="runtime_tools v2.3">


<meta name="major-vsn" content="28">
<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=28&q=">
<link rel="canonical" href="https://www.erlang.org/doc/apps/runtime_tools/dbg_guide.html" />
    <title>Tracing in Erlang with dbg â€” runtime_tools v2.3</title>

    <link rel="stylesheet" href="dist/html-erlang-ZK43ZOAC.css" />

    <script defer src="dist/sidebar_items-DFA571A8.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="runtime_tools" />
        </a>

      <div>
        <a href="../../index.html" class="sidebar-projectName" translate="no">
runtime_tools
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v2.3
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of runtime_tools</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>Tracing in Erlang with <strong>dbg</strong></h1>


      <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/runtime_tools/doc/guides/dbg_guide.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<p>The <a href="dbg.html"><code class="inline">dbg</code></a> module in Erlang provides a text-based interface for tracing function calls, processes, ports, and messages. It simplifies the use of the underlying <a href="../../apps/kernel/trace.html#process/4"><code class="inline">trace:process/4</code></a>, <a href="../../apps/kernel/trace.html#port/4"><code class="inline">trace:port/4</code></a>, and <a href="../../apps/kernel/trace.html#function/4"><code class="inline">trace:function/4</code></a> BIFs (Built-In Functions). This guide will walk you through the basics of using <code class="inline">dbg</code> for your Erlang applications.</p><p>This facility is useful for both quick debugging sessions in the shell and for more structured system testing, especially where other tools might have too much performance impact.</p><h2 id="quick-start" class="section-heading"><a href="#quick-start" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Quick Start</span></h2><p>To trace a call to a function with minimal fuss, call <a href="dbg.html#c/3"><code class="inline">dbg:c(Module, Name, Arguments)</code></a>. It starts a temporary trace
receiver, enables all trace flags, and calls the designated function
from a temporary process. For example, here is how to trace a call
to <a href="../../apps/kernel/application.html#which_applications/0"><code class="inline">application:which_applications/0</code></a>:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">c</span><span class="p" data-group-id="2142097249-1">(</span><span class="ss">application</span><span class="p">,</span><span class="w"> </span><span class="ss">which_applications</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2142097249-2">[</span><span class="p" data-group-id="2142097249-2">]</span><span class="p" data-group-id="2142097249-1">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="2142097249-3">(</span><span class="o">&lt;</span><span class="mf">0.92</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="2142097249-3">)</span><span class="w"> </span><span class="o">&lt;</span><span class="mf">0.45</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="2142097249-4">{</span><span class="ss">&#39;$gen_call&#39;</span><span class="p">,</span><span class="p" data-group-id="2142097249-5">{</span><span class="o">&lt;</span><span class="mf">0.92</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
                                    </span><span class="p" data-group-id="2142097249-6">[</span><span class="ss">alias</span><span class="p">|</span><span class="w">
                                     </span><span class="p">#</span><span class="n">Ref</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">.</span><span class="mf">11779.270031856</span><span class="p">.</span><span class="mf">1478295555.230456</span><span class="o">&gt;</span><span class="p" data-group-id="2142097249-6">]</span><span class="p" data-group-id="2142097249-5">}</span><span class="p">,</span><span class="w">
                                   </span><span class="ss">which_applications</span><span class="p" data-group-id="2142097249-4">}</span><span class="w"> </span><span class="p" data-group-id="2142097249-7">(</span><span class="n">Timestamp</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2142097249-8">{</span><span class="mi">1710</span><span class="p">,</span><span class="w">
                                                                    </span><span class="mi">847802</span><span class="p">,</span><span class="w">
                                                                    </span><span class="mi">479222</span><span class="p" data-group-id="2142097249-8">}</span><span class="p" data-group-id="2142097249-7">)</span><span class="w">
</span><span class="p" data-group-id="2142097249-9">(</span><span class="o">&lt;</span><span class="mf">0.92</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="2142097249-9">)</span><span class="w"> </span><span class="ss">out</span><span class="w"> </span><span class="p" data-group-id="2142097249-10">{</span><span class="ss">gen</span><span class="p">,</span><span class="ss">do_call</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="2142097249-10">}</span><span class="w"> </span><span class="p" data-group-id="2142097249-11">(</span><span class="n">Timestamp</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2142097249-12">{</span><span class="mi">1710</span><span class="p">,</span><span class="mi">847802</span><span class="p">,</span><span class="mi">479231</span><span class="p" data-group-id="2142097249-12">}</span><span class="p" data-group-id="2142097249-11">)</span><span class="w">
</span><span class="p" data-group-id="2142097249-13">(</span><span class="o">&lt;</span><span class="mf">0.92</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="2142097249-13">)</span><span class="w"> </span><span class="ss">in</span><span class="w"> </span><span class="p" data-group-id="2142097249-14">{</span><span class="ss">gen</span><span class="p">,</span><span class="ss">do_call</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="2142097249-14">}</span><span class="w"> </span><span class="p" data-group-id="2142097249-15">(</span><span class="n">Timestamp</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2142097249-16">{</span><span class="mi">1710</span><span class="p">,</span><span class="mi">847802</span><span class="p">,</span><span class="mi">479271</span><span class="p" data-group-id="2142097249-16">}</span><span class="p" data-group-id="2142097249-15">)</span><span class="w">
</span><span class="p" data-group-id="2142097249-17">(</span><span class="o">&lt;</span><span class="mf">0.92</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="2142097249-17">)</span><span class="w"> </span><span class="p" data-group-id="2142097249-18">&lt;&lt;</span><span class="w"> </span><span class="p" data-group-id="2142097249-19">{</span><span class="p" data-group-id="2142097249-20">[</span><span class="ss">alias</span><span class="p">|</span><span class="p">#</span><span class="n">Ref</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">.</span><span class="mf">11779.270031856</span><span class="p">.</span><span class="mf">1478295555.230456</span><span class="o">&gt;</span><span class="p" data-group-id="2142097249-20">]</span><span class="p">,</span><span class="w">
               </span><span class="p" data-group-id="2142097249-21">[</span><span class="p" data-group-id="2142097249-22">{</span><span class="ss">stdlib</span><span class="p">,</span><span class="s">&quot;ERTS  CXC 138 10&quot;</span><span class="p">,</span><span class="s">&quot;5.2.1&quot;</span><span class="p" data-group-id="2142097249-22">}</span><span class="p">,</span><span class="w">
                </span><span class="p" data-group-id="2142097249-23">{</span><span class="ss">kernel</span><span class="p">,</span><span class="s">&quot;ERTS  CXC 138 10&quot;</span><span class="p">,</span><span class="s">&quot;9.2.2&quot;</span><span class="p" data-group-id="2142097249-23">}</span><span class="p" data-group-id="2142097249-21">]</span><span class="p" data-group-id="2142097249-19">}</span><span class="w"> </span><span class="p" data-group-id="2142097249-24">(</span><span class="n">Timestamp</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2142097249-25">{</span><span class="mi">1710</span><span class="p">,</span><span class="w">
                                                                   </span><span class="mi">847802</span><span class="p">,</span><span class="w">
                                                                   </span><span class="mi">479274</span><span class="p" data-group-id="2142097249-25">}</span><span class="p" data-group-id="2142097249-24">)</span><span class="w">
</span><span class="p" data-group-id="2142097249-26">[</span><span class="p" data-group-id="2142097249-27">{</span><span class="ss">stdlib</span><span class="p">,</span><span class="s">&quot;ERTS  CXC 138 10&quot;</span><span class="p">,</span><span class="s">&quot;5.2.1&quot;</span><span class="p" data-group-id="2142097249-27">}</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="2142097249-28">{</span><span class="ss">kernel</span><span class="p">,</span><span class="s">&quot;ERTS  CXC 138 10&quot;</span><span class="p">,</span><span class="s">&quot;9.2.2&quot;</span><span class="p" data-group-id="2142097249-28">}</span><span class="p" data-group-id="2142097249-26">]</span></code></pre><p>In this example, four trace events are generated:</p><ul><li>A send event (<code class="inline">!</code>) for the sending of a request from the current process
to the <code class="inline">application_controller</code> process.</li><li>A schedule-out event (<code class="inline">out</code>) when the current process schedules out while
waiting in a <code class="inline">receive</code> for the reply to arrive.</li><li>A schedule-in event (<code class="inline">in</code>) when the current process is scheduled in when
reply has arrived.</li><li>A <code class="inline">receive</code> event (<code class="inline">&lt;&lt;</code>) when the current process retrieves the reply from
the <code class="inline">application_controller</code> process.</li></ul><p>The <a href="dbg.html#c/4"><code class="inline">dbg:c/4</code></a> function has a fourth argument for specifying the trace flags,
(see <a href="#flags">flags</a>).</p><h2 id="how-to-trace-systems" class="section-heading"><a href="#how-to-trace-systems" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">How-to Trace Systems</span></h2><p>For more control, another way of tracing is to explicitly start a
<em>tracer</em> and set the <em>trace flags</em> of your choice on the processes you want to
trace. This is useful, when there is a complex system of processes, ports or nodes
interacting where <a href="dbg.html#c/3"><code class="inline">dbg:c/3</code></a> is to blunt.</p><h3 id="starting-a-tracer-dbg-tracer-0-2" class="section-heading"><a href="#starting-a-tracer-dbg-tracer-0-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Starting a Tracer (<a href="dbg.html#tracer/2"><code class="inline">dbg:tracer/0,2</code></a>)</span></h3><p>First, you need to start a tracer process that will receive and display trace
messages.</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tracer</span><span class="p" data-group-id="4364654719-1">(</span><span class="p" data-group-id="4364654719-1">)</span><span class="p">.</span><span class="w">  </span><span class="c1">% Start the default trace message receiver</span><span class="w">
</span><span class="p" data-group-id="4364654719-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.90</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="4364654719-2">}</span><span class="w">     </span><span class="c1">% &lt;0.90.0&gt; is the PID of the tracer process</span></code></pre><p>This starts a server on the local node that will be the recipient of all trace
messages. It uses a default handler that prints formatted trace messages to the
Erlang shell.</p><p>If you need a custom tracer other than the default, you can create a tracer using
<a href="dbg.html#tracer/2"><code class="inline">dbg:tracer(Type, Data)</code></a>:</p><ul><li><strong><code class="inline">Type = process</code></strong>: <code class="inline">Data</code> is <code class="inline">{HandlerFun, InitialState}</code>. <code class="inline">HandlerFun</code> is
a <code class="inline">fun/2</code> that takes the trace message and the previous state, returning a new
state.</li><li><strong><code class="inline">Type = port</code></strong>: <code class="inline">Data</code> is a <code class="inline">fun/0</code> that returns a new trace port (e.g.,
created by <a href="dbg.html#trace_port/2"><code class="inline">dbg:trace_port/2</code></a>).</li><li><strong><code class="inline">Type = module</code></strong>: <code class="inline">Data</code> is <code class="inline">{TracerModule, TracerState}</code> or a <code class="inline">fun/0</code>
returning this, for use with <a href="../../apps/erts/erl_tracer.html"><code class="inline">erl_tracer</code></a>.</li><li><strong><code class="inline">Type = file</code></strong>: <code class="inline">Data</code> is a filename where traces will be printed.</li></ul><p>Note that only one tracer using this method can be started at a time. You can
use trace sessions to start multiple tracers (see <a href="#trace-sessions">trace sessions</a>).</p><h3 id="tracing-processes-and-ports-dbg-p-1-2" class="section-heading"><a href="#tracing-processes-and-ports-dbg-p-1-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Tracing Processes and Ports (<a href="dbg.html#p/2"><code class="inline">dbg:p/1,2</code></a>)</span></h3><p>Once the tracer is started, you can tell <code class="inline">dbg</code> which processes or ports to trace
and what events to trace for them using <a href="dbg.html#p/2"><code class="inline">dbg:p(Item, Flags)</code></a>.</p><p><code class="inline">Item</code> can be:</p><ul><li><p><strong><a href="../../apps/erts/erlang.html#t:pid/0"><code class="inline">pid/0</code></a> or <a href="../../apps/erts/erlang.html#t:port/0"><code class="inline">port/0</code></a></strong> - The corresponding process or port is traced. The
process or port can be a remote process or port (on another Erlang node). The
node must be in the list of traced nodes (see <a href="dbg.html#n/1"><code class="inline">dbg:n/1</code></a> and <a href="dbg.html#tracer/3"><code class="inline">dbg:tracer/3</code></a>).</p></li><li><p><strong><code class="inline">all</code></strong> - All processes and ports in the system as well as all processes and
ports created hereafter are to be traced.</p></li><li><p><strong><code class="inline">processes</code></strong> - All processes in the system as well as all processes created
hereafter are to be traced.</p></li><li><p><strong><code class="inline">ports</code></strong> - All ports in the system as well as all ports created hereafter
are to be traced.</p></li><li><p><strong><code class="inline">new</code></strong> - All processes and ports created after the call are to be
traced.</p></li><li><p><strong><code class="inline">new_processes</code></strong> - All processes created after the call are to be
traced.</p></li><li><p><strong><code class="inline">new_ports</code></strong> - All ports created after the call are to be traced.</p></li><li><p><strong><code class="inline">existing</code></strong> - All existing processes and ports are traced.</p></li><li><p><strong><code class="inline">existing_processes</code></strong> - All existing processes are traced.</p></li><li><p><strong><code class="inline">existing_ports</code></strong> - All existing ports are traced.</p></li><li><p><strong><a href="../../apps/erts/erlang.html#t:atom/0"><code class="inline">atom/0</code></a></strong> - The process or port with the corresponding registered name is
traced. The process or port can on another Erlang node.
The node must be in the list of traced nodes (see <a href="dbg.html#n/1"><code class="inline">dbg:n/1</code></a> and <a href="dbg.html#tracer/3"><code class="inline">dbg:tracer/3</code></a>).</p></li><li><p><strong><a href="../../apps/erts/erlang.html#t:integer/0"><code class="inline">integer/0</code></a></strong> - The process <code class="inline">&lt;0.Item.0&gt;</code> is traced.</p></li><li><p><strong><code class="inline">{X, Y, Z}</code></strong> - The process <code class="inline">&lt;X.Y.Z&gt;</code> is traced.</p></li><li><p><strong><a href="../../apps/erts/erlang.html#t:string/0"><code class="inline">string/0</code></a></strong> - If the <code class="inline">Item</code> is a string &quot;&lt;X.Y.Z&gt;&quot; as returned from
<a href="../../apps/erts/erlang.html#pid_to_list/1"><code class="inline">pid_to_list/1</code></a>, the process <code class="inline">&lt;X.Y.Z&gt;</code> is traced.</p></li></ul><p><a href="" id="flags"></a></p><p><code class="inline">Flags</code> can be a single atom or a list of flags. The available flags are:</p><ul><li><p><strong><code class="inline">s (send)</code></strong> - Traces the messages the process or port sends.</p></li><li><p><strong><code class="inline">r (receive)</code></strong> - Traces the messages the process or port receives.</p></li><li><p><strong><code class="inline">m (messages)</code></strong> - Traces the messages the process or port receives and
sends.</p></li><li><p><strong><code class="inline">c (call)</code></strong> - Traces global function calls for the process according to the
trace patterns set in the system (see <a href="dbg.html#tp/2"><code class="inline">dbg:tp/2</code></a>).</p></li><li><p><strong><code class="inline">p (procs)</code></strong> - Traces process related events to the process.</p></li><li><p><strong><code class="inline">ports</code></strong> - Traces port related events to the port.</p></li><li><p><strong><code class="inline">sos (set on spawn)</code></strong> - Lets all processes created by the traced process
inherit the trace flags of the traced process.</p></li><li><p><strong><code class="inline">sol (set on link)</code></strong> - Lets another process, <code class="inline">P2</code>, inherit the trace flags
of the traced process whenever the traced process links to <code class="inline">P2</code>.</p></li><li><p><strong><code class="inline">sofs (set on first spawn)</code></strong> - This is the same as <code class="inline">sos</code>, but only for the
first process spawned by the traced process.</p></li><li><p><strong><code class="inline">sofl (set on first link)</code></strong> - This is the same as <code class="inline">sol</code>, but only for the
first call to <a href="../../apps/erts/erlang.html#link/1"><code class="inline">link/1</code></a> by the traced process.</p></li><li><p><strong><code class="inline">all</code></strong> - Sets all flags except <code class="inline">silent</code>.</p></li><li><p><strong><code class="inline">clear</code></strong> - Clears all flags.</p></li><li><p>Other flags accepted by <a href="../../apps/kernel/trace.html#process/4"><code class="inline">trace:process/4</code></a> or <a href="../../apps/kernel/trace.html#port/4"><code class="inline">trace:port/4</code></a>
(e.g., <code class="inline">timestamp</code>, <code class="inline">arity</code>, <code class="inline">return_to</code>).</p></li></ul><p><a href="dbg.html#p/1"><code class="inline">dbg:p(Item)</code></a> is a shorthand for <code class="inline">dbg:p(Item, [m])</code>.</p><p>This function returns either an error tuple or an <code class="inline">{ok, List}</code> tuple. The <code class="inline">List</code>
consists of specifications of how many processes and ports that matched (in the
case of a single pid exactly 1). The specification of matched processes is
<code class="inline">{matched, Node, N}</code>. If the remote processor call (using <a href="../../apps/kernel/rpc.html"><code class="inline">rpc</code></a>) to a remote
node fails, the <code class="inline">rpc</code> error message is returned as the fourth element in the
tuple and the number of matched processes is 0.</p><p><strong>Example: Trace messages and process events for a specific process</strong></p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="n">Pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9964791851-1">(</span><span class="nf">fun</span><span class="p" data-group-id="9964791851-2">(</span><span class="p" data-group-id="9964791851-2">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="k">receive</span><span class="w"> </span><span class="p" data-group-id="9964791851-3">{</span><span class="n">From</span><span class="p">,</span><span class="n">Msg</span><span class="p" data-group-id="9964791851-3">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">From</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="n">Msg</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">end</span><span class="p" data-group-id="9964791851-1">)</span><span class="p">.</span><span class="w">
</span><span class="o">&lt;</span><span class="mf">0.90</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="gp unselectable">
2&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tracer</span><span class="p" data-group-id="9964791851-4">(</span><span class="p" data-group-id="9964791851-4">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9964791851-5">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.92</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="9964791851-5">}</span><span class="gp unselectable">
3&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">p</span><span class="p" data-group-id="9964791851-6">(</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9964791851-7">[</span><span class="ss">m</span><span class="p">,</span><span class="ss">procs</span><span class="p" data-group-id="9964791851-7">]</span><span class="p" data-group-id="9964791851-6">)</span><span class="p">.</span><span class="w"> </span><span class="c1">% Trace messages and process events for Pid</span><span class="w">
</span><span class="p" data-group-id="9964791851-8">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="9964791851-9">[</span><span class="p" data-group-id="9964791851-10">{</span><span class="ss">matched</span><span class="p">,</span><span class="ss">nonode@nohost</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="9964791851-10">}</span><span class="p" data-group-id="9964791851-9">]</span><span class="p" data-group-id="9964791851-8">}</span><span class="gp unselectable">
4&gt; </span><span class="n">Pid</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9964791851-11">{</span><span class="nf">self</span><span class="p" data-group-id="9964791851-12">(</span><span class="p" data-group-id="9964791851-12">)</span><span class="p">,</span><span class="ss">hello</span><span class="p" data-group-id="9964791851-11">}</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9964791851-13">(</span><span class="o">&lt;</span><span class="mf">0.90</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="9964791851-13">)</span><span class="w"> </span><span class="p" data-group-id="9964791851-14">&lt;&lt;</span><span class="w"> </span><span class="p" data-group-id="9964791851-15">{</span><span class="o">&lt;</span><span class="mf">0.88</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="ss">hello</span><span class="p" data-group-id="9964791851-15">}</span><span class="w"> </span><span class="c1">% Received by Pid</span><span class="w">
</span><span class="p" data-group-id="9964791851-16">{</span><span class="o">&lt;</span><span class="mf">0.88</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="ss">hello</span><span class="p" data-group-id="9964791851-16">}</span><span class="w">
</span><span class="p" data-group-id="9964791851-17">(</span><span class="o">&lt;</span><span class="mf">0.90</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="9964791851-17">)</span><span class="w"> </span><span class="o">&lt;</span><span class="mf">0.88</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="ss">hello</span><span class="w">    </span><span class="c1">% Sent by Pid</span><span class="w">
</span><span class="p" data-group-id="9964791851-18">(</span><span class="o">&lt;</span><span class="mf">0.90</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="9964791851-18">)</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="ss">normal</span><span class="w">         </span><span class="c1">% Process event: Pid exited</span><span class="gp unselectable">
5&gt; </span><span class="nf">flush</span><span class="p" data-group-id="9964791851-19">(</span><span class="p" data-group-id="9964791851-19">)</span><span class="p">.</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="ss">hello</span><span class="w">
</span><span class="ss">ok</span></code></pre><h3 id="tracing-function-calls-dbg-tp-2-3-4-dbg-tpl-2-3-4" class="section-heading"><a href="#tracing-function-calls-dbg-tp-2-3-4-dbg-tpl-2-3-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Tracing Function Calls (<a href="dbg.html#tp/2"><code class="inline">dbg:tp/2,3,4</code></a>, <a href="dbg.html#tpl/2"><code class="inline">dbg:tpl/2,3,4</code></a>)</span></h3><p>To trace function calls, you need to:</p><ol><li> Enable the <strong><code class="inline">c</code></strong>/<strong><code class="inline">call</code></strong> flag for the process(es) that will make the
calls (using <a href="dbg.html#p/2"><code class="inline">dbg:p/2</code></a>).</li><li> Set a <em>trace pattern</em> for the function(s) you want to trace using <a href="dbg.html#tp/2"><code class="inline">dbg:tp/2</code></a>
or <a href="dbg.html#tpl/2"><code class="inline">dbg:tpl/2</code></a>.</li></ol><p><code class="inline">tp</code> stands for <strong>t</strong>race <strong>p</strong>attern (for exported functions by default).
<code class="inline">tpl</code> stands for <strong>t</strong>race <strong>p</strong>attern <strong>l</strong>ocal (for local or remote calls to
local and exported functions).</p><p>The general syntax is <a href="dbg.html#tp/2"><code class="inline">dbg:tp(ModuleOrMFA, MatchSpec)</code></a> or
<a href="dbg.html#tpl/2"><code class="inline">dbg:tpl(ModuleOrMFA, MatchSpec)</code></a>.</p><p><code class="inline">ModuleOrMFA</code> can be:</p><ul><li><code class="inline">Module :: atom()</code>: Equivalent to <code class="inline">{Module, '_', '_'}</code> (trace all functions in the module).</li><li><code class="inline">{Module, Function, Arity}</code>: Trace specific function. <code class="inline">'_'</code> can be used as a wildcard.</li></ul><p>Note that if the <code class="inline">Module</code> is specified as <code class="inline">'_'</code>, the
<code class="inline">Function</code> and <code class="inline">Arity</code> parts must be specified as <code class="inline">'_'</code> as well. The
same holds for the <code class="inline">Function</code> in relation to <code class="inline">Arity</code>.</p><p><code class="inline">MatchSpec</code> defines what to trace and how, see
<a href="#match-specifications">match specifications</a>.</p><ul><li>For simple call tracing, you can insert the empty list <code class="inline">[]</code>.</li><li>The most common generic match specifications used can be found as built-in
aliases.<ul><li><code class="inline">x</code> or <code class="inline">exception_trace</code>: Shows function names, parameters, return
values, and exceptions. <code class="inline">[{'_',[],[{exception_trace}]}]</code></li><li><code class="inline">c</code> or <code class="inline">caller_trace</code>: Shows function names, parameters, and caller
information.
<code class="inline">[{'_',[],[{message,{caller_line}}]}]</code></li><li><code class="inline">cx</code> or <code class="inline">caller_exception_trace</code>: Combines <code class="inline">x</code> and <code class="inline">c</code>.
<code class="inline">[{'_',[],[{exception_trace},{message,{caller_line}}]}]</code></li></ul></li></ul><p><strong>Example using built-in aliases:</strong></p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tracer</span><span class="p" data-group-id="0099656005-1">(</span><span class="p" data-group-id="0099656005-1">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="0099656005-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.90</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="0099656005-2">}</span><span class="gp unselectable">
2&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">p</span><span class="p" data-group-id="0099656005-3">(</span><span class="ss">all</span><span class="p">,</span><span class="w"> </span><span class="ss">c</span><span class="p" data-group-id="0099656005-3">)</span><span class="p">.</span><span class="w"> </span><span class="c1">% Short for dbg:p(all, call)</span><span class="w">
</span><span class="p" data-group-id="0099656005-4">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="0099656005-5">[</span><span class="p" data-group-id="0099656005-6">{</span><span class="ss">matched</span><span class="p">,</span><span class="ss">nonode@nohost</span><span class="p">,</span><span class="mi">49</span><span class="p" data-group-id="0099656005-6">}</span><span class="p" data-group-id="0099656005-5">]</span><span class="p" data-group-id="0099656005-4">}</span><span class="gp unselectable">
3&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tp</span><span class="p" data-group-id="0099656005-7">(</span><span class="ss">lists</span><span class="p">,</span><span class="w"> </span><span class="ss">seq</span><span class="p">,</span><span class="w"> </span><span class="ss">cx</span><span class="p" data-group-id="0099656005-7">)</span><span class="p">.</span><span class="w"> </span><span class="c1">% cx: call and exception tracing with caller info</span><span class="w">
</span><span class="p" data-group-id="0099656005-8">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="0099656005-9">[</span><span class="p" data-group-id="0099656005-10">{</span><span class="ss">matched</span><span class="p">,</span><span class="ss">nonode@nohost</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="0099656005-10">}</span><span class="p">,</span><span class="p" data-group-id="0099656005-11">{</span><span class="ss">saved</span><span class="p">,</span><span class="ss">cx</span><span class="p" data-group-id="0099656005-11">}</span><span class="p" data-group-id="0099656005-9">]</span><span class="p" data-group-id="0099656005-8">}</span><span class="gp unselectable">
4&gt; </span><span class="nc">lists</span><span class="p">:</span><span class="nf">seq</span><span class="p" data-group-id="0099656005-12">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="0099656005-12">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="0099656005-13">(</span><span class="o">&lt;</span><span class="mf">0.88</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="0099656005-13">)</span><span class="w"> </span><span class="ss">call</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">seq</span><span class="p" data-group-id="0099656005-14">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="0099656005-14">)</span><span class="w"> </span><span class="p" data-group-id="0099656005-15">(</span><span class="p" data-group-id="0099656005-16">{</span><span class="ss">erl_eval</span><span class="p">,</span><span class="ss">do_apply</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="p" data-group-id="0099656005-17">{</span><span class="s">&quot;erl_eval.erl&quot;</span><span class="p">,</span><span class="mi">904</span><span class="p" data-group-id="0099656005-17">}</span><span class="p" data-group-id="0099656005-16">}</span><span class="p" data-group-id="0099656005-15">)</span><span class="w">
</span><span class="p" data-group-id="0099656005-18">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="0099656005-18">]</span><span class="w">
</span><span class="p" data-group-id="0099656005-19">(</span><span class="o">&lt;</span><span class="mf">0.88</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="0099656005-19">)</span><span class="w"> </span><span class="ss">returned</span><span class="w"> </span><span class="ss">from</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="ss">seq</span><span class="p">/</span><span class="mi">2</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="0099656005-20">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="0099656005-20">]</span></code></pre><p>Note that the caller info is the function that called lists:seq with file and
line number.</p><h3 id="tracing-message-events-dbg-tpe-2" class="section-heading"><a href="#tracing-message-events-dbg-tpe-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Tracing Message Events (<a href="dbg.html#tpe/2"><code class="inline">dbg:tpe/2</code></a>)</span></h3><p>By default, if <code class="inline">send</code> or <code class="inline">receive</code> tracing is enabled for a process, all such
events are traced. <a href="dbg.html#tpe/2"><code class="inline">dbg:tpe(Event, MatchSpec)</code></a> allows you to
filter these events.</p><ul><li><code class="inline">Event</code>: <code class="inline">send</code> or <code class="inline">'receive'</code>.</li><li><code class="inline">MatchSpec</code>: A <a href="#match-specifications">match specifications</a>.<ul><li>For <code class="inline">send</code>: Matches on <code class="inline">[Receiver, Msg]</code>.</li><li>For <code class="inline">'receive'</code>: Matches on <code class="inline">[Node, Sender, Msg]</code>.</li></ul></li></ul><h3 id="managing-trace-patterns" class="section-heading"><a href="#managing-trace-patterns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Managing Trace Patterns</span></h3><p>You can display, remove, save and load trace pattern matchspecifications, if
any of these bullets are of interest, click the title to read the documentation.</p><ul><li><strong><a href="dbg.html#ltp/0"><code class="inline">dbg:ltp()</code> (List Trace Patterns)</a>:</strong> Lists all saved match
specifications (from previous <code class="inline">tp</code> calls where a pattern was complex enough to
be saved) and built-in aliases.</li><li><strong><a href="dbg.html#dtp/0"><code class="inline">dbg:dtp()</code> (Delete Trace Patterns)</a>:</strong> Deletes all <em>saved</em> (not built-in)
match specifications.</li><li><strong><a href="dbg.html#dtp/1"><code class="inline">dbg:dtp(N)</code> (Delete Trace Pattern <code class="inline">N</code>)</a>:</strong> Deletes a specific saved
pattern by its ID <code class="inline">N</code>.</li><li><strong><a href="dbg.html#wtp/1"><code class="inline">dbg:wtp(FileName)</code> (Write Trace Patterns)</a>:</strong> Saves current (saved and
built-in) match specifications to <code class="inline">FileName</code>.</li><li><strong><a href="dbg.html#rtp/1"><code class="inline">dbg:rtp(FileName)</code> (Read Trace Patterns)</a>:</strong> Reads match specifications from <code class="inline">FileName</code> and merges them.</li></ul><p>To stop tracing specific functions, you clear their trace patterns.</p><ul><li><strong><a href="dbg.html#ctp/1"><code class="inline">dbg:ctp(ModuleOrMFA)</code></a>:</strong> Clears both global and local trace patterns.<ul><li><a href="dbg.html#ctp/0"><code class="inline">ctp()</code></a>: Clears all trace patterns for all functions.</li><li><code class="inline">ctp(Module)</code>: Clears patterns for all functions in <code class="inline">Module</code>.</li><li><code class="inline">ctp(Module, Function)</code> / <code class="inline">ctp(Module, Function, Arity)</code>: More specific.</li></ul></li><li><strong><a href="dbg.html#ctpl/1"><code class="inline">dbg:ctpl(ModuleOrMFA)</code></a>:</strong> Clears only <em>local</em> trace patterns (set by <code class="inline">tpl</code>).</li><li><strong><a href="dbg.html#ctpg/1"><code class="inline">dbg:ctpg(ModuleOrMFA)</code></a>:</strong> Clears only <em>global</em> trace patterns (set by <code class="inline">tp</code>).</li><li><strong><a href="dbg.html#ctpe/1"><code class="inline">dbg:ctpe(Event)</code></a>:</strong> Clears the match specification for <code class="inline">send</code> or <code class="inline">'receive'</code>, reverting to tracing all such events if the flag is set.</li></ul><h2 id="match-specifications" class="section-heading"><a href="#match-specifications" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Match Specifications</span></h2><p>Match Specifications are a powerful mini-language used to define conditions for
tracing and actions to take. The <a href="dbg.html#tp/2"><code class="inline">dbg:tp/2</code></a>, <a href="dbg.html#tpl/2"><code class="inline">dbg:tpl/2</code></a> and <a href="dbg.html#tpe/2"><code class="inline">dbg:tpe/2</code></a> functions
accept them. For a description of the format for the <code class="inline">MatchSpec</code> argument, see
<a href="../../apps/erts/match_spec.html"><em>Match Specifications in Erlang</em></a>, which explains the
general match specification language. For most users, <a href="dbg.html#fun2ms/1"><code class="inline">dbg:fun2ms/1</code></a> explained
below will do.</p><p>A match specification is a list of tuples: <code class="inline">[{MatchHead, Guard, BodyActions}]</code>.</p><ul><li><code class="inline">MatchHead</code>: Patterns to match function arguments. <code class="inline">'_'</code> matches anything.
<code class="inline">'$1'</code> is a variable.</li><li><code class="inline">Guard</code>: Conditions that must be true.</li><li><code class="inline">BodyActions</code>: Actions like <code class="inline">{return_trace}</code> (trace return value),
<code class="inline">{message, term()}</code> (include extra info), <code class="inline">{set_seq_token, ...}</code>.</li></ul><h3 id="creating-match-specifications-with-dbg-fun2ms-1" class="section-heading"><a href="#creating-match-specifications-with-dbg-fun2ms-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Creating Match Specifications with <a href="dbg.html#fun2ms/1"><code class="inline">dbg:fun2ms/1</code></a></span></h3><p>You can use <a href="dbg.html#fun2ms/1"><code class="inline">dbg:fun2ms/1</code></a> to translate a literal Erlang fun into a match
specification. This often feels more natural than writing the raw match spec.
The fun must take a single list argument (matching the function arguments) and
its body can use guard expressions and special tracing functions.
The parse transform module <a href="../../apps/stdlib/ms_transform.html"><code class="inline">ms_transform</code></a> must be enabled. The easiest way to
enable it is by adding the following line to the source file:
<code class="inline">-include_lib(&quot;stdlib/include/ms_transform.hrl&quot;).</code>
In the shell its already enabled.</p><p>The head of the fun must be a single pattern that matches a list. That pattern
will be used to match the arguments for the call:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">fun2ms</span><span class="p" data-group-id="4625565090-1">(</span><span class="nf">fun</span><span class="p" data-group-id="4625565090-2">(</span><span class="p" data-group-id="4625565090-3">[</span><span class="p">_</span><span class="p">,</span><span class="p">_</span><span class="p" data-group-id="4625565090-3">]</span><span class="p" data-group-id="4625565090-2">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="w"> </span><span class="k">end</span><span class="p" data-group-id="4625565090-1">)</span><span class="p">.</span><span class="w"> </span><span class="c1">% Matches a function with two arguments</span><span class="w">
</span><span class="p" data-group-id="4625565090-4">[</span><span class="p" data-group-id="4625565090-5">{</span><span class="p" data-group-id="4625565090-6">[</span><span class="ss">&#39;_&#39;</span><span class="p">,</span><span class="ss">&#39;_&#39;</span><span class="p" data-group-id="4625565090-6">]</span><span class="p">,</span><span class="p" data-group-id="4625565090-7">[</span><span class="p" data-group-id="4625565090-7">]</span><span class="p">,</span><span class="p" data-group-id="4625565090-8">[</span><span class="ss">true</span><span class="p" data-group-id="4625565090-8">]</span><span class="p" data-group-id="4625565090-5">}</span><span class="p" data-group-id="4625565090-4">]</span><span class="gp unselectable">
2&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">fun2ms</span><span class="p" data-group-id="4625565090-9">(</span><span class="nf">fun</span><span class="p" data-group-id="4625565090-10">(</span><span class="p" data-group-id="4625565090-11">[</span><span class="n">A</span><span class="p" data-group-id="4625565090-11">]</span><span class="p" data-group-id="4625565090-10">)</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="nf">is_atom</span><span class="p" data-group-id="4625565090-12">(</span><span class="n">A</span><span class="p" data-group-id="4625565090-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">return_trace</span><span class="p" data-group-id="4625565090-13">(</span><span class="p" data-group-id="4625565090-13">)</span><span class="w"> </span><span class="k">end</span><span class="p" data-group-id="4625565090-9">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="4625565090-14">[</span><span class="p" data-group-id="4625565090-15">{</span><span class="p" data-group-id="4625565090-16">[</span><span class="ss">&#39;$1&#39;</span><span class="p" data-group-id="4625565090-16">]</span><span class="p">,</span><span class="p" data-group-id="4625565090-17">[</span><span class="p" data-group-id="4625565090-18">{</span><span class="nb">is_atom</span><span class="p">,</span><span class="ss">&#39;$1&#39;</span><span class="p" data-group-id="4625565090-18">}</span><span class="p" data-group-id="4625565090-17">]</span><span class="p">,</span><span class="p" data-group-id="4625565090-19">[</span><span class="p" data-group-id="4625565090-20">{</span><span class="ss">return_trace</span><span class="p" data-group-id="4625565090-20">}</span><span class="p" data-group-id="4625565090-19">]</span><span class="p" data-group-id="4625565090-15">}</span><span class="p" data-group-id="4625565090-14">]</span></code></pre><p>The first match specification matches when a function having two
arguments is called. The second matches when a function, taking one
atom as an argument, is called.</p><h2 id="trace-sessions" class="section-heading"><a href="#trace-sessions" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Trace Sessions</span></h2><p>To avoid interference between different tracing activities, you can create
isolated <code class="inline">dbg</code> sessions.</p><p>First you create a session with <a href="dbg.html#session_create/1"><code class="inline">dbg:session_create(Name)</code></a>
where the name is an atom, a <a href="dbg.html#t:session/0"><code class="inline">session/0</code></a> is returned.
Several sessions may have the same name.</p><p>When you have the <a href="dbg.html#t:session/0"><code class="inline">session/0</code></a>, you use <a href="dbg.html#session/2"><code class="inline">dbg:session(Session, Fun)</code></a>.
This function runs <code class="inline">dbg</code> commands within <code class="inline">Fun</code> using the specified session.</p><p>Any <a href="dbg.html"><code class="inline">dbg</code></a> function that is called with in the provided fun
will use the <a href="dbg.html#t:session/0"><code class="inline">session/0</code></a> provided instead of the default
<code class="inline">dbg</code> session. This means that the tracing will be isolated
from other tracing users on the system.</p><p>When you no longer need the session, use <a href="dbg.html#session_destroy/1"><code class="inline">dbg:session_destroy(Session)</code></a>.</p><p><em>Example</em>:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">session_create</span><span class="p" data-group-id="6552983553-1">(</span><span class="ss">my_session</span><span class="p" data-group-id="6552983553-1">)</span><span class="p">.</span><span class="w">
</span><span class="o">&lt;</span><span class="mf">0.91</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="gp unselectable">
2&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">session</span><span class="p" data-group-id="6552983553-2">(</span><span class="n">S</span><span class="p">,</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="6552983553-3">(</span><span class="p" data-group-id="6552983553-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tracer</span><span class="p" data-group-id="6552983553-4">(</span><span class="p" data-group-id="6552983553-4">)</span><span class="p">,</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">p</span><span class="p" data-group-id="6552983553-5">(</span><span class="ss">all</span><span class="p">,</span><span class="ss">c</span><span class="p" data-group-id="6552983553-5">)</span><span class="p">,</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tp</span><span class="p" data-group-id="6552983553-6">(</span><span class="ss">lists</span><span class="p">,</span><span class="ss">seq</span><span class="p">,</span><span class="ss">x</span><span class="p" data-group-id="6552983553-6">)</span><span class="w"> </span><span class="k">end</span><span class="p" data-group-id="6552983553-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="6552983553-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="6552983553-8">[</span><span class="p" data-group-id="6552983553-9">{</span><span class="ss">matched</span><span class="p">,</span><span class="ss">nonode@nohost</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="6552983553-9">}</span><span class="p">,</span><span class="p" data-group-id="6552983553-10">{</span><span class="ss">saved</span><span class="p">,</span><span class="ss">x</span><span class="p" data-group-id="6552983553-10">}</span><span class="p" data-group-id="6552983553-8">]</span><span class="p" data-group-id="6552983553-7">}</span><span class="gp unselectable">
3&gt; </span><span class="nc">lists</span><span class="p">:</span><span class="nf">seq</span><span class="p" data-group-id="6552983553-11">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="6552983553-11">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="6552983553-12">(</span><span class="o">&lt;</span><span class="mf">0.89</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="6552983553-12">)</span><span class="w"> </span><span class="ss">call</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">seq</span><span class="p" data-group-id="6552983553-13">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p" data-group-id="6552983553-13">)</span><span class="w">
</span><span class="p" data-group-id="6552983553-14">(</span><span class="o">&lt;</span><span class="mf">0.89</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="6552983553-14">)</span><span class="w"> </span><span class="ss">returned</span><span class="w"> </span><span class="ss">from</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="ss">seq</span><span class="p">/</span><span class="mi">2</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="6552983553-15">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p" data-group-id="6552983553-15">]</span><span class="w">
</span><span class="p" data-group-id="6552983553-16">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p" data-group-id="6552983553-16">]</span><span class="gp unselectable">
4&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">session_destroy</span><span class="p" data-group-id="6552983553-17">(</span><span class="n">S</span><span class="p" data-group-id="6552983553-17">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span></code></pre><p>The state of the <a href="dbg.html#t:session/0"><code class="inline">session/0</code></a> is preserved in between <a href="dbg.html#session/2"><code class="inline">dbg:session/2</code></a> calls, so
you can call <a href="dbg.html#session/2"><code class="inline">dbg:session/2</code></a> multiple times when debugging you application.</p><p><em>Example</em>:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">session_create</span><span class="p" data-group-id="4031157163-1">(</span><span class="ss">my_session</span><span class="p" data-group-id="4031157163-1">)</span><span class="p">.</span><span class="w">
</span><span class="o">&lt;</span><span class="mf">0.91</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="w">
</span><span class="c1">%% Setup the initial traces</span><span class="gp unselectable">
2&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">session</span><span class="p" data-group-id="4031157163-2">(</span><span class="n">S</span><span class="p">,</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="4031157163-3">(</span><span class="p" data-group-id="4031157163-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tracer</span><span class="p" data-group-id="4031157163-4">(</span><span class="p" data-group-id="4031157163-4">)</span><span class="p">,</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">p</span><span class="p" data-group-id="4031157163-5">(</span><span class="nf">self</span><span class="p" data-group-id="4031157163-6">(</span><span class="p" data-group-id="4031157163-6">)</span><span class="p">,</span><span class="ss">c</span><span class="p" data-group-id="4031157163-5">)</span><span class="p">,</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tp</span><span class="p" data-group-id="4031157163-7">(</span><span class="ss">lists</span><span class="p">,</span><span class="ss">seq</span><span class="p">,</span><span class="ss">x</span><span class="p" data-group-id="4031157163-7">)</span><span class="w"> </span><span class="k">end</span><span class="p" data-group-id="4031157163-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="4031157163-8">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="4031157163-9">[</span><span class="p" data-group-id="4031157163-10">{</span><span class="ss">matched</span><span class="p">,</span><span class="ss">nonode@nohost</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="4031157163-10">}</span><span class="p">,</span><span class="p" data-group-id="4031157163-11">{</span><span class="ss">saved</span><span class="p">,</span><span class="ss">x</span><span class="p" data-group-id="4031157163-11">}</span><span class="p" data-group-id="4031157163-9">]</span><span class="p" data-group-id="4031157163-8">}</span><span class="gp unselectable">
3&gt; </span><span class="nc">lists</span><span class="p">:</span><span class="nf">seq</span><span class="p" data-group-id="4031157163-12">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4031157163-12">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="4031157163-13">(</span><span class="o">&lt;</span><span class="mf">0.89</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="4031157163-13">)</span><span class="w"> </span><span class="ss">call</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">seq</span><span class="p" data-group-id="4031157163-14">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="4031157163-14">)</span><span class="w">
</span><span class="p" data-group-id="4031157163-15">(</span><span class="o">&lt;</span><span class="mf">0.89</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="4031157163-15">)</span><span class="w"> </span><span class="ss">returned</span><span class="w"> </span><span class="ss">from</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="ss">seq</span><span class="p">/</span><span class="mi">2</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="4031157163-16">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="4031157163-16">]</span><span class="w">
</span><span class="p" data-group-id="4031157163-17">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="4031157163-17">]</span><span class="w">
</span><span class="c1">%% Add an additional trace pattern</span><span class="gp unselectable">
4&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">session</span><span class="p" data-group-id="4031157163-18">(</span><span class="n">S</span><span class="p">,</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="4031157163-19">(</span><span class="p" data-group-id="4031157163-19">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tpl</span><span class="p" data-group-id="4031157163-20">(</span><span class="ss">lists</span><span class="p">,</span><span class="ss">seq_loop</span><span class="p">,</span><span class="ss">x</span><span class="p" data-group-id="4031157163-20">)</span><span class="w"> </span><span class="k">end</span><span class="p" data-group-id="4031157163-18">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
5&gt; </span><span class="nc">lists</span><span class="p">:</span><span class="nf">seq</span><span class="p" data-group-id="4031157163-21">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4031157163-21">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="4031157163-22">(</span><span class="o">&lt;</span><span class="mf">0.89</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="4031157163-22">)</span><span class="w"> </span><span class="ss">call</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">seq</span><span class="p" data-group-id="4031157163-23">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="4031157163-23">)</span><span class="w">
</span><span class="p" data-group-id="4031157163-24">(</span><span class="o">&lt;</span><span class="mf">0.89</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="4031157163-24">)</span><span class="w"> </span><span class="ss">call</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">seq_loop</span><span class="p" data-group-id="4031157163-25">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="p" data-group-id="4031157163-26">[</span><span class="p" data-group-id="4031157163-26">]</span><span class="p" data-group-id="4031157163-25">)</span><span class="w">
</span><span class="p" data-group-id="4031157163-27">(</span><span class="o">&lt;</span><span class="mf">0.89</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="4031157163-27">)</span><span class="w"> </span><span class="ss">call</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">seq_loop</span><span class="p" data-group-id="4031157163-28">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="p" data-group-id="4031157163-29">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="4031157163-29">]</span><span class="p" data-group-id="4031157163-28">)</span><span class="w">
</span><span class="p" data-group-id="4031157163-30">(</span><span class="o">&lt;</span><span class="mf">0.89</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="4031157163-30">)</span><span class="w"> </span><span class="ss">returned</span><span class="w"> </span><span class="ss">from</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="ss">seq_loop</span><span class="p">/</span><span class="mi">3</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="4031157163-31">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="4031157163-31">]</span><span class="w">
</span><span class="p" data-group-id="4031157163-32">(</span><span class="o">&lt;</span><span class="mf">0.89</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="4031157163-32">)</span><span class="w"> </span><span class="ss">returned</span><span class="w"> </span><span class="ss">from</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="ss">seq_loop</span><span class="p">/</span><span class="mi">3</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="4031157163-33">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="4031157163-33">]</span><span class="w">
</span><span class="p" data-group-id="4031157163-34">(</span><span class="o">&lt;</span><span class="mf">0.89</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="4031157163-34">)</span><span class="w"> </span><span class="ss">returned</span><span class="w"> </span><span class="ss">from</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="ss">seq</span><span class="p">/</span><span class="mi">2</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="4031157163-35">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="4031157163-35">]</span><span class="w">
</span><span class="p" data-group-id="4031157163-36">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="4031157163-36">]</span><span class="gp unselectable">
6&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">session_destroy</span><span class="p" data-group-id="4031157163-37">(</span><span class="n">S</span><span class="p" data-group-id="4031157163-37">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span></code></pre><h2 id="trace-on-remote-nodes" class="section-heading"><a href="#trace-on-remote-nodes" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Trace on Remote Nodes</span></h2><p>The <code class="inline">dbg</code> server keeps a list of nodes where tracing should be
performed. Whenever a <a href="dbg.html#tp/2"><code class="inline">dbg:tp/2</code></a> call or a <a href="dbg.html#p/2"><code class="inline">dbg:p/2</code></a> call is made, it is
executed for all nodes in this list including the local node (except
for <a href="dbg.html#p/2"><code class="inline">dbg:p/2</code></a> with a specific <a href="../../apps/erts/erlang.html#t:pid/0"><code class="inline">pid/0</code></a> or <a href="../../apps/erts/erlang.html#t:port/0"><code class="inline">port/0</code></a> as first argument,
in which case the command is executed only on the node where the
designated process or port resides).</p><p><strong><a href="dbg.html#n/1"><code class="inline">dbg:n(Nodename)</code></a>:</strong> When this function is called, it starts a
tracer process on the remote node, which will send all trace messages to the
tracer process on the local node (via the Erlang distribution). If no tracer
process is running on the local node, the error reason <code class="inline">no_local_tracer</code> is
returned. The tracer process on the local node must be started with
the <a href="dbg.html#tracer/2"><code class="inline">dbg:tracer/0,2</code></a> function.</p><p>If <code class="inline">Nodename</code> is the local node, the error reason <code class="inline">cant_add_local_node</code> is
returned.
The function will also return an error if the node <code class="inline">Nodename</code> is not reachable.</p><p>If a trace port (see <a href="dbg.html#trace_port/2"><code class="inline">dbg:trace_port/2</code></a>) is running on the local node, remote nodes
cannot be traced with a tracer process. The error reason
<code class="inline">cant_trace_remote_pid_to_local_port</code> is returned. However, a trace port can be
started on the remote node with the <a href="dbg.html#tracer/3"><code class="inline">dbg:tracer/3</code></a> function.</p><p><strong><a href="dbg.html#tracer/3"><code class="inline">dbg:tracer(Nodename, Type, Data)</code></a></strong>: An independent tracer
is started on the node (<code class="inline">Nodename</code>) and the node is added to the list of traced nodes.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p><a href="dbg.html#tracer/3"><code class="inline">dbg:tracer(Nodename, Type, Data)</code></a> is not equivalent to <a href="dbg.html#n/1"><code class="inline">dbg:n/1</code></a>. While <a href="dbg.html#n/1"><code class="inline">dbg:n/1</code></a> starts a process tracer
which redirects all trace information to a process tracer on the local node
(that is, the trace control node), <a href="dbg.html#tracer/3"><code class="inline">dbg:tracer/3</code></a> starts any type of tracer,
independent of the type of tracer on the trace control node.</p></section><h3 id="managing-nodes" class="section-heading"><a href="#managing-nodes" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Managing nodes</span></h3><p><code class="inline">dbg</code> can trace processes and functions on other Erlang nodes in a distributed system.</p><ul><li><strong><a href="dbg.html#cn/1"><code class="inline">dbg:cn(Nodename)</code> (Clear Node)</a>:</strong> Removes <code class="inline">Nodename</code> from the list. Tracing already active on that node continues but new global <code class="inline">tp/p</code> calls won't affect it.</li><li><strong><a href="dbg.html#ln/0"><code class="inline">dbg:ln()</code> (List Nodes)</a>:</strong> Shows the list of currently traced nodes.</li></ul><h2 id="trace-ports-for-lower-overhead" class="section-heading"><a href="#trace-ports-for-lower-overhead" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Trace Ports for Lower Overhead</span></h2><p>For high-volume tracing, sending messages to an Erlang process can be too slow.
A trace port is an Erlang port to a dynamically linked-in driver that
handles trace messages directly, without the overhead of sending them
as messages to an Erlang process. Using a trace port significantly
lowers the overhead imposed by tracing.</p><h3 id="creating-trace-ports-dbg-trace_port-2" class="section-heading"><a href="#creating-trace-ports-dbg-trace_port-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Creating Trace Ports (<a href="dbg.html#trace_port/2"><code class="inline">dbg:trace_port/2</code></a>)</span></h3><p><a href="dbg.html#trace_port/2"><code class="inline">dbg:trace_port(Type, Parameters)</code></a> returns a <code class="inline">fun/0</code> that,
when called, creates and returns a port. This fun is then passed as the second argument to
<a href="dbg.html#tracer/2"><code class="inline">dbg:tracer(port, Fun)</code></a>.</p><p>Two trace drivers are available: the <code class="inline">file</code> and the <code class="inline">ip</code> trace drivers.</p><ul><li><strong><code class="inline">file</code></strong>: Writes trace messages to binary file(s).<ul><li><code class="inline">Parameters</code>: <code class="inline">Filename</code> or a wrap files specification:
<code class="inline">{Filename, wrap, Suffix}</code>
<code class="inline">{Filename, wrap, Suffix, WrapSize}</code>
<code class="inline">{Filename, wrap, Suffix, WrapSize, WrapCnt}</code>
<code class="inline">{Filename, wrap, Suffix, {time, WrapTime}, WrapCnt}</code>
Wrap files limit disk space by rotating through <code class="inline">WrapCnt</code> files, each up to <code class="inline">WrapSize</code> or open for <code class="inline">WrapTime</code>.</li></ul></li><li><strong><code class="inline">ip</code></strong>: Opens a TCP/IP listening port. A client connects to receive trace messages.<ul><li><code class="inline">Parameters</code>: <code class="inline">PortNumber</code> or <code class="inline">{PortNumber, QueSize}</code>.</li></ul></li></ul><p>The <code class="inline">file</code> trace driver expects a filename or a wrap files
specification as parameter. A file is written with a high degree of
buffering, which is why there is no guarantee that all are saved in the
file in case of a system crash.</p><p>A wrap files specification is used to limit the disk space consumed by the
trace. The trace is written to a limited number of files each with a limited
size. The actual filenames are <code class="inline">Filename ++ SeqCnt ++ Suffix</code>, where <code class="inline">SeqCnt</code>
counts as a decimal string from <code class="inline">0</code> to <code class="inline">WrapCnt</code> and then around again from <code class="inline">0</code>.
When a trace term written to the current file makes it longer than <code class="inline">WrapSize</code>,
that file is closed, and if the number of files in this wrap trace is as many as
<code class="inline">WrapCnt</code> the oldest file is deleted, and a new file is opened to become the
current. Thus, when a wrap trace has been stopped, there are at most <code class="inline">WrapCnt</code>
trace files saved with a size of at least <code class="inline">WrapSize</code> (but not much larger),
except for the last file that might even be empty. The default values are
<code class="inline">WrapSize = 128*1024</code> and <code class="inline">WrapCnt = 8</code>.</p><p>The <code class="inline">SeqCnt</code> values in the filenames are all in the range <code class="inline">0</code> through <code class="inline">WrapCnt</code>
with a gap in the circular sequence. The gap is needed to find the end of the
trace.</p><p>If the <code class="inline">WrapSize</code> is specified as <code class="inline">{time, WrapTime}</code>, the current file is closed
when it has been open more than <code class="inline">WrapTime</code> milliseconds, regardless of it being
empty or not.</p><p>The <code class="inline">ip</code> trace driver has a queue of <code class="inline">QueSize</code> messages waiting to be delivered.
If the driver cannot deliver messages as fast as they are produced by the
runtime system, a special message is sent, which indicates how many messages
that are dropped. That message will arrive at the handler function specified in
<a href="dbg.html#trace_client/3"><code class="inline">dbg:trace_client/3</code></a> as the tuple <code class="inline">{drop, N}</code> where <code class="inline">N</code> is the number of consecutive
messages dropped. In case of heavy tracing, drops are likely to occur, and they
surely occur if no client is reading the trace messages. The default value of
<code class="inline">QueSize</code> is 200.</p><h3 id="reading-trace-port-data-dbg-trace_client-2-3" class="section-heading"><a href="#reading-trace-port-data-dbg-trace_client-2-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Reading Trace Port Data (<a href="dbg.html#trace_client/2"><code class="inline">dbg:trace_client/2,3</code></a>)</span></h3><p><a href="dbg.html#trace_client/2"><code class="inline">dbg:trace_client(Type, Parameters)</code></a> Starts a trace
client that reads the output
created by a trace port driver (see <a href="dbg.html#trace_port/2"><code class="inline">dbg:trace_port/2</code></a>) and handles it in mostly
the same way as a tracer process created by the <a href="dbg.html#tracer/0"><code class="inline">dbg:tracer/0</code></a> function.
<a href="dbg.html#trace_client/3"><code class="inline">dbg:trace_client(Type, Parameters, HandlerSpec)</code></a> This
function works exactly as
<a href="dbg.html#trace_client/2"><code class="inline">dbg:trace_client/2</code></a>, but allows you to write your own handler function.</p><p>If <code class="inline">Type</code> is <code class="inline">file</code>, the client reads all trace messages stored in the
file named <code class="inline">Filename</code> or specified by <code class="inline">WrapFilesSpec</code> (must be the
same as used when creating the trace) and lets the default handler
function format the messages on the console. This is one way to
interpret the data stored in a file by the file trace port driver.</p><p>If <code class="inline">Type</code> is <code class="inline">follow_file</code>, the client behaves as in the <code class="inline">file</code> case, but keeps
trying to read (and process) more data from the file until stopped by
<a href="dbg.html#stop_trace_client/1"><code class="inline">dbg:stop_trace_client/1</code></a>. <code class="inline">WrapFilesSpec</code> is not allowed as second argument for
this <code class="inline">Type</code>.</p><p>If <code class="inline">Type</code> is <code class="inline">ip</code>, the client connects to the TCP/IP port <code class="inline">PortNumber</code> on the
host <code class="inline">Hostname</code>, from where it reads trace messages until the TCP/IP connection
is closed. If no <code class="inline">Hostname</code> is specified, the local host is assumed.</p><p>The handler function works mostly as the one described in <a href="dbg.html#tracer/2"><code class="inline">dbg:tracer/2</code></a>,
but must also be prepared to handle trace messages of the form <code class="inline">{drop, N}</code>, where <code class="inline">N</code> is the number of dropped messages. This pseudo trace
message will only occur if the <code class="inline">ip</code> trace driver is used.</p><p>For trace type <code class="inline">file</code>, the pseudo trace message <code class="inline">end_of_trace</code> will appear at
the end of the trace. The return value from the handler function is in this case
ignored.</p><p><strong>Example: Using an IP trace port and connecting to it from another node</strong>
As an example, one can let trace messages be sent over the network to another
Erlang node (preferably <em>not</em> distributed), where the formatting occurs.</p><p>On the node <code class="inline">stack</code> there exists an Erlang node <code class="inline">ant@stack</code>. In the
shell, type the following:</p><pre><code class="makeup erlang" translate="no"><span class="ss">ant@stack</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tracer</span><span class="p" data-group-id="2834326160-1">(</span><span class="ss">port</span><span class="p">,</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">trace_port</span><span class="p" data-group-id="2834326160-2">(</span><span class="ss">ip</span><span class="p">,</span><span class="w"> </span><span class="mi">4711</span><span class="p" data-group-id="2834326160-2">)</span><span class="p" data-group-id="2834326160-1">)</span><span class="p">.</span><span class="w">
</span><span class="o">&lt;</span><span class="mf">0.17</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="w">
</span><span class="ss">ant@stack</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">p</span><span class="p" data-group-id="2834326160-3">(</span><span class="nf">self</span><span class="p" data-group-id="2834326160-4">(</span><span class="p" data-group-id="2834326160-4">)</span><span class="p">,</span><span class="w"> </span><span class="nb">send</span><span class="p" data-group-id="2834326160-3">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="2834326160-5">{</span><span class="ss">ok</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="2834326160-5">}</span></code></pre><p>All trace messages are now sent to the trace port driver, which in turn listens
for connections on the TCP/IP port 4711. If we want to see the messages on
another node, preferably on another host, we do like this:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">trace_client</span><span class="p" data-group-id="8467974979-1">(</span><span class="ss">ip</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8467974979-2">{</span><span class="s">&quot;stack&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4711</span><span class="p" data-group-id="8467974979-2">}</span><span class="p" data-group-id="8467974979-1">)</span><span class="p">.</span><span class="w">
</span><span class="o">&lt;</span><span class="mf">0.42</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span></code></pre><p>If we now send a message from the shell on the node <code class="inline">ant@stack</code>, where all sends
from the shell are traced:</p><pre><code class="makeup erlang" translate="no"><span class="ss">ant@stack</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4573273497-1">(</span><span class="p" data-group-id="4573273497-1">)</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="ss">hello</span><span class="p">.</span><span class="w">
</span><span class="ss">hello</span></code></pre><p>The following will appear at the console on the node that started the trace
client:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="0022456023-1">(</span><span class="o">&lt;</span><span class="mf">0.23</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="0022456023-1">)</span><span class="w"> </span><span class="o">&lt;</span><span class="mf">0.23</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="nf">hello</span><span class="w">
</span><span class="p" data-group-id="0022456023-2">(</span><span class="o">&lt;</span><span class="mf">0.23</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="0022456023-2">)</span><span class="w"> </span><span class="o">&lt;</span><span class="mf">0.22</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="0022456023-3">{</span><span class="ss">shell_rep</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.23</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="0022456023-4">{</span><span class="ss">value</span><span class="p">,</span><span class="ss">hello</span><span class="p">,</span><span class="p" data-group-id="0022456023-5">[</span><span class="p" data-group-id="0022456023-5">]</span><span class="p">,</span><span class="p" data-group-id="0022456023-6">[</span><span class="p" data-group-id="0022456023-6">]</span><span class="p" data-group-id="0022456023-4">}</span><span class="p" data-group-id="0022456023-3">}</span></code></pre><p>The last line is generated due to internal message passing in the Erlang shell.
The pids will vary.</p><h3 id="controlling-trace-ports" class="section-heading"><a href="#controlling-trace-ports" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Controlling Trace Ports</span></h3><ul><li><strong><a href="dbg.html#flush_trace_port/0"><code class="inline">dbg:flush_trace_port()</code></a> / 
<a href="dbg.html#flush_trace_port/1"><code class="inline">dbg:flush_trace_port(Node)</code></a>:</strong>
Flushes internal buffers of the trace port driver on the local/specified node
(currently for <code class="inline">file</code> driver).</li><li><strong><a href="dbg.html#trace_port_control/1"><code class="inline">dbg:trace_port_control(Operation)</code></a> / 
<a href="dbg.html#trace_port_control/2"><code class="inline">dbg:trace_port_control(Node, Operation)</code></a>:</strong><ul><li><code class="inline">Operation = flush</code>: Same as above.</li><li><code class="inline">Operation = get_listen_port</code>: For <code class="inline">ip</code> driver, returns <code class="inline">{ok, IpPortNumber}</code>.</li></ul></li><li><strong><a href="dbg.html#stop_trace_client/1"><code class="inline">dbg:stop_trace_client(Pid)</code></a>:</strong> Shuts down
the trace client <code class="inline">Pid</code>.</li></ul><h2 id="sequential-tracing" class="section-heading"><a href="#sequential-tracing" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Sequential Tracing</span></h2><p>The <a href="dbg.html"><code class="inline">dbg</code></a> module is primarily targeted towards tracing through the
<a href="../../apps/kernel/trace.html#process/4"><code class="inline">trace:process/4</code></a> function. It is sometimes desired to trace messages in a more
delicate way, which can be done with the help of the <a href="../../apps/kernel/seq_trace.html"><code class="inline">seq_trace</code></a> module.</p><p><a href="../../apps/kernel/seq_trace.html"><code class="inline">seq_trace</code></a> implements sequential tracing (known in the AXE10 world, and
sometimes called &quot;forlopp tracing&quot;). <a href="dbg.html"><code class="inline">dbg</code></a> can interpret messages generated from
<a href="../../apps/kernel/seq_trace.html"><code class="inline">seq_trace</code></a> and the same tracer function for both types of tracing can be used.
The <a href="../../apps/kernel/seq_trace.html"><code class="inline">seq_trace</code></a> messages can also be sent to a trace port for further analysis.</p><p>As a match specification can turn on sequential tracing, the combination of
<a href="dbg.html"><code class="inline">dbg</code></a> and <a href="../../apps/kernel/seq_trace.html"><code class="inline">seq_trace</code></a> can be powerful. This brief example shows a session
where sequential tracing is used to trace the <a href="dbg.html"><code class="inline">dbg</code></a> module and the trace itself:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tracer</span><span class="p" data-group-id="5201446433-1">(</span><span class="p" data-group-id="5201446433-1">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="5201446433-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.30</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="5201446433-2">}</span><span class="gp unselectable">
2&gt; </span><span class="p" data-group-id="5201446433-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Tracer</span><span class="p" data-group-id="5201446433-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">get_tracer</span><span class="p" data-group-id="5201446433-4">(</span><span class="p" data-group-id="5201446433-4">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="5201446433-5">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.31</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="5201446433-5">}</span><span class="gp unselectable">
3&gt; </span><span class="nc">seq_trace</span><span class="p">:</span><span class="nf">set_system_tracer</span><span class="p" data-group-id="5201446433-6">(</span><span class="n">Tracer</span><span class="p" data-group-id="5201446433-6">)</span><span class="p">.</span><span class="w">
</span><span class="ss">false</span><span class="gp unselectable">
4&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tp</span><span class="p" data-group-id="5201446433-7">(</span><span class="ss">dbg</span><span class="p">,</span><span class="w"> </span><span class="ss">get_tracer</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5201446433-8">[</span><span class="p" data-group-id="5201446433-9">{</span><span class="p" data-group-id="5201446433-10">[</span><span class="p" data-group-id="5201446433-10">]</span><span class="p">,</span><span class="p" data-group-id="5201446433-11">[</span><span class="p" data-group-id="5201446433-11">]</span><span class="p">,</span><span class="p" data-group-id="5201446433-12">[</span><span class="p" data-group-id="5201446433-13">{</span><span class="ss">set_seq_token</span><span class="p">,</span><span class="w"> </span><span class="nb">send</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="5201446433-13">}</span><span class="p" data-group-id="5201446433-12">]</span><span class="p" data-group-id="5201446433-9">}</span><span class="p" data-group-id="5201446433-8">]</span><span class="p" data-group-id="5201446433-7">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="5201446433-14">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="5201446433-15">[</span><span class="p" data-group-id="5201446433-16">{</span><span class="ss">matched</span><span class="p">,</span><span class="ss">nonode@nohost</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="5201446433-16">}</span><span class="p">,</span><span class="p" data-group-id="5201446433-17">{</span><span class="ss">saved</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="5201446433-17">}</span><span class="p" data-group-id="5201446433-15">]</span><span class="p" data-group-id="5201446433-14">}</span><span class="gp unselectable">
5&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">p</span><span class="p" data-group-id="5201446433-18">(</span><span class="ss">all</span><span class="p">,</span><span class="ss">call</span><span class="p" data-group-id="5201446433-18">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="5201446433-19">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="5201446433-20">[</span><span class="p" data-group-id="5201446433-21">{</span><span class="ss">matched</span><span class="p">,</span><span class="ss">nonode@nohost</span><span class="p">,</span><span class="mi">22</span><span class="p" data-group-id="5201446433-21">}</span><span class="p" data-group-id="5201446433-20">]</span><span class="p" data-group-id="5201446433-19">}</span><span class="gp unselectable">
6&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">get_tracer</span><span class="p" data-group-id="5201446433-22">(</span><span class="p" data-group-id="5201446433-22">)</span><span class="p">,</span><span class="w"> </span><span class="nc">seq_trace</span><span class="p">:</span><span class="nf">set_token</span><span class="p" data-group-id="5201446433-23">(</span><span class="p" data-group-id="5201446433-24">[</span><span class="p" data-group-id="5201446433-24">]</span><span class="p" data-group-id="5201446433-23">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="5201446433-25">(</span><span class="o">&lt;</span><span class="mf">0.25</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="5201446433-25">)</span><span class="w"> </span><span class="ss">call</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">get_tracer</span><span class="p" data-group-id="5201446433-26">(</span><span class="p" data-group-id="5201446433-26">)</span><span class="w">
</span><span class="n">SeqTrace</span><span class="w"> </span><span class="p" data-group-id="5201446433-27">[</span><span class="mi">0</span><span class="p" data-group-id="5201446433-27">]</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5201446433-28">(</span><span class="o">&lt;</span><span class="mf">0.25</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="5201446433-28">)</span><span class="w"> </span><span class="o">&lt;</span><span class="mf">0.30</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="5201446433-29">{</span><span class="o">&lt;</span><span class="mf">0.25</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="ss">get_tracer</span><span class="p" data-group-id="5201446433-29">}</span><span class="w"> </span><span class="p" data-group-id="5201446433-30">[</span><span class="n">Serial</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5201446433-31">{</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="5201446433-31">}</span><span class="p" data-group-id="5201446433-30">]</span><span class="w">
</span><span class="n">SeqTrace</span><span class="w"> </span><span class="p" data-group-id="5201446433-32">[</span><span class="mi">0</span><span class="p" data-group-id="5201446433-32">]</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5201446433-33">(</span><span class="o">&lt;</span><span class="mf">0.30</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="5201446433-33">)</span><span class="w"> </span><span class="o">&lt;</span><span class="mf">0.25</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="5201446433-34">{</span><span class="ss">dbg</span><span class="p">,</span><span class="p" data-group-id="5201446433-35">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.31</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="5201446433-35">}</span><span class="p" data-group-id="5201446433-34">}</span><span class="w"> </span><span class="p" data-group-id="5201446433-36">[</span><span class="n">Serial</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5201446433-37">{</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p" data-group-id="5201446433-37">}</span><span class="p" data-group-id="5201446433-36">]</span><span class="w">
</span><span class="p" data-group-id="5201446433-38">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.30</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="5201446433-38">}</span></code></pre><p>This session sets the system_tracer to the same process as the
ordinary tracer process (i. e. &lt;0.31.0&gt;) and sets the trace pattern
for the function <code class="inline">dbg:get_tracer</code> to one that has the action of
setting a sequential token. When the function is called by a traced
process (all processes are traced in this case), the process gets
&quot;contaminated&quot; by the token and <a href="../../apps/kernel/seq_trace.html"><code class="inline">seq_trace</code></a> messages are sent both for
the server request and the response. The <code class="inline">seq_trace:set_token([])</code>
after the call clears the <a href="../../apps/kernel/seq_trace.html"><code class="inline">seq_trace</code></a> token, which is why no messages
are sent when the answer propagates via the shell to the console
port. Otherwise the output would have been more noisy.</p><h2 id="avoiding-overloads" class="section-heading"><a href="#avoiding-overloads" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Avoiding Overloads</span></h2><p>Tracing can generate a significant amount of data, potentially
overwhelming your system if not managed carefully. To prevent performance
degradation or even crashes, consider these strategies:</p><p><strong>Time-Limited Tracing</strong>: One effective method is to automatically stop tracing
after a set period.</p><pre><code class="makeup erlang" translate="no"><span class="nc">dbg</span><span class="p">:</span><span class="nf">tracer</span><span class="p" data-group-id="1199073880-1">(</span><span class="p" data-group-id="1199073880-1">)</span><span class="p">,</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">p</span><span class="p" data-group-id="1199073880-2">(</span><span class="ss">all</span><span class="p">,</span><span class="p" data-group-id="1199073880-3">[</span><span class="ss">c</span><span class="p" data-group-id="1199073880-3">]</span><span class="p" data-group-id="1199073880-2">)</span><span class="p">,</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tpl</span><span class="p" data-group-id="1199073880-4">(</span><span class="ss">lists</span><span class="p">,</span><span class="ss">map</span><span class="p">,</span><span class="ss">x</span><span class="p" data-group-id="1199073880-4">)</span><span class="p">,</span><span class="w"> </span><span class="nc">timer</span><span class="p">:</span><span class="nf">sleep</span><span class="p" data-group-id="1199073880-5">(</span><span class="mi">1000</span><span class="p" data-group-id="1199073880-5">)</span><span class="p">,</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">stop</span><span class="p" data-group-id="1199073880-6">(</span><span class="p" data-group-id="1199073880-6">)</span><span class="p">.</span></code></pre><p><strong>Be Specific:</strong></p><p><strong>Processes:</strong> Instead of <code class="inline">dbg:p(all, Flags).</code>, try to pinpoint specific
processes if you know which ones are relevant: <code class="inline">dbg:p(Pid, Flags)</code>. You can also
trace newly spawned processes with <code class="inline">dbg:p(new, Flags).</code>.</p><p><strong>Modules &amp; Functions:</strong> Rather than tracing all calls, narrow down to specific
modules and functions with <a href="dbg.html#tp/2"><code class="inline">dbg:tp/2</code></a> or <a href="dbg.html#tpl/2"><code class="inline">dbg:tpl/2</code></a></p><p><strong>Use Match Specifications:</strong> For example, to only trace calls to
<code class="inline">my_module:my_function/1</code> when the first argument is the atom error:</p><pre><code class="makeup erlang" translate="no"><span class="nc">dbg</span><span class="p">:</span><span class="nf">tpl</span><span class="p" data-group-id="5267686154-1">(</span><span class="ss">my_module</span><span class="p">,</span><span class="w"> </span><span class="ss">my_function</span><span class="p">,</span><span class="w"> </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">fun2ms</span><span class="p" data-group-id="5267686154-2">(</span><span class="nf">fun</span><span class="p" data-group-id="5267686154-3">(</span><span class="p" data-group-id="5267686154-4">[</span><span class="ss">error</span><span class="p" data-group-id="5267686154-4">]</span><span class="p" data-group-id="5267686154-3">)</span><span class="p">-&gt;</span><span class="ss">true</span><span class="w"> </span><span class="k">end</span><span class="p" data-group-id="5267686154-2">)</span><span class="p" data-group-id="5267686154-1">)</span><span class="p">.</span></code></pre><p><strong>Limit Trace Flags:</strong> Only enable the flags essential for your debugging task
(e.g., m for message passing, c for function calls).</p><p><strong>Trace to File for High Volumes:</strong> If you anticipate a large volume of trace
data, tracing directly to the console can become a bottleneck. Consider tracing
to a file instead, see <a href="#trace-ports-for-lower-overhead">trace ports</a>.</p><pre><code class="makeup erlang" translate="no"><span class="nc">dbg</span><span class="p">:</span><span class="nf">tracer</span><span class="p" data-group-id="9778905127-1">(</span><span class="ss">port</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9778905127-2">{</span><span class="ss">file</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;trace_output.log&quot;</span><span class="p" data-group-id="9778905127-2">}</span><span class="p" data-group-id="9778905127-1">)</span><span class="p">,</span><span class="w">
</span><span class="c1">% ... your other dbg commands ...</span><span class="w">
</span><span class="nc">timer</span><span class="p">:</span><span class="nf">sleep</span><span class="p" data-group-id="9778905127-3">(</span><span class="mi">5000</span><span class="p" data-group-id="9778905127-3">)</span><span class="p">,</span><span class="w">
</span><span class="nc">dbg</span><span class="p">:</span><span class="nf">stop</span><span class="p" data-group-id="9778905127-4">(</span><span class="p" data-group-id="9778905127-4">)</span><span class="p">.</span></code></pre><h2 id="avoiding-deadlocks" class="section-heading"><a href="#avoiding-deadlocks" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Avoiding Deadlocks</span></h2><p>When tracing function calls on a group leader process (an I/O process), there is
risk of causing a deadlock. This will happen if a group leader process generates
a trace message and the tracer process, by calling the trace handler function,
sends an I/O request to the same group leader. The problem can only occur if the
trace handler prints to the tty using an <a href="../../apps/stdlib/io.html"><code class="inline">io</code></a> function such as
<a href="../../apps/stdlib/io.html#format/2"><code class="inline">format/2</code></a>. Note that when <code class="inline">dbg:p(all, call)</code> is called, IO
processes are also traced. Here is an example:</p><pre><code class="makeup erlang" translate="no"><span class="c1">%% Using a default line editing shell</span><span class="gp unselectable">
1&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tracer</span><span class="p" data-group-id="2146557388-1">(</span><span class="ss">process</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2146557388-2">{</span><span class="nf">fun</span><span class="p" data-group-id="2146557388-3">(</span><span class="n">Msg</span><span class="p">,</span><span class="p">_</span><span class="p" data-group-id="2146557388-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2146557388-4">(</span><span class="s">&quot;</span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2146557388-5">[</span><span class="n">Msg</span><span class="p" data-group-id="2146557388-5">]</span><span class="p" data-group-id="2146557388-4">)</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2146557388-2">}</span><span class="p" data-group-id="2146557388-1">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="2146557388-6">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.37</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="2146557388-6">}</span><span class="gp unselectable">
2&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">p</span><span class="p" data-group-id="2146557388-7">(</span><span class="ss">all</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2146557388-8">[</span><span class="ss">call</span><span class="p" data-group-id="2146557388-8">]</span><span class="p" data-group-id="2146557388-7">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="2146557388-9">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="2146557388-10">[</span><span class="p" data-group-id="2146557388-11">{</span><span class="ss">matched</span><span class="p">,</span><span class="ss">nonode@nohost</span><span class="p">,</span><span class="mi">25</span><span class="p" data-group-id="2146557388-11">}</span><span class="p" data-group-id="2146557388-10">]</span><span class="p" data-group-id="2146557388-9">}</span><span class="gp unselectable">
3&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tp</span><span class="p" data-group-id="2146557388-12">(</span><span class="ss">mymod</span><span class="p">,</span><span class="p" data-group-id="2146557388-13">[</span><span class="p" data-group-id="2146557388-14">{</span><span class="ss">&#39;_&#39;</span><span class="p">,</span><span class="p" data-group-id="2146557388-15">[</span><span class="p" data-group-id="2146557388-15">]</span><span class="p">,</span><span class="p" data-group-id="2146557388-16">[</span><span class="p" data-group-id="2146557388-16">]</span><span class="p" data-group-id="2146557388-14">}</span><span class="p" data-group-id="2146557388-13">]</span><span class="p" data-group-id="2146557388-12">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="2146557388-17">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="2146557388-18">[</span><span class="p" data-group-id="2146557388-19">{</span><span class="ss">matched</span><span class="p">,</span><span class="ss">nonode@nohost</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="2146557388-19">}</span><span class="p">,</span><span class="p" data-group-id="2146557388-20">{</span><span class="ss">saved</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="2146557388-20">}</span><span class="p" data-group-id="2146557388-18">]</span><span class="p" data-group-id="2146557388-17">}</span><span class="gp unselectable">
4&gt; </span><span class="nc">mymod</span><span class="p">:</span><span class="w"> </span><span class="c1">% TAB pressed here</span><span class="w">
</span><span class="c1">%% -- Deadlock --</span></code></pre><p>Here is another example:</p><pre><code class="makeup erlang" translate="no"><span class="c1">%% Using a shell without line editing (oldshell)</span><span class="gp unselectable">
1&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tracer</span><span class="p" data-group-id="9029812407-1">(</span><span class="ss">process</span><span class="p" data-group-id="9029812407-1">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9029812407-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.31</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="9029812407-2">}</span><span class="gp unselectable">
2&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">p</span><span class="p" data-group-id="9029812407-3">(</span><span class="ss">all</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9029812407-4">[</span><span class="ss">call</span><span class="p" data-group-id="9029812407-4">]</span><span class="p" data-group-id="9029812407-3">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9029812407-5">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="9029812407-6">[</span><span class="p" data-group-id="9029812407-7">{</span><span class="ss">matched</span><span class="p">,</span><span class="ss">nonode@nohost</span><span class="p">,</span><span class="mi">25</span><span class="p" data-group-id="9029812407-7">}</span><span class="p" data-group-id="9029812407-6">]</span><span class="p" data-group-id="9029812407-5">}</span><span class="gp unselectable">
3&gt; </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tp</span><span class="p" data-group-id="9029812407-8">(</span><span class="ss">lists</span><span class="p">,</span><span class="p" data-group-id="9029812407-9">[</span><span class="p" data-group-id="9029812407-10">{</span><span class="ss">&#39;_&#39;</span><span class="p">,</span><span class="p" data-group-id="9029812407-11">[</span><span class="p" data-group-id="9029812407-11">]</span><span class="p">,</span><span class="p" data-group-id="9029812407-12">[</span><span class="p" data-group-id="9029812407-12">]</span><span class="p" data-group-id="9029812407-10">}</span><span class="p" data-group-id="9029812407-9">]</span><span class="p" data-group-id="9029812407-8">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9029812407-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="9029812407-14">[</span><span class="p" data-group-id="9029812407-15">{</span><span class="ss">matched</span><span class="p">,</span><span class="ss">nonode@nohost</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="9029812407-15">}</span><span class="p">,</span><span class="p" data-group-id="9029812407-16">{</span><span class="ss">saved</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="9029812407-16">}</span><span class="p" data-group-id="9029812407-14">]</span><span class="p" data-group-id="9029812407-13">}</span><span class="w">
</span><span class="c1">% -- Deadlock --</span></code></pre><p>The reason we get a deadlock in the first example is because when TAB is pressed
to expand the function name, the group leader (which handles character input)
calls <code class="inline">mymod:module_info()</code>. This generates a trace message which, in turn,
causes the tracer process to send an IO request to the group leader (by calling
<a href="../../apps/stdlib/io.html#format/2"><code class="inline">io:format/2</code></a>). We end up in a deadlock.</p><p>In the second example we use the default trace handler function. This
handler prints to the tty by sending IO requests to the <code class="inline">user</code>
process. When Erlang is started in the oldshell mode, the shell
process will have <code class="inline">user</code> as its group leader and so will the tracer
process in this example. Since <code class="inline">user</code> calls functions in <code class="inline">lists</code> we
end up in a deadlock as soon as the first IO request is sent.</p><p>Here are a few suggestions for avoiding deadlock:</p><ul><li>Do not trace the group leader of the tracer process. If tracing has been
switched on for all processes, call <code class="inline">dbg:p(TracerGLPid, clear)</code> to stop tracing
the group leader (<code class="inline">TracerGLPid</code>).
<a href="../../apps/erts/erlang.html#process_info/2"><code class="inline">process_info(TracerPid, group_leader)</code></a> tells you which
process this is (<code class="inline">TracerPid</code> is returned from <a href="dbg.html#get_tracer/0"><code class="inline">dbg:get_tracer/0</code></a>).</li><li>Do not trace the <code class="inline">user</code> process if using the default trace handler function.</li><li>In your own trace handler function, call <a href="../../apps/erts/erlang.html#display/1"><code class="inline">erlang:display/1</code></a> instead of an <code class="inline">io</code>
function or, if <code class="inline">user</code> is not used as group leader, print to <code class="inline">user</code> instead of
the default group leader. Example: <code class="inline">io:format(user, Str, Args)</code>.</li></ul><p><a href="" id="help"></a></p><h2 id="getting-information-and-help" class="section-heading"><a href="#getting-information-and-help" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Getting Information and Help</span></h2><ul><li><strong><a href="dbg.html#i/0"><code class="inline">dbg:i()</code> (Information)</a>:</strong> Displays information about all currently traced processes and ports and their active trace flags.</li><li><strong><a href="dbg.html#h/0"><code class="inline">dbg:h()</code> (Help)</a>:</strong> Lists available help items.</li><li><strong><a href="dbg.html#h/1"><code class="inline">dbg:h(Item :: atom())</code></a>:</strong> Gives brief help for a specific <code class="inline">dbg</code> function or concept (e.g., <code class="inline">dbg:h(tp)</code>).</li><li><strong><a href="dbg.html#get_tracer/0"><code class="inline">dbg:get_tracer()</code></a> / 
<a href="dbg.html#get_tracer/1"><code class="inline">dbg:get_tracer(Node)</code></a>:</strong> Returns the process, port, or tracer module handling traces on the local/specified node.</li><li>Consult the <a href="dbg.html">dbg module documentation</a>.</li></ul>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="systemtap.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          â† Previous Page
        </span>
        <span class="title">
SystemTap and Erlang/OTP
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

  </div>
</div>
    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="runtime_tools.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright Â© 1996-2025 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js"></script>
  <script>
  let initialized = false;

  window.addEventListener("exdoc:loaded", () => {
      if (!initialized) {
      mermaid.initialize({
          startOnLoad: false,
          theme: document.body.className.includes("dark") ? "dark" : "default"
      });
      initialized = true;
      }

      let id = 0;
      for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
          graphEl.innerHTML = svg;
          bindFunctions?.(graphEl);
          preEl.insertAdjacentElement("afterend", graphEl);
          preEl.remove();
      });
      }
  });
  </script>

  </body>
</html>
