<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.1">
    <meta name="project" content="erl_interface v5.6">


<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=28&q=">
<meta name="major-vsn" content="28">
<link rel="canonical" href="https://www.erlang.org/doc/apps/erl_interface/ei_connect.html" />
    <title>ei_connect — erl_interface v5.6</title>

    <link rel="stylesheet" href="dist/html-erlang-ZK43ZOAC.css" />

    <script defer src="dist/sidebar_items-6AF843C2.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="erl_interface" />
        </a>

      <div>
        <a href="../../index.html" class="sidebar-projectName" translate="no">
erl_interface
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v5.6
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of erl_interface</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>ei_connect</h1>


      <a href="https://github.com/erlang/otp/blob/OTP-28.0.1/lib/erl_interface/doc/references/ei_connect.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<p>Communicate with distributed Erlang.</p><h2 id="description" class="section-heading"><a href="#description" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Description</span></h2><p>This module enables C-programs to communicate with Erlang nodes, using the
Erlang distribution over TCP/IP.</p><p>A C-node appears to Erlang as a <em>hidden node</em>. That is, Erlang processes that
know the name of the C-node can communicate with it in a normal manner, but the
node name is not shown in the listing provided by <a href="../../apps/erts/erlang.html#nodes/0"><code class="inline">erlang:nodes/0</code></a> in <code class="inline">ERTS</code>.</p><p>The environment variable <code class="inline">ERL_EPMD_PORT</code> can be used to indicate which logical
cluster a C-node belongs to.</p><h2 id="time-out-functions" class="section-heading"><a href="#time-out-functions" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Time-Out Functions</span></h2><p>Most functions appear in a version with the suffix <code class="inline">_tmo</code> appended to the
function name. Those functions take an extra argument, a time-out in
<em>milliseconds</em>. The semantics is this: for each communication primitive involved
in the operation, if the primitive does not complete within the time specified,
the function returns an error and <code class="inline">erl_errno</code> is set to <code class="inline">ETIMEDOUT</code>. With
communication primitive is meant an operation on the socket, like <code class="inline">connect</code>,
<code class="inline">accept</code>, <code class="inline">recv</code>, or <code class="inline">send</code>.</p><p>Clearly the time-outs are for implementing fault tolerance, not to keep hard
real-time promises. The <code class="inline">_tmo</code> functions are for detecting non-responsive peers
and to avoid blocking on socket operations.</p><p>A time-out value of <code class="inline">0</code> (zero) means that time-outs are disabled. Calling a
<code class="inline">_tmo</code> function with the last argument as <code class="inline">0</code> is therefore the same thing as
calling the function without the <code class="inline">_tmo</code> suffix.</p><p>As with all other functions starting with <code class="inline">ei_</code>, you are <em>not</em> expected to put
the socket in non-blocking mode yourself in the program. Every use of
non-blocking mode is embedded inside the time-out functions. The socket will
always be back in blocking mode after the operations are completed (regardless
of the result). To avoid problems, leave the socket options alone. <code class="inline">ei</code> handles
any socket options that need modification.</p><p>In all other senses, the <code class="inline">_tmo</code> functions inherit all the return values and the
semantics from the functions without the <code class="inline">_tmo</code> suffix.</p><p><a href="" id="ussi"></a></p><h2 id="user-supplied-socket-implementation" class="section-heading"><a href="#user-supplied-socket-implementation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">User Supplied Socket Implementation</span></h2><p>By default <code class="inline">ei</code> supplies a TCP/IPv4 socket interface that is used when
communicating. The user can however plug in his/her own IPv4 socket
implementation. This, for example, in order to communicate over TLS. A user
supplied socket implementation is plugged in by passing a
<a href="ei_connect.html#ei_socket_callbacks">callback structure</a> to either
<a href="ei_connect.html#ei_connect_init"><code class="inline">ei_connect_init_ussi()</code></a> or
<a href="ei_connect.html#ei_connect_init"><code class="inline">ei_connect_xinit_ussi()</code></a>.</p><p>All callbacks in the <code class="inline">ei_socket_callbacks</code> structure <em>should</em> return zero on
success; and a posix error code on failure.</p><p>The <code class="inline">addr</code> argument of the <code class="inline">listen</code>, <code class="inline">accept</code>, and <code class="inline">connect</code> callbacks refer to
appropriate address structure for currently used protocol. Currently <code class="inline">ei</code> only
supports IPv4. That is, at this time <code class="inline">addr</code> always points to a
<code class="inline">struct sockaddr_in</code> structure.</p><p><a href="" id="ei_socket_callbacks_fields"></a> The
<a href="ei_connect.html#ei_socket_callbacks"><code class="inline">ei_socket_callbacks</code></a> structure may be
enlarged in the future. All fields not set, <em>needs</em> to be zeroed out. Currently
the following fields exist:</p><ul><li><p><strong><code class="inline">flags</code></strong> - Flags informing <code class="inline">ei</code> about the behaviour of the callbacks. Flags
should be bitwise or:ed together. If no flag, is set, the <code class="inline">flags</code> field should
contain <code class="inline">0</code>. Currently, supported flags:</p><ul><li><p><strong><code class="inline">EI_SCLBK_FLG_FULL_IMPL</code></strong> - If set, the <code class="inline">accept()</code>, <code class="inline">connect()</code>,
<code class="inline">writev()</code>, <code class="inline">write()</code>, and <code class="inline">read()</code> callbacks implements timeouts. The
timeout is passed in the <code class="inline">tmo</code> argument and is given in milli seconds. Note
that the <code class="inline">tmo</code> argument to these callbacks differ from the timeout arguments
in the <code class="inline">ei</code> API. Zero means a zero timeout. That is, poll and timeout
immediately unless the operation is successful. <code class="inline">EI_SCLBK_INF_TMO</code> (max
<code class="inline">unsigned</code>) means infinite timeout. The file descriptor is in blocking mode
when a callback is called, and it must be in blocking mode when the callback
returns.</p><p>If not set, <code class="inline">ei</code> will implement the timeout using <code class="inline">select()</code> in order to
determine when to call the callbacks and when to time out. The <code class="inline">tmo</code>
arguments of the <code class="inline">accept()</code>, <code class="inline">connect()</code>, <code class="inline">writev()</code>, <code class="inline">write()</code>, and
<code class="inline">read()</code> callbacks should be ignored. The callbacks may be called in
non-blocking mode. The callbacks are not allowed to change between blocking
and non-blocking mode. In order for this to work, <code class="inline">select()</code> needs to
interact with the socket primitives used the same way as it interacts with
the ordinary socket primitives. If this is not the case, the callbacks
<em>need</em> to implement timeouts and this flag should be set.</p></li></ul><p>More flags may be introduced in the future.</p></li><li><p><strong><code class="inline">int (*socket)(void **ctx, void *setup_ctx)</code></strong> - Create a socket and a
context for the socket.</p><p>On success it should set <code class="inline">*ctx</code> to point to a context for the created socket.
This context will be passed to all other socket callbacks. This function will
be passed the same <code class="inline">setup_context</code> as passed to the preceding
<a href="ei_connect.html#ei_connect_init"><code class="inline">ei_connect_init_ussi()</code></a> or
<a href="ei_connect.html#ei_connect_init"><code class="inline">ei_connect_xinit_ussi()</code></a> call.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p>During the lifetime of a socket, the pointer <code class="inline">*ctx</code> <em>has</em> to remain the
same. That is, it cannot later be relocated.</p></section><p>This callback is mandatory.</p></li><li><p><strong><code class="inline">int (*close)(void *ctx)</code></strong> - Close the socket identified by <code class="inline">ctx</code> and
destroy the context.</p><p>This callback is mandatory.</p></li><li><p><strong><code class="inline">int (*listen)(void *ctx, void *addr, int *len, int backlog)</code></strong> - Bind the
socket identified by <code class="inline">ctx</code> to a local interface and then listen on it.</p><p>The <code class="inline">addr</code> and <code class="inline">len</code> arguments are both input and output arguments. When
called <code class="inline">addr</code> points to an address structure of length <code class="inline">*len</code> containing
information on how to bind the socket. Upon return this callback should have
updated the structure referred by <code class="inline">addr</code> with information on how the socket
actually was bound. <code class="inline">*len</code> should be updated to reflect the size of <code class="inline">*addr</code>
updated. <code class="inline">backlog</code> identifies the size of the backlog for the listen socket.</p><p>This callback is mandatory.</p></li><li><p><strong><code class="inline">int (*accept)(void **ctx, void *addr, int *len, unsigned tmo)</code></strong> - Accept
connections on the listen socket identified by <code class="inline">*ctx</code>.</p><p>When a connection is accepted, a new context for the accepted connection
should be created and <code class="inline">*ctx</code> should be updated to point to the new context for
the accepted connection. When called <code class="inline">addr</code> points to an uninitialized address
structure of length <code class="inline">*len</code>. Upon return this callback should have updated this
structure with information about the client address. <code class="inline">*len</code> should be updated
to reflect the size of <code class="inline">*addr</code> updated.</p><p>If the <code class="inline">EI_SCLBK_FLG_FULL_IMPL</code> flag has been set, <code class="inline">tmo</code> contains timeout time
in milliseconds.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p>During the lifetime of a socket, the pointer <code class="inline">*ctx</code> <em>has</em> to remain the
same. That is, it cannot later be relocated.</p></section><p>This callback is mandatory.</p></li><li><p><strong><code class="inline">int (*connect)(void *ctx, void *addr, int len, unsigned tmo)</code></strong> - Connect
the socket identified by <code class="inline">ctx</code> to the address identified by <code class="inline">addr</code>.</p><p>When called <code class="inline">addr</code> points to an address structure of length <code class="inline">len</code> containing
information on where to connect.</p><p>If the <code class="inline">EI_SCLBK_FLG_FULL_IMPL</code> flag has been set, <code class="inline">tmo</code> contains timeout time
in milliseconds.</p><p>This callback is mandatory.</p></li><li><p><strong><code class="inline">int (*writev)(void *ctx, const void *iov, long iovcnt, ssize_t *len, unsigned tmo)</code></strong> -
Write data on the connected socket identified by <code class="inline">ctx</code>.</p><p><code class="inline">iov</code> points to an array of <code class="inline">struct iovec</code> structures of length <code class="inline">iovcnt</code>
containing data to write to the socket. On success, this callback should set
<code class="inline">*len</code> to the amount of bytes successfully written on the socket.</p><p>If the <code class="inline">EI_SCLBK_FLG_FULL_IMPL</code> flag has been set, <code class="inline">tmo</code> contains timeout time
in milliseconds.</p><p>This callback is optional. Set the <code class="inline">writev</code> field in the the
<code class="inline">ei_socket_callbacks</code> structure to <code class="inline">NULL</code> if not implemented.</p></li><li><p><strong><code class="inline">int (*write)(void *ctx, const char *buf, ssize_t *len, unsigned tmo)</code></strong> -
Write data on the connected socket identified by <code class="inline">ctx</code>.</p><p>When called <code class="inline">buf</code> points to a buffer of length <code class="inline">*len</code> containing the data to
write on the socket. On success, this callback should set <code class="inline">*len</code> to the amount
of bytes successfully written on the socket.</p><p>If the <code class="inline">EI_SCLBK_FLG_FULL_IMPL</code> flag has been set, <code class="inline">tmo</code> contains timeout time
in milliseconds.</p><p>This callback is mandatory.</p></li><li><p><strong><code class="inline">int (*read)(void *ctx, char *buf, ssize_t *len, unsigned tmo)</code></strong> - Read
data on the connected socket identified by <code class="inline">ctx</code>.</p><p><code class="inline">buf</code> points to a buffer of length <code class="inline">*len</code> where the read data should be
placed. On success, this callback should update <code class="inline">*len</code> to the amount of bytes
successfully read on the socket.</p><p>If the <code class="inline">EI_SCLBK_FLG_FULL_IMPL</code> flag has been set, <code class="inline">tmo</code> contains timeout time
in milliseconds.</p><p>This callback is mandatory.</p></li><li><p><strong><code class="inline">int (*handshake_packet_header_size)(void *ctx, int *sz)</code></strong> - Inform about
handshake packet header size to use during the Erlang distribution handshake.</p><p>On success, <code class="inline">*sz</code> should be set to the handshake packet header size to use.
Valid values are <code class="inline">2</code> and <code class="inline">4</code>. Erlang TCP distribution use a handshake packet
size of <code class="inline">2</code> and Erlang TLS distribution use a handshake packet size of <code class="inline">4</code>.</p><p>This callback is mandatory.</p></li><li><p><strong><code class="inline">int (*connect_handshake_complete)(void *ctx)</code></strong> - Called when a locally
started handshake has completed successfully.</p><p>This callback is optional. Set the <code class="inline">connect_handshake_complete</code> field in the
<code class="inline">ei_socket_callbacks</code> structure to <code class="inline">NULL</code> if not implemented.</p></li><li><p><strong><code class="inline">int (*accept_handshake_complete)(void *ctx)</code></strong> - Called when a remotely
started handshake has completed successfully.</p><p>This callback is optional. Set the <code class="inline">accept_handshake_complete</code> field in the
<code class="inline">ei_socket_callbacks</code> structure to <code class="inline">NULL</code> if not implemented.</p></li><li><p><strong><code class="inline">int (*get_fd)(void *ctx, int *fd)</code></strong> - Inform about file descriptor used by
the socket which is identified by <code class="inline">ctx</code>.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p>During the lifetime of a socket, the file descriptor <em>has</em> to remain the
same. That is, repeated calls to this callback with the same context
<code class="inline">should</code> always report the same file descriptor.</p><p>The file descriptor <em>has</em> to be a real file descriptor. That is, no other
operation should be able to get the same file descriptor until it has been
released by the <code class="inline">close()</code> callback.</p></section><p>This callback is mandatory.</p></li></ul><h2 id="data-types" class="section-heading"><a href="#data-types" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Data Types</span></h2><ul><li><p><strong><code class="inline" id="ei_cnode">ei_cnode</code></strong> - Opaque data type representing a C-node. A
<code class="inline">ei_cnode</code> structure is initialized by calling
<a href="ei_connect.html#ei_connect_init"><code class="inline">ei_connect_init()</code></a> or friends.</p></li><li><p><strong><code class="inline" id="ei_socket_callbacks">ei_socket_callbacks</code></strong></p><pre><code class="makeup c" translate="no"><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p" data-group-id="5514286244-1">{</span><span class="w">
    </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">;</span><span class="w">
    </span><span class="kt">int</span><span class="w"> </span><span class="p" data-group-id="5514286244-2">(</span><span class="o">*</span><span class="n">socket</span><span class="p" data-group-id="5514286244-2">)</span><span class="p" data-group-id="5514286244-3">(</span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="o">*</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">setup_ctx</span><span class="p" data-group-id="5514286244-3">)</span><span class="p">;</span><span class="w">
    </span><span class="kt">int</span><span class="w">   </span><span class="p" data-group-id="5514286244-4">(</span><span class="o">*</span><span class="n">close</span><span class="p" data-group-id="5514286244-4">)</span><span class="p" data-group-id="5514286244-5">(</span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p" data-group-id="5514286244-5">)</span><span class="p">;</span><span class="w">
    </span><span class="kt">int</span><span class="w"> </span><span class="p" data-group-id="5514286244-6">(</span><span class="o">*</span><span class="n">listen</span><span class="p" data-group-id="5514286244-6">)</span><span class="p" data-group-id="5514286244-7">(</span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">backlog</span><span class="p" data-group-id="5514286244-7">)</span><span class="p">;</span><span class="w">
    </span><span class="kt">int</span><span class="w"> </span><span class="p" data-group-id="5514286244-8">(</span><span class="o">*</span><span class="n">accept</span><span class="p" data-group-id="5514286244-8">)</span><span class="p" data-group-id="5514286244-9">(</span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="o">*</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">tmo</span><span class="p" data-group-id="5514286244-9">)</span><span class="p">;</span><span class="w">
    </span><span class="kt">int</span><span class="w"> </span><span class="p" data-group-id="5514286244-10">(</span><span class="o">*</span><span class="n">connect</span><span class="p" data-group-id="5514286244-10">)</span><span class="p" data-group-id="5514286244-11">(</span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">tmo</span><span class="p" data-group-id="5514286244-11">)</span><span class="p">;</span><span class="w">
    </span><span class="kt">int</span><span class="w"> </span><span class="p" data-group-id="5514286244-12">(</span><span class="o">*</span><span class="n">writev</span><span class="p" data-group-id="5514286244-12">)</span><span class="p" data-group-id="5514286244-13">(</span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">iov</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">iovcnt</span><span class="p">,</span><span class="w"> </span><span class="n">ssize_t</span><span class="w"> </span><span class="o">*</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">tmo</span><span class="p" data-group-id="5514286244-13">)</span><span class="p">;</span><span class="w">
    </span><span class="kt">int</span><span class="w"> </span><span class="p" data-group-id="5514286244-14">(</span><span class="o">*</span><span class="n">write</span><span class="p" data-group-id="5514286244-14">)</span><span class="p" data-group-id="5514286244-15">(</span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">ssize_t</span><span class="w"> </span><span class="o">*</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">tmo</span><span class="p" data-group-id="5514286244-15">)</span><span class="p">;</span><span class="w">
    </span><span class="kt">int</span><span class="w"> </span><span class="p" data-group-id="5514286244-16">(</span><span class="o">*</span><span class="n">read</span><span class="p" data-group-id="5514286244-16">)</span><span class="p" data-group-id="5514286244-17">(</span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">ssize_t</span><span class="w"> </span><span class="o">*</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">tmo</span><span class="p" data-group-id="5514286244-17">)</span><span class="p">;</span><span class="w">
    </span><span class="kt">int</span><span class="w"> </span><span class="p" data-group-id="5514286244-18">(</span><span class="o">*</span><span class="n">handshake_packet_header_size</span><span class="p" data-group-id="5514286244-18">)</span><span class="p" data-group-id="5514286244-19">(</span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">sz</span><span class="p" data-group-id="5514286244-19">)</span><span class="p">;</span><span class="w">
    </span><span class="kt">int</span><span class="w"> </span><span class="p" data-group-id="5514286244-20">(</span><span class="o">*</span><span class="n">connect_handshake_complete</span><span class="p" data-group-id="5514286244-20">)</span><span class="p" data-group-id="5514286244-21">(</span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p" data-group-id="5514286244-21">)</span><span class="p">;</span><span class="w">
    </span><span class="kt">int</span><span class="w"> </span><span class="p" data-group-id="5514286244-22">(</span><span class="o">*</span><span class="n">accept_handshake_complete</span><span class="p" data-group-id="5514286244-22">)</span><span class="p" data-group-id="5514286244-23">(</span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p" data-group-id="5514286244-23">)</span><span class="p">;</span><span class="w">
    </span><span class="kt">int</span><span class="w"> </span><span class="p" data-group-id="5514286244-24">(</span><span class="o">*</span><span class="n">get_fd</span><span class="p" data-group-id="5514286244-24">)</span><span class="p" data-group-id="5514286244-25">(</span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">fd</span><span class="p" data-group-id="5514286244-25">)</span><span class="p">;</span><span class="w">
</span><span class="p" data-group-id="5514286244-1">}</span><span class="w"> </span><span class="n">ei_socket_callbacks</span><span class="p">;</span></code></pre><p>Callbacks functions for a
<a href="ei_connect.html#ussi"><em>User Supplied Socket Implementation</em></a>.
<a href="ei_connect.html#ei_socket_callbacks_fields">Documentation of each field</a> can be
found in the <em>User Supplied Socket Implementation</em> section above.</p></li><li><p><strong><code class="inline" id="ErlConnect">ErlConnect</code></strong></p><pre><code class="makeup c" translate="no"><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p" data-group-id="6954229627-1">{</span><span class="w">
    </span><span class="kt">char</span><span class="w"> </span><span class="n">ipadr</span><span class="p" data-group-id="6954229627-2">[</span><span class="mi">4</span><span class="p" data-group-id="6954229627-2">]</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Ip v4 address in network byte order */</span><span class="w">
    </span><span class="kt">char</span><span class="w"> </span><span class="n">nodename</span><span class="p" data-group-id="6954229627-3">[</span><span class="no">MAXNODELEN</span><span class="p" data-group-id="6954229627-3">]</span><span class="p">;</span><span class="w">
</span><span class="p" data-group-id="6954229627-1">}</span><span class="w"> </span><span class="no">ErlConnect</span><span class="p">;</span></code></pre><p>IP v4 address and nodename.</p></li><li><p><strong><code class="inline" id="Erl_IpAddr">Erl_IpAddr</code></strong></p><pre><code class="makeup c" translate="no"><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p" data-group-id="3495987898-1">{</span><span class="w">
    </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">s_addr</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Ip v4 address in network byte order */</span><span class="w">
</span><span class="p" data-group-id="3495987898-1">}</span><span class="w"> </span><span class="no">Erl_IpAddr</span><span class="p">;</span></code></pre><p>IP v4 address.</p></li><li><p><strong><code class="inline" id="erlang_msg">erlang_msg</code></strong></p><pre><code class="makeup c" translate="no"><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p" data-group-id="7405435654-1">{</span><span class="w">
    </span><span class="kt">long</span><span class="w"> </span><span class="n">msgtype</span><span class="p">;</span><span class="w">
    </span><span class="n">erlang_pid</span><span class="w"> </span><span class="n">from</span><span class="p">;</span><span class="w">
    </span><span class="n">erlang_pid</span><span class="w"> </span><span class="n">to</span><span class="p">;</span><span class="w">
    </span><span class="kt">char</span><span class="w"> </span><span class="n">toname</span><span class="p" data-group-id="7405435654-2">[</span><span class="no">MAXATOMLEN</span><span class="o">+</span><span class="mi">1</span><span class="p" data-group-id="7405435654-2">]</span><span class="p">;</span><span class="w">
    </span><span class="kt">char</span><span class="w"> </span><span class="n">cookie</span><span class="p" data-group-id="7405435654-3">[</span><span class="no">MAXATOMLEN</span><span class="o">+</span><span class="mi">1</span><span class="p" data-group-id="7405435654-3">]</span><span class="p">;</span><span class="w">
    </span><span class="n">erlang_trace</span><span class="w"> </span><span class="n">token</span><span class="p">;</span><span class="w">
</span><span class="p" data-group-id="7405435654-1">}</span><span class="w"> </span><span class="n">erlang_msg</span><span class="p">;</span></code></pre><p>Information about a message received via
<a href="ei_connect.html#ei_receive_msg"><code class="inline">ei_receive_msg()</code></a> or friends.</p></li></ul><h2 id="ei_gethostbyaddr" class="section-heading"><a href="#ei_gethostbyaddr" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_gethostbyaddr()</span></h2><h2 id="ei_gethostbyaddr_r" class="section-heading"><a href="#ei_gethostbyaddr_r" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_gethostbyaddr_r()</span></h2><h2 id="ei_gethostbyname" class="section-heading"><a href="#ei_gethostbyname" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_gethostbyname()</span></h2><h2 id="ei_gethostbyname_r" class="section-heading"><a href="#ei_gethostbyname_r" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_gethostbyname_r()</span></h2><pre><code class="makeup c" translate="no"><span class="k">struct</span><span class="w"> </span><span class="n">hostent</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">ei_gethostbyaddr</span><span class="p" data-group-id="0142957588-1">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">type</span><span class="p" data-group-id="0142957588-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="k">struct</span><span class="w"> </span><span class="n">hostent</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">ei_gethostbyaddr_r</span><span class="p" data-group-id="4158026858-1">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w">
  </span><span class="k">struct</span><span class="w"> </span><span class="n">hostent</span><span class="w"> </span><span class="o">*</span><span class="n">hostp</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">,</span><span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">buflen</span><span class="p">,</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">h_errnop</span><span class="p" data-group-id="4158026858-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="k">struct</span><span class="w"> </span><span class="n">hostent</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">ei_gethostbyname</span><span class="p" data-group-id="3807607931-1">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p" data-group-id="3807607931-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="k">struct</span><span class="w"> </span><span class="n">hostent</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">ei_gethostbyname_r</span><span class="p" data-group-id="0243293087-1">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="n">hostent</span><span class="w"> </span><span class="o">*</span><span class="n">hostp</span><span class="p">,</span><span class="w">
  </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">,</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">buflen</span><span class="p">,</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">h_errnop</span><span class="p" data-group-id="0243293087-1">)</span><span class="p">;</span></code></pre><p>Convenience functions for some common name lookup functions.</p><h2 id="ei_accept" class="section-heading"><a href="#ei_accept" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_accept()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_accept</span><span class="p" data-group-id="4125815431-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">listensock</span><span class="p">,</span><span class="w"> </span><span class="no">ErlConnect</span><span class="w"> </span><span class="o">*</span><span class="n">conp</span><span class="p" data-group-id="4125815431-1">)</span><span class="p">;</span></code></pre><p>Used by a server process to accept a connection from a client process.</p><ul><li><code class="inline">ec</code> is the C-node structure.</li><li><code class="inline">listensock</code> is an open socket descriptor on which <code class="inline">listen()</code> has previously
been called.</li><li><code class="inline">conp</code> is a pointer to an <a href="ei_connect.html#ErlConnect"><code class="inline">ErlConnect</code></a> struct.</li></ul><p>On success, <code class="inline">conp</code> is filled in with the address and node name of the connecting
client and a file descriptor is returned. On failure, <code class="inline">ERL_ERROR</code> is returned
and <code class="inline">erl_errno</code> is set to <code class="inline">EIO</code>.</p><h2 id="ei_accept_tmo" class="section-heading"><a href="#ei_accept_tmo" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_accept_tmo()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_accept_tmo</span><span class="p" data-group-id="3658241916-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">listensock</span><span class="p">,</span><span class="w"> </span><span class="no">ErlConnect</span><span class="w"> </span><span class="o">*</span><span class="n">conp</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">timeout_ms</span><span class="p" data-group-id="3658241916-1">)</span><span class="p">;</span></code></pre><p>Equivalent to <code class="inline">ei_accept</code> with an optional time-out argument, see the
description at the beginning of this manual page.</p><h2 id="ei_close_connection" class="section-heading"><a href="#ei_close_connection" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_close_connection()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_close_connection</span><span class="p" data-group-id="6090058024-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p" data-group-id="6090058024-1">)</span><span class="p">;</span></code></pre><p>Closes a previously opened connection or listen socket.</p><p>Available since OTP 21.3</p><h2 id="ei_connect" class="section-heading"><a href="#ei_connect" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_connect()</span></h2><h2 id="ei_xconnect" class="section-heading"><a href="#ei_xconnect" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_xconnect()</span></h2><h2 id="ei_connect_host_port" class="section-heading"><a href="#ei_connect_host_port" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_connect_host_port()</span></h2><p>Available since OTP 23.0</p><h2 id="ei_xconnect_host_port" class="section-heading"><a href="#ei_xconnect_host_port" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_xconnect_host_port()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_connect</span><span class="p" data-group-id="2230992955-1">(</span><span class="n">ei_cnode</span><span class="o">*</span><span class="w"> </span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">nodename</span><span class="p" data-group-id="2230992955-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_xconnect</span><span class="p" data-group-id="6748357985-1">(</span><span class="n">ei_cnode</span><span class="o">*</span><span class="w"> </span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="no">Erl_IpAddr</span><span class="w"> </span><span class="n">adr</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">alivename</span><span class="p" data-group-id="6748357985-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_connect_host_port</span><span class="p" data-group-id="3657954380-1">(</span><span class="n">ei_cnode</span><span class="o">*</span><span class="w"> </span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">hostname</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p" data-group-id="3657954380-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_xconnect_host_port</span><span class="p" data-group-id="2993819634-1">(</span><span class="n">ei_cnode</span><span class="o">*</span><span class="w"> </span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="no">Erl_IpAddr</span><span class="w"> </span><span class="n">adr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p" data-group-id="2993819634-1">)</span><span class="p">;</span></code></pre><p>Sets up a connection to an Erlang node.</p><p><code class="inline">ei_xconnect()</code> requires the IP address of the remote host and the alive name of
the remote node to be specified. <code class="inline">ei_connect()</code> provides an alternative
interface and determines the information from the node name provided. The
<code class="inline">ei_xconnect_host_port()</code> function provides yet another alternative that will
work even if there is no EPMD instance on the host where the remote node is
running. The <code class="inline">ei_xconnect_host_port()</code> function requires the IP address and port
of the remote node to be specified. The <code class="inline">ei_connect_host_port()</code> function is an
alternative to <code class="inline">ei_xconnect_host_port()</code> that lets the user specify a hostname
instead of an IP address.</p><ul><li><code class="inline">adr</code> is the 32-bit IP address of the remote host.</li><li><code class="inline">alive</code> is the alivename of the remote node.</li><li><code class="inline">node</code> is the name of the remote node.</li><li><code class="inline">port</code> is the port number of the remote node.</li></ul><p>These functions return an open file descriptor on success, or a negative value
indicating that an error occurred. In the latter case they set <code class="inline">erl_errno</code> to
one of the following:</p><ul><li><p><strong><code class="inline">EHOSTUNREACH</code></strong> - The remote host <code class="inline">node</code> is unreachable.</p></li><li><p><strong><code class="inline">ENOMEM</code></strong> - No more memory is available.</p></li><li><p><strong><code class="inline">EIO</code></strong> - I/O error.</p></li></ul><p>Also, <code class="inline">errno</code> values from <code class="inline">socket(2)</code> and <code class="inline">connect(2)</code> system calls may be
propagated into <code class="inline">erl_errno</code>.</p><p><em>Example:</em></p><pre><code class="makeup c" translate="no"><span class="kp">#define</span><span class="w"> </span><span class="no">NODE</span><span class="w">   </span><span class="s">&quot;madonna@chivas.du.etx.ericsson.se&quot;</span><span class="w">
</span><span class="kp">#define</span><span class="w"> </span><span class="no">ALIVE</span><span class="w">  </span><span class="s">&quot;madonna&quot;</span><span class="w">
</span><span class="kp">#define</span><span class="w"> </span><span class="no">IP_ADDR</span><span class="w"> </span><span class="s">&quot;150.236.14.75&quot;</span><span class="w">

</span><span class="cm">/*** Variant 1 ***/</span><span class="w">
</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ei_connect</span><span class="p" data-group-id="1982115173-1">(</span><span class="o">&amp;</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="no">NODE</span><span class="p" data-group-id="1982115173-1">)</span><span class="p">;</span><span class="w">

</span><span class="cm">/*** Variant 2 ***/</span><span class="w">
</span><span class="k">struct</span><span class="w"> </span><span class="n">in_addr</span><span class="w"> </span><span class="n">addr</span><span class="p">;</span><span class="w">
</span><span class="n">addr</span><span class="p">.</span><span class="n">s_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">inet_addr</span><span class="p" data-group-id="1982115173-2">(</span><span class="no">IP_ADDR</span><span class="p" data-group-id="1982115173-2">)</span><span class="p">;</span><span class="w">
</span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ei_xconnect</span><span class="p" data-group-id="1982115173-3">(</span><span class="o">&amp;</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="no">ALIVE</span><span class="p" data-group-id="1982115173-3">)</span><span class="p">;</span></code></pre><p>Available since OTP 23.0</p><h2 id="ei_connect_init" class="section-heading"><a href="#ei_connect_init" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_connect_init()</span></h2><h2 id="ei_connect_init_ussi" class="section-heading"><a href="#ei_connect_init_ussi" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_connect_init_ussi()</span></h2><p>Available since OTP 21.3</p><h2 id="ei_connect_xinit" class="section-heading"><a href="#ei_connect_xinit" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_connect_xinit()</span></h2><h2 id="ei_connect_xinit_ussi" class="section-heading"><a href="#ei_connect_xinit_ussi" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_connect_xinit_ussi()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_connect_init</span><span class="p" data-group-id="2859989839-1">(</span><span class="n">ei_cnode</span><span class="o">*</span><span class="w"> </span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">this_node_name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">cookie</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">creation</span><span class="p" data-group-id="2859989839-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_connect_init_ussi</span><span class="p" data-group-id="6117637255-1">(</span><span class="n">ei_cnode</span><span class="o">*</span><span class="w"> </span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">this_node_name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">cookie</span><span class="p">,</span><span class="w">
  </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">creation</span><span class="p">,</span><span class="w"> </span><span class="n">ei_socket_callbacks</span><span class="w"> </span><span class="o">*</span><span class="n">cbs</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">cbs_sz</span><span class="p">,</span><span class="w"> </span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">setup_context</span><span class="p" data-group-id="6117637255-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_connect_xinit</span><span class="p" data-group-id="9046496776-1">(</span><span class="n">ei_cnode</span><span class="o">*</span><span class="w"> </span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">thishostname</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">thisalivename</span><span class="p">,</span><span class="w">
  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">thisnodename</span><span class="p">,</span><span class="w"> </span><span class="no">Erl_IpAddr</span><span class="w"> </span><span class="n">thisipaddr</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">cookie</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">creation</span><span class="p" data-group-id="9046496776-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_connect_xinit_ussi</span><span class="p" data-group-id="6412955926-1">(</span><span class="n">ei_cnode</span><span class="o">*</span><span class="w"> </span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">thishostname</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">thisalivename</span><span class="p">,</span><span class="w">
  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">thisnodename</span><span class="p">,</span><span class="w"> </span><span class="no">Erl_IpAddr</span><span class="w"> </span><span class="n">thisipaddr</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">cookie</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">creation</span><span class="p">,</span><span class="w">
  </span><span class="n">ei_socket_callbacks</span><span class="w"> </span><span class="o">*</span><span class="n">cbs</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">cbs_sz</span><span class="p">,</span><span class="w"> </span><span class="kc">void</span><span class="w"> </span><span class="o">*</span><span class="n">setup_context</span><span class="p" data-group-id="6412955926-1">)</span><span class="p">;</span></code></pre><p>Initializes the <code class="inline">ec</code> structure, to identify the node name and cookie of the
server. One of them must be called before other functions that works on the
<code class="inline">ei_cnode</code> type or a file descriptor associated with a connection to another
node is used.</p><ul><li><p><code class="inline">ec</code> is a structure containing information about the C-node. It is used in
other <code class="inline">ei</code> functions for connecting and receiving data.</p></li><li><p><code class="inline">this_node_name</code> is the name of the C-node (the name before '@' in the full
node name).</p></li><li><p><code class="inline">cookie</code> is the cookie for the node.</p></li><li><p><code class="inline">creation</code> identifies a specific instance of a C-node. It can help prevent the
node from receiving messages sent to an earlier process with the same
registered name.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p>The type of the <code class="inline">creation</code> argument was changed from <code class="inline">short</code> (16 bit) to
<code class="inline">unsigned int</code> (32 bit) in OTP 25. This should cause no practical problem
other than maybe a compiler warning.</p></section></li><li><p><code class="inline">thishostname</code> is the name of the machine we are running on. If long names are
to be used, they are to be fully qualified (that is, <code class="inline">durin.erix.ericsson.se</code>
instead of <code class="inline">durin</code>).</p></li><li><p><code class="inline">thisalivename</code> is the name of the local C-node (the name before '@' in the
full node name). Can be <code class="inline">NULL</code> (from OTP 23) to get a dynamically assigned
name from the peer node.</p></li><li><p><code class="inline">thisnodename</code> is the full name of the local C-node, that is, <code class="inline">mynode@myhost</code>.
Can be <code class="inline">NULL</code> if <code class="inline">thisalivename</code> is <code class="inline">NULL</code>.</p></li><li><p><code class="inline">thispaddr</code> if the IP address of the host.</p></li><li><p><code class="inline">cbs</code> is a pointer to a
<a href="ei_connect.html#ei_socket_callbacks">callback structure</a> implementing and
alternative socket interface.</p></li><li><p><code class="inline">cbs_sz</code> is the size of the structure pointed to by <code class="inline">cbs</code>.</p></li><li><p><code class="inline">setup_context</code> is a pointer to a structure that will be passed as second
argument to the <code class="inline">socket</code> callback in the <code class="inline">cbs</code> structure.</p></li></ul><p>A C-node acting as a server is assigned a creation number when it calls
<code class="inline">ei_publish()</code>.</p><p>A connection is closed by simply closing the socket. For information about how
to close the socket gracefully (when there are outgoing packets before close),
see the relevant system documentation.</p><p>These functions return a negative value indicating that an error occurred.</p><p><em>Example 1:</em></p><pre><code class="makeup c" translate="no"><span class="kt">unsigned</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="k">struct</span><span class="w"> </span><span class="n">in_addr</span><span class="w"> </span><span class="n">addr</span><span class="p">;</span><span class="w">
</span><span class="n">ei_cnode</span><span class="w"> </span><span class="n">ec</span><span class="p">;</span><span class="w">
</span><span class="n">addr</span><span class="p">.</span><span class="n">s_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">inet_addr</span><span class="p" data-group-id="3307910003-1">(</span><span class="s">&quot;150.236.14.75&quot;</span><span class="p" data-group-id="3307910003-1">)</span><span class="p">;</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p" data-group-id="3307910003-2">(</span><span class="nf">ei_connect_xinit</span><span class="p" data-group-id="3307910003-3">(</span><span class="o">&amp;</span><span class="n">ec</span><span class="p">,</span><span class="w">
                     </span><span class="s">&quot;chivas&quot;</span><span class="p">,</span><span class="w">
                     </span><span class="s">&quot;madonna&quot;</span><span class="p">,</span><span class="w">
                     </span><span class="s">&quot;madonna@chivas.du.etx.ericsson.se&quot;</span><span class="p">,</span><span class="w">
                     </span><span class="o">&amp;</span><span class="n">addr</span><span class="p">;</span><span class="w">
                     </span><span class="s">&quot;cookie...&quot;</span><span class="p">,</span><span class="w">
                     </span><span class="n">n</span><span class="o">++</span><span class="p" data-group-id="3307910003-3">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="3307910003-2">)</span><span class="w"> </span><span class="p" data-group-id="3307910003-4">{</span><span class="w">
    </span><span class="nf">fprintf</span><span class="p" data-group-id="3307910003-5">(</span><span class="n">stderr</span><span class="p">,</span><span class="s">&quot;ERROR when initializing: %d&quot;</span><span class="p">,</span><span class="n">erl_errno</span><span class="p" data-group-id="3307910003-5">)</span><span class="p">;</span><span class="w">
    </span><span class="nf">exit</span><span class="p" data-group-id="3307910003-6">(</span><span class="o">-</span><span class="mi">1</span><span class="p" data-group-id="3307910003-6">)</span><span class="p">;</span><span class="w">
</span><span class="p" data-group-id="3307910003-4">}</span></code></pre><p><em>Example 2:</em></p><pre><code class="makeup c" translate="no"><span class="k">if</span><span class="w"> </span><span class="p" data-group-id="8849539713-1">(</span><span class="nf">ei_connect_init</span><span class="p" data-group-id="8849539713-2">(</span><span class="o">&amp;</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;madonna&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cookie...&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">++</span><span class="p" data-group-id="8849539713-2">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="8849539713-1">)</span><span class="w"> </span><span class="p" data-group-id="8849539713-3">{</span><span class="w">
    </span><span class="nf">fprintf</span><span class="p" data-group-id="8849539713-4">(</span><span class="n">stderr</span><span class="p">,</span><span class="s">&quot;ERROR when initializing: %d&quot;</span><span class="p">,</span><span class="n">erl_errno</span><span class="p" data-group-id="8849539713-4">)</span><span class="p">;</span><span class="w">
    </span><span class="nf">exit</span><span class="p" data-group-id="8849539713-5">(</span><span class="o">-</span><span class="mi">1</span><span class="p" data-group-id="8849539713-5">)</span><span class="p">;</span><span class="w">
</span><span class="p" data-group-id="8849539713-3">}</span></code></pre><p>Available since OTP 21.3</p><h2 id="ei_connect_tmo" class="section-heading"><a href="#ei_connect_tmo" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_connect_tmo()</span></h2><h2 id="ei_xconnect_tmo" class="section-heading"><a href="#ei_xconnect_tmo" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_xconnect_tmo()</span></h2><h2 id="ei_connect_host_port_tmo" class="section-heading"><a href="#ei_connect_host_port_tmo" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_connect_host_port_tmo()</span></h2><p>Available since OTP 23.0</p><h2 id="ei_xconnect_host_port_tmo" class="section-heading"><a href="#ei_xconnect_host_port_tmo" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_xconnect_host_port_tmo()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_connect_tmo</span><span class="p" data-group-id="9758929889-1">(</span><span class="n">ei_cnode</span><span class="o">*</span><span class="w"> </span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">nodename</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">timeout_ms</span><span class="p" data-group-id="9758929889-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_xconnect_tmo</span><span class="p" data-group-id="2213586391-1">(</span><span class="n">ei_cnode</span><span class="o">*</span><span class="w"> </span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="no">Erl_IpAddr</span><span class="w"> </span><span class="n">adr</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">alivename</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">timeout_ms</span><span class="p" data-group-id="2213586391-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_connect_host_port_tmo</span><span class="p" data-group-id="5927030583-1">(</span><span class="n">ei_cnode</span><span class="o">*</span><span class="w"> </span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">hostname</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">ms</span><span class="p" data-group-id="5927030583-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_xconnect_host_port_tmo</span><span class="p" data-group-id="1340990247-1">(</span><span class="n">ei_cnode</span><span class="o">*</span><span class="w"> </span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="no">Erl_IpAddr</span><span class="w"> </span><span class="n">adr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">ms</span><span class="p" data-group-id="1340990247-1">)</span><span class="p">;</span></code></pre><p>Equivalent to <code class="inline">ei_connect</code>, <code class="inline">ei_xconnect</code>, <code class="inline">ei_connect_host_port</code> and
<code class="inline">ei_xconnect_host_port</code> with an optional time-out argument, see the description
at the beginning of this manual page.</p><p>Available since OTP 23.0</p><h2 id="ei_get_tracelevel" class="section-heading"><a href="#ei_get_tracelevel" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_get_tracelevel()</span></h2><p>Available since OTP R13B04</p><h2 id="ei_set_tracelevel" class="section-heading"><a href="#ei_set_tracelevel" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_set_tracelevel()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_get_tracelevel</span><span class="p" data-group-id="6396292283-1">(</span><span class="kc">void</span><span class="p" data-group-id="6396292283-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kc">void</span><span class="w"> </span><span class="nf">ei_set_tracelevel</span><span class="p" data-group-id="1450207373-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">level</span><span class="p" data-group-id="1450207373-1">)</span><span class="p">;</span></code></pre><p>Used to set tracing on the distribution. The levels are different verbosity
levels. A higher level means more information. See also section
<a href="ei_connect.html#debug_information">Debug Information</a>.</p><p>These functions are not thread safe.</p><p>Available since OTP R13B04</p><h2 id="ei_listen" class="section-heading"><a href="#ei_listen" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_listen()</span></h2><p>Available since OTP 21.3</p><h2 id="ei_xlisten" class="section-heading"><a href="#ei_xlisten" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_xlisten()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_listen</span><span class="p" data-group-id="2540861206-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">port</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">backlog</span><span class="p" data-group-id="2540861206-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_xlisten</span><span class="p" data-group-id="1289429546-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="no">Erl_IpAddr</span><span class="w"> </span><span class="n">adr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">port</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">backlog</span><span class="p" data-group-id="1289429546-1">)</span><span class="p">;</span></code></pre><p>Used by a server process to setup a listen socket which later can be used for
accepting connections from client processes.</p><ul><li><code class="inline">ec</code> is the C-node structure.</li><li><code class="inline">adr</code> is local interface to bind to.</li><li><code class="inline">port</code> is a pointer to an integer containing the port number to bind to. If
<code class="inline">*port</code> equals <code class="inline">0</code> when calling <code class="inline">ei_listen()</code>, the socket will be bound to an
ephemeral port. On success, <code class="inline">ei_listen()</code> will update the value of <code class="inline">*port</code> to
the port actually bound to.</li><li><code class="inline">backlog</code> is maximum backlog of pending connections.</li></ul><p><code class="inline">ei_listen</code> will create a socket, bind to a port on the local interface
identified by <code class="inline">adr</code> (or all local interfaces if <code class="inline">ei_listen()</code> is called), and
mark the socket as a passive socket (that is, a socket that will be used for
accepting incoming connections).</p><p>On success, a file descriptor is returned which can be used in a call to
<code class="inline">ei_accept()</code>. On failure, <code class="inline">ERL_ERROR</code> is returned and <code class="inline">erl_errno</code> is set to
<code class="inline">EIO</code>.</p><p>Available since OTP 21.3</p><h2 id="ei_make_pid" class="section-heading"><a href="#ei_make_pid" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_make_pid()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_make_pid</span><span class="p" data-group-id="8587698586-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="n">erlang_pid</span><span class="w"> </span><span class="o">*</span><span class="n">pid</span><span class="p" data-group-id="8587698586-1">)</span><span class="p">;</span></code></pre><p>Creates a new process identifier in the argument <code class="inline">pid</code>. This process identifier
refers to a conseptual process residing on the C-node identified by the argument
<code class="inline">ec</code>. On success <code class="inline">0</code> is returned. On failure <code class="inline">ERL_ERROR</code> is returned and
<code class="inline">erl_errno</code> is set.</p><p>The C-node identified by <code class="inline">ec</code> must have been initialized and must have received
a name prior to the call to <code class="inline">ei_make_pid()</code>. Initialization of the C-node is
done by a call to <a href="ei_connect.html#ei_connect_init"><code class="inline">ei_connect_init()</code></a> or
friends. If the name is dynamically assigned from the peer node, the C-node also
has to be connected.</p><p>Available since OTP 23.0</p><h2 id="ei_make_ref" class="section-heading"><a href="#ei_make_ref" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_make_ref()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_make_ref</span><span class="p" data-group-id="0666793882-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="n">erlang_ref</span><span class="w"> </span><span class="o">*</span><span class="n">ref</span><span class="p" data-group-id="0666793882-1">)</span><span class="p">;</span></code></pre><p>Creates a new reference in the argument <code class="inline">ref</code>. This reference originates from
the C-node identified by the argument <code class="inline">ec</code>. On success <code class="inline">0</code> is returned. On
failure <code class="inline">ERL_ERROR</code> is returned and <code class="inline">erl_errno</code> is set.</p><p>The C-node identified by <code class="inline">ec</code> must have been initialized and must have received
a name prior to the call to <code class="inline">ei_make_ref()</code>. Initialization of the C-node is
done by a call to <a href="ei_connect.html#ei_connect_init"><code class="inline">ei_connect_init()</code></a> or
friends. If the name is dynamically assigned from the peer node, the C-node also
has to be connected.</p><p>Available since OTP 23.0</p><h2 id="ei_publish" class="section-heading"><a href="#ei_publish" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_publish()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_publish</span><span class="p" data-group-id="8391101431-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p" data-group-id="8391101431-1">)</span><span class="p">;</span></code></pre><p>Used by a server process to register with the local name server EPMD, thereby
allowing other processes to send messages by using the registered name. Before
calling either of these functions, the process should have called <code class="inline">bind()</code> and
<code class="inline">listen()</code> on an open socket.</p><ul><li><code class="inline">ec</code> is the C-node structure.</li><li><code class="inline">port</code> is the local name to register, and is to be the same as the port number
that was previously bound to the socket.</li><li><code class="inline">addr</code> is the 32-bit IP address of the local host.</li></ul><p>To unregister with EPMD, simply close the returned descriptor. Do not use
<code class="inline">ei_unpublish()</code>, which is deprecated anyway.</p><p>On success, the function returns a descriptor connecting the calling process to
EPMD. On failure, <code class="inline">-1</code> is returned and <code class="inline">erl_errno</code> is set to <code class="inline">EIO</code>.</p><p>Also, <code class="inline">errno</code> values from <code class="inline">socket(2)</code> and <code class="inline">connect(2)</code> system calls may be
propagated into <code class="inline">erl_errno</code>.</p><h2 id="ei_publish_tmo" class="section-heading"><a href="#ei_publish_tmo" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_publish_tmo()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_publish_tmo</span><span class="p" data-group-id="2383149912-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">timeout_ms</span><span class="p" data-group-id="2383149912-1">)</span><span class="p">;</span></code></pre><p>Equivalent to <code class="inline">ei_publish</code> with an optional time-out argument, see the
description at the beginning of this manual page.</p><h2 id="ei_receive" class="section-heading"><a href="#ei_receive" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_receive()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_receive</span><span class="p" data-group-id="1877554384-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">bufp</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bufsize</span><span class="p" data-group-id="1877554384-1">)</span><span class="p">;</span></code></pre><p>Receives a message consisting of a sequence of bytes in the Erlang external
format.</p><ul><li><code class="inline">fd</code> is an open descriptor to an Erlang connection. It is obtained from a
previous <code class="inline">ei_connect</code> or <code class="inline">ei_accept</code>.</li><li><code class="inline">bufp</code> is a buffer large enough to hold the expected message.</li><li><code class="inline">bufsize</code> indicates the size of <code class="inline">bufp</code>.</li></ul><p>If a <em>tick</em> occurs, that is, the Erlang node on the other end of the connection
has polled this node to see if it is still alive, the function returns
<code class="inline">ERL_TICK</code> and no message is placed in the buffer. Also, <code class="inline">erl_errno</code> is set to
<code class="inline">EAGAIN</code>.</p><p>On success, the message is placed in the specified buffer and the function
returns the number of bytes actually read. On failure, the function returns
<code class="inline">ERL_ERROR</code> and sets <code class="inline">erl_errno</code> to one of the following:</p><ul><li><p><strong><code class="inline">EAGAIN</code></strong> - Temporary error: Try again.</p></li><li><p><strong><code class="inline">EMSGSIZE</code></strong> - Buffer is too small.</p></li><li><p><strong><code class="inline">EIO</code></strong> - I/O error.</p></li></ul><h2 id="ei_receive_encoded" class="section-heading"><a href="#ei_receive_encoded" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_receive_encoded()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_receive_encoded</span><span class="p" data-group-id="8002847013-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="o">*</span><span class="n">mbufp</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">bufsz</span><span class="p">,</span><span class="w">  </span><span class="n">erlang_msg</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">msglen</span><span class="p" data-group-id="8002847013-1">)</span><span class="p">;</span></code></pre><p>This function is retained for compatibility with code generated by the interface
compiler and with code following examples in the same application.</p><p>In essence, the function performs the same operation as <code class="inline">ei_xreceive_msg</code>, but
instead of using an <code class="inline">ei_x_buff</code>, the function expects a pointer to a character
pointer (<code class="inline">mbufp</code>), where the character pointer is to point to a memory area
allocated by <code class="inline">malloc</code>. Argument <code class="inline">bufsz</code> is to be a pointer to an integer
containing the exact size (in bytes) of the memory area. The function may
reallocate the memory area and will in such cases put the new size in <code class="inline">*bufsz</code>
and update <code class="inline">*mbufp</code>.</p><p>Returns either <code class="inline">ERL_TICK</code> or the <code class="inline">msgtype</code> field of the <code class="inline">erlang_msg *msg</code>. The
length of the message is put in <code class="inline">*msglen</code>. On error a value <code class="inline">&lt; 0</code> is returned.</p><p>It is recommended to use <code class="inline">ei_xreceive_msg</code> instead when possible, for the sake
of readability. However, the function will be retained in the interface for
compatibility and will <em>not</em> be removed in future releases without prior notice.</p><h2 id="ei_receive_encoded_tmo" class="section-heading"><a href="#ei_receive_encoded_tmo" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_receive_encoded_tmo()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_receive_encoded_tmo</span><span class="p" data-group-id="6142387999-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="o">*</span><span class="n">mbufp</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">bufsz</span><span class="p">,</span><span class="w">  </span><span class="n">erlang_msg</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">,</span><span class="w">
  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">msglen</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">timeout_ms</span><span class="p" data-group-id="6142387999-1">)</span><span class="p">;</span></code></pre><p>Equivalent to <code class="inline">ei_receive_encoded</code> with an optional time-out argument, see the
description at the beginning of this manual page.</p><h2 id="ei_receive_msg" class="section-heading"><a href="#ei_receive_msg" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_receive_msg()</span></h2><h2 id="ei_xreceive_msg" class="section-heading"><a href="#ei_xreceive_msg" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_xreceive_msg()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_receive_msg</span><span class="p" data-group-id="1875074774-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">erlang_msg</span><span class="o">*</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">ei_x_buff</span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p" data-group-id="1875074774-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_xreceive_msg</span><span class="p" data-group-id="9769293694-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">erlang_msg</span><span class="o">*</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">ei_x_buff</span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p" data-group-id="9769293694-1">)</span><span class="p">;</span></code></pre><p>Receives a message to the buffer in <code class="inline">x</code>. <code class="inline">ei_xreceive_msg</code> allows the buffer in
<code class="inline">x</code> to grow, but <code class="inline">ei_receive_msg</code> fails if the message is larger than the
pre-allocated buffer in <code class="inline">x</code>.</p><ul><li><code class="inline">fd</code> is an open descriptor to an Erlang connection.</li><li><code class="inline">msg</code> is a pointer to an <code class="inline">erlang_msg</code> structure and contains information on
the message received.</li><li><code class="inline">x</code> is buffer obtained from <code class="inline">ei_x_new</code>.</li></ul><p>On success, the functions return <code class="inline">ERL_MSG</code> and the
<a href="ei_connect.html#erlang_msg"><code class="inline">msg</code></a> struct is initialized.</p><p><code class="inline">msgtype</code> identifies the type of message, and is one of the following:</p><ul><li><p><strong><code class="inline">ERL_SEND</code></strong> - Indicates that an ordinary send operation has occurred.
<code class="inline">msg-&gt;to</code> contains the pid of the recipient (the C-node).</p></li><li><p><strong><code class="inline">ERL_REG_SEND</code></strong> - A registered send operation occurred. <code class="inline">msg-&gt;from</code>
contains the pid of the sender.</p></li><li><p><strong><code class="inline">ERL_LINK</code> or <code class="inline">ERL_UNLINK</code></strong> - <code class="inline">msg-&gt;to</code> and <code class="inline">msg-&gt;from</code> contain the pids of
the sender and recipient of the link or unlink.</p></li><li><p><strong><code class="inline">ERL_EXIT</code></strong> - Indicates a broken link. <code class="inline">msg-&gt;to</code> and <code class="inline">msg-&gt;from</code> contain
the pids of the linked processes.</p></li></ul><p>The return value is the same as for <a href="ei_connect.html#ei_receive"><code class="inline">ei_receive</code></a>.</p><h2 id="ei_receive_msg_tmo" class="section-heading"><a href="#ei_receive_msg_tmo" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_receive_msg_tmo()</span></h2><h2 id="ei_xreceive_msg_tmo" class="section-heading"><a href="#ei_xreceive_msg_tmo" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_xreceive_msg_tmo()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_receive_msg_tmo</span><span class="p" data-group-id="9191064687-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">erlang_msg</span><span class="o">*</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">ei_x_buff</span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">imeout_ms</span><span class="p" data-group-id="9191064687-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_xreceive_msg_tmo</span><span class="p" data-group-id="4583902135-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">erlang_msg</span><span class="o">*</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">ei_x_buff</span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">timeout_ms</span><span class="p" data-group-id="4583902135-1">)</span><span class="p">;</span></code></pre><p>Equivalent to <code class="inline">ei_receive_msg</code> and <code class="inline">ei_xreceive_msg</code> with an optional time-out
argument, see the description at the beginning of this manual page.</p><h2 id="ei_receive_tmo" class="section-heading"><a href="#ei_receive_tmo" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_receive_tmo()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_receive_tmo</span><span class="p" data-group-id="0892392146-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">bufp</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bufsize</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">timeout_ms</span><span class="p" data-group-id="0892392146-1">)</span><span class="p">;</span></code></pre><p>Equivalent to <code class="inline">ei_receive</code> with an optional time-out argument, see the
description at the beginning of this manual page.</p><h2 id="ei_reg_send" class="section-heading"><a href="#ei_reg_send" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_reg_send()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_reg_send</span><span class="p" data-group-id="6326667347-1">(</span><span class="n">ei_cnode</span><span class="o">*</span><span class="w"> </span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">server_name</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p" data-group-id="6326667347-1">)</span><span class="p">;</span></code></pre><p>Sends an Erlang term to a registered process.</p><ul><li><code class="inline">fd</code> is an open descriptor to an Erlang connection.</li><li><code class="inline">server_name</code> is the registered name of the intended recipient.</li><li><code class="inline">buf</code> is the buffer containing the term in binary format.</li><li><code class="inline">len</code> is the length of the message in bytes.</li></ul><p>Returns <code class="inline">0</code> if successful, otherwise <code class="inline">-1</code>. In the latter case it sets
<code class="inline">erl_errno</code> to <code class="inline">EIO</code>.</p><p><em>Example:</em></p><p>Send the atom &quot;ok&quot; to the process &quot;worker&quot;:</p><pre><code class="makeup c" translate="no"><span class="n">ei_x_buff</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span><span class="nf">ei_x_new_with_version</span><span class="p" data-group-id="0500187969-1">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p" data-group-id="0500187969-1">)</span><span class="p">;</span><span class="w">
</span><span class="nf">ei_x_encode_atom</span><span class="p" data-group-id="0500187969-2">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ok&quot;</span><span class="p" data-group-id="0500187969-2">)</span><span class="p">;</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p" data-group-id="0500187969-3">(</span><span class="nf">ei_reg_send</span><span class="p" data-group-id="0500187969-4">(</span><span class="o">&amp;</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">buff</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">index</span><span class="p" data-group-id="0500187969-4">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="0500187969-3">)</span><span class="w">
    </span><span class="nf">handle_error</span><span class="p" data-group-id="0500187969-5">(</span><span class="p" data-group-id="0500187969-5">)</span><span class="p">;</span></code></pre><h2 id="ei_reg_send_tmo" class="section-heading"><a href="#ei_reg_send_tmo" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_reg_send_tmo()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_reg_send_tmo</span><span class="p" data-group-id="3976007346-1">(</span><span class="n">ei_cnode</span><span class="o">*</span><span class="w"> </span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">server_name</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w">
  </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">timeout_ms</span><span class="p" data-group-id="3976007346-1">)</span><span class="p">;</span></code></pre><p>Equivalent to <code class="inline">ei_reg_send</code> with an optional time-out argument, see the
description at the beginning of this manual page.</p><h2 id="ei_rpc" class="section-heading"><a href="#ei_rpc" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_rpc()</span></h2><h2 id="ei_rpc_to" class="section-heading"><a href="#ei_rpc_to" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_rpc_to()</span></h2><h2 id="ei_xrpc_to" class="section-heading"><a href="#ei_xrpc_to" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_xrpc_to()</span></h2><p>Available since OTP 24.0</p><h2 id="ei_rpc_from" class="section-heading"><a href="#ei_rpc_from" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_rpc_from()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_rpc</span><span class="p" data-group-id="7792524379-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">mod</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">fun</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argbuf</span><span class="p">,</span><span class="w">
  </span><span class="kt">int</span><span class="w"> </span><span class="n">argbuflen</span><span class="p">,</span><span class="w"> </span><span class="n">ei_x_buff</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p" data-group-id="7792524379-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_rpc_to</span><span class="p" data-group-id="0180079952-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">mod</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">fun</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argbuf</span><span class="p">,</span><span class="w">
  </span><span class="kt">int</span><span class="w"> </span><span class="n">argbuflen</span><span class="p" data-group-id="0180079952-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_xrpc_to</span><span class="p" data-group-id="2819176429-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">mod</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">fun</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argbuf</span><span class="p">,</span><span class="w">
  </span><span class="kt">int</span><span class="w"> </span><span class="n">argbuflen</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p" data-group-id="2819176429-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_rpc_from</span><span class="p" data-group-id="9486762662-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">timeout</span><span class="p">,</span><span class="w"> </span><span class="n">erlang_msg</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">ei_x_buff</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p" data-group-id="9486762662-1">)</span><span class="p">;</span></code></pre><p>Supports calling Erlang functions on remote nodes. <code class="inline">ei_rpc_to()</code> sends an RPC
request to a remote node and <code class="inline">ei_rpc_from()</code> receives the results of such a
call. <code class="inline">ei_rpc()</code> combines the functionality of these two functions by sending an
RPC request and waiting for the results.</p><p>The <code class="inline">ei_xrpc_to()</code> function is equivalent to <code class="inline">ei_rpc_to()</code> when its <code class="inline">flags</code>
parameter is set to <code class="inline">0</code>. When the flags parameter of <code class="inline">ei_xrpc_to()</code> is set to
<code class="inline">EI_RPC_FETCH_STDOUT</code>, stdout (standard output) data are forwarded. See the
documentation for the flags parameter for more information about the
<code class="inline">EI_RPC_FETCH_STDOUT</code> flag.</p><p>See also <a href="../../apps/kernel/rpc.html#call/4"><code class="inline">rpc:call/4</code></a> in Kernel.</p><ul><li><p><strong><code class="inline">ec</code></strong> is the C-node structure previously initiated by a call to
<code class="inline">ei_connect_init()</code> or <code class="inline">ei_connect_xinit()</code>.</p></li><li><p><strong><code class="inline">fd</code></strong> is an open descriptor to an Erlang connection.</p></li><li><p><strong><code class="inline">timeout</code></strong> is the maximum time (in milliseconds) to wait for results. Specify
<code class="inline">ERL_NO_TIMEOUT</code> to wait forever. <code class="inline">ei_rpc()</code> waits infinitely for the answer,
that is, the call will never time out.</p></li><li><p><strong><code class="inline">mod</code></strong> is the name of the module containing the function to be run on the
remote node.</p></li><li><p><strong><code class="inline">fun</code></strong> is the name of the function to run.</p></li><li><p><strong><code class="inline">argbuf</code></strong> is a pointer to a buffer with an encoded Erlang list, without a
version magic number, containing the arguments to be passed to the function.</p></li><li><p><strong><code class="inline">argbuflen</code></strong> is the length of the buffer containing the encoded Erlang list.</p></li><li><p><strong><code class="inline">msg</code></strong> is structure of type <code class="inline">erlang_msg</code> and contains information on the
message received. For a description of the <code class="inline">erlang_msg</code> format, see
<a href="ei_connect.html#ei_receive_msg"><code class="inline">ei_receive_msg</code></a>.</p></li><li><p><strong><code class="inline">x</code></strong> points to the dynamic buffer that receives the result. For <code class="inline">ei_rpc()</code> this
is the result without the version magic number. For an <code class="inline">ei_rpc_from()</code> call
the result consists of a version magic number and a 2-tuple. The 2-tuple can
be in one of the following two forms:</p><ul><li><p><strong><code class="inline">{rex,Reply}</code></strong> - This response value means that the RPC has completed.
The result value is the <code class="inline">Reply</code> term. This is the only type of response that
one can get from an RPC triggered by a call to <code class="inline">ei_rpc_to()</code> or
<code class="inline">ei_xrpc_to()</code> without the <code class="inline">EI_RPC_FETCH_STDOUT</code> flag. If the RPC was
triggered by a call to <code class="inline">ei_xrpc_to()</code> with the <code class="inline">EI_RPC_FETCH_STDOUT</code> flag
set, then all forwarded stdout data has been received.</p></li><li><p><strong><code class="inline">{rex_stdout,StdOutUTF8Binary}</code></strong> - This response value can only be
obtained if the RPC call was triggered by a call to <code class="inline">ei_xrpc_to()</code> with the
<code class="inline">EI_RPC_FETCH_STDOUT</code> flag set. This response value means that forwarded
stdout data has been received. The stdout data is stored in a binary and is
UTF-8 encoded. One may need to call <code class="inline">ei_rpc_from()</code> multiple times to read
all the stdout data. The stdout data is received in the same order as it was
written. All forwarded stdout data have been received when a <code class="inline">{rex,Reply}</code>
tuple has been obtained from an <code class="inline">ei_rpc_from()</code> call.</p></li></ul></li><li><p><strong><code class="inline">flags</code></strong> The flag <code class="inline">EI_RPC_FETCH_STDOUT</code> is currently the only flag that is
supported by <code class="inline">ei_xrpc_to()</code>. When <code class="inline">EI_RPC_FETCH_STDOUT</code> is set, the called
function is executed in a new process with a
<a href="../../apps/erts/erlang.html#group_leader/0">group leader</a> that forwards all stdout data. This
means that stdout data that are written during the execution of the called
function, by the called function and by descendant processes, will be
forwarded (given that the group leader has not been changed by a call to
<a href="../../apps/erts/erlang.html#group_leader/2"><code class="inline">erlang:group_leader/2</code></a>). The forwarded stdout data need to be collected by a
sequence of calls to <code class="inline">ei_rpc_from()</code>. See the description of the <code class="inline">x</code> parameter
for how <code class="inline">ei_rpc_from()</code> is used to receive stdout data. See the documentation
of the <a href="../../apps/stdlib/io_protocol.html">the I/O protocol</a>, for more information
about the group leader concept.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p>The flag <code class="inline">EI_RPC_FETCH_STDOUT</code> only works when interacting with a node with
a version greater or equal to OTP-24.</p></section></li></ul><p><code class="inline">ei_rpc()</code> returns the number of bytes in the result on success and <code class="inline">-1</code> on
failure. <code class="inline">ei_rpc_from()</code> returns the number of bytes, otherwise one of
<code class="inline">ERL_TICK</code>, <code class="inline">ERL_TIMEOUT</code>, and <code class="inline">ERL_ERROR</code>. The functions <code class="inline">ei_rpc_to()</code> and
<code class="inline">ei_xrpc_to()</code> returns 0 if successful, otherwise -1. When failing, all four
functions set <code class="inline">erl_errno</code> to one of the following:</p><ul><li><p><strong><code class="inline">EIO</code></strong> - I/O error.</p></li><li><p><strong><code class="inline">ETIMEDOUT</code></strong> - Time-out expired.</p></li><li><p><strong><code class="inline">EAGAIN</code></strong> - Temporary error: Try again.</p></li></ul><p><em>Example:</em></p><p>Check to see if an Erlang process is alive:</p><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">is_alive</span><span class="p">;</span><span class="w">
</span><span class="n">ei_x_buff</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">

</span><span class="nf">ei_x_new</span><span class="p" data-group-id="4631817457-1">(</span><span class="o">&amp;</span><span class="n">result</span><span class="p" data-group-id="4631817457-1">)</span><span class="p">;</span><span class="w">
</span><span class="nf">ei_x_new</span><span class="p" data-group-id="4631817457-2">(</span><span class="o">&amp;</span><span class="n">args</span><span class="p" data-group-id="4631817457-2">)</span><span class="p">;</span><span class="w">
</span><span class="nf">ei_x_encode_list_header</span><span class="p" data-group-id="4631817457-3">(</span><span class="o">&amp;</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="4631817457-3">)</span><span class="p">;</span><span class="w">
</span><span class="nf">ei_x_encode_pid</span><span class="p" data-group-id="4631817457-4">(</span><span class="o">&amp;</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">check_pid</span><span class="p" data-group-id="4631817457-4">)</span><span class="p">;</span><span class="w">
</span><span class="nf">ei_x_encode_empty_list</span><span class="p" data-group-id="4631817457-5">(</span><span class="o">&amp;</span><span class="n">args</span><span class="p" data-group-id="4631817457-5">)</span><span class="p">;</span><span class="w">

</span><span class="k">if</span><span class="w"> </span><span class="p" data-group-id="4631817457-6">(</span><span class="nf">ei_rpc</span><span class="p" data-group-id="4631817457-7">(</span><span class="o">&amp;</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;erlang&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;is_process_alive&quot;</span><span class="p">,</span><span class="w">
           </span><span class="n">args</span><span class="p">.</span><span class="n">buff</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">result</span><span class="p" data-group-id="4631817457-7">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4631817457-6">)</span><span class="w">
    </span><span class="nf">handle_error</span><span class="p" data-group-id="4631817457-8">(</span><span class="p" data-group-id="4631817457-8">)</span><span class="p">;</span><span class="w">

</span><span class="k">if</span><span class="w"> </span><span class="p" data-group-id="4631817457-9">(</span><span class="nf">ei_decode_version</span><span class="p" data-group-id="4631817457-10">(</span><span class="n">result</span><span class="p">.</span><span class="n">buff</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">index</span><span class="p" data-group-id="4631817457-10">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w">
    </span><span class="o">||</span><span class="w"> </span><span class="nf">ei_decode_bool</span><span class="p" data-group-id="4631817457-11">(</span><span class="n">result</span><span class="p">.</span><span class="n">buff</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">is_alive</span><span class="p" data-group-id="4631817457-11">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4631817457-9">)</span><span class="w">
    </span><span class="nf">handle_error</span><span class="p" data-group-id="4631817457-12">(</span><span class="p" data-group-id="4631817457-12">)</span><span class="p">;</span></code></pre><h2 id="ei_self" class="section-heading"><a href="#ei_self" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_self()</span></h2><pre><code class="makeup c" translate="no"><span class="n">erlang_pid</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">ei_self</span><span class="p" data-group-id="4446892654-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p" data-group-id="4446892654-1">)</span><span class="p">;</span></code></pre><p>Retrieves a generic pid of the C-node. Every C-node has a (pseudo) pid used in
<code class="inline">ei_send_reg</code>, <code class="inline">ei_rpc()</code>, and others. This is contained in a field in the <code class="inline">ec</code>
structure. Do <em>not</em> modify this structure.</p><p>On success a pointer to the process identifier is returned. On failure <code class="inline">NULL</code> is
returned and <code class="inline">erl_errno</code> is set.</p><p>The C-node identified by <code class="inline">ec</code> must have been initialized and must have received
a name prior to the call to <code class="inline">ei_self()</code>. Initialization of the C-node is done by
a call to <a href="ei_connect.html#ei_connect_init"><code class="inline">ei_connect_init()</code></a> or friends. If
the name is dynamically assigned from the peer node, the C-node also has to be
connected.</p><h2 id="ei_send" class="section-heading"><a href="#ei_send" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_send()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_send</span><span class="p" data-group-id="6365366389-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">erlang_pid</span><span class="o">*</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p" data-group-id="6365366389-1">)</span><span class="p">;</span></code></pre><p>Sends an Erlang term to a process.</p><ul><li><code class="inline">fd</code> is an open descriptor to an Erlang connection.</li><li><code class="inline">to</code> is the pid of the intended recipient of the message.</li><li><code class="inline">buf</code> is the buffer containing the term in binary format.</li><li><code class="inline">len</code> is the length of the message in bytes.</li></ul><p>Returns <code class="inline">0</code> if successful, otherwise <code class="inline">-1</code>. In the latter case it sets
<code class="inline">erl_errno</code> to <code class="inline">EIO</code>.</p><h2 id="ei_send_encoded" class="section-heading"><a href="#ei_send_encoded" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_send_encoded()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_send_encoded</span><span class="p" data-group-id="6186210594-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">erlang_pid</span><span class="o">*</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p" data-group-id="6186210594-1">)</span><span class="p">;</span></code></pre><p>Works exactly as <code class="inline">ei_send</code>, the alternative name is retained for backward
compatibility. The function will <em>not</em> be removed without prior notice.</p><h2 id="ei_send_encoded_tmo" class="section-heading"><a href="#ei_send_encoded_tmo" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_send_encoded_tmo()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_send_encoded_tmo</span><span class="p" data-group-id="6293020008-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">erlang_pid</span><span class="o">*</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">timeout_ms</span><span class="p" data-group-id="6293020008-1">)</span><span class="p">;</span></code></pre><p>Equivalent to <code class="inline">ei_send_encoded</code> with an optional time-out argument, see the
description at the beginning of this manual page.</p><h2 id="ei_send_reg_encoded" class="section-heading"><a href="#ei_send_reg_encoded" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_send_reg_encoded()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_send_reg_encoded</span><span class="p" data-group-id="8070129343-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">erlang_pid</span><span class="w"> </span><span class="o">*</span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p" data-group-id="8070129343-1">)</span><span class="p">;</span></code></pre><p>This function is retained for compatibility with code generated by the interface
compiler and with code following examples in the same application.</p><p>The function works as <code class="inline">ei_reg_send</code> with one exception. Instead of taking
<code class="inline">ei_cnode</code> as first argument, it takes a second argument, an <code class="inline">erlang_pid</code>, which
is to be the process identifier of the sending process (in the Erlang
distribution protocol).</p><p>A suitable <code class="inline">erlang_pid</code> can be retrieved from the <code class="inline">ei_cnode</code> structure by
calling <code class="inline">ei_self(cnode_pointer)</code>.</p><h2 id="ei_send_reg_encoded_tmo" class="section-heading"><a href="#ei_send_reg_encoded_tmo" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_send_reg_encoded_tmo()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_send_reg_encoded_tmo</span><span class="p" data-group-id="7739347001-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">erlang_pid</span><span class="w"> </span><span class="o">*</span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w">
  </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">timeout_ms</span><span class="p" data-group-id="7739347001-1">)</span><span class="p">;</span></code></pre><p>Equivalent to <code class="inline">ei_send_reg_encoded</code> with an optional time-out argument, see the
description at the beginning of this manual page.</p><h2 id="ei_send_tmo" class="section-heading"><a href="#ei_send_tmo" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_send_tmo()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_send_tmo</span><span class="p" data-group-id="1796749020-1">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">erlang_pid</span><span class="o">*</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">timeout_ms</span><span class="p" data-group-id="1796749020-1">)</span><span class="p">;</span></code></pre><p>Equivalent to <code class="inline">ei_send</code> with an optional time-out argument, see the description
at the beginning of this manual page.</p><h2 id="ei_thisnodename" class="section-heading"><a href="#ei_thisnodename" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_thisnodename()</span></h2><h2 id="ei_thishostname" class="section-heading"><a href="#ei_thishostname" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_thishostname()</span></h2><h2 id="ei_thisalivename" class="section-heading"><a href="#ei_thisalivename" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_thisalivename()</span></h2><pre><code class="makeup c" translate="no"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">ei_thisnodename</span><span class="p" data-group-id="6966087633-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p" data-group-id="6966087633-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">ei_thishostname</span><span class="p" data-group-id="4221042614-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p" data-group-id="4221042614-1">)</span><span class="p">;</span></code></pre><pre><code class="makeup c" translate="no"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">ei_thisalivename</span><span class="p" data-group-id="4916378496-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p" data-group-id="4916378496-1">)</span><span class="p">;</span></code></pre><p>Can be used to retrieve information about the C-node. These values are initially
set with <code class="inline">ei_connect_init()</code> or <code class="inline">ei_connect_xinit()</code>.</p><p>These function simply fetch the appropriate field from the <code class="inline">ec</code> structure. Read
the field directly will probably be safe for a long time, so these functions are
not really needed.</p><h2 id="ei_unpublish" class="section-heading"><a href="#ei_unpublish" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_unpublish()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_unpublish</span><span class="p" data-group-id="1988470268-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p" data-group-id="1988470268-1">)</span><span class="p">;</span></code></pre><p>Can be called by a process to unregister a specified node from EPMD on the local
host. This is, however, usually not allowed, unless EPMD was started with flag
<code class="inline">-relaxed_command_check</code>, which it normally is not.</p><p>To unregister a node you have published, you should close the descriptor that
was returned by <code class="inline">ei_publish()</code>.</p><section role="note" class="admonition warning"><h4 class="admonition-title warning">Warning</h4><p>This function is deprecated and will be removed in a future release.</p></section><p><code class="inline">ec</code> is the node structure of the node to unregister.</p><p>If the node was successfully unregistered from EPMD, the function returns <code class="inline">0</code>.
Otherwise, <code class="inline">-1</code> is returned and <code class="inline">erl_errno</code> is set to <code class="inline">EIO</code>.</p><h2 id="ei_unpublish_tmo" class="section-heading"><a href="#ei_unpublish_tmo" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ei_unpublish_tmo()</span></h2><pre><code class="makeup c" translate="no"><span class="kt">int</span><span class="w"> </span><span class="nf">ei_unpublish_tmo</span><span class="p" data-group-id="0152149505-1">(</span><span class="n">ei_cnode</span><span class="w"> </span><span class="o">*</span><span class="n">ec</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">timeout_ms</span><span class="p" data-group-id="0152149505-1">)</span><span class="p">;</span></code></pre><p>Equivalent to <code class="inline">ei_unpublish</code> with an optional time-out argument, see the
description at the beginning of this manual page.</p><p><a href="" id="debug_information"></a></p><h2 id="debug-information" class="section-heading"><a href="#debug-information" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Debug Information</span></h2><p>If a connection attempt fails, the following can be checked:</p><ul><li><code class="inline">erl_errno</code>.</li><li>That the correct cookie was used</li><li>That EPMD is running</li><li>That the remote Erlang node on the other side is running the same version of
Erlang as the <code class="inline">ei</code> library</li><li>That environment variable <code class="inline">ERL_EPMD_PORT</code> is set correctly</li></ul><p>The connection attempt can be traced by setting a trace level by either using
<code class="inline">ei_set_tracelevel</code> or by setting environment variable <code class="inline">EI_TRACELEVEL</code>. The
trace levels have the following messages:</p><ul><li>1: Verbose error messages</li><li>2: Above messages and verbose warning messages</li><li>3: Above messages and progress reports for connection handling</li><li>4: Above messages and progress reports for communication</li><li>5: Above messages and progress reports for data conversion</li></ul>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="ei.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
ei
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="ei_global.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
ei_global
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="erl_interface.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright © 1996-2025 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js"></script>
  <script>
  let initialized = false;

  window.addEventListener("exdoc:loaded", () => {
      if (!initialized) {
      mermaid.initialize({
          startOnLoad: false,
          theme: document.body.className.includes("dark") ? "dark" : "default"
      });
      initialized = true;
      }

      let id = 0;
      for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
          graphEl.innerHTML = svg;
          bindFunctions?.(graphEl);
          preEl.insertAdjacentElement("afterend", graphEl);
          preEl.remove();
      });
      }
  });
  </script>

  </body>
</html>
