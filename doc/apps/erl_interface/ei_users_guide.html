<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:erl="http://erlang.org" xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<link rel="stylesheet" href="../../otp_doc.css" type="text/css">
<title>Erlang -- Erl_Interface User's Guide</title>
</head>
<body>
<div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../../js/erlresolvelinks.js"></script><script id="js3" type="text/javascript" src="../../../../doc/js/topbar.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function setscrollpos() {
                var objf = document.getElementById('loadscrollpos');
                if (objf) {
                  document.getElementById("leftnav").firstChild.scrollTop = objf.offsetTop - 10;
                }
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //-->
</script><div class="topbar">
<div class="topbar-expand "><button onclick="toggleDisplay();"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="Capa_1" viewBox="0 0 54 54" width="24" height="24"><g><path style="fill:#000000;" d="M27,54c-0.552,0-1-0.448-1-1V8c0-0.552,0.448-1,1-1s1,0.448,1,1v45C28,53.552,27.552,54,27,54z"></path><path style="fill:#000000;" d="M11,25c-0.256,0-0.512-0.098-0.707-0.293c-0.391-0.391-0.391-1.023,0-1.414l16-16                                      c0.391-0.391,1.023-0.391,1.414,0s0.391,1.023,0,1.414l-16,16C11.512,24.902,11.256,25,11,25z"></path><path style="fill:#000000;" d="M43,25c-0.256,0-0.512-0.098-0.707-0.293l-16-16c-0.391-0.391-0.391-1.023,0-1.414                                      s1.023-0.391,1.414,0l16,16c0.391,0.391,0.391,1.023,0,1.414C43.512,24.902,43.256,25,43,25z"></path><path style="fill:#000000;" d="M43,2H11c-0.552,0-1-0.448-1-1s0.448-1,1-1h32c0.552,0,1,0.448,1,1S43.552,2,43,2z"></path></g></svg></button></div>
<div class="topbar-title"><h1 id="Erl_Interface User's Guide">1 
                Erl_Interface User's Guide</h1></div>
<div class="search-expand ">        <button id="docsearch-mobile">
            <svg fill="#000000" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="24" height="24"><path d="M 21 3 C 11.621094 3 4 10.621094 4 20 C 4 29.378906 11.621094 37 21 37 C 24.710938 37 28.140625 35.804688 30.9375 33.78125 L 44.09375 46.90625 L 46.90625 44.09375 L 33.90625 31.0625 C 36.460938 28.085938 38 24.222656 38 20 C 38 10.621094 30.378906 3 21 3 Z M 21 5 C 29.296875 5 36 11.703125 36 20 C 36 28.296875 29.296875 35 21 35 C 12.703125 35 6 28.296875 6 20 C 6 11.703125 12.703125 5 21 5 Z"/></svg>
        </button>
</div>
</div>
<aside class="hide-mobile" id="leftnav"><nav class="leftnav-tube"><div class="erlang-logo-wrapper"><a href="../../index.html"><img alt="Erlang Logo" src="../../erlang-logo.png" class="erlang-logo"></a></div>
<p class="section-title">Erl_Interface</p>
<p class="section-subtitle">User's Guide</p>
<p class="section-version">Version 5.1</p>
<ul class="panel-sections">
<li><a href="users_guide.html">User's Guide</a></li>
<li><a href="index.html">Reference Manual</a></li>
<li><a href="notes.html">Release Notes</a></li>
<li><a href="erl_interface.pdf">PDF</a></li>
<li><a href="../../index.html">Top</a></li>
</ul>
<div id="docsearch"></div>
<ul class="expand-collapse-items">
<li><a href="javascript:openAllFlips()">Expand All</a></li>
<li><a href="javascript:closeAllFlips()">Contract All</a></li>
</ul>
<h3 id="chapters">Chapters</h3>
<ul class="flipMenu" imagePath="../../js/flipmenu"><li id="loadscrollpos" title="Erl_Interface User's Guide" expanded="true">Erl_Interface User's Guide<ul>
<li><a href="ei_users_guide.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="ei_users_guide.html#introduction">Introduction</a></li>
<li title="Compiling and Linking Your Code"><a href="ei_users_guide.html#compiling-and-linking-your-code">Compiling and Linking Your Code</a></li>
<li title="Initializing the Library"><a href="ei_users_guide.html#initializing-the-library">Initializing the Library</a></li>
<li title="Encoding, Decoding, and Sending Erlang Terms"><a href="ei_users_guide.html#encoding,-decoding,-and-sending-erlang-terms">Encoding, Decoding, and Sending Erlang Terms</a></li>
<li title="Building Terms"><a href="ei_users_guide.html#building-terms">Building Terms</a></li>
<li title="Connecting to a Distributed Erlang Node"><a href="ei_users_guide.html#connecting-to-a-distributed-erlang-node">Connecting to a Distributed Erlang Node</a></li>
<li title="Using EPMD"><a href="ei_users_guide.html#using-epmd">Using EPMD</a></li>
<li title="Sending and Receiving Erlang Messages"><a href="ei_users_guide.html#sending-and-receiving-erlang-messages">Sending and Receiving Erlang Messages</a></li>
<li title="Remote Procedure Calls"><a href="ei_users_guide.html#remote-procedure-calls">Remote Procedure Calls</a></li>
<li title="Using Global Names"><a href="ei_users_guide.html#using-global-names">Using Global Names</a></li>
</ul>
</li></ul></nav></aside><div id="content">
<div class="innertube">
<h1 id="Erl_Interface User's Guide">1 Erl_Interface User's Guide</h1>
  

  <h3 id="introduction" class="title-link" onMouseOver="document.getElementById('ghlink-introduction-idm48').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-introduction-idm48').style.visibility = 'hidden';">
<div class="title-name">1.1 
        Introduction</div>
<div class="title-anchors"><span id="ghlink-introduction-idm48" class="ghlink-after"><a href="#introduction" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/erl_interface/doc/src/ei_users_guide.xml#L36" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>The <span class="code">Erl_Interface</span> library contains functions that help you
      integrate programs written in C and Erlang. The functions in
      <span class="code">Erl_Interface</span> support the following:</p>
    <ul>
      <li>Manipulation of data represented as Erlang data types</li>
      <li>Conversion of data between C and Erlang formats</li>
      <li>Encoding and decoding of Erlang data types for transmission or
        storage</li>
      <li>Communication between C nodes and Erlang processes</li>
      <li>Backup and restore of C node state to and from
        <span class="bold_code bc-18"><a href="../../man/mnesia.html">Mnesia</a></span>
</li>
    </ul>
    <div class="note">
<div class="label">Note</div>
<div class="content"><p>
      <p>By default, the <span class="code">Erl_Interface</span> library is only guaranteed
        to be compatible with other Erlang/OTP components from the same
        release as the libraries themselves. For information about how to
        communicate with Erlang/OTP components from earlier releases, see
        function <span class="bold_code bc-15"><a href="../../man/ei.html#ei_set_compat_rel">
        <span class="code">ei_set_compat_rel</span></a></span>.</p>
    </p></div>
</div>

    <h4 id="scope" class="title-link" onMouseOver="document.getElementById('ghlink-scope-idm65').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-scope-idm65').style.visibility = 'hidden';">
<div class="title-name">Scope</div>
<div class="title-anchors"><span id="ghlink-scope-idm65" class="ghlink-after"><a href="#scope" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/erl_interface/doc/src/ei_users_guide.xml#L59" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>In the following sections, these topics are described:</p>
      <ul>
        <li>Compiling your code for use with <span class="code">Erl_Interface</span>
</li>
        <li>Initializing <span class="code">Erl_Interface</span>
</li>
        <li>Encoding, decoding, and sending Erlang terms</li>
        <li>Building terms and patterns</li>
        <li>Pattern matching</li>
        <li>Connecting to a distributed Erlang node</li>
        <li>Using the Erlang Port Mapper Daemon (EPMD)</li>
        <li>Sending and receiving Erlang messages</li>
        <li>Remote procedure calls</li>
        <li>Using global names</li>
      </ul>
    

    <h4 id="prerequisites" class="title-link" onMouseOver="document.getElementById('ghlink-prerequisites-idm81').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-prerequisites-idm81').style.visibility = 'hidden';">
<div class="title-name">Prerequisites</div>
<div class="title-anchors"><span id="ghlink-prerequisites-idm81" class="ghlink-after"><a href="#prerequisites" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/erl_interface/doc/src/ei_users_guide.xml#L76" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>It is assumed that the reader is familiar with the Erlang programming
        language.</p>
    
  

  <h3 id="compiling-and-linking-your-code" class="title-link" onMouseOver="document.getElementById('ghlink-compiling-and-linking-your-code-idm84').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-compiling-and-linking-your-code-idm84').style.visibility = 'hidden';">
<div class="title-name">1.2 
        Compiling and Linking Your Code</div>
<div class="title-anchors"><span id="ghlink-compiling-and-linking-your-code-idm84" class="ghlink-after"><a href="#compiling-and-linking-your-code" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/erl_interface/doc/src/ei_users_guide.xml#L83" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>To use any of the <span class="code">Erl_Interface</span> functions, include the
      following line in your code:</p>

    <div class="example example-none"><pre>#include "ei.h"    </pre></div>

    <p>Determine where the top directory of your OTP installation is.
      To find this, start Erlang and enter the following
      command at the Eshell prompt:</p>

    <div class="example example-none"><pre>Eshell V4.7.4  (abort with ^G)
1&gt; code:root_dir().
/usr/local/otp    </pre></div>

    <p>To compile your code, ensure that your C compiler knows where
      to find <span class="code">ei.h</span> by specifying an appropriate
      <span class="code">-I</span> argument on the command line, or add it to
      the <span class="code">CFLAGS</span> definition in your
      <span class="code">Makefile</span>. The correct value for this path is
      <span class="code">$OTPROOT/lib/erl_interface-$EIVSN/include</span>,
      where:</p>

    <ul>
      <li>
        <p><span class="code">$OTPROOT</span> is the path reported by
          <span class="code">code:root_dir/0</span> in the example above.</p>
      </li>
      <li>
        <p><span class="code">$EIVSN</span> is the version of the <span class="code">Erl_Interface</span> application,
          for example, <span class="code">erl_interface-3.2.3</span>.</p>
      </li>
    </ul>

    <p>Compiling the code:</p>

    <div class="example example-none"><pre>$ cc -c -I/usr/local/otp/lib/erl_interface-3.2.3/include myprog.c    </pre></div>

    <p>When linking:</p>

    <ul>
      <li>Specify the path to <span class="code">libei.a</span> with
        <span class="code">-L$OTPROOT/lib/erl_interface-3.2.3/lib</span>.</li>
      <li>Specify the name of the library with <span class="code">-lei</span>.</li>
    </ul>

    <p>Do this on the command line or add the flags to the
      <span class="code">LDFLAGS</span> definition in your
      <span class="code">Makefile</span>.</p>

    <p>Linking the code:</p>

    <div class="example example-none"><pre>$ ld -L/usr/local/otp/lib/erl_interface-3.2.3/
                            lib myprog.o -lei -o myprog    </pre></div>

    <p>On some systems it can be necessary to link with some more
      libraries (for example, <span class="code">libnsl.a</span> and
      <span class="code">libsocket.a</span> on Solaris, or
      <span class="code">wsock32.lib</span> on Windows) to use the
      communication facilities of <span class="code">Erl_Interface</span>.</p>

    <p>If you use the <span class="code">Erl_Interface</span> functions in a threaded
      application based on POSIX threads or Solaris threads, then
      <span class="code">Erl_Interface</span> needs access to some of the synchronization
      facilities in your threads package. You must specify extra
      compiler flags to indicate which of the packages you use. Define
      <span class="code">_REENTRANT</span> and either <span class="code">STHREADS</span> or
      <span class="code">PTHREADS</span>. The default is to use POSIX threads if
      <span class="code">_REENTRANT</span> is specified.</p>
  

  <h3 id="initializing-the-library" class="title-link" onMouseOver="document.getElementById('ghlink-initializing-the-library-idm133').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-initializing-the-library-idm133').style.visibility = 'hidden';">
<div class="title-name">1.3 
        Initializing the Library</div>
<div class="title-anchors"><span id="ghlink-initializing-the-library-idm133" class="ghlink-after"><a href="#initializing-the-library" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/erl_interface/doc/src/ei_users_guide.xml#L158" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>
      Before calling any of the other functions in the library,
      initialize it by calling
      <span class="code">ei_init()</span> exactly once.
    </p>
  

  <h3 id="encoding,-decoding,-and-sending-erlang-terms" class="title-link" onMouseOver="document.getElementById('ghlink-encoding,-decoding,-and-sending-erlang-terms-idm137').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-encoding,-decoding,-and-sending-erlang-terms-idm137').style.visibility = 'hidden';">
<div class="title-name">1.4 
        Encoding, Decoding, and Sending Erlang Terms</div>
<div class="title-anchors"><span id="ghlink-encoding,-decoding,-and-sending-erlang-terms-idm137" class="ghlink-after"><a href="#encoding,-decoding,-and-sending-erlang-terms" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/erl_interface/doc/src/ei_users_guide.xml#L167" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>Data sent between distributed Erlang nodes is encoded in the
      Erlang external format. You must therefore encode and decode
      Erlang terms into byte streams if you want to use the distribution
      protocol to communicate between a C program and Erlang.</p>

    <p>The <span class="code">Erl_Interface</span> library supports this activity. It has
      several C functions that create and manipulate Erlang data
      structures. The following example shows how to create and encode
      an Erlang tuple <span class="code">{tobbe,3928}</span>:</p>

    <div class="example example-none"><pre>ei_x_buff buf;
ei_x_new(&amp;buf);
int i = 0;
ei_x_encode_tuple_header(&amp;buf, 2);
ei_x_encode_atom(&amp;buf, "tobbe");
ei_x_encode_long(&amp;buf, 3928);    </pre></div>

    <p>For a complete description, see the
    <span class="bold_code bc-19"><a href="../../man/ei.html"><span class="code">ei</span></a></span> module.</p>
  

  <a name="building_terms_and_patterns"></a><h3 id="building-terms" class="title-link" onMouseOver="document.getElementById('ghlink-building-terms-idm147').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-building-terms-idm147').style.visibility = 'hidden';">
<div class="title-name">1.5 
        Building Terms</div>
<div class="title-anchors"><span id="ghlink-building-terms-idm147" class="ghlink-after"><a href="#building-terms" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/erl_interface/doc/src/ei_users_guide.xml#L191" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    
    <p>The previous example can be simplified by using the
      <span class="bold_code bc-15"><a href="../../man/ei.html#ei_x_format_wo_ver"><span class="code">ei_x_format_wo_ver</span></a></span> function
      to create an Erlang term:</p>

    <div class="example example-none"><pre>ei_x_buff buf;
ei_x_new(&amp;buf);
ei_x_format_wo_ver(&amp;buf, "{~a,~i}", "tobbe", 3928);    </pre></div>

    <p>For a complete description of the different format directives, see the
      the <span class="bold_code bc-15"><a href="../../man/ei.html#ei_x_format_wo_ver"><span class="code">ei_x_format_wo_ver</span></a></span> function.</p>

    <p>The following example is more complex:</p>

    <div class="example example-none"><pre>ei_x_buff buf;
int i = 0;
ei_x_new(&amp;buf);
ei_x_format_wo_ver(&amp;buf,
                   "[{name,~a},{age,~i},{data,[{adr,~s,~i}]}]",
                   "madonna",
                   21,
                  "E-street", 42);
ei_print_term(stdout, buf.buff, &amp;i);
ei_x_free(&amp;buf);      </pre></div>

    <p>As in the previous examples, it is your responsibility to free the
      memory allocated for Erlang terms. In this example,
      <span class="code">ei_x_free()</span> ensures that the data
      pointed to by <span class="code">buf</span> is released.</p>

  

  <h3 id="connecting-to-a-distributed-erlang-node" class="title-link" onMouseOver="document.getElementById('ghlink-connecting-to-a-distributed-erlang-node-idm162').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-connecting-to-a-distributed-erlang-node-idm162').style.visibility = 'hidden';">
<div class="title-name">1.6 
        Connecting to a Distributed Erlang Node</div>
<div class="title-anchors"><span id="ghlink-connecting-to-a-distributed-erlang-node-idm162" class="ghlink-after"><a href="#connecting-to-a-distributed-erlang-node" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/erl_interface/doc/src/ei_users_guide.xml#L227" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>To connect to a distributed Erlang node, you must first
      initialize the connection routine with one of the
      <span class="bold_code bc-15"><a href="../../man/ei_connect.html#ei_connect_init">
      <span class="code">ei_connect_init_*</span></a></span> functions,
      which stores information, such as the hostname, and node name
      for later use:</p>

    <div class="example example-none"><pre>int identification_number = 99;
int creation=1;
char *cookie="a secret cookie string"; /* An example */
const char* node_name = "einode@durin";
const char *cookie = NULL;
short creation = time(NULL) + 1;
ei_cnode ec;
ei_connect_init(ec,
                node_name,
                cookie,
                creation);    </pre></div>

    <p>For more information, see the
      <span class="bold_code bc-19"><a href="../../man/ei_connect.html"><span class="code">ei_connect</span></a></span> module.</p>

    <p>After initialization, you set up the connection to the Erlang node.
      To specify the Erlang node you want to connect to, use the
      <span class="code">ei_connect_*()</span> family of functions. The following example sets up the
      connection and is to result in a valid socket file descriptor:</p>

    <div class="example example-none"><pre>int sockfd;
const char* node_name = "einode@durin"; /* An example */
if ((sockfd = ei_connect(ec, nodename)) &lt; 0)
  fprintf(stderr, "ERROR: ei_connect failed");    </pre></div>

  

  <h3 id="using-epmd" class="title-link" onMouseOver="document.getElementById('ghlink-using-epmd-idm174').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-using-epmd-idm174').style.visibility = 'hidden';">
<div class="title-name">1.7 
        Using EPMD</div>
<div class="title-anchors"><span id="ghlink-using-epmd-idm174" class="ghlink-after"><a href="#using-epmd" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/erl_interface/doc/src/ei_users_guide.xml#L265" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p><span class="bold_code bc-18"><a href="../../man/epmd.html"><span class="code">erts:epmd</span></a></span>
      is the Erlang Port Mapper Daemon. Distributed
      Erlang nodes register with <span class="code">epmd</span> on the local host to
      indicate to other nodes that they exist and can accept connections.
      <span class="code">epmd</span> maintains a register of
      node and port number information, and when a node wishes to connect to
      another node, it first contacts <span class="code">epmd</span> to find the
      correct port number to connect to.</p>

    <p>When you use
      <span class="bold_code bc-19"><a href="../../man/ei_connect.html"><span class="code">ei_connect</span></a></span>
      to connect to an Erlang node, a connection is first made to
      <span class="code">epmd</span> and, if the node is known, a
      connection is then made to the Erlang node.</p>

    <p>C nodes can also register themselves with <span class="code">epmd</span>
      if they want other
      nodes in the system to be able to find and connect to them.</p>

    <p>Before registering with <span class="code">epmd</span>, you must first
      create a listen socket and bind it to a port. Then:</p>

    <div class="example example-none"><pre>int pub;

pub = ei_publish(ec, port);    </pre></div>

    <p><span class="code">pub</span> is a file descriptor now connected to
      <span class="code">epmd</span>. <span class="code">epmd</span>
      monitors the other end of the connection. If it detects that the
      connection has been closed, the node becomes unregistered. So, if you
      explicitly close the descriptor or if your node fails, it becomes
      unregistered from <span class="code">epmd</span>.</p>

    <p>Notice that on some systems (such as VxWorks), a failed node is
      not detected by this mechanism, as the operating system does not
      automatically close descriptors that were left open when the node
      failed. If a node has failed in this way, <span class="code">epmd</span>
      prevents you from
      registering a new node with the old name, as it thinks that the old
      name is still in use. In this case, you must close the port
      explicitly</p>

  

  <h3 id="sending-and-receiving-erlang-messages" class="title-link" onMouseOver="document.getElementById('ghlink-sending-and-receiving-erlang-messages-idm198').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-sending-and-receiving-erlang-messages-idm198').style.visibility = 'hidden';">
<div class="title-name">1.8 
        Sending and Receiving Erlang Messages</div>
<div class="title-anchors"><span id="ghlink-sending-and-receiving-erlang-messages-idm198" class="ghlink-after"><a href="#sending-and-receiving-erlang-messages" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/erl_interface/doc/src/ei_users_guide.xml#L312" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>Use one of the following two functions to send messages:</p>

    <ul>
      <li><span class="bold_code bc-15"><a href="../../man/ei_connect.html#ei_send">
        <span class="code">ei_send</span></a></span></li>
      <li><span class="bold_code bc-15"><a href="../../man/ei_connect.html#ei_reg_send">
        <span class="code">ei_reg_send</span></a></span></li>
    </ul>

    <p>As in Erlang, messages can be sent to a
      pid or to a registered name. It is easier to send a
      message to a registered name, as it avoids the problem of finding
      a suitable pid.</p>

    <p>Use one of the following two functions to receive messages:</p>

    <ul>
      <li><span class="bold_code bc-15"><a href="../../man/ei_connect.html#ei_receive">
        <span class="code">ei_receive</span></a></span></li>
      <li><span class="bold_code bc-15"><a href="../../man/ei_connect.html#ei_receive_msg">
        <span class="code">ei_receive_msg</span></a></span></li>
    </ul>

    <h4 id="example-of-sending-messages" class="title-link" onMouseOver="document.getElementById('ghlink-example-of-sending-messages-idm217').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-example-of-sending-messages-idm217').style.visibility = 'hidden';">
<div class="title-name">Example of Sending Messages</div>
<div class="title-anchors"><span id="ghlink-example-of-sending-messages-idm217" class="ghlink-after"><a href="#example-of-sending-messages" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/erl_interface/doc/src/ei_users_guide.xml#L337" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>In the following example, <span class="code">{Pid, hello_world}</span> is
        sent to a registered process <span class="code">my_server</span>:</p>

      <div class="example example-none"><pre>ei_x_buff buf;
ei_x_new_with_version(&amp;buf);

ei_x_encode_tuple_header(&amp;buf, 2);
ei_x_encode_pid(&amp;buf, ei_self(ec));
ei_x_encode_atom(&amp;buf, "Hello world");

ei_reg_send(ec,fd,"my_server",buf,buf.index);</pre></div>

      <p>The first element of the tuple that is sent is your own
        pid. This enables <span class="code">my_server</span> to reply.
        For more information about the primitives, see the
        <span class="bold_code bc-19"><a href="../../man/ei_connect.html"><span class="code">ei_connect</span></a></span> module.</p>
    

    <h4 id="example-of-receiving-messages" class="title-link" onMouseOver="document.getElementById('ghlink-example-of-receiving-messages-idm227').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-example-of-receiving-messages-idm227').style.visibility = 'hidden';">
<div class="title-name">Example of Receiving Messages</div>
<div class="title-anchors"><span id="ghlink-example-of-receiving-messages-idm227" class="ghlink-after"><a href="#example-of-receiving-messages" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/erl_interface/doc/src/ei_users_guide.xml#L358" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>In this example, <span class="code">{Pid, Something}</span> is received.</p>

        <div class="example example-none"><pre>erlang_msg msg;
int index = 0;
int version;
int arity = 0;
erlang_pid pid;
ei_x_buff buf;
ei_x_new(&amp;buf);
for (;;) {
  int got = ei_xreceive_msg(fd, &amp;msg, &amp;x);
  if (got == ERL_TICK)
    continue;
  if (got == ERL_ERROR) {
    fprintf(stderr, "ei_xreceive_msg, got==%d", got);
    exit(1);
  }
  break;
}
ei_decode_version(buf.buff, &amp;index, &amp;version);
ei_decode_tuple_header(buf.buff, &amp;index, &amp;arity);
if (arity != 2) {
  fprintf(stderr, "got wrong message");
  exit(1);
}
ei_decode_pid(buf.buff, &amp;index, &amp;pid);     </pre></div>

      <p>To provide robustness, a distributed Erlang node
        occasionally polls all its connected neighbors in an attempt to
        detect failed nodes or communication links. A node that receives such
        a message is expected to respond immediately with an
        <span class="code">ERL_TICK</span> message. This is done automatically by
        <span class="code">ei_xreceive_msg()</span>. However, when this has occurred,
        <span class="code">ei_xreceive_msg</span> returns <span class="code">ERL_TICK</span> to
        the caller without storing a message into the
        <span class="code">erlang_msg</span> structure.</p>

      <p>When a message has been received, it is the caller's responsibility
        to free the received message.</p>

      <p>For more information, see the
        <span class="bold_code bc-19"><a href="../../man/ei_connect.html"><span class="code">ei_connect</span></a></span> and
        <span class="bold_code bc-19"><a href="../../man/ei.html"><span class="code">ei</span></a></span> modules.</p>
    
  

  <h3 id="remote-procedure-calls" class="title-link" onMouseOver="document.getElementById('ghlink-remote-procedure-calls-idm244').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-remote-procedure-calls-idm244').style.visibility = 'hidden';">
<div class="title-name">1.9 
        Remote Procedure Calls</div>
<div class="title-anchors"><span id="ghlink-remote-procedure-calls-idm244" class="ghlink-after"><a href="#remote-procedure-calls" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/erl_interface/doc/src/ei_users_guide.xml#L407" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>An Erlang node acting as a client to another Erlang node
      typically sends a request and waits for a reply. Such a request is
      included in a function call at a remote node and is called a remote
      procedure call.</p>

    <p>The following example checks if a specific Erlang process is alive:</p>

    <div class="example example-none"><pre>int index = 0, is_alive;
ei_x_buff args, result;

ei_x_new(&amp;result);
ei_x_new(&amp;args);
ei_x_encode_list_header(&amp;args, 1);
ei_x_encode_pid(&amp;args, &amp;check_pid);
ei_x_encode_empty_list(&amp;args);

if (ei_rpc(&amp;ec, fd, "erlang", "is_process_alive",
           args.buff, args.index, &amp;result) &lt; 0)
    handle_error();

if (ei_decode_version(result.buff, &amp;index) &lt; 0
    || ei_decode_bool(result.buff, &amp;index, &amp;is_alive) &lt; 0)
    handle_error();    </pre></div>

    <p>For more information about <span class="code">ei_rpc()</span> and its
      companions <span class="code">ei_rpc_to()</span> and
      <span class="code">ei_rpc_from()</span>, see the
      <span class="bold_code bc-19"><a href="../../man/ei_connect.html"><span class="code">ei_connect</span></a></span> module.</p>
  

  <h3 id="using-global-names" class="title-link" onMouseOver="document.getElementById('ghlink-using-global-names-idm255').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-using-global-names-idm255').style.visibility = 'hidden';">
<div class="title-name">1.10 
        Using Global Names</div>
<div class="title-anchors"><span id="ghlink-using-global-names-idm255" class="ghlink-after"><a href="#using-global-names" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/erl_interface/doc/src/ei_users_guide.xml#L440" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>A C node has access to names registered through the
      <span class="bold_code bc-18"><a href="../../man/global.html"><span class="code">global</span></a></span>
      module in Kernel. Names can be looked up, allowing the C node to send messages
      to named Erlang services. C nodes can also register global names,
      allowing them to provide named services to Erlang processes or other C
      nodes.</p>

    <p><span class="code">Erl_Interface</span> does not provide a native implementation of the
      global service. Instead it uses the global services provided by a "nearby"
      Erlang node. To use the services described in this section,
      it is necessary to first open a connection to an Erlang node.</p>

    <p>To see what names there are:</p>

    <div class="example example-none"><pre>char **names;
int count;
int i;

names = ei_global_names(ec,fd,&amp;count);

if (names) 
  for (i=0; i&lt;count; i++) 
    printf("%s\n",names[i]);

free(names);    </pre></div>

    <p><span class="bold_code bc-15"><a href="../../man/ei_global.html#ei_global_names">
      <span class="code">ei_global_names</span></a></span>
      allocates and returns a buffer containing
      all the names known to the <span class="code">global</span> module in <span class="code">Kernel</span>.
      <span class="code">count</span> is initialized to
      indicate the number of names in the array. The array of strings in names
      is terminated by a <span class="code">NULL</span> pointer, so it is not necessary to use
      <span class="code">count</span> to determine when the last name is reached.</p>

    <p>It is the caller's responsibility to free the array.
      <span class="code">ei_global_names</span> allocates the array and all the strings
      using a single call to <span class="code">malloc()</span>, so
      <span class="code">free(names)</span> is all that is necessary.</p>

    <p>To look up one of the names:</p>

    <div class="example example-none"><pre>ETERM *pid;
char node[256];
erlang_pid the_pid;

if (ei_global_whereis(ec,fd,"schedule",&amp;the_pid,node) &lt; 0)
   fprintf(stderr, "ei_global_whereis error\n");    </pre></div>

    <p>If <span class="code">"schedule"</span> is known to the
      <span class="code">global</span> module in <span class="code">Kernel</span>, an Erlang pid is
      written to the_pid. This pid that can be used to send messages to the schedule service.
      Also, <span class="code">node</span> is initialized to contain the name of
      the node where the service is registered, so that you can make a
      connection to it by simply passing the variable to
      <span class="bold_code bc-19"><a href="../../man/ei_connect.html"><span class="code">ei_connect</span></a></span>.</p>

    <p>Before registering a name, you should already have registered your
      port number with <span class="code">epmd</span>. This is not strictly necessary,
      but if you
      neglect to do so, then other nodes wishing to communicate with your
      service cannot find or connect to your process.</p>

    <p>Create a name that Erlang processes can use to communicate with your
      service:</p>

    <div class="example example-none"><pre>ei_global_register(fd,servicename,ei_self(ec));    </pre></div>

    <p>After registering the name, use
        <span class="bold_code bc-15"><a href="../../man/ei_connect.html#ei_accept">
        <span class="code">ei_accept</span></a></span>
        to wait for incoming connections.</p>

    <div class="note">
<div class="label">Note</div>
<div class="content"><p>
      <p>Remember to free <span class="code">pid</span> later with
        <span class="bold_code bc-15"><a href="../../man/ei.html#ei_x_free">
        <span class="code">ei_x_free</span></a></span>.</p>
    </p></div>
</div>

    <p>To unregister a name:</p>

    <div class="example example-none"><pre>ei_global_unregister(ec,fd,servicename);    </pre></div>
  

</div>
<div class="footer">
<hr>
<p>Copyright © 1998-2021 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script type="text/javascript">window.__otpTopDocDir = '../../js/';</script><script type="text/javascript" src="../../js/highlight.js"></script>
<script src="/assets/js/doc-search.bundle.js"></script>
</body>
</html>
