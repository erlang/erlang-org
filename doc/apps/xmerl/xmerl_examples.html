<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.1">
    <meta name="project" content="xmerl v2.1.7">


<meta name="major-vsn" content="28">
<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=28&q=">
<link rel="canonical" href="https://www.erlang.org/doc/apps/xmerl/xmerl_examples.html" />
    <title>Customization functions — xmerl v2.1.7</title>

    <link rel="stylesheet" href="dist/html-erlang-ZK43ZOAC.css" />

    <script defer src="dist/sidebar_items-CB494AA4.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="xmerl" />
        </a>

      <div>
        <a href="../../index.html" class="sidebar-projectName" translate="no">
xmerl
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v2.1.7
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of xmerl</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>Customization functions</h1>


      <a href="https://github.com/erlang/otp/blob/OTP-28.2/lib/xmerl/doc/guides/xmerl_examples.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<h3 id="1-description" class="section-heading"><a href="#1-description" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">1 Description</span></h3><p>The XML processor offers a number of hooks for customization. These hooks are
defined as function objects, and can be provided by the caller.</p><p>The following customization functions are available. If they also have access to
their own state variable, the access function for this state is identified
within parentheses:</p><ul><li>  event function ( <code class="inline">xmerl_scan:event_state/[1,2]</code> )</li><li>  hook function ( <code class="inline">xmerl_scan:hook_state/[1,2]</code> )</li><li>  fetch function ( <code class="inline">xmerl_scan:fetch_state/[1,2]</code> )</li><li>  continuation function ( <code class="inline">xmerl_scan:cont_state/[1,2]</code> )</li><li>  rules function ( <code class="inline">xmerl_scan:rules_state/[1,2]</code> )</li><li>  accumulator function</li><li>  close function</li></ul><p>For all of the above state access functions, the function with one argument
(e.g. <code class="inline">event_state(GlobalState)</code>) will read the state variable, while the
function with two arguments (e.g.: <code class="inline">event_state(NewEventState, GlobalState)</code>)
will modify it.</p><p>For each function, the description starts with the syntax for specifying the
function in the <a href="xmerl_scan.html#t:option_list/0"><code class="inline">Option_list</code></a>. The general
forms are <code class="inline">{Tag, Fun}</code>, or <code class="inline">{Tag, Fun, LocalState}</code>. The second form can be used
to initialize the state variable in question.</p><h4>1.1 User State</h4><p>All customization functions are free to access a &quot;User state&quot; variable. Care
must of course be taken to coordinate the use of this state. It is recommended
that functions, which do not really have anything to contribute to the &quot;global&quot;
user state, use their own state variable instead. Another option (used in e.g.
<code class="inline">xmerl_eventp.erl</code>) is for customization functions to share one of the local
states (in <code class="inline">xmerl_eventp.erl</code>, the continuation function and the fetch function
both access the cont_state.)</p><p>Functions to access user state:</p><ul><li>  <code class="inline">xmerl_scan:user_state(GlobalState)</code></li><li>  <code class="inline">xmerl_scan:user_state(UserState, GlobalState)</code></li></ul><h4>1.2 Event Function</h4><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="4622524773-1">{</span><span class="ss">event_fun</span><span class="p">,</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="4622524773-2">(</span><span class="p" data-group-id="4622524773-2">)</span><span class="p" data-group-id="4622524773-1">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="4622524773-3">{</span><span class="ss">event_fun</span><span class="p">,</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="4622524773-4">(</span><span class="p" data-group-id="4622524773-4">)</span><span class="p">,</span><span class="w"> </span><span class="n">EventState</span><span class="p" data-group-id="4622524773-3">}</span></code></pre><p>The event function is called at the beginning and at the end of a parsed entity.
It has the following format and semantics:</p><pre><code class="makeup erlang" translate="no"><span class="nf">fun</span><span class="p" data-group-id="5221920782-1">(</span><span class="n">Event</span><span class="p">,</span><span class="w"> </span><span class="n">GlobalState</span><span class="p" data-group-id="5221920782-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
   </span><span class="n">EventState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">xmerl_scan</span><span class="p">:</span><span class="nf">event_state</span><span class="p" data-group-id="5221920782-2">(</span><span class="n">GlobalState</span><span class="p" data-group-id="5221920782-2">)</span><span class="p">,</span><span class="w">
   </span><span class="n">EventState2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">foo</span><span class="p" data-group-id="5221920782-3">(</span><span class="n">Event</span><span class="p">,</span><span class="w"> </span><span class="n">EventState</span><span class="p" data-group-id="5221920782-3">)</span><span class="p">,</span><span class="w">
   </span><span class="n">GlobalState2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">xmerl_scan</span><span class="p">:</span><span class="nf">event_state</span><span class="p" data-group-id="5221920782-4">(</span><span class="n">EventState2</span><span class="p">,</span><span class="w"> </span><span class="n">GlobalState</span><span class="p" data-group-id="5221920782-4">)</span><span class="w">
</span><span class="k">end</span><span class="p">.</span></code></pre><h4>1.3 Hook Function</h4><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="1811219026-1">{</span><span class="ss">hook_fun</span><span class="p">,</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="1811219026-2">(</span><span class="p" data-group-id="1811219026-2">)</span><span class="p" data-group-id="1811219026-1">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="1811219026-3">{</span><span class="ss">hook_fun</span><span class="p">,</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="1811219026-4">(</span><span class="p" data-group-id="1811219026-4">)</span><span class="p">,</span><span class="w"> </span><span class="n">HookState</span><span class="p" data-group-id="1811219026-3">}</span></code></pre><p>The hook function is called when the processor has parsed a complete entity.
Format and semantics:</p><pre><code class="makeup erlang" translate="no"><span class="nf">fun</span><span class="p" data-group-id="5542133869-1">(</span><span class="n">Entity</span><span class="p">,</span><span class="w"> </span><span class="n">GlobalState</span><span class="p" data-group-id="5542133869-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
   </span><span class="n">HookState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">xmerl_scan</span><span class="p">:</span><span class="nf">hook_state</span><span class="p" data-group-id="5542133869-2">(</span><span class="n">GlobalState</span><span class="p" data-group-id="5542133869-2">)</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="5542133869-3">{</span><span class="n">TransformedEntity</span><span class="p">,</span><span class="w"> </span><span class="n">HookState2</span><span class="p" data-group-id="5542133869-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">foo</span><span class="p" data-group-id="5542133869-4">(</span><span class="n">Entity</span><span class="p">,</span><span class="w"> </span><span class="n">HookState</span><span class="p" data-group-id="5542133869-4">)</span><span class="p">,</span><span class="w">
   </span><span class="n">GlobalState2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">xmerl_scan</span><span class="p">:</span><span class="nf">hook_state</span><span class="p" data-group-id="5542133869-5">(</span><span class="n">HookState2</span><span class="p">,</span><span class="w"> </span><span class="n">GlobalState</span><span class="p" data-group-id="5542133869-5">)</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="5542133869-6">{</span><span class="n">TransformedEntity</span><span class="p">,</span><span class="w"> </span><span class="n">GlobalState2</span><span class="p" data-group-id="5542133869-6">}</span><span class="w">
</span><span class="k">end</span><span class="p">.</span></code></pre><p>The relationship between the event function, the hook function and the
accumulator function is as follows:</p><ol><li> The event function is first called with an 'ended' event for the parsed
entity.</li><li> The hook function is called, possibly re-formatting the entity.</li><li> The acc function is called in order to (optionally) add the re-formatted
entity to the contents of its parent element.</li></ol><h4>1.4 Fetch Function</h4><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="3260193293-1">{</span><span class="ss">fetch_fun</span><span class="p">,</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="3260193293-2">(</span><span class="p" data-group-id="3260193293-2">)</span><span class="p" data-group-id="3260193293-1">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="3260193293-3">{</span><span class="ss">fetch_fun</span><span class="p">,</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="3260193293-4">(</span><span class="p" data-group-id="3260193293-4">)</span><span class="p">,</span><span class="w"> </span><span class="n">FetchState</span><span class="p" data-group-id="3260193293-3">}</span></code></pre><p>The fetch function is called in order to fetch an external resource (e.g. a
DTD).</p><p>The fetch function can respond with three different return values:</p><pre><code class="makeup erlang" translate="no"><span class="n">Result</span><span class="w"> </span><span class="p">:</span><span class="p">:=</span><span class="w">
   </span><span class="p" data-group-id="5201708124-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5201708124-2">{</span><span class="ss">file</span><span class="p">,</span><span class="w"> </span><span class="n">Filename</span><span class="p" data-group-id="5201708124-2">}</span><span class="p">,</span><span class="w"> </span><span class="n">NewGlobalState</span><span class="p" data-group-id="5201708124-1">}</span><span class="w"> </span><span class="p">|</span><span class="w">
   </span><span class="p" data-group-id="5201708124-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5201708124-4">{</span><span class="ss">string</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p" data-group-id="5201708124-4">}</span><span class="p">,</span><span class="w"> </span><span class="n">NewGlobalState</span><span class="p" data-group-id="5201708124-3">}</span><span class="w"> </span><span class="p">|</span><span class="w">
   </span><span class="p" data-group-id="5201708124-5">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="ss">not_fetched</span><span class="p">,</span><span class="w"> </span><span class="n">NewGlobalState</span><span class="p" data-group-id="5201708124-5">}</span></code></pre><p>Format and semantics:</p><pre><code class="makeup erlang" translate="no"><span class="nf">fun</span><span class="p" data-group-id="1807094654-1">(</span><span class="n">URI</span><span class="p">,</span><span class="w"> </span><span class="n">GlobalState</span><span class="p" data-group-id="1807094654-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
   </span><span class="n">FetchState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">xmerl_scan</span><span class="p">:</span><span class="nf">fetch_state</span><span class="p" data-group-id="1807094654-2">(</span><span class="n">GlobalState</span><span class="p" data-group-id="1807094654-2">)</span><span class="p">,</span><span class="w">
   </span><span class="n">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">foo</span><span class="p" data-group-id="1807094654-3">(</span><span class="n">URI</span><span class="p">,</span><span class="w"> </span><span class="n">FetchState</span><span class="p" data-group-id="1807094654-3">)</span><span class="p">.</span><span class="w">  </span><span class="c1">% Result being one of the above</span><span class="w">
</span><span class="k">end</span><span class="p">.</span></code></pre><h4>1.5 Continuation Function</h4><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="7067126974-1">{</span><span class="ss">continuation_fun</span><span class="p">,</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="7067126974-2">(</span><span class="p" data-group-id="7067126974-2">)</span><span class="p" data-group-id="7067126974-1">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="7067126974-3">{</span><span class="ss">continuation_fun</span><span class="p">,</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="7067126974-4">(</span><span class="p" data-group-id="7067126974-4">)</span><span class="p">,</span><span class="w"> </span><span class="n">ContinuationState</span><span class="p" data-group-id="7067126974-3">}</span></code></pre><p>The continuation function is called when the parser encounters the end of the
byte stream. Format and semantics:</p><pre><code class="makeup erlang" translate="no"><span class="nf">fun</span><span class="p" data-group-id="3884808271-1">(</span><span class="n">Continue</span><span class="p">,</span><span class="w"> </span><span class="n">Exception</span><span class="p">,</span><span class="w"> </span><span class="n">GlobalState</span><span class="p" data-group-id="3884808271-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
   </span><span class="n">ContState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">xmerl_scan</span><span class="p">:</span><span class="nf">cont_state</span><span class="p" data-group-id="3884808271-2">(</span><span class="n">GlobalState</span><span class="p" data-group-id="3884808271-2">)</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="3884808271-3">{</span><span class="n">Result</span><span class="p">,</span><span class="w"> </span><span class="n">ContState2</span><span class="p" data-group-id="3884808271-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">get_more_bytes</span><span class="p" data-group-id="3884808271-4">(</span><span class="n">ContState</span><span class="p" data-group-id="3884808271-4">)</span><span class="p">,</span><span class="w">
   </span><span class="k">case</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="k">of</span><span class="w">
      </span><span class="p" data-group-id="3884808271-5">[</span><span class="p" data-group-id="3884808271-5">]</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
         </span><span class="n">GlobalState2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">xmerl_scan</span><span class="p">:</span><span class="nf">cont_state</span><span class="p" data-group-id="3884808271-6">(</span><span class="n">ContState2</span><span class="p">,</span><span class="w"> </span><span class="n">GlobalState</span><span class="p" data-group-id="3884808271-6">)</span><span class="p">,</span><span class="w">
         </span><span class="n">Exception</span><span class="p" data-group-id="3884808271-7">(</span><span class="n">GlobalState2</span><span class="p" data-group-id="3884808271-7">)</span><span class="p">;</span><span class="w">
      </span><span class="n">MoreBytes</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
         </span><span class="p" data-group-id="3884808271-8">{</span><span class="n">MoreBytes2</span><span class="p">,</span><span class="w"> </span><span class="n">Rest</span><span class="p" data-group-id="3884808271-8">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">end_on_whitespace_char</span><span class="p" data-group-id="3884808271-9">(</span><span class="n">MoreBytes</span><span class="p" data-group-id="3884808271-9">)</span><span class="p">,</span><span class="w">
         </span><span class="n">ContState3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">update_cont_state</span><span class="p" data-group-id="3884808271-10">(</span><span class="n">Rest</span><span class="p">,</span><span class="w"> </span><span class="n">ContState2</span><span class="p" data-group-id="3884808271-10">)</span><span class="p">,</span><span class="w">
         </span><span class="n">GlobalState3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">xmerl_scan</span><span class="p">:</span><span class="nf">cont_state</span><span class="p" data-group-id="3884808271-11">(</span><span class="n">ContState3</span><span class="p">,</span><span class="w"> </span><span class="n">GlobalState</span><span class="p" data-group-id="3884808271-11">)</span><span class="p">,</span><span class="w">
         </span><span class="n">Continue</span><span class="p" data-group-id="3884808271-12">(</span><span class="n">MoreBytes2</span><span class="p">,</span><span class="w"> </span><span class="n">GlobalState3</span><span class="p" data-group-id="3884808271-12">)</span><span class="w">
   </span><span class="k">end</span><span class="w">
</span><span class="k">end</span><span class="p">.</span></code></pre><h4>1.6 Rules Functions</h4><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="6359528107-1">{</span><span class="ss">rules</span><span class="p">,</span><span class="w"> </span><span class="n">ReadFun</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="6359528107-2">(</span><span class="p" data-group-id="6359528107-2">)</span><span class="p">,</span><span class="w"> </span><span class="n">WriteFun</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="6359528107-3">(</span><span class="p" data-group-id="6359528107-3">)</span><span class="p">,</span><span class="w"> </span><span class="n">RulesState</span><span class="p" data-group-id="6359528107-1">}</span><span class="w"> </span><span class="p">|</span><span class="w">
</span><span class="p" data-group-id="6359528107-4">{</span><span class="ss">rules</span><span class="p">,</span><span class="w"> </span><span class="n">Table</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nf">ets</span><span class="p" data-group-id="6359528107-5">(</span><span class="p" data-group-id="6359528107-5">)</span><span class="p" data-group-id="6359528107-4">}</span></code></pre><p>The rules functions take care of storing scanner information in a rules
database. User-provided rules functions may opt to store the information in
mnesia, or perhaps in the user_state(RulesState).</p><p>The following modes exist:</p><ul><li>  If the user doesn't specify an option, the scanner creates an ets table, and
uses built-in functions to read and write data to it. When the scanner is
done, the ets table is deleted.</li><li>  If the user specifies an ets table via the <code class="inline">{rules, Table}</code> option, the
scanner uses this table. When the scanner is done, it does <em>not</em> delete the
table.</li><li>  If the user specifies read and write functions, the scanner will use them
instead.</li></ul><p>The format for the read and write functions are as follows:</p><pre><code class="makeup erlang" translate="no"><span class="w"> </span><span class="n">WriteFun</span><span class="p" data-group-id="8318886808-1">(</span><span class="n">Context</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">Definition</span><span class="p">,</span><span class="w"> </span><span class="n">ScannerState</span><span class="p" data-group-id="8318886808-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">NewScannerState</span><span class="p">.</span><span class="w">
 </span><span class="n">ReadFun</span><span class="p" data-group-id="8318886808-2">(</span><span class="n">Context</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">ScannerState</span><span class="p" data-group-id="8318886808-2">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">Definition</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="ss">undefined</span><span class="p">.</span></code></pre><p>Here is a summary of the data objects currently being written by the scanner:</p><table><thead><tr><th style="text-align: left;">Context</th><th style="text-align: left;">Key Value</th><th style="text-align: left;">Definition</th></tr></thead><tbody><tr><td style="text-align: left;">notation</td><td style="text-align: left;">NotationName</td><td style="text-align: left;"><code class="inline">{system, SL} | {public, PIDL, SL}</code></td></tr><tr><td style="text-align: left;">elem_def</td><td style="text-align: left;">ElementName</td><td style="text-align: left;"><code class="inline">#xmlElement{content = ContentSpec}</code></td></tr><tr><td style="text-align: left;">parameter_entity</td><td style="text-align: left;">PEName</td><td style="text-align: left;"><code class="inline">PEDef</code></td></tr><tr><td style="text-align: left;">entity</td><td style="text-align: left;">EntityName</td><td style="text-align: left;"><code class="inline">EntityDef</code></td></tr></tbody></table><p><strong> Table 1:</strong> Scanner data objects</p><p>where</p><pre><code class="makeup erlang" translate="no"><span class="n">ContentSpec</span><span class="w"> </span><span class="p">:</span><span class="p">:=</span><span class="w"> </span><span class="ss">empty</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="ss">any</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">ElemContent</span><span class="w">
</span><span class="n">ElemContent</span><span class="w"> </span><span class="p">:</span><span class="p">:=</span><span class="w"> </span><span class="p" data-group-id="4552036944-1">{</span><span class="n">Mode</span><span class="p">,</span><span class="w"> </span><span class="n">Elems</span><span class="p" data-group-id="4552036944-1">}</span><span class="w">
</span><span class="n">Mode</span><span class="w">        </span><span class="p">:</span><span class="p">:=</span><span class="w"> </span><span class="ss">seq</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="ss">choice</span><span class="w">
</span><span class="n">Elems</span><span class="w">       </span><span class="p">:</span><span class="p">:=</span><span class="w"> </span><span class="p" data-group-id="4552036944-2">[</span><span class="n">Elem</span><span class="p" data-group-id="4552036944-2">]</span><span class="w">
</span><span class="n">Elem</span><span class="w">        </span><span class="p">:</span><span class="p">:=</span><span class="w"> </span><span class="ss">&#39;#PCDATA&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">ElemContent</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="4552036944-3">{</span><span class="n">Occurrence</span><span class="p">,</span><span class="w"> </span><span class="n">Elems</span><span class="p" data-group-id="4552036944-3">}</span><span class="w">
</span><span class="n">Occurrence</span><span class="w">  </span><span class="p">:</span><span class="p">:=</span><span class="w"> </span><span class="ss">&#39;*&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="ss">&#39;?&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="ss">&#39;+&#39;</span></code></pre><p>NOTE: <em>When &lt;Elem&gt; is not wrapped with &lt;Occurrence&gt;, (Occurrence = once) is
implied.</em></p><h4>1.7 Accumulator Function</h4><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="4161587480-1">{</span><span class="ss">acc_fun</span><span class="p">,</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="4161587480-2">(</span><span class="p" data-group-id="4161587480-2">)</span><span class="p" data-group-id="4161587480-1">}</span></code></pre><p>The accumulator function is called to accumulate the contents of an entity.When
parsing very large files, it may not be desirable to do so.In this case, an acc
function can be provided that simply doesn't accumulate.</p><p>Note that it is possible to even modify the parsed entity before accumulating
it, but this must be done with care. xmerl_scan performs post-processing of the
element for namespace management. Thus, the element must keep its original
structure for this to work.</p><p>The acc function has the following format and semantics:</p><pre><code class="makeup erlang" translate="no"><span class="c1">%% default accumulating acc fun</span><span class="w">
</span><span class="nf">fun</span><span class="p" data-group-id="1530675917-1">(</span><span class="n">ParsedEntity</span><span class="p">,</span><span class="w"> </span><span class="n">Acc</span><span class="p">,</span><span class="w"> </span><span class="n">GlobalState</span><span class="p" data-group-id="1530675917-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
   </span><span class="p" data-group-id="1530675917-2">{</span><span class="p" data-group-id="1530675917-3">[</span><span class="n">ParsedEntity</span><span class="p">|</span><span class="n">Acc</span><span class="p" data-group-id="1530675917-3">]</span><span class="p">,</span><span class="w"> </span><span class="n">GlobalState</span><span class="p" data-group-id="1530675917-2">}</span><span class="p">.</span><span class="w">

</span><span class="c1">%% non-accumulating acc fun</span><span class="w">
</span><span class="nf">fun</span><span class="p" data-group-id="1530675917-4">(</span><span class="n">ParsedEntity</span><span class="p">,</span><span class="w"> </span><span class="n">Acc</span><span class="p">,</span><span class="w"> </span><span class="n">GlobalState</span><span class="p" data-group-id="1530675917-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
   </span><span class="p" data-group-id="1530675917-5">{</span><span class="n">Acc</span><span class="p">,</span><span class="w"> </span><span class="n">GlobalState</span><span class="p" data-group-id="1530675917-5">}</span><span class="p">.</span></code></pre><h4>1.8 Close Function</h4><p>The close function is called when a document (either the main document or an
external DTD) has been completely parsed. When xmerl_scan was started using
<code class="inline">xmerl_scan:file/[1,2]</code>, the file will be read in full, and closed immediately,
before the parsing starts, so when the close function is called, it will not
need to actually close the file. In this case, the close function will be a good
place to modify the state variables.</p><p>Format and semantics:</p><pre><code class="makeup erlang" translate="no"><span class="nf">fun</span><span class="p" data-group-id="4285836701-1">(</span><span class="n">GlobalState</span><span class="p" data-group-id="4285836701-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
   </span><span class="n">GlobalState1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">  </span><span class="c1">% state variables may be altered</span></code></pre><h3 id="2-examples" class="section-heading"><a href="#2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">2 Examples</span></h3><p>See <code class="inline">xmerl_test.erl</code> for more examples.</p><h4>2.1 Handling spaces</h4><p>The following sample program illustrates three ways of scanning a document:</p><ol><li> the default scan, which leaves whitespace untouched</li><li> normalizing spaces</li><li> normalizing spaces, then removing text elements that only contain one space.</li></ol><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6363060278-1">(</span><span class="ss">tmp</span><span class="p" data-group-id="6363060278-1">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">include</span><span class="p" data-group-id="6363060278-2">(</span><span class="s">&quot;xmerl.hrl&quot;</span><span class="p" data-group-id="6363060278-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6363060278-3">(</span><span class="p" data-group-id="6363060278-4">[</span><span class="ss">file1</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">file2</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">file3</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="6363060278-4">]</span><span class="p" data-group-id="6363060278-3">)</span><span class="p">.</span><span class="w">

</span><span class="nf">file1</span><span class="p" data-group-id="6363060278-5">(</span><span class="n">F</span><span class="p" data-group-id="6363060278-5">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">xmerl_scan</span><span class="p">:</span><span class="nf">file</span><span class="p" data-group-id="6363060278-6">(</span><span class="n">F</span><span class="p" data-group-id="6363060278-6">)</span><span class="p">.</span><span class="w">

</span><span class="nf">file2</span><span class="p" data-group-id="6363060278-7">(</span><span class="n">F</span><span class="p" data-group-id="6363060278-7">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">xmerl_scan</span><span class="p">:</span><span class="nf">file</span><span class="p" data-group-id="6363060278-8">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6363060278-9">[</span><span class="p" data-group-id="6363060278-10">{</span><span class="ss">space</span><span class="p">,</span><span class="ss">normalize</span><span class="p" data-group-id="6363060278-10">}</span><span class="p" data-group-id="6363060278-9">]</span><span class="p" data-group-id="6363060278-8">)</span><span class="p">.</span><span class="w">

</span><span class="nf">file3</span><span class="p" data-group-id="6363060278-11">(</span><span class="n">F</span><span class="p" data-group-id="6363060278-11">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">Acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="6363060278-12">(</span><span class="o">#</span><span class="ss">xmlText</span><span class="p" data-group-id="6363060278-13">{</span><span class="ss">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="p" data-group-id="6363060278-13">}</span><span class="p">,</span><span class="w"> </span><span class="n">Acc</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="p" data-group-id="6363060278-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="6363060278-14">{</span><span class="n">Acc</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w">
</span><span class="n">S</span><span class="p" data-group-id="6363060278-14">}</span><span class="p">;</span><span class="w"> </span><span class="c1">% new return format (X, Acc, S) -&gt; {[X|Acc], S} end, xmerl_scan:file(F,</span><span class="w">
</span><span class="p" data-group-id="6363060278-15">[</span><span class="p" data-group-id="6363060278-16">{</span><span class="ss">space</span><span class="p">,</span><span class="ss">normalize</span><span class="p" data-group-id="6363060278-16">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6363060278-17">{</span><span class="ss">acc_fun</span><span class="p">,</span><span class="w"> </span><span class="n">Acc</span><span class="p" data-group-id="6363060278-17">}</span><span class="p" data-group-id="6363060278-15">]</span><span class="p">)</span><span class="p">.</span></code></pre>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="xmerl_ug.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Xmerl
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="xmerl_xs_examples.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
XSLT-like transformations
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright © 1996-2025 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js"></script>
  <script>
  let initialized = false;

  window.addEventListener("exdoc:loaded", () => {
      if (!initialized) {
      mermaid.initialize({
          startOnLoad: false,
          theme: document.body.className.includes("dark") ? "dark" : "default"
      });
      initialized = true;
      }

      let id = 0;
      for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
          graphEl.innerHTML = svg;
          bindFunctions?.(graphEl);
          preEl.insertAdjacentElement("afterend", graphEl);
          preEl.remove();
      });
      }
  });
  </script>

  </body>
</html>
