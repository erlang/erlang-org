<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:erl="http://erlang.org" xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<link rel="stylesheet" href="../../otp_doc.css" type="text/css">
<meta name="major-vsn" content="24">
<title>Erlang -- SystemTap and Erlang/OTP</title>
</head>
<body>
<div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../../js/erlresolvelinks.js"></script><script id="js3" type="text/javascript" src="../../../../doc/js/topbar.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function setscrollpos() {
                var objf = document.getElementById('loadscrollpos');
                if (objf) {
                  document.getElementById("leftnav").firstChild.scrollTop = objf.offsetTop - 10;
                }
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //-->
</script><div class="topbar">
<div class="topbar-expand "><button onclick="toggleDisplay();"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="Capa_1" viewBox="0 0 54 54" width="24" height="24"><g><path style="fill:#000000;" d="M27,54c-0.552,0-1-0.448-1-1V8c0-0.552,0.448-1,1-1s1,0.448,1,1v45C28,53.552,27.552,54,27,54z"></path><path style="fill:#000000;" d="M11,25c-0.256,0-0.512-0.098-0.707-0.293c-0.391-0.391-0.391-1.023,0-1.414l16-16                                      c0.391-0.391,1.023-0.391,1.414,0s0.391,1.023,0,1.414l-16,16C11.512,24.902,11.256,25,11,25z"></path><path style="fill:#000000;" d="M43,25c-0.256,0-0.512-0.098-0.707-0.293l-16-16c-0.391-0.391-0.391-1.023,0-1.414                                      s1.023-0.391,1.414,0l16,16c0.391,0.391,0.391,1.023,0,1.414C43.512,24.902,43.256,25,43,25z"></path><path style="fill:#000000;" d="M43,2H11c-0.552,0-1-0.448-1-1s0.448-1,1-1h32c0.552,0,1,0.448,1,1S43.552,2,43,2z"></path></g></svg></button></div>
<div class="topbar-title"><h1 id="SystemTap and Erlang/OTP">3 
                SystemTap and Erlang/OTP</h1></div>
<div class="search-expand ">        <button id="docsearch-mobile">
            <svg fill="#000000" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="24" height="24"><path d="M 21 3 C 11.621094 3 4 10.621094 4 20 C 4 29.378906 11.621094 37 21 37 C 24.710938 37 28.140625 35.804688 30.9375 33.78125 L 44.09375 46.90625 L 46.90625 44.09375 L 33.90625 31.0625 C 36.460938 28.085938 38 24.222656 38 20 C 38 10.621094 30.378906 3 21 3 Z M 21 5 C 29.296875 5 36 11.703125 36 20 C 36 28.296875 29.296875 35 21 35 C 12.703125 35 6 28.296875 6 20 C 6 11.703125 12.703125 5 21 5 Z"/></svg>
        </button>
</div>
</div>
<aside class="hide-mobile" id="leftnav"><nav class="leftnav-tube"><div class="erlang-logo-wrapper"><a href="../../index.html"><img alt="Erlang Logo" src="../../erlang-logo.png" class="erlang-logo"></a></div>
<p class="section-title">Runtime_Tools</p>
<p class="section-subtitle">User's Guide</p>
<p class="section-version">Version 1.18</p>
<ul class="panel-sections">
<li><a href="users_guide.html">User's Guide</a></li>
<li><a href="index.html">Reference Manual</a></li>
<li><a href="notes.html">Release Notes</a></li>
<li><a href="runtime_tools.pdf">PDF</a></li>
<li><a href="../../index.html">Top</a></li>
</ul>
<div id="docsearch"></div>
<div style="padding-left: 1rem; padding-top: 0.1rem;"><a href="/doc/search?v=24">Paginated Search</a></div>
<ul class="expand-collapse-items">
<li><a href="javascript:openAllFlips()">Expand All</a></li>
<li><a href="javascript:closeAllFlips()">Contract All</a></li>
</ul>
<h3 id="chapters">Chapters</h3>
<ul class="flipMenu" imagePath="../../js/flipmenu">
<li id="no" title="LTTng and Erlang/OTP" expanded="false">LTTng and Erlang/OTP<ul>
<li><a href="LTTng.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="LTTng.html#introduction">Introduction</a></li>
<li title="Building Erlang/OTP with LTTng support"><a href="LTTng.html#building-erlang-otp-with-lttng-support">Building Erlang/OTP with LTTng support</a></li>
<li title="Dyntrace Tracepoints"><a href="LTTng.html#dyntrace-tracepoints">Dyntrace Tracepoints</a></li>
<li title="BEAM Tracepoints"><a href="LTTng.html#beam-tracepoints">BEAM Tracepoints</a></li>
<li title="Example of process tracing"><a href="LTTng.html#example-of-process-tracing">Example of process tracing</a></li>
</ul>
</li>
<li id="no" title="DTrace and Erlang/OTP" expanded="false">DTrace and Erlang/OTP<ul>
<li><a href="DTRACE.html">
              Top of chapter
            </a></li>
<li title="History"><a href="DTRACE.html#history">History</a></li>
<li title="Goals"><a href="DTRACE.html#goals">Goals</a></li>
<li title="Supported platforms"><a href="DTRACE.html#supported-platforms">Supported platforms</a></li>
<li title="Status"><a href="DTRACE.html#status">Status</a></li>
<li title="DTrace probe specifications"><a href="DTRACE.html#dtrace-probe-specifications">DTrace probe specifications</a></li>
</ul>
</li>
<li id="loadscrollpos" title="SystemTap and Erlang/OTP" expanded="true">SystemTap and Erlang/OTP<ul>
<li><a href="SYSTEMTAP.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="SYSTEMTAP.html#introduction">Introduction</a></li>
<li title="Requisites"><a href="SYSTEMTAP.html#requisites">Requisites</a></li>
<li title="Building Erlang"><a href="SYSTEMTAP.html#building-erlang">Building Erlang</a></li>
<li title="Testing"><a href="SYSTEMTAP.html#testing">Testing</a></li>
<li title="Running SystemTap scripts"><a href="SYSTEMTAP.html#running-systemtap-scripts">Running SystemTap scripts</a></li>
</ul>
</li>
</ul></nav></aside><div id="content">
<div class="innertube">
<h1 id="SystemTap and Erlang/OTP">3 SystemTap and Erlang/OTP</h1>


<a name="Introduction"></a><h3 id="introduction" class="title-link" onMouseOver="document.getElementById('ghlink-introduction-idm840').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-introduction-idm840').style.visibility = 'hidden';">
<div class="title-name">3.1 
        Introduction</div>
<div class="title-anchors"><span id="ghlink-introduction-idm840" class="ghlink-after"><a href="#introduction" title="Link to this place!"><span class="paperclip-after"></span></a></span></div>
</h3>



<p>
SystemTap is DTrace for Linux. In fact Erlang's SystemTap support
is built using SystemTap's DTrace compatibility's layer. For an
introduction to Erlang DTrace support read <span class="bold_code bc-19"><a href="DTRACE.html">$ERL_TOP/HOWTO/DTRACE.md</a></span>.
</p>



<a name="Requisites"></a><h3 id="requisites" class="title-link" onMouseOver="document.getElementById('ghlink-requisites-idm845').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-requisites-idm845').style.visibility = 'hidden';">
<div class="title-name">3.2 
        Requisites</div>
<div class="title-anchors"><span id="ghlink-requisites-idm845" class="ghlink-after"><a href="#requisites" title="Link to this place!"><span class="paperclip-after"></span></a></span></div>
</h3>



<ul>
<li>
<p>Linux Kernel with UTRACE support
</p>

<p>check for UTRACE support in your current kernel:
</p>

<div class="example example-none"><pre># grep CONFIG_UTRACE /boot/config-`uname -r`
CONFIG_UTRACE=y</pre></div>
<p>Fedora 16 is known to contain UTRACE, for most other Linux distributions
a custom build kernel will be required.
Check Fedora's SystemTap documentation for additional required packages
(e.g. Kernel Debug Symbols)
</p>

</li>
<li>
<p>SystemTap &gt; 1.6
</p>

<p>A the time of writing this, the latest released version of SystemTap is
version 1.6. Erlang's DTrace support requires a MACRO that was introduced
after that release. So either get a newer release or build SystemTap from
git yourself (see: http://sourceware.org/systemtap/getinvolved.html)
</p>
</li>
</ul>


<a name="Building-Erlang"></a><h3 id="building-erlang" class="title-link" onMouseOver="document.getElementById('ghlink-building-erlang-idm857').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-building-erlang-idm857').style.visibility = 'hidden';">
<div class="title-name">3.3 
        Building Erlang</div>
<div class="title-anchors"><span id="ghlink-building-erlang-idm857" class="ghlink-after"><a href="#building-erlang" title="Link to this place!"><span class="paperclip-after"></span></a></span></div>
</h3>



<p>
Configure and build Erlang with SystemTap support:
</p>

<div class="example example-none"><pre># ./configure --with-dynamic-trace=systemtap + whatever args you need
# make</pre></div>


<a name="Testing"></a><h3 id="testing" class="title-link" onMouseOver="document.getElementById('ghlink-testing-idm862').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-testing-idm862').style.visibility = 'hidden';">
<div class="title-name">3.4 
        Testing</div>
<div class="title-anchors"><span id="ghlink-testing-idm862" class="ghlink-after"><a href="#testing" title="Link to this place!"><span class="paperclip-after"></span></a></span></div>
</h3>



<p>
SystemTap, unlike DTrace, needs to know what binary it is tracing and has to
be able to read that binary before it starts tracing. Your probe script
therefor has to reference the correct beam emulator and stap needs to be able
to find that binary.
The examples are written for "beam", but other versions such as "beam.smp" or
"beam.debug.smp" might exist (depending on your configuration). Make sure you
either specify the full the path of the binary in the probe or your "beam"
binary is in the search path.
</p>

<p>
All available probes can be listed like this:
</p>

<div class="example example-none"><pre># stap -L 'process("beam").mark("*")'</pre></div>
<p>
or:
</p>

<div class="example example-none"><pre># PATH=/path/to/beam:$PATH stap -L 'process("beam").mark("*")'</pre></div>
<p>
Probes in the dtrace.so NIF library like this:
</p>

<div class="example example-none"><pre># PATH=/path/to/dtrace/priv/lib:$PATH stap -L 'process("dtrace.so").mark("*")'</pre></div>


<a name="Running-SystemTap-scripts"></a><h3 id="running-systemtap-scripts" class="title-link" onMouseOver="document.getElementById('ghlink-running-systemtap-scripts-idm872').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-running-systemtap-scripts-idm872').style.visibility = 'hidden';">
<div class="title-name">3.5 
        Running SystemTap scripts</div>
<div class="title-anchors"><span id="ghlink-running-systemtap-scripts-idm872" class="ghlink-after"><a href="#running-systemtap-scripts" title="Link to this place!"><span class="paperclip-after"></span></a></span></div>
</h3>



<p>
Adjust the process("beam") reference to your beam version and attach the script
to a running "beam" instance:
</p>

<div class="example example-none"><pre># stap /path/to/probe/script/port1.systemtap -x &lt;pid of beam&gt;</pre></div>


</div>
<div class="footer">
<hr>
<p>Copyright © 1999-2024 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script type="text/javascript">window.__otpTopDocDir = '../../js/';</script><script type="text/javascript" src="../../js/highlight.js"></script>
<script type="text/javascript">
_docsearch_version = "24";
</script> 
<script src="/assets/js/doc-search.bundle.js"></script>
</body>
</html>
