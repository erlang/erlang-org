<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:erl="http://erlang.org" xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<link rel="stylesheet" href="../../otp_doc.css" type="text/css">
<meta name="major-vsn" content="24">
<title>Erlang -- Distribution Protocol</title>
</head>
<body>
<div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../../js/erlresolvelinks.js"></script><script id="js3" type="text/javascript" src="../../../doc/js/topbar.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function setscrollpos() {
                var objf = document.getElementById('loadscrollpos');
                if (objf) {
                  document.getElementById("leftnav").firstChild.scrollTop = objf.offsetTop - 10;
                }
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //-->
</script><div class="topbar">
<div class="topbar-expand "><button onclick="toggleDisplay();"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="Capa_1" viewBox="0 0 54 54" width="24" height="24"><g><path style="fill:#000000;" d="M27,54c-0.552,0-1-0.448-1-1V8c0-0.552,0.448-1,1-1s1,0.448,1,1v45C28,53.552,27.552,54,27,54z"></path><path style="fill:#000000;" d="M11,25c-0.256,0-0.512-0.098-0.707-0.293c-0.391-0.391-0.391-1.023,0-1.414l16-16                                      c0.391-0.391,1.023-0.391,1.414,0s0.391,1.023,0,1.414l-16,16C11.512,24.902,11.256,25,11,25z"></path><path style="fill:#000000;" d="M43,25c-0.256,0-0.512-0.098-0.707-0.293l-16-16c-0.391-0.391-0.391-1.023,0-1.414                                      s1.023-0.391,1.414,0l16,16c0.391,0.391,0.391,1.023,0,1.414C43.512,24.902,43.256,25,43,25z"></path><path style="fill:#000000;" d="M43,2H11c-0.552,0-1-0.448-1-1s0.448-1,1-1h32c0.552,0,1,0.448,1,1S43.552,2,43,2z"></path></g></svg></button></div>
<div class="topbar-title"><h1 id="Distribution Protocol">13Â 
                Distribution Protocol</h1></div>
<div class="search-expand ">        <button id="docsearch-mobile">
            <svg fill="#000000" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="24" height="24"><path d="M 21 3 C 11.621094 3 4 10.621094 4 20 C 4 29.378906 11.621094 37 21 37 C 24.710938 37 28.140625 35.804688 30.9375 33.78125 L 44.09375 46.90625 L 46.90625 44.09375 L 33.90625 31.0625 C 36.460938 28.085938 38 24.222656 38 20 C 38 10.621094 30.378906 3 21 3 Z M 21 5 C 29.296875 5 36 11.703125 36 20 C 36 28.296875 29.296875 35 21 35 C 12.703125 35 6 28.296875 6 20 C 6 11.703125 12.703125 5 21 5 Z"/></svg>
        </button>
</div>
</div>
<aside class="hide-mobile" id="leftnav"><nav class="leftnav-tube"><div class="erlang-logo-wrapper"><a href="../../index.html"><img alt="Erlang Logo" src="../../erlang-logo.png" class="erlang-logo"></a></div>
<p class="section-title">Erlang Run-Time System Application (ERTS)</p>
<p class="section-subtitle">User's Guide</p>
<p class="section-version">Version 12.3.2.17</p>
<ul class="panel-sections">
<li><a href="users_guide.html">User's Guide</a></li>
<li><a href="index.html">Reference Manual</a></li>
<li><a href="internal_docs.html">Internal Documentation</a></li>
<li><a href="notes.html">Release Notes</a></li>
<li><a href="erts.pdf">PDF</a></li>
<li><a href="../../index.html">Top</a></li>
</ul>
<div id="docsearch"></div>
<div style="padding-left: 1rem; padding-top: 0.1rem;"><a href="/doc/search?v=24">Paginated Search</a></div>
<ul class="expand-collapse-items">
<li><a href="javascript:openAllFlips()">Expand All</a></li>
<li><a href="javascript:closeAllFlips()">Contract All</a></li>
</ul>
<h3 id="chapters">Chapters</h3>
<ul class="flipMenu" imagePath="../../js/flipmenu">
<li id="no" title="Introduction" expanded="false">Introduction<ul>
<li><a href="introduction.html">
              Top of chapter
            </a></li>
<li title="Scope"><a href="introduction.html#scope">Scope</a></li>
<li title="Prerequisites"><a href="introduction.html#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li id="no" title="Communication in Erlang" expanded="false">Communication in Erlang<ul>
<li><a href="communication.html">
              Top of chapter
            </a></li>
<li title="Passing of Signals"><a href="communication.html#passing-of-signals">Passing of Signals</a></li>
<li title="Synchronous Communication"><a href="communication.html#synchronous-communication">Synchronous Communication</a></li>
<li title="Implementation"><a href="communication.html#implementation">Implementation</a></li>
</ul>
</li>
<li id="no" title="Time and Time Correction in Erlang" expanded="false">Time and Time Correction in Erlang<ul>
<li><a href="time_correction.html">
              Top of chapter
            </a></li>
<li title="New Extended Time Functionality"><a href="time_correction.html#new-extended-time-functionality">New Extended Time Functionality</a></li>
<li title="Terminology"><a href="time_correction.html#terminology">Terminology</a></li>
<li title="Introduction"><a href="time_correction.html#introduction">Introduction</a></li>
<li title="Time Correction"><a href="time_correction.html#time-correction">Time Correction</a></li>
<li title="Time Warp Safe Code"><a href="time_correction.html#time-warp-safe-code">Time Warp Safe Code</a></li>
<li title="Time Warp Modes"><a href="time_correction.html#time-warp-modes">Time Warp Modes</a></li>
<li title="New Time API"><a href="time_correction.html#new-time-api">New Time API</a></li>
<li title="Support of Both New and Old OTP Releases"><a href="time_correction.html#support-of-both-new-and-old-otp-releases">Support of Both New and Old OTP Releases</a></li>
</ul>
</li>
<li id="no" title="Match Specifications in Erlang" expanded="false">Match Specifications in Erlang<ul>
<li><a href="match_spec.html">
              Top of chapter
            </a></li>
<li title="Grammar"><a href="match_spec.html#grammar">Grammar</a></li>
<li title="Function Descriptions"><a href="match_spec.html#function-descriptions">Function Descriptions</a></li>
<li title="Match target"><a href="match_spec.html#match-target">Match target</a></li>
<li title="Variables and Literals"><a href="match_spec.html#variables-and-literals">Variables and Literals</a></li>
<li title="Execution of the Match"><a href="match_spec.html#execution-of-the-match">Execution of the Match</a></li>
<li title="Differences between Match Specifications in ETS and Tracing"><a href="match_spec.html#differences-between-match-specifications-in-ets-and-tracing">Differences between Match Specifications in ETS and Tracing</a></li>
<li title="Tracing Examples"><a href="match_spec.html#tracing-examples">Tracing Examples</a></li>
<li title="ETS Examples"><a href="match_spec.html#ets-examples">ETS Examples</a></li>
</ul>
</li>
<li id="no" title="How to Interpret the Erlang Crash Dumps" expanded="false">How to Interpret the Erlang Crash Dumps<ul>
<li><a href="crash_dump.html">
              Top of chapter
            </a></li>
<li title="General Information"><a href="crash_dump.html#general-information">General Information</a></li>
<li title="Scheduler Information"><a href="crash_dump.html#scheduler-information">Scheduler Information</a></li>
<li title="Memory Information"><a href="crash_dump.html#memory-information">Memory Information</a></li>
<li title="Internal Table Information"><a href="crash_dump.html#internal-table-information">Internal Table Information</a></li>
<li title="Allocated Areas"><a href="crash_dump.html#allocated-areas">Allocated Areas</a></li>
<li title="Allocator"><a href="crash_dump.html#allocator">Allocator</a></li>
<li title="Process Information"><a href="crash_dump.html#process-information">Process Information</a></li>
<li title="Port Information"><a href="crash_dump.html#port-information">Port Information</a></li>
<li title="ETS Tables"><a href="crash_dump.html#ets-tables">ETS Tables</a></li>
<li title="Timers"><a href="crash_dump.html#timers">Timers</a></li>
<li title="Distribution Information"><a href="crash_dump.html#distribution-information">Distribution Information</a></li>
<li title="Loaded Module Information"><a href="crash_dump.html#loaded-module-information">Loaded Module Information</a></li>
<li title="Fun Information"><a href="crash_dump.html#fun-information">Fun Information</a></li>
<li title="Process Data"><a href="crash_dump.html#process-data">Process Data</a></li>
<li title="Atoms"><a href="crash_dump.html#atoms">Atoms</a></li>
<li title="Disclaimer"><a href="crash_dump.html#disclaimer">Disclaimer</a></li>
</ul>
</li>
<li id="no" title="How to Implement an Alternative Carrier for the Erlang Distribution
    " expanded="false">How to Implement an Alternative Carrier for the Erlang Distribution
    <ul>
<li><a href="alt_dist.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="alt_dist.html#introduction">Introduction</a></li>
<li title="Distribution Module"><a href="alt_dist.html#distribution-module">Distribution Module</a></li>
<li title="The Driver"><a href="alt_dist.html#the-driver">The Driver</a></li>
<li title="Putting It All Together"><a href="alt_dist.html#putting-it-all-together">Putting It All Together</a></li>
</ul>
</li>
<li id="no" title="How to Implement an Alternative Node Discovery for Erlang Distribution
    " expanded="false">How to Implement an Alternative Node Discovery for Erlang Distribution
    <ul>
<li><a href="alt_disco.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="alt_disco.html#introduction">Introduction</a></li>
<li title="Discovery module"><a href="alt_disco.html#discovery-module">Discovery module</a></li>
</ul>
</li>
<li id="no" title="The Abstract Format" expanded="false">The Abstract Format<ul>
<li><a href="absform.html">
              Top of chapter
            </a></li>
<li title="Module Declarations and Forms"><a href="absform.html#module-declarations-and-forms">Module Declarations and Forms</a></li>
<li title="Atomic Literals"><a href="absform.html#atomic-literals">Atomic Literals</a></li>
<li title="Patterns"><a href="absform.html#patterns">Patterns</a></li>
<li title="Expressions"><a href="absform.html#expressions">Expressions</a></li>
<li title="Clauses"><a href="absform.html#clauses">Clauses</a></li>
<li title="Guards"><a href="absform.html#guards">Guards</a></li>
<li title="Types"><a href="absform.html#types">Types</a></li>
<li title="The Abstract Format after Preprocessing"><a href="absform.html#the-abstract-format-after-preprocessing">The Abstract Format after Preprocessing</a></li>
</ul>
</li>
<li id="no" title="tty - A Command-Line Interface" expanded="false">tty - A Command-Line Interface<ul>
<li><a href="tty.html">
              Top of chapter
            </a></li>
<li title="Normal Mode"><a href="tty.html#normal-mode">Normal Mode</a></li>
<li title="Shell Break Mode"><a href="tty.html#shell-break-mode">Shell Break Mode</a></li>
</ul>
</li>
<li id="no" title="How to Implement a Driver" expanded="false">How to Implement a Driver<ul>
<li><a href="driver.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="driver.html#introduction">Introduction</a></li>
<li title="Sample Driver"><a href="driver.html#sample-driver">Sample Driver</a></li>
<li title="Compiling and Linking the Sample Driver"><a href="driver.html#compiling-and-linking-the-sample-driver">Compiling and Linking the Sample Driver</a></li>
<li title="Calling a Driver as a Port in Erlang"><a href="driver.html#calling-a-driver-as-a-port-in-erlang">Calling a Driver as a Port in Erlang</a></li>
<li title="Sample Asynchronous Driver"><a href="driver.html#sample-asynchronous-driver">Sample Asynchronous Driver</a></li>
<li title="An Asynchronous Driver Using driver_async"><a href="driver.html#an-asynchronous-driver-using-driver_async">An Asynchronous Driver Using driver_async</a></li>
</ul>
</li>
<li id="no" title="Inet Configuration" expanded="false">Inet Configuration<ul>
<li><a href="inet_cfg.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="inet_cfg.html#introduction">Introduction</a></li>
<li title="Configuration Data"><a href="inet_cfg.html#configuration-data">Configuration Data</a></li>
<li title="User Configuration Example"><a href="inet_cfg.html#user-configuration-example">User Configuration Example</a></li>
</ul>
</li>
<li id="no" title="External Term Format" expanded="false">External Term Format<ul>
<li><a href="erl_ext_dist.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="erl_ext_dist.html#introduction">Introduction</a></li>
<li title="Encoding atoms"><a href="erl_ext_dist.html#encoding-atoms">Encoding atoms</a></li>
<li title="Distribution Header"><a href="erl_ext_dist.html#distribution-header">Distribution Header</a></li>
<li title="ATOM_CACHE_REF"><a href="erl_ext_dist.html#atom_cache_ref">ATOM_CACHE_REF</a></li>
<li title="SMALL_INTEGER_EXT"><a href="erl_ext_dist.html#small_integer_ext">SMALL_INTEGER_EXT</a></li>
<li title="INTEGER_EXT"><a href="erl_ext_dist.html#integer_ext">INTEGER_EXT</a></li>
<li title="FLOAT_EXT"><a href="erl_ext_dist.html#float_ext">FLOAT_EXT</a></li>
<li title="PORT_EXT"><a href="erl_ext_dist.html#port_ext">PORT_EXT</a></li>
<li title="NEW_PORT_EXT"><a href="erl_ext_dist.html#new_port_ext">NEW_PORT_EXT</a></li>
<li title="V4_PORT_EXT"><a href="erl_ext_dist.html#v4_port_ext">V4_PORT_EXT</a></li>
<li title="PID_EXT"><a href="erl_ext_dist.html#pid_ext">PID_EXT</a></li>
<li title="NEW_PID_EXT"><a href="erl_ext_dist.html#new_pid_ext">NEW_PID_EXT</a></li>
<li title="SMALL_TUPLE_EXT"><a href="erl_ext_dist.html#small_tuple_ext">SMALL_TUPLE_EXT</a></li>
<li title="LARGE_TUPLE_EXT"><a href="erl_ext_dist.html#large_tuple_ext">LARGE_TUPLE_EXT</a></li>
<li title="MAP_EXT"><a href="erl_ext_dist.html#map_ext">MAP_EXT</a></li>
<li title="NIL_EXT"><a href="erl_ext_dist.html#nil_ext">NIL_EXT</a></li>
<li title="STRING_EXT"><a href="erl_ext_dist.html#string_ext">STRING_EXT</a></li>
<li title="LIST_EXT"><a href="erl_ext_dist.html#list_ext">LIST_EXT</a></li>
<li title="BINARY_EXT"><a href="erl_ext_dist.html#binary_ext">BINARY_EXT</a></li>
<li title="SMALL_BIG_EXT"><a href="erl_ext_dist.html#small_big_ext">SMALL_BIG_EXT</a></li>
<li title="LARGE_BIG_EXT"><a href="erl_ext_dist.html#large_big_ext">LARGE_BIG_EXT</a></li>
<li title="REFERENCE_EXT (deprecated)"><a href="erl_ext_dist.html#reference_ext--deprecated-">REFERENCE_EXT (deprecated)</a></li>
<li title="NEW_REFERENCE_EXT"><a href="erl_ext_dist.html#new_reference_ext">NEW_REFERENCE_EXT</a></li>
<li title="NEWER_REFERENCE_EXT"><a href="erl_ext_dist.html#newer_reference_ext">NEWER_REFERENCE_EXT</a></li>
<li title="FUN_EXT"><a href="erl_ext_dist.html#fun_ext">FUN_EXT</a></li>
<li title="NEW_FUN_EXT"><a href="erl_ext_dist.html#new_fun_ext">NEW_FUN_EXT</a></li>
<li title="EXPORT_EXT"><a href="erl_ext_dist.html#export_ext">EXPORT_EXT</a></li>
<li title="BIT_BINARY_EXT"><a href="erl_ext_dist.html#bit_binary_ext">BIT_BINARY_EXT</a></li>
<li title="NEW_FLOAT_EXT"><a href="erl_ext_dist.html#new_float_ext">NEW_FLOAT_EXT</a></li>
<li title="ATOM_UTF8_EXT"><a href="erl_ext_dist.html#atom_utf8_ext">ATOM_UTF8_EXT</a></li>
<li title="SMALL_ATOM_UTF8_EXT"><a href="erl_ext_dist.html#small_atom_utf8_ext">SMALL_ATOM_UTF8_EXT</a></li>
<li title="ATOM_EXT (deprecated)"><a href="erl_ext_dist.html#atom_ext--deprecated-">ATOM_EXT (deprecated)</a></li>
<li title="SMALL_ATOM_EXT (deprecated)"><a href="erl_ext_dist.html#small_atom_ext--deprecated-">SMALL_ATOM_EXT (deprecated)</a></li>
</ul>
</li>
<li id="loadscrollpos" title="Distribution Protocol" expanded="true">Distribution Protocol<ul>
<li><a href="erl_dist_protocol.html">
              Top of chapter
            </a></li>
<li title="EPMD Protocol"><a href="erl_dist_protocol.html#epmd-protocol">EPMD Protocol</a></li>
<li title="Distribution Handshake"><a href="erl_dist_protocol.html#distribution-handshake">Distribution Handshake</a></li>
<li title="Protocol between Connected Nodes"><a href="erl_dist_protocol.html#protocol-between-connected-nodes">Protocol between Connected Nodes</a></li>
</ul>
</li>
</ul></nav></aside><div id="content">
<div class="innertube">
<h1 id="Distribution Protocol">13Â Distribution Protocol</h1>
  

  <p>This description is far from complete. It will be updated if the
    protocol is updated. However, the protocols, both from Erlang
    nodes to the Erlang Port Mapper Daemon (EPMD) and between Erlang nodes
    are stable since many years.</p>

  <p>The distribution protocol can be divided into four parts:</p>

  <ul>
    <li>
      <p>Low-level socket connection (1)</p>
    </li>
    <li>
      <p>Handshake, interchange node name, and authenticate (2)</p>
    </li>
    <li>
      <p>Authentication (done by <span class="bold_code bc-18"><a href="../../man/net_kernel.html">
        <span class="code">net_kernel(3)</span></a></span>) (3)</p>
    </li>
    <li>
      <p>Connected (4)</p> 
    </li>
  </ul>

  <p>A node fetches the port number of another node through the EPMD (at the
    other host) to initiate a connection request.</p>

  <p>For each host, where a distributed Erlang node is running, also an EPMD
    is to be running. The EPMD can be started explicitly or automatically
    as a result of the Erlang node startup.</p>

  <p>By default the EPMD listens on port 4369.</p>

  <p>(3) and (4) above are performed at the same level but the <span class="code">net_kernel</span>
    disconnects the other node if it communicates using an invalid cookie (after
    1 second).</p>

  <p>The integers in all multibyte fields are in big-endian order.</p>

  <div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
    <p>
      The Erlang Distribution protocol is not by itself secure and does not
      aim to be so. In order to get secure distribution the distributed nodes
      should be configured to use distribution over tls.
      See the <span class="bold_code bc-18"><a href="../../apps/ssl/ssl_distribution.html">
      Using SSL for Erlang Distribution</a></span> User's Guide
      for details on how to setup a secure distributed node.
    </p>
  </p></div>
</div>

  <h3 id="epmd-protocol" class="title-link" onMouseOver="document.getElementById('ghlink-epmd-protocol-idm5659').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-epmd-protocol-idm5659').style.visibility = 'hidden';">
<div class="title-name">13.1Â 
        EPMD Protocol</div>
<div class="title-anchors"><span id="ghlink-epmd-protocol-idm5659" class="ghlink-after"><a href="#epmd-protocol" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L84" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>The requests served by the EPMD are summarized in the following
      figure.</p>

    <div class="doc-image-wrapper">
<img alt="IMAGE MISSING" src="erl_ext_fig.gif" class="doc-image">
      <p class="doc-image-caption">Figure
        13.1:
        Â 
        Summary of EPMD Requests</p>
    </div>

    <p>Each request <span class="code">*_REQ</span> is preceded by a 2 byte length field.
      Thus, the overall request format is as follows:</p>

    <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
        <td align="left" valign="middle">2</td>
        <td align="left" valign="middle">n</td>
      </tr>
<tr>
        <td align="left" valign="middle"><span class="code">Length</span></td>
        <td align="left" valign="middle"><span class="code">Request</span></td>
      </tr>
</table>
<p class="doc-table-caption">Table
        13.1:
        Â 
        Request Format</p>
</div>

    <h4 id="register-a-node-in-epmd" class="title-link" onMouseOver="document.getElementById('ghlink-register-a-node-in-epmd-idm5676').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-register-a-node-in-epmd-idm5676').style.visibility = 'hidden';">
<div class="title-name">Register a Node in EPMD</div>
<div class="title-anchors"><span id="ghlink-register-a-node-in-epmd-idm5676" class="ghlink-after"><a href="#register-a-node-in-epmd" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L108" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>When a distributed node is started it registers itself in the EPMD.
        The message <span class="code">ALIVE2_REQ</span> described below is sent from the node to
        the EPMD. The response from the EPMD is <span class="code">ALIVE2_X_RESP</span> (or
        <span class="code">ALIVE2_RESP</span>).</p>

      <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
          <td align="left" valign="middle">1</td>
          <td align="left" valign="middle">2</td>
          <td align="left" valign="middle">1</td>
          <td align="left" valign="middle">1</td>
          <td align="left" valign="middle">2</td>
          <td align="left" valign="middle">2</td>
          <td align="left" valign="middle">2</td>
          <td align="left" valign="middle">Nlen</td>
          <td align="left" valign="middle">2</td>
          <td align="left" valign="middle">Elen</td>
        </tr>
<tr>
          <td align="left" valign="middle"><span class="code">120</span></td>
          <td align="left" valign="middle"><span class="code">PortNo</span></td>
          <td align="left" valign="middle"><span class="code">NodeType</span></td>
          <td align="left" valign="middle"><span class="code">Protocol</span></td>
          <td align="left" valign="middle"><span class="code">HighestVersion</span></td>
          <td align="left" valign="middle"><span class="code">LowestVersion</span></td>
          <td align="left" valign="middle"><span class="code">Nlen</span></td>
          <td align="left" valign="middle"><span class="code">NodeName</span></td>
          <td align="left" valign="middle"><span class="code">Elen</span></td>
          <td align="left" valign="middle"><span class="code">Extra</span></td>
        </tr>
</table>
<p class="doc-table-caption">Table
        13.2:
        Â 
        ALIVE2_REQ (120)</p>
</div>

      <dl>
        <dt><strong><span class="code">PortNo</span></strong></dt>
        <dd>
          <p>The port number on which the node accept connection requests.</p>
        </dd>
        <dt><strong><span class="code">NodeType</span></strong></dt>
        <dd>
          <p>77 = normal Erlang node, 72 = hidden node (C-node), ...</p>
        </dd>
        <dt><strong><span class="code">Protocol</span></strong></dt>
        <dd>
          <p>0 = TCP/IPv4, ...</p>
        </dd>
        <dt><strong><span class="code">HighestVersion</span></strong></dt>
        <dd>
          <p>The highest distribution protocol version this node can handle.
            The value in OTP 23 and later is 6. Older nodes only support version 5.</p>
        </dd>
        <dt><strong><span class="code">LowestVersion</span></strong></dt>
        <dd>
          <p>The lowest distribution version that this node can handle.
            Should be 5 to support connections to nodes older than OTP 23.</p>
        </dd>
        <dt><strong><span class="code">Nlen</span></strong></dt>
        <dd>
          <p>The length (in bytes) of field <span class="code">NodeName</span>.</p>
        </dd>
        <dt><strong><span class="code">NodeName</span></strong></dt>
        <dd>
          <p>The node name as an UTF-8 encoded string of <span class="code">Nlen</span> bytes.</p>
        </dd>
        <dt><strong><span class="code">Elen</span></strong></dt>
        <dd>
          <p>The length of field <span class="code">Extra</span>.</p>
        </dd>
        <dt><strong><span class="code">Extra</span></strong></dt>
        <dd>
          <p>Extra field of <span class="code">Elen</span> bytes.</p>
        </dd>
      </dl>

      <p>The connection created to the EPMD must be kept as long as the
        node is a distributed node. When the connection is closed,
        the node is automatically unregistered from the EPMD.</p>

      <p>The response message is either <span class="code">ALIVE2_X_RESP</span> or
        <span class="code">ALIVE2_RESP</span> depending on distribution version. If both the node
        and EPMD support distribution version 6 then the response is
        <span class="code">ALIVE2_X_RESP</span> otherwise it is the older <span class="code">ALIVE2_RESP</span>:</p>

      <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
          <td align="left" valign="middle">1</td>
          <td align="left" valign="middle">1</td>
          <td align="left" valign="middle">4</td>
        </tr>
<tr>
          <td align="left" valign="middle"><span class="code">118</span></td>
          <td align="left" valign="middle"><span class="code">Result</span></td>
          <td align="left" valign="middle"><span class="code">Creation</span></td>
        </tr>
</table>
<p class="doc-table-caption">Table
        13.3:
        Â 
        ALIVE2_X_RESP (118) with 32 bit creation</p>
</div>

      <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
          <td align="left" valign="middle">1</td>
          <td align="left" valign="middle">1</td>
          <td align="left" valign="middle">2</td>
        </tr>
<tr>
          <td align="left" valign="middle"><span class="code">121</span></td>
          <td align="left" valign="middle"><span class="code">Result</span></td>
          <td align="left" valign="middle"><span class="code">Creation</span></td>
        </tr>
</table>
<p class="doc-table-caption">Table
        13.4:
        Â 
        ALIVE2_RESP (121) with 16-bit creation</p>
</div>

      <p>Result = 0 -&gt; ok, result &gt; 0 -&gt; error.</p>
    

    <h4 id="unregister-a-node-from-epmd" class="title-link" onMouseOver="document.getElementById('ghlink-unregister-a-node-from-epmd-idm5790').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-unregister-a-node-from-epmd-idm5790').style.visibility = 'hidden';">
<div class="title-name">Unregister a Node from EPMD</div>
<div class="title-anchors"><span id="ghlink-unregister-a-node-from-epmd-idm5790" class="ghlink-after"><a href="#unregister-a-node-from-epmd" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L224" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>A node unregisters itself from the EPMD by closing the TCP
        connection to EPMD established when the node was registered.</p>
    

    <h4 id="get-the-distribution-port-of-another-node" class="title-link" onMouseOver="document.getElementById('ghlink-get-the-distribution-port-of-another-node-idm5793').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-get-the-distribution-port-of-another-node-idm5793').style.visibility = 'hidden';">
<div class="title-name">Get the Distribution Port of Another Node</div>
<div class="title-anchors"><span id="ghlink-get-the-distribution-port-of-another-node-idm5793" class="ghlink-after"><a href="#get-the-distribution-port-of-another-node" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L230" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>When one node wants to connect to another node it starts with
        a <span class="code">PORT_PLEASE2_REQ</span> request to the EPMD on the host where the
        node resides to get the distribution port that the node listens to.</p>

      <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
          <td align="left" valign="middle">1</td>
          <td align="left" valign="middle">N</td>
        </tr>
<tr>
          <td align="left" valign="middle"><span class="code">122</span></td>
          <td align="left" valign="middle"><span class="code">NodeName</span></td>
        </tr>
</table>
<p class="doc-table-caption">Table
        13.5:
        Â 
        PORT_PLEASE2_REQ (122)</p>
</div>

      <p>where N = <span class="code">Length</span> - 1.</p>

      <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
          <td align="left" valign="middle">1</td>
          <td align="left" valign="middle">1</td>
        </tr>
<tr>
          <td align="left" valign="middle"><span class="code">119</span></td>
          <td align="left" valign="middle"><span class="code">Result</span></td>
        </tr>
</table>
<p class="doc-table-caption">Table
        13.6:
        Â 
        PORT2_RESP (119) Response Indicating Error, Result &gt; 0
        </p>
</div>

      <p>or</p>

      <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
          <td align="left" valign="middle">1</td>
          <td align="left" valign="middle">1</td>
          <td align="left" valign="middle">2</td>
          <td align="left" valign="middle">1</td>
          <td align="left" valign="middle">1</td>
          <td align="left" valign="middle">2</td>
          <td align="left" valign="middle">2</td>
          <td align="left" valign="middle">2</td>
          <td align="left" valign="middle">Nlen</td>
          <td align="left" valign="middle">2</td>
          <td align="left" valign="middle">Elen</td>
        </tr>
<tr>
          <td align="left" valign="middle"><span class="code">119</span></td>
          <td align="left" valign="middle"><span class="code">Result</span></td>
          <td align="left" valign="middle"><span class="code">PortNo</span></td>
          <td align="left" valign="middle"><span class="code">NodeType</span></td>
          <td align="left" valign="middle"><span class="code">Protocol</span></td>
          <td align="left" valign="middle"><span class="code">HighestVersion</span></td>
          <td align="left" valign="middle"><span class="code">LowestVersion</span></td>
          <td align="left" valign="middle"><span class="code">Nlen</span></td>
          <td align="left" valign="middle"><span class="code">NodeName</span></td>
          <td align="left" valign="middle"><span class="code">Elen</span></td>
          <td align="left" valign="middle">&gt;<span class="code">Extra</span>
</td>
        </tr>
</table>
<p class="doc-table-caption">Table
        13.7:
        Â 
        PORT2_RESP, Result = 0</p>
</div>

      <p>If <span class="code">Result</span> &gt; 0, the packet only consists of
        <span class="code">[119, Result]</span>.</p>

      <p>The EPMD closes the socket when it has sent the information.</p>
    

    <h4 id="get-all-registered-names-from-epmd" class="title-link" onMouseOver="document.getElementById('ghlink-get-all-registered-names-from-epmd-idm5861').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-get-all-registered-names-from-epmd-idm5861').style.visibility = 'hidden';">
<div class="title-name">Get All Registered Names from EPMD</div>
<div class="title-anchors"><span id="ghlink-get-all-registered-names-from-epmd-idm5861" class="ghlink-after"><a href="#get-all-registered-names-from-epmd" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L301" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>This request is used through the Erlang function
        <span class="bold_code bc-13"><a href="../../man/net_adm.html#names-1">
        <span class="code">net_adm:names/1,2</span></a></span>. A TCP connection is opened
        to the  EPMD and this request is sent.</p>

      <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
          <td align="left" valign="middle">1</td>
        </tr>
<tr>
          <td align="left" valign="middle"><span class="code">110</span></td>
        </tr>
</table>
<p class="doc-table-caption">Table
        13.8:
        Â 
        NAMES_REQ (110)</p>
</div>	

      <p>The response for a <span class="code">NAMES_REQ</span> is as follows:</p>

      <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
          <td align="left" valign="middle">4</td>
          <td align="left" valign="middle">Â </td>
        </tr>
<tr>
          <td align="left" valign="middle"><span class="code">EPMDPortNo</span></td>
          <td align="left" valign="middle"><span class="code">NodeInfo*</span></td>
        </tr>
</table>
<p class="doc-table-caption">Table
        13.9:
        Â 
        NAMES_RESP</p>
</div>

      <p><span class="code">NodeInfo</span> is a string written for each active node.
        When all <span class="code">NodeInfo</span> has been written the connection is
        closed by the EPMD.</p>

      <p><span class="code">NodeInfo</span> is, as expressed in Erlang:</p>

      <div class="example example-none"><pre>io:format("name ~ts at port ~p~n", [NodeName, Port]).</pre></div>
    

    <h4 id="dump-all-data-from-epmd" class="title-link" onMouseOver="document.getElementById('ghlink-dump-all-data-from-epmd-idm5891').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-dump-all-data-from-epmd-idm5891').style.visibility = 'hidden';">
<div class="title-name">Dump All Data from EPMD</div>
<div class="title-anchors"><span id="ghlink-dump-all-data-from-epmd-idm5891" class="ghlink-after"><a href="#dump-all-data-from-epmd" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L342" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>This request is not really used, it is to be regarded as a debug
        feature.</p>

      <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
          <td align="left" valign="middle">1</td>
        </tr>
<tr>
          <td align="left" valign="middle"><span class="code">100</span></td>
        </tr>
</table>
<p class="doc-table-caption">Table
        13.10:
        Â 
        DUMP_REQ</p>
</div>

      <p>The response for a <span class="code">DUMP_REQ</span> is as follows:</p>

      <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
          <td align="left" valign="middle">4</td>
          <td align="left" valign="middle">Â </td>
        </tr>
<tr>
          <td align="left" valign="middle"><span class="code">EPMDPortNo</span></td>
          <td align="left" valign="middle"><span class="code">NodeInfo*</span></td>
        </tr>
</table>
<p class="doc-table-caption">Table
        13.11:
        Â 
        DUMP_RESP</p>
</div>

      <p><span class="code">NodeInfo</span> is a string written for each node kept in the EPMD.
        When all <span class="code">NodeInfo</span> has been written the connection is
        closed by the EPMD.</p>

      <p><span class="code">NodeInfo</span> is, as expressed in Erlang:</p>

      <div class="example example-none"><pre>io:format("active name     ~ts at port ~p, fd = ~p~n",
          [NodeName, Port, Fd]).</pre></div>

      <p>or</p>

      <div class="example example-none"><pre>io:format("old/unused name ~ts at port ~p, fd = ~p ~n",
          [NodeName, Port, Fd]).</pre></div>
    

    <h4 id="kill-epmd" class="title-link" onMouseOver="document.getElementById('ghlink-kill-epmd-idm5921').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-kill-epmd-idm5921').style.visibility = 'hidden';">
<div class="title-name">Kill EPMD</div>
<div class="title-anchors"><span id="ghlink-kill-epmd-idm5921" class="ghlink-after"><a href="#kill-epmd" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L388" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>This request kills the running EPMD. It is almost never used.</p>

      <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
          <td align="left" valign="middle">1</td>
        </tr>
<tr>
          <td align="left" valign="middle"><span class="code">107</span></td>
        </tr>
</table>
<p class="doc-table-caption">Table
        13.12:
        Â 
        KILL_REQ</p>
</div>

      <p>The response for a <span class="code">KILL_REQ</span> is as follows:</p>

      <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
          <td align="left" valign="middle">2</td>
        </tr>
<tr>
          <td align="left" valign="middle"><span class="code">OKString</span></td>
        </tr>
</table>
<p class="doc-table-caption">Table
        13.13:
        Â 
        KILL_RESP</p>
</div>

      <p>where <span class="code">OKString</span> is "OK".</p>
    

    <h4 id="stop_req---not-used-" class="title-link" onMouseOver="document.getElementById('ghlink-stop_req---not-used--idm5942').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-stop_req---not-used--idm5942').style.visibility = 'hidden';">
<div class="title-name">STOP_REQ  (Not Used)</div>
<div class="title-anchors"><span id="ghlink-stop_req---not-used--idm5942" class="ghlink-after"><a href="#stop_req---not-used-" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L417" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
          <td align="left" valign="middle">1</td>
          <td align="left" valign="middle">n</td>
        </tr>
<tr>
          <td align="left" valign="middle"><span class="code">115</span></td>
          <td align="left" valign="middle"><span class="code">NodeName</span></td>
        </tr>
</table>
<p class="doc-table-caption">Table
        13.14:
        Â 
        STOP_REQ</p>
</div>

      <p>where n = <span class="code">Length</span> - 1.</p>

      <p>The response for a <span class="code">STOP_REQ</span> is as follows:</p>

      <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
          <td align="left" valign="middle">7</td>
        </tr>
<tr>
          <td align="left" valign="middle"><span class="code">OKString</span></td>
        </tr>
</table>
<p class="doc-table-caption">Table
        13.15:
        Â 
        STOP_RESP</p>
</div>

      <p>where <span class="code">OKString</span> is "STOPPED".</p>

      <p>A negative response can look as follows:</p>

      <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
          <td align="left" valign="middle">7</td>
        </tr>
<tr>
          <td align="left" valign="middle"><span class="code">NOKString</span></td>
        </tr>
</table>
<p class="doc-table-caption">Table
        13.16:
        Â 
        STOP_NOTOK_RESP</p>
</div>

      <p>where <span class="code">NOKString</span> is "NOEXIST".</p>
    

  

  <a name="distribution_handshake"></a><h3 id="distribution-handshake" class="title-link" onMouseOver="document.getElementById('ghlink-distribution-handshake-idm5977').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-distribution-handshake-idm5977').style.visibility = 'hidden';">
<div class="title-name">13.2Â 
        Distribution Handshake</div>
<div class="title-anchors"><span id="ghlink-distribution-handshake-idm5977" class="ghlink-after"><a href="#distribution-handshake" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L546" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    
    <p>
      This section describes the distribution handshake protocol used between
      nodes to establishing a connection. The protocol was introduced in
      Erlang/OTP R6 and has remained unchanged until OTP 23. The changes made in
      OTP 23 were designed to be compatible with the older protocol
      version. That is an old node can still connect toward a new node and vice
      versa.
    </p>

    <h4 id="general" class="title-link" onMouseOver="document.getElementById('ghlink-general-idm5981').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-general-idm5981').style.visibility = 'hidden';">
<div class="title-name">General</div>
<div class="title-anchors"><span id="ghlink-general-idm5981" class="ghlink-after"><a href="#general" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L558" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>The TCP/IP distribution uses a handshake that expects a
        connection-based protocol, that is, the protocol does not include any
        authentication after the handshake procedure.</p>

      <p>This is not entirely safe, as it is vulnerable against takeover
        attacks, but it is a tradeoff between fair safety and performance.</p>

      <p>The cookies are never sent in cleartext and the handshake procedure
        expects the client (called <span class="code">A</span>) to be the first one to prove that
        it can generate a sufficient digest. The digest is generated with the
        MD5 message digest algorithm and the challenges are expected to be
        random numbers.</p>
    

    <h4 id="definitions" class="title-link" onMouseOver="document.getElementById('ghlink-definitions-idm5987').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-definitions-idm5987').style.visibility = 'hidden';">
<div class="title-name">Definitions</div>
<div class="title-anchors"><span id="ghlink-definitions-idm5987" class="ghlink-after"><a href="#definitions" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L574" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>A challenge is a 32-bit integer in big-endian order. Below the function
        <span class="code">gen_challenge()</span> returns a random 32-bit integer used as a
        challenge.</p>

      <p>A digest is a (16 bytes) MD5 hash of the challenge (as text)
        concatenated with the cookie (as text). Below, the function
        <span class="code">gen_digest(Challenge, Cookie)</span> generates a digest as described
        above.</p>

      <p>An <span class="code">out_cookie</span> is the cookie used in outgoing communication to a
        certain node, so that <span class="code">A</span>'s <span class="code">out_cookie</span> for <span class="code">B</span> is to
        correspond with <span class="code">B</span>'s <span class="code">in_cookie</span> for <span class="code">A</span> and conversely.
        <span class="code">A</span>'s <span class="code">out_cookie</span> for <span class="code">B</span> and <span class="code">A</span>'s
        <span class="code">in_cookie</span> for <span class="code">B</span> need <strong>not</strong> be the same. Below the
        function <span class="code">out_cookie(Node)</span> returns the current node's
        <span class="code">out_cookie</span> for <span class="code">Node</span>.</p>

      <p>An <span class="code">in_cookie</span> is the cookie expected to be used by another node
        when communicating with us, so that <span class="code">A</span>'s <span class="code">in_cookie</span> for
        <span class="code">B</span> corresponds with <span class="code">B</span>'s <span class="code">out_cookie</span> for <span class="code">A</span>.
        Below the function <span class="code">in_cookie(Node)</span> returns the current node's
        <span class="code">in_cookie</span> for <span class="code">Node</span>.</p>

      <p>The cookies are text strings that can be viewed as passwords.</p>

      <p>Every message in the handshake starts with a 16-bit big-endian integer,
        which contains the message length (not counting the two initial bytes).
        In Erlang this corresponds to option <span class="code">{packet, 2}</span> in
        <span class="bold_code bc-18"><a href="../../man/gen_tcp.html"><span class="code">gen_tcp(3)</span></a></span>.
        Notice that after the handshake, the distribution switches to 4 byte
        packet headers.</p>
    

    <h4 id="the-handshake-in-detail" class="title-link" onMouseOver="document.getElementById('ghlink-the-handshake-in-detail-idm6027').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-the-handshake-in-detail-idm6027').style.visibility = 'hidden';">
<div class="title-name">The Handshake in Detail</div>
<div class="title-anchors"><span id="ghlink-the-handshake-in-detail-idm6027" class="ghlink-after"><a href="#the-handshake-in-detail" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L609" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>Imagine two nodes, <span class="code">A</span> that initiates the handshake and <span class="code">B</span>
        that accepts the connection.</p>

      <dl>
      <dt><strong>1) connect/accept</strong></dt>
        <dd>
          <p><span class="code">A</span> connects to <span class="code">B</span> through TCP/IP and <span class="code">B</span> accepts
            the connection.</p>
        </dd>
        <dt><strong>2) <span class="code">send_name</span>/<span class="code">receive_name</span></strong></dt>
        <dd>
          <p><span class="code">A</span> sends an initial identification to <span class="code">B</span>, which
            receives the message. The message can have two different formats
	    which looks as follows (the packet headers are removed):
	  </p>
	  <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
              <td align="left" valign="middle">1</td>
              <td align="left" valign="middle">2</td>
              <td align="left" valign="middle">4</td>
	      <td align="left" valign="middle">Nlen</td>
            </tr>
<tr>
              <td align="left" valign="middle"><span class="code">'n'</span></td>
              <td align="left" valign="middle"><span class="code">Version=5</span></td>
              <td align="left" valign="middle"><span class="code">Flags</span></td>
	      <td align="left" valign="middle"><span class="code">Name</span></td>
            </tr>
</table>
<p class="doc-table-caption">Table
        13.17:
        Â 
        Old send_name ('n') for protocol version 5</p>
</div>

	  <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
              <td align="left" valign="middle">1</td>
              <td align="left" valign="middle">8</td>
              <td align="left" valign="middle">4</td>
	      <td align="left" valign="middle">2</td>
	      <td align="left" valign="middle">Nlen</td>
            </tr>
<tr>
              <td align="left" valign="middle"><span class="code">'N'</span></td>
              <td align="left" valign="middle"><span class="code">Flags</span></td>
	      <td align="left" valign="middle"><span class="code">Creation</span></td>
	      <td align="left" valign="middle"><span class="code">Nlen</span></td>
	      <td align="left" valign="middle"><span class="code">Name</span></td>
            </tr>
</table>
<p class="doc-table-caption">Table
        13.18:
        Â 
        New send_name ('N') for protocol version 6</p>
</div>

	  <p>
	    The old <span class="code">send_name</span> format is sent from nodes only supporting version 5
            or to nodes that might only support version 5. The <span class="code">Version</span> is
	    a 16-bit big endian integer and <strong>must</strong> always have the value 5, even
	    if node <span class="code">A</span> supports version 6. <span class="code">Flags</span> are the
	    <span class="bold_code bc-17"><a href="#dflags">capability flags</a></span>
	    of node <span class="code">A</span> in 32-bit big endian. The flag bit
	    <span class="bold_code bc-17"><a href="#DFLAG_HANDSHAKE_23"><span class="code">DFLAG_HANDSHAKE_23</span></a></span>
	    should be set if node <span class="code">A</span> supports version 6.
	    <span class="code">Name</span> is the full node name of <span class="code">A</span>, as a string of bytes
	    (the packet length denotes how long it is).
	  </p>
	  <p>
	    The new <span class="code">send_name</span> is only sent from nodes supporting version 6 to
	    nodes known to support version 6. <span class="code">Flags</span> are the
	    <span class="bold_code bc-17"><a href="#dflags">capability flags</a></span> of node
	    <span class="code">A</span> in 64-bit big endian. The flag bit
	    <span class="bold_code bc-17"><a href="#DFLAG_HANDSHAKE_23"><span class="code">DFLAG_HANDSHAKE_23</span></a></span>
            must always be set. <span class="code">Creation</span> is the node incarnation
	    identifier used by node <span class="code">A</span> to create its pids, ports and
	    references. <span class="code">Name</span> is the full node name of <span class="code">A</span>, as a
	    string of bytes. <span class="code">Nlen</span> is the byte length of the node name in
	    16-bit big endian. Any extra data after the node <span class="code">Name</span> must be
	    accepted and ignored.
	  </p>
        </dd>
        <dt><strong>3) <span class="code">recv_status</span>/<span class="code">send_status</span></strong></dt>
        <dd>
          <p>
	    <span class="code">B</span> sends a status message to <span class="code">A</span>, which indicates if the
            connection is allowed.
	  </p>
	  <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
              <td align="left" valign="middle">1</td>
	      <td align="left" valign="middle">Slen</td>
            </tr>
<tr>
              <td align="left" valign="middle"><span class="code">'s'</span></td>
	      <td align="left" valign="middle"><span class="code">Status</span></td>
            </tr>
</table>
<p class="doc-table-caption">Table
        13.19:
        Â 
        The format of the status message</p>
</div>
          <p>
	    's' is the message tag. <span class="code">Status</span> is the status code as a
            string (not null terminated). The following status codes are
	    defined:
	  </p>
          <dl>
            <dt><strong><span class="code">ok</span></strong></dt>
            <dd>
              <p>The handshake will continue.</p>
            </dd>
            <dt><strong><span class="code">ok_simultaneous</span></strong></dt>
            <dd>
              <p>The handshake will continue, but <span class="code">A</span> is informed that
                <span class="code">B</span> has another ongoing connection attempt that will be
                shut down (simultaneous connect where <span class="code">A</span>'s name is
                greater than <span class="code">B</span>'s name, compared literally).</p>
            </dd>
            <dt><strong><span class="code">nok</span></strong></dt>
            <dd>
              <p>The handshake will not continue, as <span class="code">B</span> already has an
                ongoing handshake, which it itself has initiated (simultaneous
                connect where <span class="code">B</span>'s name is greater than <span class="code">A</span>'s).</p>
            </dd>
            <dt><strong><span class="code">not_allowed</span></strong></dt>
            <dd>
              <p>The connection is disallowed for some (unspecified) security
                reason.</p>
            </dd>
            <dt><strong><span class="code">alive</span></strong></dt>
            <dd>
              <p>A connection to the node is already active, which either means
                that node <span class="code">A</span> is confused or that the TCP connection
                breakdown of a previous node with this name has not yet reached
                node <span class="code">B</span>. See step 3B below.</p>
            </dd>
	    <dt><strong><span class="code">named:</span></strong></dt>
            <dd>
<p>
	      The handshake willl continue, but <span class="code">A</span> requested a dynamic
	      node name by setting flag <span class="bold_code bc-17"><a href="#DFLAG_NAME_ME">
	      <span class="code">DFLAG_NAME_ME</span></a></span>. The dynamic node name of
	      <span class="code">A</span> is supplied at the end of the status message from
	      <span class="code">B</span>.</p>
            </dd>
          </dl>
	  <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
              <td align="left" valign="middle">1</td>
	      <td align="left" valign="middle">Slen=6</td>
	      <td align="left" valign="middle">2</td>
	      <td align="left" valign="middle">Nlen</td>
            </tr>
<tr>
              <td align="left" valign="middle"><span class="code">'s'</span></td>
	      <td align="left" valign="middle"><span class="code">Status='named:'</span></td>
	      <td align="left" valign="middle"><span class="code">Nlen</span></td>
	      <td align="left" valign="middle"><span class="code">Name</span></td>
            </tr>
</table>
<p class="doc-table-caption">Table
        13.20:
        Â 
        The format of the 'named:' status message</p>
</div>
	  <p>
	    <span class="code">Name</span> is the full dynamic node name of <span class="code">A</span>, as a
	    string of bytes. <span class="code">Nlen</span> is the byte length of the node name in
	    16-bit big endian. Any extra data after the node <span class="code">Name</span> must be
	    accepted and ignored.
	  </p>
          </dd>
        <dt><strong>3B) <span class="code">send_status</span>/<span class="code">recv_status</span></strong></dt>
        <dd>
          <p>If status was <span class="code">alive</span>, node <span class="code">A</span> answers with another
            status message containing either <span class="code">true</span>, which means that the
            connection is to continue (the old connection from this node is
            broken), or <span class="code">false</span>, which means that the connection is to be
            closed (the connection attempt was a mistake.</p>
        </dd>
        <dt><strong>4) <span class="code">recv_challenge</span>/<span class="code">send_challenge</span></strong></dt>
        <dd>
          <p>If the status was <span class="code">ok</span> or <span class="code">ok_simultaneous</span>, the
            handshake continues with <span class="code">B</span> sending <span class="code">A</span> another message,
            the challenge. The challenge contains the same type of information
            as the "name" message initially sent from <span class="code">A</span> to <span class="code">B</span>, plus
            a 32-bit challenge. The challenge message can have two different
	    formats:
	  </p>
	  <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
              <td align="left" valign="middle">1</td>
	      <td align="left" valign="middle">2</td>
	      <td align="left" valign="middle">4</td>
	      <td align="left" valign="middle">4</td>
	      <td align="left" valign="middle">Nlen</td>
            </tr>
<tr>
              <td align="left" valign="middle"><span class="code">'n'</span></td>
	      <td align="left" valign="middle"><span class="code">Version=5</span></td>
	      <td align="left" valign="middle"><span class="code">Flags</span></td>
	      <td align="left" valign="middle"><span class="code">Challenge</span></td>
	      <td align="left" valign="middle"><span class="code">Name</span></td>
            </tr>
</table>
<p class="doc-table-caption">Table
        13.21:
        Â 
        The old challenge message format (version 5)</p>
</div>
	  <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
              <td align="left" valign="middle">1</td>
	      <td align="left" valign="middle">8</td>
	      <td align="left" valign="middle">4</td>
	      <td align="left" valign="middle">4</td>
	      <td align="left" valign="middle">2</td>
	      <td align="left" valign="middle">Nlen</td>
            </tr>
<tr>
              <td align="left" valign="middle"><span class="code">'N'</span></td>
	      <td align="left" valign="middle"><span class="code">Flags</span></td>
	      <td align="left" valign="middle"><span class="code">Challenge</span></td>
	      <td align="left" valign="middle"><span class="code">Creation</span></td>
	      <td align="left" valign="middle"><span class="code">Nlen</span></td>
	      <td align="left" valign="middle"><span class="code">Name</span></td>
            </tr>
</table>
<p class="doc-table-caption">Table
        13.22:
        Â 
        The new challenge message format (version 6)</p>
</div>
	  <p>
	    The old challenge message is sent from old <span class="code">B</span> nodes
	    (supporting only version 5) or if node <span class="code">A</span> had not capability flag
	    <span class="bold_code bc-17"><a href="#DFLAG_HANDSHAKE_23"><span class="code">DFLAG_HANDSHAKE_23</span></a></span>
	    set. The <span class="code">Version</span> is a 16-bit big endian integer and
	    <span class="code">must</span> always have the value 5.
	  </p>
	  <p>
	    The new challenge message is sent from new <span class="code">B</span> nodes if node
	    <span class="code">A</span> had capability flag <span class="bold_code bc-17"><a href="#DFLAG_HANDSHAKE_23">
	    <span class="code">DFLAG_HANDSHAKE_23</span></a></span> set. Any extra data after the
	    node <span class="code">Name</span> must be accepted and ignored.
	  </p>
          <p>
	    <span class="code">Challenge</span> is a 32-bit big-endian integer. The other fields
	    are node <span class="code">B</span>'s flags, creation and full node name, similar to
	    the <span class="code">send_name</span> message.
	  </p>
        </dd>

        <dt><strong>4B) <span class="code">send_complement</span>/<span class="code">recv_complement</span></strong></dt>
        <dd>
          <p>
	    The complement message, from <span class="code">A</span> to <span class="code">B</span>, is only sent if
	    node <span class="code">A</span> initially sent an old name message and received back a
	    new challenge message from node <span class="code">B</span>. It contains complementary
	    information missing in the initial old name message from node <span class="code">A</span>.
	  </p>
	  <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
              <td align="left" valign="middle">1</td>
	      <td align="left" valign="middle">4</td>
	      <td align="left" valign="middle">4</td>
            </tr>
<tr>
              <td align="left" valign="middle"><span class="code">'c'</span></td>
	      <td align="left" valign="middle"><span class="code">FlagsHigh</span></td>
	      <td align="left" valign="middle"><span class="code">Creation</span></td>
            </tr>
</table>
<p class="doc-table-caption">Table
        13.23:
        Â 
        The complement message</p>
</div>
	  <p>
	    <span class="code">FlagsHigh</span> are the high capability flags (bit 33-64) of node
	    <span class="code">A</span> as a 32-bit big endian integer. <span class="code">Creation</span> is the
	    incarnation identifier of node <span class="code">A</span>.
	  </p>
        </dd>

        <dt><strong>5) <span class="code">send_challenge_reply</span>/<span class="code">recv_challenge_reply</span></strong></dt>
        <dd>
          <p>Now <span class="code">A</span> has generated a digest and its own challenge. Those
            are sent together in a package to <span class="code">B</span>:</p>
	  <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
              <td align="left" valign="middle">1</td>
	      <td align="left" valign="middle">4</td>
	      <td align="left" valign="middle">16</td>
            </tr>
<tr>
              <td align="left" valign="middle"><span class="code">'r'</span></td>
	      <td align="left" valign="middle"><span class="code">Challenge</span></td>
	      <td align="left" valign="middle"><span class="code">Digest</span></td>
            </tr>
</table>
<p class="doc-table-caption">Table
        13.24:
        Â 
        The challenge_reply message</p>
</div>
          <p>
	    <span class="code">Challenge</span> is <span class="code">A</span>'s challenge for <span class="code">B</span> to
	    handle. <span class="code">Digest</span> is the MD5 digest that <span class="code">A</span> constructed
	    from the challenge <span class="code">B</span> sent in the previous step.
	  </p>
        </dd>
        <dt><strong>6) <span class="code">recv_challenge_ack</span>/<span class="code">send_challenge_ack</span></strong></dt>
        <dd>
          <p><span class="code">B</span> checks that the digest received from <span class="code">A</span> is correct
            and generates a digest from the challenge received from <span class="code">A</span>.
            The digest is then sent to <span class="code">A</span>. The message is as follows:</p>
	  <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
              <td align="left" valign="middle">1</td>
	      <td align="left" valign="middle">16</td>
            </tr>
<tr>
              <td align="left" valign="middle"><span class="code">'a'</span></td>
	      <td align="left" valign="middle"><span class="code">Digest</span></td>
            </tr>
</table>
<p class="doc-table-caption">Table
        13.25:
        Â 
        The challenge_ack message</p>
</div>
          <p>
	    <span class="code">Digest</span> is the digest calculated by <span class="code">B</span> for <span class="code">A</span>'s
	    challenge.
	  </p>
        </dd>
        <dt><strong>7) check</strong></dt>
        <dd>
          <p><span class="code">A</span> checks the digest from <span class="code">B</span> and the connection is
            up.</p>
        </dd>
      </dl>
    

    <h4 id="semigraphic-view" class="title-link" onMouseOver="document.getElementById('ghlink-semigraphic-view-idm6347').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-semigraphic-view-idm6347').style.visibility = 'hidden';">
<div class="title-name">Semigraphic View</div>
<div class="title-anchors"><span id="ghlink-semigraphic-view-idm6347" class="ghlink-after"><a href="#semigraphic-view" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L922" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <div class="example"><pre>
A (initiator)                                      B (acceptor)

TCP connect ------------------------------------&gt;
                                                   TCP accept

send_name --------------------------------------&gt;
                                                   recv_name

  &lt;---------------------------------------------- send_status
recv_status
(if status was 'alive'
 send_status - - - - - - - - - - - - - - - - - -&gt;
                                                   recv_status)

                          (ChB)                      ChB = gen_challenge()
  &lt;---------------------------------------------- send_challenge
recv_challenge

(if old send_name and new recv_challenge
 send_complement - - - - - - - - - - - - - - - -&gt;
                                                   recv_complement)

ChA = gen_challenge(),
OCA = out_cookie(B),
DiA = gen_digest(ChB, OCA)
                          (ChA, DiA)
send_challenge_reply ---------------------------&gt;
                                                   recv_challenge_reply
                                                   ICB = in_cookie(A),
                                                   check:
                                                   DiA == gen_digest (ChB, ICB)?
                                                   - if OK:
                                                    OCB = out_cookie(A),
                                                    DiB = gen_digest (ChA, OCB)
                          (DiB)
  &lt;----------------------------------------------- send_challenge_ack
recv_challenge_ack                                  DONE
ICA = in_cookie(B),                                - else:
check:                                              CLOSE
DiB == gen_digest(ChA, ICA)?
- if OK:
 DONE
- else:
 CLOSE</pre></div>
    

    <a name="dflags"></a><h4 id="distribution-flags" class="title-link" onMouseOver="document.getElementById('ghlink-distribution-flags-idm6350').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-distribution-flags-idm6350').style.visibility = 'hidden';">
<div class="title-name">Distribution Flags</div>
<div class="title-anchors"><span id="ghlink-distribution-flags-idm6350" class="ghlink-after"><a href="#distribution-flags" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L971" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      
      <p>Early in the distribution handshake the two participating nodes
      exchange capability flags. This is done in order to determine how the
      communication between the two nodes should be performed. The intersection
      of the capabilities presented by the two nodes defines the capabilities
      that will be used. The following capability flags are defined:</p>
      <dl>
        <dt><strong><span class="code">-define(DFLAG_PUBLISHED,16#1).</span></strong></dt>
        <dd>
          <p>The node is to be published and part of the global namespace.</p>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_ATOM_CACHE,16#2).</span></strong></dt>
        <dd>
          <p>The node implements an atom cache (obsolete).</p>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_EXTENDED_REFERENCES,16#4).</span></strong></dt>
        <dd>
          <p>The node implements extended (3 Ã 32 bits) references. This
            flag is mandatory. If not present, the  connection is refused.</p>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_DIST_MONITOR,16#8).</span></strong></dt>
        <dd>
          <p>The node implements distributed process monitoring.</p>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_FUN_TAGS,16#10).</span></strong></dt>
        <dd>
          <p>The node uses separate tag for funs (lambdas) in the distribution
          protocol.</p>
          <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>This flag will become mandatory in OTP 25.</p></p></div>
</div>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_DIST_MONITOR_NAME,16#20).</span></strong></dt>
        <dd>
          <p>The node implements distributed named process monitoring.</p>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_HIDDEN_ATOM_CACHE,16#40).</span></strong></dt>
        <dd>
          <p>The (hidden) node implements atom cache (obsolete).</p>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_NEW_FUN_TAGS,16#80).</span></strong></dt>
        <dd>
	  <p>The node understands the <span class="bold_code bc-15"><a href="erl_ext_dist.html#NEW_FUN_EXT">
	  <span class="code">NEW_FUN_EXT</span></a></span> tag. This flag is
	  mandatory. If not present, the connection is refused.</p>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_EXTENDED_PIDS_PORTS,16#100).</span></strong></dt>
        <dd>
          <p>The node can handle extended pids and ports. This
          flag is mandatory.  If not present, the connection is
          refused.</p>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_EXPORT_PTR_TAG,16#200).</span></strong></dt>
        <dd>
	  <p>The node understands the <span class="bold_code bc-15"><a href="erl_ext_dist.html#EXPORT_EXT">
	  <span class="code">EXPORT_EXT</span></a></span> tag.</p>
          <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>This flag will become mandatory in OTP 25.</p></p></div>
</div>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_BIT_BINARIES,16#400).</span></strong></dt>
        <dd>
	  <p>The node understands the <span class="bold_code bc-15"><a href="erl_ext_dist.html#BIT_BINARY_EXT">
	  <span class="code">BIT_BINARY_EXT</span></a></span> tag.</p>
          <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>This flag will become mandatory in OTP 25.</p></p></div>
</div>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_NEW_FLOATS,16#800).</span></strong></dt>
        <dd>
	  <p>The node understands the <span class="bold_code bc-15"><a href="erl_ext_dist.html#NEW_FLOAT_EXT">
	  <span class="code">NEW_FLOAT_EXT</span></a></span> tag.</p>
          <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>This flag will become mandatory in OTP 25.</p></p></div>
</div>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_UNICODE_IO,16#1000).</span></strong></dt>
        <dd>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_DIST_HDR_ATOM_CACHE,16#2000).</span></strong></dt>
        <dd>
          <p>The node implements atom cache in distribution header.</p>
        </dd>
        <dt><strong><a name="DFLAG_SMALL_ATOM_TAGS"></a><span class="code">-define(DFLAG_SMALL_ATOM_TAGS, 16#4000).</span></strong></dt>
        <dd>
          <p>The node understands the <span class="bold_code bc-15"><a href="erl_ext_dist.html#SMALL_ATOM_EXT">
	  <span class="code">SMALL_ATOM_EXT</span></a></span> tag.</p>
        </dd>
        <dt><strong><a name="DFLAG_UTF8_ATOMS"></a><span class="code">-define(DFLAG_UTF8_ATOMS, 16#10000).</span></strong></dt>
        <dd>
          <p>The node understands UTF-8 atoms encoded with
	    <span class="bold_code bc-15"><a href="erl_ext_dist.html#ATOM_UTF8_EXT">
	    <span class="code">ATOM_UTF8_EXT</span></a></span> and
	    <span class="bold_code bc-15"><a href="erl_ext_dist.html#SMALL_ATOM_UTF8_EXT">
	      <span class="code">SMALL ATOM_UTF8_EXT</span></a></span>.  This flag is
	      mandatory. If not present, the connection is refused.</p>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_MAP_TAG, 16#20000).</span></strong></dt>
        <dd>
          <p>The node understands the map tag
	  <span class="bold_code bc-15"><a href="erl_ext_dist.html#MAP_EXT"><span class="code">MAP_EXT</span></a></span>.</p>
          <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>This flag will become mandatory in OTP 25.</p></p></div>
</div>
        </dd>
        <dt><strong><a name="DFLAG_BIG_CREATION"></a><span class="code">-define(DFLAG_BIG_CREATION, 16#40000).</span></strong></dt>
        <dd>
          <p>The node understands big node creation tags
	  <span class="bold_code bc-15"><a href="erl_ext_dist.html#NEW_PID_EXT"><span class="code">NEW_PID_EXT</span></a></span>,
	  <span class="bold_code bc-15"><a href="erl_ext_dist.html#NEW_PORT_EXT"><span class="code">NEW_PORT_EXT</span></a></span> and
	  <span class="bold_code bc-15"><a href="erl_ext_dist.html#NEWER_REFERENCE_EXT"><span class="code">NEWER_REFERENCE_EXT</span></a></span>.
          This flag is mandatory. If not present, the connection is refused.</p>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_SEND_SENDER, 16#80000).</span></strong></dt>
        <dd>
          <p>
	    Use the <span class="code">SEND_SENDER</span>
	    <span class="bold_code bc-17"><a href="#control_message">control message</a></span>
	    instead of the <span class="code">SEND</span> control message and use the
	    <span class="code">SEND_SENDER_TT</span> control message instead
	    of the <span class="code">SEND_TT</span> control message.
	  </p>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_BIG_SEQTRACE_LABELS, 16#100000).</span></strong></dt>
        <dd>
          <p>The node understands any term as the seqtrace label.</p>
        </dd>
        <dt><strong><span class="code">-define(DFLAG_EXIT_PAYLOAD, 16#400000).</span></strong></dt>
        <dd>
          <p>Use the <span class="code">PAYLOAD_EXIT</span>, <span class="code">PAYLOAD_EXIT_TT</span>,
            <span class="code">PAYLOAD_EXIT2</span>, <span class="code">PAYLOAD_EXIT2_TT</span>
            and <span class="code">PAYLOAD_MONITOR_P_EXIT</span>
            <span class="bold_code bc-17"><a href="#control_message">control message</a></span>s
            instead of the non-PAYLOAD variants.</p>
        </dd>
        <dt><strong><a name="DFLAG_FRAGMENTS"></a><span class="code">-define(DFLAG_FRAGMENTS, 16#800000).</span></strong></dt>
        <dd>
          <p>Use <span class="bold_code bc-15"><a href="erl_ext_dist.html#fragments">fragmented</a></span>
            distribution messages to send large messages.</p>
        </dd>
        <dt><strong><a name="DFLAG_HANDSHAKE_23"></a><span class="code">-define(DFLAG_HANDSHAKE_23, 16#1000000).</span></strong></dt>
        <dd>
          <p>The node supports the new connection setup handshake (version 6)
	  introduced in OTP 23.</p>
        </dd>
        <dt><strong><a name="DFLAG_UNLINK_ID"></a><span class="code">-define(DFLAG_UNLINK_ID, 16#2000000).</span></strong></dt>
        <dd>
	  <p>Use the <span class="bold_code bc-17"><a href="#new_link_protocol">new link protocol</a></span>.</p>
	  <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>This flag will become mandatory in OTP 26.</p></p></div>
</div>
	  <p>Unless both nodes have set the <span class="code">DFLAG_UNLINK_ID</span> flag, the
	  <span class="bold_code bc-17"><a href="#old_link_protocol">old link protocol</a></span>
	  will be used as a fallback.</p>
	</dd>
        <dt><strong><a name="DFLAG_SPAWN"></a><span class="code">-define(DFLAG_SPAWN, (1 bsl 32)).</span></strong></dt>
        <dd>
          <p>Set if the <span class="bold_code bc-17"><a href="#SPAWN_REQUEST"><span class="code">SPAWN_REQUEST</span></a></span>,
	  <span class="bold_code bc-17"><a href="#SPAWN_REQUEST_TT"><span class="code">SPAWN_REQUEST_TT</span></a></span>,
	  <span class="bold_code bc-17"><a href="#SPAWN_REPLY"><span class="code">SPAWN_REPLY</span></a></span>,
	  <span class="bold_code bc-17"><a href="#SPAWN_REPLY_TT"><span class="code">SPAWN_REPLY_TT</span></a></span>
	  control messages are supported.</p>
        </dd>
	<dt><strong><a name="DFLAG_NAME_ME"></a><span class="code">-define(DFLAG_NAME_ME, (1 bsl 33)).</span></strong></dt>
        <dd>
<p>
	  Dynamic node name. This is not a capability but rather used as a
	  request from the connecting node to receive its node name from the
	  accepting node as part of the handshake.</p>
	</dd>
	<dt><strong><a name="DFLAG_V4_NC"></a><span class="code">-define(DFLAG_V4_NC, (1 bsl 34)).</span></strong></dt>
        <dd>
	  <p>The node accepts a larger amount of data in pids, ports and
	  references (node container types version 4). In the pid case full 32-bit
	  <span class="code">ID</span> and <span class="code">Serial</span> fields in
	  <span class="bold_code bc-15"><a href="erl_ext_dist.html#NEW_PID_EXT"><span class="code">NEW_PID_EXT</span></a></span>,
	  in the port case a 64-bit integer in
	  <span class="bold_code bc-15"><a href="erl_ext_dist.html#V4_PORT_EXT"><span class="code">V4_PORT_EXT</span></a></span>,
	  and in the reference case up to 5 32-bit ID words are now accepted in
	  <span class="bold_code bc-15"><a href="erl_ext_dist.html#NEWER_REFERENCE_EXT"><span class="code">NEWER_REFERENCE_EXT</span></a></span>.
	  Introduced in OTP 24.</p>
	  <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>This flag will become mandatory in OTP 26.</p></p></div>
</div>
        </dd>
	<dt><strong><a name="DFLAG_ALIAS"></a><span class="code">-define(DFLAG_ALIAS, (1 bsl 35)).</span></strong></dt>
        <dd>
	  <p>The node supports process alias and can by this handle the 
	  <span class="bold_code bc-17"><a href="#ALIAS_SEND"><span class="code">ALIAS_SEND</span></a></span> and
	  <span class="bold_code bc-17"><a href="#ALIAS_SEND_TT"><span class="code">ALIAS_SEND_TT</span></a></span>
	  control messages.
	  Introduced in OTP 24.</p>
        </dd>
      </dl>
      <p>
	There is also function <span class="code">dist_util:strict_order_flags/0</span>
	returning all flags (bitwise or:ed together) corresponding to features
	that require strict ordering of data over distribution channels.
      </p>
    
  

  <a name="connected_nodes"></a><h3 id="protocol-between-connected-nodes" class="title-link" onMouseOver="document.getElementById('ghlink-protocol-between-connected-nodes-idm6550').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-protocol-between-connected-nodes-idm6550').style.visibility = 'hidden';">
<div class="title-name">13.3Â 
        Protocol between Connected Nodes</div>
<div class="title-anchors"><span id="ghlink-protocol-between-connected-nodes-idm6550" class="ghlink-after"><a href="#protocol-between-connected-nodes" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L1161" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    
    <p>Since ERTS 5.7.2 (OTP R13B) the runtime system passes a distribution flag
      in the handshake stage that enables the use of a
      <span class="bold_code bc-15"><a href="erl_ext_dist.html#distribution_header">distribution header
      </a></span> on all messages passed. Messages passed between nodes have in
      this case the following format:</p>

    <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
        <td align="left" valign="middle">4</td>
        <td align="left" valign="middle">d</td>
        <td align="left" valign="middle">n</td>
        <td align="left" valign="middle">m</td>
      </tr>
<tr>
        <td align="left" valign="middle"><span class="code">Length</span></td>
        <td align="left" valign="middle"><span class="code">DistributionHeader</span></td>
        <td align="left" valign="middle"><span class="code">ControlMessage</span></td>
        <td align="left" valign="middle"><span class="code">Message</span></td>
      </tr>
</table>
<p class="doc-table-caption">Table
        13.26:
        Â 
        Format of Messages Passed between Nodes (as from ERTS 5.7.2 (OTP R13B))
      </p>
</div>

    <dl>
      <dt><strong><span class="code">Length</span></strong></dt>
      <dd>
        <p>Equal to d + n + m.</p>
      </dd>
      <dt><strong><span class="code">DistributionHeader</span></strong></dt>
      <dd>
        <p>
          <span class="bold_code bc-15"><a href="erl_ext_dist.html#distribution_header">Distribution header
          describing the atom cache and fragmented distribution messages.
          </a></span>
        </p>
      </dd>
      <dt><strong><span class="code">ControlMessage</span></strong></dt>
      <dd>
        <p>A tuple passed using the external format of Erlang.</p>
      </dd>
      <dt><strong><span class="code">Message</span></strong></dt>
      <dd>
        <p>The message sent to another node using the '!'
          or the reason for a EXIT, EXIT2 or DOWN signal using
          the external term format.</p>
      </dd>
    </dl>

    <p>Notice that <span class="bold_code bc-15"><a href="erl_ext_dist.html#overall_format">the version
      number is omitted from the terms that follow a distribution header
      </a></span>.</p>

    <p>Nodes with an ERTS version earlier than 5.7.2 (OTP R13B) does not pass the
      distribution flag that enables the distribution header. Messages passed
      between nodes have in this case the following format:</p>

    <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
        <td align="left" valign="middle">4</td>
        <td align="left" valign="middle">1</td>
        <td align="left" valign="middle">n</td>
        <td align="left" valign="middle">m</td>
      </tr>
<tr>
        <td align="left" valign="middle"><span class="code">Length</span></td>
        <td align="left" valign="middle"><span class="code">Type</span></td>
        <td align="left" valign="middle"><span class="code">ControlMessage</span></td>
        <td align="left" valign="middle"><span class="code">Message</span></td>
      </tr>
</table>
<p class="doc-table-caption">Table
        13.27:
        Â 
        Format of Messages Passed between Nodes (before ERTS 5.7.2 (OTP R13B))
      </p>
</div>

    <dl>
      <dt><strong><span class="code">Length</span></strong></dt>
      <dd>
        <p>Equal to 1 + n + m.</p>
      </dd>
      <dt><strong><span class="code">Type</span></strong></dt>
      <dd>
        <p>Equal to <span class="code">112</span> (pass through).</p>
      </dd>
      <dt><strong><span class="code">ControlMessage</span></strong></dt>
      <dd>
        <p>A tuple passed using the external format of Erlang.</p>
      </dd>
      <dt><strong><span class="code">Message</span></strong></dt>
      <dd>
        <p>The message sent to another node using the '!' (in external format).
          Notice that <span class="code">Message</span> is only passed in combination with a
          <span class="code">ControlMessage</span> encoding a send ('!').</p>
      </dd>
    </dl>

    <a name="control_message"></a>
    <p>The <span class="code">ControlMessage</span> is a tuple, where the first element indicates
      which distributed operation it encodes:</p>

    <dl>
      <dt><strong><a name="LINK"></a><span class="code">LINK</span></strong></dt>
      <dd>
        <p><span class="code">{1, FromPid, ToPid}</span></p>
	<p>This signal is sent by <span class="code">FromPid</span> in order
	to create a link between <span class="code">FromPid</span> and
	<span class="code">ToPid</span>.</p>
      </dd>
      <dt><strong><span class="code">SEND</span></strong></dt>
      <dd>
        <p><span class="code">{2, Unused, ToPid}</span></p>
        <p>Followed by <span class="code">Message</span>.</p>
        <p><span class="code">Unused</span> is kept for backward compatibility.</p>
      </dd>
      <dt><strong><span class="code">EXIT</span></strong></dt>
      <dd>
        <p><span class="code">{3, FromPid, ToPid, Reason}</span></p>
        <p>This signal is sent when a link has been broken</p>
      </dd>
      <dt><strong><a name="UNLINK"></a><span class="code">UNLINK</span> (deprecated)</strong></dt>
      <dd>
        <p><span class="code">{4, FromPid, ToPid}</span></p>
	<p>This signal is sent by <span class="code">FromPid</span> in order to remove
	a link between <span class="code">FromPid</span> and <span class="code">ToPid</span>, when using the
	<span class="bold_code bc-17"><a href="#old_link_protocol">old link
	protocol</a></span>.</p>
	<div class="warning">
<div class="label">Warning</div>
<div class="content"><p><p>This signal has been deprecated and will not
	be supported in OTP 26. For more information see the
	documentation of the
	<span class="bold_code bc-17"><a href="#new_link_protocol">new link protocol</a></span>.
	</p></p></div>
</div>
      </dd>
      <dt><strong><span class="code">NODE_LINK</span></strong></dt>
      <dd>
        <p><span class="code">{5}</span></p>
      </dd>
      <dt><strong><span class="code">REG_SEND</span></strong></dt>
      <dd>
        <p><span class="code">{6, FromPid, Unused, ToName}</span></p>
        <p>Followed by <span class="code">Message</span>.</p>
        <p><span class="code">Unused</span> is kept for backward compatibility.</p>
      </dd>
      <dt><strong><span class="code">GROUP_LEADER</span></strong></dt>
      <dd>
        <p><span class="code">{7, FromPid, ToPid}</span></p>
      </dd>	
      <dt><strong><span class="code">EXIT2</span></strong></dt>
      <dd>
        <p><span class="code">{8, FromPid, ToPid, Reason}</span></p>
        <p>This signal is sent by a call to the erlang:exit/2 bif</p>
      </dd>
      <dt><strong><span class="code">SEND_TT</span></strong></dt>
      <dd>
        <p><span class="code">{12, Unused, ToPid, TraceToken}</span></p>
        <p>Followed by <span class="code">Message</span>.</p>
        <p><span class="code">Unused</span> is kept for backward compatibility.</p>
      </dd>
      <dt><strong><span class="code">EXIT_TT</span></strong></dt>
      <dd>
        <p><span class="code">{13, FromPid, ToPid, TraceToken, Reason}</span></p>
      </dd>
      <dt><strong><span class="code">REG_SEND_TT</span></strong></dt>
      <dd>
        <p><span class="code">{16, FromPid, Unused, ToName, TraceToken}</span></p>
        <p>Followed by <span class="code">Message</span>.</p>
        <p><span class="code">Unused</span> is kept for backward compatibility.</p>
      </dd>
      <dt><strong><span class="code">EXIT2_TT</span></strong></dt>
      <dd>
        <p><span class="code">{18, FromPid, ToPid, TraceToken, Reason}</span></p>
      </dd>
      <dt><strong><span class="code">MONITOR_P</span></strong></dt>
      <dd>
        <p><span class="code">{19, FromPid, ToProc, Ref}</span>, where
          <span class="code">FromPid</span> = monitoring process and
          <span class="code">ToProc</span> = monitored process pid or name (atom)</p>
      </dd>
      <dt><strong><span class="code">DEMONITOR_P</span></strong></dt>
      <dd>
        <p><span class="code">{20, FromPid, ToProc, Ref}</span>, where
          <span class="code">FromPid</span> = monitoring process and
          <span class="code">ToProc</span> = monitored process pid or name (atom)</p>
        <p>We include <span class="code">FromPid</span> just in case we want to trace this.</p>
      </dd>
      <dt><strong><span class="code">MONITOR_P_EXIT</span></strong></dt>
      <dd>
        <p><span class="code">{21, FromProc, ToPid, Ref, Reason}</span>, where
          <span class="code">FromProc</span> = monitored process pid or name (atom),
          <span class="code">ToPid</span> = monitoring process, and
          <span class="code">Reason</span> = exit reason for the monitored process</p>
      </dd>
    </dl>

    <h4 id="new-ctrlmessages-for-erlang-otp-21" class="title-link" onMouseOver="document.getElementById('ghlink-new-ctrlmessages-for-erlang-otp-21-idm6748').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-new-ctrlmessages-for-erlang-otp-21-idm6748').style.visibility = 'hidden';">
<div class="title-name">New Ctrlmessages for Erlang/OTP 21</div>
<div class="title-anchors"><span id="ghlink-new-ctrlmessages-for-erlang-otp-21-idm6748" class="ghlink-after"><a href="#new-ctrlmessages-for-erlang-otp-21" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L1355" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
    
    <dl>
      <dt><strong><span class="code">SEND_SENDER</span></strong></dt>
      <dd>
        <p><span class="code">{22, FromPid, ToPid}</span></p>
        <p>Followed by <span class="code">Message</span>.</p>
	<p>
	  This control message replaces the <span class="code">SEND</span> control
	  message and will be sent when the distribution flag
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#dflags"><span class="code">DFLAG_SEND_SENDER</span></a></span>
	  has been negotiated in the connection setup handshake.
	</p>
	<div class="note">
<div class="label">Note</div>
<div class="content"><p><p>
	  Messages encoded before the connection has
	  been set up may still use the <span class="code">SEND</span> control
	  message. However, once a <span class="code">SEND_SENDER</span> or <span class="code">SEND_SENDER_TT</span>
	  control message has been sent, no more <span class="code">SEND</span>
	  control messages will be sent in the same direction
	  on the connection.
	</p></p></div>
</div>
      </dd>
      <dt><strong><span class="code">SEND_SENDER_TT</span></strong></dt>
      <dd>
        <p><span class="code">{23, FromPid, ToPid, TraceToken}</span></p>
        <p>Followed by <span class="code">Message</span>.</p>
	<p>
	  This control message replaces the <span class="code">SEND_TT</span> control
	  message and will be sent when the distribution flag
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#dflags"><span class="code">DFLAG_SEND_SENDER</span></a></span>
	  has been negotiated in the connection setup handshake.
	</p>
	<div class="note">
<div class="label">Note</div>
<div class="content"><p><p>
	  Messages encoded before the connection has
	  been set up may still use the <span class="code">SEND_TT</span> control
	  message. However, once a <span class="code">SEND_SENDER</span> or <span class="code">SEND_SENDER_TT</span>
	  control message has been sent, no more <span class="code">SEND_TT</span>
	  control messages will be sent in the same direction
	  on the connection.
	</p></p></div>
</div>
      </dd>
    </dl>
  

  <h4 id="new-ctrlmessages-for-erlang-otp-22" class="title-link" onMouseOver="document.getElementById('ghlink-new-ctrlmessages-for-erlang-otp-22-idm6785').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-new-ctrlmessages-for-erlang-otp-22-idm6785').style.visibility = 'hidden';">
<div class="title-name">New Ctrlmessages for Erlang/OTP 22</div>
<div class="title-anchors"><span id="ghlink-new-ctrlmessages-for-erlang-otp-22-idm6785" class="ghlink-after"><a href="#new-ctrlmessages-for-erlang-otp-22" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L1399" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
    
    <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>
      Messages encoded before the connection has
      been set up may still use the non-PAYLOAD variant.
      However, once a PAYLOAD control message has been sent,
      no more non-PAYLOAD control messages will be sent in
      the same direction on the connection.
    </p></p></div>
</div>
    <dl>
      <dt><strong><span class="code">PAYLOAD_EXIT</span></strong></dt>
      <dd>
        <p><span class="code">{24, FromPid, ToPid}</span></p>
        <p>Followed by <span class="code">Reason</span>.</p>
	<p>
	  This control message replaces the <span class="code">EXIT</span> control
	  message and will be sent when the distribution flag
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#dflags"><span class="code">DFLAG_EXIT_PAYLOAD</span></a></span>
	  has been negotiated in the connection setup handshake.
	</p>
      </dd>
      <dt><strong><span class="code">PAYLOAD_EXIT_TT</span></strong></dt>
      <dd>
        <p><span class="code">{25, FromPid, ToPid}</span></p>
        <p>Followed by <span class="code">Reason</span>.</p>
	<p>
	  This control message replaces the <span class="code">EXIT_TT</span> control
	  message and will be sent when the distribution flag
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#dflags"><span class="code">DFLAG_EXIT_PAYLOAD</span></a></span>
	  has been negotiated in the connection setup handshake.
	</p>
      </dd>
      <dt><strong><span class="code">PAYLOAD_EXIT2</span></strong></dt>
      <dd>
        <p><span class="code">{26, FromPid, ToPid}</span></p>
        <p>Followed by <span class="code">Reason</span>.</p>
	<p>
	  This control message replaces the <span class="code">EXIT2</span> control
	  message and will be sent when the distribution flag
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#dflags"><span class="code">DFLAG_EXIT_PAYLOAD</span></a></span>
	  has been negotiated in the connection setup handshake.
	</p>
      </dd>
      <dt><strong><span class="code">PAYLOAD_EXIT2_TT</span></strong></dt>
      <dd>
        <p><span class="code">{27, FromPid, ToPid}</span></p>
        <p>Followed by <span class="code">Reason</span>.</p>
	<p>
	  This control message replaces the <span class="code">EXIT2_TT</span> control
	  message and will be sent when the distribution flag
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#dflags"><span class="code">DFLAG_EXIT_PAYLOAD</span></a></span>
	  has been negotiated in the connection setup handshake.
	</p>
      </dd>
      <dt><strong><span class="code">PAYLOAD_MONITOR_P_EXIT</span></strong></dt>
      <dd>
        <p><span class="code">{28, FromPid, ToPid, Ref}</span></p>
        <p>Followed by <span class="code">Reason</span>.</p>
	<p>
	  This control message replaces the <span class="code">MONITOR_P_EXIT</span> control
	  message and will be sent when the distribution flag
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#dflags"><span class="code">DFLAG_EXIT_PAYLOAD</span></a></span>
	  has been negotiated in the connection setup handshake.
	</p>
      </dd>
      
    </dl>
  
  <h4 id="new-ctrlmessages-for-erlang-otp-23" class="title-link" onMouseOver="document.getElementById('ghlink-new-ctrlmessages-for-erlang-otp-23-idm6845').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-new-ctrlmessages-for-erlang-otp-23-idm6845').style.visibility = 'hidden';">
<div class="title-name">New Ctrlmessages for Erlang/OTP 23</div>
<div class="title-anchors"><span id="ghlink-new-ctrlmessages-for-erlang-otp-23-idm6845" class="ghlink-after"><a href="#new-ctrlmessages-for-erlang-otp-23" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L1467" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
    
    <dl>
      <dt><strong><a name="SPAWN_REQUEST"></a><span class="code">SPAWN_REQUEST</span></strong></dt>
      <dd>
        <p><span class="code">{29, ReqId, From, GroupLeader, {Module, Function, Arity}, OptList}</span></p>
        <p>Followed by <span class="code">ArgList</span>.</p>
	<p>This signal is sent by the
	<span class="bold_code bc-15"><a href="../../man/erlang.html#spawn_request-5"><span class="code">spawn_request()</span></a></span> BIF.</p>
	<dl>
	  <dt><strong><span class="code">ReqId :: reference()</span></strong></dt>
	  <dd><p>Request identifier. Also used as monitor
	  reference in case the <span class="code">monitor</span> option has been
	  passed.</p></dd>
	  <dt><strong><span class="code">From :: pid()</span></strong></dt>
	  <dd><p>Process identifier of the process making the
	  request. That is, the parent process to be.</p></dd>
	  <dt><strong><span class="code">GroupLeader :: pid()</span></strong></dt>
	  <dd><p>Process identifier of the group leader of the
	  newly created process.</p></dd>
	  <dt><strong><span class="code">{Module :: atom(), Function :: atom(), Arity :: integer() &gt;= 0}</span></strong></dt>
	  <dd><p>Entry point for the the new process.</p></dd>
	  <dt><strong><span class="code">OptList :: [term()]</span></strong></dt>
	  <dd><p>A proper list of spawn options to use when spawning.</p></dd>
	  <dt><strong><span class="code">ArgList :: [term()]</span></strong></dt>
	  <dd><p>A proper list of arguments to use in the call to the entry point.</p></dd>
	</dl>
	<p>
	  Only supported when the
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#DFLAG_SPAWN"><span class="code">DFLAG_SPAWN</span></a></span>
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#dflags">distribution flag</a></span>
	  has been passed.
	</p>
      </dd>
      <dt><strong><a name="SPAWN_REQUEST_TT"></a><span class="code">SPAWN_REQUEST_TT</span></strong></dt>
      <dd>
        <p><span class="code">{30, ReqId, From, GroupLeader, {Module, Function, Arity}, OptList, Token}</span></p>
        <p>Followed by <span class="code">ArgList</span>.</p>
	<p>Same as <span class="bold_code bc-17"><a href="#SPAWN_REQUEST"><span class="code">SPAWN_REQUEST</span></a></span>, but also
	with a sequential trace <span class="code">Token</span>.
	</p>
	<p>
	  Only supported when the
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#DFLAG_SPAWN"><span class="code">DFLAG_SPAWN</span></a></span>
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#dflags">distribution flag</a></span>
	  has been passed.
	</p>
      </dd>
      <dt><strong><a name="SPAWN_REPLY"></a><span class="code">SPAWN_REPLY</span></strong></dt>
      <dd>
        <p><span class="code">{31, ReqId, To, Flags, Result}</span></p>
	<p>This signal is sent as a reply to a process previously sending
	a <span class="bold_code bc-17"><a href="#SPAWN_REQUEST"><span class="code">SPAWN_REQUEST</span></a></span> signal.</p>
	<dl>
	  <dt><strong><span class="code">ReqId :: reference()</span></strong></dt>
	  <dd><p>Request identifier. Also used as monitor
	  reference in case the <span class="code">monitor</span> option has been
	  passed.</p></dd>
	  <dt><strong><span class="code">To :: pid()</span></strong></dt>
	  <dd><p>Process identifier of the process making the
	  spawn request.</p></dd>
	  <dt><strong><span class="code">Flags :: integer() &gt;= 0</span></strong></dt>
	  <dd>
<p>A bit flag field of bit flags bitwise or:ed together. Currently the
	  following flags are defined:</p>
	  <dl>
	    <dt><strong><span class="code">1</span></strong></dt>
	    <dd><p>A link between <span class="code">To</span> and <span class="code">Result</span> was set up on
	    the node where <span class="code">Result</span> resides.</p></dd>
	    <dt><strong><span class="code">2</span></strong></dt>
	    <dd><p>A monitor from <span class="code">To</span> to <span class="code">Result</span> was set up on
	    the node where <span class="code">Result</span> resides.</p></dd>
	  </dl>
	  </dd>
	  <dt><strong><span class="code">Result :: pid() | atom()</span></strong></dt>
	  <dd><p>Result of the operation. If <span class="code">Result</span> is a process
	  identifier, the operation succeeded and the process identifier
	  is the identifier of the newly created process. If <span class="code">Result</span>
	  is an atom, the operation failed and the atom identifies failure
	  reason.</p></dd>
	</dl>
	<p>
	  Only supported when the
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#DFLAG_SPAWN"><span class="code">DFLAG_SPAWN</span></a></span>
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#dflags">distribution flag</a></span>
	  has been passed.
	</p>
      </dd>
      <dt><strong><a name="SPAWN_REPLY_TT"></a><span class="code">SPAWN_REPLY_TT</span></strong></dt>
      <dd>
        <p><span class="code">{32, ReqId, To, Flags, Result, Token}</span></p>
	<p>Same as <span class="bold_code bc-17"><a href="#SPAWN_REPLY"><span class="code">SPAWN_REPLY</span></a></span>, but also
	with a sequential trace <span class="code">Token</span>.</p>
	<p>
	  Only supported when the
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#DFLAG_SPAWN"><span class="code">DFLAG_SPAWN</span></a></span>
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#dflags">distribution flag</a></span>
	  has been passed.
	</p>
      </dd>
      <dt><strong><a name="UNLINK_ID"></a><span class="code">UNLINK_ID</span></strong></dt>
      <dd>
        <p><span class="code">{35, Id, FromPid, ToPid}</span></p>
	<p>This signal is sent by <span class="code">FromPid</span> in order to remove a
	link between <span class="code">FromPid</span> and <span class="code">ToPid</span>. This unlink signal
        replaces the <span class="bold_code bc-17"><a href="#UNLINK"><span class="code">UNLINK</span></a></span>
	signal. Besides process identifiers of the sender and receiver
	the <span class="code">UNLINK_ID</span> signal also contains an integer identifier
	<span class="code">Id</span>. Valid range of <span class="code">Id</span> is <span class="code">[1, (1 bsl 64) - 1]</span>.
	<span class="code">Id</span> is to be passed back to the sender by the receiver in an
	<span class="bold_code bc-17"><a href="#UNLINK_ID_ACK"><span class="code">UNLINK_ID_ACK</span></a></span>
	signal. <span class="code">Id</span> must uniquely identify the <span class="code">UNLINK_ID</span> signal
	among all not yet acknowledged <span class="code">UNLINK_ID</span> signals from
	<span class="code">FromPid</span> to <span class="code">ToPid</span>.</p>
	<p>
	  This signal is only passed when the 
	  <span class="bold_code bc-17"><a href="#new_link_protocol">new link protocol</a></span>
	  has been negotiated using the
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#DFLAG_UNLINK_ID"><span class="code">DFLAG_UNLINK_ID</span></a></span>
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#dflags">distribution flag</a></span>.
	</p>
      </dd>
      <dt><strong><a name="UNLINK_ID_ACK"></a><span class="code">UNLINK_ID_ACK</span></strong></dt>
      <dd>
        <p><span class="code">{36, Id, FromPid, ToPid}</span></p>
        <p>An unlink acknowledgement signal. This signal is sent as an
	acknowledgement of the reception of an 
	<span class="bold_code bc-17"><a href="#UNLINK_ID"><span class="code">UNLINK_ID</span></a></span>
	signal. The <span class="code">Id</span> element should be the same <span class="code">Id</span>
	as present in the <span class="code">UNLINK_ID</span> signal. <span class="code">FromPid</span>
	identifies the sender of the <span class="code">UNLINK_ID_ACK</span> signal and
	<span class="code">ToPid</span> identifies the sender of the <span class="code">UNLINK_ID</span>
	signal.</p>
	<p>
	  This signal is only passed when the 
	  <span class="bold_code bc-17"><a href="#new_link_protocol">new link protocol</a></span>
	  has been negotiated using the
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#DFLAG_UNLINK_ID"><span class="code">DFLAG_UNLINK_ID</span></a></span>
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#dflags">distribution flag</a></span>.
	</p>
      </dd>
    </dl>
  
  <h4 id="new-ctrlmessages-for-erlang-otp-24" class="title-link" onMouseOver="document.getElementById('ghlink-new-ctrlmessages-for-erlang-otp-24-idm7017').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-new-ctrlmessages-for-erlang-otp-24-idm7017').style.visibility = 'hidden';">
<div class="title-name">New Ctrlmessages for Erlang/OTP 24</div>
<div class="title-anchors"><span id="ghlink-new-ctrlmessages-for-erlang-otp-24-idm7017" class="ghlink-after"><a href="#new-ctrlmessages-for-erlang-otp-24" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L1609" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
    
    <dl>
      <dt><strong><a name="ALIAS_SEND"></a><span class="code">ALIAS_SEND</span></strong></dt>
      <dd>
        <p><span class="code">{33, FromPid, Alias}</span></p>
        <p>Followed by <span class="code">Message</span>.</p>
	<p>
	  This control message is used when sending the message <span class="code">Message</span>
	  to the process identified by the process alias <span class="code">Alias</span>. Nodes that
	  can handle this control message sets the distribution flag
	  <span class="bold_code bc-15"><a href="erl_dist_protocol.html#dflags"><span class="code">DFLAG_ALIAS</span></a></span>
	  in the connection setup handshake.
	</p>
      </dd>
      <dt><strong><a name="ALIAS_SEND_TT"></a><span class="code">ALIAS_SEND_TT</span></strong></dt>
      <dd>
        <p><span class="code">{34, FromPid, Alias, Token}</span></p>
        <p>Followed by <span class="code">Message</span>.</p>
	<p>Same as <span class="bold_code bc-17"><a href="#ALIAS_SEND"><span class="code">ALIAS_SEND</span></a></span>, but also
	with a sequential trace <span class="code">Token</span>.</p>
      </dd>
    </dl>
  
  <a name="link_protocol"></a><h4 id="link-protocol" class="title-link" onMouseOver="document.getElementById('ghlink-link-protocol-idm7045').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-link-protocol-idm7045').style.visibility = 'hidden';">
<div class="title-name">Link Protocol</div>
<div class="title-anchors"><span id="ghlink-link-protocol-idm7045" class="ghlink-after"><a href="#link-protocol" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/erts/doc/src/erl_dist_protocol.xml#L1633" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
    
    

    <h5>
<a name="new_link_protocol"></a>New Link Protocol</h5>
      
      

      <p>
	The new link protocol will be used when both nodes flag that
	they understand it using the
	<span class="bold_code bc-17"><a href="#DFLAG_UNLINK_ID"><span class="code">DFLAG_UNLINK_ID</span></a></span>
	<span class="bold_code bc-17"><a href="#dflags">distribution flag</a></span>. If
	one of the nodes does not understand the new link protocol, the
	<span class="bold_code bc-17"><a href="#old_link_protocol">old link protocol</a></span>
	will be used as a fallback.
      </p>
      
      <p>
	The new link protocol introduces two new signals,
	<span class="bold_code bc-17"><a href="#UNLINK_ID"><span class="code">UNLINK_ID</span></a></span> and
	<span class="bold_code bc-17"><a href="#UNLINK_ID"><span class="code">UNLINK_ID_ACK</span></a></span>,
	which replace the old
	<span class="bold_code bc-17"><a href="#UNLINK"><span class="code">UNLINK</span></a></span>
	signal. The old <span class="bold_code bc-17"><a href="#LINK"><span class="code">LINK</span></a></span>
	signal is still sent in order to set up a link, but handled
	differently upon reception.
      </p>

      <p>
	In order to set up a link, a <span class="code">LINK</span> signal is sent, from
	the process initiating the operation, to the process that it
	wants to link to. In order to remove a link, an
	<span class="code">UNLINK_ID</span> signal is sent, from the process initiating
	the operation, to the linked process. The receiver of an
	<span class="code">UNLINK_ID</span> signal responds with an <span class="code">UNLINK_ID_ACK</span>
	signal. Upon reception of an <span class="code">UNLINK_ID</span> signal, the
	corresponding <span class="code">UNLINK_ID_ACK</span> signal <strong>must</strong> be
	sent before any other signals are sent to the sender of the
	<span class="code">UNLINK_ID</span> signal. Together with
	<span class="bold_code bc-13"><a href="../../reference_manual/processes.html#signal-delivery">the
	signal ordering guarantee</a></span> of Erlang this makes it
	possible for the sender of the <span class="code">UNLINK_ID</span> signal to know
	the order of other signals which is essential for the protocol.
	The <span class="code">UNLINK_ID_ACK</span> signal should contain the same
	<span class="code">Id</span> as the <span class="code">Id</span> contained in the <span class="code">UNLINK_ID</span>
	signal being acknowledged.
      </p>

      <p>
	Processes also need to maintain process local information about
	links. The state of this process local information is changed
	when the signals above are sent and received. This process
	local information also determines if a signal should be sent
	when a process calls
	<span class="bold_code bc-15"><a href="../../man/erlang.html#link-1"><span class="code">link/1</span></a></span> or
	<span class="bold_code bc-15"><a href="../../man/erlang.html#unlink-1"><span class="code">unlink/1</span></a></span>.
	A <span class="code">LINK</span> signal is only sent if there does not currently
	exist an active link between the processes according to the
	process local information and an <span class="code">UNLINK_ID</span> signal is
	only sent if there currently exists an active link between the
	processes according to the process local information.
      </p>

      <p>
	The process local information about a link contains:
      </p>
      <dl>
	<dt><strong>Pid</strong></dt>
	<dd>
	  Process identifier of the linked process.
	</dd>
	<dt><strong>Active Flag</strong></dt>
	<dd>
	  If set, the link is active and the process will react on
	  <span class="bold_code bc-13"><a href="../../reference_manual/processes.html#receiving_exit_signals">incoming
	  exit signals</a></span> issued due to the link. If not set,
	  the link is inactive and incoming exit signals, issued due
	  to the link, will be ignored. That is, the processes are
	  considered as <strong>not</strong> linked.
	</dd>
	<dt><strong>Unlink Id</strong></dt>
	<dd>
	  Identifier of an outstanding unlink operation. That is,
	  an unlink operation that has not yet been acknowledged.
	  This information is only used when the active flag is not
	  set.
	</dd>
      </dl>

      <p>
	A process is only considered linked to another process
	if it has process local information about the link
	containing the process identifier of the other process and
	with the active flag set.
      </p>

      <p>
	The process local information about a link is updated as
	follows:
      </p>
      <dl>
	<dt><strong>A <span class="code">LINK</span> signal is sent</strong></dt>
	<dd>
	  Link information is created if not already existing. The
	  active flag is set, and unlink id is cleared. That is,
	  if we had an outstanding unlink operation we will ignore
	  the result of that operation and enable the link.
	</dd>
	<dt><strong>A <span class="code">LINK</span> signal is received</strong></dt>
	<dd>
	  If no link information already exists, it is created, the
	  active flag is set and unlink id is cleared. If the link
	  information already exists, the signal is silently ignored,
	  regardless of whether the active flag is set or not.
	  That is, if we have an outstanding unlink operation we will
	  <strong>not</strong> activate the link. In this scenario, the sender
	  of the <span class="code">LINK</span> signal has not yet sent an
	  <span class="code">UNLINK_ID_ACK</span> signal corresponding to our
	  <span class="code">UNLINK_ID</span> signal which means that it will receive
	  our <span class="code">UNLINK_ID</span> signal after it sent its
	  <span class="code">LINK</span> signal. This in turn means that both processes
	  in the end will agree that there is no link between them.
	</dd>
	<dt><strong>An <span class="code">UNLINK_ID</span> signal is sent</strong></dt>
	<dd>
	  Link information already exists and the active flag is set
	  (otherwise the signal would not be sent). The active flag
	  is unset, and the unlink id of the signal is saved in the
	  link information.
	</dd>
	<dt><strong>An <span class="code">UNLINK_ID</span> signal is received</strong></dt>
	<dd>
	  If the active flag is set, information about the link
	  is removed. If the active flag is not set (that is, we have
	  an outstanding unlink operation), the information about the
	  link is left unchanged.
	</dd>
	<dt><strong>An <span class="code">UNLINK_ID_ACK</span> signal is sent</strong></dt>
	<dd>
	  This is done when an <span class="code">UNLINK_ID</span> signal is received and
	  causes no further changes of the link information.
	</dd>
	<dt><strong>An <span class="code">UNLINK_ID_ACK</span> signal is received</strong></dt>
	<dd>
	  If information about the link exists, the active flag is not
	  set, and the unlink id in the link information equals the
	  <span class="code">Id</span> in the signal, the link information is removed;
	  otherwise, the signal is ignored.
	</dd>
      </dl>

      <p>
	When a process receives an exit signal due to a link, the
	process will first react to the exit signal if the link
	is active and then remove the process local information about
	the link.
      </p>
      <p>
	In case the connection is lost between two nodes, exit signals
	with exit reason <span class="code">noconnection</span> are sent to all processes
	with links over the connection. This will cause all process
	local information about links over the connection to be
	removed.
      </p>
      <p>
	Exactly the same link protocol is also used internally on an
	Erlang node. The signals however have different formats since
	they do not have to be sent over the wire.
      </p>
    

    <h5>
<a name="old_link_protocol"></a>Old Link Protocol</h5>
      
      

      <p>
	The old link protocol utilize two signals
	<span class="bold_code bc-17"><a href="#LINK"><span class="code">LINK</span></a></span>, and
	<span class="bold_code bc-17"><a href="#UNLINK"><span class="code">UNLINK</span></a></span>. The
	<span class="code">LINK</span> signal informs the other process that a link
	should be set up, and the <span class="code">UNLINK</span> signal informs the
	other process that a link should be removed. This protocol
	is however a bit too naive. If both processes operate on the
	link simultaneously, the link may end up in an inconsistent
	state where one process thinks it is linked while the other
	thinks it is not linked.
      </p>
      <p>
	This protocol is deprecated and support for it will be removed
	in OTP 26. Until then, it will be used as fallback when
	communicating with old nodes that do not understand the
	<span class="bold_code bc-17"><a href="#new_link_protocol">new link
	protocol</a></span>.
      </p>
    

  
  

</div>
<div class="footer">
<hr>
<p>Copyright Â© 1997-2024 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script type="text/javascript">window.__otpTopDocDir = '../../js/';</script><script type="text/javascript" src="../../js/highlight.js"></script>
<script type="text/javascript">
_docsearch_version = "24";
</script> 
<script src="/assets/js/doc-search.bundle.js"></script>
</body>
</html>
