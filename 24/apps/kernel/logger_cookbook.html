<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:erl="http://erlang.org" xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<link rel="stylesheet" href="../../otp_doc.css" type="text/css">
<meta name="major-vsn" content="24">
<title>Erlang -- Logging Cookbook</title>
</head>
<body>
<div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../../js/erlresolvelinks.js"></script><script id="js3" type="text/javascript" src="../../../../doc/js/topbar.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function setscrollpos() {
                var objf = document.getElementById('loadscrollpos');
                if (objf) {
                  document.getElementById("leftnav").firstChild.scrollTop = objf.offsetTop - 10;
                }
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //-->
</script><div class="topbar">
<div class="topbar-expand "><button onclick="toggleDisplay();"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="Capa_1" viewBox="0 0 54 54" width="24" height="24"><g><path style="fill:#000000;" d="M27,54c-0.552,0-1-0.448-1-1V8c0-0.552,0.448-1,1-1s1,0.448,1,1v45C28,53.552,27.552,54,27,54z"></path><path style="fill:#000000;" d="M11,25c-0.256,0-0.512-0.098-0.707-0.293c-0.391-0.391-0.391-1.023,0-1.414l16-16                                      c0.391-0.391,1.023-0.391,1.414,0s0.391,1.023,0,1.414l-16,16C11.512,24.902,11.256,25,11,25z"></path><path style="fill:#000000;" d="M43,25c-0.256,0-0.512-0.098-0.707-0.293l-16-16c-0.391-0.391-0.391-1.023,0-1.414                                      s1.023-0.391,1.414,0l16,16c0.391,0.391,0.391,1.023,0,1.414C43.512,24.902,43.256,25,43,25z"></path><path style="fill:#000000;" d="M43,2H11c-0.552,0-1-0.448-1-1s0.448-1,1-1h32c0.552,0,1,0.448,1,1S43.552,2,43,2z"></path></g></svg></button></div>
<div class="topbar-title"><h1 id="Logging Cookbook">4 
                Logging Cookbook</h1></div>
<div class="search-expand ">        <button id="docsearch-mobile">
            <svg fill="#000000" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="24" height="24"><path d="M 21 3 C 11.621094 3 4 10.621094 4 20 C 4 29.378906 11.621094 37 21 37 C 24.710938 37 28.140625 35.804688 30.9375 33.78125 L 44.09375 46.90625 L 46.90625 44.09375 L 33.90625 31.0625 C 36.460938 28.085938 38 24.222656 38 20 C 38 10.621094 30.378906 3 21 3 Z M 21 5 C 29.296875 5 36 11.703125 36 20 C 36 28.296875 29.296875 35 21 35 C 12.703125 35 6 28.296875 6 20 C 6 11.703125 12.703125 5 21 5 Z"/></svg>
        </button>
</div>
</div>
<aside class="hide-mobile" id="leftnav"><nav class="leftnav-tube"><div class="erlang-logo-wrapper"><a href="../../index.html"><img alt="Erlang Logo" src="../../erlang-logo.png" class="erlang-logo"></a></div>
<p class="section-title">Kernel</p>
<p class="section-subtitle">User's Guide</p>
<p class="section-version">Version 8.3.2.4</p>
<ul class="panel-sections">
<li><a href="users_guide.html">User's Guide</a></li>
<li><a href="index.html">Reference Manual</a></li>
<li><a href="notes.html">Release Notes</a></li>
<li><a href="kernel.pdf">PDF</a></li>
<li><a href="../../index.html">Top</a></li>
</ul>
<div id="docsearch"></div>
<div style="padding-left: 1rem; padding-top: 0.1rem;"><a href="/doc/search?v=24">Paginated Search</a></div>
<ul class="expand-collapse-items">
<li><a href="javascript:openAllFlips()">Expand All</a></li>
<li><a href="javascript:closeAllFlips()">Contract All</a></li>
</ul>
<h3 id="chapters">Chapters</h3>
<ul class="flipMenu" imagePath="../../js/flipmenu">
<li id="no" title="Introduction" expanded="false">Introduction<ul>
<li><a href="introduction.html">
              Top of chapter
            </a></li>
<li title="Scope"><a href="introduction.html#scope">Scope</a></li>
<li title="Prerequisites"><a href="introduction.html#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li id="no" title="Socket Usage" expanded="false">Socket Usage<ul>
<li><a href="socket_usage.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="socket_usage.html#introduction">Introduction</a></li>
<li title="Socket Registry"><a href="socket_usage.html#socket-registry">Socket Registry</a></li>
<li title="Socket Options"><a href="socket_usage.html#socket-options">Socket Options</a></li>
</ul>
</li>
<li id="no" title="Logging" expanded="false">Logging<ul>
<li><a href="logger_chapter.html">
              Top of chapter
            </a></li>
<li title="Overview"><a href="logger_chapter.html#overview">Overview</a></li>
<li title="Logger API"><a href="logger_chapter.html#logger-api">Logger API</a></li>
<li title="Filters"><a href="logger_chapter.html#filters">Filters</a></li>
<li title="Handlers"><a href="logger_chapter.html#handlers">Handlers</a></li>
<li title="Formatters"><a href="logger_chapter.html#formatters">Formatters</a></li>
<li title="Configuration"><a href="logger_chapter.html#configuration">Configuration</a></li>
<li title="Backwards Compatibility with error_logger"><a href="logger_chapter.html#backwards-compatibility-with-error_logger">Backwards Compatibility with error_logger</a></li>
<li title="Error Handling"><a href="logger_chapter.html#error-handling">Error Handling</a></li>
<li title="Example: Add a handler to log info events to file"><a href="logger_chapter.html#example--add-a-handler-to-log-info-events-to-file">Example: Add a handler to log info events to file</a></li>
<li title="Example: Implement a handler"><a href="logger_chapter.html#example--implement-a-handler">Example: Implement a handler</a></li>
<li title="Protecting the Handler from Overload"><a href="logger_chapter.html#protecting-the-handler-from-overload">Protecting the Handler from Overload</a></li>
<li title="Logger Proxy"><a href="logger_chapter.html#logger-proxy">Logger Proxy</a></li>
<li title="See Also"><a href="logger_chapter.html#see-also">See Also</a></li>
</ul>
</li>
<li id="loadscrollpos" title="Logging Cookbook" expanded="true">Logging Cookbook<ul>
<li><a href="logger_cookbook.html">
              Top of chapter
            </a></li>
<li title="Get Logger information"><a href="logger_cookbook.html#get-logger-information">Get Logger information</a></li>
<li title="Configure the Logger"><a href="logger_cookbook.html#configure-the-logger">Configure the Logger</a></li>
<li title="Configure Logger formatter"><a href="logger_cookbook.html#configure-logger-formatter">Configure Logger formatter</a></li>
<li title="Configuring handlers"><a href="logger_cookbook.html#configuring-handlers">Configuring handlers</a></li>
<li title="Logging"><a href="logger_cookbook.html#logging">Logging</a></li>
<li title="Filters"><a href="logger_cookbook.html#filters">Filters</a></li>
</ul>
</li>
<li id="no" title="EEP-48: Documentation storage and format" expanded="false">EEP-48: Documentation storage and format<ul>
<li><a href="eep48_chapter.html">
              Top of chapter
            </a></li>
<li title='the "Docs" storage'><a href="eep48_chapter.html#the--docs--storage">the "Docs" storage</a></li>
<li title='the "Docs" format'><a href="eep48_chapter.html#the--docs--format">the "Docs" format</a></li>
<li title="See Also"><a href="eep48_chapter.html#see-also">See Also</a></li>
</ul>
</li>
</ul></nav></aside><div id="content">
<div class="innertube">
<h1 id="Logging Cookbook">4 Logging Cookbook</h1>
  

  <p>Using and especially configuring Logger can be difficult at times
  as there are many different options that can be changed and often more
  than one way to achieve the same result. This User's Guide tries to help
  by giving many different examples of how you can use logger.</p>

  <p>For more examples of practical use-cases of using Logger, Fred Hebert's blog post
  <span class="bold_code bc-20"><a href="https://ferd.ca/erlang-otp-21-s-new-logger.html">Erlang/OTP 21's new logger</a></span>
  is a great starting point.</p>

  <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>If you find that some common Logger usage is missing from this guide, please
    open a pull request on github with the suggested addition</p></p></div>
</div>

  <h3 id="get-logger-information" class="title-link" onMouseOver="document.getElementById('ghlink-get-logger-information-idm1871').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-get-logger-information-idm1871').style.visibility = 'hidden';">
<div class="title-name">4.1 
        Get Logger information</div>
<div class="title-anchors"><span id="ghlink-get-logger-information-idm1871" class="ghlink-after"><a href="#get-logger-information" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L45" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <h4 id="print-the-primary-logger-configurations." class="title-link" onMouseOver="document.getElementById('ghlink-print-the-primary-logger-configurations.-idm1873').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-print-the-primary-logger-configurations.-idm1873').style.visibility = 'hidden';">
<div class="title-name">Print the primary Logger configurations.</div>
<div class="title-anchors"><span id="ghlink-print-the-primary-logger-configurations.-idm1873" class="ghlink-after"><a href="#print-the-primary-logger-configurations." title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L47" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <div class="example example-erl-repl"><pre>1&gt; logger:i(primary).
Primary configuration:
    Level: notice
    Filter Default: log
    Filters:
        (none)</pre></div>
      <p>It is also possible to fetch the configuration using
        <span class="bold_code bc-15"><a href="../../man/logger.html#get_primary_config-0"><span class="code">logger:get_primary_config()</span></a></span>.
      </p>
      <h5>See also</h5>
        
        <ul>
          <li><span class="bold_code bc-15"><a href="../../man/logger.html#i-0">logger:i()</a></span></li>
          <li>
<span class="bold_code bc-15"><a href="logger_chapter.html#configuration">Configuration</a></span> in the Logging User's Guide</li>
        </ul>
      
    
    <h4 id="print-the-configuration-of-all-handlers." class="title-link" onMouseOver="document.getElementById('ghlink-print-the-configuration-of-all-handlers.-idm1886').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-print-the-configuration-of-all-handlers.-idm1886').style.visibility = 'hidden';">
<div class="title-name">Print the configuration of all handlers.</div>
<div class="title-anchors"><span id="ghlink-print-the-configuration-of-all-handlers.-idm1886" class="ghlink-after"><a href="#print-the-configuration-of-all-handlers." title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L66" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <div class="example example-erl-repl"><pre>2&gt; logger:i(handlers).
Handler configuration:
    Id: default
        Module: logger_std_h
        Level:  all
        Formatter:
            Module: logger_formatter
            Config:
                legacy_header: true
                single_line: false
        Filter Default: stop
        Filters:
            Id: remote_gl
                Fun: fun logger_filters:remote_gl/2
                Arg: stop
            Id: domain
                Fun: fun logger_filters:domain/2
                Arg: {log,super,[otp,sasl]}
            Id: no_domain
                Fun: fun logger_filters:domain/2
                Arg: {log,undefined,[]}
        Handler Config:
            burst_limit_enable: true
            burst_limit_max_count: 500
            burst_limit_window_time: 1000
            drop_mode_qlen: 200
            filesync_repeat_interval: no_repeat
            flush_qlen: 1000
            overload_kill_enable: false
            overload_kill_mem_size: 3000000
            overload_kill_qlen: 20000
            overload_kill_restart_after: 5000
            sync_mode_qlen: 10
            type: standard_io</pre></div>
      <p>You can also print the configuration of a specific handler using
        <span class="bold_code bc-15"><a href="../../man/logger.html#i-1"><span class="code">logger:i(HandlerName)</span></a></span>,
        or fetch the configuration using
        <span class="bold_code bc-15"><a href="../../man/logger.html#get_handler_config-0"><span class="code">logger:get_handler_config()</span></a></span>,
        or <span class="bold_code bc-15"><a href="../../man/logger.html#get_handler_config-1"><span class="code">logger:get_handler_config(HandlerName)</span></a></span>
        for a specific handler.</p>
      <h5>See also</h5>
        
        <ul>
          <li><span class="bold_code bc-15"><a href="../../man/logger.html#i-0"><span class="code">logger:i()</span></a></span></li>
          <li>
<span class="bold_code bc-15"><a href="logger_chapter.html#configuration">Configuration</a></span> in the Logging User's Guide</li>
        </ul>
      
    
  

  <h3 id="configure-the-logger" class="title-link" onMouseOver="document.getElementById('ghlink-configure-the-logger-idm1904').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-configure-the-logger-idm1904').style.visibility = 'hidden';">
<div class="title-name">4.2 
        Configure the Logger</div>
<div class="title-anchors"><span id="ghlink-configure-the-logger-idm1904" class="ghlink-after"><a href="#configure-the-logger" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L119" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    

    <h4 id="where-did-my-progress-reports-go-" class="title-link" onMouseOver="document.getElementById('ghlink-where-did-my-progress-reports-go--idm1906').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-where-did-my-progress-reports-go--idm1906').style.visibility = 'hidden';">
<div class="title-name">Where did my progress reports go?</div>
<div class="title-anchors"><span id="ghlink-where-did-my-progress-reports-go--idm1906" class="ghlink-after"><a href="#where-did-my-progress-reports-go-" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L122" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>In OTP-21 the default primary log level is <span class="code">notice</span>. The means
        that many log messages are by default not printed. This includes
        the progress reports of supervisors. In order to get progress reports
        you need to raise the primary log level to <span class="code">info</span></p>
      <div class="example example-erl-repl"><pre>$ erl -kernel logger_level info
=PROGRESS REPORT==== 4-Nov-2019::16:33:11.742069 ===
    application: kernel
    started_at: nonode@nohost
=PROGRESS REPORT==== 4-Nov-2019::16:33:11.746546 ===
    application: stdlib
    started_at: nonode@nohost
Eshell V10.5.3  (abort with ^G)
1&gt;</pre></div>

    
  

  <h3 id="configure-logger-formatter" class="title-link" onMouseOver="document.getElementById('ghlink-configure-logger-formatter-idm1912').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-configure-logger-formatter-idm1912').style.visibility = 'hidden';">
<div class="title-name">4.3 
        Configure Logger formatter</div>
<div class="title-anchors"><span id="ghlink-configure-logger-formatter-idm1912" class="ghlink-after"><a href="#configure-logger-formatter" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L141" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>In order to fit better into your existing logging infrastructure Logger can
      format its logging messages any way you want to. Either you can use the built-in
      formatter, or you can build your own.</p>
    <h4 id="single-line-configuration" class="title-link" onMouseOver="document.getElementById('ghlink-single-line-configuration-idm1915').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-single-line-configuration-idm1915').style.visibility = 'hidden';">
<div class="title-name">Single line configuration</div>
<div class="title-anchors"><span id="ghlink-single-line-configuration-idm1915" class="ghlink-after"><a href="#single-line-configuration" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L146" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>Since single line logging is the default of the built-in formatter you only have to
        provide the empty map as the configuration. The example below uses the <span class="code">sys.config</span>
        to change the formatter configuration.</p>
      <div class="example example-erl-repl"><pre>$ cat sys.config
[{kernel,
  [{logger,
    [{handler, default, logger_std_h,
      #{ formatter =&gt; {logger_formatter, #{ }}}}]}]}].
$ erl -config sys
Eshell V10.5.1  (abort with ^G)
1&gt; logger:error("Oh noes, an error").
1962-10-03T11:07:47.466763-04:00 error: Oh noes, an error</pre></div>
      <p>However, if you just want to change it for the current session you can
        also do that.</p>
      <div class="example example-erl-repl"><pre>1&gt; logger:set_handler_config(default, formatter, {logger_formatter, #{}}).
ok
2&gt; logger:error("Oh noes, another error").
1962-10-04T15:34:02.648713-04:00 error: Oh noes, another error</pre></div>
      <h5>See also</h5>
        
        <ul>
          <li><span class="bold_code bc-15"><a href="../../man/logger_formatter.html#type-config">logger_formatter's Configuration</a></span></li>
          <li>
<span class="bold_code bc-15"><a href="logger_chapter.html#formatters">Formatters</a></span> in the Logging User's Guide</li>
          <li><span class="bold_code bc-15"><a href="../../man/logger.html#set_handler_config-3"><span class="code">logger:set_handler_config/3</span></a></span></li>
        </ul>
      
    
    <h4 id="add-file-and-line-number-to-log-entries" class="title-link" onMouseOver="document.getElementById('ghlink-add-file-and-line-number-to-log-entries-idm1932').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-add-file-and-line-number-to-log-entries-idm1932').style.visibility = 'hidden';">
<div class="title-name">Add file and line number to log entries</div>
<div class="title-anchors"><span id="ghlink-add-file-and-line-number-to-log-entries-idm1932" class="ghlink-after"><a href="#add-file-and-line-number-to-log-entries" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L176" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>You can change what is printed to the log by using the formatter template:</p>
      <div class="example example-erl-repl"><pre>$ cat sys.config
[{kernel,
  [{logger,
    [{handler, default, logger_std_h,
      #{ formatter =&gt; {logger_formatter,
        #{ template =&gt; [time," ", file,":",line," ",level,": ",msg,"\n"] }}}}]}]}].
$ erl -config sys
Eshell V10.5.1  (abort with ^G)
1&gt; logger:error("Oh noes, more errors",#{ file =&gt; "shell.erl", line =&gt; 1 }).
1962-10-05T07:37:44.104241+02:00 shell.erl:1 error: Oh noes, more errors</pre></div>
      <p>Note that file and line have to be added in the metadata by the caller of
        <span class="bold_code bc-15"><a href="../../man/logger.html#log-3"><span class="code">logger:log/3</span></a></span> as otherwise
        Logger will not know from where it was called. The file and line number
        are automatically added if you use the <span class="code">?LOG_ERROR</span> macros in
        <span class="code">kernel/include/logger.hrl</span>.</p>
      <h5>See also</h5>
        
        <ul>
          <li><span class="bold_code bc-15"><a href="../../man/logger_formatter.html#type-config">logger_formatter's Configuration</a></span></li>
          <li><span class="bold_code bc-15"><a href="../../man/logger_formatter.html#type-template">logger_formatter's Template</a></span></li>
          <li><span class="bold_code bc-15"><a href="../../man/logger.html#macros">Logger Macros</a></span></li>
          <li>
<span class="bold_code bc-15"><a href="logger_chapter.html#metadata">Metadata</a></span> in the Logging User's Guide</li>
        </ul>
      
    
  

  <h3 id="configuring-handlers" class="title-link" onMouseOver="document.getElementById('ghlink-configuring-handlers-idm1952').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-configuring-handlers-idm1952').style.visibility = 'hidden';">
<div class="title-name">4.4 
        Configuring handlers</div>
<div class="title-anchors"><span id="ghlink-configuring-handlers-idm1952" class="ghlink-after"><a href="#configuring-handlers" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L206" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <h4 id="print-logs-to-a-file" class="title-link" onMouseOver="document.getElementById('ghlink-print-logs-to-a-file-idm1954').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-print-logs-to-a-file-idm1954').style.visibility = 'hidden';">
<div class="title-name">Print logs to a file</div>
<div class="title-anchors"><span id="ghlink-print-logs-to-a-file-idm1954" class="ghlink-after"><a href="#print-logs-to-a-file" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L208" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>Instead of printing the logs to stdout we print them to a rotating file log.</p>
      <div class="example example-erl-repl"><pre>$ cat sys.config
[{kernel,
  [{logger,
    [{handler, default, logger_std_h,
      #{ config =&gt; #{ file =&gt; "log/erlang.log",
                      max_no_bytes =&gt; 4096,
                      max_no_files =&gt; 5},
         formatter =&gt; {logger_formatter, #{}}}}]}]}].
$ erl -config sys
Eshell V10.5.1  (abort with ^G)
1&gt; logger:error("Oh noes, even more errors").
ok
2&gt; erlang:halt().
$ cat log/erlang.log
2019-10-07T11:47:16.837958+02:00 error: Oh noes, even more errors</pre></div>
      <h5>See also</h5>
        
        <ul>
          <li><span class="bold_code bc-15"><a href="../../man/logger_std_h.html#description">logger_std_h's Description</a></span></li>
          <li>
<span class="bold_code bc-15"><a href="logger_chapter.html#handlers">Handlers</a></span> in the Logging User's Guide</li>
        </ul>
      
    
    <h4 id="debug-only-handler" class="title-link" onMouseOver="document.getElementById('ghlink-debug-only-handler-idm1965').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-debug-only-handler-idm1965').style.visibility = 'hidden';">
<div class="title-name">Debug only handler</div>
<div class="title-anchors"><span id="ghlink-debug-only-handler-idm1965" class="ghlink-after"><a href="#debug-only-handler" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L234" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>Add a handler that prints <span class="code">debug</span> log events to a file,
        while the default handler prints only up to <span class="code">notice</span> level
        events to standard out.</p>
      <div class="example example-erl-repl"><pre>$ cat sys.config
[{kernel,
  [{logger_level, all},
   {logger,
    [{handler, default, logger_std_h,
      #{ level =&gt; notice }},
     {handler, debug, logger_std_h,
      #{ filters =&gt; [{debug,{fun logger_filters:level/2, {stop, neq, debug}}}],
         config =&gt; #{ file =&gt; "log/debug.log" } }}
    ]}]}].
$ erl -config sys
Eshell V10.5.1  (abort with ^G)
1&gt; logger:error("Oh noes, even more errors").
=ERROR REPORT==== 9-Oct-2019::14:40:54.784162 ===
Oh noes, even more errors
ok
2&gt; logger:debug("A debug event").
ok
3&gt; erlang:halt().
$ cat log/debug.log
2019-10-09T14:41:03.680541+02:00 debug: A debug event</pre></div>
    <p>In the configuration above we first raise the primary log level to max in
      order for the debug log events to get to the handlers. Then we configure
      the default handler to only log notice and below events, the default log level
      for a handler is <span class="code">all</span>. Then the debug handler is configured with a filter
      to stop any log message that is not a debug level message.</p>
    <p>It is also possible to do the same changes in an already running system
      using the <span class="code">logger</span> module. Then you do like this:</p>
    <div class="example example-erl-repl"><pre>$ erl
1&gt; logger:set_handler_config(default, level, notice).
ok
2&gt; logger:add_handler(debug, logger_std_h, #{
  filters =&gt; [{debug,{fun logger_filters:level/2, {stop, neq, debug}}}],
  config =&gt; #{ file =&gt; "log/debug.log" } }).
ok
3&gt; logger:set_primary_config(level, all).
ok</pre></div>
    <p>It is important that you do not raise the primary log level before adjusting
      the default handler's level as otherwise your standard out may be flooded by debug
      log messages.</p>
    <h5>See also</h5>
      
        <ul>
          <li><span class="bold_code bc-15"><a href="../../man/logger_std_h.html#description">logger_std_h's Description</a></span></li>
          <li>
<span class="bold_code bc-15"><a href="logger_chapter.html#filters">Filters</a></span> in the Logging User's Guide</li>
        </ul>
      
    
  

  

  <h3 id="logging" class="title-link" onMouseOver="document.getElementById('ghlink-logging-idm1984').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-logging-idm1984').style.visibility = 'hidden';">
<div class="title-name">4.5 
        Logging</div>
<div class="title-anchors"><span id="ghlink-logging-idm1984" class="ghlink-after"><a href="#logging" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L299" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <h4 id="what-to-log-and-how" class="title-link" onMouseOver="document.getElementById('ghlink-what-to-log-and-how-idm1986').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-what-to-log-and-how-idm1986').style.visibility = 'hidden';">
<div class="title-name">What to log and how</div>
<div class="title-anchors"><span id="ghlink-what-to-log-and-how-idm1986" class="ghlink-after"><a href="#what-to-log-and-how" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L301" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>The simplest way to log something is by using the Logger macros and
      give a report to the macro. For example if you want to log an error:</p>
      <div class="example example-erl"><pre>?LOG_ERROR(#{ what =&gt; http_error, status =&gt; 418, src =&gt; ClientIP, dst =&gt; ServerIP }).</pre></div>
      <p>This will print the following in the default log:</p>
      <div class="example example-none"><pre>=ERROR REPORT==== 10-Oct-2019::12:13:10.089073 ===
    dst: {8,8,4,4}
    src: {8,8,8,8}
    status: 418
    what: http_error</pre></div>
      <p>or the below if you use a single line formatter:</p>
      <div class="example example-none"><pre>2019-10-10T12:14:11.921843+02:00 error: dst: {8,8,4,4}, src: {8,8,8,8}, status: 418, what: http_error</pre></div>
      <h5>See also</h5>
        
        <ul>
          <li>
<span class="bold_code bc-15"><a href="logger_chapter.html#log_message">Log Message</a></span> in the Logging User's Guide</li>
        </ul>
      
    
    <h4 id="report-call-backs-and-printing-of-events" class="title-link" onMouseOver="document.getElementById('ghlink-report-call-backs-and-printing-of-events-idm1999').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-report-call-backs-and-printing-of-events-idm1999').style.visibility = 'hidden';">
<div class="title-name">Report call-backs and printing of events</div>
<div class="title-anchors"><span id="ghlink-report-call-backs-and-printing-of-events-idm1999" class="ghlink-after"><a href="#report-call-backs-and-printing-of-events" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L321" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>If you want to do structured logging, but still want to have some control
      of how the final log message is formatted you can give a <span class="code">report_cb</span>
      as part of the metadata with your log event.</p>
      <div class="example example-erl"><pre>ReportCB = fun(#{ what := What, status := Status, src := Src, dst := Dst }) -&gt;
                   {ok, #hostent{ h_name = SrcName }} = inet:gethostbyaddr(Src),
                   {ok, #hostent{ h_name = DstName }} = inet:gethostbyaddr(Dst),
                   {"What: ~p~nStatus: ~p~nSrc: ~s (~s)~nDst: ~s (~s)~n",
                    [What, Status, inet:ntoa(Src), SrcName, inet:ntoa(Dst), DstName]}
           end,
?LOG_ERROR(#{ what =&gt; http_error, status =&gt; 418, src =&gt; ClientIP, dst =&gt; ServerIP },
           #{ report_cb =&gt; ReportCB }).</pre></div>
      <p>This will print the following:</p>
      <div class="example example-none"><pre>=ERROR REPORT==== 10-Oct-2019::13:29:02.230863 ===
What: http_error
Status: 418
Src: 8.8.8.8 (dns.google)
Dst: 192.121.151.106 (erlang.org)</pre></div>
      <p>Note that the order that things are printed have changed, and also I added
        a reverse-dns lookup of the IP address. This will not print as nicely when using
        a single line formatter, however you can also use a report_cb fun with 2 arguments
        where the second argument is the formatting options.</p>
      <h5>See also</h5>
        
        <ul>
          <li>
<span class="bold_code bc-15"><a href="logger_chapter.html#log_message">Log Message</a></span> in the Logging User's Guide</li>
          <li><span class="bold_code bc-15"><a href="../../man/logger.html#type-report_cb">Logger Report Callbacks</a></span></li>
        </ul>
      
    
  

  <h3 id="filters" class="title-link" onMouseOver="document.getElementById('ghlink-filters-idm2014').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-filters-idm2014').style.visibility = 'hidden';">
<div class="title-name">4.6 
        Filters</div>
<div class="title-anchors"><span id="ghlink-filters-idm2014" class="ghlink-after"><a href="#filters" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L356" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>Filters are used to remove or change log events before they reach the handlers.</p>
    <h4 id="process-filters" class="title-link" onMouseOver="document.getElementById('ghlink-process-filters-idm2017').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-process-filters-idm2017').style.visibility = 'hidden';">
<div class="title-name">Process filters</div>
<div class="title-anchors"><span id="ghlink-process-filters-idm2017" class="ghlink-after"><a href="#process-filters" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L359" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>If we only want debug messages from a specific process it is possible to do
      this with a filter like this:</p>
      <div class="example example-erl"><pre>%% Initial setup to use a filter for the level filter instead of the primary level
PrimaryLevel = maps:get(level, logger:get_primary_config()),
ok = logger:add_primary_filter(primary_level,
    {fun logger_filters:level/2, {log, gteq, PrimaryLevel}}),
logger:set_primary_config(filter_default, stop),
logger:set_primary_config(level, all),

%% Test that things work as they should
logger:notice("Notice should be logged"),
logger:debug("Should not be logged"),

%% Add the filter to allow PidToLog to send debug events
PidToLog = self(),
PidFilter = fun(LogEvent, _) when PidToLog =:= self() -&gt; LogEvent;
               (_LogEvent, _) -&gt; ignore end,
ok = logger:add_primary_filter(pid, {PidFilter,[]}),
logger:debug("Debug should be logged").</pre></div>
      <p>There is a bit of setup needed to allow filters to decide whether a specific process
      should be allowed to log. This is because the default primary log level is notice and
      it is enforced before the primary filters. So in order for the pid filter to be useful
      we have to raise the primary log level to <span class="code">all</span> and then add a level filter that
      only lets certain messages at or greater than notice through. When the setup is done,
      it is simple to add a filter that allows a certain pid through.
      </p>
      <p>Note that doing the primary log level filtering through a filter and not through
      the level is quite a lot more expensive, so make sure to test that your system can
      handle the extra load before you enable it on a production node.</p>
      <h5>See also</h5>
        
        <ul>
          <li>
<span class="bold_code bc-15"><a href="logger_chapter.html#filters">Filters</a></span> in the Logging User's Guide</li>
          <li><span class="bold_code bc-15"><a href="../../man/logger_filters.html#level-2"><span class="code">logger_filters:level/2</span></a></span></li>
          <li><span class="bold_code bc-15"><a href="../../man/logger.html#set_primary_config-2"><span class="code">logger:set_primary_config/2</span></a></span></li>
        </ul>
      
    
    <h4 id="domains" class="title-link" onMouseOver="document.getElementById('ghlink-domains-idm2035').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-domains-idm2035').style.visibility = 'hidden';">
<div class="title-name">Domains</div>
<div class="title-anchors"><span id="ghlink-domains-idm2035" class="ghlink-after"><a href="#domains" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/kernel/doc/src/logger_cookbook.xml#L400" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>Domains are used to specify which subsystem a certain log event originates from.
      The default handler will by default only log events with the domain <span class="code">[otp]</span> or
      without a domain. If you would like to include SSL log events into the
      default handler log you could do this:</p>
      <div class="example example-erl-repl"><pre>1&gt; logger:add_handler_filter(default,ssl_domain,
  {fun logger_filters:domain/2,{log,sub,[otp,ssl]}}).
2&gt; application:ensure_all_started(ssl).
{ok,[crypto,asn1,public_key,ssl]}
3&gt; ssl:connect("www.erlang.org",443,[{log_level,debug}]).
%% lots of text</pre></div>
      <h5>See also</h5>
        
        <ul>
          <li>
<span class="bold_code bc-15"><a href="logger_chapter.html#filters">Filters</a></span> in the Logging User's Guide</li>
          <li><span class="bold_code bc-15"><a href="../../man/logger_filters.html#domain-2"><span class="code">logger_filters:domain/2</span></a></span></li>
          <li><span class="bold_code bc-15"><a href="../../man/logger.html#set_primary_config-2"><span class="code">logger:set_primary_config/2</span></a></span></li>
        </ul>
      
    
  

</div>
<div class="footer">
<hr>
<p>Copyright © 1997-2024 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script type="text/javascript">window.__otpTopDocDir = '../../js/';</script><script type="text/javascript" src="../../js/highlight.js"></script>
<script type="text/javascript">
_docsearch_version = "24";
</script> 
<script src="/assets/js/doc-search.bundle.js"></script>
</body>
</html>
