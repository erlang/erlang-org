<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:erl="http://erlang.org" xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<link rel="stylesheet" href="../../otp_doc.css" type="text/css">
<meta name="major-vsn" content="24">
<title>Erlang -- Uniform Resource Identifiers</title>
</head>
<body>
<div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../../js/erlresolvelinks.js"></script><script id="js3" type="text/javascript" src="../../../../doc/js/topbar.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function setscrollpos() {
                var objf = document.getElementById('loadscrollpos');
                if (objf) {
                  document.getElementById("leftnav").firstChild.scrollTop = objf.offsetTop - 10;
                }
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //-->
</script><div class="topbar">
<div class="topbar-expand "><button onclick="toggleDisplay();"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="Capa_1" viewBox="0 0 54 54" width="24" height="24"><g><path style="fill:#000000;" d="M27,54c-0.552,0-1-0.448-1-1V8c0-0.552,0.448-1,1-1s1,0.448,1,1v45C28,53.552,27.552,54,27,54z"></path><path style="fill:#000000;" d="M11,25c-0.256,0-0.512-0.098-0.707-0.293c-0.391-0.391-0.391-1.023,0-1.414l16-16                                      c0.391-0.391,1.023-0.391,1.414,0s0.391,1.023,0,1.414l-16,16C11.512,24.902,11.256,25,11,25z"></path><path style="fill:#000000;" d="M43,25c-0.256,0-0.512-0.098-0.707-0.293l-16-16c-0.391-0.391-0.391-1.023,0-1.414                                      s1.023-0.391,1.414,0l16,16c0.391,0.391,0.391,1.023,0,1.414C43.512,24.902,43.256,25,43,25z"></path><path style="fill:#000000;" d="M43,2H11c-0.552,0-1-0.448-1-1s0.448-1,1-1h32c0.552,0,1,0.448,1,1S43.552,2,43,2z"></path></g></svg></button></div>
<div class="topbar-title"><h1 id="Uniform Resource Identifiers">4 
                Uniform Resource Identifiers</h1></div>
<div class="search-expand ">        <button id="docsearch-mobile">
            <svg fill="#000000" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="24" height="24"><path d="M 21 3 C 11.621094 3 4 10.621094 4 20 C 4 29.378906 11.621094 37 21 37 C 24.710938 37 28.140625 35.804688 30.9375 33.78125 L 44.09375 46.90625 L 46.90625 44.09375 L 33.90625 31.0625 C 36.460938 28.085938 38 24.222656 38 20 C 38 10.621094 30.378906 3 21 3 Z M 21 5 C 29.296875 5 36 11.703125 36 20 C 36 28.296875 29.296875 35 21 35 C 12.703125 35 6 28.296875 6 20 C 6 11.703125 12.703125 5 21 5 Z"/></svg>
        </button>
</div>
</div>
<aside class="hide-mobile" id="leftnav"><nav class="leftnav-tube"><div class="erlang-logo-wrapper"><a href="../../index.html"><img alt="Erlang Logo" src="../../erlang-logo.png" class="erlang-logo"></a></div>
<p class="section-title">STDLIB</p>
<p class="section-subtitle">User's Guide</p>
<p class="section-version">Version 3.17.2.4</p>
<ul class="panel-sections">
<li><a href="users_guide.html">User's Guide</a></li>
<li><a href="index.html">Reference Manual</a></li>
<li><a href="notes.html">Release Notes</a></li>
<li><a href="stdlib.pdf">PDF</a></li>
<li><a href="../../index.html">Top</a></li>
</ul>
<div id="docsearch"></div>
<div style="padding-left: 1rem; padding-top: 0.1rem;"><a href="/doc/search?v=24">Paginated Search</a></div>
<ul class="expand-collapse-items">
<li><a href="javascript:openAllFlips()">Expand All</a></li>
<li><a href="javascript:closeAllFlips()">Contract All</a></li>
</ul>
<h3 id="chapters">Chapters</h3>
<ul class="flipMenu" imagePath="../../js/flipmenu">
<li id="no" title="Introduction" expanded="false">Introduction<ul>
<li><a href="introduction.html">
              Top of chapter
            </a></li>
<li title="Scope"><a href="introduction.html#scope">Scope</a></li>
<li title="Prerequisites"><a href="introduction.html#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li id="no" title="The Erlang I/O Protocol" expanded="false">The Erlang I/O Protocol<ul>
<li><a href="io_protocol.html">
              Top of chapter
            </a></li>
<li title="Protocol Basics"><a href="io_protocol.html#protocol-basics">Protocol Basics</a></li>
<li title="Output Requests"><a href="io_protocol.html#output-requests">Output Requests</a></li>
<li title="Input Requests"><a href="io_protocol.html#input-requests">Input Requests</a></li>
<li title="I/O Server Modes"><a href="io_protocol.html#i-o-server-modes">I/O Server Modes</a></li>
<li title="Multiple I/O Requests"><a href="io_protocol.html#multiple-i-o-requests">Multiple I/O Requests</a></li>
<li title="Optional I/O Request"><a href="io_protocol.html#optional-i-o-request">Optional I/O Request</a></li>
<li title="Unimplemented Request Types"><a href="io_protocol.html#unimplemented-request-types">Unimplemented Request Types</a></li>
<li title="An Annotated and Working Example I/O Server"><a href="io_protocol.html#an-annotated-and-working-example-i-o-server">An Annotated and Working Example I/O Server</a></li>
</ul>
</li>
<li id="no" title="Using Unicode in Erlang" expanded="false">Using Unicode in Erlang<ul>
<li><a href="unicode_usage.html">
              Top of chapter
            </a></li>
<li title="Unicode Implementation"><a href="unicode_usage.html#unicode-implementation">Unicode Implementation</a></li>
<li title="Understanding Unicode"><a href="unicode_usage.html#understanding-unicode">Understanding Unicode</a></li>
<li title="What Unicode Is"><a href="unicode_usage.html#what-unicode-is">What Unicode Is</a></li>
<li title="Areas of Unicode Support"><a href="unicode_usage.html#areas-of-unicode-support">Areas of Unicode Support</a></li>
<li title="Standard Unicode Representation"><a href="unicode_usage.html#standard-unicode-representation">Standard Unicode Representation</a></li>
<li title="Basic Language Support"><a href="unicode_usage.html#basic-language-support">Basic Language Support</a></li>
<li title="The Interactive Shell"><a href="unicode_usage.html#the-interactive-shell">The Interactive Shell</a></li>
<li title="Unicode Filenames"><a href="unicode_usage.html#unicode-filenames">Unicode Filenames</a></li>
<li title="Unicode in Environment and Parameters"><a href="unicode_usage.html#unicode-in-environment-and-parameters">Unicode in Environment and Parameters</a></li>
<li title="Unicode-Aware Modules"><a href="unicode_usage.html#unicode-aware-modules">Unicode-Aware Modules</a></li>
<li title="Unicode Data in Files"><a href="unicode_usage.html#unicode-data-in-files">Unicode Data in Files</a></li>
<li title="Summary of Options"><a href="unicode_usage.html#summary-of-options">Summary of Options</a></li>
<li title="Recipes"><a href="unicode_usage.html#recipes">Recipes</a></li>
</ul>
</li>
<li id="loadscrollpos" title="Uniform Resource Identifiers" expanded="true">Uniform Resource Identifiers<ul>
<li><a href="uri_string_usage.html">
              Top of chapter
            </a></li>
<li title="Basics"><a href="uri_string_usage.html#basics">Basics</a></li>
<li title="What is a URI?"><a href="uri_string_usage.html#what-is-a-uri-">What is a URI?</a></li>
<li title="The uri_string module"><a href="uri_string_usage.html#the-uri_string-module">The uri_string module</a></li>
<li title="Percent-encoding"><a href="uri_string_usage.html#percent-encoding">Percent-encoding</a></li>
<li title="Normalization"><a href="uri_string_usage.html#normalization">Normalization</a></li>
<li title="Special considerations"><a href="uri_string_usage.html#special-considerations">Special considerations</a></li>
</ul>
</li>
</ul></nav></aside><div id="content">
<div class="innertube">
<h1 id="Uniform Resource Identifiers">4 Uniform Resource Identifiers</h1>
  
  <h3 id="basics" class="title-link" onMouseOver="document.getElementById('ghlink-basics-idm1200').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-basics-idm1200').style.visibility = 'hidden';">
<div class="title-name">4.1 
        Basics</div>
<div class="title-anchors"><span id="ghlink-basics-idm1200" class="ghlink-after"><a href="#basics" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/stdlib/doc/src/uri_string_usage.xml#L36" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>At the time of writing this document, in October 2020, there are
    two major standards concerning Universal Resource Identifiers and
    Universal Resource Locators:</p>
    <ul>
      <li><p>
	<span class="bold_code bc-20"><a href="https://www.ietf.org/rfc/rfc3986.txt">RFC 3986 - Uniform Resource
      Identifier (URI): Generic Syntax</a></span></p></li>
      <li><p>
	<span class="bold_code bc-20"><a href="https://url.spec.whatwg.org/">WHAT WG URL - Living standard</a></span>
      </p></li>
    </ul>
    <p>
    The former is a classical standard with a proper formal syntax, using the so
    called <span class="bold_code bc-20"><a href="https://www.ietf.org/rfc/rfc2234.txt">Augmented Backus-Naur Form
    (ABNF)</a></span> for describing
    the grammar, while the latter is a living document describing the current pratice,
    that is, how a majority of Web browsers work with URIs. WHAT WG URL is Web focused
    and it has no formal grammar but a plain english description of the algorithms
    that should be followed.</p>
    <p>What is the difference between them, if any? They provide an overlapping
    definition for resource identifiers and they are not compatible.
    The <span class="bold_code bc-18"><a href="../../man/uri_string.html"><span class="code">uri_string</span></a></span> module implements
    <span class="bold_code bc-20"><a href="https://www.ietf.org/rfc/rfc3986.txt">RFC 3986</a></span> and the term URI will
    be used throughout this document. A URI is an identifier, a string of characters
    that identifies a particular resource.</p>
    <p>
    For a more complete problem
    statement regarding the URIs check the
    <span class="bold_code bc-20"><a href="https://tools.ietf.org/html/draft-ruby-url-problem-01">URL Problem
    Statement and Directions</a></span>.</p>
  

  <h3 id="what-is-a-uri-" class="title-link" onMouseOver="document.getElementById('ghlink-what-is-a-uri--idm1218').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-what-is-a-uri--idm1218').style.visibility = 'hidden';">
<div class="title-name">4.2 
        What is a URI?</div>
<div class="title-anchors"><span id="ghlink-what-is-a-uri--idm1218" class="ghlink-after"><a href="#what-is-a-uri-" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/stdlib/doc/src/uri_string_usage.xml#L70" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>Let's start with what it is not. It is not the text that you type in the address
    bar in your Web browser. Web browsers do all possible heuristics to convert the
    input into a valid URI that could be sent over the network.</p>
    <p>A URI is an identifier consisting of a sequence of characters matching the syntax
    rule named <span class="code">URI</span> in
    <span class="bold_code bc-20"><a href="https://www.ietf.org/rfc/rfc3986.txt">RFC 3986</a></span>.
    </p>
    <p>It is crucial to clarify that a <i>character</i> is a symbol that is displayed on
    a terminal or written to paper and should not be confused with its internal
    representation.</p>
    <p>A URI more specifically, is a sequence of characters from a
    subset of the US ASCII character set. The generic URI syntax consists of a
    hierarchical sequence of components referred to as the scheme, authority,
    path, query, and fragment. There is a formal description for
    each of these components in
    <span class="bold_code bc-20"><a href="https://www.ietf.org/rfc/rfc2234.txt">ABNF</a></span> notation in
    <span class="bold_code bc-20"><a href="https://www.ietf.org/rfc/rfc3986.txt">RFC 3986</a></span>:</p>
    <div class="example"><pre>
    URI         = scheme ":" hier-part [ "?" query ] [ "#" fragment ]
    hier-part   = "//" authority path-abempty
                   / path-absolute
                   / path-rootless
                   / path-empty
    scheme      = ALPHA *( ALPHA / DIGIT / "+" / "-" / "." )
    authority   = [ userinfo "@" ] host [ ":" port ]
    userinfo    = *( unreserved / pct-encoded / sub-delims / ":" )

    reserved    = gen-delims / sub-delims
    gen-delims  = ":" / "/" / "?" / "#" / "[" / "]" / "@"
    sub-delims  = "!" / "$" / "&amp;" / "'" / "(" / ")"
                / "*" / "+" / "," / ";" / "="

    unreserved  = ALPHA / DIGIT / "-" / "." / "_" / "~"
    </pre></div>
  

  <h3 id="the-uri_string-module" class="title-link" onMouseOver="document.getElementById('ghlink-the-uri_string-module-idm1230').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-the-uri_string-module-idm1230').style.visibility = 'hidden';">
<div class="title-name">4.3 
        The uri_string module</div>
<div class="title-anchors"><span id="ghlink-the-uri_string-module-idm1230" class="ghlink-after"><a href="#the-uri_string-module" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/stdlib/doc/src/uri_string_usage.xml#L108" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>As producing and consuming standard URIs can get quite complex, Erlang/OTP
    provides
    a module, <span class="bold_code bc-18"><a href="../../man/uri_string.html"><span class="code">uri_string</span></a></span>, to handle all the most difficult operations such as parsing,
    recomposing, normalizing and resolving URIs against a base URI.
    </p>
    <p>The API functions in <span class="bold_code bc-18"><a href="../../man/uri_string.html"><span class="code">uri_string</span></a></span>
    work on two basic data types
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#type-uri_string"><span class="code">uri_string()</span></a></span> and
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#type-uri_map"><span class="code">uri_map()</span></a></span>.
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#type-uri_string"><span class="code">uri_string()</span></a></span> represents a
    standard URI, while
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#type-uri_map"><span class="code">uri_map()</span></a></span> is a wider datatype,
    that can represent URI components using
    <span class="bold_code bc-15"><a href="unicode_usage.html#what-unicode-is">Unicode</a></span> characters.
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#type-uri_map"><span class="code">uri_map()</span></a></span>
    is a convenient choice for enabling
    operations such as producing standard compliant URIs out of components that have
    special or <span class="bold_code bc-15"><a href="unicode_usage.html#what-unicode-is">Unicode</a></span>
    characters. It is easier to explain this by an example.
    </p>
    <p>Let's say that we would like to create the following URI and send it over the
    network: <span class="code">http://cities/örebro?foo bar</span>. This is not a valid URI as it contains
    characters that are not allowed in a URI such as "ö" and the space. We can verify
    this by parsing the URI:
  </p>
  <div class="example"><pre>
  1&gt; uri_string:parse("http://cities/örebro?foo bar").
  {error,invalid_uri,":"}
  </pre></div>
  <p>The URI parser tries all possible combinations to interpret the input and fails
  at the last attempt when it encounters the colon character <span class="code">":"</span>. Note, that
  the inital fault occurs when the parser attempts to interpret the character
  <span class="code">"ö"</span> and after a failure back-tracks to the point where it has another
  possible parsing alternative.</p>
  <p>The proper way to solve this problem is to use
  <span class="bold_code bc-15"><a href="../../man/uri_string.html#recompose-1"><span class="code">uri_string:recompose/1</span></a></span>
  with a <span class="bold_code bc-15"><a href="../../man/uri_string.html#type-uri_map"><span class="code">uri_map()</span></a></span> as input:</p>
  <div class="example"><pre>
  2&gt; uri_string:recompose(#{scheme =&gt; "http", host =&gt; "cities", path =&gt; "/örebro",
  query =&gt; "foo bar"}).
  "http://cities/%C3%B6rebro?foo%20bar"
  </pre></div>
  <p>The result is a valid URI where all the special characters are encoded as defined
  by the standard. Applying
  <span class="bold_code bc-15"><a href="../../man/uri_string.html#parse-1"><span class="code">uri_string:parse/1</span></a></span> and
  <span class="bold_code bc-15"><a href="../../man/uri_string.html#percent_decode-1"><span class="code">uri_string:percent_decode/1</span></a></span>
  on the URI returns the original input:
  </p>
  <div class="example"><pre>
  3&gt; uri_string:percent_decode(uri_string:parse("http://cities/%C3%B6rebro?foo%20bar")).
  #{host =&gt; "cities",path =&gt; "/örebro",query =&gt; "foo bar",
  scheme =&gt; "http"}
  </pre></div>
  <p>This symmetric property is heavily used in our property test suite.
  </p>
  

  <h3 id="percent-encoding" class="title-link" onMouseOver="document.getElementById('ghlink-percent-encoding-idm1269').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-percent-encoding-idm1269').style.visibility = 'hidden';">
<div class="title-name">4.4 
        Percent-encoding</div>
<div class="title-anchors"><span id="ghlink-percent-encoding-idm1269" class="ghlink-after"><a href="#percent-encoding" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/stdlib/doc/src/uri_string_usage.xml#L167" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>As you have seen in the previous chapter, a standard URI can only contain a strict
    subset of the US ASCII character set, moreover the allowed set of characters is not
    the same in the different URI components. Percent-encoding is a mechanism to
    represent a data octet in a component when that octet's corresponding character
    is outside of
    the allowed set or is being used as a delimiter. This is what you see when <span class="code">"ö"</span>
    is encoded as <span class="code">%C3%B6</span> and <span class="code">space</span> as <span class="code">%20</span>.
    Most of the API functions are
    expecting UTF-8 encoding when handling percent-encoded triplets. The UTF-8 encoding
    of the <span class="bold_code bc-15"><a href="unicode_usage.html#what-unicode-is">Unicode</a></span>
    character <span class="code">"ö"</span> is two octets: <span class="code">OxC3 0xB6</span>.
    The character <span class="code">space</span> is in the first 128 characters of
    <span class="bold_code bc-15"><a href="unicode_usage.html#what-unicode-is">Unicode</a></span> and it is encoded
    using a single octet <span class="code">0x20</span>.</p>
    <div class="note">
<div class="label">Note</div>
<div class="content"><p><p><span class="bold_code bc-15"><a href="unicode_usage.html#what-unicode-is">Unicode</a></span>
    is backward compatible with ASCII, the encoding of the first 128
    characters is the same binary value as in ASCII.
    </p></p></div>
</div>
    <p><a name="percent_encoding"></a>
    It is a major source of confusion exactly which characters will be
    percent-encoded. In order to make it easier to answer this question the library
    provides a utility function,
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#allowed_characters-0"><span class="code">uri_string:allowed_characters/0
    </span></a></span>,
    that lists the allowed set of characters in each major
    URI component, and also in the most important standard character sets.
    </p>
    <div class="example"><pre>
    1&gt; uri_string:allowed_characters().
    {scheme,
     "+-.0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"},
    {userinfo,
     "!$%&amp;'()*+,-.0123456789:;=ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~"},
    {host,
     "!$&amp;'()*+,-.0123456789:;=ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~"},
    {ipv4,".0123456789"},
    {ipv6,".0123456789:ABCDEFabcdef"},
    {regname,
     "!$%&amp;'()*+,-.0123456789;=ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~"},
    {path,
     "!$%&amp;'()*+,-./0123456789:;=@ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~"},
    {query,
     "!$%&amp;'()*+,-./0123456789:;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~"},
    {fragment,
     "!$%&amp;'()*+,-./0123456789:;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~"},
    {reserved,"!#$&amp;'()*+,/:;=?@[]"},
    {unreserved,
     "-.0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~"}] 
    </pre></div>
    <p>If a URI component has a character that is not allowed, it will be
    percent-encoded when the URI is produced:
    </p>
    <div class="example"><pre>
    2&gt; uri_string:recompose(#{scheme =&gt; "https", host =&gt; "local#host", path =&gt; ""}).
    "https://local%23host"
    </pre></div>
    <p>Consuming a URI containing percent-encoded triplets can take many steps. The
    following example shows how to handle an input URI that is not normalized and
    contains multiple percent-encoded triplets.
    First, the input <span class="bold_code bc-15"><a href="../../man/uri_string.html#type-uri_string"><span class="code">uri_string()</span></a></span>
    is to be parsed into a <span class="bold_code bc-15"><a href="../../man/uri_string.html#type-uri_map"><span class="code">uri_map()</span></a></span>.
    The parsing only splits the URI into its components without doing any decoding:
    </p>
    <div class="example"><pre>
    3&gt; uri_string:parse("http://%6C%6Fcal%23host/%F6re%26bro%20").
    #{host =&gt; "%6C%6Fcal%23host",path =&gt; "/%F6re%26bro%20",
      scheme =&gt; "http"}}
    </pre></div>
    <p>The input is a valid URI but how can you decode those
    percent-encoded octets? You can try to normalize the input with
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#normalize-1"><span class="code">uri_string:normalize/1</span></a></span>. The
    normalize operation decodes those
    percent-encoded triplets that correspond to a character in the unreserved set.
    Normalization is a safe, idempotent operation that converts a URI into its
    canonical form:</p>
    <div class="example"><pre>
    4&gt; uri_string:normalize("http://%6C%6Fcal%23host/%F6re%26bro%20").
    "http://local%23host/%F6re%26bro%20"
    5&gt; uri_string:normalize("http://%6C%6Fcal%23host/%F6re%26bro%20", [return_map]).
    #{host =&gt; "local%23host",path =&gt; "/%F6re%26bro%20",
      scheme =&gt; "http"}
    </pre></div>
    <p>There are still a few percent-encoded triplets left in the output. At this point,
    when the URI is already parsed, it is safe to apply application specific decoding on
    the remaining character triplets. Erlang/OTP provides a function,
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#percent_decode-1"><span class="code">uri_string:percent_decode/1</span></a></span>
    for raw percent decoding
    that you can use on the host and path components, or on the whole map:
    </p>
    <div class="example"><pre>
    6&gt; uri_string:percent_decode("local%23host").
    "local#host"
    7&gt; uri_string:percent_decode("/%F6re%26bro%20").
    {error,invalid_utf8,&lt;&lt;"/öre&amp;bro "&gt;&gt;}
    8&gt; uri_string:percent_decode(#{host =&gt; "local%23host",path =&gt; "/%F6re%26bro%20",
    scheme =&gt; "http"}).
    {error,{invalid,{path,{invalid_utf8,&lt;&lt;"/öre&amp;bro "&gt;&gt;}}}}
    </pre></div>
    <p>The <span class="code">host</span> was successfully decoded but the path contains at least one
    character with
    non-UTF-8 encoding. In order to be able to decode this, you have to make assumptions
    about the encoding used in these triplets. The most obvious choice is
    <i>latin-1</i>, so you can try
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#transcode-2"><span class="code">uri_string:transcode/2</span></a></span>, to
    transcode the path to UTF-8 and run the percent-decode operation on the
    transcoded string:
    </p>
    <div class="example"><pre>
    9&gt; uri_string:transcode("/%F6re%26bro%20", [{in_encoding, latin1}]).
    "/%C3%B6re%26bro%20"
    10&gt; uri_string:percent_decode("/%C3%B6re%26bro%20").
    "/öre&amp;bro "
    </pre></div>
    <p>It is important to emphasize that it is not safe to apply
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#percent_decode-1"><span class="code">uri_string:percent_decode/1</span></a></span>
    directly on an input URI:
    </p>
    <div class="example"><pre>
    11&gt; uri_string:percent_decode("http://%6C%6Fcal%23host/%C3%B6re%26bro%20").
    "http://local#host/öre&amp;bro "
    12&gt; uri_string:parse("http://local#host/öre&amp;bro ").
    {error,invalid_uri,":"}
    </pre></div>
    <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>Percent-encoding is implemented in
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#recompose-1"><span class="code">uri_string:recompose/1</span></a></span>
    and it happens when converting a
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#type-uri_map"><span class="code">uri_map()</span></a></span>
    into a <span class="bold_code bc-15"><a href="../../man/uri_string.html#type-uri_string"><span class="code">uri_string()</span></a></span>.
    There is no equivalent to a raw percent-encoding function as percent-encoding
    shall be applied on the component level using different sets of allowed characters.
    Applying percent-encoding directly on an input URI would not be safe just as in
    the case of
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#percent_decode-1"><span class="code">uri_string:percent_decode/1</span></a></span>,
    the output could be an invalid URI.
    </p>
    </p></div>
</div>
  

  <h3 id="normalization" class="title-link" onMouseOver="document.getElementById('ghlink-normalization-idm1326').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-normalization-idm1326').style.visibility = 'hidden';">
<div class="title-name">4.5 
        Normalization</div>
<div class="title-anchors"><span id="ghlink-normalization-idm1326" class="ghlink-after"><a href="#normalization" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/stdlib/doc/src/uri_string_usage.xml#L307" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>Normalization is the operation of converting the input URI into a <i>canonical</i>
    form and keeping the reference to the same underlying resource. The most common
    application of normalization is determining whether two URIs are equivalent
    without accessing their referenced resources.</p>
    <p>Normalization has 6 distinct steps. First the input URI is parsed into an
    intermediate form that can handle
    <span class="bold_code bc-15"><a href="unicode_usage.html#what-unicode-is">Unicode</a></span> characters.
    This datatype is the
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#type-uri_map"><span class="code">uri_map()</span></a></span>, that can hold the
    components of the URI in map elements of type
    <span class="bold_code bc-15"><a href="../../man/unicode.html#type-chardata"><span class="code">unicode:chardata()</span></a></span>.
    After having the intermediate form, a sequence of
    normalization algorithms are applied to the individual URI components:</p>
    <dl>
      <dt><strong>Case normalization</strong></dt>
      <dd>
	<p>Converts the <span class="code">scheme</span> and <span class="code">host</span> components
	to lower case as they are not case sensitive.</p>
      </dd>
      <dt><strong>Percent-encoding normalization</strong></dt>
      <dd>
	<p>Decodes percent-encoded triplets that
	correspond to characters in the unreserved set.</p>
      </dd>
      <dt><strong>Scheme-based normalization</strong></dt>
      <dd>
	<p>Applying rules for the schemes http, https,
	ftp, ssh, sftp and tftp.</p>
      </dd>
      <dt><strong>Path segment normalization</strong></dt>
      <dd>
	<p>Converts the path into a canonical form.</p>
      </dd>
    </dl>
    <p>After these steps, the intermediate data structure, an
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#type-uri_map"><span class="code">uri_map()</span></a></span>,
    is fully normalized. The last step is applying
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#recompose-1"><span class="code">uri_string:recompose/1</span></a></span>
    that converts the intermediate structure into a valid canonical URI string.</p>
    <p>Notice the order, the
    <span class="bold_code bc-15"><a href="../../man/uri_string.html#normalize-2"><span class="code">uri_string:normalize(URIMap, [return_map])</span></a></span> that we
    used many times in this user guide is a shortcut in the normalization process
    returning the intermediate datastructure, and allowing us to inspect and apply
    further decoding on the remaining percent-encoded triplets.</p>
    <div class="example"><pre>
    13&gt; uri_string:normalize("hTTp://LocalHost:80/%c3%B6rebro/a/../b").
    "http://localhost/%C3%B6rebro/b"
    14&gt; uri_string:normalize("hTTp://LocalHost:80/%c3%B6rebro/a/../b", [return_map]).
    #{host =&gt; "localhost",path =&gt; "/%C3%B6rebro/b",
      scheme =&gt; "http"}
    </pre></div>
  

 <h3 id="special-considerations" class="title-link" onMouseOver="document.getElementById('ghlink-special-considerations-idm1360').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-special-considerations-idm1360').style.visibility = 'hidden';">
<div class="title-name">4.6 
        Special considerations</div>
<div class="title-anchors"><span id="ghlink-special-considerations-idm1360" class="ghlink-after"><a href="#special-considerations" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/stdlib/doc/src/uri_string_usage.xml#L362" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
   
   <p>The current URI implementation provides support for producing and consuming
   standard URIs. The API is not meant to be directly exposed in a Web
   browser's address bar where users can basically enter free text. Application
   designers shall implement proper heuristics to map the input into a parsable URI.</p>
 

</div>
<div class="footer">
<hr>
<p>Copyright © 1997-2024 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script type="text/javascript">window.__otpTopDocDir = '../../js/';</script><script type="text/javascript" src="../../js/highlight.js"></script>
<script type="text/javascript">
_docsearch_version = "24";
</script> 
<script src="/assets/js/doc-search.bundle.js"></script>
</body>
</html>
