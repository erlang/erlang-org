<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:erl="http://erlang.org" xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<link rel="stylesheet" href="../../otp_doc.css" type="text/css">
<meta name="major-vsn" content="24">
<title>Erlang -- Testing and tools</title>
</head>
<body>
<div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../../js/erlresolvelinks.js"></script><script id="js3" type="text/javascript" src="../../../../doc/js/topbar.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function setscrollpos() {
                var objf = document.getElementById('loadscrollpos');
                if (objf) {
                  document.getElementById("leftnav").firstChild.scrollTop = objf.offsetTop - 10;
                }
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //-->
</script><div class="topbar">
<div class="topbar-expand "><button onclick="toggleDisplay();"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="Capa_1" viewBox="0 0 54 54" width="24" height="24"><g><path style="fill:#000000;" d="M27,54c-0.552,0-1-0.448-1-1V8c0-0.552,0.448-1,1-1s1,0.448,1,1v45C28,53.552,27.552,54,27,54z"></path><path style="fill:#000000;" d="M11,25c-0.256,0-0.512-0.098-0.707-0.293c-0.391-0.391-0.391-1.023,0-1.414l16-16                                      c0.391-0.391,1.023-0.391,1.414,0s0.391,1.023,0,1.414l-16,16C11.512,24.902,11.256,25,11,25z"></path><path style="fill:#000000;" d="M43,25c-0.256,0-0.512-0.098-0.707-0.293l-16-16c-0.391-0.391-0.391-1.023,0-1.414                                      s1.023-0.391,1.414,0l16,16c0.391,0.391,0.391,1.023,0,1.414C43.512,24.902,43.256,25,43,25z"></path><path style="fill:#000000;" d="M43,2H11c-0.552,0-1-0.448-1-1s0.448-1,1-1h32c0.552,0,1,0.448,1,1S43.552,2,43,2z"></path></g></svg></button></div>
<div class="topbar-title"><h1 id="Testing and tools">9Â 
                Testing and tools</h1></div>
<div class="search-expand ">        <button id="docsearch-mobile">
            <svg fill="#000000" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="24" height="24"><path d="M 21 3 C 11.621094 3 4 10.621094 4 20 C 4 29.378906 11.621094 37 21 37 C 24.710938 37 28.140625 35.804688 30.9375 33.78125 L 44.09375 46.90625 L 46.90625 44.09375 L 33.90625 31.0625 C 36.460938 28.085938 38 24.222656 38 20 C 38 10.621094 30.378906 3 21 3 Z M 21 5 C 29.296875 5 36 11.703125 36 20 C 36 28.296875 29.296875 35 21 35 C 12.703125 35 6 28.296875 6 20 C 6 11.703125 12.703125 5 21 5 Z"/></svg>
        </button>
</div>
</div>
<aside class="hide-mobile" id="leftnav"><nav class="leftnav-tube"><div class="erlang-logo-wrapper"><a href="../../index.html"><img alt="Erlang Logo" src="../../erlang-logo.png" class="erlang-logo"></a></div>
<p class="section-title">Megaco/H.248</p>
<p class="section-subtitle">User's Guide</p>
<p class="section-version">Version 4.3</p>
<ul class="panel-sections">
<li><a href="users_guide.html">User's Guide</a></li>
<li><a href="index.html">Reference Manual</a></li>
<li><a href="notes.html">Release Notes</a></li>
<li><a href="megaco.pdf">PDF</a></li>
<li><a href="../../index.html">Top</a></li>
</ul>
<div id="docsearch"></div>
<div style="padding-left: 1rem; padding-top: 0.1rem;"><a href="/doc/search?v=24">Paginated Search</a></div>
<ul class="expand-collapse-items">
<li><a href="javascript:openAllFlips()">Expand All</a></li>
<li><a href="javascript:closeAllFlips()">Contract All</a></li>
</ul>
<h3 id="chapters">Chapters</h3>
<ul class="flipMenu" imagePath="../../js/flipmenu">
<li id="no" title="Introduction" expanded="false">Introduction<ul>
<li><a href="megaco_intro.html">
              Top of chapter
            </a></li>
<li title="Scope and Purpose"><a href="megaco_intro.html#scope-and-purpose">Scope and Purpose</a></li>
<li title="Prerequisites"><a href="megaco_intro.html#prerequisites">Prerequisites</a></li>
<li title="About This Manual"><a href="megaco_intro.html#about-this-manual">About This Manual</a></li>
<li title="Where to Find More Information"><a href="megaco_intro.html#where-to-find-more-information">Where to Find More Information</a></li>
</ul>
</li>
<li id="no" title="Architecture" expanded="false">Architecture<ul>
<li><a href="megaco_architecture.html">
              Top of chapter
            </a></li>
<li title="Network view"><a href="megaco_architecture.html#network-view">Network view</a></li>
<li title="General"><a href="megaco_architecture.html#general">General</a></li>
<li title="Single node config"><a href="megaco_architecture.html#single-node-config">Single node config</a></li>
<li title="Distributed config"><a href="megaco_architecture.html#distributed-config">Distributed config</a></li>
<li title="Message round-trip call flow"><a href="megaco_architecture.html#message-round-trip-call-flow">Message round-trip call flow</a></li>
</ul>
</li>
<li id="no" title="Running the stack" expanded="false">Running the stack<ul>
<li><a href="megaco_run.html">
              Top of chapter
            </a></li>
<li title="Starting"><a href="megaco_run.html#starting">Starting</a></li>
<li title="MGC startup call flow"><a href="megaco_run.html#mgc-startup-call-flow">MGC startup call flow</a></li>
<li title="MG startup call flow"><a href="megaco_run.html#mg-startup-call-flow">MG startup call flow</a></li>
<li title="Configuring the Megaco stack"><a href="megaco_run.html#configuring-the-megaco-stack">Configuring the Megaco stack</a></li>
<li title="Initial configuration"><a href="megaco_run.html#initial-configuration">Initial configuration</a></li>
<li title="Changing the configuration"><a href="megaco_run.html#changing-the-configuration">Changing the configuration</a></li>
<li title="The transaction sender"><a href="megaco_run.html#the-transaction-sender">The transaction sender</a></li>
<li title="Segmentation of transaction replies"><a href="megaco_run.html#segmentation-of-transaction-replies">Segmentation of transaction replies</a></li>
</ul>
</li>
<li id="no" title="Internal form and its encodings" expanded="false">Internal form and its encodings<ul>
<li><a href="megaco_encode.html">
              Top of chapter
            </a></li>
<li title="Internal form of messages"><a href="megaco_encode.html#internal-form-of-messages">Internal form of messages</a></li>
<li title="The different encodings"><a href="megaco_encode.html#the-different-encodings">The different encodings</a></li>
<li title="Configuration of Erlang distribution encoding module"><a href="megaco_encode.html#configuration-of-erlang-distribution-encoding-module">Configuration of Erlang distribution encoding module</a></li>
<li title="Configuration of text encoding module(s)"><a href="megaco_encode.html#configuration-of-text-encoding-module-s-">Configuration of text encoding module(s)</a></li>
<li title="Configuration of binary encoding module(s)"><a href="megaco_encode.html#configuration-of-binary-encoding-module-s-">Configuration of binary encoding module(s)</a></li>
<li title="Handling megaco versions"><a href="megaco_encode.html#handling-megaco-versions">Handling megaco versions</a></li>
<li title="Encoder callback functions"><a href="megaco_encode.html#encoder-callback-functions">Encoder callback functions</a></li>
</ul>
</li>
<li id="no" title="Transport mechanisms" expanded="false">Transport mechanisms<ul>
<li><a href="megaco_transport_mechanisms.html">
              Top of chapter
            </a></li>
<li title="Callback interface"><a href="megaco_transport_mechanisms.html#callback-interface">Callback interface</a></li>
<li title="Examples"><a href="megaco_transport_mechanisms.html#examples">Examples</a></li>
</ul>
</li>
<li id="no" title="Implementation examples" expanded="false">Implementation examples<ul>
<li><a href="megaco_examples.html">
              Top of chapter
            </a></li>
<li title="A simple Media Gateway Controller"><a href="megaco_examples.html#a-simple-media-gateway-controller">A simple Media Gateway Controller</a></li>
<li title="A simple Media Gateway"><a href="megaco_examples.html#a-simple-media-gateway">A simple Media Gateway</a></li>
</ul>
</li>
<li id="no" title="Megaco mib" expanded="false">Megaco mib<ul>
<li><a href="megaco_mib.html">
              Top of chapter
            </a></li>
<li title="Intro"><a href="megaco_mib.html#intro">Intro</a></li>
<li title="Statistics counters"><a href="megaco_mib.html#statistics-counters">Statistics counters</a></li>
<li title="Distribution"><a href="megaco_mib.html#distribution">Distribution</a></li>
</ul>
</li>
<li id="no" title="Performance comparison" expanded="false">Performance comparison<ul>
<li><a href="megaco_performance.html">
              Top of chapter
            </a></li>
<li title="Comparison of encoder/decoders"><a href="megaco_performance.html#comparison-of-encoder-decoders">Comparison of encoder/decoders</a></li>
<li title="Description of encoders/decoders"><a href="megaco_performance.html#description-of-encoders-decoders">Description of encoders/decoders</a></li>
<li title="Setup"><a href="megaco_performance.html#setup">Setup</a></li>
<li title="Summary"><a href="megaco_performance.html#summary">Summary</a></li>
</ul>
</li>
<li id="loadscrollpos" title="Testing and tools" expanded="true">Testing and tools<ul>
<li><a href="megaco_debug.html">
              Top of chapter
            </a></li>
<li title="Tracing"><a href="megaco_debug.html#tracing">Tracing</a></li>
<li title="Measurement and transformation"><a href="megaco_debug.html#measurement-and-transformation">Measurement and transformation</a></li>
</ul>
</li>
</ul></nav></aside><div id="content">
<div class="innertube">
<h1 id="Testing and tools">9Â Testing and tools</h1>
  

  <h3 id="tracing" class="title-link" onMouseOver="document.getElementById('ghlink-tracing-idm830').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-tracing-idm830').style.visibility = 'hidden';">
<div class="title-name">9.1Â 
        Tracing</div>
<div class="title-anchors"><span id="ghlink-tracing-idm830" class="ghlink-after"><a href="#tracing" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/megaco/doc/src/megaco_debug.xml#L36" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>We have instrumented our code in order to enable
      tracing. Running the application with tracing deactivated,
      causes a negligible performance overhead (an external call to a
      function which returns an atom). Activation of tracing does not
      require any recompilation of the code, since we rely on
      Erlang/OTP's built in support for dynamic trace activation. In
      our case tracing of calls to a given external function.</p>
    <p>Event traces can be viewed in a generic message sequence chart
      tool, <span class="code">et</span>, or as standard output (events are written to stdio). </p>
    <p>See <span class="bold_code bc-15"><a href="../../man/megaco.html#enable_trace">enable_trace</a></span>, 
      <span class="bold_code bc-15"><a href="../../man/megaco.html#disable_trace">disable_trace</a></span> and
      <span class="bold_code bc-15"><a href="../../man/megaco.html#set_trace">set_trace</a></span> for
      more info. </p>
  

  <h3 id="measurement-and-transformation" class="title-link" onMouseOver="document.getElementById('ghlink-measurement-and-transformation-idm839').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-measurement-and-transformation-idm839').style.visibility = 'hidden';">
<div class="title-name">9.2Â 
        Measurement and transformation</div>
<div class="title-anchors"><span id="ghlink-measurement-and-transformation-idm839" class="ghlink-after"><a href="#measurement-and-transformation" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/megaco/doc/src/megaco_debug.xml#L53" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>We have included some simple tool(s) for codec measurement (meas),
      performance tests (mstone1 and mstone2) and message transformation.</p>
    <p>The tool(s) are located in the example/meas directory.</p>

    <h4 id="requirement" class="title-link" onMouseOver="document.getElementById('ghlink-requirement-idm843').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-requirement-idm843').style.visibility = 'hidden';">
<div class="title-name">Requirement</div>
<div class="title-anchors"><span id="ghlink-requirement-idm843" class="ghlink-after"><a href="#requirement" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/megaco/doc/src/megaco_debug.xml#L59" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <ul>
        <li>
          <p>Erlang/OTP, version 24.2 or later.</p>
        </li>
        <li>
          <p>Version 4.2 or later of <strong>this</strong> application.</p>
        </li>
        <li>
          <p>Version 5.0.17 or later of the <strong>asn1</strong> application. </p>
        </li>
        <li>
          <p>The flex libraries. Without it, the flex powered codecs cannot 
            be used.</p>
        </li>
      </ul>
    

    <h4 id="meas-results" class="title-link" onMouseOver="document.getElementById('ghlink-meas-results-idm856').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-meas-results-idm856').style.visibility = 'hidden';">
<div class="title-name">Meas results</div>
<div class="title-anchors"><span id="ghlink-meas-results-idm856" class="ghlink-after"><a href="#meas-results" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/megaco/doc/src/megaco_debug.xml#L78" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>The results from the measurement run (meas) is four 
        excel-compatible textfiles: </p>
      <ul>
        <li>
          <p>decode_time.xls  -&gt; Decoding result</p>
        </li>
        <li>
          <p>encode_time.xls  -&gt; Encoding result</p>
        </li>
        <li>
          <p>total_time.xls   -&gt; Total (Decoding+encoding) result</p>
        </li>
        <li>
          <p>message_size.xls -&gt; Message size</p>
        </li>
      </ul>
    

    <h4 id="instruction" class="title-link" onMouseOver="document.getElementById('ghlink-instruction-idm868').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-instruction-idm868').style.visibility = 'hidden';">
<div class="title-name">Instruction</div>
<div class="title-anchors"><span id="ghlink-instruction-idm868" class="ghlink-after"><a href="#instruction" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/megaco/doc/src/megaco_debug.xml#L98" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>The tool contain four things:
        </p>
      <ul>
        <li>
          <p>The transformation module</p>
        </li>
        <li>
          <p>The measurement (meas) module(s)</p>
        </li>
        <li>
          <p>The mstone (mstone1 and mstone2) module(s)</p>
        </li>
        <li>
          <p>The basic message file</p>
        </li>
      </ul>

      <h5>Message Transformation</h5>
        
        <p>The messages used by the different tools are contained in 
          single message package file (see below for more info). The messages
          in this file is encoded with just one codec. During 
          measurement initiation, the messages are read and then transformed to all
          codec formats used in the measurement. </p>
        <p>The message transformation is done by the transformation module.
          It is used to transform a set of messages encoded with one codec 
          into the other base codec's.</p>
      

      <h5>Measurement(s)</h5>
        
        <p>There are two different measurement tools: </p>
        <ul>
          <li>
            <p><strong>meas</strong>: </p>
            <p>Used to perform codec measurements. That is, to see what 
              kind of performance can be expected by the different codecs 
              provided by the megaco application. </p>
            <p>The measurement is done by iterating over the decode/encode 
              function for approx 2 seconds per message and counting 
              the number of decodes/encodes.</p>
            <p>Is best run by modifying the meas.sh.skel skeleton script
              provided by the tool.</p>
            <p>To run it manually do the following: </p>
              <div class="example example-none"><pre>        % erl -pa &lt;path-megaco-ebin-dir&gt; -pa &lt;path-to-meas-module-dir&gt;
        Erlang (BEAM) emulator version 5.6 [source]

        Eshell V12.2  (abort with ^G)
        1&gt; megaco_codec_meas:start().
        ...
        2&gt; halt().</pre></div>
            <p>or to make it even easier, assuming a measure shall be 
              done on all the codecs (as above):</p>
              <div class="example example-none"><pre>        % erl -noshell -pa &lt;path-megaco-ebin-dir&gt; \\
              -pa &lt;path-to-meas-module-dir&gt; \\
              -s megaco_codec_meas -s init stop</pre></div>
            <p>When run as above (this will take some time), the measurement 
              process is done as follows:</p>
        <div class="example"><pre>
For each codec:
    For each message:
        Read the message from the file
            Detect message version
            Measure decode
                Measure encode
          Write results, encode, decode and total, to file
        </pre></div>
          </li>

          <li>
            <p><strong>mstone1 and mstone2</strong>: </p>
            <p>These are two different SMP performance monitoring tool(s). </p>
            <p><strong>mstone1</strong> creates a process for each codec config supported by 
              the megaco application and let them run for a specific 
              time (all at the same time), encoding and decoding 
              megaco messages. The number of messages processed in total 
              is the mstone1(1) value. </p>
            <p>There are different ways to run the mstone1 tool, e.g. with or without 
              the use of drivers, with <strong>only</strong> flex-empowered configs. </p>
            <p>Is best run by modifying the mstone1.sh.skel skeleton script
              provided by the tool.</p>
            <p>The <strong>mstone2</strong> is similar to the <strong>mstone1</strong> tool,
              but in this case, each created process makes only <strong>one</strong> run 
              through the messages and then exits. A soon as a process exits,
              a new process (with the same config and messages) is created to takes 
              its place. 
              The number of messages processed in total 
              is the mstone2(1) value. </p>
          </li>
        </ul>

        <p>Both these tools use the message package (time_test.msgs) provided
          with the tool(s), although it can run on any message package as long as
          it has the same structure. </p>
      

      <h5>Message package file</h5>
        
        <p>This is simply an erlang compatible text-file with the following 
          structure: <span class="code">{codec_name(), messages_list()}</span>. </p>

<div class="example"><pre>
codec_name() = pretty | compact | ber | per | erlang      (how the messages are encoded)
messages_list() = [{message_name(), message()}]
message_name() = atom()
message() = binary()
</pre></div>

        <p>The codec name is the name of the codec with which all messages in
          the <span class="code">message_list()</span> has been encoded. </p>

        <p>This file can be <span class="code">exported</span> to a file structure by calling the 
          <span class="bold_code bc-15"><a href="../../man/megaco_codec_transform.html#export_messages">export_messages</a></span>
          function. This can be usefull if a measurement shall be done with
          an external tool. Exporting the messages creates a directory tree 
          with the following structure:
          </p>
        <div class="example example-none"><pre>&lt;message package&gt;/pretty/&lt;message-files&gt;
                  compact/
                  per/
                  ber/&lt;message-files&gt;
                  erlang/</pre></div>
        <p>The file includes both version 1, 2 and version 3 messages.</p>
      
    

    <h4 id="notes" class="title-link" onMouseOver="document.getElementById('ghlink-notes-idm926').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-notes-idm926').style.visibility = 'hidden';">
<div class="title-name">Notes</div>
<div class="title-anchors"><span id="ghlink-notes-idm926" class="ghlink-after"><a href="#notes" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/megaco/doc/src/megaco_debug.xml#L232" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      

      <h5>Binary codecs</h5>
        
        <p>There are two basic ways to use the binary encodings: 
          With package related name and termination id transformation
          (the 'native' encoding config) or without. This transformation 
          converts package related names and termination id's to a more 
          convenient internal form (equivalent with the decoded text message).</p>
        <p>The transformation is done _after_ the actual decode has been 
          done.</p>
        <p>Therefor in the tests, binary codecs are tested with two 
          different encoding configs to determine exactly how the
	  different options effect the performance:
	  with transformation ([]) and
	  without transformation ([native]).</p>
      

      <h5>Included test messages</h5>
        
        <p>Some of these messages are ripped from the call flow examples 
          in an old version of the RFC and others are created to test
          a specific feature of megaco. </p>
      

      <h5>Measurement tool directory name</h5>
        
        <p>Be sure <strong>not</strong> no name the directory containing the measurement
          binaries starting with 'megaco-', e.g. megaco-meas. This will
          confuse the erlang application loader (erlang applications
          are named, e.g. megaco-5.2).</p>
      
    
  
</div>
<div class="footer">
<hr>
<p>Copyright Â© 2000-2024 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script type="text/javascript">window.__otpTopDocDir = '../../js/';</script><script type="text/javascript" src="../../js/highlight.js"></script>
<script type="text/javascript">
_docsearch_version = "24";
</script> 
<script src="/assets/js/doc-search.bundle.js"></script>
</body>
</html>
