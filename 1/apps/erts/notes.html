<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.1">
    <meta name="project" content="erts v16.0">


<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=1&q=">
<meta name="major-vsn" content="1">
<link rel="canonical" href="https://www.erlang.org/docs/1/apps/erts/notes.html" />
    <title>ERTS Release Notes â€” erts v16.0</title>

    <link rel="stylesheet" href="dist/html-erlang-ZK43ZOAC.css" />

    <script defer src="dist/sidebar_items-40F65B05.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="erts" />
        </a>

      <div>
        <a href="../../index.html" class="sidebar-projectName" translate="no">
erts
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v16.0
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of erts</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>ERTS Release Notes</h1>


      <a href="https://github.com/erlang/otp/blob/master/erts/doc/notes.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<p>This document describes the changes made to the ERTS application.</p><h2 id="erts-16-0" class="section-heading"><a href="#erts-16-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 16.0</span></h2><h3 id="fixed-bugs-and-malfunctions" class="section-heading"><a href="#fixed-bugs-and-malfunctions" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>ETS tables with more than 2 billion keys are now supported.</p><p>Own Id: OTP-19144 Aux Id: <a href="https://github.com/erlang/otp/pull/8589" title="">PR-8589</a></p></li><li><p>The zlib library included in Erlang/OTP has been updated to version 1.3.1.</p><p>Own Id: OTP-19259 Aux Id: <a href="https://github.com/erlang/otp/pull/8862" title="">PR-8862</a></p></li><li><p><a href="../../system/embedded.html#to_erl"><code class="inline">to_erl</code></a> no longer clears the screen when attaching to a <a href="run_erl_cmd.html"><code class="inline">run_erl</code></a> session.</p><p>Own Id: OTP-19263 Aux Id: <a href="https://github.com/erlang/otp/pull/8943" title="">PR-8943</a></p></li><li><p>The size of an atom in the Erlang source code was limited to 255 bytes in previous releases, meaning that an atom containing only emojis could contain only 63 emojis.</p><p>While atoms are still only allowed to contain 255 characters, the number of bytes is no longer limited.</p><p>External tools that parse the <code class="inline">AtU8</code> chunk of a BEAM file directly need to be updated. Tools that use <a href="../../apps/stdlib/beam_lib.html#chunks/2"><code class="inline">beam_lib:chunks(Beam, [atoms])</code></a> to read the atom table will continue to work.</p><p><strong><em> POTENTIAL INCOMPATIBILITY </em></strong></p><p>Own Id: OTP-19285 Aux Id: <a href="https://github.com/erlang/otp/pull/8913" title="">PR-8913</a></p></li><li><p>Fixed a bug where <a href="erlc_cmd.html"><code class="inline">erlc</code></a> would crash if its path contained spaces.</p><p>Own Id: OTP-19295 Aux Id: <a href="https://github.com/erlang/otp/pull/8937" title="">PR-8937</a></p></li><li><p>The <a href="erl_cmd.html#noshell"><code class="inline">-noshell</code></a> mode has been updated to read data lazily from standard input. Before this fix any data would be read greedily which meant that Erlang could consume data not meant for it. It also meant that in order for <a href="../../apps/stdlib/shell.html#start_interactive/0"><code class="inline">shell:start_interactive/0</code></a> to work on Windows an API that did not support reading of Unicode characters had to be used.</p><p>Own Id: OTP-19313 Aux Id: <a href="https://github.com/erlang/otp/pull/8962" title="">PR-8962</a>, <a href="https://github.com/erlang/otp/issues/8113" title="">GH-8113</a></p></li><li><p>The literals chunk in BEAM is no longer compressed, resulting in slightly smaller BEAM files when a BEAM file is stripped using <a href="../../apps/stdlib/beam_lib.html#strip_files/1"><code class="inline">beam_lib:strip_files/1</code></a>.</p><p>This is a potential incompatibility for tools that read and interpret the contents of the literal chunk. One way to update such tools to work with the new format is to retrieve the chunk using <a href="../../apps/stdlib/beam_lib.html#chunks/2"><code class="inline">beam_lib:chunks(Beam, [literals])</code></a>.</p><p><strong><em> POTENTIAL INCOMPATIBILITY </em></strong></p><p>Own Id: OTP-19323 Aux Id: <a href="https://github.com/erlang/otp/issues/8967" title="">GH-8967</a>, <a href="https://github.com/erlang/otp/pull/8988" title="">PR-8988</a></p></li><li><p>Fixed <a href="erlang.html#localtime_to_universaltime/2"><code class="inline">erlang:localtime_to_universaltime/2</code></a> with <code class="inline">IsDST</code> set to <code class="inline">true</code> and a timezone without daylight saving (for example <code class="inline">UTC</code>) to assume that the provided localtime does not have DST. This has always been the behaviour, but glibc versions after 2.37 changed it so that the behavior in Erlang also changed.</p><p>Own Id: OTP-19453 Aux Id: <a href="https://github.com/erlang/otp/pull/9207" title="">PR-9207</a></p></li><li><p>Support for the <code class="inline">TZ</code> environment variable has been added on Windows. Before this change only the time zone configured in the OS was ever used.</p><p>Own Id: OTP-19454 Aux Id: <a href="https://github.com/erlang/otp/pull/9207" title="">PR-9207</a></p></li><li><p>Suppressed various warnings when building the emulator with recent versions of GCC</p><p>Own Id: OTP-19488 Aux Id: <a href="https://github.com/erlang/otp/issues/9413" title="">GH-9413</a>, <a href="https://github.com/erlang/otp/pull/9417" title="">PR-9417</a></p></li><li><p>Fixed a bug in re:run and re:compile where the pattern parameter would be read incorrectly if it was a sub-binary.</p><p>Own Id: OTP-19507 Aux Id: <a href="https://github.com/erlang/otp/pull/9478" title="">PR-9478</a>, <a href="https://github.com/erlang/otp/issues/9438" title="">GH-9438</a></p></li><li><p>Fixed a broken makefile rule that made it so that  <code class="inline">O2</code> and <code class="inline">-O2</code> could not be part of the directory path when building Erlang/OTP. Bug has been present since R11B released 2006.</p><p>Own Id: OTP-19518 Aux Id: <a href="https://github.com/erlang/otp/pull/9488" title="">PR-9488</a>, <a href="https://github.com/erlang/otp/issues/9487" title="">GH-9487</a></p></li><li><p>Fixed the index types of modules <code class="inline">atomics</code> and <code class="inline">counters</code> from <code class="inline">integer()</code> to <code class="inline">pos_integer()</code>, which is more correct.</p><p>Own Id: OTP-19532 Aux Id: <a href="https://github.com/erlang/otp/pull/9538" title="">PR-9538</a></p></li><li><p>Fix <a href="erl_cmd.html"><code class="inline">erl</code></a> flags <code class="inline">+Q</code>, <code class="inline">+P</code> and <code class="inline">+t</code> to not allow values greater than 4294975487. Before this fix, the runtime would either truncate the value or crash depending on which value was given.</p><p>Own Id: OTP-19594 Aux Id: <a href="https://github.com/erlang/otp/pull/9671" title="">PR-9671</a>, <a href="https://github.com/erlang/otp/issues/9668" title="">GH-9668</a></p></li><li><p>The socket option names for built-in socket options in the module <code class="inline">socket</code> has been cleaned up.</p><p>Now, for known socket options, it is only the canonical protocol names that are allowed such as <code class="inline">ip</code> for the socket option <code class="inline">{ip,recvtos}</code>.  Previously, due to being a protocol alias; <code class="inline">{'IP',recvtos}</code> was also allowed, as was the incorrect <code class="inline">{hopopt,recvtos}</code> because the protocol <code class="inline">hopopt</code> on Linux has the same protocol number as <code class="inline">ip</code>.</p><p>So, to reduce confusion, all enumerated protocol names with the same number, are not allowed for the known protocol options, only the canonical name.</p><p><strong><em> POTENTIAL INCOMPATIBILITY </em></strong></p><p>Own Id: OTP-19615 Aux Id: <a href="https://github.com/erlang/otp/pull/9718" title="">PR-9718</a></p></li><li><p>On windows, socket:sendv could incorrectly return {ok, integer()} on Windows.</p><p>Own Id: OTP-19617 Aux Id: OTP-19482</p></li></ul><h3 id="improvements-and-new-features" class="section-heading"><a href="#improvements-and-new-features" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Functionality making it possible for processes to enable reception of <a href="../../system/ref_man_processes.html#priority-messages">priority messages</a> has been introduced in accordance with <a href="https://www.erlang.org/eeps/eep-0076">EEP 76</a>.</p><p>Own Id: OTP-19198 Aux Id: <a href="https://github.com/erlang/otp/pull/9269" title="">PR-9269</a>, <a href="https://github.com/erlang/otp/pull/9519" title="">PR-9519</a>, <a href="https://github.com/erlang/otp/pull/9590" title="">PR-9590</a></p></li><li><p>The <a href="../../apps/kernel/trace.html#system/3"><code class="inline">trace:system/3</code></a> function has been added. It has a similar interface as <a href="erlang.html#system_monitor/2"><code class="inline">erlang:system_monitor/2</code></a> but it also supports trace sessions.</p><p>Own Id: OTP-19271 Aux Id: <a href="https://github.com/erlang/otp/pull/8660" title="">PR-8660</a></p></li><li><p>Added support for <code class="inline">SIGWINCH</code>, <code class="inline">SIGCONT</code>, and <code class="inline">SIGINFO</code> signals to <a href="../../apps/kernel/os.html#set_signal/2"><code class="inline">os:set_signal/2</code></a> where available.</p><p>Own Id: OTP-19278 Aux Id: <a href="https://github.com/erlang/otp/pull/8887" title="">PR-8887</a>, <a href="https://github.com/erlang/otp/pull/8938" title="">PR-8938</a></p></li><li><p>The <a href="erl_cmd.html#noshell"><code class="inline">erl -noshell</code></a> mode has been updated to have two sub modes called <code class="inline">raw</code> and <code class="inline">cooked</code>, where <code class="inline">cooked</code> is the old default behaviour and <code class="inline">raw</code> can be used to bypass the line-editing support of the native terminal. Using <code class="inline">raw</code> mode it is possible to read keystrokes as they happen without the user having to press Enter. Also, the <code class="inline">raw</code> mode does not echo the typed characters to stdout. An example of how to create a tic-tac-toe game using this mechanism is included in <a href="../../apps/stdlib/terminal_interface.html">the documentation</a>.</p><p>Own Id: OTP-19314 Aux Id: <a href="https://github.com/erlang/otp/pull/8962" title="">PR-8962</a>, <a href="https://github.com/erlang/otp/issues/8037" title="">GH-8037</a></p></li><li><p><a href="https://www.erlang.org/eeps/eep-0069">EEP-69: Nominal Types</a> has been implemented. As a side effect, nominal types can encode opaque types. We changed all opaque-handling logic and improved opaque warnings in Dialyzer.</p><p>All existing Erlang type systems are structural: two types are seen as equivalent if their structures are the same. Type comparisons are based on the structures of the types, not on how the user explicitly defines them. For example, in the following example, <code class="inline">meter()</code> and <code class="inline">foot()</code> are equivalent. The two types can be used interchangeably. Neither of them differ from the basic type <code class="inline">integer()</code>.</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">type</span><span class="w"> </span><span class="nf">meter</span><span class="p" data-group-id="4380474463-1">(</span><span class="p" data-group-id="4380474463-1">)</span><span class="w"> </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="nf">integer</span><span class="p" data-group-id="4380474463-2">(</span><span class="p" data-group-id="4380474463-2">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">type</span><span class="w"> </span><span class="nf">foot</span><span class="p" data-group-id="4380474463-3">(</span><span class="p" data-group-id="4380474463-3">)</span><span class="w"> </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="nf">integer</span><span class="p" data-group-id="4380474463-4">(</span><span class="p" data-group-id="4380474463-4">)</span><span class="p">.</span></code></pre><p>Nominal typing is an alternative type system, where two types are equivalent if and only if they are declared with the same type name. The EEP proposes one new syntax -nominal for declaring nominal types. Under nominal typing, <code class="inline">meter()</code> and <code class="inline">foot()</code> are no longer compatible. Whenever a function expects type <code class="inline">meter()</code>, passing in type <code class="inline">foot()</code> would result in a Dialyzer error.</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">nominal</span><span class="w"> </span><span class="nf">meter</span><span class="p" data-group-id="4474038382-1">(</span><span class="p" data-group-id="4474038382-1">)</span><span class="w"> </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="nf">integer</span><span class="p" data-group-id="4474038382-2">(</span><span class="p" data-group-id="4474038382-2">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">nominal</span><span class="w"> </span><span class="nf">foot</span><span class="p" data-group-id="4474038382-3">(</span><span class="p" data-group-id="4474038382-3">)</span><span class="w"> </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="nf">integer</span><span class="p" data-group-id="4474038382-4">(</span><span class="p" data-group-id="4474038382-4">)</span><span class="p">.</span></code></pre><p>More nominal type-checking rules can be found in the EEP. It is worth noting that most work for adding nominal types and type-checking is in <code class="inline">erl_types.erl</code>. The rest are changes that removed the previous opaque type-checking, and added an improved version of it using nominal type-checking with reworked warnings.</p><p>Backwards compatibility for opaque type-checking is not preserved by this PR. Previous opaque warnings can appear with slightly different wordings. A new kind of opaque warning <code class="inline">opaque_union</code> is added, together with a Dialyzer option <code class="inline">no_opaque_union</code> to turn this kind of warnings off.</p><p>Own Id: OTP-19364 Aux Id: <a href="https://github.com/erlang/otp/pull/9079" title="">PR-9079</a></p></li><li><p>Two BIFs have been added to the <a href="erlang.html"><code class="inline">erlang</code></a> module. </p><p><a href="erlang.html#processes_iterator/0"><code class="inline">erlang:processes_iterator/0</code></a> returns a process iterator that can be used to
iterate through the process table.</p><p><code class="inline">erlang:process_next/1</code> takes in a process iterator and returns a 2-tuple, consisting of a process identifier and a new process iterator. When the process iterator runs out of processes in the process table, <code class="inline">none</code> will be returned.</p><p>Using these BIFs to scan the processes scales better than using <a href="erlang.html#processes/0"><code class="inline">erlang:processes/0</code></a>, at the cost of giving less consistency guarantees. Process identifiers returned from consecutive calls of <code class="inline">erlang:process_next/1</code> may not be a consistent snapshot of all elements existing in the table during any of the calls. A process identifier is only guaranteed to be returned from a call to <a href="erlang.html#processes_next/1"><code class="inline">erlang:processes_next/1</code></a> if it was alive before the call to <a href="erlang.html#processes_iterator/0"><code class="inline">erlang:processes_iterator/0</code></a> and was still alive when <a href="erlang.html#processes_next/1"><code class="inline">erlang:processes_next/1</code></a> returned <code class="inline">none</code>.</p><p>Own Id: OTP-19369 Aux Id: <a href="https://github.com/erlang/otp/pull/9129" title="">PR-9129</a></p></li><li><p>Improved open debug for gen_tcp_socket (connect and listen) and gen_udp_socket (open).</p><p>Own Id: OTP-19386</p></li><li><p>Module <a href="../../apps/stdlib/re.html"><code class="inline">re</code></a> has been updated to use PCRE2, which is mostly backward compatible with PCRE.</p><p>The most noticeable incompatibilities are</p><ul><li>The default character encoding is pure ASCII and not Latin1. Unicode support
is still available with options <code class="inline">unicode</code> and <code class="inline">ucp</code>.</li><li>Options <code class="inline">bsr_anycrlf</code>, <code class="inline">bsr_unicode</code> and <code class="inline">{newline,_}</code> are only set when a
regex is compiled and cannot be changed at matching for precompiled regex.</li></ul><p><strong><em> POTENTIAL INCOMPATIBILITY </em></strong></p><p>Own Id: OTP-19431 Aux Id: <a href="https://github.com/erlang/otp/pull/9299" title="">PR-9299</a>, <a href="https://github.com/erlang/otp/pull/9610" title="">PR-9610</a></p></li><li><p>When booting the runtime system on a 32-bit computer with a single core, the boot code will try to minimize the peak memory use by disabling parallel loading of BEAM files.</p><p>Own Id: OTP-19450 Aux Id: <a href="https://github.com/erlang/otp/pull/9342" title="">PR-9342</a></p></li><li><p>A <code class="inline">socket</code> option <code class="inline">{otp,select_read}</code> has been added that enables keeping a socket in the VM select/poll set between calls to recv functions.</p><p>This increases throughput by reducing the number of calls to said functions.</p><p>Own Id: OTP-19451 Aux Id: <a href="https://github.com/erlang/otp/pull/9344" title="">PR-9344</a></p></li><li><p><code class="inline">erlc</code> will now write compiler warnings and errors to standard error, instead of standard output, in common with other language compilers.</p><p>Own Id: OTP-19460 Aux Id: <a href="https://github.com/erlang/otp/issues/9255" title="">GH-9255</a>, <a href="https://github.com/erlang/otp/pull/9363" title="">PR-9363</a></p></li><li><p>Fixed the Windows build to always include <code class="inline">.pdb</code> files for all DLLs and executables to help with debugging.</p><p>Own Id: OTP-19465 Aux Id: <a href="https://github.com/erlang/otp/pull/9229" title="">PR-9229</a></p></li><li><p>Improve the naming of the (internal) esock mutex(es). It is now possible to configure (as in autoconf) the use of simple names for the esock mutex(es).</p><p>Own Id: OTP-19472 Aux Id: <a href="https://github.com/erlang/otp/pull/9388" title="">PR-9388</a></p></li><li><p>An optimization for appending 0 bits to a binary was removed in patch releases for OTP versions 25, 26, and 27. This optimization has been reintroduced in Erlang/OTP 28.</p><p>Own Id: OTP-19473 Aux Id: <a href="https://github.com/erlang/otp/pull/9396" title="">PR-9396</a>, <a href="https://github.com/erlang/otp/pull/8697" title="">PR-8697</a></p></li><li><p>Fixed licenses in files and added ORT curations to the following apps: otp, eldap, erl_interface, eunit, parsetools, stdlib, syntax_tools, and ERTS.</p><p>Own Id: OTP-19478 Aux Id: <a href="https://github.com/erlang/otp/pull/9376" title="">PR-9376</a>, <a href="https://github.com/erlang/otp/pull/9402" title="">PR-9402</a>, <a href="https://github.com/erlang/otp/pull/9819" title="">PR-9819</a></p></li><li><p>When using <a href="erl_nif.html#enif_select_read"><code class="inline">enif_select_read</code></a> (or <a href="erl_nif.html#enif_select"><code class="inline">enif_select</code></a> with <code class="inline">ERL_NIF_SELECT_READ</code>) on systems with kernel polling enabled (that is most Unix systems), file descriptors that are always re-enabled as soon as they trigger are now part of a specialized pollset just as <a href="erl_driver.html#driver_select"><code class="inline">driver_select</code></a>. This reduces the CPU usage in such scenarios as the erts does not have to re-insert the FD everytime it it triggered. As a result of this optimization <a href="../../apps/kernel/socket.html"><code class="inline">socket</code></a> based reading uses a lot less CPU and achieves a higher throughput.</p><p>Own Id: OTP-19479 Aux Id: <a href="https://github.com/erlang/otp/pull/9275" title="">PR-9275</a></p></li><li><p>Added support for compiling Erlang/OTP for Windows on ARM64.</p><p>Own Id: OTP-19480 Aux Id: <a href="https://github.com/erlang/otp/pull/8734" title="">PR-8734</a></p></li><li><p>The Windows installer no longer creates the <code class="inline">erl.ini</code> file, making installations redistributable.</p><p>Own Id: OTP-19481 Aux Id: <a href="https://github.com/erlang/otp/pull/9330" title="">PR-9330</a></p></li><li><p>Added erlang:hibernate/0, which hibernates a process without discarding the stack.</p><p>Own Id: OTP-19503 Aux Id: <a href="https://github.com/erlang/otp/pull/9406" title="">PR-9406</a></p></li><li><p>The asmjit library (used by BeamJIT) has been updated to version 029075b84bf0161a761beb63e6eda519a29020db.</p><p>Own Id: OTP-19509 Aux Id: <a href="https://github.com/erlang/otp/pull/9495" title="">PR-9495</a></p></li><li><p>When compiling C/C++ code on Unix systems, the compiler hardening flags suggested by the <a href="https://github.com/ossf/wg-best-practices-os-developers/blob/main/docs/Compiler-Hardening-Guides/Compiler-Options-Hardening-Guide-for-C-and-C%2B%2B.md">Open Source Security Foundation</a> are now enabled by default. To disable them, pass <code class="inline">--disable-security-hardening-flags</code> to <code class="inline">configure</code>.</p><p>Own Id: OTP-19519 Aux Id: <a href="https://github.com/erlang/otp/pull/9441" title="">PR-9441</a></p></li><li><p>If a process being suspended using <a href="erlang.html#suspend_process/2"><code class="inline">erlang:suspend_process()</code></a>
currently is waiting in a <code class="inline">receive ... after</code> expression, the timer for the timeout will now also be
suspended until the process is resumed.</p><p><strong><em> POTENTIAL INCOMPATIBILITY </em></strong></p><p>Own Id: OTP-19536 Aux Id: <a href="https://github.com/erlang/otp/pull/8670" title="">PR-8670</a></p></li><li><p>A test module for TLS distribution over <code class="inline">socket</code> has been implemented.</p><p>Own Id: OTP-19539 Aux Id: <a href="https://github.com/erlang/otp/pull/9511" title="">PR-9511</a></p></li><li><p>Upgrade pcre2 to 10.45</p><p>Own Id: OTP-19541 Aux Id: <a href="https://github.com/erlang/otp/pull/9582" title="">PR-9582</a></p></li><li><p>The <code class="inline">+R</code> emulator options has been removed. It has had any effect since Erlang/OTP R9.</p><p>Own Id: OTP-19551 Aux Id: <a href="https://github.com/erlang/otp/pull/9608" title="">PR-9608</a></p></li><li><p>The license and copyright header has changed format to include an <code class="inline">SPDX-License-Identifier</code>. At the same time, most files have been updated to follow a uniform standard for license headers.</p><p>Own Id: OTP-19575 Aux Id: <a href="https://github.com/erlang/otp/pull/9670" title="">PR-9670</a></p></li><li><p>Increase the default inet-driver buffer size(s). Also introduce kernel parameters for UDP and SCTP to change the sizes when creating (those) sockets.</p><p>Own Id: OTP-19576</p></li><li><p>Add <a href="erl_cmd.html#%2BJPperfdirectory"><code class="inline">+JPperfdirectory &lt;dir&gt;</code></a> for specifying which directory Erlang should place perf symbol information files.</p><p>Own Id: OTP-19589 Aux Id: <a href="https://github.com/erlang/otp/pull/9639" title="">PR-9639</a>, <a href="https://github.com/erlang/otp/issues/9500" title="">GH-9500</a></p></li><li><p>Allow multiple static nifs to be part of the same archive. See the <a href="erl_nif.html#initialization">NIF documentation</a> for details.</p><p>Own Id: OTP-19590 Aux Id: <a href="https://github.com/erlang/otp/pull/9625" title="">PR-9625</a></p></li><li><p>Various improvements reducing lock contention on run queues due to task stealing.</p><p>Own Id: OTP-19591 Aux Id: <a href="https://github.com/erlang/otp/pull/9594" title="">PR-9594</a></p></li><li><p>The new implementation has the same behavior as the previous one. The newer compilers already have native support for FP16, so this implementation is only relevant for older compilers. For this reason, the new implementation has not been tested for speed.</p><p>Own Id: OTP-19603 Aux Id: <a href="https://github.com/erlang/otp/pull/9735" title="">PR-9735</a></p></li><li><p>An  <strong>experimental</strong> API for a native debugger has been added. The main components are the following:</p><ul><li><p>A new compiler option <code class="inline">beam_debug_info</code> for the Erlang compiler. When given, most optimizations are disabled and debug information suitable for the native debugger are added to generated BEAM files.</p></li><li><p>A new <code class="inline">+D</code> emulator flag. When given, the VM becomes &quot;debuggable&quot;, which means that when modules that been compiled with the <code class="inline">beam_debug_info</code> option are loaded, the code is instrumented so that one can enable and disable breakpoints on executable lines.</p></li><li><p>An experimental <code class="inline">erl_debugger</code> module with a new debugging API. Essentially, it allows a single, local, process to be registered as the &quot;debugger&quot; process for the node. This process is the one that will receive messages notifying that a process hit a breakpoint. This way, the front-end implementation of a debugger (such as <a href="https://github.com/WhatsApp/edb">edb from WhatApp</a>) can be decoupled from OTP.</p></li><li><p>The <code class="inline">erl_debugger</code> module also exposes new BIFs to inspect <code class="inline">X</code> and <code class="inline">Y</code> registers of a suspended process. Together with new code-information BIFs, this let's a debugger show the values of variables in scope for a suspended process.</p></li></ul><p>Own Id: OTP-19609 Aux Id: <a href="https://github.com/erlang/otp/pull/8670" title="">PR-8670</a>, <a href="https://github.com/erlang/otp/pull/9334" title="">PR-9334</a>, <a href="https://github.com/erlang/otp/pull/9604" title="">PR-9604</a></p></li><li><p>Update internal <code class="inline">ryu</code> implementation to use latest version. The new version is a little bit faster in some scenarios. <code class="inline">ryu</code> is used by <a href="erlang.html#float_to_list/1"><code class="inline">float_to_list/1</code></a> and similar functions to convert floats to strings.</p><p>Own Id: OTP-19613 Aux Id: <a href="https://github.com/erlang/otp/pull/9733" title="">PR-9733</a></p></li><li><p>Update of MD5 implementation from OpenSSL version 3.1.4 to 3.5.</p><p>Own Id: OTP-19614 Aux Id: <a href="https://github.com/erlang/otp/pull/9775" title="">PR-9775</a></p></li><li><p>Small optimization in binary_to_term by not allocating an unnecessary large native stack frame.</p><p>Own Id: OTP-19618 Aux Id: <a href="https://github.com/erlang/otp/pull/9759" title="">PR-9759</a>, <a href="https://github.com/erlang/otp/pull/9809" title="">PR-9809</a></p></li></ul><h2 id="erts-15-2-7" class="section-heading"><a href="#erts-15-2-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 15.2.7</span></h2><h3 id="fixed-bugs-and-malfunctions-1" class="section-heading"><a href="#fixed-bugs-and-malfunctions-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed an emulator crash when setting an error_handler module that was not yet loaded.</p><p>Own Id: OTP-19577 Aux Id: ERIERL-1220, <a href="https://github.com/erlang/otp/pull/9696" title="">PR-9696</a></p></li><li><p>Fixed a rare bug that could cause an emulator crash after unloading a module or erasing a persistent_term.</p><p>Own Id: OTP-19599 Aux Id: <a href="https://github.com/erlang/otp/pull/9724" title="">PR-9724</a></p></li></ul><h2 id="erts-15-2-6" class="section-heading"><a href="#erts-15-2-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 15.2.6</span></h2><h3 id="fixed-bugs-and-malfunctions-2" class="section-heading"><a href="#fixed-bugs-and-malfunctions-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bug in <code class="inline">call_memory</code> tracing that could cause wildly incorrect reported memory values. Bug exists since OTP 27.1.</p><p>Also fixed return type spec of <a href="../../apps/kernel/trace.html#info/3"><code class="inline">trace:info/3</code></a>.</p><p>Own Id: OTP-19581 Aux Id: ERIERL-1219, <a href="https://github.com/erlang/otp/pull/9706" title="">PR-9706</a></p></li></ul><h2 id="erts-15-2-5" class="section-heading"><a href="#erts-15-2-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 15.2.5</span></h2><h3 id="fixed-bugs-and-malfunctions-3" class="section-heading"><a href="#fixed-bugs-and-malfunctions-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>On Windows, using socket:sendv, a large IOV (size &gt; MAX), the tail was not sent.</p><p>Own Id: OTP-19482</p></li><li><p>Uplift pcre 8.44 to pcre 8.45</p><p>Own Id: OTP-19565</p></li></ul><h2 id="erts-15-2-4" class="section-heading"><a href="#erts-15-2-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 15.2.4</span></h2><h3 id="fixed-bugs-and-malfunctions-4" class="section-heading"><a href="#fixed-bugs-and-malfunctions-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Behavior for socket:recv/3 has been improved. The behavior has also been clarified in the documentation.</p><p>Own Id: OTP-19469 Aux Id: <a href="https://github.com/erlang/otp/issues/9172" title="">#9172</a></p></li><li><p>Trace messages due to <code class="inline">receive</code> tracing could potentially be delayed a very long time if the traced process waited in a <code class="inline">receive</code> expression without clauses matching on messages (timed wait), or just did not enter a <code class="inline">receive</code> expression for a very long time.</p><p>Own Id: OTP-19527 Aux Id: <a href="https://github.com/erlang/otp/pull/9577" title="">PR-9577</a></p></li><li><p>Improve the naming of the (internal) esock mutex(es). It is now possible to configure (as in autoconf) the use of simple names for the esock mutex(es).</p><p>Own Id: OTP-19548 Aux Id: OTP-19472</p></li></ul><h2 id="erts-15-2-3" class="section-heading"><a href="#erts-15-2-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 15.2.3</span></h2><h3 id="fixed-bugs-and-malfunctions-5" class="section-heading"><a href="#fixed-bugs-and-malfunctions-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed failed runtime assert in debug VM when built with statically linked NIFs.</p><p>Own Id: OTP-19443 Aux Id: <a href="https://github.com/erlang/otp/issues/9306" title="">GH-9306</a>, <a href="https://github.com/erlang/otp/pull/9307" title="">PR-9307</a></p></li><li><p>Fixed a bug where reading a binary from <a href="persistent_term.html"><code class="inline">persistent_term</code></a> could cause a segmentation fault on Windows. This bug was introduced in Erlang/OTP 27.0.</p><p>Own Id: OTP-19458 Aux Id: <a href="https://github.com/erlang/otp/pull/9349" title="">PR-9349</a>, <a href="https://github.com/erlang/otp/issues/9222" title="">GH-9222</a></p></li><li><p>Fixed a crash in <code class="inline">erlexec</code> (an executable used by <code class="inline">erl</code> during startup) when a <code class="inline">PATH</code> longer than 10240 was set.</p><p>Own Id: OTP-19471 Aux Id: <a href="https://github.com/erlang/otp/pull/9331" title="">PR-9331</a></p></li><li><p>Fixed bug in <code class="inline">erlang:halt</code>. Two processes calling <code class="inline">erlang:halt</code> at the same time could lead to one of them crashing with <code class="inline">badarg</code> as if it called <code class="inline">erlang:halt(undefined,undefined)</code>.</p><p>Own Id: OTP-19490 Aux Id: <a href="https://github.com/erlang/otp/pull/8640" title="">PR-8640</a>, <a href="https://github.com/erlang/otp/issues/8634" title="">GH-8634</a></p></li><li><p>Fixed BEAM crash when a custom thread sends a large map (&gt;128 keys) externally encoded with, for example, <code class="inline">erl_drv_send_term()</code>.</p><p>Own Id: OTP-19495 Aux Id: <a href="https://github.com/erlang/otp/issues/8208" title="">GH-8208</a>, <a href="https://github.com/erlang/otp/pull/8209" title="">PR-8209</a></p></li></ul><h2 id="erts-15-2-2" class="section-heading"><a href="#erts-15-2-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 15.2.2</span></h2><h3 id="fixed-bugs-and-malfunctions-6" class="section-heading"><a href="#fixed-bugs-and-malfunctions-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Disabled an unsafe runtime optimization in binary construction that caused silent memory corruption.</p><p>Own Id: OTP-19462 Aux Id: ERIERL-1177, <a href="https://github.com/erlang/otp/pull/9372" title="">PR-9372</a></p></li></ul><h2 id="erts-15-2-1" class="section-heading"><a href="#erts-15-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 15.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-7" class="section-heading"><a href="#fixed-bugs-and-malfunctions-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed configure tests for GCC 14</p><p>Own Id: OTP-19407 Aux Id: <a href="https://github.com/erlang/otp/issues/9211" title="">GH-9211</a>, <a href="https://github.com/erlang/otp/pull/9234" title="">PR-9234</a></p></li><li><p>Fix bug where log printouts would go missing when <code class="inline">application_controller</code> is stopping while log messages are being sent.</p><p>This bug was introduced by OTP-19078 in Erlang/OTP 26.2.5.</p><p>Own Id: OTP-19418 Aux Id: <a href="https://github.com/erlang/otp/issues/9163" title="">GH-9163</a>, <a href="https://github.com/erlang/otp/pull/9274" title="">PR-9274</a></p></li></ul><h2 id="erts-15-2" class="section-heading"><a href="#erts-15-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 15.2</span></h2><h3 id="fixed-bugs-and-malfunctions-8" class="section-heading"><a href="#fixed-bugs-and-malfunctions-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><a href="../../apps/kernel/gen_sctp.html#peeloff/2"><code class="inline">gen_sctp:peeloff/2</code></a> has been fixed to inherit socket options to the peeled off socket more like <a href="../../apps/kernel/gen_tcp.html#accept/1"><code class="inline">gen_tcp:accept/1</code></a>, for example the options <code class="inline">tos</code> or <code class="inline">tclass</code>.</p><p>When setting SCTP options that are unsupported on the platform, some should be silently ignored, but a bug caused the option parsing to derail so the options after could bail out and cause an error instead.  This has been fixed.</p><p>Own Id: OTP-19225 Aux Id: <a href="https://github.com/erlang/otp/pull/8789" title="">PR-8789</a></p></li><li><p>Fixed a bug where Erlang would corrupt the terminal settings if stdin was a TTY but stdout was not.</p><p>Own Id: OTP-19232 Aux Id: <a href="https://github.com/erlang/otp/pull/8794" title="">PR-8794</a>, <a href="https://github.com/erlang/otp/issues/8487" title="">GH-8487</a></p></li><li><p>Fixed a bug in the non-JIT VM when loading a NIF over a function that is already traced by more than one session. This caused a VM crash. This bug has existed since OTP-27.0, where multiple trace sessions were introduced.</p><p>Own Id: OTP-19248 Aux Id: <a href="https://github.com/erlang/otp/pull/8856" title="">PR-8856</a></p></li><li><p>Fixed a bug where the loading of modules with extremely large binary construction instructions crashed the emulator on AArch64.</p><p>Own Id: OTP-19261 Aux Id: <a href="https://github.com/erlang/otp/issues/8815" title="">GH-8815</a>, <a href="https://github.com/erlang/otp/pull/8816" title="">PR-8816</a></p></li><li><p><a href="../../apps/kernel/inet.html#getifaddrs/1"><code class="inline">inet:getifaddrs/0,1</code></a> is improved when using
inet_backend = socket.</p><p>Own Id: OTP-19264</p></li><li><p><a href="../../apps/stdlib/win32reg.html#value/2"><code class="inline">win32reg:value/2</code></a> will no longer crash the emulator when the value is an unterminated REG_SZ of size 0.</p><p>Own Id: OTP-19283 Aux Id: <a href="https://github.com/erlang/otp/issues/8903" title="">GH-8903</a>, <a href="https://github.com/erlang/otp/pull/8912" title="">PR-8912</a></p></li><li><p><code class="inline">Makefile</code> dependency generation on Windows in WSL 2 has been corrected.</p><p>Own Id: OTP-19300 Aux Id: <a href="https://github.com/erlang/otp/pull/8955" title="">PR-8955</a></p></li><li><p>Fix lock order violation if a NIF monitor <code class="inline">down</code> callback calls <code class="inline">enif_whereis_pid</code>. Would cause debug emulator to crash but could potentially lead to deadlocks in optimized emulator.</p><p>Own Id: OTP-19330 Aux Id: <a href="https://github.com/erlang/otp/issues/8983" title="">GH-8983</a>, <a href="https://github.com/erlang/otp/pull/9008" title="">PR-9008</a></p></li><li><p>Fixed compilation faults when compiling using <code class="inline">--enable-vm-probes</code>.</p><p>Own Id: OTP-19333</p></li><li><p>Fixed <code class="inline">erl_nif.h</code> on Windows to compile when gcc or clang is used.</p><p>Own Id: OTP-19341 Aux Id: <a href="https://github.com/erlang/otp/pull/9016" title="">PR-9016</a></p></li><li><p>Fixed a minor issue in the JIT debug information that confused tools like GDB and perf.</p><p>Own Id: OTP-19362 Aux Id: <a href="https://github.com/erlang/otp/pull/9003" title="">PR-9003</a></p></li></ul><h3 id="improvements-and-new-features-1" class="section-heading"><a href="#improvements-and-new-features-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Improved documentation of <a href="time_correction.html#timers">timers</a>.</p><p>Own Id: OTP-19360 Aux Id: ERIERL-1149, <a href="https://github.com/erlang/otp/pull/9062" title="">PR-9062</a></p></li><li><p>The label for a process can now be retrieved also using <code class="inline">process_info(Pid, label)</code> in addition to <a href="../../apps/stdlib/proc_lib.html#get_label/1"><code class="inline">proc_lib:get_label/1</code></a>.</p><p>This new option is useful when one wants to retrieve more than one process info item. For example:</p><pre><code class="makeup erlang" translate="no"><span class="nf">process_info</span><span class="p" data-group-id="3305519323-1">(</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3305519323-2">[</span><span class="ss">label</span><span class="p">,</span><span class="ss">registered_name</span><span class="p" data-group-id="3305519323-2">]</span><span class="p" data-group-id="3305519323-1">)</span></code></pre><p>Own Id: OTP-19373 Aux Id: <a href="https://github.com/erlang/otp/pull/9108" title="">PR-9108</a></p></li></ul><h2 id="erts-15-1-3" class="section-heading"><a href="#erts-15-1-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 15.1.3</span></h2><h3 id="fixed-bugs-and-malfunctions-9" class="section-heading"><a href="#fixed-bugs-and-malfunctions-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>gen_udp:send on domain local can leak inet_reply messages.</p><p>Own Id: OTP-19332 Aux Id: <a href="https://github.com/erlang/otp/issues/8989" title="">#8989</a></p></li><li><p>net:getifaddrs does not properly report the running flag on windows.</p><p>Own Id: OTP-19366 Aux Id: OTP-19061, ERIERL-1134</p></li></ul><h2 id="erts-15-1-2" class="section-heading"><a href="#erts-15-1-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 15.1.2</span></h2><h3 id="fixed-bugs-and-malfunctions-10" class="section-heading"><a href="#fixed-bugs-and-malfunctions-10" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A bug has been fixed where receiving an SCTP message with <code class="inline">gen_sctp</code> could waste the first fragments of a message and only deliver the last fragment.</p><p>This happened with low probability when the OS signaled that the socket was ready for reading in combination with an internal time-out retry.</p><p>A bug has been fixed with a lingering time-out from after an SCTP connect that could stop the flow of incoming messages on an active <code class="inline">gen_tcp</code> socket.</p><p>Own Id: OTP-19235 Aux Id: ERIERL-1133, <a href="https://github.com/erlang/otp/pull/8837" title="">PR-8837</a></p></li><li><p>An boolean option <code class="inline">non_block_send</code> for SCTP, has ben added to be able to achieve the old behaviour to avoid blocking send operations by passing the OS network stack error message (<code class="inline">{error,eagain}</code> through.</p><p>Own Id: OTP-19258 Aux Id: OTP-19061, ERIERL-1134</p></li><li><p>The call <a href="../../apps/kernel/gen_tcp.html#send/2"><code class="inline">gen_tcp:send/2</code></a> could hang indefinitely despite having set the <code class="inline">send_timeout</code> option for the following unfortunate combination of circumstances:</p><ul><li>The socket has to be in passive mode.</li><li>All output buffers had to be filled util the <code class="inline">high_watermark</code> was hit, causing the <a href="../../apps/kernel/gen_tcp.html#send/2"><code class="inline">gen_tcp:send/2</code></a> operation to block.</li><li>While the send operation was blocked, a <code class="inline">gen_tcp:recv/2,3</code> call had to be done from a different process.  It had to block, waiting for data for a while before completing the operation, and the received packet had to fill at least 75% of the receive buffer.</li></ul><p>Under these circumstances he information that a send operation was waiting got lost, so the send operation that blocked in the first placed would never return.  The data it had would be sent, though, and send operations from other processes, still work.</p><p>This bug has been fixed.</p><p>Own Id: OTP-19267 Aux Id: <a href="https://github.com/erlang/otp/issues/6455" title="">GH-6455</a>, OTP-18520, ERIERL-1138, <a href="https://github.com/erlang/otp/pull/8892" title="">PR-8892</a></p></li><li><p>In rare circumstances, in code that matches multiple tuples, the JIT could generate code that would raise a <code class="inline">badmatch</code> exception even if the given tuples were correct.</p><p>Own Id: OTP-19268 Aux Id: <a href="https://github.com/erlang/otp/issues/8875" title="">GH-8875</a>, <a href="https://github.com/erlang/otp/pull/8895" title="">PR-8895</a></p></li><li><p>Fixed beam crash that could happen if resetting <code class="inline">call_time</code> or <code class="inline">call_memory</code> trace counters of a function while it is called. Bug exists since OTP R16.</p><p>Own Id: OTP-19269 Aux Id: <a href="https://github.com/erlang/otp/issues/8835" title="">GH-8835</a>, <a href="https://github.com/erlang/otp/pull/8897" title="">PR-8897</a></p></li></ul><h2 id="erts-15-1-1" class="section-heading"><a href="#erts-15-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 15.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-11" class="section-heading"><a href="#fixed-bugs-and-malfunctions-11" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>On Windows, successive failed socket calls caused socket to become &quot;uninitialized&quot;.</p><p>Own Id: OTP-19251 Aux Id: <a href="https://github.com/erlang/otp/issues/8853" title="">#8853</a></p></li><li><p>The socket framework fails to start on a IPv6-only Windows machine.</p><p>Own Id: OTP-19254 Aux Id: <a href="https://github.com/erlang/otp/issues/8848" title="">#8848</a></p></li></ul><h2 id="erts-15-1" class="section-heading"><a href="#erts-15-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 15.1</span></h2><h3 id="fixed-bugs-and-malfunctions-12" class="section-heading"><a href="#fixed-bugs-and-malfunctions-12" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The <code class="inline">erl -man example</code> has been corrected to not consider values set in <code class="inline">ERL_ZFLAGS</code> and stop parsing arguments when a <code class="inline">--</code> is encountered.</p><p>Own Id: OTP-19098 Aux Id: <a href="https://github.com/erlang/otp/pull/8478" title="">PR-8478</a>, <a href="https://github.com/erlang/otp/issues/8477" title="">GH-8477</a></p></li><li><p>Compiler warnings for  Windows I/O back-end have been silenced.</p><p>Own Id: OTP-19113</p></li><li><p>Bugs related to <code class="inline">return_to</code> trace have been fixed. It did not work for more than once trace session and it did sometimes not trigger for exceptions.</p><p>Own Id: OTP-19122</p></li><li><p>Potential deadlocks while writing a crash dump have been eliminated.</p><p>Own Id: OTP-19133 Aux Id: <a href="https://github.com/erlang/otp/pull/8521" title="">PR-8521</a>, <a href="https://github.com/erlang/otp/issues/8498" title="">GH-8498</a></p></li><li><p>When loading a damaged or too old BEAM file, the runtime system could crash.</p><p>Own Id: OTP-19153 Aux Id: <a href="https://github.com/erlang/otp/pull/8623" title="">PR-8623</a></p></li><li><p>A scheduler thread could get stuck when deleting a memory allocator carrier when adjacent carriers were deleted and/or inserted simultaneously by other schedulers. This in turn could cause the other schedulers to get stuck as well.</p><p>Own Id: OTP-19154 Aux Id: <a href="https://github.com/erlang/otp/issues/8613" title="">GH-8613</a>, <a href="https://github.com/erlang/otp/pull/8627" title="">PR-8627</a></p></li><li><p>Statistics for number of carriers in a shared pool after calling <code class="inline">instrument:allocations</code> or <code class="inline">instrument:carriers</code> are now correct. Also, a potential bug in carrier block scanning was eliminated.</p><p>Own Id: OTP-19166 Aux Id: <a href="https://github.com/erlang/otp/pull/8636" title="">PR-8636</a></p></li><li><p>A race in the kTLS flavour of SSL distribution has been fixed so that <code class="inline">inet_drv.c</code> doesn't read ahead too much data, which could cause the kTLS encryption to be activated too late when some encrypted data had already been read into the <code class="inline">inet_drv.c</code> buffer as unencrypted.</p><p>Own Id: OTP-19175 Aux Id: <a href="https://github.com/erlang/otp/issues/8561" title="">GH-8561</a>, <a href="https://github.com/erlang/otp/pull/8690" title="">PR-8690</a></p></li><li><p>Fixed an emulator crash relating to compressed ETS tables.</p><p>Own Id: OTP-19176 Aux Id: <a href="https://github.com/erlang/otp/pull/8683" title="">PR-8683</a></p></li><li><p>A function (encode_sockaddr) was called with superfluous argument, on Windows, in the net nif.</p><p>Own Id: OTP-19181</p></li><li><p>Fixed a crash that could happen on reallocation failure.</p><p>Own Id: OTP-19192</p></li><li><p>Man pages are now available for <code class="inline">erl</code>, <code class="inline">erlc</code>, <code class="inline">dialyzer</code>, and all other programs that are included in Erlang/OTP.</p><p>Own Id: OTP-19201 Aux Id: <a href="https://github.com/erlang/otp/pull/8740" title="">PR-8740</a></p></li><li><p>A previous correction in the Erlang/OTP 27.0.1 emergency patch had the unfortunate side effect of sometimes causing an unnecessary fullsweep (major) garbage collection instead of a  generation (minor) garbage collection. This has been corrected.</p><p>Own Id: OTP-19209 Aux Id: <a href="https://github.com/erlang/otp/pull/8751" title="">PR-8751</a>, <a href="https://github.com/erlang/otp/pull/8539" title="">PR-8539</a></p></li><li><p>Fixed trace matchspec functions <code class="inline">trace</code> and <code class="inline">enable_trace</code> to use the session tracer when enabling trace flags on untraced processes.</p><p>Own Id: OTP-19211 Aux Id: <a href="https://github.com/erlang/otp/issues/8657" title="">GH-8657</a></p></li><li><p>Fixed a typo in the type spec for <a href="erlang.html#t:garbage_collection_defaults/0"><code class="inline">erlang:garbage_collection_defaults/0</code></a>.</p><p>Own Id: OTP-19215 Aux Id: <a href="https://github.com/erlang/otp/pull/8757" title="">PR-8757</a></p></li><li><p>Corrected socket:ioctl for genaddr (SIOCGENADDR).</p><p>Own Id: OTP-19216</p></li><li><p>The support for Transparent Huge Pages has been disabled on non-amd64 Linux systems.</p><p>Own Id: OTP-19219 Aux Id: <a href="https://github.com/erlang/otp/pull/8702" title="">PR-8702</a></p></li><li><p>Fixed a race condition on Windows when upgrading from <code class="inline">-noshell</code> to a shell that would cause Erlang to crash with the error:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="9856093388-1">{</span><span class="ss">&#39;GetOverlappedResult&#39;</span><span class="p">,</span><span class="w">
  </span><span class="ss">&#39;The I/O operation has been aborted because of either a thread exit or an application request.&#39;</span><span class="p" data-group-id="9856093388-1">}</span><span class="p">.</span></code></pre><p>Own Id: OTP-19220 Aux Id: <a href="https://github.com/erlang/otp/pull/8774" title="">PR-8774</a>, <a href="https://github.com/erlang/otp/issues/7621" title="">GH-7621</a></p></li></ul><h3 id="improvements-and-new-features-2" class="section-heading"><a href="#improvements-and-new-features-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Added functions <code class="inline">getservbyname</code> and <code class="inline">getservbyport</code> to the <code class="inline">net</code> module.</p><p>Own Id: OTP-19101 Aux Id: OTP-18835</p></li><li><p>Introduced enet | esock variants of <a href="../../apps/kernel/inet.html"><code class="inline">inet</code></a> functions, either when called with sockets,
with explicit inet_backend config or with the e inet_backend kernel config option.</p><p>Own Id: OTP-19132 Aux Id: OTP-19101</p></li><li><p>Optimize process and port creation when such tracing is not enabled by any trace session.</p><p>Own Id: OTP-19167 Aux Id: <a href="https://github.com/erlang/otp/pull/8655" title="">PR-8655</a></p></li><li><p>Compiler warnings for some removed functions have been corrected to point out the correct replacement functions.</p><p>Own Id: OTP-19186 Aux Id: <a href="https://github.com/erlang/otp/pull/8709" title="">PR-8709</a></p></li><li><p>A boolean option <code class="inline">read_ahead</code> has been implemented for <code class="inline">gen_tcp</code>, default <code class="inline">true</code>, to facilitate not reading past (caching data) the end of a packet.  In particular, for kTLS, caching data could read in data that was supposed to be decrypted by the platform's network stack, before crypto parameters could be activated.</p><p>Own Id: OTP-19199 Aux Id: OTP-19175, <a href="https://github.com/erlang/otp/issues/8561" title="">GH-8561</a>, <a href="https://github.com/erlang/otp/issues/8690" title="">GH-8690</a>, <a href="https://github.com/erlang/otp/issues/8785" title="">GH-8785</a></p></li><li><p>The <a href="../../apps/stdlib/zip.html"><code class="inline">zip</code></a> module has been updated with support for:</p><ul><li>zip64 archives - Archives larger than 4GB or with more than 2^32 entries.</li><li>extended timestamps - Higher resolution and in UTC.</li><li>UID/GID - Save and extract the original UID/GID.</li><li>Fixes so that permission mode attributes are correctly read and set for files in archives.</li><li><a href="../../apps/stdlib/zip.html#list_dir/2"><code class="inline">zip:list_dir/2</code></a> now also returns directories, not only files. (You can disable this behaviour by using the option <code class="inline">skip_directories</code>).</li></ul><p>Various bugs in the original implementation have also been fixed, such as:</p><ul><li>Correctly encode and decode the DOS timestamps for entries within an archive (that is the non-extended timestamp).</li><li>Fix DOS timestamps to be set to localtime instead of UTC (use extended timestamps for UTC timestamps).</li><li>Use the unix file attributes read from disk when creating archives instead of setting everything to 644.</li></ul><p>Own Id: OTP-19214 Aux Id: <a href="https://github.com/erlang/otp/pull/8765" title="">PR-8765</a></p></li></ul><h2 id="erts-15-0-1" class="section-heading"><a href="#erts-15-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 15.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-13" class="section-heading"><a href="#fixed-bugs-and-malfunctions-13" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In rare circumstances the JIT could do an unsafe in-place update of a tuple.</p><p>Own Id: OTP-19108 Aux Id: <a href="https://github.com/erlang/otp/pull/8539" title="">PR-8539</a></p></li><li><p>When a port command crashed in the inet driver during <a href="../../apps/kernel/gen_tcp.html#send/2"><code class="inline">gen_tcp:send/2</code></a>, a monitor <code class="inline">'DOWN'</code> message could be left lingering in the caller's mailbox. This has now been fixed.</p><p>Own Id: OTP-19121 Aux Id: <a href="https://github.com/erlang/otp/issues/8484" title="">GH-8484</a></p></li><li><p><code class="inline">'DOWN'</code> messages originating from a monitored port, contained the atom <code class="inline">process</code> instead of the atom <code class="inline">port</code> as the third element when the exit reason was not an immediate term.</p><p>Own Id: OTP-19123 Aux Id: <a href="https://github.com/erlang/otp/issues/8484" title="">GH-8484</a>, <a href="https://github.com/erlang/otp/pull/8546" title="">PR-8546</a></p></li><li><p>Fix so that the options to enable Transparent Huge Page alignment of the Erlang VM executable are only applied to the Erlang VM and not other native programs such as <code class="inline">erlc</code> and <code class="inline">dialyzer</code>. This bug was introduced in Erlang/OTP 27.0.</p><p>Own Id: OTP-19137 Aux Id: <a href="https://github.com/erlang/otp/issues/8574" title="">GH-8574</a></p></li><li><p>When <a href="time_correction.html#no-time-warp-mode"><em>no time warp mode</em></a> was enabled, a smaller Erlang monotonic time could be read than a previously read time, i.e., breaking the monotonic property. The runtime system will abort when detecting an issue like this since OTP 24.3.4.17 and OTP 25.0.</p><p>Up until OTP 25 <em>no time warp mode</em> is the default. As of OTP 26 <a href="time_correction.html#multi-time-warp-mode"><em>multi time warp mode</em></a> is the default.</p><p>Own Id: OTP-19147 Aux Id: ERIERL-1043, ERIERL-1106, <a href="https://github.com/erlang/otp/pull/8619" title="">PR-8619</a></p></li><li><p>When calling <code class="inline">trace:function(Session, _, true, [meta])</code> the meta tracer was incorrectly set to be the calling process. Now it's set to the session tracer as expected.</p><p>Own Id: OTP-19151 Aux Id: <a href="https://github.com/erlang/otp/pull/8616" title="">PR-8616</a>, <a href="https://github.com/erlang/otp/issues/8614" title="">GH-8614</a></p></li></ul><h2 id="erts-15-0" class="section-heading"><a href="#erts-15-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 15.0</span></h2><h3 id="fixed-bugs-and-malfunctions-14" class="section-heading"><a href="#fixed-bugs-and-malfunctions-14" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Bugs in how <code class="inline">erl -extra</code> interacts with passing flags via ERL_*FLAGS or <code class="inline">-args_file</code> have been fixed.</p><p>Own Id: OTP-18766 Aux Id: <a href="https://github.com/erlang/otp/pull/7639" title="">PR-7639</a></p></li><li><p>Fixed a bug that prevented the emulator from building on recent versions of Yocto Linux.</p><p>Own Id: OTP-18918 Aux Id: <a href="https://github.com/erlang/otp/pull/7952" title="">PR-7952</a></p></li><li><p>Fixed spectre mitigation configure test to work with GCC patches to always add <code class="inline">-fcf-protection=full</code>.</p><p>Own Id: OTP-18928 Aux Id: <a href="https://github.com/erlang/otp/pull/8006" title="">PR-8006</a></p></li><li><p>A  call to <code class="inline">socket:[recv|recvfrom|recvmsg]/*</code> with Timeout = 0 on Windows could cause a (case clause) crash if data is immediately available.</p><p>Own Id: OTP-19063 Aux Id: OTP-18835</p></li><li><p>Fix bug on Windows where <code class="inline">exit_status</code> would not be sent when a port exits after the stdin/stdout handles have been closed.</p><p>Own Id: OTP-19077 Aux Id: <a href="https://github.com/erlang/otp/pull/8324" title="">PR-8324</a></p></li></ul><h3 id="improvements-and-new-features-3" class="section-heading"><a href="#improvements-and-new-features-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Refactored how the JIT handles POSIX signals and how they affect thread stacks, allowing us to use the native stack register for Erlang stacks on more platforms.</p><p>Notably, containers built on 64-bit x86 Alpine Linux images will now perform much better in sequential code. As an example, running <code class="inline">dialyzer</code> over the OTP code base finishes about 15% quicker.</p><p>Own Id: OTP-18568 Aux Id: <a href="https://github.com/erlang/otp/pull/7174" title="">PR-7174</a></p></li><li><p>The <a href="../../apps/runtime_tools/instrument.html"><code class="inline">instrument</code></a> module can now track allocations on a per-process or per-port basis.</p><p>Own Id: OTP-18577 Aux Id: <a href="https://github.com/erlang/otp/pull/7236" title="">PR-7236</a></p></li><li><p>The <code class="inline">pid</code> field returned from <a href="erlang.html#fun_info/2"><code class="inline">erlang:fun_info/1,2</code></a> is now always the pid for the <code class="inline">init</code> process of the local node, not the pid for the actual process that created the fun.</p><p><strong><em> POTENTIAL INCOMPATIBILITY </em></strong></p><p>Own Id: OTP-18594 Aux Id: <a href="https://github.com/erlang/otp/pull/7274" title="">PR-7274</a></p></li><li><p>By default, escripts will now be compiled instead of interpreted. That means that the <code class="inline">compiler</code> application must be installed.</p><p><strong><em> POTENTIAL INCOMPATIBILITY </em></strong></p><p>Own Id: OTP-18639 Aux Id: <a href="https://github.com/erlang/otp/pull/7348" title="">PR-7348</a></p></li><li><p>A binary returned from the <a href="../../apps/kernel/socket.html"><code class="inline">socket</code></a> receive functions is no longer created as a sub binary of an often large receive buffer binary (socket option <code class="inline">{otp,rcvbuf}</code>).  This avoids space waste, trusting the allocators to implement reallocation efficiently.</p><p>Own Id: OTP-18642 Aux Id: <a href="https://github.com/erlang/otp/issues/6152" title="">GH-6152</a>, <a href="https://github.com/erlang/otp/pull/7465" title="">PR-7465</a></p></li><li><p>The default process limit has been raised to <code class="inline">1048576</code> processes.</p><p>Own Id: OTP-18699 Aux Id: <a href="https://github.com/erlang/otp/pull/7388" title="">PR-7388</a></p></li><li><p>The <a href="erlang.html#system_monitor/2"><code class="inline">erlang:system_monitor/2</code></a> functionality is now able to monitor long message queues in the system.</p><p>Own Id: OTP-18709 Aux Id: <a href="https://github.com/erlang/otp/pull/7651" title="">PR-7651</a></p></li><li><p>The <code class="inline">erl</code> command now supports the <code class="inline">-S</code> flag, which is similar to the <code class="inline">-run</code> flag, except that it will pass all arguments up to end of the command line to the called function. (The <code class="inline">-run</code> flag will not pass arguments beginning with a hyphen.) Another difference is that <code class="inline">-S</code> will always call a function with one argument, passing an empty list if no arguments were given.</p><p>Own Id: OTP-18744 Aux Id: <a href="https://github.com/erlang/otp/pull/7470" title="">PR-7470</a></p></li><li><p>When implementing an alternative carrier for the Erlang distribution, a separate input handler process may now be registered, using <a href="erlang.html#dist_ctrl_input_handler/2"><code class="inline">erlang:dist_ctrl_input_handler/2</code></a>, also in the case when the distribution controller is a port.</p><p>Own Id: OTP-18774 Aux Id: <a href="https://github.com/erlang/otp/pull/7110" title="">PR-7110</a></p></li><li><p>The call stack trace has now been added to the error reported by <a href="erlang.html#process_flag/2"><code class="inline">erlang:process_flag/2</code></a> when <code class="inline">max_heap_size</code> limit has been exceeded.</p><p>Own Id: OTP-18779 Aux Id: <a href="https://github.com/erlang/otp/pull/7592" title="">PR-7592</a></p></li><li><p><code class="inline">-callback</code> attributes have been added to <a href="erl_tracer.html"><code class="inline">erl_tracer</code></a>.</p><p>Own Id: OTP-18794 Aux Id: <a href="https://github.com/erlang/otp/pull/7703" title="">PR-7703</a></p></li><li><p>For <code class="inline">inet_backend = socket</code>, setting the <code class="inline">active</code> socket option alone, to <code class="inline">once</code>, <code class="inline">true</code> or <code class="inline">N</code> has been optimized, as well as the corresponding data delivery.</p><p>Own Id: OTP-18835</p></li><li><p>New functions <code class="inline">socket:sendv/*</code> for sending I/O vectors have been added.</p><p>Own Id: OTP-18845</p></li><li><p>Socket options that take string now also accept binaries.</p><p>Own Id: OTP-18849 Aux Id: <a href="https://github.com/erlang/otp/pull/6510" title="">PR-6510</a></p></li><li><p>Native coverage support has been implemented in the JIT. It will  automatically be used by the <a href="../../apps/tools/cover.html"><code class="inline">cover</code></a> tool to reduce the execution overhead when running cover-compiled code.</p><p>There are also new APIs to support native coverage without using the <code class="inline">cover</code> tool.</p><p>To instrument code for native coverage it must be compiled with the <a href="../../apps/compiler/compile.html#line_coverage"><code class="inline">line_coverage</code></a> option.</p><p>To enable native coverage in the runtime system, start it like so:</p><pre><code class="text">$ erl +JPcover true</code></pre><p>There are also the following new functions for supporting native coverage:</p><ul><li><a href="../../apps/kernel/code.html#coverage_support/0"><code class="inline">code:coverage_support/0</code></a></li><li><a href="../../apps/kernel/code.html#get_coverage/2"><code class="inline">code:get_coverage/2</code></a></li><li><a href="../../apps/kernel/code.html#reset_coverage/1"><code class="inline">code:reset_coverage/1</code></a></li><li><a href="../../apps/kernel/code.html#get_coverage_mode/0"><code class="inline">code:get_coverage_mode/0</code></a></li><li><a href="../../apps/kernel/code.html#get_coverage_mode/1"><code class="inline">code:get_coverage_mode/1</code></a></li><li><a href="../../apps/kernel/code.html#set_coverage_mode/1"><code class="inline">code:set_coverage_mode/1</code></a></li></ul><p>Own Id: OTP-18856 Aux Id: <a href="https://github.com/erlang/otp/pull/7856" title="">PR-7856</a></p></li><li><p>Changed the default value of the command line flag <code class="inline">-code_path_choice</code> to <code class="inline">strict</code>. </p><p>Note that for application systems using archives, it is necessary to add the <code class="inline">code_path_choice relaxed</code> to the command line that invokes <code class="inline">erl</code>.</p><p>Own Id: OTP-18894 Aux Id: <a href="https://github.com/erlang/otp/pull/7243" title="">PR-7243</a></p></li><li><p>Added module loading to <code class="inline">erl -init_debug</code> printouts.</p><p>Own Id: OTP-18929 Aux Id: <a href="https://github.com/erlang/otp/pull/8004" title="">PR-8004</a></p></li><li><p>When the runtime system halts, it performs various flush operations before terminating. By default there is no limit on how much time the flush operations are allowed to take. A new <em>halt flush timeout</em> functionality has been introduced which can be used for limiting the amount of time that the flushing operations are allowed to take. For more information see the documentation of the <a href="erlang.html#halt_flush_timeout"><code class="inline">flush_timeout</code></a> option of the <a href="erlang.html#halt/2"><code class="inline">erlang:halt/2</code></a> BIF and the documentation of the <code class="inline">erl</code> <a href="erl_cmd.html#+zhft"><code class="inline">+zhft &lt;Timeout&gt;</code></a> command line flag.</p><p>Own Id: OTP-18938 Aux Id: <a href="https://github.com/erlang/otp/pull/8035" title="">PR-8035</a>, <a href="https://github.com/erlang/otp/issues/7438" title="">GH-7438</a></p></li><li><p>Optimized code loading by moving certain operations from the code server to the caller.</p><p>Own Id: OTP-18941 Aux Id: <a href="https://github.com/erlang/otp/pull/7981" title="">PR-7981</a></p></li><li><p>Updated asmjit to version a465fe71ab3d0e224b2b4bd0fac69ae68ab9239d</p><p>Own Id: OTP-18942</p></li><li><p>The deprecated functions in <a href="zlib.html"><code class="inline">zlib</code></a> have been removed. That includes <code class="inline">inflateChunk/{1,2}</code>, <code class="inline">getBufSize/1</code>, <code class="inline">setBufSize/2</code>, the CRC32 functions, and the Adler checksum functions.</p><p>Own Id: OTP-18950</p></li><li><p>The documentation has been migrated to use Markdown and ExDoc.</p><p>Own Id: OTP-18955 Aux Id: <a href="https://github.com/erlang/otp/pull/8026" title="">PR-8026</a></p></li><li><p>Safe destructive update of tuples has been implemented in the compiler and runtime system. This allows the VM to update tuples in-place when it is safe to do so, thus improving performance by doing less copying but also by producing less garbage.</p><p>Example:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="5034782142-1">(</span><span class="ss">rec</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5034782142-2">{</span><span class="ss">a</span><span class="p">,</span><span class="ss">b</span><span class="p">,</span><span class="ss">c</span><span class="p" data-group-id="5034782142-2">}</span><span class="p" data-group-id="5034782142-1">)</span><span class="p">.</span><span class="w">

</span><span class="nf">update</span><span class="p" data-group-id="5034782142-3">(</span><span class="o">#</span><span class="ss">rec</span><span class="p" data-group-id="5034782142-4">{</span><span class="ss">a</span><span class="o">=</span><span class="ss">needs_update</span><span class="p">,</span><span class="ss">b</span><span class="o">=</span><span class="n">N</span><span class="p" data-group-id="5034782142-4">}</span><span class="o">=</span><span class="n">R0</span><span class="p" data-group-id="5034782142-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R0</span><span class="o">#</span><span class="ss">rec</span><span class="p" data-group-id="5034782142-5">{</span><span class="ss">a</span><span class="o">=</span><span class="ss">up_to_date</span><span class="p" data-group-id="5034782142-5">}</span><span class="p">,</span><span class="w">
    </span><span class="k">if</span><span class="w">
        </span><span class="n">N</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">R</span><span class="o">#</span><span class="ss">rec</span><span class="p" data-group-id="5034782142-6">{</span><span class="ss">c</span><span class="o">=</span><span class="ss">negative</span><span class="p" data-group-id="5034782142-6">}</span><span class="p">;</span><span class="w">
        </span><span class="n">N</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">R</span><span class="o">#</span><span class="ss">rec</span><span class="p" data-group-id="5034782142-7">{</span><span class="ss">c</span><span class="o">=</span><span class="ss">zero</span><span class="p" data-group-id="5034782142-7">}</span><span class="p">;</span><span class="w">
        </span><span class="n">N</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">R</span><span class="o">#</span><span class="ss">rec</span><span class="p" data-group-id="5034782142-8">{</span><span class="ss">c</span><span class="o">=</span><span class="ss">positive</span><span class="p" data-group-id="5034782142-8">}</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span></code></pre><p>The record updates in each of the three clauses of the <code class="inline">if</code> can safely be done in-place, because variable <code class="inline">R</code> is not used again.</p><p>Own Id: OTP-18972 Aux Id: <a href="https://github.com/erlang/otp/pull/8090" title="">PR-8090</a></p></li><li><p>The obsolete and undocumented support for opening a port to an external
resource by passing an atom (or a string) as first argument to
<a href="erlang.html#open_port/2"><code class="inline">open_port()</code></a>, implemented by the vanilla driver,
has been removed. This feature has been scheduled for removal in OTP 27
since the release of OTP 26.</p><p>Own Id: OTP-18976 Aux Id: <a href="https://github.com/erlang/otp/pull/7125" title="">PR-7125</a></p></li><li><p>An optional NIF callback <code class="inline">ERL_NIF_OPT_ON_UNLOAD_THREAD</code> to be called by all scheduler threads when a NIF library is unloaded. Used for releasing thread specific data. Can be set with function <code class="inline">enif_set_option</code>.</p><p>Own Id: OTP-18977 Aux Id: <a href="https://github.com/erlang/otp/pull/7809" title="">PR-7809</a></p></li><li><p>There is a new module <a href="../../apps/kernel/trace.html"><code class="inline">trace</code></a> in Kernel providing the same trace functionality as <a href="erlang.html#trace/3"><code class="inline">erlang:trace/3</code></a> and <a href="erlang.html#trace_pattern/3"><code class="inline">erlang:trace_pattern/3</code></a>, but with the addition of <strong>dynamic isolated trace sessions</strong>.</p><p>Own Id: OTP-18980</p></li><li><p>Added the <code class="inline">+MMlp on|off</code> emulator option to let the <code class="inline">mseg</code> allocator use &quot;large pages&quot; (sometimes known as &quot;huge pages&quot; or &quot;super pages&quot;). This currently only affects super-carrier allocations, but may be extended in the future.</p><p>Own Id: OTP-18984 Aux Id: <a href="https://github.com/erlang/otp/pull/7977" title="">PR-7977</a></p></li><li><p><code class="inline">inet_backend = socket</code> has been optimized and reworked to be more compatible with the original <code class="inline">inet_backend = inet</code>.</p><p>Own Id: OTP-19004 Aux Id: OTP-18835</p></li><li><p>The <code class="inline">socket</code> documentation has been reworked, and due to
that a few details were fixed:</p><ul><li><a href="../../apps/kernel/socket.html#is_supported/1"><code class="inline">socket:is_supported/1</code></a> now returns <code class="inline">true</code> for example for <code class="inline">protocols</code>
that is a &quot;category&quot;, not an item.</li><li><a href="../../apps/kernel/socket.html#cancel_monitor/1"><code class="inline">socket:cancel_monitor/1</code></a> no longer badargs for a monitor that was set by
another process, instead it returns <code class="inline">false</code> as for other unknown
<code class="inline">reference()</code>s.</li></ul><p>Own Id: OTP-19054</p></li></ul><h2 id="erts-14-2-5-10" class="section-heading"><a href="#erts-14-2-5-10" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2.5.10</span></h2><h3 id="fixed-bugs-and-malfunctions-15" class="section-heading"><a href="#fixed-bugs-and-malfunctions-15" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed an emulator crash when setting an error_handler module that was not yet loaded.</p><p>Own Id: OTP-19577 Aux Id: ERIERL-1220, PR-9696</p></li><li><p>Fixed a rare bug that could cause an emulator crash after unloading a module or erasing a persistent_term.</p><p>Own Id: OTP-19599 Aux Id: PR-9724</p></li></ul><h2 id="erts-14-2-5-9" class="section-heading"><a href="#erts-14-2-5-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2.5.9</span></h2><h3 id="fixed-bugs-and-malfunctions-16" class="section-heading"><a href="#fixed-bugs-and-malfunctions-16" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Behavior for socket:recv/3 has been improved. The behavior has also been clarified in the documentation.</p><p>Own Id: OTP-19469 Aux Id: #9172</p></li><li><p>Fix <code class="inline">prim_inet:send/3</code> (and in extension <code class="inline">gen_tcp:send/2,3</code>) to use the selective recive optimization when waiting for a send acknowledgement.</p><p>Own Id: OTP-19493 Aux Id: PR-9443</p></li><li><p>Trace messages due to <code class="inline">receive</code> tracing could potentially be delayed a very long time if the traced process waited in a <code class="inline">receive</code> expression without clauses matching on messages (timed wait), or just did not enter a <code class="inline">receive</code> expression for a very long time.</p><p>Own Id: OTP-19527 Aux Id: PR-9577</p></li><li><p>Improve the naming of the (internal) esock mutex(es). It is now possible to configure (as in autoconf) the use of simple names for the esock mutex(es).</p><p>Own Id: OTP-19548 Aux Id: OTP-19472</p></li></ul><h2 id="erts-14-2-5-8" class="section-heading"><a href="#erts-14-2-5-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2.5.8</span></h2><h3 id="fixed-bugs-and-malfunctions-17" class="section-heading"><a href="#fixed-bugs-and-malfunctions-17" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed BEAM crash when a custom thread sends a large map (&gt;128 keys) externally encoded with for example <code class="inline">erl_drv_send_term()</code>.</p><p>Own Id: OTP-19495 Aux Id: GH-8208, PR-8209</p></li></ul><h2 id="erts-14-2-5-7" class="section-heading"><a href="#erts-14-2-5-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2.5.7</span></h2><h3 id="fixed-bugs-and-malfunctions-18" class="section-heading"><a href="#fixed-bugs-and-malfunctions-18" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Disabled an unsafe runtime optimization in binary construction that caused silent memory corruption.</p><p>Own Id: OTP-19462 Aux Id: ERIERL-1177, PR-9372</p></li></ul><h2 id="erts-14-2-5-6" class="section-heading"><a href="#erts-14-2-5-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2.5.6</span></h2><h3 id="fixed-bugs-and-malfunctions-19" class="section-heading"><a href="#fixed-bugs-and-malfunctions-19" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed configure tests for GCC 14</p><p>Own Id: OTP-19407 Aux Id: GH-9211, PR-9234</p></li></ul><h2 id="erts-14-2-5-5" class="section-heading"><a href="#erts-14-2-5-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2.5.5</span></h2><h3 id="fixed-bugs-and-malfunctions-20" class="section-heading"><a href="#fixed-bugs-and-malfunctions-20" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix lock order violation if a NIF monitor <code class="inline">down</code> callback calls <code class="inline">enif_whereis_pid</code>. Would cause debug emulator to crash but could potentially lead to deadlocks in optimized emulator.</p><p>Own Id: OTP-19330 Aux Id: GH-8983, PR-9008</p></li><li><p>gen_udp:send on domain local can leak inet_reply messages.</p><p>Own Id: OTP-19332 Aux Id: #8989</p></li><li><p>net:getifaddrs does not properly report the running flag on windows.</p><p>Own Id: OTP-19366 Aux Id: OTP-19061, ERIERL-1134</p></li></ul><h2 id="erts-14-2-5-4" class="section-heading"><a href="#erts-14-2-5-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2.5.4</span></h2><h3 id="fixed-bugs-and-malfunctions-21" class="section-heading"><a href="#fixed-bugs-and-malfunctions-21" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A bug has been fixed where receiving an SCTP message with `gen_sctp` could waste the first fragments of a message and only deliver the last fragment.</p><p>This happened with low probability when the OS signaled that the socket was ready for reading in combination with an internal time-out retry.</p><p>A bug has been fixed with a lingering time-out from after an SCTP connect that could stop the flow of incoming messages on an active `gen_tcp` socket.</p><p>Own Id: OTP-19235 Aux Id: ERIERL-1133, PR-8837</p></li><li><p>On Windows, successive failed socket calls caused socket to become &quot;uninitialized&quot;.</p><p>Own Id: OTP-19251 Aux Id: GH-8853</p></li><li><p>The socket framework fails to start on a IPv6-only Windows machine.</p><p>Own Id: OTP-19254 Aux Id: GH-8848</p></li><li><p>An boolean option `non_block_send` for SCTP, has ben added to be able to achieve the old behaviour to avoid blocking send operations by passing the OS network stack error message (`{error,eagain}` through.</p><p>Own Id: OTP-19258 Aux Id: OTP-19061, ERIERL-1134</p></li><li><p>The call `gen_tcp:send/2` could hang indefinitely despite having set the `send_timeout` option for the following unfortunate combination of circumstances:</p><p>* The socket has to be in passive mode. <em> All output buffers had to be filled util the `high_watermark` was hit, causing the `gen_tcp:send/2` operation to block. </em> While the send operation was blocked, a `gen_tcp:recv/2,3` call had to be done from a different process. It had to block, waiting for data for a while before completing the operation, and the received packet had to fill at least 75% of the receive buffer.</p><p>Under these circumstances he information that a send operation was waiting got lost, so the send operation that blocked in the first placed would never return. The data it had would be sent, though, and send operations from other processes, still work.</p><p>This bug has been fixed.</p><p>Own Id: OTP-19267 Aux Id: GH-6455, OTP-18520, ERIERL-1138, PR-8892</p></li><li><p>Fixed beam crash that could happen if resetting <code class="inline">call_time</code> or <code class="inline">call_memory</code> trace counters of a function while it is called. Bug exists since OTP R16.</p><p>Own Id: OTP-19269 Aux Id: GH-8835, PR-8897</p></li></ul><h2 id="erts-14-2-5-3" class="section-heading"><a href="#erts-14-2-5-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2.5.3</span></h2><h3 id="fixed-bugs-and-malfunctions-22" class="section-heading"><a href="#fixed-bugs-and-malfunctions-22" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A race in the kTLS flavour of SSL distribution has been fixed so inet_drv.c doesn't read ahead too much data which could cause the kTLS encryption to be activated too late when some encrypted data had already been read into the inet_drv.c buffer as unencrypted.</p><p>Own Id: OTP-19175 Aux Id: GH-8561, PR-8690</p></li></ul><h2 id="erts-14-2-5-2" class="section-heading"><a href="#erts-14-2-5-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2.5.2</span></h2><h3 id="fixed-bugs-and-malfunctions-23" class="section-heading"><a href="#fixed-bugs-and-malfunctions-23" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>When <a href="time_correction.html#no-time-warp-mode"><em>no time warp mode</em></a> was enabled, a smaller Erlang monotonic time could be read than a previously read time, i.e., breaking the monotonic property. The runtime system will abort when detecting an issue like this since OTP 24.3.4.17 and OTP 25.0.</p><p>Up until OTP 25 <em>no time warp mode</em> is the default. As of OTP 26 <a href="time_correction.html#multi-time-warp-mode"><em>multi time warp mode</em></a> is the default.</p><p>Own Id: OTP-19147 Aux Id: ERIERL-1043, ERIERL-1106, PR-8619</p></li><li><p>A scheduler thread could get stuck when deleting a memory allocator carrier when adjacent carriers were deleted and/or inserted simultaneously by other schedulers. This in turn could cause the other schedulers to get stuck as well.</p><p>Own Id: OTP-19154 Aux Id: GH-8613, PR-8627</p></li></ul><h2 id="erts-14-2-5-1" class="section-heading"><a href="#erts-14-2-5-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2.5.1</span></h2><h3 id="fixed-bugs-and-malfunctions-24" class="section-heading"><a href="#fixed-bugs-and-malfunctions-24" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A call to socket:[recv|recvfrom|recvmsg]/* with Timeout = 0 on Windows could cause a (case clause) crash if data is immediately available.</p><p>Own Id: OTP-19063 Aux Id: OTP-18835</p></li><li><p>When a port command crashed in the inet driver during <a href="../../apps/kernel/gen_tcp.html#send/2"><code class="inline">gen_tcp:send/2</code></a>, a monitor <code class="inline">'DOWN'</code> message could be left lingering in the caller's mailbox. This has now been fixed.</p><p>Own Id: OTP-19121 Aux Id: GH-8484</p></li><li><p><code class="inline">'DOWN'</code> messages originating from a monitored port, contained the atom <code class="inline">process</code> instead of the atom <code class="inline">port</code> as the third element when the exit reason was not an immediate term.</p><p>Own Id: OTP-19123 Aux Id: GH-8484, PR-8546</p></li></ul><h2 id="erts-14-2-5" class="section-heading"><a href="#erts-14-2-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2.5</span></h2><h3 id="fixed-bugs-and-malfunctions-25" class="section-heading"><a href="#fixed-bugs-and-malfunctions-25" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><a href="../../apps/kernel/gen_sctp.html#send/4"><code class="inline">gen_sctp:send/3,4</code></a> now waits for the send to complete instead of returning an OS result such as <code class="inline">{error,Â ewouldblock}</code>.</p><p>Own Id: OTP-19061</p></li><li><p>ETS functions did not properly handle keys containing maps, sometimes matching too many or too few objects.</p><p>Own Id: OTP-19070 Aux Id: GH-8385</p></li><li><p>Fix CPU quota determination for cgroups.</p><p>The bug was introduced through OTP-18999.</p><p>Own Id: OTP-19071 Aux Id: OTP-18999 PR-8380</p></li></ul><h3 id="improvements-and-new-features-4" class="section-heading"><a href="#improvements-and-new-features-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Added a warning to open_port/2 regarding the BadBatBut attack affecting Windows.</p><p>Own Id: OTP-19069</p></li></ul><h2 id="erts-14-2-4" class="section-heading"><a href="#erts-14-2-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2.4</span></h2><h3 id="fixed-bugs-and-malfunctions-26" class="section-heading"><a href="#fixed-bugs-and-malfunctions-26" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed CPU quota determination for cgroup version 2</p><p>Own Id: OTP-18999 Aux Id: GH-7928</p></li><li><p>Fix faulty reduction counting in exiting process which could cause it to do unnecessary yielding.</p><p>Own Id: OTP-19014</p></li><li><p>Fix bug in <a href="../../apps/stdlib/re.html#run/3"><code class="inline">re:run/3</code></a> where if an invalid UTF-8 subject was given, re:run could get stuck in an infinite loop. Bug was introduced in Erlang/OTP 22.1.</p><p>Own Id: OTP-19015 Aux Id: ERIERL-682</p></li><li><p>On AArch64 (ARM64), Erlang code using bit syntax construction compiled using Erlang/OTP 24 could crash the runtime system when run in Erlang/OTP 26.2.3.</p><p>Own Id: OTP-19021 Aux Id: GH-8238, PR-8248</p></li><li><p>Calling <a href="erlang.html#trace/3"><code class="inline">erlang:trace/3</code></a> with first argument one of <code class="inline">ports</code>, <code class="inline">processes</code>, <code class="inline">existing_ports</code>, <code class="inline">existing_processes</code>, <code class="inline">existing</code> or <code class="inline">all</code>, could cause emulator crash if a dirty scheduler was executing a simultaneous trace action.</p><p>Own Id: OTP-19034</p></li><li><p>Fixed an integer overflow when the monotonic time unit reported by the operating system was greater than 10 and lower than 100 microseconds.</p><p>Own Id: OTP-19036 Aux Id: GH-8186</p></li><li><p>Fix option reuseaddr for FreeBSD 14</p><p>Own Id: OTP-19041</p></li><li><p>When a traced process executing on a dirty scheduler received an exit signal, the dirty scheduler could use the wrong thread specific data which could lead to a crash.</p><p>Own Id: OTP-19043 Aux Id: PR-8342</p></li><li><p>Fixed a more or less harmless bug that caused time correction of Erlang monotonic time to become slightly off on Windows platforms when <code class="inline">QueryPerformanceCounter()</code> was used as OS monotonic time source.</p><p><code class="inline">erlang:system_info(os_monotonic_time_source)</code> now also returns information about <em>used resolution</em> which not always corresponds to the resolution of the OS monotonic time source.</p><p>Own Id: OTP-19048 Aux Id: PR-8343</p></li><li><p>When using IPv6, classic gen_udp failed to add (group) membership (drop was used instead).</p><p>Own Id: OTP-19049 Aux Id: #8176</p></li><li><p>Fix bug on Windows where &quot;Unknown event: 2&quot; would be printed to the console.</p><p>Own Id: OTP-19060</p></li></ul><h3 id="improvements-and-new-features-5" class="section-heading"><a href="#improvements-and-new-features-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Checks for monotonicity of monotonic time have been improved so that Erlang and OS monotonic time are checked separately.</p><p>A new <code class="inline">configure</code> argument <code class="inline">--enable-ensure-os-monotonic-time</code> has also been added. It enables functionality ensuring the monotonicity of monotonic timestamps delivered by the OS. When a non-monotonic timestamp is detected, it will be replaced by the last delivered monotonic timestamp before being used by Erlang's time functionality. Note that you do <em>not</em> want to enable this unless the OS monotonic time source on the system fails to produce monotonic timestamps. This since ensuring the monotonicity of OS monotonic timestamps will hurt scalability and performance of the system.</p><p>Own Id: OTP-19044 Aux Id: ERIERL-1043, PR-8342</p></li><li><p>For severe errors, when the `socket` module terminates the Erlang VM, now an erl_crash.dump is produced, to facilitate post mortem debugging.</p><p>Own Id: OTP-19058</p></li></ul><h2 id="erts-14-2-3" class="section-heading"><a href="#erts-14-2-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2.3</span></h2><h3 id="fixed-bugs-and-malfunctions-27" class="section-heading"><a href="#fixed-bugs-and-malfunctions-27" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed compile warning in erl_nif.c for gcc-13.</p><p>Own Id: OTP-18906 Aux Id: PR-7930</p></li><li><p>Fix C++ compile error for macros <code class="inline">enif_select_read</code> and friends.</p><p>Own Id: OTP-18907 Aux Id: PR-7932</p></li><li><p>Fixed a name clash on Solaris that prevented the JIT from being built.</p><p>Own Id: OTP-18940 Aux Id: GH-8024</p></li><li><p>Fix termcap detection on solaris.</p><p>Own Id: OTP-18952 Aux Id: PR-8025</p></li><li><p>Fix heap corruption bug that could cause runaway memory consumption due to circular offheap list at process exit. Other symptoms may also be possible. Bug exists since OTP 25.0.</p><p>Own Id: OTP-18971 Aux Id: GH-8044</p></li><li><p>Do not clear tracing in old module instance if load fails with 'not_purged'.</p><p>Own Id: OTP-18979</p></li><li><p>When exceeding the `max_heap_size` limit in a garbage collection initiated by some bit syntax operations, the process would not always terminate immediately.</p><p>Own Id: OTP-18982</p></li><li><p>The code server could be hanging if a module with <code class="inline">on_load</code> function was loaded at the same time as another module was purged using <code class="inline">erlang:purge_module</code> directly.</p><p>Own Id: OTP-19006</p></li><li><p>A process optimized for parallel signal delivery could under some circumstances lose wakeup information. That is, the processes was not woken up to take care of the signal, so the signal would not be taken care of until the process was woken by another signal. Only processes configured with <a href="erlang.html#process_flag_message_queue_data"><code class="inline">message_queue_data</code></a> set to <code class="inline">off_heap</code> utilize this optimization.</p><p>Own Id: OTP-19008 Aux Id: GH-8119, PR-8201</p></li><li><p>Fix segfault when generating crashdump containing a fun places in persistent_term storage.</p><p>Own Id: OTP-19009 Aux Id: PR-8181</p></li><li><p>By default the JIT is disabled on Intel Macs, because of annoying poups on macOS Sonoma. It is now possible to explicitly enable the JIT on Intel Macs. Here is how: <code class="inline">./configure --enable-jit</code></p><p>Own Id: OTP-19011</p></li></ul><h2 id="erts-14-2-2" class="section-heading"><a href="#erts-14-2-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2.2</span></h2><h3 id="fixed-bugs-and-malfunctions-28" class="section-heading"><a href="#fixed-bugs-and-malfunctions-28" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>32-bit runtime systems on most Unix like platforms could crash if a BIF timer was set with a huge timeout of more than 68 years into the future. In order for the crash to occur, the huge timer (at a later time than when it was set) had to become the nearest active timer set on the specific scheduler on which it was set. This could not happen on a system with only one scheduler since there would always be shorter timers in the system.</p><p>Setting a timer larger than 49 days on Windows could under rare circumstances cause the timeout to be delayed.</p><p>Own Id: OTP-18911 Aux Id: ERIERL-1023, PR-7983</p></li><li><p>Fix bug where the system installed openssl/md5.h would be confused with the vendored md5.h.</p><p>Own Id: OTP-18931 Aux Id: GH-7987 PR-7989</p></li><li><p>The JIT has now been disabled on x86 Macs to prevent annoying the &quot;verifying shm-xyz&quot; popups introduced in MacOS Sonoma.</p><p>ARM Macs are unaffected.</p><p>Own Id: OTP-18949</p></li><li><p>Garbage collection of a process on a dirty scheduler could collide with signal handling for that process causing a crash of the runtime system. This bug was introduced in OTP 25.3.2.8 and OTP 26.2.</p><p>Own Id: OTP-18957 Aux Id: GH-8051, PR-8088, OTP-18841</p></li></ul><h2 id="erts-14-2-1" class="section-heading"><a href="#erts-14-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-29" class="section-heading"><a href="#fixed-bugs-and-malfunctions-29" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Removed unnecessary PCRE source tar-ball.</p><p>Own Id: OTP-18902</p></li></ul><h2 id="erts-14-2" class="section-heading"><a href="#erts-14-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.2</span></h2><h3 id="fixed-bugs-and-malfunctions-30" class="section-heading"><a href="#fixed-bugs-and-malfunctions-30" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix erl.exe to to restore the console to its original state when exiting. This
bug was introduced in OTP 26.0 and only happens when erl.exe is run in
cmd.exe.</p><p>Own Id: OTP-18751 Aux Id: GH-7621 GH-7548</p></li><li><p>Fix faulty debug assert when page size is larger than 16kb, like on PowerPC.
Did crash debug VM directly at start.</p><p>Own Id: OTP-18802</p></li><li><p><code class="inline">zlib</code> will no longer randomly return garbage (negative) Adler32 checksums.</p><p>Own Id: OTP-18811 Aux Id: ERIERL-994</p></li><li><p>Replaced unintentional Erlang Public License 1.1 headers in some files with
the intended Apache License 2.0 header.</p><p>Own Id: OTP-18815 Aux Id: PR-7780</p></li><li><p>A process with <code class="inline">message_queue_data</code> configured as <code class="inline">off_heap</code> could end up in
an inconsistent state when being <code class="inline">receive</code> traced, inspected using
<a href="erlang.html#process_info/2"><code class="inline">process_info/2</code></a> with the <code class="inline">message_queue_len</code> item, or
inspected using the break menu (CTRL-C). When it ended up in this inconsistent
state, it was not enqueued into a run queue even though it was set in a
runnable state.This also effected signals being sent to the process after it
had gotten into this inconsistent state, in such a way that it was from this
point not possible to communicate with it.</p><p>Own Id: OTP-18838 Aux Id: PR-7822, GH-7801</p></li><li><p>A race occurring when a process was selected for dirty execution
simultaneously as it was scheduled for handling a signal could cause the
process to end up in an inconsistent state. When it ended up in this
inconsistent state, it was not enqueued into a run queue even though it was
set in a runnable state. This also effected signals being sent to the process
after it had gotten into this inconsistent state, in such a way that it was
from this point not possible to communicate with it.</p><p>Own Id: OTP-18839 Aux Id: PR-7822, GH-7801</p></li><li><p>When a process had to to wait in the run queue for a long time before being
selected for dirty execution, it could not receive signals. This caused
inspection of such a process, for example using
<a href="erlang.html#process_info/2"><code class="inline">process_info/2</code></a>, to take a long time.</p><p>This issue was introduced in OTP 25.3.2.6 and 26.1 when fixing an issue where
a constant flow of signals prevented a process from being able to execute
dirty.</p><p>Own Id: OTP-18841 Aux Id: PR-7822, GH-7801, OTP-18737</p></li><li><p>Fixed a bug in the JIT that miscompiled large <code class="inline">select_val</code> instructions.</p><p>Own Id: OTP-18842</p></li><li><p>Fix bug on Windows where large writes to <code class="inline">standard_io</code> could cause duplicate
data to be written.</p><p>Own Id: OTP-18871 Aux Id: GH-7838</p></li><li><p>The <code class="inline">struct ip_mreqn</code> field <code class="inline">imr_ifindex</code> had got an incorrect byte order
conversion that has been corrected.</p><p>Own Id: OTP-18880 Aux Id: GH-7736, PR-7761</p></li><li><p>On OTP 24 and OTP 25, incoming distributed messages larger than 64 KiB sent
using an alias leaked memory if the alias had been removed prior to entering
the node. This issue was not present on OTP 26.</p><p>Incoming distributed messages larger than 64 KiB sent using an alias which had
been removed on the receiving node could crash the node. This crash was quite
unlikely on OTP 24 and OTP 25, but very likely on OTP 26.</p><p><code class="inline">'DOWN'</code> signals with exit reason larger than 64 KiB directed towards a
process on a node with a not matching creation leaked memory on the receiving
node. Such signals should however be very rare.</p><p>Own Id: OTP-18885 Aux Id: GH-7834, GH-7890, PR-7915</p></li></ul><h3 id="improvements-and-new-features-6" class="section-heading"><a href="#improvements-and-new-features-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Add Windows support for DGRAM socket connect.</p><p>Own Id: OTP-18762</p></li><li><p><a href="erlang.html#process_info/2"><code class="inline">process_info/2</code></a> now supports lookup of values for
specific keys in the process dictionary. For example,
<code class="inline">{{dictionary, Key}, Value} = process_info(Pid, {dictionary, Key})</code>.</p><p>Own Id: OTP-18765 Aux Id: PR-7707</p></li><li><p>Removed unnecessary regexp library used when generating yielding BIFs.</p><p>Own Id: OTP-18830 Aux Id: PR-7823</p></li><li><p>Fix tty restore when <code class="inline">+Bc</code> is used.</p><p>Own Id: OTP-18872 Aux Id: GH-7832</p></li><li><p>Replaced old md5 implementation with an implementation from OpenSSL.</p><p>Own Id: OTP-18877</p></li><li><p>Removed unused <code class="inline">makewhatis</code> script.</p><p>Own Id: OTP-18899</p></li></ul><h2 id="erts-14-1-1" class="section-heading"><a href="#erts-14-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-31" class="section-heading"><a href="#fixed-bugs-and-malfunctions-31" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>If the external term format encoding of an argument list part of a distributed
spawn operation was faulty, the newly spawned remote process could misbehave.
The misbehavior included hanging or interpret an incoming message as an
argument list to use. This was very unlikely to happen unless using an
alternate implementation of the distribution protocol which made a faulty
encoding of the argument list. The child process will now detect this error
and terminate before executing the user specified code.</p><p>Own Id: OTP-18790 Aux Id: PR-7742</p></li><li><p>Fix bugs where if the body of a matchspec would return a map with a variable
('$1', '$_' etc) as one of the keys or values and the variable was not an
immidiate, the term would not be copied to the receiving processes heap. This
would later corrupt the term in the table as the GC could place move markers
in it, which in turn would cause the VM to crash.</p><p>Bug has been present for since OTP 17.0.</p><p>Own Id: OTP-18797 Aux Id: PR-7712 GH-7683</p></li></ul><h2 id="erts-14-1" class="section-heading"><a href="#erts-14-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.1</span></h2><h3 id="fixed-bugs-and-malfunctions-32" class="section-heading"><a href="#fixed-bugs-and-malfunctions-32" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>maps:put with existing key and identical value was not optimized as a no-op
correctly if having the same 32-bit hash as another key in the map. In
practice very rare and harmless.</p><p>Own Id: OTP-18592</p></li><li><p>Fixed an issue with truncated crash slogans on failed emulator start.</p><p>Own Id: OTP-18623 Aux Id: GH-7344</p></li><li><p>Fixed a bug where the emulator was unable to determine the current <code class="inline">cgroup</code>
CPU quota.</p><p>Own Id: OTP-18645 Aux Id: GH-7401</p></li><li><p>A process optimized for parallel signal delivery could under some
circumstances lose wakeup information. That is, the processes was not woken up
to take care of the signal, so the signal would not be taken care of until the
process was woken by another signal. Only processes configured with
<a href="erlang.html#process_flag_message_queue_data"><code class="inline">message_queue_data</code></a> set to
<code class="inline">off_heap</code> utilize this optimization.</p><p>Own Id: OTP-18647 Aux Id: PR-7595</p></li><li><p>Function socket:close/1 could cause a VM crash on Windows.</p><p>Own Id: OTP-18669 Aux Id: OTP-18029</p></li><li><p>Fixed a bug in the ARM JIT where it could accidentally add garbage trailing
bits when creating bitstrings whose size wasn't an even multiple of 8 bits.</p><p>Own Id: OTP-18672 Aux Id: GH-7469</p></li><li><p>Fix <a href="erlang.html#system_info/1"><code class="inline">erlang:system_info/1</code></a> documentation to show correct types.</p><p>Own Id: OTP-18674 Aux Id: PR-7472</p></li><li><p>Expanded the documentation about how to use the <code class="inline">standard_io</code>,
<code class="inline">standard_error</code> and <code class="inline">user</code> I/O devices.</p><p>Added the types <a href="../../apps/stdlib/io.html#t:standard_io/0"><code class="inline">io:standard_io/0</code></a>,
<code class="inline">io:standard:error/0</code> and <a href="../../apps/stdlib/io.html#t:user/0"><code class="inline">io:user/0</code></a>.</p><p>Own Id: OTP-18676 Aux Id: PR-7473 GH-7459</p></li><li><p>Fix compilation with GNU termcap.</p><p>Own Id: OTP-18702 Aux Id: GH-7381</p></li><li><p>Delivery time of message signals to a process not executing any <code class="inline">receive</code>
expressions could become very long, potentially infinite. For example, a
process checking for messages using
<a href="erlang.html#process_info/2"><code class="inline">process_info(self(), message_queue_len)</code></a> or
<a href="erlang.html#process_info/2"><code class="inline">process_info(self(), messages)</code></a> and avoiding to execute a
<code class="inline">receive</code> expression matching on messages could be very slow in detecting new
messages. Note that you are still discouraged from using <code class="inline">process_info()</code> this
way. A process that wants to check if there are messages available to handle
should execute a <code class="inline">receive</code> expression matching on messages.</p><p>Own Id: OTP-18706 Aux Id: GH-7413, PR-7595, ERIERL-979</p></li><li><p>On AArch64 (ARM64), when calculating both the quotient and remainder with a
divisor begin a power two, the remainder could be incorrectly calculated.</p><p>Own Id: OTP-18724 Aux Id: GH-7566, PR-7567</p></li><li><p>Fix bug causing &quot;magic&quot; references in a <code class="inline">compressed</code> ETS table to not keep the
referred object alive. The symptom would be the referred object being garbage
collected prematurely and the reference appearing stale, not referring to
anything. Examples of such magically referred objects are <code class="inline">atomics</code> and NIF
resources.</p><p>Own Id: OTP-18732 Aux Id: GH-7444, PR-7458</p></li><li><p>Matching out short bitstrings with a fixed size not divisible by 8 could could
lead to the runtime system terminating with an &quot;Overrun heap and stack&quot; error.</p><p>Own Id: OTP-18733 Aux Id: GH-7292</p></li><li><p>A constant flow of incoming non-message signals could prevent a process
needing to execute dirty from doing so.</p><p>Own Id: OTP-18737 Aux Id: PR-7595</p></li><li><p>A BEAM file usually contains a chunk with the tag &quot;Type&quot; containing type
information that can be used by the JIT. The <a href="../../apps/stdlib/beam_lib.html#strip/1"><code class="inline">beam_lib:strip/1</code></a> takes care to
preserve that chunk, but a build/release tool that does customized stripping
could accidentally remove the chunk. Loading a BEAM file without the &quot;Type&quot;
chunk could cause incorrect behavior of the loaded code.</p><p>Own Id: OTP-18745 Aux Id: GH-7492, PR-7616</p></li><li><p><code class="inline">gen_udp:recv/*</code> for Unix Domain Socket in binary mode and passive mode has
been fixed to not crash.</p><p>Own Id: OTP-18747 Aux Id: GH-7605</p></li><li><p>The cleanup operation of not yet delivered signals to a terminated process
yielded excessively.</p><p>Own Id: OTP-18752 Aux Id: PR-7633</p></li><li><p>Fixed minor hashing issue with the <code class="inline">local</code> option of
<code class="inline">term_to_binary()</code>/<code class="inline">term_to_iovec()</code>.</p><p>Own Id: OTP-18753 Aux Id: PR-7634</p></li></ul><h3 id="improvements-and-new-features-7" class="section-heading"><a href="#improvements-and-new-features-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Update gen_tcp_socket and gen_udp_socket to handle 'completion' (socket on
Windows).</p><p>Own Id: OTP-18586 Aux Id: OTP-18029</p></li><li><p>Add support for Unix Domain Sockets (only for STREAM sockets) on Windows for
'socket'.</p><p>Own Id: OTP-18611 Aux Id: OTP-18029, #5024</p></li><li><p>In Erlang/OTP 27, by default escripts will be compiled before being executed.
That means that the <code class="inline">compiler</code> application must be installed. It is possible
to force the escript to be interpreted by adding the directive
<code class="inline">-mode(interpret).</code> to the escript file.</p><p>In Erlang/OTP 28, support for interpreting an escript will be removed.</p><p>Own Id: OTP-18638</p></li><li><p>Add basic support for socket ioctl on Windows.</p><p>Own Id: OTP-18660</p></li><li><p>Removed erts/etc/darwin/Info.plist, as it is no longer necessary after macos
10.12</p><p>Own Id: OTP-18661 Aux Id: PR-6112</p></li><li><p>Add support for (Windows) socket option exclusiveaddruse.</p><p>Own Id: OTP-18686</p></li><li><p>[socket] Add support for the 'nopush' option.</p><p>Own Id: OTP-18687</p></li><li><p>Add support for socket option 'BSP STATE'.</p><p>Own Id: OTP-18693</p></li><li><p>Add tcp socket options 'keepcnt', 'keepidle' and 'keepintvl'.</p><p>Own Id: OTP-18698</p></li><li><p>Add support for misc (Windows) socket options ('max_msg_size' and 'maxdg').</p><p>Own Id: OTP-18710</p></li></ul><h2 id="erts-14-0-2" class="section-heading"><a href="#erts-14-0-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.0.2</span></h2><h3 id="fixed-bugs-and-malfunctions-33" class="section-heading"><a href="#fixed-bugs-and-malfunctions-33" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix using the IME (Input Method Editor) to enter text in cmd.exe and
powershell.exe on Windows.</p><p>Own Id: OTP-18630 Aux Id: PR-7275 GH-7029</p></li><li><p>Multiple socket:accept calls issue. When making multiple accept calls, only
the last call is active.</p><p>Own Id: OTP-18635 Aux Id: #7328</p></li><li><p>Fix the shell to ignore terminal delay when the terminal capabilities report
that they should be used.</p><p>Own Id: OTP-18636 Aux Id: PR-7352 GH-7308</p></li><li><p>Fix &quot;oldshell&quot; to echo characters while typing on Windows.</p><p>Own Id: OTP-18637 Aux Id: PR-7359 GH-7324</p></li><li><p>On Windows, a call to the function socket:close, when there are waiting active
calls to read, write or accept functions, could hang.</p><p>Own Id: OTP-18646</p></li><li><p>Fix issues when reading or configuring <code class="inline">standard_io</code> on Windows when erl.exe
is started using <code class="inline">-noshell</code> flag.</p><p>Own Id: OTP-18649 Aux Id: GH-7261 PR-7400</p></li><li><p>The following functions are now much faster when given a long list or binary:</p><ul><li>erlang:list_to_integer/1</li><li>erlang:binary_to_integer/1</li><li>erlang:binary_to_integer/2</li><li>erlang:list_to_integer/2</li><li>string:to_integer/1</li></ul><p>Own Id: OTP-18659 Aux Id: PR-7426</p></li><li><p>On AArch64 (ARM64), equality and non-equality tests with literal bitstrings
could succeed when they should fail and vice versa.</p><p>Own Id: OTP-18663 Aux Id: GH-7433, PR-7437</p></li></ul><h2 id="erts-14-0-1" class="section-heading"><a href="#erts-14-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-34" class="section-heading"><a href="#fixed-bugs-and-malfunctions-34" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Build of the socket nif failed on Solaris 11.</p><p>Own Id: OTP-18585 Aux Id: OTP-18029</p></li><li><p>Fixed two reduction-counting bugs relating to binaries.</p><p>Own Id: OTP-18587</p></li><li><p>Constructing a binary segment not aligned with a byte boundary, with a size
not fitting in 31 bits, and with a value not fitting in a 64-bit word could
crash the runtime system.</p><p>Own Id: OTP-18597</p></li><li><p>When a binary construction failed because of bad size for a segment, the error
information was not always correct.</p><p>Own Id: OTP-18602 Aux Id: GH-7282</p></li><li><p>Fixed a crash when calling a fun that was defined in a module that had been
upgraded.</p><p>Own Id: OTP-18621 Aux Id: GH-7288</p></li></ul><h2 id="erts-14-0" class="section-heading"><a href="#erts-14-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 14.0</span></h2><h3 id="fixed-bugs-and-malfunctions-35" class="section-heading"><a href="#fixed-bugs-and-malfunctions-35" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>If a local fun was called while reloading the <em>exact same</em> module that defined
said fun, there was a small window in which the call would land in code that
was yet to be fully loaded.</p><p>Own Id: OTP-18016</p></li><li><p>Fix the TLS distribution to work when starting Erlang in embedded mode and a
connection is done before kernel is fully started.</p><p>Own Id: OTP-18248 Aux Id: PR-6227 GH-6085</p></li><li><p>erl <code class="inline">-remsh</code> has been improved to provide better error reasons and work when
using a shell without terminal support (that is an &quot;oldshell&quot;).</p><p>Own Id: OTP-18271 Aux Id: PR-6279</p></li><li><p>Fix so that <code class="inline">-fno-omit-frame-pointer</code> is applied to all of the Erlang VM when
using the JIT so that tools, such as perf, can crawl the process stacks.</p><p>Own Id: OTP-18274 Aux Id: PR-6048</p></li><li><p>Compilation server now support unicode paths in compilation server for
filesystems that are encoded with unicode.</p><p>Own Id: OTP-18277 Aux Id: PR-6306</p></li><li><p>Reintroduced the optimization that turned anonymous functions without free
variables into literals (OTP-15195). This optimization was lost during
refactoring in OTP 24.</p><p>Alongside this fix, we plan to remove the &quot;fun creator pid&quot; feature in OTP 27.
See
<a href="../../upcoming_incompatibilities.html#fun_creator_pid">Upcoming Potential Incompatibilities</a>
for more details.</p><p>Own Id: OTP-18498</p></li><li><p>Fixed a crash during tracing on certain platforms that cannot use the machine
stack for Erlang code (mainly OpenBSD and Linux with musl).</p><p>Own Id: OTP-18561</p></li></ul><h3 id="improvements-and-new-features-8" class="section-heading"><a href="#improvements-and-new-features-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The <a href="erl_nif.html#enif_set_option"><code class="inline">enif_set_option()</code></a> function has been
introduced into the NIF API. It can be used in order to set the
<a href="erl_nif.html#delay_halt"><code class="inline">ERL_NIF_OPT_DELAY_HALT</code></a> and/or
<a href="erl_nif.html#on_halt"><code class="inline">ERL_NIF_OPT_ON_HALT</code></a> options with which one can
synchronize halt of the runtime system with flushing enabled and execution of
NIFs.
<a href="erlang.html#halt/2">Halt of the runtime system <em>without</em> flushing enabled</a>, now
terminates the runtime system without execution of <code class="inline">atexit</code>/<code class="inline">on_exit</code> handlers
that may have been installed into the runtime system which might be considered
a potential incompatibility.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-17771 Aux Id: GH-5325, PR-6370</p></li><li><p>The TTY/terminal subsystem has been rewritten by moving more code to Erlang
from the old linked-in driver and implementing all the I/O primitives needed
in a NIF instead.</p><p>On Unix platforms the user should not notice a lot of difference, besides
better handling of unicode characters and fixing of some long standing bugs.</p><p>Windows users will notice that erl.exe has the same functionality as a normal
Unix shell and that werl.exe has been removed and replaced with a symlink to
erl.exe. This makes the Windows Erlang terminal experience identical to that
of Unix.</p><p>The re-write brings with it a number of bug fixes and feature additions:</p><ul><li>The TTY is now reset when Erlang exits, fixing zsh to not break when
terminating an Erlang session.</li><li><code class="inline">standard_error</code> now uses the same unicode mode as <code class="inline">standard_io</code>.</li><li>Hitting backspace when searching the shell history with an empty search
string no longer breaks the shell.</li><li>Tab expansion now works on remote nodes started using the JCL interface.</li><li>It is now possible to configure the shell slogan and the session slogans
(that is the texts that appear when you start an Erlang shell). See the
kernel documentation for more details.</li><li>Added shell:start_interactive for starting the interactive shell from a
non-interactive Erlang session (for example an escript).</li><li>On Windows, when starting in detached mode the standard handler are now set
to <code class="inline">nul</code> devices instead of being unset.</li><li>Standard I/O now always defaults to <code class="inline">unicode</code> mode if supported. Previously
the default was <code class="inline">latin1</code> if the runtime system had been started with
<code class="inline">-oldshell</code> or <code class="inline">-noshell</code> (for example in an <code class="inline">escript</code>). To send raw bytes
over standard out, one now explicitly has to specify
<code class="inline">io:setopts(standard_io, [{encoding, latin1}]).</code></li></ul><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-17932 Aux Id: PR-6144 GH-3150 GH-3390 GH-4343 GH-4225</p></li><li><p>Add support for socket on Windows.</p><ul><li>Pre release status.</li><li>Error codes not finalized.</li><li>No explicit support for Windows specific options (socket options, flags for
read and write).</li><li>New async api for Windows (completion). See the <code class="inline">Asynchronous calls</code> chapter
in the (Socket Usage) Users Guide.</li><li>To ensure platform independence, gen<em>tcp and gen_udp is _intended</em> to be
used (not yet updated).</li></ul><p>Own Id: OTP-18029</p></li><li><p>Updated configure cache for Windows. This makes configure run faster on
Windows as many more checks are cached.</p><p>Own Id: OTP-18053 Aux Id: PR-6101</p></li><li><p>Optimized record updates.</p><p>Own Id: OTP-18126 Aux Id: PR-6033</p></li><li><p>Optimized internal hash routines.</p><p>Own Id: OTP-18131</p></li><li><p>As announced when OTP 25 was released,
<a href="time_correction.html#multi-time-warp-mode">multi time warp mode</a> is now enabled
by default. This assumes that all code executing on the system is
<a href="time_correction.html#time-warp-safe-code">time warp safe</a>.</p><p>If you have old code in the system that is not time warp safe, you now
explicitly need to start the system in
<a href="time_correction.html#no-time-warp-mode">no time warp mode</a> (or
<a href="time_correction.html#single-time-warp-mode">singe time warp mode</a> if it is
partially time warp safe) in order to avoid problems. When starting the system
in no time warp mode, the system behaves as it did prior to the introduction
of the extended time functionality introduced in OTP 18.</p><p>If you have code that is not time warp safe, you are strongly encouraged to
change this so that you can use multi time warp mode. Compared to no time warp
mode, multi time warp mode improves scalability and performance as well as
accuracy and precision of time measurements.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-18135 Aux Id: GH-4965, PR-6046</p></li><li><p>There are several new optimization for binary syntax in the JIT:</p><ul><li>Creation and matching of binaries with segments of fixed sizes have been
optimized.</li><li>Creation and matching of UTF-8 segments have been optimized.</li><li>Appending to binaries has been optimized.</li></ul><p>Own Id: OTP-18137 Aux Id: PR-6259, PR-6404, PR-6576, PR-6804</p></li><li><p>As announced since the release of OTP 24, support for:</p><ul><li>version 4 node container types in the external term format are now
mandatory. That is, references supporting up to 5 32-bit integer
identifiers, and process and port identifiers with support for 64-bit data
storage. The distribution flag
<a href="erl_dist_protocol.html#DFLAG_V4_NC"><code class="inline">DFLAG_V4_NC</code></a> is therefor now also
mandatory. OTP has since OTP 24 supported this. Also note that the external
format produced by <code class="inline">term_to_binary()</code> and <code class="inline">term_to_iovec()</code> will
unconditionally produce pids, ports, and references supporting this larger
format.</li><li>the <a href="erl_dist_protocol.html#new_link_protocol">new link protocol</a> introduced
in OTP 23.3 is now mandatory. The distribution flag
<a href="erl_dist_protocol.html#DFLAG_UNLINK_ID"><code class="inline">DFLAG_UNLINK_ID</code></a> is therefor now
also mandatory.</li></ul><p>Due to the above, OTP 26 nodes will refuse to connect to OTP nodes from
releases prior to OTP 24.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-18140 Aux Id: PR-6072</p></li><li><p>Optimization of
<a href="../../system/ref_man_processes.html#process-aliases"><em>process aliases</em></a> made
possible now that support for
<a href="erl_dist_protocol.html#DFLAG_V4_NC">version 4 node container types</a> in the
external term format is mandatory.</p><p>Own Id: OTP-18141 Aux Id: OTP-18140, PR-6073</p></li><li><p>The compiler and JIT now generate better code for creation of small maps where
all keys are literals known at compile time.</p><p>Own Id: OTP-18185 Aux Id: GH-6139</p></li><li><p>When <code class="inline">erl -eval</code> fails to execute a command, an error description is printed
to standard_error.</p><p>Own Id: OTP-18227 Aux Id: PR-6254</p></li><li><p>Support for UTF-8 atoms and strings in the NIF interface including new
functions <code class="inline">enif_make_new_atom</code>, <code class="inline">enif_make_new_atom_len</code> and
<code class="inline">enif_get_string_length</code>.</p><p>Own Id: OTP-18334 Aux Id: PR-6434</p></li><li><p>The following <a href="../../apps/kernel/inet.html#setopts/2"><code class="inline">inet:setopts/2</code></a> options have been introduced:</p><ul><li><p><strong><a href="../../apps/kernel/inet.html#option-reuseport"><code class="inline">reuseport</code></a></strong> - Reuse of local port. Load
balancing may or may not be provided depending on underlying OS.</p></li><li><p><strong><a href="../../apps/kernel/inet.html#option-reuseport_lb"><code class="inline">reuseport_lb</code></a></strong> - Reuse of local port.
Load balancing provided.</p></li><li><p><strong><a href="../../apps/kernel/inet.html#option-exclusiveaddruse"><code class="inline">exclusiveaddruse</code></a></strong> - Exclusive
address/port usage on Windows. This socket option is Windows specific and
will silently be ignored on other systems.</p></li></ul><p>The behavior of setting <a href="../../apps/kernel/inet.html#option-reuseaddr"><code class="inline">reuseaddr</code></a> on Windows
have changed in a <em>backwards incompatible</em> way. The underlying <code class="inline">SO_REUSEADDR</code>
socket option is now only set if both the <code class="inline">reusaddr</code> and the <code class="inline">reuseport</code>
<code class="inline">inet</code> options have been set. This since the underlying <code class="inline">SO_REUSEADDR</code> socket
option on Windows behaves similar to how BSD behaves if both the underlying
socket options <code class="inline">SO_REUSEADDR</code> and <code class="inline">SO_REUSEPORT</code> have been set. See the
documentation of the <code class="inline">reuseaddr</code> option for more information.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-18344 Aux Id: PR-6522, PR-6944, OTP-18324, PR-6481, GH-6461</p></li><li><p><a href="erlang.html#display/1"><code class="inline">erlang:display/1</code></a> will now print large maps in a more readable way (similar
to how small maps are printed).</p><p>Own Id: OTP-18360 Aux Id: PR-6497</p></li><li><p>The BIFs <a href="erlang.html#min/2"><code class="inline">min/2</code></a> and <a href="erlang.html#max/2"><code class="inline">max/2</code></a> are now allowed to be used
in guards and match specs.</p><p>Own Id: OTP-18367 Aux Id: GH-6544</p></li><li><p>Fail <code class="inline">enif_init_resource_type</code> and friends by returning NULL if not called
during load/upgrade. Old behavior was undefined.</p><p>Own Id: OTP-18369</p></li><li><p>New option <code class="inline">include_shared_binaries</code> for the <code class="inline">max_heap_size</code> process limit. If
set to <code class="inline">true</code>, large binaries (&gt; 64 bytes), which may be referred by several
processes, are included in the memory sum compared against the <code class="inline">max_heap_size</code>
limit.</p><p>Own Id: OTP-18410 Aux Id: GH-5889, PR-6345</p></li><li><p>Map comprehensions as suggested in EEP 58 has now been implemented.</p><p>Own Id: OTP-18413 Aux Id: EEP-58, PR-6727</p></li><li><p>Some map operations have been optimized by changing the internal sort order of
atom keys. This changes the (undocumented) order of how atom keys in small
maps are printed and returned by <a href="../../apps/stdlib/maps.html#to_list/1"><code class="inline">maps:to_list/1</code></a> and <a href="../../apps/stdlib/maps.html#next/1"><code class="inline">maps:next/1</code></a>. The new
order is unpredictable and may change between different invocations of the
Erlang VM.</p><p>For applications where order is important, there is a new function
<a href="../../apps/stdlib/maps.html#iterator/2"><code class="inline">maps:iterator/2</code></a> for creating iterators that return the map elements in a
deterministic order. There are also new modifiers <code class="inline">k</code> and <code class="inline">K</code> for the format
string for <a href="../../apps/stdlib/io.html#t:format/0"><code class="inline">io:format()</code></a> to support printing map elements
ordered.</p><p>Own Id: OTP-18414 Aux Id: PR-6151</p></li><li><p>Reduced memory usage of <code class="inline">file:read_file_info/1,2</code></p><p>Own Id: OTP-18424 Aux Id: PR-6716</p></li><li><p>Add new function <code class="inline">current_stacktrace</code> for trace match specifications used by
<a href="erlang.html#trace_pattern/3"><code class="inline">erlang:trace_pattern/3</code></a>.</p><p>This new option puts the current stacktrace of the caller into the trace
message sent to the trace receiver.</p><p>Own Id: OTP-18425 Aux Id: PR-6628, GH-5333</p></li><li><p>The amount of significant bits in node local process identifiers and port
identifiers has been extended from 28 bits to 60 bits on 64-bit runtime
systems. This makes these identifiers large enough to in practice never having
to be reused during the life time of a node.</p><p>Own Id: OTP-18435 Aux Id: PR-6827</p></li><li><p>New trace feature <code class="inline">call_memory</code>. Similar to <code class="inline">call_time</code> tracing, but instead
of measure accumulated time in traced functions it measures accumulated heap
space consumed by traced functions. It can be used to compare how much
different functions are contributing to garbage collection being triggered.</p><p>Own Id: OTP-18440 Aux Id: PR-6351</p></li><li><p>It is no longer necessary to enable a feature in the runtime system in order
to load modules that are using it. It is sufficient to enable the feature in
the compiler when compiling it.</p><p>That means that to use feature <code class="inline">maybe_expr</code> in Erlang/OTP 26, it is sufficient
to enable it during compilation.</p><p>In Erlang/OTP 27, feature <code class="inline">maybe_expr</code> will be enabled by default, but it will
be possible to disable it.</p><p>Own Id: OTP-18445</p></li><li><p>Handling of <code class="inline">on_load</code> modules during boot has been improved by adding an extra
step in the boot order for embedded mode that runs all <code class="inline">on_load</code> handlers,
instead of relying on explicit invocation of them, later, when the kernel
supervision tree starts.</p><p>This is mostly a code improvement and OTP internal simplification to avoid
future bugs and to simplify code maintenance.</p><p>Own Id: OTP-18447</p></li><li><p>Introduced the <a href="erlang.html#term_to_binary_local"><code class="inline">local</code></a> option of
<a href="erlang.html#term_to_binary/2"><code class="inline">term_to_binary/2</code></a> and
<a href="erlang.html#term_to_iovec/2"><code class="inline">term_to_iovec/2</code></a>.</p><p>Own Id: OTP-18477 Aux Id: PR-7006</p></li><li><p>Document the commonly used practice to create and store static atoms at NIF
load time in callbacks <code class="inline">load</code> or <code class="inline">upgrade</code>.</p><p>Own Id: OTP-18483 Aux Id: PR-6888</p></li><li><p>Optimize <code class="inline">ets:lookup_element</code> for uncompressed tables by using a more
efficient method to copy the term from ETS to the heap of the calling process.</p><p>Own Id: OTP-18493 Aux Id: PR-6272</p></li><li><p>The default encoding of atoms by <code class="inline">term_to_binary</code> and <code class="inline">term_to_iovec</code> have
changed from Latin1 to UTF-8. The old encoding can still be obtained with
options <code class="inline">{minor_version, 1}</code>.</p><p>Apart from encoding code points between 128 and 255 with two bytes (UTF-8)
instead of one, most atoms will occupy one less byte as the length field use
only one byte instead of two if possible.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-18505 Aux Id: PR-6991</p></li><li><p>The version of zlib included in the Erlang/OTP source code is now 1.2.13.</p><p>Own Id: OTP-18517</p></li><li><p><code class="inline">gen_tcp:send/*</code>, <code class="inline">gen_udp:send/*</code> and <code class="inline">gen_sctp:send/*</code> have been optimized
to use the infamous receive reference optimization, so now sending should not
have bad performance when the calling process has a large message queue.</p><p>Own Id: OTP-18520 Aux Id: GH-6455</p></li><li><p>Added the new built-in type <a href="erlang.html#t:dynamic/0"><code class="inline">dynamic/0</code></a> introduced in EEP-61, improving
support for gradual type checkers.</p><p>Own Id: OTP-18522</p></li><li><p>Optimize <a href="../../apps/stdlib/maps.html#merge/2"><code class="inline">maps:merge/2</code></a> memory consumption for small maps (&lt;33 keys) by
reusing key tuples or entire maps if the result map has the same number of
keys as any of the argument maps.</p><p>Own Id: OTP-18523 Aux Id: PR-7004</p></li><li><p>Optimize <a href="../../apps/stdlib/maps.html#merge/2"><code class="inline">maps:merge/2</code></a> memory consumption further for small maps by mutating
2nd map to use literal key tuple of 1st map if both have the same keys.</p><p>Own Id: OTP-18524 Aux Id: PR-7004, OTP-18523</p></li><li><p><a href="erlang.html#ceil/1"><code class="inline">ceil/1</code></a>, <a href="erlang.html#floor/1"><code class="inline">floor/1</code></a>,
<a href="erlang.html#is_bitstring/1"><code class="inline">is_bitstring/1</code></a>, <a href="erlang.html#is_boolean/1"><code class="inline">is_boolean/1</code></a>,
<a href="erlang.html#is_function/2"><code class="inline">is_function/2</code></a>, and <a href="erlang.html#tuple_size/1"><code class="inline">tuple_size/1</code></a> can
now be used in match specifications.</p><p>Own Id: OTP-18526 Aux Id: GH-7045</p></li><li><p>Allow IPv6 addresses as host in <code class="inline">http</code> packets decoded by
<a href="erlang.html#decode_packet/3"><code class="inline">erlang:decode_packet/3</code></a> and <code class="inline">gen_tcp</code> packet option. The IPv6 address should
be enclosed within <code class="inline">[]</code> according to RFC2732.</p><p>Own Id: OTP-18540 Aux Id: PR-6900</p></li><li><p>Removed the experimental <code class="inline">erts_alloc_config</code> module. It no longer produced
good configurations and cannot be fixed in a reasonably backwards compatible
manner. It has since OTP 25 been deprecated and scheduled for removal in
OTP 26.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-18549 Aux Id: PR-7105</p></li><li><p>ERTS internal thread names have been changed. All threads created by ERTS now
have a prefix <code class="inline">erts_</code> followed by a type name potentially followed by an
integer index. For example, normal schedulers are now named <code class="inline">erts_sched_&lt;IX&gt;</code>,
dirty CPU schedulers <code class="inline">erts_dcpus_&lt;IX&gt;</code>, and dirty IO schedulers
<code class="inline">erts_dios_&lt;IX&gt;</code>. NIF and driver thread names are truncated at 15 characters
regardless of whether the underlying platform support more characters or not.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-18552 Aux Id: PR-6973</p></li><li><p>Further robustify implementation of large maps (&gt; 32 keys). Keys that happen
to have same internal 32-bit hash values are now put in collision nodes which
are traversed with linear search. This removes the demand for the internal
hash function when salted to eventually produce different hashes for all
possible pairs of unequal terms.</p><p>Own Id: OTP-18569</p></li><li><p>In Erlang/OTP 27, <code class="inline">0.0</code> will no longer be considered to be exactly equal to
<code class="inline">-0.0</code>. See
<a href="../../upcoming_incompatibilities.html#float_matching">Upcoming Potential Incompatibilities</a>.</p><p>Own Id: OTP-18574</p></li></ul><h2 id="erts-13-2-2-16" class="section-heading"><a href="#erts-13-2-2-16" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.16</span></h2><h3 id="fixed-bugs-and-malfunctions-36" class="section-heading"><a href="#fixed-bugs-and-malfunctions-36" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed an emulator crash when setting an error_handler module that was not yet loaded.</p><p>Own Id: OTP-19577 Aux Id: ERIERL-1220, PR-9696</p></li><li><p>Fixed a rare bug that could cause an emulator crash after unloading a module or erasing a persistent_term.</p><p>Own Id: OTP-19599 Aux Id: PR-9724</p></li></ul><h2 id="erts-13-2-2-15" class="section-heading"><a href="#erts-13-2-2-15" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.15</span></h2><h3 id="fixed-bugs-and-malfunctions-37" class="section-heading"><a href="#fixed-bugs-and-malfunctions-37" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Trace messages due to <code class="inline">receive</code> tracing could potentially be delayed a very long time if the traced process waited in a <code class="inline">receive</code> expression without clauses matching on messages (timed wait), or just did not enter a <code class="inline">receive</code> expression for a very long time.</p><p>Own Id: OTP-19527 Aux Id: PR-9577</p></li></ul><h2 id="erts-13-2-2-14" class="section-heading"><a href="#erts-13-2-2-14" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.14</span></h2><h3 id="fixed-bugs-and-malfunctions-38" class="section-heading"><a href="#fixed-bugs-and-malfunctions-38" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed BEAM crash when a custom thread sends a large map (&gt;128 keys) externally encoded with for example <code class="inline">erl_drv_send_term()</code>.</p><p>Own Id: OTP-19495 Aux Id: GH-8208, PR-8209</p></li></ul><h2 id="erts-13-2-2-13" class="section-heading"><a href="#erts-13-2-2-13" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.13</span></h2><h3 id="fixed-bugs-and-malfunctions-39" class="section-heading"><a href="#fixed-bugs-and-malfunctions-39" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Disabled an unsafe runtime optimization in binary construction that caused silent memory corruption.</p><p>Own Id: OTP-19462 Aux Id: ERIERL-1177, PR-9372</p></li></ul><h2 id="erts-13-2-2-12" class="section-heading"><a href="#erts-13-2-2-12" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.12</span></h2><h3 id="fixed-bugs-and-malfunctions-40" class="section-heading"><a href="#fixed-bugs-and-malfunctions-40" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix lock order violation if a NIF monitor <code class="inline">down</code> callback calls <code class="inline">enif_whereis_pid</code>. Would cause debug emulator to crash but could potentially lead to deadlocks in optimized emulator.</p><p>Own Id: OTP-19330 Aux Id: GH-8983, PR-9008</p></li></ul><h2 id="erts-13-2-2-11" class="section-heading"><a href="#erts-13-2-2-11" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.11</span></h2><h3 id="fixed-bugs-and-malfunctions-41" class="section-heading"><a href="#fixed-bugs-and-malfunctions-41" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed beam crash that could happen if resetting <code class="inline">call_time</code> or <code class="inline">call_memory</code> trace counters of a function while it is called. Bug exists since OTP R16.</p><p>Own Id: OTP-19269 Aux Id: GH-8835, PR-8897</p></li></ul><h2 id="erts-13-2-2-10" class="section-heading"><a href="#erts-13-2-2-10" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.10</span></h2><h3 id="fixed-bugs-and-malfunctions-42" class="section-heading"><a href="#fixed-bugs-and-malfunctions-42" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><code class="inline">'DOWN'</code> messages originating from a monitored port, contained the atom <code class="inline">process</code> instead of the atom <code class="inline">port</code> as the third element when the exit reason was not an immediate term.</p><p>Own Id: OTP-19123 Aux Id: GH-8484, PR-8546</p></li><li><p>When <a href="time_correction.html#no-time-warp-mode"><em>no time warp mode</em></a> was enabled, a smaller Erlang monotonic time could be read than a previously read time, i.e., breaking the monotonic property. The runtime system will abort when detecting an issue like this since OTP 24.3.4.17 and OTP 25.0.</p><p>Up until OTP 25 <em>no time warp mode</em> is the default. As of OTP 26 <a href="time_correction.html#multi-time-warp-mode"><em>multi time warp mode</em></a> is the default.</p><p>Own Id: OTP-19147 Aux Id: ERIERL-1043, ERIERL-1106, PR-8619</p></li><li><p>A scheduler thread could get stuck when deleting a memory allocator carrier when adjacent carriers were deleted and/or inserted simultaneously by other schedulers. This in turn could cause the other schedulers to get stuck as well.</p><p>Own Id: OTP-19154 Aux Id: GH-8613, PR-8627</p></li></ul><h2 id="erts-13-2-2-9" class="section-heading"><a href="#erts-13-2-2-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.9</span></h2><h3 id="fixed-bugs-and-malfunctions-43" class="section-heading"><a href="#fixed-bugs-and-malfunctions-43" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>ETS functions did not properly handle keys containing maps, sometimes matching too many or too few objects.</p><p>Own Id: OTP-19070 Aux Id: GH-8385</p></li><li><p>Fix CPU quota determination for cgroups.</p><p>The bug was introduced through OTP-18999.</p><p>Own Id: OTP-19071 Aux Id: OTP-18999 PR-8380</p></li></ul><h2 id="erts-13-2-2-8" class="section-heading"><a href="#erts-13-2-2-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.8</span></h2><h3 id="fixed-bugs-and-malfunctions-44" class="section-heading"><a href="#fixed-bugs-and-malfunctions-44" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed CPU quota determination for cgroup version 2</p><p>Own Id: OTP-18999 Aux Id: GH-7928</p></li><li><p>Fix faulty reduction counting in exiting process which could cause it to do unnecessary yielding.</p><p>Own Id: OTP-19014</p></li><li><p>Calling <a href="erlang.html#trace/3"><code class="inline">erlang:trace/3</code></a> with first argument one of <code class="inline">ports</code>, <code class="inline">processes</code>, <code class="inline">existing_ports</code>, <code class="inline">existing_processes</code>, <code class="inline">existing</code> or <code class="inline">all</code>, could cause emulator crash if a dirty scheduler was executing a simultaneous trace action.</p><p>Own Id: OTP-19034</p></li><li><p>Fixed an integer overflow when the monotonic time unit reported by the operating system was greater than 10 and lower than 100 microseconds.</p><p>Own Id: OTP-19036 Aux Id: GH-8186</p></li><li><p>When a traced process executing on a dirty scheduler received an exit signal, the dirty scheduler could use the wrong thread specific data which could lead to a crash.</p><p>Own Id: OTP-19043 Aux Id: PR-8342</p></li><li><p>Fixed a more or less harmless bug that caused time correction of Erlang monotonic time to become slightly off on Windows platforms when <code class="inline">QueryPerformanceCounter()</code> was used as OS monotonic time source.</p><p><code class="inline">erlang:system_info(os_monotonic_time_source)</code> now also returns information about <em>used resolution</em> which not always corresponds to the resolution of the OS monotonic time source.</p><p>Own Id: OTP-19048 Aux Id: PR-8343</p></li></ul><h3 id="improvements-and-new-features-9" class="section-heading"><a href="#improvements-and-new-features-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Checks for monotonicity of monotonic time have been improved so that Erlang and OS monotonic time are checked separately.</p><p>A new <code class="inline">configure</code> argument <code class="inline">--enable-ensure-os-monotonic-time</code> has also been added. It enables functionality ensuring the monotonicity of monotonic timestamps delivered by the OS. When a non-monotonic timestamp is detected, it will be replaced by the last delivered monotonic timestamp before being used by Erlang's time functionality. Note that you do <em>not</em> want to enable this unless the OS monotonic time source on the system fails to produce monotonic timestamps. This since ensuring the monotonicity of OS monotonic timestamps will hurt scalability and performance of the system.</p><p>Own Id: OTP-19044 Aux Id: ERIERL-1043, PR-8342</p></li><li><p>For severe errors, when the `socket` module terminates the Erlang VM, now an erl_crash.dump is produced, to facilitate post mortem debugging.</p><p>Own Id: OTP-19058</p></li></ul><h2 id="erts-13-2-2-7" class="section-heading"><a href="#erts-13-2-2-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.7</span></h2><h3 id="fixed-bugs-and-malfunctions-45" class="section-heading"><a href="#fixed-bugs-and-malfunctions-45" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix heap corruption bug that could cause runaway memory consumption due to circular offheap list at process exit. Other symptoms may also be possible. Bug exists since OTP 25.0.</p><p>Own Id: OTP-18971 Aux Id: GH-8044</p></li><li><p>The code server could be hanging if a module with <code class="inline">on_load</code> function was loaded at the same time as another module was purged using <code class="inline">erlang:purge_module</code> directly.</p><p>Own Id: OTP-19006</p></li><li><p>A process optimized for parallel signal delivery could under some circumstances lose wakeup information. That is, the processes was not woken up to take care of the signal, so the signal would not be taken care of until the process was woken by another signal. Only processes configured with <a href="erlang.html#process_flag_message_queue_data"><code class="inline">message_queue_data</code></a> set to <code class="inline">off_heap</code> utilize this optimization.</p><p>Own Id: OTP-19008 Aux Id: GH-8119, PR-8201</p></li><li><p>Fix bug in <a href="../../apps/stdlib/re.html#run/3"><code class="inline">re:run/3</code></a> where if an invalid UTF-8 subject was given, re:run could get stuck in an infinite loop. Bug was introduced in Erlang/OTP 22.1.</p><p>Own Id: OTP-19015 Aux Id: ERIERL-682</p></li></ul><h2 id="erts-13-2-2-6" class="section-heading"><a href="#erts-13-2-2-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.6</span></h2><h3 id="fixed-bugs-and-malfunctions-46" class="section-heading"><a href="#fixed-bugs-and-malfunctions-46" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>32-bit runtime systems on most Unix like platforms could crash if a BIF timer was set with a huge timeout of more than 68 years into the future. In order for the crash to occur, the huge timer (at a later time than when it was set) had to become the nearest active timer set on the specific scheduler on which it was set. This could not happen on a system with only one scheduler since there would always be shorter timers in the system.</p><p>Setting a timer larger than 49 days on Windows could under rare circumstances cause the timeout to be delayed.</p><p>Own Id: OTP-18911 Aux Id: ERIERL-1023, PR-7983</p></li><li><p>Garbage collection of a process on a dirty scheduler could collide with signal handling for that process causing a crash of the runtime system. This bug was introduced in OTP 25.3.2.8 and OTP 26.2.</p><p>Own Id: OTP-18957 Aux Id: GH-8051, PR-8088, OTP-18841</p></li></ul><h2 id="erts-13-2-2-5" class="section-heading"><a href="#erts-13-2-2-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.5</span></h2><h3 id="fixed-bugs-and-malfunctions-47" class="section-heading"><a href="#fixed-bugs-and-malfunctions-47" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix faulty debug assert when page size is larger than 16kb, like on PowerPC.
Did crash debug VM directly at start.</p><p>Own Id: OTP-18802</p></li><li><p>A process with <code class="inline">message_queue_data</code> configured as <code class="inline">off_heap</code> could end up in
an inconsistent state when being <code class="inline">receive</code> traced, inspected using
<a href="erlang.html#process_info/2"><code class="inline">process_info/2</code></a> with the <code class="inline">message_queue_len</code> item, or
inspected using the break menu (CTRL-C). When it ended up in this inconsistent
state, it was not enqueued into a run queue even though it was set in a
runnable state.This also effected signals being sent to the process after it
had gotten into this inconsistent state, in such a way that it was from this
point not possible to communicate with it.</p><p>Own Id: OTP-18838 Aux Id: PR-7822, GH-7801</p></li><li><p>A race occurring when a process was selected for dirty execution
simultaneously as it was scheduled for handling a signal could cause the
process to end up in an inconsistent state. When it ended up in this
inconsistent state, it was not enqueued into a run queue even though it was
set in a runnable state. This also effected signals being sent to the process
after it had gotten into this inconsistent state, in such a way that it was
from this point not possible to communicate with it.</p><p>Own Id: OTP-18839 Aux Id: PR-7822, GH-7801</p></li><li><p>When a process had to to wait in the run queue for a long time before being
selected for dirty execution, it could not receive signals. This caused
inspection of such a process, for example using
<a href="erlang.html#process_info/2"><code class="inline">process_info/2</code></a>, to take a long time.</p><p>This issue was introduced in OTP 25.3.2.6 and 26.1 when fixing an issue where
a constant flow of signals prevented a process from being able to execute
dirty.</p><p>Own Id: OTP-18841 Aux Id: PR-7822, GH-7801, OTP-18737</p></li><li><p>Fixed a bug in the JIT that miscompiled large <code class="inline">select_val</code> instructions.</p><p>Own Id: OTP-18842</p></li><li><p>On OTP 24 and OTP 25, incoming distributed messages larger than 64 KiB sent
using an alias leaked memory if the alias had been removed prior to entering
the node. This issue was not present on OTP 26.</p><p>Incoming distributed messages larger than 64 KiB sent using an alias which had
been removed on the receiving node could crash the node. This crash was quite
unlikely on OTP 24 and OTP 25, but very likely on OTP 26.</p><p><code class="inline">'DOWN'</code> signals with exit reason larger than 64 KiB directed towards a
process on a node with a not matching creation leaked memory on the receiving
node. Such signals should however be very rare.</p><p>Own Id: OTP-18885 Aux Id: GH-7834, GH-7890, PR-7915</p></li><li><p>Removed unnecessary PCRE source tar-ball.</p><p>Own Id: OTP-18902</p></li></ul><h3 id="improvements-and-new-features-10" class="section-heading"><a href="#improvements-and-new-features-10" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Removed unnecessary regexp library used when generating yielding BIFs.</p><p>Own Id: OTP-18830 Aux Id: PR-7823</p></li><li><p>Replaced old md5 implementation with an implementation from OpenSSL.</p><p>Own Id: OTP-18877</p></li><li><p>Removed unused <code class="inline">makewhatis</code> script.</p><p>Own Id: OTP-18899</p></li></ul><h2 id="erts-13-2-2-4" class="section-heading"><a href="#erts-13-2-2-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.4</span></h2><h3 id="fixed-bugs-and-malfunctions-48" class="section-heading"><a href="#fixed-bugs-and-malfunctions-48" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>If the external term format encoding of an argument list part of a distributed
spawn operation was faulty, the newly spawned remote process could misbehave.
The misbehavior included hanging or interpret an incoming message as an
argument list to use. This was very unlikely to happen unless using an
alternate implementation of the distribution protocol which made a faulty
encoding of the argument list. The child process will now detect this error
and terminate before executing the user specified code.</p><p>Own Id: OTP-18790 Aux Id: PR-7742</p></li><li><p>On Apple Silicon Macs running macOS Sonoma, the runtime system with the JIT
enabled would crash. Therefore, the <code class="inline">configure</code> script will by default now
disable the JIT on Macs with Apple Silicon. When building for earlier versions
of macOS, the JIT can be explicitly enabled by passing <code class="inline">--enable-jit</code> to the
<code class="inline">configure</code> script.</p><p>Own Id: OTP-18792 Aux Id: GH-7687</p></li><li><p>Fix bugs where if the body of a matchspec would return a map with a variable
('$1', '$_' etc) as one of the keys or values and the variable was not an
immidiate, the term would not be copied to the receiving processes heap. This
would later corrupt the term in the table as the GC could place move markers
in it, which in turn would cause the VM to crash.</p><p>Bug has been present for since OTP 17.0.</p><p>Own Id: OTP-18797 Aux Id: PR-7712 GH-7683</p></li></ul><h2 id="erts-13-2-2-3" class="section-heading"><a href="#erts-13-2-2-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.3</span></h2><h3 id="fixed-bugs-and-malfunctions-49" class="section-heading"><a href="#fixed-bugs-and-malfunctions-49" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A process optimized for parallel signal delivery could under some
circumstances lose wakeup information. That is, the processes was not woken up
to take care of the signal, so the signal would not be taken care of until the
process was woken by another signal. Only processes configured with
<a href="erlang.html#process_flag_message_queue_data"><code class="inline">message_queue_data</code></a> set to
<code class="inline">off_heap</code> utilize this optimization.</p><p>Own Id: OTP-18647 Aux Id: PR-7595</p></li><li><p>Delivery time of message signals to a process not executing any <code class="inline">receive</code>
expressions could become very long, potentially infinite. For example, a
process checking for messages using
<a href="erlang.html#process_info/2"><code class="inline">process_info(self(), message_queue_len)</code></a> or
<a href="erlang.html#process_info/2"><code class="inline">process_info(self(), messages)</code></a> and avoiding to execute a
<code class="inline">receive</code> expression matching on messages could be very slow in detecting new
messages. Note that you are still discouraged from using <code class="inline">process_info()</code> this
way. A process that wants to check if there are messages available to handle
should execute a <code class="inline">receive</code> expression matching on messages.</p><p>Own Id: OTP-18706 Aux Id: GH-7413, PR-7595, ERIERL-979</p></li><li><p>Fix bug causing &quot;magic&quot; references in a <code class="inline">compressed</code> ETS table to not keep the
referred object alive. The symptom would be the referred object being garbage
collected prematurely and the reference appearing stale, not referring to
anything. Examples of such magically referred objects are <code class="inline">atomics</code> and NIF
resources.</p><p>Own Id: OTP-18732 Aux Id: GH-7444, PR-7458</p></li><li><p>A constant flow of incoming non-message signals could prevent a process
needing to execute dirty from doing so.</p><p>Own Id: OTP-18737 Aux Id: PR-7595</p></li><li><p>The cleanup operation of not yet delivered signals to a terminated process
yielded excessively.</p><p>Own Id: OTP-18752 Aux Id: PR-7633</p></li></ul><h2 id="erts-13-2-2-2" class="section-heading"><a href="#erts-13-2-2-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.2</span></h2><h3 id="fixed-bugs-and-malfunctions-50" class="section-heading"><a href="#fixed-bugs-and-malfunctions-50" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Multiple socket:accept calls issue. When making multiple accept calls, only
the last call is active.</p><p>Own Id: OTP-18635 Aux Id: #7328</p></li><li><p>The following functions are now much faster when given a long list or binary:</p><ul><li>erlang:list_to_integer/1</li><li>erlang:binary_to_integer/1</li><li>erlang:binary_to_integer/2</li><li>erlang:list_to_integer/2</li><li>string:to_integer/1</li></ul><p>Own Id: OTP-18659 Aux Id: PR-7426</p></li></ul><h2 id="erts-13-2-2-1" class="section-heading"><a href="#erts-13-2-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-51" class="section-heading"><a href="#fixed-bugs-and-malfunctions-51" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a crash during tracing on certain platforms that cannot use the machine
stack for Erlang code (mainly OpenBSD and Linux with musl).</p><p>Own Id: OTP-18561</p></li><li><p>Constructing a binary segment not aligned with a byte boundary, with a size
not fitting in 31 bits, and with a value not fitting in a 64-bit word could
crash the runtime system.</p><p>Own Id: OTP-18597</p></li></ul><h3 id="improvements-and-new-features-11" class="section-heading"><a href="#improvements-and-new-features-11" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Further robustify implementation of large maps (&gt; 32 keys). Keys that happen
to have same internal 32-bit hash values are now put in collision nodes which
are traversed with linear search. This removes the demand for the internal
hash function when salted to eventually produce different hashes for all
possible pairs of unequal terms.</p><p>Own Id: OTP-18569</p></li></ul><h2 id="erts-13-2-2" class="section-heading"><a href="#erts-13-2-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.2</span></h2><h3 id="fixed-bugs-and-malfunctions-52" class="section-heading"><a href="#fixed-bugs-and-malfunctions-52" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>If a runtime system which was starting the distribution already had existing
pids, ports, or references referring to a node with the same nodename/creation
pair that the runtime system was about to use, these already existing pids,
ports, or references would not work as expected in various situations after
the node had gone alive. This could only occur if the runtime system was
communicated such pids, ports, or references prior to the distribution was
started. That is, it was extremely unlikely to happen unless the distribution
was started dynamically and was even then very unlikely to happen. The runtime
system now checks for already existing pids, ports, and references with the
same nodename/creation pair that it is about to use. If such are found another
creation will be chosen in order to avoid these issues.</p><p>Own Id: OTP-18570 Aux Id: PR-7190</p></li></ul><h2 id="erts-13-2-1" class="section-heading"><a href="#erts-13-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-53" class="section-heading"><a href="#fixed-bugs-and-malfunctions-53" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in the loader that prevented certain modules compiled with
<code class="inline">no_ssa_opt</code> from being loaded.</p><p>Own Id: OTP-18519 Aux Id: GH-7024</p></li><li><p>Implementations of the <a href="driver_entry.html#call"><code class="inline">call()</code></a> driver callback that
returned a faulty encoded result could cause a memory leak and could cause
invalid data on the heap of the processes calling <a href="erlang.html#port_call/3"><code class="inline">erlang:port_call/3</code></a>.</p><p>Own Id: OTP-18525 Aux Id: PR-7049</p></li><li><p>Fixed a memory corruption issue when upgrading code. The bug was introduced in
<code class="inline">OTP 25.3</code></p><p>Own Id: OTP-18553</p></li><li><p>Fixed configure tests for a few ARM-specific instructions, which prevented the
emulator from being built on some platforms.</p><p>Own Id: OTP-18554</p></li><li><p>Aliases created in combination with a monitor using the
<code class="inline">{alias, explicit_unalias}</code> option stopped working from remote nodes when a
<code class="inline">'DOWN'</code> signal had been received due to the monitor or if the monitor was
removed using the <code class="inline">erlang:demonitor()</code> BIF.</p><p>This bug was introduced in OTP 24.3.4.10 and OTP 25.3.</p><p>Own Id: OTP-18557 Aux Id: PR-7131, OTP-18496</p></li><li><p>In rare circumstances, bit syntax matching of an invalid code point for a
<code class="inline">utf32</code> would crash the runtime system.</p><p>Own Id: OTP-18560</p></li><li><p>Building the runtime system failed when native atomic support was missing.
Note that execution on such systems have only been rudimentary tested.</p><p>Own Id: OTP-18563 Aux Id: GH-7114, PR-7159</p></li></ul><h2 id="erts-13-2" class="section-heading"><a href="#erts-13-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.2</span></h2><h3 id="fixed-bugs-and-malfunctions-54" class="section-heading"><a href="#fixed-bugs-and-malfunctions-54" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug on Windows where <a href="../../apps/kernel/file.html#read_file_info/1"><code class="inline">file:read_file_info/1</code></a> would fail for files with
corrupt metadata.</p><p>Own Id: OTP-18348 Aux Id: GH-6356</p></li><li><p>Fix <a href="erlang.html#process_info/2"><code class="inline">process_info(_, binary)</code></a> to again include &quot;writable
binaries&quot; which were lost in OTP-25.0. Writable binaries are an optimization
used when binaries are appended upon in a loop.</p><p>Own Id: OTP-18373 Aux Id: PR-6574, GH-6573</p></li><li><p>Fix rare race when receiving fragmented messages on a terminating connection.
Could potentially cause memory leaks as well as double free crashes. Bug
exists since OTP 22.0.</p><p>Own Id: OTP-18382 Aux Id: PR-6585</p></li><li><p>Fixed bug that could maybe cause problems when a file descriptor number is
closed by a linked in driver and then opened (reused) and passed to
<code class="inline">enif_select</code> by a NIF. No actual symptoms seen, only failed internal
assertions in debug build.</p><p>Own Id: OTP-18391</p></li><li><p>The runtime system could crash when tracing a process executing on a dirty
scheduler.</p><p>Own Id: OTP-18398 Aux Id: PR-6495, GH-6448, GH-5984</p></li><li><p>In the binary syntax, attempting to match out integers with size exceeding 2
GiB could crash the runtime system.</p><p>Own Id: OTP-18406 Aux Id: GH-6701</p></li><li><p>Fixed edge case in floating-point negation where <code class="inline">A = 0.0, B = -A</code> did not
produce <code class="inline">B = -0.0</code> on x86_64 JIT.</p><p>Own Id: OTP-18411 Aux Id: GH-6717</p></li><li><p>Fixed an issue in the JIT that could crash the emulator on some platforms.</p><p>Own Id: OTP-18418</p></li><li><p>Added meta data to the windows installer.</p><p>Own Id: OTP-18429 Aux Id: PR-6587 GH-4232 GH-6537</p></li><li><p>Fixed ETS insertion order into <code class="inline">bag</code> and <code class="inline">duplicate_bag</code> of tuples with
identical keys when passed in a list to <a href="../../apps/stdlib/ets.html#insert/2"><code class="inline">ets:insert/2</code></a>. The insert order has
been head-to-tail but was accidentally changed in OTP 23.0. For <code class="inline">bag</code> it was
reverted (tail-to-head), while for <code class="inline">duplicate_bag</code> it was sometimes reverted
depending on the length of the list and number of &quot;reductions&quot; left for the
calling process.</p><p>This fix changes the insert order of <a href="../../apps/stdlib/ets.html#insert/2"><code class="inline">ets:insert/2</code></a> back to always be
head-to-tail of the list argument.</p><p>Own Id: OTP-18434 Aux Id: PR-6752</p></li><li><p>With the JIT for AArch64 (AMD64), calling <code class="inline">bxor</code> in with non-integer arguments
in a guard would crash the runtime system.</p><p>Own Id: OTP-18454 Aux Id: PR-6839</p></li><li><p>Fix bug regarding process flag <code class="inline">max_heap_size</code>. Could cause strange behavior
when a process was killed due to exceeding the limit.</p><p>Own Id: OTP-18457 Aux Id: PR-6816</p></li><li><p>Fixed binary comprehensions to be similar to other creation of binary data
with respect to its contribution of triggering garbage collection.</p><p>Own Id: OTP-18458</p></li><li><p>In rare circumstances, when a process exceeded its allowed heap size set by
option <code class="inline">max_heap_size</code>, it would not be killed as it should be, but instead
enter a kind of zombie state it would never get out of.</p><p>Own Id: OTP-18463 Aux Id: PR-6858</p></li><li><p>Instead of crashing, the <a href="erlang.html#list_to_integer/1"><code class="inline">list_to_integer/1</code></a> and
<a href="erlang.html#list_to_integer/2"><code class="inline">list_to_integer/2</code></a> BIFs now raise the <code class="inline">system_limit</code>
exception for overlong lists that can't be converted to integers. Similarly,
the <a href="../../apps/stdlib/string.html#to_integer/1"><code class="inline">string:to_integer/1</code></a> BIF now returns <code class="inline">{error,system_limit}</code> for overlong
lists.</p><p>Own Id: OTP-18475 Aux Id: PR-6897</p></li><li><p>Active process aliases of a process at its termination leaked memory.</p><p>Own Id: OTP-18496 Aux Id: GH-6947, PR-6953</p></li></ul><h3 id="improvements-and-new-features-12" class="section-heading"><a href="#improvements-and-new-features-12" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Support for fully asynchronous distributed signaling where send operations
<em>never</em> block. This functionality is by default disabled and can be enabled
per process. For more information see the documentation of
<a href="erlang.html#process_flag_async_dist"><code class="inline">process_flag(async_dist, Bool)</code></a>.</p><p>Own Id: OTP-18374 Aux Id: PR-6632</p></li><li><p>Added the <code class="inline">+JPperf no_fp</code> option to explicitly disable Erlang frame pointers
otherwise added when using the <code class="inline">+JPperf map</code> option.</p><p>Own Id: OTP-18426</p></li></ul><h2 id="erts-13-1-5" class="section-heading"><a href="#erts-13-1-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.1.5</span></h2><h3 id="fixed-bugs-and-malfunctions-55" class="section-heading"><a href="#fixed-bugs-and-malfunctions-55" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Comparisons between small numbers and pids or ports would in some edge cases
say that the number was greater than the pid or port, violating the term
order.</p><p>Own Id: OTP-18415</p></li><li><p><a href="erlang.html#process_info/2"><code class="inline">process_info(Pid, status)</code></a> when <code class="inline">Pid /= self()</code> could
return an erroneous result.</p><p>Own Id: OTP-18421 Aux Id: PR-6806</p></li></ul><h2 id="erts-13-1-4" class="section-heading"><a href="#erts-13-1-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.1.4</span></h2><h3 id="fixed-bugs-and-malfunctions-56" class="section-heading"><a href="#fixed-bugs-and-malfunctions-56" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in selective receive optimization that could crash 32-bit
emulators.</p><p>Own Id: OTP-18383 Aux Id: ERIERL-905</p></li><li><p>A race condition which was very rarely triggered could cause the signal queue
of a process to become inconsistent causing the runtime system to crash.</p><p>Own Id: OTP-18388 Aux Id: OTP-17462, PR-6662</p></li></ul><h2 id="erts-13-1-3" class="section-heading"><a href="#erts-13-1-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.1.3</span></h2><h3 id="fixed-bugs-and-malfunctions-57" class="section-heading"><a href="#fixed-bugs-and-malfunctions-57" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix perf/gdb JIT symbols to not contain <code class="inline">CodeInfoPrologue</code> for the JIT
internal module erts_beamasm.</p><p>Own Id: OTP-18256 Aux Id: PR-6316</p></li><li><p>Fixed minor memory leaks.</p><p>Own Id: OTP-18281 Aux Id: PR-4840</p></li><li><p>Fix bugs in <code class="inline">ets:insert</code> and <code class="inline">ets:insert_new</code> when called with a list of
tuples to insert while a concurrent process either deletes or renames the
table. The table deletion could be done with <a href="../../apps/stdlib/ets.html#delete/1"><code class="inline">ets:delete/1</code></a> or be caused by
termination of the table owning process.</p><p>Symptoms are either VM crash or strange incorrect behavior from the insert
operation. The risk of triggering the bugs increases with the length of the
list of tuple to insert. Bugs exist since OTP 23.0.</p><p>Own Id: OTP-18284 Aux Id: PR-6305</p></li><li><p>Boost execution of scheduled thread progress jobs. This to prevent memory
exhaustion in extremely rapid allocation/deallocation scenarios, such as
repeated ETS table creations/deletions.</p><p>Own Id: OTP-18294 Aux Id: PR-6390</p></li><li><p>Fix segv crash during crash dumping an ETS table doing
<code class="inline">ets:delete_all_objects</code>.</p><p>Own Id: OTP-18295</p></li><li><p>Spec for function net:if_names/0 incorrect</p><p>Own Id: OTP-18296 Aux Id: OTP-16464</p></li><li><p>Fix bug in <code class="inline">binary_to_term</code> decoding a binary term 2Gbyte or larger.</p><p>Own Id: OTP-18306 Aux Id: GH-6393, PR-6401</p></li><li><p>Documentation of <a href="erlang.html#module_loaded/1"><code class="inline">erlang:module_loaded/1</code></a> has been adjusted:</p><ul><li>It did not previously say that the BIF only returns <code class="inline">true</code> for modules
loaded as <em>current code</em>.</li><li>The warning claiming that the BIF should only be used by the code server has
been removed.</li></ul><p>Own Id: OTP-18313 Aux Id: PR-6456</p></li><li><p>Fix <a href="erlang.html#list_to_atom/1"><code class="inline">list_to_atom/1</code></a> for negative code points. Could
either return with a positive code point or fail with an incorrect exception.</p><p>Own Id: OTP-18321</p></li><li><p>Fix rare bug causing VM crash when sending to a pid of a spawning process
returned from <a href="erlang.html#processes/0"><code class="inline">erlang:processes/0</code></a>.</p><p>Only seen when provoked by system process literal_area_collector, triggered by
a module purge operation, on a VM started with +Meamin (no customized
allocators).</p><p>Own Id: OTP-18322 Aux Id: PR-6479</p></li><li><p>gen_udp:open/2 with option(s) add_membership or drop_membership would drop
earlier options.</p><p>Own Id: OTP-18323 Aux Id: #6476</p></li><li><p>The <a href="../../apps/kernel/inet.html#setopts/2"><code class="inline">inet:setopts/2</code></a> <code class="inline">{reuseaddr, true}</code> option will now be ignored on Windows
unless the socket is an UDP socket. For more information see the documentation
of the <code class="inline">reuseaddr</code> option part of the documentation of <a href="../../apps/kernel/inet.html#setopts/2"><code class="inline">inet:setopts/2</code></a>.</p><p>Prior to OTP 25 the <code class="inline">{reuseaddr, true}</code> option was ignored for all sockets on
Windows, but as of OTP 25.0 this was changed so that it was not ignored for
any sockets.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-18324 Aux Id: GH-6461, PR-6481</p></li><li><p>Fix bug in <code class="inline">binary_to_term</code> decoding a list of length 1G or longer.</p><p>Own Id: OTP-18328 Aux Id: GH-6439, PR-6440</p></li><li><p>Fix bug in <code class="inline">binary_to_term</code> (and distributed receive) when decoding a large
map (&gt;32 keys) with unsorted small maps (&lt;= 32) as keys of the large map.</p><p>This was only a problem if the term was encoded by <code class="inline">erl_interface</code>,
<code class="inline">jinterface</code> or otherwise, as the VM itself always encodes small maps with
sorted keys.</p><p>The &quot;binary_to_term&quot; would appear as successful but the created large map was
internally inconsistent. The smaller key-maps could not be found with maps:get
and friends. Other operations such as map compare and merge could probably
also give incorrect results.</p><p>Own Id: OTP-18343 Aux Id: GH-6496</p></li><li><p>Fix Windows bug in <code class="inline">open_port({spawn, Command}, ..)</code> when <code class="inline">Command</code> is found
via the OS search PATH and that directory path contains white spaces. The port
program would start but the command line arguments to it could be incorrect.</p><p>Own Id: OTP-18345 Aux Id: GH-6387, PR-6396</p></li></ul><h2 id="erts-13-1-2-1" class="section-heading"><a href="#erts-13-1-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.1.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-58" class="section-heading"><a href="#fixed-bugs-and-malfunctions-58" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in selective receive optimization that could crash 32-bit
emulators.</p><p>Own Id: OTP-18383 Aux Id: ERIERL-905</p></li><li><p>A race condition which was very rarely triggered could cause the signal queue
of a process to become inconsistent causing the runtime system to crash.</p><p>Own Id: OTP-18388 Aux Id: OTP-17462, PR-6662</p></li></ul><h2 id="erts-13-1-2" class="section-heading"><a href="#erts-13-1-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.1.2</span></h2><h3 id="fixed-bugs-and-malfunctions-59" class="section-heading"><a href="#fixed-bugs-and-malfunctions-59" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Add abandon carrier free utilization limit (<code class="inline">+Muacful</code>) option to erts_alloc.
This option allows the user to mark unused segments in a memory carrier as
re-useable by the OS if needed.</p><p>This functionality was a non-configurable default before Erlang/OTP 25, but
removed due to performance issues.</p><p>Own Id: OTP-18290 Aux Id: ERIERL-866 PR-6378</p></li></ul><h2 id="erts-13-1-1" class="section-heading"><a href="#erts-13-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-60" class="section-heading"><a href="#fixed-bugs-and-malfunctions-60" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Listen sockets created with the socket module, leaked (erlang-) monitors.</p><p>Own Id: OTP-18240 Aux Id: #6285</p></li><li><p><a href="erlang.html#dist_ctrl_get_data_notification/1">Notifications about available distribution data</a>
sent to distribution controller processes could be lost. Distribution
controller processes can be used when implementing an alternative distribution
carrier. The default distribution over tcp was not effected and the bug was
also not present on x86/x86_64 platforms.</p><p>Own Id: OTP-18258 Aux Id: GH-6309, PR-6324</p></li></ul><h2 id="erts-13-1" class="section-heading"><a href="#erts-13-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.1</span></h2><h3 id="fixed-bugs-and-malfunctions-61" class="section-heading"><a href="#fixed-bugs-and-malfunctions-61" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed inconsistency bugs in <a href="../../apps/kernel/global.html"><code class="inline">global</code></a> due to <code class="inline">nodeup</code>/<code class="inline">nodedown</code> messages not
being delivered before/after traffic over connections. Also fixed various
other inconsistency bugs and deadlocks in both <a href="../../apps/kernel/global_group.html"><code class="inline">global_group</code></a> and <code class="inline">global</code>.</p><p>As building blocks for these fixes, a new BIF <a href="erlang.html#nodes/2"><code class="inline">erlang:nodes/2</code></a> has been
introduced and <a href="../../apps/kernel/net_kernel.html#monitor_nodes/2"><code class="inline">net_kernel:monitor_nodes/2</code></a> has been extended.</p><p>The <a href="erl_cmd.html#hidden"><code class="inline">-hidden</code></a> and
<a href="erl_cmd.html#connect_all"><code class="inline">-connect_all</code></a> command line arguments did not work
if multiple instances were present on the command line which has been fixed.
The new kernel parameter <a href="../../apps/kernel/kernel_app.html#connect_all"><code class="inline">connect_all</code></a>
has also been introduced in order to replace the <code class="inline">-connect_all</code> command line
argument.</p><p>Own Id: OTP-17934 Aux Id: PR-6007</p></li><li><p>Fixed IPv6 multicast_if and membership socket options.</p><p>Own Id: OTP-18091 Aux Id: #5789</p></li><li><p>Accept funs (NEW_FUN_EXT) with incorrectly encoded size field. This is a
workaround for a bug (OTP-18104) existing in OTP 23 and 24 that could cause
incorrect size fields in certain cases. The emulator does not use the decoded
size field, but <code class="inline">erl_interface</code> still does and is not helped by this
workaround.</p><p>Own Id: OTP-18093 Aux Id: OTP-18104, PR-5987</p></li><li><p>Fixed issue with inet:getifaddrs hanging on pure IPv6 Windows</p><p>Own Id: OTP-18102 Aux Id: #5904</p></li><li><p>Fix faulty distribution encoding of terms with either</p><ul><li>a fun with bit-string or export-fun in its environment when encoded toward a
not yet established (pending) connection</li><li>or a fun with a binary/bitstring, in its environment, referring to an
off-heap binary (larger than 64 bytes).</li></ul><p>The symptom could be failed decoding on the receiving side leading to aborted
connection. Fix OTP-18093 is a workaround for theses bugs that makes the VM
accepts such faulty encoded funs.</p><p>The first encoding bug toward pending connection exists only in OTP 23 and 24,
but the second one exists also on OTP 25.</p><p>Own Id: OTP-18104 Aux Id: OTP-18093</p></li><li><p>Fixed emulator crash that could happen during crashdump generation of ETS
tables with options <code class="inline">ordered_set</code> and <code class="inline">{write_concurrency,true}</code>.</p><p>Own Id: OTP-18144 Aux Id: GH-5981</p></li><li><p>Retrieval of monotonic and system clock resolution on MacOS could cause a
crash and/or erroneous results.</p><p>Own Id: OTP-18160 Aux Id: PR-6103</p></li><li><p>Fix bug where the max allowed size of <code class="inline">erl +hmax</code> was lower than what was
allowed by <code class="inline">process_flag</code>.</p><p>Own Id: OTP-18161 Aux Id: PR-6081</p></li><li><p>On computers with ARM64 (AArch64) processors, the JIT could generate incorrect
code when more than 4095 bits were skipped at the tail end of a binary match.</p><p>Own Id: OTP-18201</p></li><li><p>In rare circumstances, an <a href="erlang.html#is_binary/1"><code class="inline">is_binary/1</code></a> guard test could
succeed when given a large integer.</p><p>Own Id: OTP-18216 Aux Id: GH-6239, PR-6240</p></li><li><p>Fix bug causing <code class="inline">ets:info</code> (and sometimes <code class="inline">ets:whereis</code>) to return 'undefined'
for an existing table if a concurrent process were doing <code class="inline">ets:insert</code> with a
long list on the same table.</p><p>Own Id: OTP-18218 Aux Id: ERIERL-855</p></li><li><p>Fix writing and reading of more than 2 GB in a single read/write operation on
macOS. Before this fix attempting to read/write more than 2GB would result in
<code class="inline">{error,einval}</code>.</p><p>Own Id: OTP-18222 Aux Id: PR-6248 GH-6242</p></li><li><p>Fix bug sometimes causing emulator crash at node shutdown when there are
pending connections. Only seen when running duel distribution protocols,
inet_drv and inet_tls_dist.</p><p>Own Id: OTP-18243 Aux Id: GH-6247, PR-6258</p></li></ul><h3 id="improvements-and-new-features-13" class="section-heading"><a href="#improvements-and-new-features-13" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Yield when adjusting large process message queues due to</p><ul><li>copying terms from a literal area prior to removing the literal area.</li><li>changing the <code class="inline">message_queue_data</code> state from <code class="inline">on_heap</code> to <code class="inline">off_heap</code>.</li></ul><p>The message queue adjustment work will now be interleaved with all other types
of work that processes have to do, even other message queue adjustment work.</p><p>Own Id: OTP-17340 Aux Id: PR-6133</p></li><li><p>Add rudimentary debug feature (option) for the inet-driver based sockets, such
as gen_tcp and gen_udp.</p><p>Own Id: OTP-18032</p></li><li><p>Introduced the <code class="inline">hidden</code> and <code class="inline">dist_listen</code> options to <a href="../../apps/kernel/net_kernel.html#start/2"><code class="inline">net_kernel:start/2</code></a>.</p><p>Also documented the <a href="erl_cmd.html#dist_listen"><code class="inline">-dist_listen</code></a> command line
argument which was erroneously documented as a <code class="inline">kernel</code> parameter and not as a
command line argument.</p><p>Own Id: OTP-18107 Aux Id: PR-6009</p></li><li><p>New documentation chapter &quot;Debugging NIFs and Port Drivers&quot; under
Interoperability Tutorial.</p><p>Own Id: OTP-18109</p></li><li><p>Add new API function erl_features:configurable/0</p><p>Own Id: OTP-18199 Aux Id: PR-5790</p></li></ul><h2 id="erts-13-0-4" class="section-heading"><a href="#erts-13-0-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.0.4</span></h2><h3 id="fixed-bugs-and-malfunctions-62" class="section-heading"><a href="#fixed-bugs-and-malfunctions-62" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The <a href="erlang.html#monitor/3"><code class="inline">monitor/3</code></a> BIF did not apply options to the created
monitor if the target process or port did not exist. That is, the
corresponding down message would get a <code class="inline">`DOWN`</code> tag even if a custom tag
had been set, and the returned reference was not an alias even if the <code class="inline">alias</code>
option had been passed.</p><p>Own Id: OTP-18190 Aux Id: GH-6185, PR-6209</p></li><li><p>The <a href="erlang.html#monotonic_time/1"><code class="inline">erlang:monotonic_time/1</code></a>, <a href="erlang.html#system_time/1"><code class="inline">erlang:system_time/1</code></a>, <a href="erlang.html#time_offset/1"><code class="inline">erlang:time_offset/1</code></a>,
and <a href="../../apps/kernel/os.html#system_time/1"><code class="inline">os:system_time/1</code></a> BIFs erroneously failed when passed the argument
<code class="inline">native</code>.</p><p>Own Id: OTP-18197 Aux Id: GH-6165, PR-6213</p></li></ul><h2 id="erts-13-0-3" class="section-heading"><a href="#erts-13-0-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.0.3</span></h2><h3 id="fixed-bugs-and-malfunctions-63" class="section-heading"><a href="#fixed-bugs-and-malfunctions-63" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Distributed exit signals could be lost under the following conditions:</p><ul><li><p>An exit signal from a parent process to a child process was lost if:</p><ul><li>the parent process terminated before the spawn request that created the
child had completed,</li><li>the spawn request set up a link between parent and child</li><li>the spawn request was distributed, and</li><li>the exit reason was larger than one machine word.</li></ul></li><li><p>Loss of a connection over which a not yet completed spawn request was
ongoing could cause loss of exit signals. Such loss of exit signals was very
rare. Besides the above described connection loss also the following
conditions had to be satisfied:</p><ul><li>The spawn request that was interrupted by the connection loss also had to
set up a link between the parent process and the child process.</li><li>The parent process that issued the spawn request also had to be
terminating while the spawn request was interrupted by the connection
loss.</li><li>The same parent process also had to have made other spawn requests to
other nodes than to the node to which the connection was lost.</li><li>These spawn requests to the other nodes also had to set up links.</li><li>These spawn requests to the other nodes also had to be not yet completed
at the time of the connection loss. That is, the spawn reply from the
child process had not yet reached the parent process.</li></ul><p>If all the conditions above were met, exit signals to the children spawned
due to the above described spawn requests to other nodes <em>could</em> be lost.</p><p>The above bug also caused a significant memory leak when it was triggered
since the destruction of the parent process never completed.</p></li></ul><p>Own Id: OTP-18164 Aux Id: PR-6114</p></li><li><p>A race could cause <a href="erlang.html#process_info/2"><code class="inline">process_info(Pid, message_queue_len)</code></a>
on other processes to return invalid results.</p><p>Own Id: OTP-18169 Aux Id: PR-6134</p></li><li><p>Fixed reduction counting for handling process system tasks.</p><p>Own Id: OTP-18170 Aux Id: PR-6135</p></li><li><p>Priority elevation of terminating processes did not work which could cause
execution of such processes to be delayed.</p><p>Own Id: OTP-18175 Aux Id: PR-6142</p></li><li><p>An unlink operation made by a process that terminated before the unlink
operation completed, i.e., before it had received an unlink-ack signal from
the linked process, caused an exit signal to erroneously be sent from the
terminating process to the process being unlinked. This exit signal would most
often be ignored by the receiver, but if the receiver of the exit signal
concurrently set up a new link, it could receive the exit signal with the
actual exit reason of the terminating process instead of a <code class="inline">noproc</code> exit
reason. It is however very hard to detect that this has happened and has no
obvious negative consequences, so it should be considered harmless.</p><p>A distributed unlink-ack signal received by a terminating process was also not
properly removed which could cause a minor memory leak.</p><p>Own Id: OTP-18177 Aux Id: PR-6150</p></li></ul><h2 id="erts-13-0-2" class="section-heading"><a href="#erts-13-0-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.0.2</span></h2><h3 id="fixed-bugs-and-malfunctions-64" class="section-heading"><a href="#fixed-bugs-and-malfunctions-64" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>On computers with the ARM64 (AArch64) architecture (such as Apple Silicon
Macs) a <code class="inline">rem</code> expression followed by a <code class="inline">div</code> expression with the same operands
could evaluate to the wrong result if the result of the <code class="inline">rem</code> expression was
unused.</p><p>Own Id: OTP-18143</p></li></ul><h2 id="erts-13-0-1" class="section-heading"><a href="#erts-13-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-65" class="section-heading"><a href="#fixed-bugs-and-malfunctions-65" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A <code class="inline">spawn_reply</code> signal from a remote node could be delayed and be delivered
after other signals from the newly spawned process.</p><p>When this bug triggered, the connection to the node where the process was
spawned sometimes could be taken down due to the bug. The following error
message would then be logged if this happened:
<code class="inline">Missing 'spawn_reply' signal from the node &lt;RemoteNode&gt; detected by &lt;Pid&gt; on the node &lt;LocalNode&gt;. The node &lt;RemoteNode&gt; probably suffers from the bug with ticket id OTP-17737.</code></p><p>This bug only affected processes which had enabled
<a href="erlang.html#process_flag_message_queue_data"><code class="inline">off_heap</code> <code class="inline">message_queue_data</code></a>
and parallel reception of signals had been automatically enabled.</p><p>This bug was introduced in OTP 25.0, ERTS version 13.0.</p><p>Own Id: OTP-18105 Aux Id: OTP-16982, PR-6003</p></li><li><p>Fixed type spec of <code class="inline">erlang:system_info(dist_ctrl)</code>.</p><p>Own Id: OTP-18106 Aux Id: PR-5992</p></li><li><p>The zlib built in to the runtime system has been updated to version 1.2.12.
(Note that on most platforms, the platform's own zlib is used.)</p><p>Own Id: OTP-18123 Aux Id: GH-5994</p></li><li><p>The <code class="inline">erlang:is_alive()</code> BIF could return <code class="inline">true</code> before configured distribution
service was available. This bug was introduced in OTP 25.0 ERTS version 13.0.</p><p>The <code class="inline">erlang:monitor_node()</code> and <code class="inline">erlang:monitor()</code> BIFs could erroneously fail
even though configured distribution service was available. This occurred if
these BIFs were called after the distribution had been started using dynamic
node name assignment but before the name had been assigned.</p><p>Own Id: OTP-18124 Aux Id: OTP-17558, PR-6032</p></li></ul><h2 id="erts-13-0" class="section-heading"><a href="#erts-13-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 13.0</span></h2><h3 id="fixed-bugs-and-malfunctions-66" class="section-heading"><a href="#fixed-bugs-and-malfunctions-66" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The socket option 'reuseaddr' is <em>no longer</em> ignored on Windows.</p><p>Own Id: OTP-17447 Aux Id: GH-4819</p></li><li><p>The growth rate of writable binaries has been adjusted to only increase by 20%
after 16MB in size. Before this change the size would always double.</p><p>This change may degrade write performance of large binaries.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-17569 Aux Id: PR-4793</p></li><li><p>Fix reduction counting bug in <code class="inline">re:run</code> that caused the function to yield too
frequently when doing <code class="inline">global</code> matches.</p><p>Own Id: OTP-17661 Aux Id: PR-5165</p></li><li><p>Fix spelling mistakes in epmd error messages.</p><p>Own Id: OTP-17758 Aux Id: PR-5391</p></li><li><p>Fix bug where the &quot;newshell&quot; would trigger a newline at the column width of
the terminal, even if the next character to be printed was a newline. This
would cause the terminal to render two newlines instead of one.</p><p>Own Id: OTP-17779 Aux Id: GH-5403 PR-5599</p></li><li><p>Fix the memory value returned from <code class="inline">ets:info(Tid,memory)</code> when the
<code class="inline">read_concurrency</code> option is used.</p><p>Before this fix the memory used by the scheduler specific lock cache lines was
not counted towards the total. This caused the returned memory usage to be
very incorrect on systems with many schedulers for tables with man locks.</p><p>Own Id: OTP-17832 Aux Id: PR-5494</p></li><li><p>Fix the undocumented <code class="inline">--profile_boot</code> option to work again.</p><p>Own Id: OTP-17836 Aux Id: PR-5546</p></li><li><p>[socket] Encode of sockaddr has been improved.</p><p>Own Id: OTP-18020</p></li><li><p>Fix <code class="inline">erl_child_setup</code> (the program used by <code class="inline">open_port({spawn,...})</code> and
<a href="../../apps/kernel/os.html#cmd/1"><code class="inline">os:cmd/1</code></a>) to better handle partial reads from the Erlang VM.</p><p>Own Id: OTP-18047 Aux Id: PR-5861</p></li><li><p>The runtime system would crash when attempting to create more than 33554431
atoms.</p><p>Own Id: OTP-18068 Aux Id: GH-5903</p></li></ul><h3 id="improvements-and-new-features-14" class="section-heading"><a href="#improvements-and-new-features-14" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Users can now configure ETS tables with the <code class="inline">{write_concurrency, auto}</code>
option. This option forces tables to automatically change the number of locks
that are used at run-time depending on how much concurrency is detected. The
<code class="inline">{decentralized_counters, true}</code> option is enabled by default when
<code class="inline">{write_concurrency, auto}</code> is active.</p><p>Benchmark results comparing this option with the other ETS optimization
options are available here:</p><p><a href="https://erlang.org/bench/ets_bench_result_lock_config.html">https://erlang.org/bench/ets_bench_result_lock_config.html</a></p><p>Own Id: OTP-15991 Aux Id: PR-5208</p></li><li><p>The net module now works on Windows.</p><p>Own Id: OTP-16464</p></li><li><p>To enable more optimizations, BEAM files compiled with OTP 21 and earlier
cannot be loaded in OTP 25.</p><p>Own Id: OTP-16702</p></li><li><p>Optimize minor garbage collection for processes with large number of binaries,
funs and/or external pids/ports/refs. This is a continuation of the
optimization (OTP-17602) released in OTP-24.1.</p><p>Own Id: OTP-16852 Aux Id: ERL-1347, PR-5195</p></li><li><p>The signal queue of a process with message_queue_data=off_heap* has been
optimized to allow parallel reception of signals from multiple processes.</p><p>This is possible to do as Erlang only guarantees that signals (i.e., message
signals and non-message signals) sent from a single process to another process
are ordered in send order. However, there are no ordering guarantees for
signals sent from different processes to a particular process. Therefore,
several processes can send signals in parallel to a specific process without
synchronizing with each other. However, such signal sending was previously
always serialized as the senders had to acquire the lock for the outer signal
queue of the receiving process. This parallel signal sending optimization
yields much better scalability for signal sending than what was previously
possible, see <a href="https://erlang.org/bench/sigq_bench_result.html">https://erlang.org/bench/sigq_bench_result.html</a> for benchmark
results.</p><p>* Information about how to enable the message_queue_data=off_heap setting can
be found in the documentation of the function erlang:process_flag/2.</p><p>Own Id: OTP-16982 Aux Id: PR-5020</p></li><li><p>The JIT now works for 64-bit ARM processors.</p><p>Own Id: OTP-17119 Aux Id: PR-4869</p></li><li><p>Added support for the compile attribute <code class="inline">-nifs()</code> to empower compiler and
loader with information about which functions may be overridden as NIFs by
<a href="erlang.html#load_nif/2"><code class="inline">erlang:load_nif/2</code></a>. It is recommended to use this attribute in all modules
that load NIF libraries.</p><p>Own Id: OTP-17151 Aux Id: ERIERL-590, PR-5479</p></li><li><p>A test case has been added to the otp_SUITE that test that the dependency
versions for OTP's applications are correct. The test case uses xref to check
if the used functions are available in the specified dependency versions. The
test case depends on the Erlang/OTP team's testing infrastructure and will be
skipped if its dependencies are not met.</p><p>Own Id: OTP-17224</p></li><li><p>An Erlang installation directory is now relocatable on the file system given
that the paths in the installation's <code class="inline">RELEASES</code> file are paths that are
relative to the installations root directory. The
<code class="inline">`release_handler:create_RELEASES/4</code> function can generate a <code class="inline">RELEASES</code>
file with relative paths if its <code class="inline">RootDir</code> parameter is set to the empty
string.</p><p>Own Id: OTP-17304</p></li><li><p>The following distribution flags are now mandatory: <code class="inline">DFLAG_BIT_BINARIES</code>,
<code class="inline">DFLAG_EXPORT_PTR_TAG</code>, <code class="inline">DFLAG_MAP_TAGS</code>, <code class="inline">DFLAG_NEW_FLOATS</code>, and
<code class="inline">DFLAG_FUN_TAGS</code>. This mainly concerns libraries or application that implement
the distribution protocol themselves.</p><p>Own Id: OTP-17318 Aux Id: PR-4972</p></li><li><p>Input for <code class="inline">configure</code> scripts adapted to <code class="inline">autoconf</code> 2.71.</p><p>Own Id: OTP-17414 Aux Id: PR-4967</p></li><li><p>When binary construction using the binary syntax fails, the error message
printed in the shell and by <code class="inline">erl_error:format_exception/3,4</code> will contain more
detailed information about what went wrong.</p><p>Own Id: OTP-17504 Aux Id: GH-4971, PR-5281, PR-5752</p></li><li><p>The configuration files <a href="erl_cmd.html"><code class="inline">.erlang</code></a>,
<a href="../../system/distributed.html"><code class="inline">.erlang.cookie</code></a> and
<a href="../../apps/stdlib/beam_lib.html#module-erlang-crypt"><code class="inline">.erlang.crypt</code></a> can now be located in the XDG
Config Home directory.</p><p>See the documentation for each file and <a href="../../apps/stdlib/filename.html#basedir/2"><code class="inline">filename:basedir/2</code></a> for more details.</p><p>Own Id: OTP-17554 Aux Id: GH-5016 PR-5408 OTP-17821</p></li><li><p>Make <a href="erlang.html#byte_size/1"><code class="inline">byte_size/1</code></a> and <code class="inline">binary_part/2/3</code> callable from match
specs (in ETS and tracing).</p><p>Own Id: OTP-17555 Aux Id: PR-5027</p></li><li><p>Dynamic node name improvements: <a href="erlang.html#is_alive/0"><code class="inline">erlang:is_alive/0</code></a> changed to return true for
pending dynamic node name and new function <a href="../../apps/kernel/net_kernel.html#get_state/0"><code class="inline">net_kernel:get_state/0</code></a>.</p><p>Own Id: OTP-17558 Aux Id: OTP-17538, PR-5111, GH-5402</p></li><li><p>A new option called <code class="inline">short</code> has been added to the functions
<code class="inline">erlang:float_to_list</code> and <code class="inline">erlang:float_to_binary</code>. This option creates the
shortest correctly rounded string representation of the given float that can
be converted back to the same float again.</p><p>Own Id: OTP-17562 Aux Id: GH-4492</p></li><li><p>The tagged tuple tests and fun-calls have been optimized and are now a little
bit cheaper than previously.</p><p>These optimizations become possible after making sure that all boxed terms
have at least one word allocated after the arity word. This has been
accomplished by letting all empty tuples refer to the same empty tuple literal
which also reduces memory usage for empty tuples.</p><p>Own Id: OTP-17608</p></li><li><p>The signal queue benchmark in parallel_messages_SUITE and the ETS benchmark in
ets_SUITE have benchmark result visualization HTML pages with &quot;fill-screen&quot;
buttons to make the graphs bigger. This button did not work as intended
before. When pressing the button for a graph, the last graph got replaced with
a bigger version and not the one over the button. This is now fixed.</p><p>Own Id: OTP-17630</p></li><li><p>The test case num_bif_SUITE:t_float_to_string previously failed sometimes as
it assumed a certain rounding of floats printed with sprintf but the rounding
type is platform specific.</p><p>Own Id: OTP-17636</p></li><li><p>Optimize interpreter to create heap binaries of small match contexts if
possible.</p><p>This optimization was already done in the JIT.</p><p>Own Id: OTP-17660 Aux Id: PR-5164</p></li><li><p>Optimize integer multiplication for x86 JIT</p><p>Own Id: OTP-17667 Aux Id: PR-5237</p></li><li><p>Removed use of node creation value zero as a wildcard. Also prevent zero from
being used as creation by <code class="inline">erl_interface</code> and <code class="inline">jinterface</code> nodes.</p><p>Own Id: OTP-17682 Aux Id: PR-5347</p></li><li><p>Distributed spawn operations now require
<a href="erl_dist_protocol.html#DFLAG_SPAWN">distributed <code class="inline">spawn_request()</code></a> support.
Distributed <code class="inline">spawn_request()</code> was introduced in OTP 23. That is, distributed
spawn operations against Erlang nodes of releases prior to OTP 23 will fail.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-17683 Aux Id: PR-5306</p></li><li><p>The Erlang compiler now includes type information in BEAM files, and the JIT
can now use that type information to do optimizations such as eliminating or
simplifying type tests.</p><p>Own Id: OTP-17684 Aux Id: PR-5316, PR-5664</p></li><li><p>Improved the JIT's support for external tools like <code class="inline">perf</code> and <code class="inline">gdb</code>, allowing
them to show line numbers and even the original Erlang source code when that
can be found.</p><p>To aid them in finding the source code, the <code class="inline">absolute_path</code> compiler option
has been added to embed the absolute file path of a module.</p><p>Own Id: OTP-17685</p></li><li><p>Add [32-bit] to the Erlang shell title row for 32-bit VMs.</p><p>Own Id: OTP-17717 Aux Id: PR-5290</p></li><li><p>Instructions for how to build the runtime system for iOS/iPadOS can now be
found in <code class="inline">HOWTO/INSTALL.md</code>.</p><p>Own Id: OTP-17728 Aux Id: PR-5284</p></li><li><p>Add support for static Elixir NIF modules with non-alphanumeric characters by
using new macro <code class="inline">STATIC_ERLANG_NIF_LIBNAME</code>.</p><p>Own Id: OTP-17729 Aux Id: PR-5477</p></li><li><p>Add new function <code class="inline">caller_line</code> to for trace match specifications used by
erlang:trace_pattern/3.</p><p>This new option puts the line number of the caller into the trace message sent
to the trace receiver.</p><p>Own Id: OTP-17753 Aux Id: PR-5305 GH-5297</p></li><li><p>A new <code class="inline">erl</code> command line argument <code class="inline">+ssrct</code> has been introduced which will
cause the runtime system to skip reading CPU topology information. This reduce
start up time especially when the CPU topology is large. Reading of CPU
topology information is now also skipped if a user defined CPU topology is set
using the <code class="inline">+sct</code> command line argument.</p><p>Own Id: OTP-17762 Aux Id: GH-5204, PR-5219</p></li><li><p>The default time warp mode will change in Erlang/OTP 26. Added a warning about
this upcoming potential incompatibility to the documentation.</p><p>Own Id: OTP-17772 Aux Id: GH-4965 PR-5644</p></li><li><p>The emulator will no longer mark unused memory as discardable (e.g. through
<code class="inline">madvise(2)</code>), as it caused more problems than it solved.</p><p>Own Id: OTP-17824</p></li><li><p>When a record matching or record update fails, a
<code class="inline">{badrecord,ExpectedRecordTag}</code> exception used to be raised. In this release,
the exception has been changed to <code class="inline">{badrecord,ActualValue}</code>, where
<code class="inline">ActualValue</code> is the actual that was found instead of the expected record.</p><p>Own Id: OTP-17841 Aux Id: PR-5694</p></li><li><p>Removed the previously undocumented and unsupported <code class="inline">emem</code> tool.</p><p>Own Id: OTP-17892 Aux Id: PR-5591</p></li><li><p>Remove version number from the default install path on Windows.</p><p>Own Id: OTP-17899 Aux Id: PR-5524</p></li><li><p>On Windows apply the limit flag JOB_OBJECT_LIMIT_BREAKAWAY_OK in the Erlang
service to be able to start a OS child process with a different session
number.</p><p>Own Id: OTP-17927 Aux Id: PR-5283</p></li><li><p>New erl command line option <code class="inline">+IOs</code>. It can be used to disable scheduler thread
poll optimization, which has been seen to cause degraded event latency in some
use cases.</p><p>Own Id: OTP-17945 Aux Id: GH-4759, PR-5809</p></li><li><p>An API for multihomed SCTP connect has been added in the guise of
<code class="inline">gen_sctp:connectx_init/*</code></p><p>Own Id: OTP-17951 Aux Id: PR-5656</p></li><li><p>[socket] Add encoding of the field hatype of the type sockaddr_ll (family
'packet').</p><p>Own Id: OTP-17968 Aux Id: OTP-16464</p></li><li><p>A cross compilation issue has been fixed about finding libdlpi during the
configure phase.</p><p>Own Id: OTP-17985 Aux Id: GH-5728</p></li><li><p><a href="erlang.html#process_info/2"><code class="inline">process_info/2</code></a> now also accepts <code class="inline">parent</code> as
argument. When passed, the process identifier of the parent process will be
returned.</p><p>Own Id: OTP-17999 Aux Id: PR-5768</p></li><li><p>Add function attributes to <code class="inline">erl_nif</code> and <code class="inline">erl_driver</code> APis to improve compiler
detection of interface misuse.</p><p>Own Id: OTP-18006 Aux Id: PR-5932</p></li><li><p>The exported type <a href="erlang.html#t:send_destination/0"><code class="inline">erlang:send_destination/0</code></a> has been introduced.</p><p>Own Id: OTP-18033 Aux Id: PR-2926, GH-5376</p></li><li><p>Building of the C/C++ make dependencies on Windows has been optimized to be a
lot faster.</p><p>Own Id: OTP-18036 Aux Id: PR-5846</p></li><li><p><a href="../../apps/kernel/file.html#sync/1"><code class="inline">file:sync/1</code></a> will now use the <code class="inline">F_BARRIERFSYNC</code> flag when available on Mac OS.</p><p>Own Id: OTP-18038</p></li></ul><h2 id="erts-12-3-2-17" class="section-heading"><a href="#erts-12-3-2-17" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.17</span></h2><h3 id="fixed-bugs-and-malfunctions-67" class="section-heading"><a href="#fixed-bugs-and-malfunctions-67" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The code server could be hanging if a module with <code class="inline">on_load</code> function was loaded at the same time as another module was purged using <code class="inline">erlang:purge_module</code> directly.</p><p>Own Id: OTP-19006</p></li><li><p>Fix bug in <a href="../../apps/stdlib/re.html#run/3"><code class="inline">re:run/3</code></a> where if an invalid UTF-8 subject was given, re:run could get stuck in an infinite loop. Bug was introduced in Erlang/OTP 22.1.</p><p>Own Id: OTP-19015 Aux Id: ERIERL-682</p></li><li><p>Calling <a href="erlang.html#trace/3"><code class="inline">erlang:trace/3</code></a> with first argument one of <code class="inline">ports</code>, <code class="inline">processes</code>, <code class="inline">existing_ports</code>, <code class="inline">existing_processes</code>, <code class="inline">existing</code> or <code class="inline">all</code>, could cause emulator crash if a dirty scheduler was executing a simultaneous trace action.</p><p>Own Id: OTP-19034</p></li><li><p>Fixed an integer overflow when the monotonic time unit reported by the operating system was greater than 10 and lower than 100 microseconds.</p><p>Own Id: OTP-19036 Aux Id: GH-8186</p></li><li><p>When a traced process executing on a dirty scheduler received an exit signal, the dirty scheduler could use the wrong thread specific data which could lead to a crash.</p><p>Own Id: OTP-19043 Aux Id: PR-8342</p></li><li><p>Fixed a more or less harmless bug that caused time correction of Erlang monotonic time to become slightly off on Windows platforms when <code class="inline">QueryPerformanceCounter()</code> was used as OS monotonic time source.</p><p><code class="inline">erlang:system_info(os_monotonic_time_source)</code> now also returns information about <em>used resolution</em> which not always corresponds to the resolution of the OS monotonic time source.</p><p>Own Id: OTP-19048 Aux Id: PR-8343</p></li></ul><h3 id="improvements-and-new-features-15" class="section-heading"><a href="#improvements-and-new-features-15" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Checks for monotonicity of monotonic time have been improved so that Erlang and OS monotonic time are checked separately.</p><p>A new <code class="inline">configure</code> argument <code class="inline">--enable-ensure-os-monotonic-time</code> has also been added. It enables functionality ensuring the monotonicity of monotonic timestamps delivered by the OS. When a non-monotonic timestamp is detected, it will be replaced by the last delivered monotonic timestamp before being used by Erlang's time functionality. Note that you do <em>not</em> want to enable this unless the OS monotonic time source on the system fails to produce monotonic timestamps. This since ensuring the monotonicity of OS monotonic timestamps will hurt scalability and performance of the system.</p><p>Own Id: OTP-19044 Aux Id: ERIERL-1043, PR-8342</p></li></ul><h2 id="erts-12-3-2-16" class="section-heading"><a href="#erts-12-3-2-16" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.16</span></h2><h3 id="fixed-bugs-and-malfunctions-68" class="section-heading"><a href="#fixed-bugs-and-malfunctions-68" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>32-bit runtime systems on most Unix like platforms could crash if a BIF timer was set with a huge timeout of more than 68 years into the future. In order for the crash to occur, the huge timer (at a later time than when it was set) had to become the nearest active timer set on the specific scheduler on which it was set. This could not happen on a system with only one scheduler since there would always be shorter timers in the system.</p><p>Setting a timer larger than 49 days on Windows could under rare circumstances cause the timeout to be delayed.</p><p>Own Id: OTP-18911 Aux Id: ERIERL-1023, PR-7983</p></li></ul><h2 id="erts-12-3-2-15" class="section-heading"><a href="#erts-12-3-2-15" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.15</span></h2><h3 id="fixed-bugs-and-malfunctions-69" class="section-heading"><a href="#fixed-bugs-and-malfunctions-69" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix faulty debug assert when page size is larger than 16kb, like on PowerPC.
Did crash debug VM directly at start.</p><p>Own Id: OTP-18802</p></li><li><p>On OTP 24 and OTP 25, incoming distributed messages larger than 64 KiB sent
using an alias leaked memory if the alias had been removed prior to entering
the node. This issue was not present on OTP 26.</p><p>Incoming distributed messages larger than 64 KiB sent using an alias which had
been removed on the receiving node could crash the node. This crash was quite
unlikely on OTP 24 and OTP 25, but very likely on OTP 26.</p><p><code class="inline">'DOWN'</code> signals with exit reason larger than 64 KiB directed towards a
process on a node with a not matching creation leaked memory on the receiving
node. Such signals should however be very rare.</p><p>Own Id: OTP-18885 Aux Id: GH-7834, GH-7890, PR-7915</p></li><li><p>Removed unnecessary PCRE source tar-ball.</p><p>Own Id: OTP-18902</p></li></ul><h3 id="improvements-and-new-features-16" class="section-heading"><a href="#improvements-and-new-features-16" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Removed unnecessary regexp library used when generating yielding BIFs.</p><p>Own Id: OTP-18830 Aux Id: PR-7823</p></li><li><p>Replaced old md5 implementation with an implementation from OpenSSL.</p><p>Own Id: OTP-18877</p></li><li><p>Removed unused <code class="inline">makewhatis</code> script.</p><p>Own Id: OTP-18899</p></li></ul><h2 id="erts-12-3-2-14" class="section-heading"><a href="#erts-12-3-2-14" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.14</span></h2><h3 id="fixed-bugs-and-malfunctions-70" class="section-heading"><a href="#fixed-bugs-and-malfunctions-70" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix bug causing &quot;magic&quot; references in a <code class="inline">compressed</code> ETS table to not keep the
referred object alive. The symptom would be the referred object being garbage
collected prematurely and the reference appearing stale, not referring to
anything. Examples of such magically referred objects are <code class="inline">atomics</code> and NIF
resources.</p><p>Own Id: OTP-18732 Aux Id: GH-7444, PR-7458</p></li><li><p>The cleanup operation of not yet delivered signals to a terminated process
yielded excessively.</p><p>Own Id: OTP-18752 Aux Id: PR-7633</p></li><li><p>If the external term format encoding of an argument list part of a distributed
spawn operation was faulty, the newly spawned remote process could misbehave.
The misbehavior included hanging or interpret an incoming message as an
argument list to use. This was very unlikely to happen unless using an
alternate implementation of the distribution protocol which made a faulty
encoding of the argument list. The child process will now detect this error
and terminate before executing the user specified code.</p><p>Own Id: OTP-18790 Aux Id: PR-7742</p></li><li><p>Fix bugs where if the body of a matchspec would return a map with a variable
('$1', '$_' etc) as one of the keys or values and the variable was not an
immidiate, the term would not be copied to the receiving processes heap. This
would later corrupt the term in the table as the GC could place move markers
in it, which in turn would cause the VM to crash.</p><p>Bug has been present for since OTP 17.0.</p><p>Own Id: OTP-18797 Aux Id: PR-7712 GH-7683</p></li></ul><h2 id="erts-12-3-2-13" class="section-heading"><a href="#erts-12-3-2-13" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.13</span></h2><h3 id="fixed-bugs-and-malfunctions-71" class="section-heading"><a href="#fixed-bugs-and-malfunctions-71" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The following functions are now much faster when given a long list or binary:</p><ul><li>erlang:list_to_integer/1</li><li>erlang:binary_to_integer/1</li><li>erlang:binary_to_integer/2</li><li>erlang:list_to_integer/2</li><li>string:to_integer/1</li></ul><p>Own Id: OTP-18659 Aux Id: PR-7426</p></li></ul><h2 id="erts-12-3-2-12" class="section-heading"><a href="#erts-12-3-2-12" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.12</span></h2><h3 id="fixed-bugs-and-malfunctions-72" class="section-heading"><a href="#fixed-bugs-and-malfunctions-72" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In rare circumstances, bit syntax matching of an invalid code point for a
<code class="inline">utf32</code> would crash the runtime system.</p><p>Own Id: OTP-18560</p></li><li><p>If a runtime system which was starting the distribution already had existing
pids, ports, or references referring to a node with the same nodename/creation
pair that the runtime system was about to use, these already existing pids,
ports, or references would not work as expected in various situations after
the node had gone alive. This could only occur if the runtime system was
communicated such pids, ports, or references prior to the distribution was
started. That is, it was extremely unlikely to happen unless the distribution
was started dynamically and was even then very unlikely to happen. The runtime
system now checks for already existing pids, ports, and references with the
same nodename/creation pair that it is about to use. If such are found another
creation will be chosen in order to avoid these issues.</p><p>Own Id: OTP-18570 Aux Id: PR-7190</p></li><li><p>Constructing a binary segment not aligned with a byte boundary, with a size
not fitting in 31 bits, and with a value not fitting in a 64-bit word could
crash the runtime system.</p><p>Own Id: OTP-18597</p></li></ul><h3 id="improvements-and-new-features-17" class="section-heading"><a href="#improvements-and-new-features-17" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Further robustify implementation of large maps (&gt; 32 keys). Keys that happen
to have same internal 32-bit hash values are now put in collision nodes which
are traversed with linear search. This removes the demand for the internal
hash function when salted to eventually produce different hashes for all
possible pairs of unequal terms.</p><p>Own Id: OTP-18569</p></li></ul><h2 id="erts-12-3-2-11" class="section-heading"><a href="#erts-12-3-2-11" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.11</span></h2><h3 id="fixed-bugs-and-malfunctions-73" class="section-heading"><a href="#fixed-bugs-and-malfunctions-73" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix bug sometimes causing emulator crash at node shutdown when there are
pending connections. Only seen when running duel distribution protocols,
inet_drv and inet_tls_dist.</p><p>Own Id: OTP-18243 Aux Id: GH-6247, PR-6258</p></li><li><p>Fix bug in <code class="inline">binary_to_term</code> (and distributed receive) when decoding a large
map (&gt;32 keys) with unsorted small maps (&lt;= 32) as keys of the large map.</p><p>This was only a problem if the term was encoded by <code class="inline">erl_interface</code>,
<code class="inline">jinterface</code> or otherwise, as the VM itself always encodes small maps with
sorted keys.</p><p>The &quot;binary_to_term&quot; would appear as successful but the created large map was
internally inconsistent. The smaller key-maps could not be found with maps:get
and friends. Other operations such as map compare and merge could probably
also give incorrect results.</p><p>Own Id: OTP-18343 Aux Id: GH-6496</p></li><li><p>Implementations of the <a href="driver_entry.html#call"><code class="inline">call()</code></a> driver callback that
returned a faulty encoded result could cause a memory leak and could cause
invalid data on the heap of the processes calling <a href="erlang.html#port_call/3"><code class="inline">erlang:port_call/3</code></a>.</p><p>Own Id: OTP-18525 Aux Id: PR-7049</p></li><li><p>Aliases created in combination with a monitor using the
<code class="inline">{alias, explicit_unalias}</code> option stopped working from remote nodes when a
<code class="inline">'DOWN'</code> signal had been received due to the monitor or if the monitor was
removed using the <code class="inline">erlang:demonitor()</code> BIF.</p><p>This bug was introduced in OTP 24.3.4.10 and OTP 25.3.</p><p>Own Id: OTP-18557 Aux Id: PR-7131, OTP-18496</p></li></ul><h2 id="erts-12-3-2-10" class="section-heading"><a href="#erts-12-3-2-10" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.10</span></h2><h3 id="fixed-bugs-and-malfunctions-74" class="section-heading"><a href="#fixed-bugs-and-malfunctions-74" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Active process aliases of a process at its termination leaked memory.</p><p>Own Id: OTP-18496 Aux Id: GH-6947, PR-6953</p></li></ul><h2 id="erts-12-3-2-9" class="section-heading"><a href="#erts-12-3-2-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.9</span></h2><h3 id="fixed-bugs-and-malfunctions-75" class="section-heading"><a href="#fixed-bugs-and-malfunctions-75" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><a href="erlang.html#process_info/2"><code class="inline">process_info(Pid, status)</code></a> when <code class="inline">Pid /= self()</code> could
return an erroneous result.</p><p>Own Id: OTP-18421 Aux Id: PR-6806</p></li><li><p>In rare circumstances, when a process exceeded its allowed heap size set by
option <code class="inline">max_heap_size</code>, it would not be killed as it should be, but instead
enter a kind of zombie state it would never get out of.</p><p>Own Id: OTP-18463 Aux Id: PR-6858</p></li></ul><h2 id="erts-12-3-2-8" class="section-heading"><a href="#erts-12-3-2-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.8</span></h2><h3 id="fixed-bugs-and-malfunctions-76" class="section-heading"><a href="#fixed-bugs-and-malfunctions-76" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in selective receive optimization that could crash 32-bit
emulators.</p><p>Own Id: OTP-18383 Aux Id: ERIERL-905</p></li><li><p>A race condition which was very rarely triggered could cause the signal queue
of a process to become inconsistent causing the runtime system to crash.</p><p>Own Id: OTP-18388 Aux Id: OTP-17462, PR-6662</p></li></ul><h2 id="erts-12-3-2-7" class="section-heading"><a href="#erts-12-3-2-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.7</span></h2><h3 id="fixed-bugs-and-malfunctions-77" class="section-heading"><a href="#fixed-bugs-and-malfunctions-77" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Spec for function net:if_names/0 incorrect</p><p>Own Id: OTP-18296 Aux Id: OTP-16464</p></li><li><p>Fix bug in <code class="inline">binary_to_term</code> decoding a binary term 2Gbyte or larger.</p><p>Own Id: OTP-18306 Aux Id: GH-6393, PR-6401</p></li><li><p>Fix <a href="erlang.html#list_to_atom/1"><code class="inline">list_to_atom/1</code></a> for negative code points. Could
either return with a positive code point or fail with an incorrect exception.</p><p>Own Id: OTP-18321</p></li><li><p>Fix bug in <code class="inline">binary_to_term</code> decoding a list of length 1G or longer.</p><p>Own Id: OTP-18328 Aux Id: GH-6439, PR-6440</p></li></ul><h2 id="erts-12-3-2-6" class="section-heading"><a href="#erts-12-3-2-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.6</span></h2><h3 id="fixed-bugs-and-malfunctions-78" class="section-heading"><a href="#fixed-bugs-and-malfunctions-78" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><a href="erlang.html#dist_ctrl_get_data_notification/1">Notifications about available distribution data</a>
sent to distribution controller processes could be lost. Distribution
controller processes can be used when implementing an alternative distribution
carrier. The default distribution over tcp was not effected and the bug was
also not present on x86/x86_64 platforms.</p><p>Own Id: OTP-18258 Aux Id: GH-6309, PR-6324</p></li></ul><h2 id="erts-12-3-2-5" class="section-heading"><a href="#erts-12-3-2-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.5</span></h2><h3 id="fixed-bugs-and-malfunctions-79" class="section-heading"><a href="#fixed-bugs-and-malfunctions-79" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix writing and reading of more than 2 GB in a single read/write operation on
macOS. Before this fix attempting to read/write more than 2GB would result in
<code class="inline">{error,einval}</code>.</p><p>Own Id: OTP-18222 Aux Id: PR-6248 GH-6242</p></li></ul><h2 id="erts-12-3-2-4" class="section-heading"><a href="#erts-12-3-2-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.4</span></h2><h3 id="fixed-bugs-and-malfunctions-80" class="section-heading"><a href="#fixed-bugs-and-malfunctions-80" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix bug causing <code class="inline">ets:info</code> (and sometimes <code class="inline">ets:whereis</code>) to return 'undefined'
for an existing table if a concurrent process were doing <code class="inline">ets:insert</code> with a
long list on the same table.</p><p>Own Id: OTP-18218 Aux Id: ERIERL-855</p></li></ul><h2 id="erts-12-3-2-3" class="section-heading"><a href="#erts-12-3-2-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.3</span></h2><h3 id="fixed-bugs-and-malfunctions-81" class="section-heading"><a href="#fixed-bugs-and-malfunctions-81" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix faulty distribution encoding of terms with either</p><ul><li>a fun with bit-string or export-fun in its environment when encoded toward a
not yet established (pending) connection</li><li>or a fun with a binary/bitstring, in its environment, referring to an
off-heap binary (larger than 64 bytes).</li></ul><p>The symptom could be failed decoding on the receiving side leading to aborted
connection. Fix OTP-18093 is a workaround for theses bugs that makes the VM
accepts such faulty encoded funs.</p><p>The first encoding bug toward pending connection exists only in OTP 23 and 24,
but the second one exists also on OTP 25.</p><p>Own Id: OTP-18104 Aux Id: OTP-18093</p></li><li><p>Distributed exit signals could be lost under the following conditions:</p><ul><li><p>An exit signal from a parent process to a child process was lost if:</p><ul><li>the parent process terminated before the spawn request that created the
child had completed,</li><li>the spawn request set up a link between parent and child</li><li>the spawn request was distributed, and</li><li>the exit reason was larger than one machine word.</li></ul></li><li><p>Loss of a connection over which a not yet completed spawn request was
ongoing could cause loss of exit signals. Such loss of exit signals was very
rare. Besides the above described connection loss also the following
conditions had to be satisfied:</p><ul><li>The spawn request that was interrupted by the connection loss also had to
set up a link between the parent process and the child process.</li><li>The parent process that issued the spawn request also had to be
terminating while the spawn request was interrupted by the connection
loss.</li><li>The same parent process also had to have made other spawn requests to
other nodes than to the node to which the connection was lost.</li><li>These spawn requests to the other nodes also had to set up links.</li><li>These spawn requests to the other nodes also had to be not yet completed
at the time of the connection loss. That is, the spawn reply from the
child process had not yet reached the parent process.</li></ul><p>If all the conditions above were met, exit signals to the children spawned
due to the above described spawn requests to other nodes <em>could</em> be lost.</p><p>The above bug also caused a significant memory leak when it was triggered
since the destruction of the parent process never completed.</p></li></ul><p>Own Id: OTP-18164 Aux Id: PR-6114</p></li><li><p>A race could cause <a href="erlang.html#process_info/2"><code class="inline">process_info(Pid, message_queue_len)</code></a>
on other processes to return invalid results.</p><p>Own Id: OTP-18169 Aux Id: PR-6134</p></li><li><p>Fixed reduction counting for handling process system tasks.</p><p>Own Id: OTP-18170 Aux Id: PR-6135</p></li><li><p>Priority elevation of terminating processes did not work which could cause
execution of such processes to be delayed.</p><p>Own Id: OTP-18175 Aux Id: PR-6142</p></li><li><p>An unlink operation made by a process that terminated before the unlink
operation completed, i.e., before it had received an unlink-ack signal from
the linked process, caused an exit signal to erroneously be sent from the
terminating process to the process being unlinked. This exit signal would most
often be ignored by the receiver, but if the receiver of the exit signal
concurrently set up a new link, it could receive the exit signal with the
actual exit reason of the terminating process instead of a <code class="inline">noproc</code> exit
reason. It is however very hard to detect that this has happened and has no
obvious negative consequences, so it should be considered harmless.</p><p>A distributed unlink-ack signal received by a terminating process was also not
properly removed which could cause a minor memory leak.</p><p>Own Id: OTP-18177 Aux Id: PR-6150</p></li><li><p>The <a href="erlang.html#monitor/3"><code class="inline">monitor/3</code></a> BIF did not apply options to the created
monitor if the target process or port did not exist. That is, the
corresponding down message would get a <code class="inline">`DOWN`</code> tag even if a custom tag
had been set, and the returned reference was not an alias even if the <code class="inline">alias</code>
option had been passed.</p><p>Own Id: OTP-18190 Aux Id: GH-6185, PR-6209</p></li><li><p>The <a href="erlang.html#monotonic_time/1"><code class="inline">erlang:monotonic_time/1</code></a>, <a href="erlang.html#system_time/1"><code class="inline">erlang:system_time/1</code></a>, <a href="erlang.html#time_offset/1"><code class="inline">erlang:time_offset/1</code></a>,
and <a href="../../apps/kernel/os.html#system_time/1"><code class="inline">os:system_time/1</code></a> BIFs erroneously failed when passed the argument
<code class="inline">native</code>.</p><p>Own Id: OTP-18197 Aux Id: GH-6165, PR-6213</p></li></ul><h2 id="erts-12-3-2-2" class="section-heading"><a href="#erts-12-3-2-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.2</span></h2><h3 id="fixed-bugs-and-malfunctions-82" class="section-heading"><a href="#fixed-bugs-and-malfunctions-82" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed emulator crash that could happen during crashdump generation of ETS
tables with options <code class="inline">ordered_set</code> and <code class="inline">{write_concurrency,true}</code>.</p><p>Own Id: OTP-18144 Aux Id: GH-5981</p></li></ul><h2 id="erts-12-3-2-1" class="section-heading"><a href="#erts-12-3-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-83" class="section-heading"><a href="#fixed-bugs-and-malfunctions-83" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Accept funs (NEW_FUN_EXT) with incorrectly encoded size field. This is a
workaround for a bug (OTP-18104) existing in OTP 23 and 24 that could cause
incorrect size fields in certain cases. The emulator does not use the decoded
size field, but <code class="inline">erl_interface</code> still does and is not helped by this
workaround.</p><p>Own Id: OTP-18093 Aux Id: OTP-18104, PR-5987</p></li><li><p>The zlib built in to the runtime system has been updated to version 1.2.12.
(Note that on most platforms, the platform's own zlib is used.)</p><p>Own Id: OTP-18123 Aux Id: GH-5994</p></li></ul><h2 id="erts-12-3-2" class="section-heading"><a href="#erts-12-3-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.2</span></h2><h3 id="fixed-bugs-and-malfunctions-84" class="section-heading"><a href="#fixed-bugs-and-malfunctions-84" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Let EPMD tolerate failure when binding to IPv4/IPv6 loopback intefaces in
addition to user-supplied addresses via <code class="inline">ERL_EPMD_ADDRESS</code> or the <code class="inline">-address</code>
option. This can happen, for example, if the host system has ipv6 disabled via
the disable_ipv6 sysctl.</p><p>Own Id: OTP-17970 Aux Id: PR-5762</p></li><li><p>Fixed a rare bug in <a href="erlang.html#binary_to_term/1"><code class="inline">binary_to_term/1</code></a>,
<code class="inline">enif_make_map_from_arrays</code>, <code class="inline">erl_drv_send_term</code>, and Erlang distribution that
could crash the emulator.</p><p>Own Id: OTP-18027</p></li><li><p>Fixed a rare race in <code class="inline">persistent_term:get/1,2</code> that could cause it to return
the value of another key.</p><p>Own Id: OTP-18065 Aux Id: GH-5908</p></li><li><p>Fix bug where the process message queue was left in an inconsistent state when
changing from on_heap to off_heap message queue data causing the GC to
segfault.</p><p>Own Id: OTP-18075 Aux Id: PR-5927</p></li><li><p>Fix functions that convert universal to localtime (such as erlang:localtime/0
and erlang:universaltime_to_localtime/1) to fetch the correct localtime if it
is changed after the start of the VM.</p><p>Own Id: OTP-18076 Aux Id: ERIERL-802 PR-5905</p></li><li><p>Fix memory leak when a process doing a distributed fragmented send is sent an
exit signal. Before this fix the receiving node would be left with an
incomplete message that would remain until the nodes were disconnected. The
bug has existed since Erlang/OTP 21.</p><p>Own Id: OTP-18077 Aux Id: GH-5876 PR-5892</p></li><li><p>Corrected the behaviour of the shutdown function when using with the
inet_backend = socket. It was not sufficiently compatible with the &quot;old&quot;
gen_tcp.</p><p>Own Id: OTP-18080 Aux Id: GH-5930</p></li></ul><h2 id="erts-12-3-1" class="section-heading"><a href="#erts-12-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3.1</span></h2><h3 id="fixed-bugs-and-malfunctions-85" class="section-heading"><a href="#fixed-bugs-and-malfunctions-85" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><code class="inline">erlang:open_port({spawn, _},_)</code> has been fixed on Windows to handle
whitespace characters in the path correctly.</p><p>This could, for example, cause execution of the resolver helper program
<code class="inline">inet_gethost</code> to fail and instead possibly execute a different program.</p><p>Own Id: OTP-17978 Aux Id: OTP-17958</p></li><li><p>Fix race condition when creating crash dump that could cause multiple threads
to race when writing the initial information in a crash dump.</p><p>The race condition was introduced in erts-12.2 (Erlang/OTP 24.2).</p><p>Own Id: OTP-17993 Aux Id: PR-5806</p></li><li><p>Fix Erlang monotonic time on MacOS. Previously used OS monotonic time
primitive on MacOS is buggy and will not be used anymore. It has been replaced
with usage of another OS monotonic time primitive that does not appear to be
buggy.</p><p>Own Id: OTP-17998 Aux Id: PR-5825, GH-5554</p></li></ul><h2 id="erts-12-3" class="section-heading"><a href="#erts-12-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.3</span></h2><h3 id="fixed-bugs-and-malfunctions-86" class="section-heading"><a href="#fixed-bugs-and-malfunctions-86" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in the x86 JIT that might cause floating point instructions to
wrongly throw an exception.</p><p>Own Id: OTP-17822</p></li><li><p>Preserve correct <code class="inline">nodedown_reason</code> if supervised distribution controller
processes exit with <code class="inline">{shutdown, Reason}</code>.</p><p>Own Id: OTP-17838 Aux Id: PR-5748</p></li><li><p>Handling of <code class="inline">send_timeout</code> for <code class="inline">gen_tcp</code> has been corrected so that the
timeout is honored also when sending 0 bytes.</p><p>Own Id: OTP-17840</p></li><li><p>By default <code class="inline">global</code> does <em>not</em> take any actions to restore a fully connected
network when connections are lost due to network issues. This is problematic
for all applications expecting a fully connected network to be provided, such
as for example <code class="inline">mnesia</code>, but also for <code class="inline">global</code> itself. A network of
overlapping partitions might cause the internal state of <code class="inline">global</code> to become
inconsistent. Such an inconsistency can remain even after such partitions have
been brought together to form a fully connected network again. The effect on
other applications that expects that a fully connected network is maintained
may vary, but they might misbehave in very subtle hard to detect ways during
such a partitioning.</p><p>In order to prevent such issues, we have introduced a <em>prevent overlapping
partitions</em> fix which can be enabled using the
<a href="../../apps/kernel/kernel_app.html#prevent_overlapping_partitions"><code class="inline">prevent_overlapping_partitions</code></a>
<code class="inline">kernel(6)</code> parameter. When this fix has been enabled, <code class="inline">global</code> will actively
disconnect from nodes that reports that they have lost connections to other
nodes. This will cause fully connected partitions to form instead of leaving
the network in a state with overlapping partitions. Note that this fix <em>has</em>
to be enabled on <em>all</em> nodes in the network in order to work properly. Since
this quite substantially changes the behavior, this fix is currently disabled
by default. Since you might get hard to detect issues without this fix you
are, however, <em>strongly</em> advised to enable this fix in order to avoid issues
such as the ones described above. As of OTP 25 this fix will become enabled by
default.</p><p>Own Id: OTP-17843 Aux Id: ERIERL-732, PR-5611</p></li><li><p>Corrected the type specification of <code class="inline">erlang:seq_trace/2</code>.</p><p>Own Id: OTP-17900 Aux Id: GH-5667</p></li><li><p>Fix memory leak when tracing on running on a process that only handle system
tasks or non-message signals (for example process_info requests).</p><p>Own Id: OTP-17904 Aux Id: ERIERL-757</p></li></ul><h3 id="improvements-and-new-features-18" class="section-heading"><a href="#improvements-and-new-features-18" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Add support for using socket:sockaddr_in() and socket:sockaddr_in6() when
using gen_sctp, gen_tcp and gen_udp. This will make it possible to use Link
Local IPv6 addresses.</p><p>Own Id: OTP-17455 Aux Id: GH-4852</p></li><li><p>Show <code class="inline">on_load</code> failure reasons in embedded mode.</p><p>Own Id: OTP-17718 Aux Id: PR-5199</p></li><li><p>Compile date saved in the Erlang VM executable has been removed.</p><p>Own Id: OTP-17891 Aux Id: PR-5589</p></li><li><p>Improve documentation for the dynamic node name feature.</p><p>Own Id: OTP-17918</p></li></ul><h2 id="erts-12-2-1" class="section-heading"><a href="#erts-12-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-87" class="section-heading"><a href="#fixed-bugs-and-malfunctions-87" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a memory leak in <a href="../../apps/kernel/file.html#read_file_info/2"><code class="inline">file:read_file_info/2</code></a> and <a href="../../apps/kernel/file.html#read_file/1"><code class="inline">file:read_file/1</code></a> on
Windows.</p><p>Own Id: OTP-17827 Aux Id: GH-5527</p></li><li><p>Fix GC emulator crash when <code class="inline">spawn_request</code> was used when message tracing was
enabled.</p><p>Own Id: OTP-17871 Aux Id: PR-5612</p></li></ul><h2 id="erts-12-2" class="section-heading"><a href="#erts-12-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.2</span></h2><h3 id="fixed-bugs-and-malfunctions-88" class="section-heading"><a href="#fixed-bugs-and-malfunctions-88" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>When matching and constructing <code class="inline">utf16</code> segments in the binary syntax, the
<code class="inline">native</code> flag would be ignored. That is, the endian would always be big endian
even on a little-endian computer (almost all modern computers).</p><p>Own Id: OTP-17713</p></li><li><p>Fix the help printout of <code class="inline">+JPperf</code>.</p><p>Own Id: OTP-17749 Aux Id: PR-5378 GH-5361</p></li><li><p>Fix bug that could cause Erlang to deadlock during creation of an Erlang crash
dump.</p><p>Own Id: OTP-17751 Aux Id: PR-5315</p></li><li><p>Fixed C++ build errors on some aarch64 platforms.</p><p>Own Id: OTP-17763 Aux Id: GH-5351</p></li><li><p>For macOS, the <code class="inline">Info.plist</code> file embedded in the runtime system now only
contains the absolute minimum amount of information needed for the web view in
<code class="inline">wx</code> to work towards <code class="inline">localhost</code>. The other fields have been removed, allowing
an application packaged in a bundle to specify the application name and other
parameter in its own <code class="inline">Info.plist</code> file.</p><p>Own Id: OTP-17785 Aux Id: PR-5393</p></li><li><p>Fix bug in internal stacks (WSTACK and ESTACK) used by
<a href="erlang.html#term_to_binary/2"><code class="inline">term_to_binary/2</code></a> to encode terms. The bug could cause
a segfault if a very very large map was to be encoded with the <code class="inline">deterministic</code>
option given.</p><p>Own Id: OTP-17804 Aux Id: PR-5372</p></li><li><p>Improve the error printout when <a href="erlang.html#open_port/2"><code class="inline">open_port/2</code></a> fails because
of invalid arguments.</p><p>Own Id: OTP-17805 Aux Id: PR-5406</p></li><li><p>Fix bug in crash dumps where the stackframe of a process would be printed
using an incorrect format.</p><p>Crash dump viewer has also been fixed to be able read the broken stack format.</p><p>The bug has existed since Erlang/OTP 23.0.</p><p>Own Id: OTP-17814 Aux Id: PR-5462</p></li></ul><h3 id="improvements-and-new-features-19" class="section-heading"><a href="#improvements-and-new-features-19" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>An option for enabling dirty scheduler specific allocator instances has been
introduced. By default such allocator instances are disabled. For more
information see the documentation of the <a href="erts_alloc.html#Mdai"><code class="inline">+Mdai</code></a> <code class="inline">erl</code>
command line argument.</p><p>Own Id: OTP-17363 Aux Id: GH-4728, PR-5187</p></li><li><p>Minor optimization of receive markers in message queues.</p><p>Own Id: OTP-17673 Aux Id: OTP-16226</p></li><li><p>All predefined types have been added to the <code class="inline">erlang</code> module together with
documentation.</p><p>Any reference to a predefined type now links to that documentation so that the
user can view it.</p><p>Own Id: OTP-17689 Aux Id: PR-5292</p></li><li><p>Suppress a code checker warning caused by debug builds of YCF. YCF tries to
get a conservative estimate of the bottom of the stack by reading and
returning a call stack allocated variable.</p><p>Own Id: OTP-17719</p></li><li><p>Add file and product properties to erl.exe and werl.exe.</p><p>Own Id: OTP-17724 Aux Id: ERL-1224</p></li><li><p>Micro optimization in bitstring append operations.</p><p>Own Id: OTP-17760 Aux Id: ERIERL-725, PR-5414</p></li><li><p>Responsiveness of processes executing on <code class="inline">normal</code> or <code class="inline">low</code> priority could
suffer due to code purging or literal area removal on systems with a huge
amount of processes. This since during these operations all processes on the
system were scheduled for execution at once.</p><p>This problem has been fixed by introducing a limit on outstanding purge and
copy literal requests in the system. By default this limit is set to twice the
amount of schedulers on the system. This will ensure that schedulers will have
enough work scheduled to perform these operations as quickly as possible at
the same time as other work will be interleaved to a much higher degree.
Performance of these operations will however be somewhat degraded due to the
overhead of enforcing this limit compared to when using a very large limit.</p><p>This limit can be set by passing the <code class="inline">+zosrl</code> command line argument to <code class="inline">erl</code>,
or by calling
<code class="inline">erlang:system_flag(outstanding_system_requests_limit, NewLimit)</code>.</p><p>Own Id: OTP-17796 Aux Id: ERIERL-729, PR-5473</p></li></ul><h2 id="erts-12-1-5" class="section-heading"><a href="#erts-12-1-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.1.5</span></h2><h3 id="fixed-bugs-and-malfunctions-89" class="section-heading"><a href="#fixed-bugs-and-malfunctions-89" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The runtime system could call <code class="inline">select()</code> with a too large timeout value when
executing on MacOS. This could in turn cause the runtime system to crash.</p><p>Own Id: OTP-17735 Aux Id: GH-5339</p></li><li><p>The fix for Linux's behaviour when reconnecting an UDP socket in PR-5120
released in OTP-24.1.2 has been refined to only dissolve the socket's
connection before a connect if the socket is already connected, that is: only
for a reconnect.</p><p>This allows code to open a socket with an ephemeral port, get the port number
and connect; without the port number changing (on Linux). This turned out to
have at least one valid use case (besides test cases).</p><p>Should one reconnect the socket then the port number may change, on Linux; it
is a known quirk, which can be worked around by binding to a specific port
number when opening the socket. If you can do without an ephemeral port, that
is...</p><p>Own Id: OTP-17736 Aux Id: GH-5279, PR-5120, OTP-17559</p></li><li><p>Certain distributed signals that for various reasons must to be forced into
the distribution buffer even when it is full would instead be lost if the
distribution buffer was full when sent. The effected signals:</p><ul><li><code class="inline">EXIT</code> signals with exit reasons of one word size.</li><li><code class="inline">DOWN</code> signals with exit reasons of one word size.</li><li><code class="inline">demonitor</code> signals from a terminating process.</li><li><code class="inline">unlink_ack</code> signals on OTP 23 and 24.</li><li><code class="inline">spawn_reply</code> signals on OTP 23 and 24.</li></ul><p>Own Id: OTP-17737 Aux Id: GH-5346, GH-4989</p></li></ul><h2 id="erts-12-1-4" class="section-heading"><a href="#erts-12-1-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.1.4</span></h2><h3 id="fixed-bugs-and-malfunctions-90" class="section-heading"><a href="#fixed-bugs-and-malfunctions-90" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix bug where a gen_tcp write error that happened during a delayed_send would
cause a use after free segfault.</p><p>Own Id: OTP-17731 Aux Id: PR-5285</p></li><li><p>Fix x86 JIT bug where a <code class="inline">rem</code> instruction could cause a segfault if given
values that would cause an badarith exception.</p><p>Own Id: OTP-17732 Aux Id: PR-5331 ERIERL-664</p></li></ul><h2 id="erts-12-1-3" class="section-heading"><a href="#erts-12-1-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.1.3</span></h2><h3 id="fixed-bugs-and-malfunctions-91" class="section-heading"><a href="#fixed-bugs-and-malfunctions-91" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Reduction counter was not updated before and after doing <code class="inline">apply</code> operations on
the runtime system with the jit enabled. This caused reduction counting to get
out of sync if a garbage collection was made as part of the <code class="inline">apply</code> operation.</p><p>Own Id: OTP-17675</p></li><li><p>This fixes a bug in <code class="inline">erts_factory_undo</code> that caused the heap to not be reset
correctly. The <code class="inline">erts_factory_undo</code> function is, for example, called when a
<a href="erlang.html#binary_to_term/1"><code class="inline">binary_to_term/1</code></a> call fails to reset the heap to its
state before the <a href="erlang.html#binary_to_term/1"><code class="inline">binary_to_term/1</code></a> call. This can cause
the heap to contain invalid terms which potentially can cause issues (e.g.,
crashes) when the whole heap is scanned.</p><p>Own Id: OTP-17677</p></li><li><p>When attempting to construct a binary with an segment having an illegal type
for the size (e.g. an atom), there could be an unnecessary memory allocation
(and subsequent deallocation) before the operation failed. Amended to fail
before allocating any memory for the binary.</p><p>Own Id: OTP-17686</p></li><li><p>Fix bug in <code class="inline">persistent_term</code> when a key-value pair contains a magic reference
that is referred more than once. Magic references are NIF resources or
returned from BIFs like <code class="inline">ets:new</code>, <code class="inline">atomics:new</code>. The bug could cause the
memory of the referred resource to be prematurely deallocated.</p><p>The bug also apply to magic references in message passing on a runtime built
with configure option <code class="inline">--enable-sharing-preserving</code>.</p><p>Bug exist for 64-bit since OTP-24.0 and for 32-bit since OTP-20.0.</p><p>Own Id: OTP-17700 Aux Id: GH-5271, PR-5273</p></li><li><p>Fixed a crash when inspecting the stack trace of an exception raised at a very
high line number.</p><p>This bug was introduced in OTP 24.</p><p>Own Id: OTP-17712</p></li><li><p>The following two bugs that caused <code class="inline">erlang:demonitor()</code> to behave erroneously
have been fixed. The bugs were only triggered if the monitor that was removed
by <code class="inline">demonitor()</code> had previously been created simultaneously as a monitor and
as an alias.</p><ul><li>A demonitor operation on a monitor created using the
<code class="inline">{alias, reply_demonitor}</code> option erroneously behaved as if the
<code class="inline">{alias, explicit_unalias}</code> option had been used.</li><li>A demonitor operation did not prevent a corresponding <code class="inline">'DOWN'</code> message from
being delivered if the monitor reference was kept as an active alias after
the operation. This could only occur if the monitored process simultaneously
terminated before the demonitor signal reached it, and the exit reason was
not an immediate term. That is, a term larger than one machine word.</li></ul><p>Own Id: OTP-17722 Aux Id: GH-5310, PR-5313</p></li></ul><h2 id="erts-12-1-2" class="section-heading"><a href="#erts-12-1-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.1.2</span></h2><h3 id="improvements-and-new-features-20" class="section-heading"><a href="#improvements-and-new-features-20" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The python scripts that existed in
erts/lib_src/yielding_c_fun/lib/tiny_regex_c/scripts had a license that was
incompatible with Erlang/OTP's license. This ticket removes these scripts that
were not used by us.</p><p>Own Id: OTP-17658</p></li></ul><h2 id="erts-12-1-1" class="section-heading"><a href="#erts-12-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-92" class="section-heading"><a href="#fixed-bugs-and-malfunctions-92" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A race between an exiting port and handling of simultaneously received signals
to that port could cause a runtime system crash. The effected signals are
<code class="inline">link</code>, <code class="inline">monitor</code> and <code class="inline">demonitor</code>. On OTP 22 a similar race could also cause a
memory leak when receiving an <code class="inline">unlink</code> signal.</p><p>Own Id: OTP-17642 Aux Id: PR-5248</p></li><li><p><a href="erlang.html#monitor/3">A user defined tag on a monitor message</a> could cause the
runtime system to crash when the monitor message had been received.</p><p>Own Id: OTP-17646 Aux Id: GH-5221, PR-5232</p></li><li><p>A call to <a href="erlang.html#demonitor/1"><code class="inline">erlang:demonitor(Ref)</code></a> where the reference
<code class="inline">Ref</code> referred to an active alias, but not an active monitor, caused the
runtime system to crash.</p><p>Own Id: OTP-17647 Aux Id: GH-5225, PR-5230</p></li><li><p>The message queue of a process entered an inconsistent state after a <code class="inline">receive</code>
expression with an invalid timeout value was executed. If the exception raised
due to the invalid timeout value was caught, the following <code class="inline">receive</code>
expression executed by the process could fail to match messages already
present in the message queue.</p><p>On OTP 24 this could also cause the whole runtime system to crash.</p><p>Own Id: OTP-17651 Aux Id: GH-5235, PR-5244</p></li><li><p>Sending a <code class="inline">Port ! {PortOwner, close}</code> signal from a process other than the
port owner could erroneously trigger a <code class="inline">badsig</code> exit signal being sent to the
port owner process even though the correct <code class="inline">PortOwner</code> had been passed in the
signal.</p><p>Own Id: OTP-17665 Aux Id: PR-5248</p></li></ul><h2 id="erts-12-1" class="section-heading"><a href="#erts-12-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.1</span></h2><h3 id="fixed-bugs-and-malfunctions-93" class="section-heading"><a href="#fixed-bugs-and-malfunctions-93" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Atoms with Unicode code points greater than 255 (for example Greek or Cyrillic
characters) would not be displayed correctly by <code class="inline">crashdump_viewer</code>.</p><p>Own Id: OTP-17377</p></li><li><p>Fix rare minor memory leak related to jit code loading.</p><p>Own Id: OTP-17445 Aux Id: PR-4843</p></li><li><p>The extended error information has been corrected and improved for the
following BIFs: <a href="erlang.html#binary_to_existing_atom/2"><code class="inline">binary_to_existing_atom/2</code></a>,
<a href="erlang.html#list_to_existing_atom/1"><code class="inline">list_to_existing_atom/1</code></a>,
<code class="inline">erlang:send_after/{3,4}</code>, and <code class="inline">erlang:start_timer/{3,4}</code>.</p><p>Own Id: OTP-17449 Aux Id: GH-4900</p></li><li><p>Fix bug provoked when building with gcc 10 and link time optimization (-flto),
causing Erlang compiler to crash. Bug exists since OTP-24.0.</p><p>Own Id: OTP-17477 Aux Id: GH-4846, PR-4894</p></li><li><p>Corrected bugs where builds were not reducible even when the <code class="inline">deterministic</code>
option was given. In particular, modules with map literals with more than 32
elements could cause this problem.</p><p>As part of this fix, the <code class="inline">term_to_binary</code> BIF now accepts the option
<code class="inline">deterministic</code>.</p><p>Own Id: OTP-17495 Aux Id: PR-5153</p></li><li><p>After an exception has been caught in a process, the stack trace would be kept
in the process longer than necessary.</p><p>Own Id: OTP-17512</p></li><li><p>Fix rare race bug in memory management of distribution entries. Have been seen
to cause VM crash when massive number of repeated concurrent failing
connection attempts.</p><p>Own Id: OTP-17513 Aux Id: GH-4964, PR-5015</p></li><li><p>The configure test for <code class="inline">--disable-esock-socket-registry</code> has been corrected so
disabling now works.</p><p>Own Id: OTP-17539</p></li><li><p><code class="inline">init:stop()</code> no longer unloads loaded code before terminating the runtime
system. On systems with slow CPUs (such as Raspberry PI Zero), that can
significantly speed up termination of the runtime system.</p><p>Own Id: OTP-17542 Aux Id: GH-5031, PR-5032</p></li><li><p>Fixed match specifications that use maps in either the guard or the body to
work properly.</p><p>With this fix both keys and values in maps can be expressions.</p><p>Various other crashes and bugs when using maps in match specifications have
also been fixed.</p><p>Own Id: OTP-17567 Aux Id: PR-4915 PR-5115</p></li><li><p>Parsing of the result value in the native DNS resolver has been made more
defensive against incorrect results.</p><p>Own Id: OTP-17578 Aux Id: ERIERL-683</p></li><li><p>When <a href="erlang.html#binary_to_term/2"><code class="inline">binary_to_term/2</code></a> failed, the extended error
information would always blame the second argument even if the actual error
was in the first argument.</p><p>Own Id: OTP-17591 Aux Id: GH-5171</p></li><li><p>On 32-bit computers, <code class="inline">binary_to_term/1,2</code> is now more resilient against
corrupted binaries containing maps in the external format.</p><p>Own Id: OTP-17604</p></li><li><p>A call to <a href="erlang.html#process_info/2"><code class="inline">process_info(Pid, status)</code></a> could erroneously
report the status <code class="inline">running</code> when it should have reported <code class="inline">waiting</code>. This
occurred when the calling process was executing on a higher priority than the
process being inspected. This bug has been present since OTP 21.0 (erts
version 10.0).</p><p>Own Id: OTP-17628</p></li></ul><h3 id="improvements-and-new-features-21" class="section-heading"><a href="#improvements-and-new-features-21" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Optimize memory usage of erts internal processes used during code
loading/purging by hibernating them after a long time of inactivity.</p><p>Own Id: OTP-17426 Aux Id: PR-4785</p></li><li><p>Add the type <a href="erlang.html#t:stacktrace/0"><code class="inline">erlang:stacktrace/0</code></a>.</p><p>Own Id: OTP-17453 Aux Id: PR-4764</p></li><li><p>The arity argument of <a href="erlang.html#error/2"><code class="inline">error/2,3</code></a> can now be <code class="inline">none</code> to
indicate that the calling functions arity should be used.</p><p>Own Id: OTP-17456 Aux Id: PR-4764</p></li><li><p>Optimize match spec compiler for immediate (single word) constant terms.</p><p>Own Id: OTP-17469</p></li><li><p>Functions <code class="inline">erlang:set_cookie(Cookie)</code> and <code class="inline">erlang:get_cookie(Node)</code> have been
added for completeness and to facilitate configuring distributed nodes with
different cookies.</p><p>The documentation regarding distribution cookies has been improved to be less
vague.</p><p>Own Id: OTP-17538 Aux Id: GH-5063, PR-5111</p></li><li><p>A workaround has been implemented for Linux's quirky behaviour to not adjust
the source IP address when connecting a connected (reconnecing) UDP socket.</p><p>The workaround is to, on Linux, always dissolve any connection before
connecting an UDP socket.</p><p>Own Id: OTP-17559 Aux Id: GH-5092, PR-5120</p></li><li><p>The internal documentation for how to use Yielding C Fun (YCF) has been
updated to contain text about best practices for using YCF for ERTS.</p><p>Own Id: OTP-17596</p></li><li><p>Optimize garbage collection for processes with large number of binaries, funs
and/or external pids/ports/refs.</p><p>Own Id: OTP-17602 Aux Id: PR-5149</p></li></ul><h2 id="erts-12-0-4" class="section-heading"><a href="#erts-12-0-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.0.4</span></h2><h3 id="fixed-bugs-and-malfunctions-94" class="section-heading"><a href="#fixed-bugs-and-malfunctions-94" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A call to the <code class="inline">process_info()</code> BIF could end up hanging for ever due to a bug
introduced when the new selective receive optimization was introduced in OTP
24.0. Note that this bug only effects <code class="inline">process_info()</code>.</p><p>Own Id: OTP-17548 Aux Id: PR-5078, OTP-10391</p></li><li><p>Fix buffer overrun problem in the tty driver. The problem happens on some
platforms when using the CTRL+R functionality of newshell with very long
strings in the history.</p><p>Own Id: OTP-17560 Aux Id: GH-5116</p></li><li><p>Fix race-condition that could cause a crash when tracing scheduling or garbage
collections on a process that was running on a dirty scheduler.</p><p>Own Id: OTP-17568 Aux Id: PR-4940</p></li><li><p>Fix rare bug where re:run would crash/return invalid results when given a
subbinary as subject.</p><p>This bug has existed since Erlang/OTP 20.0.</p><p>Own Id: OTP-17585 Aux Id: GH-5150</p></li><li><p><code class="inline">binary_to_term/1,2</code> is now more resilient against corrupted binaries
containing maps in the external format.</p><p>Own Id: OTP-17594</p></li></ul><h2 id="erts-12-0-3" class="section-heading"><a href="#erts-12-0-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.0.3</span></h2><h3 id="fixed-bugs-and-malfunctions-95" class="section-heading"><a href="#fixed-bugs-and-malfunctions-95" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A call to <code class="inline">erlang:cancel_timer(_, [{info, false}])</code> could cause the calling
process to block forever in the call. Note that only the synchronous version
of the call (that is, the <code class="inline">async</code> option is <code class="inline">false</code>) in combination with the
<code class="inline">info</code> option set to <code class="inline">false</code> was effected by this bug.</p><p>Own Id: OTP-17472 Aux Id: PR-4932</p></li><li><p>Microstate accounting (msacc) and <code class="inline">os:perf_counter()</code> unintentionally used
system time instead of monotonic time for time measurements on a lot of
systems. These systems were all non x86/x86_64 systems or x86/x86_64 systems
without a reliable and constant rdtsc instruction.</p><p>The lock counting (lcnt) built runtime system also unintentionally used system
time instead of monotonic time for time measurements on all systems.</p><p>Own Id: OTP-17493</p></li><li><p>Simultaneous calls to <code class="inline">erlang:system_flag(schedulers_online, _)</code> could cause
callers to end up in a suspended state forever.</p><p>Own Id: OTP-17500 Aux Id: GH-4809</p></li></ul><h2 id="erts-12-0-2" class="section-heading"><a href="#erts-12-0-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.0.2</span></h2><h3 id="fixed-bugs-and-malfunctions-96" class="section-heading"><a href="#fixed-bugs-and-malfunctions-96" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Not yet handled alias-message signals in the signal queue at the time when a
garbage collection was performed could cause a memory corruption which in turn
could result in a crash of the runtime system. This bug was introduced in OTP
24.0.</p><p>Own Id: OTP-17431 Aux Id: GH-4858, PR-4870, OTP-16718</p></li><li><p>Fixed bug when using external pids/ports in keys of big maps (&gt; 32). Could
cause runtime crash. Bug exists since OTP 24.0.</p><p>Own Id: OTP-17436 Aux Id: PR-4875</p></li><li><p>After a node restart with <code class="inline">init:restart/0,1</code>, the module <code class="inline">socket</code> was not
usable because supporting tables had been cleared and not re-initialized. This
has now been fixed.</p><p>Handling of the &quot;.&quot; domain as a search domain was incorrect and caused a crash
in the DNS resolver <code class="inline">inet_res</code>, which has now been fixed.</p><p>Own Id: OTP-17439 Aux Id: GH-4827, PR-4888, GH-4838</p></li><li><p>A call to <code class="inline">port_command()</code> could cause a scheduler to end up in an eternal
loop if the port was busy and the calling process had incoming signals at the
time of the call. This bug was introduced in OTP 23.3.2 (ERTS version 11.2.1),
OTP 22.3.4.18 (ERTS version 10.7.2.10), and OTP 21.3.8.23 (ERTS version
10.3.5.18).</p><p>Own Id: OTP-17448 Aux Id: GH-4898, PR-4903, OTP-17291</p></li><li><p>Bug fixes and code cleanup for the new <code class="inline">socket</code> implementation, such as:</p><p>Assertions on the result of demonitoring has been added in the NIF code, where
appropriate.</p><p>Internal state handling for socket close in the NIF code has been reviewed.</p><p>Looping over <code class="inline">close()</code> for <code class="inline">EINTR</code> in the NIF code has been removed, since it
is strongly discouraged on Linux and Posix is not clear about if it is
allowed.</p><p>The <code class="inline">inet_backend</code> temporary socket option for legacy <code class="inline">gen_tcp</code> sockets has
been documented.</p><p>The return value from <a href="../../apps/kernel/net.html#getaddrinfo/2"><code class="inline">net:getaddrinfo/2</code></a> has been corrected: the <code class="inline">protocol</code>
field is now an <a href="erlang.html#t:atom/0"><code class="inline">atom/0</code></a>, instead of, incorrectly,
<a href="erlang.html#t:list/1"><code class="inline">list(atom())</code></a>. The documentation has also been corrected about
this return type.</p><p>Deferred close of a <code class="inline">socket:sendfile/*</code> file was broken and has been
corrected.</p><p>Some debug code, not enabled by default, in the socket NIF has been corrected
to not accidentally core dump for debug printouts of more or less innocent
events.</p><p>Own Id: OTP-17452</p></li><li><p>Dirty execution of a process in combination with an unlink signal from a port
to the process could cause the signal queue of the process to enter into an
inconsistent state. The result of the inconsistency typically caused a crash
of the runtime system. This bug was introduced in OTP 23.3 (ERTS version
11.2).</p><p>Own Id: OTP-17462 Aux Id: GH-4885, PR-4914, OTP-17127</p></li></ul><h2 id="erts-12-0-1" class="section-heading"><a href="#erts-12-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-97" class="section-heading"><a href="#fixed-bugs-and-malfunctions-97" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Commit of generated <code class="inline">configure</code> script.</p><p>Own Id: OTP-17420 Aux Id: OTP-17398, GH-4821</p></li></ul><h2 id="erts-12-0" class="section-heading"><a href="#erts-12-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 12.0</span></h2><h3 id="fixed-bugs-and-malfunctions-98" class="section-heading"><a href="#fixed-bugs-and-malfunctions-98" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><a href="../../apps/kernel/file.html#open/2"><code class="inline">file:open/2</code></a> now throws an badarg error when opened with both the <code class="inline">ram</code> and
<code class="inline">raw</code> options.</p><p>Own Id: OTP-16822 Aux Id: PR-2723</p></li><li><p>The estone benchmark has been updated to better reflect changes in the
compiler and run-time system.</p><p>Own Id: OTP-16879</p></li><li><p>Fix profile guided optimization of run-time system when using GCC 7 or later.</p><p>Own Id: OTP-16880</p></li><li><p>Fix double close of fd when creating crash dump.</p><p>Own Id: OTP-16884</p></li><li><p>Improve <code class="inline">erl</code> error message when unable to open included <code class="inline">args_file</code>.</p><p>Own Id: OTP-17014</p></li><li><p>Remove warning text about the <code class="inline">--</code> operation from documentation</p><p>The <code class="inline">--</code> operation was optimized in Erlang/OTP 22 so that its worst case
complexity is O(N<em>log(N)), where N is the total size of the input lists.
Therefore, the warning in the documentation saying that the time complexity is
proportional to length(A)</em>length(B) is incorrect and is no longer needed.
Notice that Erlang/OTP 21 will no longer be supported when Erlang/OTP 24 gets
released.</p><p>Own Id: OTP-17020</p></li><li><p>A floating point zero (0.0) can be both positive (+0.0) and negative (-0.0).
Multiple bugs in the compiler, runtime system, and STDLIB have been fixed to
ensure that the minus sign on 0.0 is not lost.</p><p>Own Id: OTP-17077 Aux Id: ERL-1431, PR-2903, PR-2905, PR-2906</p></li><li><p>Fix compiler warnings produced by the clang compiler.</p><p>Own Id: OTP-17105 Aux Id: PR-2872</p></li><li><p>Windows process <code class="inline">erl.exe</code> killed if its service process <code class="inline">erlsrv.exe</code>
terminates.</p><p>Own Id: OTP-17131 Aux Id: PR-3031, GH-4360</p></li><li><p>The <code class="inline">configure</code> scripts in <code class="inline">crypto</code> and <code class="inline">erts</code> now fail if a requested feature
cannot be enabled.</p><p>Large parts of the <code class="inline">configure</code> script of <code class="inline">crypto</code> have been rewritten with
various improvements and bug fixes. It is now better at finding usable OpenSSL
libraries, but will in the following cases fail to detect OpenSSL libraries
where it previously sometimes detected the libraries by chance:</p><ul><li>OpenSSL installations with <code class="inline">include</code> directory and <code class="inline">lib</code> directory parts
installed in different base directories. In order to detect such
installations after this change, the user must explicitly specify the
locations using the
<a href="../../system/install.html#advanced-configuration-and-build-of-erlang-otp_configuring"><code class="inline">--with-ssl=&lt;path&gt;</code></a>
and the
<a href="../../system/install.html#advanced-configuration-and-build-of-erlang-otp_configuring"><code class="inline">--with-ssl-incl=&lt;path&gt;</code></a>
<code class="inline">configure</code> command line arguments.</li><li>When building with old <code class="inline">gcc</code> compilers or other compilers on Debian
derivatives with multiarch directories under the <code class="inline">lib</code> directory. In order
to detect such installations after this change, the user must explicitly
specify the multiarch directory name using the
<a href="../../system/install.html#advanced-configuration-and-build-of-erlang-otp_configuring"><code class="inline">--with-ssl-lib-subdir=lib/&lt;multiarch-dir&gt;</code></a>
<code class="inline">configure</code> command line argument.</li></ul><p>Own Id: OTP-17254 Aux Id: ERIERL-618, GH-4230</p></li><li><p>The <code class="inline">erl</code> command line arguments <code class="inline">+Bi</code>, <code class="inline">+Bd</code>, and <code class="inline">+B</code> erroneously caused
reception of the <code class="inline">USR1</code> signal to terminate the runtime system without
creating a crash dump. Reception of the <code class="inline">USR1</code> signal now always cause
termination <em>with</em> creation of a crash dump, regardless of command line
arguments passed. This bug has existed at least since OTP R5B.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-17275 Aux Id: PR-4553</p></li><li><p>Add check to make sure that when passing an option to <code class="inline">erl</code> that requires an
argument, but none is given, we report an error. This fixes a bug introduced
in OTP-22.1 via OTP-15926.</p><p>Own Id: OTP-17314 Aux Id: OTP-15926, GH-4624, PR-</p></li><li><p>The &quot;Last calls&quot; section in crash dumps have been updated to print newlines
after each non-function <code class="inline">save_calls</code> state (send, receive, timeout).</p><p>Own Id: OTP-17329 Aux Id: PR-4730</p></li><li><p>Sockets created with socket:accept not counted (socket:info/0).</p><p>Own Id: OTP-17372</p></li></ul><h3 id="improvements-and-new-features-22" class="section-heading"><a href="#improvements-and-new-features-22" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The experimental <code class="inline">socket</code> module can now use any protocol (by name) the OS
supports. Suggested in PR-2641, implemented in PR-2670.</p><p>Own Id: OTP-14601 Aux Id: PR-2641, PR-2670, OTP-16749</p></li><li><p>New functions <code class="inline">enif_dynamic_resource_call</code> enables NIFs to call native code in
another NIF module. The call is done via a resource callback function
<code class="inline">dyncall</code> supplied by the user with the new <code class="inline">enif_init_resource_type</code>.</p><p>Own Id: OTP-14753</p></li><li><p>Runtime support for new improved selective receive optimization.</p><p>Own Id: OTP-16226 Aux Id: OTP-10391</p></li><li><p>The deprecated function <code class="inline">erlang:get_stacktrace/0</code> has been removed. Use the
new syntax in try/catch to retrieve the stack backtrace.</p><p>Own Id: OTP-16653</p></li><li><p>Support for handling abstract code created before OTP R15 has been dropped.</p><p>Own Id: OTP-16678 Aux Id: PR-2627</p></li><li><p>Extended error information for failing BIF calls as proposed in
<a href="https://github.com/erlang/eep/blob/master/eeps/eep-0054.md">EEP 54</a> has been
implemented.</p><p>When a BIF call from the Erlang shell fails, more information about which
argument or arguments that were in error will be printed. The same extended
error information will by <code class="inline">proc_lib</code>, <code class="inline">common_test</code>, and <code class="inline">qlc</code> when BIF calls
fail.</p><p>For applications that wish to provide the same extended error information,
there are new functions <a href="../../apps/stdlib/erl_error.html#format_exception/3"><code class="inline">erl_error:format_exception/3</code></a> and
<a href="../../apps/stdlib/erl_error.html#format_exception/4"><code class="inline">erl_error:format_exception/4</code></a>.</p><p>There is a new <a href="erlang.html#error/3"><code class="inline">error/3</code></a> BIF that allows applications or
libraries to provide extended error information in the same way for their own
exceptions.</p><p>Own Id: OTP-16686</p></li><li><p>The <a href="erlang.html"><code class="inline">erlang</code></a> module documentation has been updated to improve clarity and
description of edge cases.</p><p>Own Id: OTP-16687 Aux Id: PR-2996 PR-2762</p></li><li><p>An example implementation of Erlang distribution over UDS using distribution
processes has been introduced.</p><p>Thanks to JÃ©rÃ´me de Bretagne</p><p>Own Id: OTP-16703 Aux Id: PR-2620</p></li><li><p>Improve code generation when creating funs by adding a new beam instruction
make_fun3 that does not do GC and allows for better register allocation.</p><p>Own Id: OTP-16712</p></li><li><p>The <a href="../../system/ref_man_processes.html#process-aliases"><em>process alias</em></a> feature
as outlined by
<a href="https://github.com/erlang/eep/blob/master/eeps/eep-0053.md">EEP 53</a> has been
introduced. It is introduced in order to provide a lightweight mechanism that
can prevent late replies after timeout or connection loss. For more
information, see EEP 53 and the documentation of the new
<a href="erlang.html#alias/1"><code class="inline">alias/1</code></a> BIF and the new options to the
<a href="erlang.html#monitor/3"><code class="inline">monitor/3</code></a> BIF.</p><p>The <code class="inline">call</code> operation in the framework used by <code class="inline">gen_server</code>, <code class="inline">gen_statem</code>, and
<code class="inline">gen_event</code> has been updated to utilize alias in order to prevent late
responses. The <code class="inline">gen_statem</code> behavior still use a proxy process in the
distributed case, since it has always prevented late replies and aliases won't
work against pre OTP 24 nodes. The proxy process can be removed in OTP 26.</p><p>The alias feature also made it possible to introduce new functions similar to
the <a href="../../apps/kernel/erpc.html#receive_response/2"><code class="inline">erpc:receive_response()</code></a> function in the gen
behaviors, so the new functions
<a href="../../apps/stdlib/gen_server.html#receive_response/2"><code class="inline">gen_server:receive_response()</code></a>,
<a href="../../apps/stdlib/gen_statem.html#receive_response/2"><code class="inline">gen_statem:receive_response()</code></a>,
<a href="../../apps/stdlib/gen_event.html#receive_response/2"><code class="inline">gen_event:receive_response()</code></a> have also
been introduced.</p><p>Own Id: OTP-16718 Aux Id: PR-2735</p></li><li><p>Accept 64-bit process identifiers from external nodes. This is the first step
in an upgrade path toward using 64-bit pids in a future OTP release.</p><p>Own Id: OTP-16720 Aux Id: PR-2680</p></li><li><p>The experimental new socket API has been further developed. Some backwards
incompatible changes with respect to OTP 23 have been made.</p><p>The control message format has been changed so a decoded value is now in the
'value' field instead of in the 'data' field. The 'data' field now always
contains binary data.</p><p>Some type names have been changed regarding message headers and control
message headers.</p><p><a href="../../apps/kernel/socket.html#bind/2"><code class="inline">socket:bind/2</code></a> now returns plain <code class="inline">ok</code> instead of <code class="inline">{ok, Port}</code> which was only
relevant for the <code class="inline">inet</code> and <code class="inline">inet6</code> address families and often not
interesting. To find out which port was chosen use <a href="../../apps/kernel/socket.html#sockname/1"><code class="inline">socket:sockname/1</code></a>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-16749 Aux Id: OTP-14601</p></li><li><p>Remove old unused <code class="inline">+MYm</code> and <code class="inline">ERL_MALLOC_LIB</code> options.</p><p>Own Id: OTP-16788</p></li><li><p>Increase timer resolution on windows.</p><p>Own Id: OTP-16814 Aux Id: PR-2704</p></li><li><p>The code loader has been rewritten in order to be able to load JIT:ed code. As
a consequence of this, it is no longer possible to load HiPE code.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-16878</p></li><li><p>Add support in the Erlang/OTP build system to generate a compilation database
that can be used by third-party tools (such as irony in Emacs) to compile the
erts C and C++ source code. Create the database using <code class="inline">make compdb</code>.</p><p>Own Id: OTP-16881</p></li><li><p>The BeamAsm JIT-compiler has been added to Erlang/OTP. The JIT-compiler is
enabled by default on most x86 64-bit platforms that have a C++ compiler that
can compile C++17. To verify that a JIT enabled emulator is running you can
use <a href="erlang.html#system_info_emu_flavor"><code class="inline">erlang:system_info(emu_flavor)</code></a>.</p><p>For more information see the
<a href="beamasm.html">internal documentation of BeamAsm in erts</a>.</p><p>Own Id: OTP-16885 Aux Id: PR-2745</p></li><li><p>By default all ERTS internal memory allocators based on <code class="inline">alloc_util</code> will now
use their own separate carrier pool for migration of carriers instead of using
a node global carrier pool. This was the default behavior between OTP 17 and
OTP 21, but changed to use a node global carrier pool as of OTP 22.0. Usage of
the node global carrier pool proved troublesome since it had a tendency to
spread long lived blocks into allocators with normally short lived blocks
causing increased memory fragmentation. The node global carrier pool behavior
as well as other behaviors can be configured using the
<a href="erts_alloc.html#M_cp"><code class="inline">+M&lt;S&gt;cp</code></a> command line argument.</p><p>Own Id: OTP-16898 Aux Id: OTP-16856</p></li><li><p>New functions have been added to the <code class="inline">maps</code> module: <code class="inline">merge_with/3</code>,
<code class="inline">intersect/2</code>, <code class="inline">intersect_with/3</code>, <code class="inline">filtermap/2</code>, <code class="inline">from_keys/2</code>, and
<a href="../../apps/stdlib/maps.html#foreach/2"><code class="inline">maps:foreach/2</code></a>.</p><p><a href="../../apps/stdlib/maps.html#merge_with/3"><code class="inline">maps:merge_with/3</code></a> is the same as <code class="inline">merge/2</code> but takes an extra fun that is
used to combine items with the same key.</p><p><a href="../../apps/stdlib/maps.html#intersect/2"><code class="inline">maps:intersect/2</code></a> computes the intersection of two maps.</p><p><a href="../../apps/stdlib/maps.html#intersect_with/3"><code class="inline">maps:intersect_with/3</code></a> is the same as <code class="inline">intersect/2</code> but takes an extra fun
that is used to combine intersecting items.</p><p><a href="../../apps/stdlib/maps.html#filtermap/2"><code class="inline">maps:filtermap/2</code></a> allows filtering and mapping of a map in a single pass.</p><p><a href="../../apps/stdlib/maps.html#from_keys/2"><code class="inline">maps:from_keys/2</code></a> constructs a map from a list of keys and a single value and
can be used to optimize sets operations such as from_list/1, filter/2,
intersection/2, and subtract/2.</p><p><a href="../../apps/stdlib/maps.html#foreach/2"><code class="inline">maps:foreach/2</code></a> allows iteration over a map without returning any value.</p><p>Own Id: OTP-16936 Aux Id: ERL-1367</p></li><li><p>Change <code class="inline">escript</code>s to output any errors or warnings to standard error instead
of standard out.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-16945</p></li><li><p>A new erl parameter for specifying a file descriptor with configuration data
has been added. This makes it possible to pass the parameter &quot;-configfd FD&quot;
when executing the erl command. When this option is given, the system will try
to read and parse configuration parameters from the file descriptor.</p><p>Own Id: OTP-16952</p></li><li><p>The experimental HiPE application has been removed, together with all related
functionality in other applications.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-16963</p></li><li><p>The pretty printer for floating point number have been changed to make it
easier to see if the integer part of the number has been rounded. After the
change the digit that may have been rounded always appears last or just before
the exponent character (e or E). This is accomplished by always printing the
number using scientific notation if it is so large that the integer part could
be rounded.</p><p>Own Id: OTP-16980 Aux Id: ERL-1308</p></li><li><p>The <a href="erlang.html#monitor_node/2"><code class="inline">erlang:monitor_node/2</code></a> BIF will now fail with a <code class="inline">notalive</code> exception if
distribution has not been started on the current node; it used to fail with a
<code class="inline">badarg</code> exception.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-16987</p></li><li><p>Accept references up to a size of 160-bits from remote nodes. This is the
first step in an upgrade path toward using references up to 160-bits in a
future OTP release.</p><p>Own Id: OTP-17005 Aux Id: OTP-16718</p></li><li><p>Accept 64-bit port identifiers from external nodes. This is the first step in
an upgrade path toward using 64-bit port identifiers in a future OTP release.</p><p>Own Id: OTP-17007</p></li><li><p>One can now pass the ERL_ROOTDIR environment variable to the erl and start
scrips. This makes it easier to use Erlang for Android apps. On Android, apps
don't control where they will be installed.</p><p>Own Id: OTP-17028</p></li><li><p>All long running functions in the maps API are now yielding. In previous
releases the functions <a href="../../apps/stdlib/maps.html#from_list/1"><code class="inline">maps:from_list/1</code></a>, <a href="../../apps/stdlib/maps.html#keys/1"><code class="inline">maps:keys/1</code></a> and <a href="../../apps/stdlib/maps.html#values/1"><code class="inline">maps:values/1</code></a>
did not yield. This could cause unfair scheduling of processes.</p><p>Own Id: OTP-17057</p></li><li><p><code class="inline">socket:sendfile/2,3,4,5</code> has been implemented, for platforms that support the
underlying socket library call.</p><p>Own Id: OTP-17154 Aux Id: OTP-16749</p></li><li><p>The bit matching and construction syntax now supports 16-bit floats (IEEE
754-2008).</p><p>Own Id: OTP-17207</p></li><li><p>Add <a href="erlang.html#process_flag/2"><code class="inline">process_flag(fullsweep_after, N)</code></a> to change
<code class="inline">fullsweep_after</code> value in an already spawned process.</p><p>Own Id: OTP-17285 Aux Id: PR-4651</p></li><li><p>The <code class="inline">max_heap_size</code> error report has been updated to include the message queue
size.</p><p>Own Id: OTP-17293 Aux Id: PR-4672</p></li><li><p>Introduce new types <a href="erlang.html#t:nonempty_binary/0"><code class="inline">nonempty_binary/0</code></a> and <a href="erlang.html#t:nonempty_bitstring/0"><code class="inline">nonempty_bitstring/0</code></a>.</p><p>Own Id: OTP-17301 Aux Id: GH-4636</p></li><li><p>Optimize updates of large maps with identical keys and values. E.g. in the
example below the original <code class="inline">Map</code> will be reused as the return of the second
update.</p><p><code class="inline">1&gt; Map = LargeMap#{ a =&gt; b }.</code></p><p><code class="inline">2&gt; Map#{ a := b }.</code></p><p>The same optimization was done for small maps (&lt; 33 keys) in erts-10.4 (OTP
22.0).</p><p>Own Id: OTP-17310 Aux Id: PR-4656</p></li><li><p>The previously undocumented internal <code class="inline">-no_epmd</code> option has been made
documented and public.</p><p>Own Id: OTP-17341 Aux Id: PR-2945</p></li><li><p>Reduce memory carrier super alignment on 64-bit architectures. In practice
allows more fine grained control over configuration of memory carrier sizes,
from increments of 256kb to 16kb.</p><p>Own Id: OTP-17368</p></li></ul><h2 id="erts-11-2-2-18" class="section-heading"><a href="#erts-11-2-2-18" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.18</span></h2><h3 id="fixed-bugs-and-malfunctions-99" class="section-heading"><a href="#fixed-bugs-and-malfunctions-99" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix <a href="erlang.html#list_to_atom/1"><code class="inline">list_to_atom/1</code></a> for negative code points. Could
either return with a positive code point or fail with an incorrect exception.</p><p>Own Id: OTP-18321</p></li><li><p>A race condition which was very rarely triggered could cause the signal queue
of a process to become inconsistent causing the runtime system to crash.</p><p>Own Id: OTP-18388 Aux Id: OTP-17462, PR-6662</p></li><li><p><a href="erlang.html#process_info/2"><code class="inline">process_info(Pid, status)</code></a> when <code class="inline">Pid /= self()</code> could
return an erroneous result.</p><p>Own Id: OTP-18421 Aux Id: PR-6806</p></li><li><p>In rare circumstances, when a process exceeded its allowed heap size set by
option <code class="inline">max_heap_size</code>, it would not be killed as it should be, but instead
enter a kind of zombie state it would never get out of.</p><p>Own Id: OTP-18463 Aux Id: PR-6858</p></li><li><p>Implementations of the <a href="driver_entry.html#call"><code class="inline">call()</code></a> driver callback that
returned a faulty encoded result could cause a memory leak and could cause
invalid data on the heap of the processes calling <a href="erlang.html#port_call/3"><code class="inline">erlang:port_call/3</code></a>.</p><p>Own Id: OTP-18525 Aux Id: PR-7049</p></li><li><p>If a runtime system which was starting the distribution already had existing
pids, ports, or references referring to a node with the same nodename/creation
pair that the runtime system was about to use, these already existing pids,
ports, or references would not work as expected in various situations after
the node had gone alive. This could only occur if the runtime system was
communicated such pids, ports, or references prior to the distribution was
started. That is, it was extremely unlikely to happen unless the distribution
was started dynamically and was even then very unlikely to happen. The runtime
system now checks for already existing pids, ports, and references with the
same nodename/creation pair that it is about to use. If such are found another
creation will be chosen in order to avoid these issues.</p><p>Own Id: OTP-18570 Aux Id: PR-7190</p></li></ul><h2 id="erts-11-2-2-17" class="section-heading"><a href="#erts-11-2-2-17" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.17</span></h2><h3 id="fixed-bugs-and-malfunctions-100" class="section-heading"><a href="#fixed-bugs-and-malfunctions-100" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><a href="erlang.html#dist_ctrl_get_data_notification/1">Notifications about available distribution data</a>
sent to distribution controller processes could be lost. Distribution
controller processes can be used when implementing an alternative distribution
carrier. The default distribution over tcp was not effected and the bug was
also not present on x86/x86_64 platforms.</p><p>Own Id: OTP-18258 Aux Id: GH-6309, PR-6324</p></li></ul><h2 id="erts-11-2-2-16" class="section-heading"><a href="#erts-11-2-2-16" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.16</span></h2><h3 id="fixed-bugs-and-malfunctions-101" class="section-heading"><a href="#fixed-bugs-and-malfunctions-101" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Distributed exit signals could be lost under the following conditions:</p><ul><li><p>An exit signal from a parent process to a child process was lost if:</p><ul><li>the parent process terminated before the spawn request that created the
child had completed,</li><li>the spawn request set up a link between parent and child</li><li>the spawn request was distributed, and</li><li>the exit reason was larger than one machine word.</li></ul></li><li><p>Loss of a connection over which a not yet completed spawn request was
ongoing could cause loss of exit signals. Such loss of exit signals was very
rare. Besides the above described connection loss also the following
conditions had to be satisfied:</p><ul><li>The spawn request that was interrupted by the connection loss also had to
set up a link between the parent process and the child process.</li><li>The parent process that issued the spawn request also had to be
terminating while the spawn request was interrupted by the connection
loss.</li><li>The same parent process also had to have made other spawn requests to
other nodes than to the node to which the connection was lost.</li><li>These spawn requests to the other nodes also had to set up links.</li><li>These spawn requests to the other nodes also had to be not yet completed
at the time of the connection loss. That is, the spawn reply from the
child process had not yet reached the parent process.</li></ul><p>If all the conditions above were met, exit signals to the children spawned
due to the above described spawn requests to other nodes <em>could</em> be lost.</p><p>The above bug also caused a significant memory leak when it was triggered
since the destruction of the parent process never completed.</p></li></ul><p>Own Id: OTP-18164 Aux Id: PR-6114</p></li><li><p>A race could cause <a href="erlang.html#process_info/2"><code class="inline">process_info(Pid, message_queue_len)</code></a>
on other processes to return invalid results.</p><p>Own Id: OTP-18169 Aux Id: PR-6134</p></li><li><p>Fixed reduction counting for handling process system tasks.</p><p>Own Id: OTP-18170 Aux Id: PR-6135</p></li><li><p>Priority elevation of terminating processes did not work which could cause
execution of such processes to be delayed.</p><p>Own Id: OTP-18175 Aux Id: PR-6142</p></li><li><p>An unlink operation made by a process that terminated before the unlink
operation completed, i.e., before it had received an unlink-ack signal from
the linked process, caused an exit signal to erroneously be sent from the
terminating process to the process being unlinked. This exit signal would most
often be ignored by the receiver, but if the receiver of the exit signal
concurrently set up a new link, it could receive the exit signal with the
actual exit reason of the terminating process instead of a <code class="inline">noproc</code> exit
reason. It is however very hard to detect that this has happened and has no
obvious negative consequences, so it should be considered harmless.</p><p>A distributed unlink-ack signal received by a terminating process was also not
properly removed which could cause a minor memory leak.</p><p>Own Id: OTP-18177 Aux Id: PR-6150</p></li><li><p>The <a href="erlang.html#monotonic_time/1"><code class="inline">erlang:monotonic_time/1</code></a>, <a href="erlang.html#system_time/1"><code class="inline">erlang:system_time/1</code></a>, <a href="erlang.html#time_offset/1"><code class="inline">erlang:time_offset/1</code></a>,
and <a href="../../apps/kernel/os.html#system_time/1"><code class="inline">os:system_time/1</code></a> BIFs erroneously failed when passed the argument
<code class="inline">native</code>.</p><p>Own Id: OTP-18197 Aux Id: GH-6165, PR-6213</p></li><li><p>Fix writing and reading of more than 2 GB in a single read/write operation on
macOS. Before this fix attempting to read/write more than 2GB would result in
<code class="inline">{error,einval}</code>.</p><p>Own Id: OTP-18222 Aux Id: PR-6248 GH-6242</p></li></ul><h2 id="erts-11-2-2-15" class="section-heading"><a href="#erts-11-2-2-15" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.15</span></h2><h3 id="fixed-bugs-and-malfunctions-102" class="section-heading"><a href="#fixed-bugs-and-malfunctions-102" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix faulty distribution encoding of terms with either</p><ul><li>a fun with bit-string or export-fun in its environment when encoded toward a
not yet established (pending) connection</li><li>or a fun with a binary/bitstring, in its environment, referring to an
off-heap binary (larger than 64 bytes).</li></ul><p>The symptom could be failed decoding on the receiving side leading to aborted
connection. Fix OTP-18093 is a workaround for theses bugs that makes the VM
accepts such faulty encoded funs.</p><p>The first encoding bug toward pending connection exists only in OTP 23 and 24,
but the second one exists also on OTP 25.</p><p>Own Id: OTP-18104 Aux Id: OTP-18093</p></li></ul><h2 id="erts-11-2-2-14" class="section-heading"><a href="#erts-11-2-2-14" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.14</span></h2><h3 id="fixed-bugs-and-malfunctions-103" class="section-heading"><a href="#fixed-bugs-and-malfunctions-103" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Accept funs (NEW_FUN_EXT) with incorrectly encoded size field. This is a
workaround for a bug (OTP-18104) existing in OTP 23 and 24 that could cause
incorrect size fields in certain cases. The emulator does not use the decoded
size field, but <code class="inline">erl_interface</code> still does and is not helped by this
workaround.</p><p>Own Id: OTP-18093 Aux Id: OTP-18104, PR-5987</p></li><li><p>The zlib built in to the runtime system has been updated to version 1.2.12.
(Note that on most platforms, the platform's own zlib is used.)</p><p>Own Id: OTP-18123 Aux Id: GH-5994</p></li><li><p>Fixed emulator crash that could happen during crashdump generation of ETS
tables with options <code class="inline">ordered_set</code> and <code class="inline">{write_concurrency,true}</code>.</p><p>Own Id: OTP-18144 Aux Id: GH-5981</p></li></ul><h2 id="erts-11-2-2-13" class="section-heading"><a href="#erts-11-2-2-13" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.13</span></h2><h3 id="fixed-bugs-and-malfunctions-104" class="section-heading"><a href="#fixed-bugs-and-malfunctions-104" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Let EPMD tolerate failure when binding to IPv4/IPv6 loopback intefaces in
addition to user-supplied addresses via <code class="inline">ERL_EPMD_ADDRESS</code> or the <code class="inline">-address</code>
option. This can happen, for example, if the host system has ipv6 disabled via
the disable_ipv6 sysctl.</p><p>Own Id: OTP-17970 Aux Id: PR-5762</p></li><li><p>Fixed a rare bug in <a href="erlang.html#binary_to_term/1"><code class="inline">binary_to_term/1</code></a>,
<code class="inline">enif_make_map_from_arrays</code>, <code class="inline">erl_drv_send_term</code>, and Erlang distribution that
could crash the emulator.</p><p>Own Id: OTP-18027</p></li><li><p>Fixed a rare race in <code class="inline">persistent_term:get/1,2</code> that could cause it to return
the value of another key.</p><p>Own Id: OTP-18065 Aux Id: GH-5908</p></li><li><p>Fix bug where the process message queue was left in an inconsistent state when
changing from on_heap to off_heap message queue data causing the GC to
segfault.</p><p>Own Id: OTP-18075 Aux Id: PR-5927</p></li><li><p>Fix functions that convert universal to localtime (such as erlang:localtime/0
and erlang:universaltime_to_localtime/1) to fetch the correct localtime if it
is changed after the start of the VM.</p><p>Own Id: OTP-18076 Aux Id: ERIERL-802 PR-5905</p></li><li><p>Fix memory leak when a process doing a distributed fragmented send is sent an
exit signal. Before this fix the receiving node would be left with an
incomplete message that would remain until the nodes were disconnected. The
bug has existed since Erlang/OTP 21.</p><p>Own Id: OTP-18077 Aux Id: GH-5876 PR-5892</p></li></ul><h2 id="erts-11-2-2-12" class="section-heading"><a href="#erts-11-2-2-12" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.12</span></h2><h3 id="fixed-bugs-and-malfunctions-105" class="section-heading"><a href="#fixed-bugs-and-malfunctions-105" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix Erlang monotonic time on MacOS. Previously used OS monotonic time
primitive on MacOS is buggy and will not be used anymore. It has been replaced
with usage of another OS monotonic time primitive that does not appear to be
buggy.</p><p>Own Id: OTP-17998 Aux Id: PR-5825, GH-5554</p></li></ul><h2 id="erts-11-2-2-11" class="section-heading"><a href="#erts-11-2-2-11" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.11</span></h2><h3 id="fixed-bugs-and-malfunctions-106" class="section-heading"><a href="#fixed-bugs-and-malfunctions-106" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>By default <code class="inline">global</code> does <em>not</em> take any actions to restore a fully connected
network when connections are lost due to network issues. This is problematic
for all applications expecting a fully connected network to be provided, such
as for example <code class="inline">mnesia</code>, but also for <code class="inline">global</code> itself. A network of
overlapping partitions might cause the internal state of <code class="inline">global</code> to become
inconsistent. Such an inconsistency can remain even after such partitions have
been brought together to form a fully connected network again. The effect on
other applications that expects that a fully connected network is maintained
may vary, but they might misbehave in very subtle hard to detect ways during
such a partitioning.</p><p>In order to prevent such issues, we have introduced a <em>prevent overlapping
partitions</em> fix which can be enabled using the
<a href="../../apps/kernel/kernel_app.html#prevent_overlapping_partitions"><code class="inline">prevent_overlapping_partitions</code></a>
<code class="inline">kernel(6)</code> parameter. When this fix has been enabled, <code class="inline">global</code> will actively
disconnect from nodes that reports that they have lost connections to other
nodes. This will cause fully connected partitions to form instead of leaving
the network in a state with overlapping partitions. Note that this fix <em>has</em>
to be enabled on <em>all</em> nodes in the network in order to work properly. Since
this quite substantially changes the behavior, this fix is currently disabled
by default. Since you might get hard to detect issues without this fix you
are, however, <em>strongly</em> advised to enable this fix in order to avoid issues
such as the ones described above. As of OTP 25 this fix will become enabled by
default.</p><p>Own Id: OTP-17843 Aux Id: ERIERL-732, PR-5611</p></li><li><p>Fix memory leak when tracing on running on a process that only handle system
tasks or non-message signals (for example process_info requests).</p><p>Own Id: OTP-17904 Aux Id: ERIERL-757</p></li></ul><h2 id="erts-11-2-2-10" class="section-heading"><a href="#erts-11-2-2-10" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.10</span></h2><h3 id="fixed-bugs-and-malfunctions-107" class="section-heading"><a href="#fixed-bugs-and-malfunctions-107" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix GC emulator crash when <code class="inline">spawn_request</code> was used when message tracing was
enabled.</p><p>Own Id: OTP-17871 Aux Id: PR-5612</p></li></ul><h2 id="erts-11-2-2-9" class="section-heading"><a href="#erts-11-2-2-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.9</span></h2><h3 id="fixed-bugs-and-malfunctions-108" class="section-heading"><a href="#fixed-bugs-and-malfunctions-108" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a memory leak in <a href="../../apps/kernel/file.html#read_file_info/2"><code class="inline">file:read_file_info/2</code></a> and <a href="../../apps/kernel/file.html#read_file/1"><code class="inline">file:read_file/1</code></a> on
Windows.</p><p>Own Id: OTP-17827 Aux Id: GH-5527</p></li></ul><h3 id="improvements-and-new-features-23" class="section-heading"><a href="#improvements-and-new-features-23" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Responsiveness of processes executing on <code class="inline">normal</code> or <code class="inline">low</code> priority could
suffer due to code purging or literal area removal on systems with a huge
amount of processes. This since during these operations all processes on the
system were scheduled for execution at once.</p><p>This problem has been fixed by introducing a limit on outstanding purge and
copy literal requests in the system. By default this limit is set to twice the
amount of schedulers on the system. This will ensure that schedulers will have
enough work scheduled to perform these operations as quickly as possible at
the same time as other work will be interleaved to a much higher degree.
Performance of these operations will however be somewhat degraded due to the
overhead of enforcing this limit compared to when using a very large limit.</p><p>This limit can be set by passing the <code class="inline">+zosrl</code> command line argument to <code class="inline">erl</code>,
or by calling
<code class="inline">erlang:system_flag(outstanding_system_requests_limit, NewLimit)</code>.</p><p>Own Id: OTP-17796 Aux Id: ERIERL-729, PR-5473</p></li></ul><h2 id="erts-11-2-2-8" class="section-heading"><a href="#erts-11-2-2-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.8</span></h2><h3 id="fixed-bugs-and-malfunctions-109" class="section-heading"><a href="#fixed-bugs-and-malfunctions-109" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The runtime system could call <code class="inline">select()</code> with a too large timeout value when
executing on MacOS. This could in turn cause the runtime system to crash.</p><p>Own Id: OTP-17735 Aux Id: GH-5339</p></li><li><p>Certain distributed signals that for various reasons must to be forced into
the distribution buffer even when it is full would instead be lost if the
distribution buffer was full when sent. The effected signals:</p><ul><li><code class="inline">EXIT</code> signals with exit reasons of one word size.</li><li><code class="inline">DOWN</code> signals with exit reasons of one word size.</li><li><code class="inline">demonitor</code> signals from a terminating process.</li><li><code class="inline">unlink_ack</code> signals on OTP 23 and 24.</li><li><code class="inline">spawn_reply</code> signals on OTP 23 and 24.</li></ul><p>Own Id: OTP-17737 Aux Id: GH-5346, GH-4989</p></li></ul><h2 id="erts-11-2-2-7" class="section-heading"><a href="#erts-11-2-2-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.7</span></h2><h3 id="fixed-bugs-and-malfunctions-110" class="section-heading"><a href="#fixed-bugs-and-malfunctions-110" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A call to <a href="erlang.html#process_info/2"><code class="inline">process_info(Pid, status)</code></a> could erroneously
report the status <code class="inline">running</code> when it should have reported <code class="inline">waiting</code>. This
occurred when the calling process was executing on a higher priority than the
process being inspected. This bug has been present since OTP 21.0 (erts
version 10.0).</p><p>Own Id: OTP-17628</p></li><li><p>A race between an exiting port and handling of simultaneously received signals
to that port could cause a runtime system crash. The effected signals are
<code class="inline">link</code>, <code class="inline">monitor</code> and <code class="inline">demonitor</code>. On OTP 22 a similar race could also cause a
memory leak when receiving an <code class="inline">unlink</code> signal.</p><p>Own Id: OTP-17642 Aux Id: PR-5248</p></li><li><p>The message queue of a process entered an inconsistent state after a <code class="inline">receive</code>
expression with an invalid timeout value was executed. If the exception raised
due to the invalid timeout value was caught, the following <code class="inline">receive</code>
expression executed by the process could fail to match messages already
present in the message queue.</p><p>On OTP 24 this could also cause the whole runtime system to crash.</p><p>Own Id: OTP-17651 Aux Id: GH-5235, PR-5244</p></li><li><p>Sending a <code class="inline">Port ! {PortOwner, close}</code> signal from a process other than the
port owner could erroneously trigger a <code class="inline">badsig</code> exit signal being sent to the
port owner process even though the correct <code class="inline">PortOwner</code> had been passed in the
signal.</p><p>Own Id: OTP-17665 Aux Id: PR-5248</p></li><li><p>This fixes a bug in <code class="inline">erts_factory_undo</code> that caused the heap to not be reset
correctly. The <code class="inline">erts_factory_undo</code> function is, for example, called when a
<a href="erlang.html#binary_to_term/1"><code class="inline">binary_to_term/1</code></a> call fails to reset the heap to its
state before the <a href="erlang.html#binary_to_term/1"><code class="inline">binary_to_term/1</code></a> call. This can cause
the heap to contain invalid terms which potentially can cause issues (e.g.,
crashes) when the whole heap is scanned.</p><p>Own Id: OTP-17677</p></li><li><p>Fix bug in <code class="inline">persistent_term</code> when a key-value pair contains a magic reference
that is referred more than once. Magic references are NIF resources or
returned from BIFs like <code class="inline">ets:new</code>, <code class="inline">atomics:new</code>. The bug could cause the
memory of the referred resource to be prematurely deallocated.</p><p>The bug also apply to magic references in message passing on a runtime built
with configure option <code class="inline">--enable-sharing-preserving</code>.</p><p>Bug exist for 64-bit since OTP-24.0 and for 32-bit since OTP-20.0.</p><p>Own Id: OTP-17700 Aux Id: GH-5271, PR-5273</p></li></ul><h3 id="improvements-and-new-features-24" class="section-heading"><a href="#improvements-and-new-features-24" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The python scripts that existed in
erts/lib_src/yielding_c_fun/lib/tiny_regex_c/scripts had a license that was
incompatible with Erlang/OTP's license. This ticket removes these scripts that
were not used by us.</p><p>Own Id: OTP-17658</p></li></ul><h2 id="erts-11-2-2-6" class="section-heading"><a href="#erts-11-2-2-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.6</span></h2><h3 id="fixed-bugs-and-malfunctions-111" class="section-heading"><a href="#fixed-bugs-and-malfunctions-111" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Parsing of the result value in the native DNS resolver has been made more
defensive against incorrect results.</p><p>Own Id: OTP-17578 Aux Id: ERIERL-683</p></li><li><p>On 32-bit computers, <code class="inline">binary_to_term/1,2</code> is now more resilient against
corrupted binaries containing maps in the external format.</p><p>Own Id: OTP-17604</p></li></ul><h2 id="erts-11-2-2-5" class="section-heading"><a href="#erts-11-2-2-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.5</span></h2><h3 id="fixed-bugs-and-malfunctions-112" class="section-heading"><a href="#fixed-bugs-and-malfunctions-112" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix buffer overrun problem in the tty driver. The problem happens on some
platforms when using the CTRL+R functionality of newshell with very long
strings in the history.</p><p>Own Id: OTP-17560 Aux Id: GH-5116</p></li><li><p>Fix race-condition that could cause a crash when tracing scheduling or garbage
collections on a process that was running on a dirty scheduler.</p><p>Own Id: OTP-17568 Aux Id: PR-4940</p></li><li><p>Fix rare bug where re:run would crash/return invalid results when given a
subbinary as subject.</p><p>This bug has existed since Erlang/OTP 20.0.</p><p>Own Id: OTP-17585 Aux Id: GH-5150</p></li><li><p><code class="inline">binary_to_term/1,2</code> is now more resilient against corrupted binaries
containing maps in the external format.</p><p>Own Id: OTP-17594</p></li></ul><h2 id="erts-11-2-2-4" class="section-heading"><a href="#erts-11-2-2-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.4</span></h2><h3 id="fixed-bugs-and-malfunctions-113" class="section-heading"><a href="#fixed-bugs-and-malfunctions-113" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Microstate accounting (msacc) and <code class="inline">os:perf_counter()</code> unintentionally used
system time instead of monotonic time for time measurements on a lot of
systems. These systems were all non x86/x86_64 systems or x86/x86_64 systems
without a reliable and constant rdtsc instruction.</p><p>The lock counting (lcnt) built runtime system also unintentionally used system
time instead of monotonic time for time measurements on all systems.</p><p>Own Id: OTP-17493</p></li><li><p>Simultaneous calls to <code class="inline">erlang:system_flag(schedulers_online, _)</code> could cause
callers to end up in a suspended state forever.</p><p>Own Id: OTP-17500 Aux Id: GH-4809</p></li><li><p>Fix rare race bug in memory management of distribution entries. Have been seen
to cause VM crash when massive number of repeated concurrent failing
connection attempts.</p><p>Own Id: OTP-17513 Aux Id: GH-4964, PR-5015</p></li></ul><h2 id="erts-11-2-2-3" class="section-heading"><a href="#erts-11-2-2-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.3</span></h2><h3 id="fixed-bugs-and-malfunctions-114" class="section-heading"><a href="#fixed-bugs-and-malfunctions-114" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A call to <code class="inline">erlang:cancel_timer(_, [{info, false}])</code> could cause the calling
process to block forever in the call. Note that only the synchronous version
of the call (that is, the <code class="inline">async</code> option is <code class="inline">false</code>) in combination with the
<code class="inline">info</code> option set to <code class="inline">false</code> was effected by this bug.</p><p>Own Id: OTP-17472 Aux Id: PR-4932</p></li></ul><h2 id="erts-11-2-2-2" class="section-heading"><a href="#erts-11-2-2-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.2</span></h2><h3 id="fixed-bugs-and-malfunctions-115" class="section-heading"><a href="#fixed-bugs-and-malfunctions-115" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A call to <code class="inline">port_command()</code> could cause a scheduler to end up in an eternal
loop if the port was busy and the calling process had incoming signals at the
time of the call. This bug was introduced in OTP 23.3.2 (ERTS version 11.2.1),
OTP 22.3.4.18 (ERTS version 10.7.2.10), and OTP 21.3.8.23 (ERTS version
10.3.5.18).</p><p>Own Id: OTP-17448 Aux Id: GH-4898, PR-4903, OTP-17291</p></li><li><p>Dirty execution of a process in combination with an unlink signal from a port
to the process could cause the signal queue of the process to enter into an
inconsistent state. The result of the inconsistency typically caused a crash
of the runtime system. This bug was introduced in OTP 23.3 (ERTS version
11.2).</p><p>Own Id: OTP-17462 Aux Id: GH-4885, PR-4914, OTP-17127</p></li></ul><h2 id="erts-11-2-2-1" class="section-heading"><a href="#erts-11-2-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-116" class="section-heading"><a href="#fixed-bugs-and-malfunctions-116" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Commit of generated <code class="inline">configure</code> script.</p><p>Own Id: OTP-17420 Aux Id: OTP-17398, GH-4821</p></li></ul><h2 id="erts-11-2-2" class="section-heading"><a href="#erts-11-2-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.2</span></h2><h3 id="fixed-bugs-and-malfunctions-117" class="section-heading"><a href="#fixed-bugs-and-malfunctions-117" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix bug in match spec compilator seen to cause a stack overflow crash on debug
VM for certain match specs. Could potentially cause problems for standard VM,
but has not been verified. Match specs are used by <code class="inline">ets:match/select</code>
functions and <code class="inline">erlang:trace_pattern</code>.</p><p>Own Id: OTP-17379 Aux Id: PR-4804</p></li></ul><h2 id="erts-11-2-1" class="section-heading"><a href="#erts-11-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-118" class="section-heading"><a href="#fixed-bugs-and-malfunctions-118" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The following signals could pass before other signals from the same sender to
the same receiver. That is, these signals could arrive too early.</p><ul><li><code class="inline">garbage-collect</code> request. Sent from one process to another using one of the
<a href="erlang.html#garbage_collect/0"><code class="inline">garbage_collect/0</code></a> BIFs.</li><li><code class="inline">check-process-code</code> request. Sent from one process to another using one of
the <code class="inline">check_process_code()</code> BIFs.</li><li><code class="inline">is-process-alive</code> reply. Sent as a response to a process calling the
<code class="inline">is_process_alive()</code> BIF.</li><li><code class="inline">process-info</code> reply. Sent as a response to a process calling one of the
<code class="inline">process_info()</code> BIFs.</li><li><code class="inline">port-command</code> reply. Sent as a response to a process calling one of the
<code class="inline">port_command()</code> BIFs.</li><li><code class="inline">port-connect</code> reply. Sent as a response to a process calling the
<code class="inline">port_connect()</code> BIF.</li><li><code class="inline">port-close</code> reply. Sent as a response to a process calling the
<code class="inline">port_close()</code> BIF.</li><li><code class="inline">port-control</code> reply. Sent as a response to a process calling the
<code class="inline">port_control()</code> BIF.</li><li><code class="inline">port-call</code> reply. Sent as a response to a process calling the <code class="inline">port_call()</code>
BIF.</li><li><code class="inline">port-info</code> reply. Sent as a response to a process calling one of the
<code class="inline">port_info()</code> BIFs.</li></ul><p>Own Id: OTP-17291</p></li><li><p>Fix bug in <a href="persistent_term.html#get/0"><code class="inline">persistent_term:get/0</code></a> and <code class="inline">info/0</code> that could cause VM crash in
rare cases. Bug exists since OTP 23.0.</p><p>Own Id: OTP-17298</p></li><li><p>Fixed a bug in <code class="inline">zlib</code> where decompression would crash with <code class="inline">data_error</code> on
some valid inputs.</p><p>Own Id: OTP-17299 Aux Id: GH-4710</p></li><li><p>A garbage collection of a literal area missed messages that entirely consisted
of a term in a literal area. This could in turn lead to a crash of the runtime
system.</p><p>Own Id: OTP-17307</p></li><li><p>A call to <a href="erlang.html#process_flag/2"><code class="inline">process_flag(message_queue_data, off_heap)</code></a>
could cause a crash of the runtime system when sequential tracing was enabled.</p><p>Own Id: OTP-17349</p></li></ul><h2 id="erts-11-2" class="section-heading"><a href="#erts-11-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.2</span></h2><h3 id="fixed-bugs-and-malfunctions-119" class="section-heading"><a href="#fixed-bugs-and-malfunctions-119" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix memory leak of about 6 words when <a href="erlang.html#process_flag/3"><code class="inline">erlang:process_flag/3</code></a> is called with a
pid of an already dead process. Bug exists since OTP-21.0.</p><p>Own Id: OTP-17081 Aux Id: PR-2930</p></li><li><p>Fixed small memory leak in <code class="inline">erl_drv_send_term</code> and <code class="inline">erl_drv_output_term</code> when
failing due to the term being invalid.</p><p>Own Id: OTP-17089 Aux Id: PR-2934</p></li><li><p>The DTrace/SystemTap <code class="inline">process_heap_grow</code> probe is now called with valid the
heap and stack pointers for the process in question.</p><p>Own Id: OTP-17096 Aux Id: PR-2932</p></li><li><p>Fixed a performance issue in memory allocation for Linux kernels that didn't
support <code class="inline">MADV_FREE</code>.</p><p>Own Id: OTP-17124</p></li><li><p>A <a href="erl_dist_protocol.html#new_link_protocol">new link protocol</a> has been
introduced which prevents links from ending up in an inconsistent state where
one participant considers itself linked while the other doesn't. This bug has
always existed in the distributed case, but has since OTP 21 also existed in
the node local case since the distributed link protocol then was adopted also
for node local links. The bug could, however, only trigger if both
participants operated on the link simultaneously.</p><p>Own Id: OTP-17127</p></li><li><p>Fix memory leak when receiving sigchld from port program to already dead port.</p><p>Own Id: OTP-17163</p></li><li><p>Fix bug where complex seq_trace tokens (that is lists, tuples, maps etc) could
becomes corrupted by the GC. The bug was introduced in OTP-21.</p><p>Own Id: OTP-17209 Aux Id: PR-3039</p></li><li><p>Fixed WSLPATH environment variable addition to PATH on windows, the last
character was lost.</p><p>Own Id: OTP-17229</p></li><li><p>Fixed a bug in the timer implementation which could cause timers that were set
to more than 37.25 hours in the future to be delayed. This could occur if
there were multiple timers scheduled to be triggered very close in time, but
still at different times, and the scheduler thread handling the timers was not
able to handle them quickly enough. Delayed timers were in this case triggered
when another unrelated timer was triggered.</p><p>Own Id: OTP-17253</p></li><li><p>Fixed small memory leak in <a href="erlang.html#trace/3"><code class="inline">erlang:trace/3</code></a> if option <code class="inline">{tracer,_}</code> is included
and the option list is invalid or the call races with a concurrent trace or
code change operation.</p><p>Own Id: OTP-17265 Aux Id: PR-4596</p></li><li><p>Fix configure check for <code class="inline">inet_pton</code> on 32-bit windows. The failure of this
check would cause epmd to be built without ipv6 support.</p><p>Own Id: OTP-17283</p></li></ul><h3 id="improvements-and-new-features-25" class="section-heading"><a href="#improvements-and-new-features-25" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Various address sanitizer support.</p><p>Own Id: OTP-16959 Aux Id: PR-2965</p></li><li><p>The emulator will now honor <code class="inline">cgroup2</code> CPU quotas.</p><p>Own Id: OTP-17002</p></li><li><p>Improved memory barrier usage on ARMv8 hardware, and specifically on Apple
silicon.</p><p>Own Id: OTP-17195 Aux Id: PR-4505, PR-4538</p></li><li><p>Improved memory barrier usage on 64-bit POWER hardware.</p><p>Own Id: OTP-17200 Aux Id: PR-4510</p></li><li><p>Fix a file descriptor leak when using sendfile and the remote side closes the
connection. This bug has been present since OTP-21.0.</p><p>Own Id: OTP-17244</p></li><li><p>Refinement of the documentation of the <code class="inline">message_queue_data</code> process flag.</p><p>Own Id: OTP-17252 Aux Id: PR-4568</p></li></ul><h2 id="erts-11-1-8" class="section-heading"><a href="#erts-11-1-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.1.8</span></h2><h3 id="fixed-bugs-and-malfunctions-120" class="section-heading"><a href="#fixed-bugs-and-malfunctions-120" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug that could cause some work scheduled for execution on scheduler
threads to be delayed until other similar work appeared. Beside delaying
various cleanup of internal data structures also the following could be
delayed:</p><ul><li>Termination of a distribution controller process</li><li>Disabling of the distribution on a node</li><li>Gathering of memory allocator information using the <code class="inline">instrument</code> module</li><li>Enabling, disabling, and gathering of <code class="inline">msacc</code> information</li><li>Delivery of <code class="inline">'CHANGE'</code> messages when time offset is monitored</li><li>A call to <code class="inline">erlang:cancel_timer()</code></li><li>A call to <code class="inline">erlang:read_timer()</code></li><li><p>A call to <code class="inline">erlang:statistics(io | garbage_collection | scheduler_wall_time)</code></p></li><li>A call to <code class="inline">ets:all()</code></li><li>A call to <code class="inline">erlang:memory()</code></li><li><p>A call to <code class="inline">erlang:system_info({allocator | allocator_sizes, _})</code></p></li><li>A call to <code class="inline">erlang:trace_delivered()</code></li></ul><p>The bug existed on runtime systems running on all types of hardware except for
x86/x86_64.</p><p>Own Id: OTP-17185</p></li></ul><h2 id="erts-11-1-7" class="section-heading"><a href="#erts-11-1-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.1.7</span></h2><h3 id="improvements-and-new-features-26" class="section-heading"><a href="#improvements-and-new-features-26" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Make windows installer remove write access rights for non admin users when
installing to a non default directory. Reduces the risk for DLL sideloading,
but the user should always be aware of the access rights for the installation.</p><p>Own Id: OTP-17097</p></li></ul><h2 id="erts-11-1-6" class="section-heading"><a href="#erts-11-1-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.1.6</span></h2><h3 id="fixed-bugs-and-malfunctions-121" class="section-heading"><a href="#fixed-bugs-and-malfunctions-121" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The <code class="inline">suspend_process()</code> and <code class="inline">resume_process()</code> BIFs did not check their
arguments properly which could cause an emulator crash.</p><p>Own Id: OTP-17080</p></li><li><p>The runtime system would get into an infinite loop if the runtime system was
started with more than 1023 file descriptors already open.</p><p>Own Id: OTP-17088 Aux Id: ERIERL-580</p></li></ul><h2 id="erts-11-1-5" class="section-heading"><a href="#erts-11-1-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.1.5</span></h2><h3 id="fixed-bugs-and-malfunctions-122" class="section-heading"><a href="#fixed-bugs-and-malfunctions-122" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix emulator crash when sending small bit-strings over Erlang distribution
while the connection is being setup.</p><p>The fault was introduced in OTP-23.0</p><p>Own Id: OTP-17083 Aux Id: ERIERL-572</p></li></ul><h2 id="erts-11-1-4" class="section-heading"><a href="#erts-11-1-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.1.4</span></h2><h3 id="fixed-bugs-and-malfunctions-123" class="section-heading"><a href="#fixed-bugs-and-malfunctions-123" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bug which could cause VM crash when a NIF is loaded at the same time as
the Erlang implementation of the NIF is called. Bug exists since OTP 23.0.</p><p>Own Id: OTP-16859</p></li><li><p>Fixed <code class="inline">enif_make_map_*</code> functions in debug build when given environment from
<code class="inline">enif_alloc_env</code>.</p><p>Own Id: OTP-16863 Aux Id: ERL-1352</p></li><li><p>Fixed broken configuration option <code class="inline">--disable-pie</code>.</p><p>Own Id: OTP-16864</p></li><li><p>Fixed rare distribution bug in race between received signal
(link/monitor/spawn_request/spawn_reply) and disconnection. Symptom: VM crash.
Since: OTP 21.0.</p><p>Own Id: OTP-16869 Aux Id: ERL-1337</p></li><li><p>Fixed a performance issue when extremely many items were stored in the process
dictionary. (Fixing this bug also eliminates a compiler warning emitted by the
latest version of Clang.)</p><p>Own Id: OTP-16888</p></li><li><p>Remove <code class="inline">-ftree-copyrename</code> from flags passed to compiler when building erts.
The flag is not used by modern gcc's and is not supported by clang.</p><p>Own Id: OTP-16894</p></li><li><p>Modules using complicated nested binary comprehensions could fail to load.</p><p>Own Id: OTP-16899</p></li><li><p>Fixed a race in <a href="../../apps/kernel/file.html#read_file/1"><code class="inline">file:read_file/1</code></a> were an incomplete file could be returned
if another OS process swapped the file out while reading.</p><p>Own Id: OTP-16948 Aux Id: PR-2792</p></li><li><p>The call <a href="erlang.html#list_to_integer/2"><code class="inline">list_to_integer(&quot;10&quot;, true)</code></a> would return <code class="inline">4</code>
instead of raising an exception. Certain other atoms would also be interpreted
as a number base.</p><p>Own Id: OTP-17030</p></li><li><p>On macOS 11 (Big Sur), erl would not start if the maximum number of file
descriptors were unlimited (<code class="inline">ulimit -n unlimited</code>).</p><p>Own Id: OTP-17055 Aux Id: ERL-1417</p></li></ul><h3 id="improvements-and-new-features-27" class="section-heading"><a href="#improvements-and-new-features-27" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Add manifest to all executables and dynamic libraries.</p><p>Own Id: OTP-17067 Aux Id: PR-2907</p></li></ul><h2 id="erts-11-1-3" class="section-heading"><a href="#erts-11-1-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.1.3</span></h2><h3 id="fixed-bugs-and-malfunctions-124" class="section-heading"><a href="#fixed-bugs-and-malfunctions-124" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a crash when exceptions were thrown during call time tracing.</p><p>Own Id: OTP-16994</p></li></ul><h2 id="erts-11-1-2" class="section-heading"><a href="#erts-11-1-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.1.2</span></h2><h3 id="fixed-bugs-and-malfunctions-125" class="section-heading"><a href="#fixed-bugs-and-malfunctions-125" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bugs causing issues when enabling the ERTS internal allocators on a
system built with the undocumented and unsupported <code class="inline">SMALL_MEMORY</code> feature.</p><p>Own Id: OTP-16939</p></li><li><p>The inet driver used to use 16 as maximum elements in an I/O vector passed to
<code class="inline">writev()</code> (and <code class="inline">WSASend()</code> on Windows). When the data to send contained lots
of elements, this caused a performance degradation since repeated calls to
<code class="inline">writev()</code> had to be made to a much larger extent. The inet driver now looks
up actual maximum amount of elements that can be used on the system, instead
of just assuming 16. On most systems this will result in a maximum amount of
I/O vector elements of 1024.</p><p>As of OTP 23.0 the term encoding of signals to send over the distribution are
encoded into I/O vectors of buffers instead of into a single buffer. Reference
counted binaries are referred to directly from the I/O vector instead of being
copied into the single buffer. That is, Erlang signals containing huge amounts
of reference counted binaries was effected by this performance degradation.</p><p>Own Id: OTP-16955 Aux Id: ERL-1343, OTP-15618</p></li><li><p>In the distributed case, a faulty <code class="inline">reply</code> option in a call to the
<code class="inline">spawn_request()</code> BIF erroneously caused a <code class="inline">badarg</code> exception instead of a
<code class="inline">badopt</code> error message reply.</p><p>Own Id: OTP-16991 Aux Id: OTP-15251</p></li></ul><h2 id="erts-11-1-1" class="section-heading"><a href="#erts-11-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-126" class="section-heading"><a href="#fixed-bugs-and-malfunctions-126" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>inet:setopts([{active,once}]) wakes up IO polling thread unnecessarily,
leading to lock contention and visibly higher CPU utilization.</p><p>Own Id: OTP-16847 Aux Id: ERL-1301</p></li><li><p>Two bugs in the ERTS internal thread wakeup functionality have been fixed.
These bugs mainly hit when all threads in the system tried to go to sleep.
When the bugs were triggered, certain operations were delayed until a thread
woke up due to some other reason. Most important operations effected were code
loading, persistent term updates, and memory deallocation.</p><p>Own Id: OTP-16870</p></li><li><p>Fixed bug in <a href="../../apps/stdlib/ets.html#select_replace/2"><code class="inline">ets:select_replace/2</code></a> on <code class="inline">compressed</code> tables that could produce
faulty results or VM crash. Bug exists since OTP 20.</p><p>Own Id: OTP-16874 Aux Id: ERL-1356, PR-2763</p></li><li><p>When compiling Erlang/OTP on macOS using Xcode 12, the performance of the BEAM
interpreter would be degraded.</p><p>Own Id: OTP-16892</p></li></ul><h3 id="improvements-and-new-features-28" class="section-heading"><a href="#improvements-and-new-features-28" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>As of OTP 22, the allocator specific memory carrier pools were replaced by a
node global carrier pool. This unfortunately caused substantial memory
fragmentation in some cases due to long lived data being spread into carriers
used by allocators mainly handling short lived data.</p><p>A new command line argument <code class="inline">+M&lt;S&gt;cp</code> has been introduced with which one can
enable the old behavior as well as configuring other behaviors for the carrier
pools. In order to configure the old behavior, with allocator specific carrier
pools for all allocators, pass <code class="inline">+Mucp :</code> (including the colon character) as a
command line argument to <code class="inline">erl</code> when starting the Erlang system.</p><p>The default configuration for carrier pools will be changed to <code class="inline">+Mucp :</code> some
time in the future, but not in this patch.</p><p>Own Id: OTP-16856</p></li></ul><h2 id="erts-11-1" class="section-heading"><a href="#erts-11-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.1</span></h2><h3 id="fixed-bugs-and-malfunctions-127" class="section-heading"><a href="#fixed-bugs-and-malfunctions-127" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Update the documentation of the abstract format to use <code class="inline">ANNO</code> instead of
<code class="inline">LINE</code>.</p><p>Own Id: OTP-16625 Aux Id: PR-2609</p></li><li><p>The emulator will no longer revert to the default number of schedulers when
running under a CPU quota lower than 1 CPU.</p><p>Own Id: OTP-16710 Aux Id: ERL-1280</p></li><li><p>Fixed a problem with crash dumps. When a process that contained reference to
literals internally created by the runtime system (such as the tuple returned
by <a href="../../apps/kernel/os.html#type/0"><code class="inline">os:type/0</code></a>), the literal would not be included in the crash dump and the
crashdump viewer would complain about the heap being incomplete.</p><p>Own Id: OTP-16713</p></li><li><p>Fix configure detection of PGO for clang.</p><p>Own Id: OTP-16738</p></li><li><p>The to_erl program has been fixed to correctly interpret newline as only
newline and not newline+return.</p><p>This bug would cause the terminal to behave strangely when using lines longer
than the terminal size.</p><p>Own Id: OTP-16741</p></li><li><p>A race condition when changing process priority by calling
<a href="erlang.html#process_flag/2"><code class="inline">process_flag(priority, Prio)</code></a> could cause elevation of
priority for a system task to be ignored. This bug hit if the system task was
scheduled on the process calling <code class="inline">process_flag()</code> at the same time as the
priority was changed. The bug is quite harmless and should hit very seldom if
ever.</p><p>Own Id: OTP-16770</p></li><li><p>Adjust <code class="inline">/bin/sh</code> to <code class="inline">/system/bin/sh</code> in scripts when installing on Android.</p><p>Own Id: OTP-16833 Aux Id: PR-2729</p></li><li><p>In rare circumstances, when loading a BEAM file generated by an alternative
code generator (not the Erlang compiler in OTP) or from handwritten or patched
BEAM code, the loader could do an unsafe optimization.</p><p>Own Id: OTP-16850 Aux Id: ERL-1344</p></li><li><p>A memory and file descriptor leak in socket has been fixed. (When a newly
opened socket that had not entered the fd into the VM's poll set (neither
received, sent, accepted nor connected) was abandoned without closing (process
died), after assigning a different controlling process, then a memory block
and the file descriptor could be leaked.)</p><p>Own Id: OTP-16857</p></li><li><p>The documentation of <a href="erlang.html#statistics/1"><code class="inline">statistics(run_queue)</code></a> erroneously
stated that it returns the total length of all normal run queues when it is
the total length of all normal and dirty CPU run queues that is returned. The
documentation has been updated to reflect the actual behavior.</p><p>Own Id: OTP-16866 Aux Id: ERL-1355</p></li></ul><h3 id="improvements-and-new-features-29" class="section-heading"><a href="#improvements-and-new-features-29" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Changes in order to build on the Haiku operating system.</p><p>Thanks to Calvin Buckley</p><p>Own Id: OTP-16707 Aux Id: PR-2638</p></li><li><p>When building the inet driver on Windows, there where many compiler warnings
regarding type casting (used when calling the debug macro). This has now been
resolved.</p><p>Own Id: OTP-16715</p></li><li><p>Make (use of) the socket registry optional (still enabled by default). Its now
possible to build OTP with the socket registry turned off, turn it off by
setting an environment variable and controlling in runtime (via function calls
and arguments when creating sockets).</p><p>Own Id: OTP-16763</p></li><li><p>Change default filename encoding on android to UTF-8.</p><p>Own Id: OTP-16821 Aux Id: PR-2733</p></li><li><p>Clarification of the format of the atom cache header used by the distribution.</p><p>Own Id: OTP-16848 Aux Id: PR-2737</p></li></ul><h2 id="erts-11-0-4" class="section-heading"><a href="#erts-11-0-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.0.4</span></h2><h3 id="fixed-bugs-and-malfunctions-128" class="section-heading"><a href="#fixed-bugs-and-malfunctions-128" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The ERTS internal I/O poll implementation could get into an inconsistent state
causing input events to be ignored.</p><p>Own Id: OTP-16780 Aux Id: PR-2701</p></li></ul><h2 id="erts-11-0-3" class="section-heading"><a href="#erts-11-0-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.0.3</span></h2><h3 id="fixed-bugs-and-malfunctions-129" class="section-heading"><a href="#fixed-bugs-and-malfunctions-129" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bug in <a href="erlang.html#load_nif/2"><code class="inline">erlang:load_nif/2</code></a> that could cause it to throw <code class="inline">badarg</code>
exception if a concurrent code change operation was in progress. Bug existed
since OTP 23.0.</p><p>Own Id: OTP-16704 Aux Id: ERL-1273, PR-16704</p></li><li><p>Minor fix of debug compiled VM.</p><p>Own Id: OTP-16717</p></li><li><p>An unintentional reuse of an already used emulator internal event object could
cause a wakeup signal to a thread to be lost. In worst case this could cause
the runtime system to hang. This hang was however quite rare.</p><p>Own Id: OTP-16766 Aux Id: ERL-1304</p></li><li><p>NIF threads and driver threads on non-Linux systems leaked internal resources
when terminating. On Windows these resources were one event per thread. On
most other systems one mutex and one condition variable per thread. On these
other systems that also lacked <code class="inline">pthread_cond_timedwait()</code> also a pipe with its
file descriptors was leaked.</p><p>Own Id: OTP-16772 Aux Id: ERL-1304</p></li></ul><h2 id="erts-11-0-2" class="section-heading"><a href="#erts-11-0-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.0.2</span></h2><h3 id="fixed-bugs-and-malfunctions-130" class="section-heading"><a href="#fixed-bugs-and-malfunctions-130" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bug when sending an export fun (eg <a href="../../apps/stdlib/lists.html#reverse/1"><code class="inline">lists:reverse/1</code></a>) on a not yet
established connection. It could cause VM crash. Bug exists since OTP 23.0.</p><p>Own Id: OTP-16693 Aux Id: ERL-1254, PR-2640</p></li></ul><h2 id="erts-11-0-1" class="section-heading"><a href="#erts-11-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-131" class="section-heading"><a href="#fixed-bugs-and-malfunctions-131" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The functionality utilized by BIFs for temporary disabling of garbage
collection while yielding could cause system task queues to become
inconsistent on a process executing such a BIF. Process system tasks are for
example utilized when purging code, garbage collecting literal data, and when
issuing an ordinary garbage collection from another process.</p><p>The bug does not trigger frequently. Multiple code purges in direct sequence
makes it more likely that this bug is triggered. In the cases observed, this
has resulted in a hanging code purge operation.</p><p>Own Id: OTP-16639 Aux Id: ERL-1236</p></li><li><p>SCTP and UDP recv/2,3 hangs indefinitely if socket is closed while recv is
called (socket in passive mode).</p><p>Own Id: OTP-16654 Aux Id: ERL-1242</p></li></ul><h2 id="erts-11-0" class="section-heading"><a href="#erts-11-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 11.0</span></h2><h3 id="fixed-bugs-and-malfunctions-132" class="section-heading"><a href="#fixed-bugs-and-malfunctions-132" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>BIFs now behave like ordinary functions with regard to tracing, allowing
<code class="inline">call_count</code> tracing and fixing a few bugs where return trace messages were
lost when BIFs tail-called themselves or other functions (&quot;trapping&quot;).</p><p>Own Id: OTP-14734 Aux Id: ERL-496</p></li><li><p>Fix various compiler warnings on 64-bit Windows.</p><p>Own Id: OTP-15800</p></li><li><p><code class="inline">erlang:fun_info(fun foo/1, name/1)</code> used to return a function name based on
the name of the function that <code class="inline">fun foo/1</code> was used in. The name returned is
now <code class="inline">-fun.foo/1-</code>.</p><p>Own Id: OTP-15837</p></li><li><p><a href="../../apps/kernel/file.html#allocate/3"><code class="inline">file:allocate/3</code></a> will now update the file size on all platforms.</p><p>Own Id: OTP-16155 Aux Id: PR-2408</p></li><li><p><code class="inline">erlang:decode_packet</code> with type set to <code class="inline">httph</code> no longer accepts http headers
that have whitespaces in between the header name and the colon. That is:</p><p><code class="inline">Content-Type : text/html</code></p><p>is no longer allowed. This has been changed to conform with RFC 7230 and thus
protect against http desync attacks.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-16168 Aux Id: ERL-1053</p></li><li><p>Fix the quoting rules in <code class="inline">erl -args_file</code>, <code class="inline">ERL_FLAGS</code>, <code class="inline">ERL_AFLAGS</code> and
<code class="inline">ERL_ZFLAGS</code> to work as unix sh quoting.</p><p>This bug fix can make previous configuration options to <code class="inline">erl</code> passed through
<code class="inline">ERL_FLAGS</code>, <code class="inline">ERL_AFLAGS</code>, <code class="inline">ERL_ZFLAGS</code> or <code class="inline">-args_file</code> not be interpreted in
the same way as before the fix.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-16244 Aux Id: ERL-1051</p></li><li><p>Fix the Erlang distribution to handle the scenario when a node connects that
can handle message fragmentation but can not handle the atom cache. This bug
only affects users that have implemented a custom distribution carrier. It has
been present since OTP-21.</p><p>The <code class="inline">DFLAG_FRAGMENT</code> distribution flag was added to the set of flags that can
be rejected by a distribution implementation.</p><p>Own Id: OTP-16284</p></li><li><p>Compiling a match specification with excessive nesting caused the runtime
system to crash due to scheduler stack exhaustion. Instead of crashing the
runtime system, effected functions will now raise a <code class="inline">system_limit</code> error
exception in this situation.</p><p>Own Id: OTP-16431 Aux Id: ERL-592</p></li><li><p>Fixed a bug that prevented Erlang from being started on Windows if it were
installed on certain paths.</p><p>Own Id: OTP-16478 Aux Id: ERL-1115</p></li><li><p>Fix bug on Windows causing bad performance when standard input is closed,
especially if the VM is only assigned one CPU core. Could be provoked for
example by starting erl or escript via function <a href="../../apps/kernel/os.html#cmd/1"><code class="inline">os:cmd/1</code></a>. Could be avoided
with command line option <code class="inline">-noinput</code>.</p><p>The bad performance was caused by an io thread spinning indefinitely.</p><p>Own Id: OTP-16521 Aux Id: ERL-716</p></li><li><p>Fixed a bug on Unix platforms that would cause <a href="../../apps/kernel/file.html#read_file_info/1"><code class="inline">file:read_file_info/1</code></a> to
return incorrect results if the emulator's effective user or group id differed
from its actual ones.</p><p>Own Id: OTP-16571</p></li><li><p>socket: Compile problems on Android when PACKET_FASTROUTE and PACKET_USER are
both defined and has the same value. Use of PACKET_FASTROUTE has been removed
as it may be unused and also only for none user-land.</p><p>Own Id: OTP-16576 Aux Id: ERL-1208</p></li><li><p>Fixed bug in erl_crash.dump generation that could cause a SEGV core dump if a
recently cancelled timer was found.</p><p>Own Id: OTP-16596 Aux Id: ERL-1105, PR-2606</p></li></ul><h3 id="improvements-and-new-features-30" class="section-heading"><a href="#improvements-and-new-features-30" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Improved concurrency of <a href="erlang.html#load_nif/2"><code class="inline">erlang:load_nif/2</code></a> as it does no longer block other
schedulers from executing during initial load of a NIF library.</p><p>Own Id: OTP-10278</p></li><li><p>EEP-52 has been implemented.</p><p>In binary matching, the size of the segment to be matched is now allowed to be
a guard expression, and similarly in map matching the keys can now be guard
expressions. See the Erlang Reference Manual and Programming Examples for more
details.</p><p>Language compilers or code generators that generate Core Erlang code may need
to be updated to be compatible with the compiler in OTP 23. For more details,
see the section Backwards Compatibility in
<a href="http://erlang.org/eeps/eep-0052.html">EEP 52</a>.</p><p>Own Id: OTP-14708</p></li><li><p>Internally in BEAM, handling of continuation pointers has been simplified.
This change is not user-visible, except when examining a process stack in the
crashdump viewer. The continuation pointer for a function will now be stored
below the y(0) for that function.</p><p>Own Id: OTP-15077</p></li><li><p><code class="inline">seq_trace</code> tokens are now propagated to spawned processes.</p><p>Own Id: OTP-15232 Aux Id: ERL-700</p></li><li><p>Improvements of distributed spawn operations. These include both scalability
and performance improvements as well as new functionality.</p><p>New functionality:</p><ul><li>A distributed <a href="erlang.html#spawn_monitor/4"><code class="inline">spawn_monitor()</code></a> BIF.</li><li>Support for <code class="inline">monitor</code> option in the distributed
<a href="erlang.html#spawn_opt/5"><code class="inline">spawn_opt()</code></a> BIF.</li><li>New <a href="erlang.html#spawn_request/5"><code class="inline">spawn_request()</code></a> BIFs for asynchronous
spawn of processes. <code class="inline">spawn_request()</code> supports all options that
<code class="inline">spawn_opt()</code> support plus a few more.</li></ul><p>Own Id: OTP-15251</p></li><li><p>Make <a href="../../apps/stdlib/ets.html#insert/2"><code class="inline">ets:insert/2</code></a> and <a href="../../apps/stdlib/ets.html#insert_new/2"><code class="inline">ets:insert_new/2</code></a> yield scheduler execution on long
lists of records to insert.</p><p>Own Id: OTP-15517 Aux Id: ERL-560</p></li><li><p>Increased size of node incarnation numbers (aka &quot;creation&quot;), from 2 bits to 32
bits. This will reduce the risk of pids/ports/refs, from different node
incarnation with the same name, being mixed up.</p><p>Own Id: OTP-15603</p></li><li><p>The runtime system can now encode Erlang terms to the Erlang external term
format as I/O vectors. The main benefit of this is that reference counted
binaries can be referred to directly instead of copied into a new binary.</p><p>The default Erlang distribution over TCP will always utilize this. Alternate
distribution implementations utilizing a port as distribution controller will
utilize this if the driver implements the <a href="driver_entry.html#outputv"><code class="inline">outputv</code></a>
callback. Alternate Erlang distribution implementations utilizing a process as
distribution controller will utilize this if I/O vectors are utilized by the
functionality that processes the data returned from
<a href="erlang.html#dist_ctrl_get_data/1"><code class="inline">erlang:dist_ctrl_get_data()</code></a>.</p><p>The return type for data returned by
<a href="erlang.html#dist_ctrl_get_data/1"><code class="inline">erlang:dist_ctrl_get_data()</code></a> has been
changed from <a href="erlang.html#t:iodata/0"><code class="inline">iodata/0</code></a> to <code class="inline">iovec()</code>. Note that <code class="inline">iovec()</code> data is valid
<a href="erlang.html#t:iodata/0"><code class="inline">iodata/0</code></a> so old implementations using <code class="inline">erlang:dist_ctrl_get_data()</code> do not
need to be changed, but may benefit from being changed depending on usage
scenario.</p><p>The new BIFs <a href="erlang.html#term_to_iovec/1"><code class="inline">term_to_iovec/1</code></a> and
<a href="erlang.html#term_to_iovec/2"><code class="inline">term_to_iovec/2</code></a> have been introduced. These work
exactly as <code class="inline">term_to_binary()</code> with the corresponding arity except the return
type.</p><p>Own Id: OTP-15618</p></li><li><p>Improved ETS scalability of concurrent calls that change the size of a table,
like <a href="../../apps/stdlib/ets.html#insert/2"><code class="inline">ets:insert/2</code></a> and <a href="../../apps/stdlib/ets.html#delete/2"><code class="inline">ets:delete/2</code></a>.</p><p>This performance feature was implemented for <code class="inline">ordered_set</code> in OTP 22.0 and
does now apply for all ETS table types.</p><p>The improved scalability may come at the cost of longer latency of
<code class="inline">ets:info(T,size)</code> and <code class="inline">ets:info(T,memory)</code>. A new table option
<code class="inline">decentralized_counters</code> has therefore been added. It is default <code class="inline">true</code> for
<code class="inline">ordered_set</code> with <code class="inline">write_concurrency</code> enabled and default <code class="inline">false</code> for all
other table types.</p><p>Own Id: OTP-15744 Aux Id: OTP-15623, PR-2229</p></li><li><p>Directories can now be opened by <a href="../../apps/kernel/file.html#open/2"><code class="inline">file:open/2</code></a> when passing the <code class="inline">directory</code>
option.</p><p>Own Id: OTP-15835 Aux Id: PR-2212</p></li><li><p>Add Hygon Dhyana as known processor to enable support for atomic operations.</p><p>Own Id: OTP-15840</p></li><li><p>Make <code class="inline">erlang:phash2</code> functions consume reductions proportional to the size of
the input term and yield scheduler when reductions are depleted.</p><p>Own Id: OTP-15842 Aux Id: PR-2182</p></li><li><p>Fix various build issues when compiling Erlang/OTP to the IBM AIX platform.</p><p>Own Id: OTP-15866 Aux Id: PR-2110</p></li><li><p>Add configure options <code class="inline">--enable-pie</code> and <code class="inline">--disable-pie</code> to control the build
of position independent executables.</p><p>Own Id: OTP-15868</p></li><li><p><a href="../../apps/kernel/file.html#read_file_info/2"><code class="inline">file:read_file_info/2</code></a> can now be used on opened files and directories.</p><p>Own Id: OTP-15956 Aux Id: PR-2231</p></li><li><p>Add arity-1 versions of <code class="inline">atom_to_binary</code>, <code class="inline">binary_to_atom</code> and
<code class="inline">binary_to_existing_atom</code>, all with <code class="inline">utf8</code> as default encoding.</p><p>Own Id: OTP-15995 Aux Id: PR-2358</p></li><li><p>Optimized the erts internal hash table implementation for faster lookups. The
internal hash is used for things like; the process registry, executing
erlang:apply/2, executing M:func(test), and more.</p><p>Own Id: OTP-16014 Aux Id: PR-2345</p></li><li><p>CPU quotas are now taken into account when deciding the default number of
online schedulers, improving performance in container environments where
quotas are applied, such as <code class="inline">docker</code> with the <code class="inline">--cpus</code> flag.</p><p>Own Id: OTP-16105 Aux Id: ERL-927</p></li><li><p>The <code class="inline">-config</code> option to <code class="inline">erl</code> now can take multiple config files without
repeating the <code class="inline">-config</code> option. Example:</p><p>erl -config sys local</p><p>Own Id: OTP-16148 Aux Id: PR-2373</p></li><li><p>Removed the <code class="inline">scheduler_poll</code> and <code class="inline">async I/O</code> dtrace and LTTng trace probes.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-16215</p></li><li><p>Optimized <a href="persistent_term.html#put/2"><code class="inline">persistent_term:put/2</code></a> and <a href="erlang.html#erase/1"><code class="inline">erase/1</code></a> to consume less
CPU in many cases.</p><p>Own Id: OTP-16237 Aux Id: PR-2389</p></li><li><p>The possibility to run Erlang distribution without relying on EPMD has been
extended. To achieve this a couple of new options to the inet distribution has
been added.</p><ul><li><p><strong>-dist_listen false</strong> - Setup the distribution channel, but do not listen
for incoming connection. This is useful when you want to use the current
node to interact with another node on the same machine without it joining
the entire cluster.</p></li><li><p><strong>-erl_epmd_port Port</strong> - Configure a default port that the built-in EPMD
client should return. This allows the local node to know the port to connect
to for any other node in the cluster.</p></li></ul><p>The <code class="inline">erl_epmd</code> callback API has also been extended to allow returning <code class="inline">-1</code> as
the creation which means that a random creation will be created by the node.</p><p>In addition a new callback function called <code class="inline">listen_port_please</code> has been added
that allows the callback to return which listen port the distribution should
use. This can be used instead of <code class="inline">inet_dist_listen_min/max</code> if the listen port
is to be fetched from an external service.</p><p>Own Id: OTP-16250</p></li><li><p>On systems without <code class="inline">closefrom()</code>, such as Linux, iterating over all possible
file descriptors and calling <code class="inline">close()</code> for each is inefficient. This is
markedly so when the maximum number of file descriptors has been tuned to a
large number.</p><p>Instead, in erl_child_setup, walk the open descriptors under <code class="inline">/dev/fd</code> and
close only those which are open.</p><p>This optimization affects the CPU usage of starting a new Erlang instance.</p><p>Own Id: OTP-16270</p></li><li><p>Optimized <a href="../../apps/stdlib/maps.html#merge/2"><code class="inline">maps:merge/2</code></a> for trivial cases of an empty map(s) or same map.</p><p>Own Id: OTP-16283 Aux Id: PR-2441</p></li><li><p>The new experimental <code class="inline">socket</code> module has been moved to the Kernel application.</p><p>Own Id: OTP-16312</p></li><li><p>Improved the presentation of allocations and carriers in the <code class="inline">instrument</code>
module.</p><p>Own Id: OTP-16327</p></li><li><p>As announced in OTP 22.0, the previously existing limited support for VxWorks
has now been removed.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-16329 Aux Id: OTP-15621</p></li><li><p>The return value when using the <code class="inline">httph</code> and <code class="inline">httph_bin</code> option to
<a href="erlang.html#decode_packet/3"><code class="inline">erlang:decode_packet/3</code></a> and <a href="../../apps/kernel/inet.html#setopts/2"><code class="inline">inet:setopts/2</code></a> has been changed to also include
the original header unmodified. See <a href="erlang.html#decode_packet/3"><code class="inline">erlang:decode_packet/3</code></a>. Example:</p><pre><code class="makeup erlang" translate="no"><span class="w"> </span><span class="o">&gt;</span><span class="w">
      </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">decode_packet</span><span class="p" data-group-id="9692086428-1">(</span><span class="ss">httph_bin</span><span class="p">,</span><span class="p" data-group-id="9692086428-2">&lt;&lt;</span><span class="s">&quot;HELLO:
      hi\r\n\r\n&quot;</span><span class="p" data-group-id="9692086428-2">&gt;&gt;</span><span class="p">,</span><span class="p" data-group-id="9692086428-3">[</span><span class="p" data-group-id="9692086428-3">]</span><span class="p" data-group-id="9692086428-1">)</span><span class="p">.</span><span class="w">
      </span><span class="p" data-group-id="9692086428-4">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="9692086428-5">{</span><span class="ss">http_header</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="p" data-group-id="9692086428-6">&lt;&lt;</span><span class="s">&quot;Hello&quot;</span><span class="p" data-group-id="9692086428-6">&gt;&gt;</span><span class="p">,</span><span class="p" data-group-id="9692086428-7">&lt;&lt;</span><span class="s">&quot;HELLO&quot;</span><span class="p" data-group-id="9692086428-7">&gt;&gt;</span><span class="p">,</span><span class="p" data-group-id="9692086428-8">&lt;&lt;</span><span class="s">&quot;hi&quot;</span><span class="p" data-group-id="9692086428-8">&gt;&gt;</span><span class="p" data-group-id="9692086428-5">}</span><span class="p">,</span><span class="p" data-group-id="9692086428-9">&lt;&lt;</span><span class="s">&quot;\r\n&quot;</span><span class="p" data-group-id="9692086428-9">&gt;&gt;</span><span class="p" data-group-id="9692086428-4">}</span></code></pre><p>Own Id: OTP-16347 Aux Id: PR-2466</p></li><li><p>Ensure <a href="../../apps/kernel/net_kernel.html#monitor_nodes/1"><code class="inline">net_kernel:monitor_nodes/1</code></a> sends <code class="inline">nodedown</code> messages of a failed
connection before <code class="inline">nodeup</code> messages of a reestablished connection toward the
same node.</p><p>Own Id: OTP-16362</p></li><li><p>Update of <a href="../../apps/kernel/seq_trace.html#whatis">sequential tracing</a> to also support other
information transfers than message passing.</p><p>Own Id: OTP-16370 Aux Id: OTP-15251, OTP-15232</p></li><li><p>socket: It is now possible to create a socket from an already existing file
descriptor.</p><p>Own Id: OTP-16398 Aux Id: ERL-1154</p></li><li><p>socket: The socket:supports/1 function now also report if netns is supported
or not.</p><p>Own Id: OTP-16432</p></li><li><p><code class="inline">=:=</code> has been optimized to return <code class="inline">false</code> immediately when comparing two maps
of different sizes.</p><p>Own Id: OTP-16454</p></li><li><p>Changed the behaviour of passing the <code class="inline">erl</code> command line argument
<a href="erl_cmd.html#async_thread_pool_size"><code class="inline">+A 0</code></a> to silently imply <code class="inline">+A 1</code>. That is,
it will no longer be possible to completely disable the async thread pool.
Disabling of the async thread pool has since OTP 21 had no benefits; only lots
of drawbacks.</p><p>Own Id: OTP-16482</p></li><li><p>The deprecated <code class="inline">erlang:get_stacktrace/0</code> BIF now returns an empty list instead
of a stacktrace. To retrieve the stacktrace, use the extended try/catch syntax
that was introduced in OTP 21. <code class="inline">erlang:get_stacktrace/0</code> is scheduled for
removal in OTP 24.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-16484</p></li><li><p><a href="init.html#restart/1"><code class="inline">init:restart/1</code></a> has been introduced. <a href="init.html#restart/1"><code class="inline">init:restart/1</code></a> can be utilized for
changing the code loading mode during a restart.</p><p>Own Id: OTP-16492 Aux Id: PR-2461</p></li><li><p>Improve configure for the net nif, which should increase portability.</p><p>Own Id: OTP-16530 Aux Id: OTP-16464</p></li><li><p>socket: Socket counters and socket global counters are now represented as maps
(instead of property lists).</p><p>Own Id: OTP-16535</p></li><li><p>Reduced the resource usage of <code class="inline">erlc</code> in parallel builds (e.g. <code class="inline">make -j128</code>).</p><p>Own Id: OTP-16543 Aux Id: ERL-1186</p></li><li><p>The experimental socket module has gotten restrictions removed so now the
'seqpacket' socket type should work for any communication domain (protocol
family) where the OS supports it, typically the Unix Domain.</p><p>Own Id: OTP-16550 Aux Id: ERIERL-476</p></li><li><p>Updated the internal <code class="inline">pcre</code> library to <code class="inline">8.44</code>.</p><p>Own Id: OTP-16557</p></li><li><p>There is now cost in terms of reductions when copying binary data using the
binary syntax.</p><p>Own Id: OTP-16601 Aux Id: OTP-16577</p></li><li><p>The executable <code class="inline">erl_call</code> is now part of the <code class="inline">erts</code> distribution in addition
to <code class="inline">erl_interface</code>.</p><p>Own Id: OTP-16602</p></li><li><p>Fix a buffer overflow bug that caused EPMD to consume 100% CPU after many
nodes had been connected on the same time on NetBSD.</p><p>Own Id: OTP-16615</p></li><li><p><code class="inline">erl -remsh</code> now uses the dynamic node names feature by default. See the
<a href="erl_cmd.html">erl</a> documentation for details.</p><p>Own Id: OTP-16616</p></li><li><p>socket: By default the socket options rcvtimeo and sndtimeo are now disabled.
To enable these, OTP now has to be built with the configure option
--enable-esock-rcvsndtimeo</p><p>Own Id: OTP-16620</p></li><li><p>The environment variable $HOME does no longer have to be set before Erlang can
be started.</p><p>Own Id: OTP-16635 Aux Id: ERL-476 PR-2390</p></li></ul><h2 id="erts-10-7-2-19" class="section-heading"><a href="#erts-10-7-2-19" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.19</span></h2><h3 id="fixed-bugs-and-malfunctions-133" class="section-heading"><a href="#fixed-bugs-and-malfunctions-133" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A race could cause <a href="erlang.html#process_info/2"><code class="inline">process_info(Pid, message_queue_len)</code></a> on other processes to return invalid results.</p><p>Own Id: OTP-18169 Aux Id: PR-6134</p></li><li><p>Fixed reduction counting for handling process system tasks.</p><p>Own Id: OTP-18170 Aux Id: PR-6135</p></li><li><p>Priority elevation of terminating processes did not work which could cause execution of such processes to be delayed.</p><p>Own Id: OTP-18175 Aux Id: PR-6142</p></li><li><p>The <a href="erlang.html#monotonic_time/1"><code class="inline">erlang:monotonic_time/1</code></a>, <a href="erlang.html#system_time/1"><code class="inline">erlang:system_time/1</code></a>, <a href="erlang.html#time_offset/1"><code class="inline">erlang:time_offset/1</code></a>, and <a href="../../apps/kernel/os.html#system_time/1"><code class="inline">os:system_time/1</code></a> BIFs erroneously failed when passed the argument <code class="inline">native</code>.</p><p>Own Id: OTP-18197 Aux Id: GH-6165, PR-6213</p></li><li><p>Notifications about available distribution data sent to distribution controller processes could be lost. Distribution controller processes can be used when implementing an alternative distribution carrier. The default distribution over tcp was not effected and the bug was also not present on x86/x86_64 platforms.</p><p>Own Id: OTP-18258 Aux Id: GH-6309, PR-6324</p></li></ul><h2 id="erts-10-7-2-18" class="section-heading"><a href="#erts-10-7-2-18" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.18</span></h2><h3 id="fixed-bugs-and-malfunctions-134" class="section-heading"><a href="#fixed-bugs-and-malfunctions-134" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix bug where the process message queue was left in an inconsistent state when
changing from on_heap to off_heap message queue data causing the GC to
segfault.</p><p>Own Id: OTP-18075 Aux Id: PR-5927</p></li><li><p>Fix functions that convert universal to localtime (such as erlang:localtime/0
and erlang:universaltime_to_localtime/1) to fetch the correct localtime if it
is changed after the start of the VM.</p><p>Own Id: OTP-18076 Aux Id: ERIERL-802 PR-5905</p></li><li><p>Fix memory leak when a process doing a distributed fragmented send is sent an
exit signal. Before this fix the receiving node would be left with an
incomplete message that would remain until the nodes were disconnected. The
bug has existed since Erlang/OTP 21.</p><p>Own Id: OTP-18077 Aux Id: GH-5876 PR-5892</p></li></ul><h2 id="erts-10-7-2-17" class="section-heading"><a href="#erts-10-7-2-17" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.17</span></h2><h3 id="fixed-bugs-and-malfunctions-135" class="section-heading"><a href="#fixed-bugs-and-malfunctions-135" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>By default <code class="inline">global</code> does <em>not</em> take any actions to restore a fully connected
network when connections are lost due to network issues. This is problematic
for all applications expecting a fully connected network to be provided, such
as for example <code class="inline">mnesia</code>, but also for <code class="inline">global</code> itself. A network of
overlapping partitions might cause the internal state of <code class="inline">global</code> to become
inconsistent. Such an inconsistency can remain even after such partitions have
been brought together to form a fully connected network again. The effect on
other applications that expects that a fully connected network is maintained
may vary, but they might misbehave in very subtle hard to detect ways during
such a partitioning.</p><p>In order to prevent such issues, we have introduced a <em>prevent overlapping
partitions</em> fix which can be enabled using the
<code class="inline">prevent_overlapping_partitions</code> <code class="inline">kernel(6)</code> parameter. When this fix has been
enabled, <code class="inline">global</code> will actively disconnect from nodes that reports that they
have lost connections to other nodes. This will cause fully connected
partitions to form instead of leaving the network in a state with overlapping
partitions. Note that this fix <em>has</em> to be enabled on <em>all</em> nodes in the
network in order to work properly. Since this quite substantially changes the
behavior, this fix is currently disabled by default. Since you might get hard
to detect issues without this fix you are, however, <em>strongly</em> advised to
enable this fix in order to avoid issues such as the ones described above. As
of OTP 25 this fix will become enabled by default.</p><p>Own Id: OTP-17843 Aux Id: ERIERL-732, PR-5611</p></li><li><p>Fix memory leak when tracing on running on a process that only handle system
tasks or non-message signals (for example process_info requests).</p><p>Own Id: OTP-17904 Aux Id: ERIERL-757</p></li><li><p>Fix Erlang monotonic time on MacOS. Previously used OS monotonic time
primitive on MacOS is buggy and will not be used anymore. It has been replaced
with usage of another OS monotonic time primitive that does not appear to be
buggy.</p><p>Own Id: OTP-17998 Aux Id: PR-5825, GH-5554</p></li></ul><h2 id="erts-10-7-2-16" class="section-heading"><a href="#erts-10-7-2-16" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.16</span></h2><h3 id="improvements-and-new-features-31" class="section-heading"><a href="#improvements-and-new-features-31" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Responsiveness of processes executing on <code class="inline">normal</code> or <code class="inline">low</code> priority could
suffer due to code purging or literal area removal on systems with a huge
amount of processes. This since during these operations all processes on the
system were scheduled for execution at once.</p><p>This problem has been fixed by introducing a limit on outstanding purge and
copy literal requests in the system. By default this limit is set to twice the
amount of schedulers on the system. This will ensure that schedulers will have
enough work scheduled to perform these operations as quickly as possible at
the same time as other work will be interleaved to a much higher degree.
Performance of these operations will however be somewhat degraded due to the
overhead of enforcing this limit compared to when using a very large limit.</p><p>This limit can be set by passing the <code class="inline">+zosrl</code> command line argument to <code class="inline">erl</code>,
or by calling
<code class="inline">erlang:system_flag(outstanding_system_requests_limit, NewLimit)</code>.</p><p>Own Id: OTP-17796 Aux Id: ERIERL-729, PR-5473</p></li></ul><h2 id="erts-10-7-2-15" class="section-heading"><a href="#erts-10-7-2-15" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.15</span></h2><h3 id="fixed-bugs-and-malfunctions-136" class="section-heading"><a href="#fixed-bugs-and-malfunctions-136" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The runtime system could call <code class="inline">select()</code> with a too large timeout value when
executing on MacOS. This could in turn cause the runtime system to crash.</p><p>Own Id: OTP-17735 Aux Id: GH-5339</p></li><li><p>Certain distributed signals that for various reasons must to be forced into
the distribution buffer even when it is full would instead be lost if the
distribution buffer was full when sent. The effected signals:</p><ul><li><code class="inline">EXIT</code> signals with exit reasons of one word size.</li><li><code class="inline">DOWN</code> signals with exit reasons of one word size.</li><li><code class="inline">demonitor</code> signals from a terminating process.</li><li><code class="inline">unlink_ack</code> signals on OTP 23 and 24.</li><li><code class="inline">spawn_reply</code> signals on OTP 23 and 24.</li></ul><p>Own Id: OTP-17737 Aux Id: GH-5346, GH-4989</p></li></ul><h2 id="erts-10-7-2-14" class="section-heading"><a href="#erts-10-7-2-14" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.14</span></h2><h3 id="fixed-bugs-and-malfunctions-137" class="section-heading"><a href="#fixed-bugs-and-malfunctions-137" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>On 32-bit computers, <code class="inline">binary_to_term/1,2</code> is now more resilient against
corrupted binaries containing maps in the external format.</p><p>Own Id: OTP-17604</p></li><li><p>A call to <a href="erlang.html#process_info/2"><code class="inline">process_info(Pid, status)</code></a> could erroneously
report the status <code class="inline">running</code> when it should have reported <code class="inline">waiting</code>. This
occurred when the calling process was executing on a higher priority than the
process being inspected. This bug has been present since OTP 21.0 (erts
version 10.0).</p><p>Own Id: OTP-17628</p></li><li><p>A race between an exiting port and handling of simultaneously received signals
to that port could cause a runtime system crash. The effected signals are
<code class="inline">link</code>, <code class="inline">monitor</code> and <code class="inline">demonitor</code>. On OTP 22 a similar race could also cause a
memory leak when receiving an <code class="inline">unlink</code> signal.</p><p>Own Id: OTP-17642 Aux Id: PR-5248</p></li><li><p>The message queue of a process entered an inconsistent state after a <code class="inline">receive</code>
expression with an invalid timeout value was executed. If the exception raised
due to the invalid timeout value was caught, the following <code class="inline">receive</code>
expression executed by the process could fail to match messages already
present in the message queue.</p><p>On OTP 24 this could also cause the whole runtime system to crash.</p><p>Own Id: OTP-17651 Aux Id: GH-5235, PR-5244</p></li><li><p>Sending a <code class="inline">Port ! {PortOwner, close}</code> signal from a process other than the
port owner could erroneously trigger a <code class="inline">badsig</code> exit signal being sent to the
port owner process even though the correct <code class="inline">PortOwner</code> had been passed in the
signal.</p><p>Own Id: OTP-17665 Aux Id: PR-5248</p></li><li><p>This fixes a bug in <code class="inline">erts_factory_undo</code> that caused the heap to not be reset
correctly. The <code class="inline">erts_factory_undo</code> function is, for example, called when a
<a href="erlang.html#binary_to_term/1"><code class="inline">binary_to_term/1</code></a> call fails to reset the heap to its
state before the <a href="erlang.html#binary_to_term/1"><code class="inline">binary_to_term/1</code></a> call. This can cause
the heap to contain invalid terms which potentially can cause issues (e.g.,
crashes) when the whole heap is scanned.</p><p>Own Id: OTP-17677</p></li><li><p>Fix bug in <code class="inline">persistent_term</code> when a key-value pair contains a magic reference
that is referred more than once. Magic references are NIF resources or
returned from BIFs like <code class="inline">ets:new</code>, <code class="inline">atomics:new</code>. The bug could cause the
memory of the referred resource to be prematurely deallocated.</p><p>The bug also apply to magic references in message passing on a runtime built
with configure option <code class="inline">--enable-sharing-preserving</code>.</p><p>Bug exist for 64-bit since OTP-24.0 and for 32-bit since OTP-20.0.</p><p>Own Id: OTP-17700 Aux Id: GH-5271, PR-5273</p></li></ul><h2 id="erts-10-7-2-13" class="section-heading"><a href="#erts-10-7-2-13" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.13</span></h2><h3 id="fixed-bugs-and-malfunctions-138" class="section-heading"><a href="#fixed-bugs-and-malfunctions-138" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in <code class="inline">zlib</code> where decompression would crash with <code class="inline">data_error</code> on
some valid inputs. The bug could also cause extraction from a zip archive
using <code class="inline">zip:extract()</code> to fail.</p><p>Own Id: OTP-17470 Aux Id: ERIERL-657</p></li><li><p>A call to <code class="inline">erlang:cancel_timer(_, [{info, false}])</code> could cause the calling
process to block forever in the call. Note that only the synchronous version
of the call (that is, the <code class="inline">async</code> option is <code class="inline">false</code>) in combination with the
<code class="inline">info</code> option set to <code class="inline">false</code> was effected by this bug.</p><p>Own Id: OTP-17472 Aux Id: PR-4932</p></li><li><p>Microstate accounting (msacc) and <code class="inline">os:perf_counter()</code> unintentionally used
system time instead of monotonic time for time measurements on a lot of
systems. These systems were all non x86/x86_64 systems or x86/x86_64 systems
without a reliable and constant rdtsc instruction.</p><p>The lock counting (lcnt) built runtime system also unintentionally used system
time instead of monotonic time for time measurements on all systems.</p><p>Own Id: OTP-17493</p></li><li><p>Simultaneous calls to <code class="inline">erlang:system_flag(schedulers_online, _)</code> could cause
callers to end up in a suspended state forever.</p><p>Own Id: OTP-17500 Aux Id: GH-4809</p></li><li><p>Fix rare race bug in memory management of distribution entries. Have been seen
to cause VM crash when massive number of repeated concurrent failing
connection attempts.</p><p>Own Id: OTP-17513 Aux Id: GH-4964, PR-5015</p></li><li><p>Fix buffer overrun problem in the tty driver. The problem happens on some
platforms when using the CTRL+R functionality of newshell with very long
strings in the history.</p><p>Own Id: OTP-17560 Aux Id: GH-5116</p></li><li><p>Fix race-condition that could cause a crash when tracing scheduling or garbage
collections on a process that was running on a dirty scheduler.</p><p>Own Id: OTP-17568 Aux Id: PR-4940</p></li><li><p>Fix rare bug where re:run would crash/return invalid results when given a
subbinary as subject.</p><p>This bug has existed since Erlang/OTP 20.0.</p><p>Own Id: OTP-17585 Aux Id: GH-5150</p></li><li><p><code class="inline">binary_to_term/1,2</code> is now more resilient against corrupted binaries
containing maps in the external format.</p><p>Own Id: OTP-17594</p></li></ul><h2 id="erts-10-7-2-12" class="section-heading"><a href="#erts-10-7-2-12" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.12</span></h2><h3 id="fixed-bugs-and-malfunctions-139" class="section-heading"><a href="#fixed-bugs-and-malfunctions-139" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A call to <code class="inline">port_command()</code> could cause a scheduler to end up in an eternal
loop if the port was busy and the calling process had incoming signals at the
time of the call. This bug was introduced in OTP 23.3.2 (ERTS version 11.2.1),
OTP 22.3.4.18 (ERTS version 10.7.2.10), and OTP 21.3.8.23 (ERTS version
10.3.5.18).</p><p>Own Id: OTP-17448 Aux Id: GH-4898, PR-4903, OTP-17291</p></li></ul><h2 id="erts-10-7-2-11" class="section-heading"><a href="#erts-10-7-2-11" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.11</span></h2><h3 id="fixed-bugs-and-malfunctions-140" class="section-heading"><a href="#fixed-bugs-and-malfunctions-140" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix bug in match spec compilator seen to cause a stack overflow crash on debug
VM for certain match specs. Could potentially cause problems for standard VM,
but has not been verified. Match specs are used by <code class="inline">ets:match/select</code>
functions and <code class="inline">erlang:trace_pattern</code>.</p><p>Own Id: OTP-17379 Aux Id: PR-4804</p></li><li><p>Commit of generated <code class="inline">configure</code> script.</p><p>Own Id: OTP-17420 Aux Id: OTP-17398, GH-4821</p></li></ul><h2 id="erts-10-7-2-10" class="section-heading"><a href="#erts-10-7-2-10" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.10</span></h2><h3 id="fixed-bugs-and-malfunctions-141" class="section-heading"><a href="#fixed-bugs-and-malfunctions-141" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The following signals could pass before other signals from the same sender to
the same receiver. That is, these signals could arrive too early.</p><ul><li><code class="inline">garbage-collect</code> request. Sent from one process to another using one of the
<a href="erlang.html#garbage_collect/0"><code class="inline">garbage_collect/0</code></a> BIFs.</li><li><code class="inline">check-process-code</code> request. Sent from one process to another using one of
the <code class="inline">check_process_code()</code> BIFs.</li><li><code class="inline">is-process-alive</code> reply. Sent as a response to a process calling the
<code class="inline">is_process_alive()</code> BIF.</li><li><code class="inline">process-info</code> reply. Sent as a response to a process calling one of the
<code class="inline">process_info()</code> BIFs.</li><li><code class="inline">port-command</code> reply. Sent as a response to a process calling one of the
<code class="inline">port_command()</code> BIFs.</li><li><code class="inline">port-connect</code> reply. Sent as a response to a process calling the
<code class="inline">port_connect()</code> BIF.</li><li><code class="inline">port-close</code> reply. Sent as a response to a process calling the
<code class="inline">port_close()</code> BIF.</li><li><code class="inline">port-control</code> reply. Sent as a response to a process calling the
<code class="inline">port_control()</code> BIF.</li><li><code class="inline">port-call</code> reply. Sent as a response to a process calling the <code class="inline">port_call()</code>
BIF.</li><li><code class="inline">port-info</code> reply. Sent as a response to a process calling one of the
<code class="inline">port_info()</code> BIFs.</li></ul><p>Own Id: OTP-17291</p></li><li><p>A garbage collection of a literal area missed messages that entirely consisted
of a term in a literal area. This could in turn lead to a crash of the runtime
system.</p><p>Own Id: OTP-17307</p></li><li><p>A call to <a href="erlang.html#process_flag/2"><code class="inline">process_flag(message_queue_data, off_heap)</code></a>
could cause a crash of the runtime system when sequential tracing was enabled.</p><p>Own Id: OTP-17349</p></li></ul><h2 id="erts-10-7-2-9" class="section-heading"><a href="#erts-10-7-2-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.9</span></h2><h3 id="fixed-bugs-and-malfunctions-142" class="section-heading"><a href="#fixed-bugs-and-malfunctions-142" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in the timer implementation which could cause timers that were set
to more than 37.25 hours in the future to be delayed. This could occur if
there were multiple timers scheduled to be triggered very close in time, but
still at different times, and the scheduler thread handling the timers was not
able to handle them quickly enough. Delayed timers were in this case triggered
when another unrelated timer was triggered.</p><p>Own Id: OTP-17253</p></li><li><p>Fix bug in call_time tracing (used by eprof) that could cause VM crash. Bug
exists since OTP-22.2 (but not in OTP-23).</p><p>Own Id: OTP-17290 Aux Id: GH-4635</p></li></ul><h3 id="improvements-and-new-features-32" class="section-heading"><a href="#improvements-and-new-features-32" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Fix a file descriptor leak when using sendfile and the remote side closes the
connection. This bug has been present since OTP-21.0.</p><p>Own Id: OTP-17244</p></li></ul><h2 id="erts-10-7-2-8" class="section-heading"><a href="#erts-10-7-2-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.8</span></h2><h3 id="fixed-bugs-and-malfunctions-143" class="section-heading"><a href="#fixed-bugs-and-malfunctions-143" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug that could cause some work scheduled for execution on scheduler
threads to be delayed until other similar work appeared. Beside delaying
various cleanup of internal data structures also the following could be
delayed:</p><ul><li>Termination of a distribution controller process</li><li>Disabling of the distribution on a node</li><li>Gathering of memory allocator information using the <code class="inline">instrument</code> module</li><li>Enabling, disabling, and gathering of <code class="inline">msacc</code> information</li><li>Delivery of <code class="inline">'CHANGE'</code> messages when time offset is monitored</li><li>A call to <code class="inline">erlang:cancel_timer()</code></li><li>A call to <code class="inline">erlang:read_timer()</code></li><li><p>A call to <code class="inline">erlang:statistics(io | garbage_collection | scheduler_wall_time)</code></p></li><li>A call to <code class="inline">ets:all()</code></li><li>A call to <code class="inline">erlang:memory()</code></li><li><p>A call to <code class="inline">erlang:system_info({allocator | allocator_sizes, _})</code></p></li><li>A call to <code class="inline">erlang:trace_delivered()</code></li></ul><p>The bug existed on runtime systems running on all types of hardware except for
x86/x86_64.</p><p>Own Id: OTP-17185</p></li></ul><h2 id="erts-10-7-2-7" class="section-heading"><a href="#erts-10-7-2-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.7</span></h2><h3 id="fixed-bugs-and-malfunctions-144" class="section-heading"><a href="#fixed-bugs-and-malfunctions-144" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The <code class="inline">suspend_process()</code> and <code class="inline">resume_process()</code> BIFs did not check their
arguments properly which could cause an emulator crash.</p><p>Own Id: OTP-17080</p></li><li><p>The runtime system would get into an infinite loop if the runtime system was
started with more than 1023 file descriptors already open.</p><p>Own Id: OTP-17088 Aux Id: ERIERL-580</p></li></ul><h2 id="erts-10-7-2-6" class="section-heading"><a href="#erts-10-7-2-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.6</span></h2><h3 id="fixed-bugs-and-malfunctions-145" class="section-heading"><a href="#fixed-bugs-and-malfunctions-145" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed rare distribution bug in race between received signal
(link/monitor/spawn_request/spawn_reply) and disconnection. Symptom: VM crash.
Since: OTP 21.0.</p><p>Own Id: OTP-16869 Aux Id: ERL-1337</p></li></ul><h2 id="erts-10-7-2-5" class="section-heading"><a href="#erts-10-7-2-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.5</span></h2><h3 id="fixed-bugs-and-malfunctions-146" class="section-heading"><a href="#fixed-bugs-and-malfunctions-146" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bugs causing issues when enabling the ERTS internal allocators on a
system built with the undocumented and unsupported <code class="inline">SMALL_MEMORY</code> feature.</p><p>Own Id: OTP-16939</p></li></ul><h2 id="erts-10-7-2-4" class="section-heading"><a href="#erts-10-7-2-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.4</span></h2><h3 id="fixed-bugs-and-malfunctions-147" class="section-heading"><a href="#fixed-bugs-and-malfunctions-147" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>inet:setopts([{active,once}]) wakes up IO polling thread unnecessarily,
leading to lock contention and visibly higher CPU utilization.</p><p>Own Id: OTP-16847 Aux Id: ERL-1301</p></li><li><p>The documentation of <a href="erlang.html#statistics/1"><code class="inline">statistics(run_queue)</code></a> erroneously
stated that it returns the total length of all normal run queues when it is
the total length of all normal and dirty CPU run queues that is returned. The
documentation has been updated to reflect the actual behavior.</p><p>Own Id: OTP-16866 Aux Id: ERL-1355</p></li><li><p>Two bugs in the ERTS internal thread wakeup functionality have been fixed.
These bugs mainly hit when all threads in the system tried to go to sleep.
When the bugs were triggered, certain operations were delayed until a thread
woke up due to some other reason. Most important operations effected were code
loading, persistent term updates, and memory deallocation.</p><p>Own Id: OTP-16870</p></li><li><p>Fixed bug in <a href="../../apps/stdlib/ets.html#select_replace/2"><code class="inline">ets:select_replace/2</code></a> on <code class="inline">compressed</code> tables that could produce
faulty results or VM crash. Bug exists since OTP 20.</p><p>Own Id: OTP-16874 Aux Id: ERL-1356, PR-2763</p></li></ul><h3 id="improvements-and-new-features-33" class="section-heading"><a href="#improvements-and-new-features-33" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>As of OTP 22, the allocator specific memory carrier pools were replaced by a
node global carrier pool. This unfortunately caused substantial memory
fragmentation in some cases due to long lived data being spread into carriers
used by allocators mainly handling short lived data.</p><p>A new command line argument <code class="inline">+M&lt;S&gt;cp</code> has been introduced with which one can
enable the old behavior as well as configuring other behaviors for the carrier
pools. In order to configure the old behavior, with allocator specific carrier
pools for all allocators, pass <code class="inline">+Mucp :</code> (including the colon character) as a
command line argument to <code class="inline">erl</code> when starting the Erlang system.</p><p>The default configuration for carrier pools will be changed to <code class="inline">+Mucp :</code> some
time in the future, but not in this patch.</p><p>Own Id: OTP-16856</p></li></ul><h2 id="erts-10-7-2-3" class="section-heading"><a href="#erts-10-7-2-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.3</span></h2><h3 id="fixed-bugs-and-malfunctions-148" class="section-heading"><a href="#fixed-bugs-and-malfunctions-148" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The ERTS internal I/O poll implementation could get into an inconsistent state
causing input events to be ignored.</p><p>Own Id: OTP-16780 Aux Id: PR-2701</p></li></ul><h2 id="erts-10-7-2-2" class="section-heading"><a href="#erts-10-7-2-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.2</span></h2><h3 id="fixed-bugs-and-malfunctions-149" class="section-heading"><a href="#fixed-bugs-and-malfunctions-149" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>An unintentional reuse of an already used emulator internal event object could
cause a wakeup signal to a thread to be lost. In worst case this could cause
the runtime system to hang. This hang was however quite rare.</p><p>Own Id: OTP-16766 Aux Id: ERL-1304</p></li><li><p>NIF threads and driver threads on non-Linux systems leaked internal resources
when terminating. On Windows these resources were one event per thread. On
most other systems one mutex and one condition variable per thread. On these
other systems that also lacked <code class="inline">pthread_cond_timedwait()</code> also a pipe with its
file descriptors was leaked.</p><p>Own Id: OTP-16772 Aux Id: ERL-1304</p></li></ul><h2 id="erts-10-7-2-1" class="section-heading"><a href="#erts-10-7-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-150" class="section-heading"><a href="#fixed-bugs-and-malfunctions-150" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bug in erl_crash.dump generation that could cause a SEGV core dump if a
recently cancelled timer was found.</p><p>Own Id: OTP-16596 Aux Id: ERL-1105, PR-2606</p></li><li><p>The functionality utilized by BIFs for temporary disabling of garbage
collection while yielding could cause system task queues to become
inconsistent on a process executing such a BIF. Process system tasks are for
example utilized when purging code, garbage collecting literal data, and when
issuing an ordinary garbage collection from another process.</p><p>The bug does not trigger frequently. Multiple code purges in direct sequence
makes it more likely that this bug is triggered. In the cases observed, this
has resulted in a hanging code purge operation.</p><p>Own Id: OTP-16639 Aux Id: ERL-1236</p></li><li><p>SCTP and UDP recv/2,3 hangs indefinitely if socket is closed while recv is
called (socket in passive mode).</p><p>Own Id: OTP-16654 Aux Id: ERL-1242</p></li></ul><h2 id="erts-10-7-2" class="section-heading"><a href="#erts-10-7-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.2</span></h2><h3 id="fixed-bugs-and-malfunctions-151" class="section-heading"><a href="#fixed-bugs-and-malfunctions-151" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A literal area could prematurely be released before all uses of it had been
removed. This occurred either when a terminating process had a complex exit
reason referring to a literal that concurrently was removed, or when a
terminating process continued executing a dirty NIF accessing a literal (via
the heap) that concurrently was removed.</p><p>Own Id: OTP-16640 Aux Id: OTP-16193</p></li><li><p>The VM could potentially crash when checking process code of a process that
terminated while executing a dirty NIF. The checking of process code is part
of a code purge operation.</p><p>Own Id: OTP-16641</p></li><li><p>System tasks of <code class="inline">low</code> priority were not interleaved with <code class="inline">normal</code> priority
system tasks as they should. This could potentially delay garbage collection
of another process longer than intended if the garbage collection was
requested from a <code class="inline">low</code> priority process.</p><p>Own Id: OTP-16642</p></li></ul><h2 id="erts-10-7-1" class="section-heading"><a href="#erts-10-7-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7.1</span></h2><h3 id="fixed-bugs-and-malfunctions-152" class="section-heading"><a href="#fixed-bugs-and-malfunctions-152" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>[re:run(Subject, RE, [unicode])](<a href="../../apps/stdlib/re.html#run/3"><code class="inline">re:run/3</code></a>) returned <code class="inline">nomatch</code> instead of
failing with a <code class="inline">badarg</code> error exception when <code class="inline">Subject</code> contained illegal utf8
and <code class="inline">RE</code> was passed as a binary. This has been corrected along with
corrections of reduction counting in <code class="inline">re:run()</code> error cases.</p><p>Own Id: OTP-16553</p></li><li><p>Fixed a bug that could cause the emulator to crash when purging modules or
persistent terms.</p><p>Own Id: OTP-16555 Aux Id: ERL-1188</p></li><li><p>Fixed a bug in a receive optimization. This could cause a <code class="inline">receive</code> not to
match even though a matching message was present in the message queue. This
bug was introduced in ERTS version 10.6 (OTP 22.2).</p><p>Own Id: OTP-16572 Aux Id: ERL-1199, OTP-16269</p></li></ul><h2 id="erts-10-7" class="section-heading"><a href="#erts-10-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.7</span></h2><h3 id="fixed-bugs-and-malfunctions-153" class="section-heading"><a href="#fixed-bugs-and-malfunctions-153" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><code class="inline">gen_udp:recv(S, N, 0)</code> corrupted the internal state for the socket so after
receive with <code class="inline">{active, once}</code> it always returned <code class="inline">{error, timeout}</code>, and
wasted the received UDP packets. This bug has now been fixed.</p><p>Reported and pinpointed by Alexander Petrovsky.</p><p>Own Id: OTP-16059</p></li><li><p>The atom esock_atom_user and esock_atom_kernel was never actually created.
This has now been corrected.</p><p>Own Id: OTP-16381</p></li><li><p>Fixed bug in <code class="inline">socket</code> module that could potentially lead to scheduler
deadlocks.</p><p>Own Id: OTP-16384</p></li><li><p>Fix bug causing VM crash if <code class="inline">down</code> or <code class="inline">stop</code> callback of a NIF resource is
called after the NIF module has been purged. The fix will postpone unloading
until all such resource objects have been garbage collected.</p><p>Own Id: OTP-16399</p></li><li><p>Fixed bug in <a href="../../apps/stdlib/ets.html#update_counter/4"><code class="inline">ets:update_counter/4</code></a>, when called with an invalid <code class="inline">UpdateOp</code>
and a <code class="inline">Key</code> that does not exist, causing <code class="inline">ets:info(T,size)</code> to return
incorrect values. Bug exists since OTP-19.0.2.</p><p>Own Id: OTP-16404 Aux Id: ERL-1127</p></li><li><p>Fix potential heap corrupting bugs when a process calls a BIF that blocks
other normal schedulers and then writes to its own heap without the main
process lock. A NIF running on a dirty scheduler trying to interact with such
a process could corrupt its heap. The fixed BIFs were related to code loading
and tracing.</p><p>Own Id: OTP-16417</p></li><li><p>Fixed bug in <a href="erlang.html#list_to_ref/1"><code class="inline">erlang:list_to_ref/1</code></a> when called with a reference created by a
remote note. Function <a href="erlang.html#list_to_ref/1"><code class="inline">list_to_ref/1</code></a> is intended for
debugging and not to be used in application programs. Bug exist since OTP
20.0.</p><p>Own Id: OTP-16438</p></li><li><p>The prim_net nif (net/kernel) made use of an undefined atom, notsup. This has
now been corrected.</p><p>Own Id: OTP-16440</p></li><li><p>Corrected the valid range of the <code class="inline">erl</code> command line argument
<a href="erl_cmd.html#%2BSDio"><code class="inline">+SDio &lt;NumberOfDirtyIoSchedulers&gt;</code></a> from <code class="inline">0..1024</code> to
<code class="inline">1..1024</code>. <code class="inline">+SDio 0</code> was erroneously allowed which just caused the VM to crash
on the first dirty I/O job scheduled.</p><p>Own Id: OTP-16481</p></li><li><p>Fix a crash when attempting to log faults when loading files during early
boot.</p><p>Own Id: OTP-16491</p></li></ul><h3 id="improvements-and-new-features-34" class="section-heading"><a href="#improvements-and-new-features-34" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>For <a href="../../apps/kernel/socket.html#">socket</a>, not all send and receive flags are supported on all
platforms. In order to (at least) simplify testing, the
socket:supports/0,1,2,3 functions has been extended with send_flags and
recv_flags items, which indicates what the current platform can manage.</p><p>Own Id: OTP-16153</p></li><li><p>Add a &quot;full featured&quot; version of getifaddrs in the net module.</p><p>Own Id: OTP-16212 Aux Id: ERL-1070</p></li><li><p>The options <code class="inline">busy_limits_port</code> and <code class="inline">busy_limits_msgq</code> have been added to the
BIF <a href="erlang.html#open_port/2"><code class="inline">erlang:open_port/2</code></a>. The <code class="inline">busy_limits_port</code> option can be used for
controlling the busy state of a port executing the <code class="inline">spawn_driver</code> or the
<code class="inline">fd_driver</code>. The <code class="inline">busy_limits_msgq</code> option can be used for controlling the
busy state of the port message queue.</p><p>Own Id: OTP-16306 Aux Id: ERIERL-439</p></li><li><p>A socket &quot;registry&quot; has been added making it possible to list current open
sockets.</p><p>Own Id: OTP-16309</p></li><li><p>The counters managed by the socket nif has been extended. Their &quot;size&quot; has
been increased from 32 bit to 64. Two max package size (for read and write)
has been added. And four accept counters has been added.</p><p>Own Id: OTP-16387</p></li><li><p>Add gcc option <code class="inline">-fno-common</code> to detect accidental name clashes of global
variables.</p><p>Own Id: OTP-16420 Aux Id: PR-2513</p></li><li><p>New dynamic lock checker that verifies locking orders and detects potential
deadlock bugs in drivers and NIFs. Enabled together with the old static lock
checker (for ERTS internal locks) in emulator started with <code class="inline">-emu_type debug</code>
or built with configuration option <code class="inline">--enable-lock-checking</code>.</p><p>Own Id: OTP-16427</p></li></ul><h2 id="erts-10-6-4" class="section-heading"><a href="#erts-10-6-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.6.4</span></h2><h3 id="fixed-bugs-and-malfunctions-154" class="section-heading"><a href="#fixed-bugs-and-malfunctions-154" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A process could get into an inconsistent state where it was runnable, but
never scheduled for execution. This could occur when a mix of <code class="inline">normal</code> and
<code class="inline">low</code> priority processes where scheduled on the same type of dirty scheduler
simultaneously.</p><p>Own Id: OTP-16446 Aux Id: ERL-1157</p></li></ul><h2 id="erts-10-6-3" class="section-heading"><a href="#erts-10-6-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.6.3</span></h2><h3 id="fixed-bugs-and-malfunctions-155" class="section-heading"><a href="#fixed-bugs-and-malfunctions-155" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A process could end up in a state where it got endlessly rescheduled without
making any progress. This occurred when a system task, such as check of
process code (part of a code purge), was scheduled on a high priority process
trying to execute on a dirty scheduler.</p><p>Own Id: OTP-16436 Aux Id: ERL-1152</p></li></ul><h3 id="improvements-and-new-features-35" class="section-heading"><a href="#improvements-and-new-features-35" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Improved signal handling for processes executing dirty. For example, avoid
busy wait in dirty signal handler process when process is doing garbage
collection on dirty scheduler.</p><p>Own Id: OTP-16358</p></li></ul><h2 id="erts-10-6-2" class="section-heading"><a href="#erts-10-6-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.6.2</span></h2><h3 id="fixed-bugs-and-malfunctions-156" class="section-heading"><a href="#fixed-bugs-and-malfunctions-156" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Taking a scheduler offline could cause timers set while executing on that
scheduler to be delayed until the scheduler was put online again. This bug was
introduced in ERTS version 10.0 (OTP 21.0).</p><p>Own Id: OTP-16371</p></li><li><p>The <a href="../../apps/stdlib/ets.html#update_counter/4"><code class="inline">ets:update_counter/4</code></a> core dumped when given an ordered_set with
write_concurrency enabled and an invalid position. This bug has been fixed.</p><p>Own Id: OTP-16378 Aux Id: ERL-1125</p></li><li><p>A process calling
<a href="erlang.html#system_flag_multi_scheduling"><code class="inline">erlang:system_flag(multi_scheduling, block)</code></a>
could end up blocked waiting for the operation to complete indefinitely.</p><p>Own Id: OTP-16379</p></li></ul><h3 id="improvements-and-new-features-36" class="section-heading"><a href="#improvements-and-new-features-36" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Duplicate entries for [socket:]getopt and [socket:]setopt in man page.</p><p>Own Id: OTP-16333 Aux Id: ERL-1104</p></li></ul><h2 id="erts-10-6-1" class="section-heading"><a href="#erts-10-6-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.6.1</span></h2><h3 id="fixed-bugs-and-malfunctions-157" class="section-heading"><a href="#fixed-bugs-and-malfunctions-157" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Corrected an issue with the new socket api which could cause a core dump. A
race during socket close could cause a core dump (an invalid nif environment
free).</p><p>Own Id: OTP-16314 Aux Id: ERL-1098</p></li><li><p>Corrected an issue with the new socket api which could cause a core dump. When
multiple accept processes waiting for a connect a connect could cause a core
dump.</p><p>Own Id: OTP-16359</p></li></ul><h2 id="erts-10-6" class="section-heading"><a href="#erts-10-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.6</span></h2><h3 id="fixed-bugs-and-malfunctions-158" class="section-heading"><a href="#fixed-bugs-and-malfunctions-158" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The functions <a href="../../apps/stdlib/unicode.html#characters_to_list/2"><code class="inline">unicode:characters_to_list()</code></a>
and <a href="../../apps/stdlib/unicode.html#characters_to_binary/3"><code class="inline">unicode:characters_to_binary()</code></a>
raised a <code class="inline">badarg</code> exception instead of returning an error tuple when passed
very large invalid code points as input.</p><p>Own Id: OTP-16052</p></li><li><p><a href="../../apps/kernel/file.html#allocate/3"><code class="inline">file:allocate/3</code></a> will now work properly on Mac OS.</p><p>Own Id: OTP-16074 Aux Id: ERL-1042, PR-2386</p></li><li><p>For <a href="../../apps/kernel/socket.html#">socket</a>, invalid encoding of send and receive flags caused
badarg and send failure.</p><p>Own Id: OTP-16149</p></li><li><p>Fix a bug in <code class="inline">re</code> on platforms where the native stack grows upwards, for
instance on HP PA-RISC.</p><p>Own Id: OTP-16150 Aux Id: ERL-1043</p></li><li><p>For <a href="../../apps/kernel/socket.html#">socket</a>, unable to properly decode the timestamp control
message header on FreeBSD. We incorrectly used the SO_TIMESTAMP flag for the
timestamp control message header type. It should have been SCM_TIMESTAMP. This
caused the timestamp control message header to not be fully decoded.</p><p>Own Id: OTP-16151 Aux Id: #2400</p></li><li><p>For <a href="../../apps/kernel/socket.html#">socket</a>, when setting the ip option 'recvtos' to true,
thereby indicating that we want to receive the TOS control message header, we
don't actually get TOS but RECVTOS on FreeBSD (and maybe others)! This was
previously not handled.</p><p>Own Id: OTP-16152 Aux Id: OTP-16114</p></li><li><p>Fixed a bug where the emulator would print out error messages forever if it
crashed during startup.</p><p>Own Id: OTP-16159 Aux Id: ERL-1060</p></li><li><p>For <a href="../../apps/kernel/socket.html#">socket</a>, wrong type for protocol caused segmentation fault
if protocol was provided as {raw, integer()}.</p><p>Own Id: OTP-16163 Aux Id: ERL-1061</p></li><li><p>For <a href="../../apps/kernel/socket.html#">socket</a>, when setting the ip option 'recvttl' to true,
thereby indicating that we want to receive the TTL control message header, we
don't actually get TTL but RECVTTL on Solaris (and maybe others)! This was
previously not handled.</p><p>Own Id: OTP-16172 Aux Id: OTP-16114</p></li><li><p>For <a href="../../apps/kernel/socket.html#">socket</a>, IPv6 control message headers was incorrectly
decoded with level ip instead of ipv6.</p><p>Own Id: OTP-16173</p></li><li><p>Fix configure bug where <code class="inline">clock_getres</code> would not correctly be detected causing
<code class="inline">erlang:system_info(os_system_time_source)</code> to return an incorrect resolution.</p><p>This bug effects all OSs that use <code class="inline">clock_gettime</code> to get time (basically all
OSs except windows) and has been present since OTP-19.2.</p><p>Own Id: OTP-16191 Aux Id: ERL-1067</p></li><li><p>Fix bugs when using <code class="inline">ERLC_USE_SERVER=true</code> on Windows when building
Erlang/OTP.</p><p>Change the cookie used by the compile server to be hard coded instead of using
the users cookie.</p><p>Own Id: OTP-16192</p></li><li><p>Fix so that <code class="inline">persistent_term</code> is listed in the erts application file.</p><p>Own Id: OTP-16194</p></li><li><p>Fix bug in call_time tracing which could sometimes cause call time
measurements being attributed to the wrong function.</p><p>Own Id: OTP-16195 Aux Id: ERL-1027</p></li><li><p>The <a href="../../apps/kernel/socket.html#">socket</a> socket option 'peek_off' has been disabled. If
peek_off was set and then socket:recv/3 was called with the peek flag, the
call could hang.</p><p>Own Id: OTP-16196</p></li><li><p>Handle possibly uninitiated (control message header) data.</p><p>Own Id: OTP-16197</p></li><li><p>For <a href="../../apps/kernel/net.html#">net</a>, a couple of NI macros was deprecated in new versions of
glibc, so these are no longer used (IDN_ALLOW_UNASSIGNED and
IDN_USE_STD3_ASCII_RULES).</p><p>Own Id: OTP-16203</p></li><li><p>The string value from a get operation needed to be truncated.</p><p>Own Id: OTP-16204</p></li><li><p>Fix misleading seq_trace message for remote send operation toward named
process. Changed receiver to be <code class="inline">{Name,Node}</code> instead of just <code class="inline">Name</code>.</p><p>Own Id: OTP-16206 Aux Id: PR-2423</p></li><li><p>Fixed a bug causing actual nodedown reason reported by
<a href="../../apps/kernel/net_kernel.html#monitor_nodes/2"><code class="inline">net_kernel:monitor_nodes(true, [nodedown_reason])</code></a>
to be lost and replaced by the reason <code class="inline">killed</code>.</p><p>Own Id: OTP-16216</p></li><li><p>For <a href="../../apps/kernel/socket.html#">socket</a>, the timestamp creation used when printing warning
messages and debug printouts did not work. The used buffer was too small.</p><p>Own Id: OTP-16223</p></li><li><p>Fix compiler warnings generated by GCC 8</p><p>Own Id: OTP-16235</p></li><li><p>Fix <code class="inline">erl -emu_type</code> to accept the option <code class="inline">opt</code> which means the normal
optimized emulator. This can be used to override the <code class="inline">-emu_type</code> option from
environment variables.</p><p>Own Id: OTP-16297</p></li><li><p>Corrected the function spec to reflect the actual code of the function
socket:bind.</p><p>Own Id: OTP-16310 Aux Id: ERL-1082</p></li><li><p>Fixed a performance issue in ETS lookup when using the <code class="inline">compressed</code> option and
the term contained atoms. Before this fix the decompress algorithm for atoms
would unnecessarily take a global lock to validate the atom.</p><p>Own Id: OTP-16316</p></li></ul><h3 id="improvements-and-new-features-37" class="section-heading"><a href="#improvements-and-new-features-37" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>For <a href="../../apps/kernel/socket.html#">socket</a>, not all send and receive flags are supported on all
platforms. In order to (at least) simplify testing, the
socket:supports/0,1,2,3 functions has been extended with send_flags and
recv_flags items, which indicates what the current platform can manage.</p><p>Own Id: OTP-16153</p></li><li><p>For <a href="../../apps/kernel/socket.html#">socket</a>, add support for IPv6 socket options tclass and
recvtclass. Both has been added, but the use of them are platform dependent.
Call socket:supports(options, ipv6, Opt) to be sure what option to use in
order to request a TCLASS control message header.</p><p>Own Id: OTP-16180</p></li><li><p>For <a href="../../apps/kernel/socket.html#">socket</a>, the TCP socket option cork was not supported even
though the supports function reported it as such.</p><p>Own Id: OTP-16205</p></li><li><p>The Kernel application's User's Guide now contain a Logger Cookbook with
common usage patterns.</p><p>Own Id: OTP-16208</p></li><li><p>Add a &quot;full featured&quot; version of getifaddrs in the net module.</p><p>Own Id: OTP-16212 Aux Id: ERL-1070</p></li><li><p>Fix an inefficiency introduced by the bug fix in OTP-16241 which fixed a
problem with the receive optimization. That bug fix introduced an inefficiency
when using the receive optimization and a burst of messages arrive at once
when the receiving process' mailbox was empty.</p><p>Own Id: OTP-16269 Aux Id: OTP-16241</p></li><li><p>For <a href="../../apps/kernel/socket.html#">socket</a>, added support for the socket option extended_err.
Andreas Schultz.</p><p>Own Id: OTP-16302 Aux Id: #2449</p></li><li><p>ETS tables have been optimized to not use any locks when running in a system
with only one scheduler enabled. This can provide significant performance
gains for applications that use ETS tables heavily.</p><p>Own Id: OTP-16315</p></li></ul><h2 id="erts-10-5-6" class="section-heading"><a href="#erts-10-5-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.5.6</span></h2><h3 id="fixed-bugs-and-malfunctions-159" class="section-heading"><a href="#fixed-bugs-and-malfunctions-159" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Large amounts of quickly executed dirty work could cause heavy contention on
an internal spin lock. The spin lock was replaced by a mutex which behaves
much better under these conditions.</p><p>Own Id: OTP-16301 Aux Id: ERL-1079</p></li></ul><h2 id="erts-10-5-5" class="section-heading"><a href="#erts-10-5-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.5.5</span></h2><h3 id="fixed-bugs-and-malfunctions-160" class="section-heading"><a href="#fixed-bugs-and-malfunctions-160" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A literal area could prematurely be released before all uses of it had been
removed. This occurred either when a terminating process had a complex exit
reason referring to a literal that concurrently was removed, or when a
terminating process continued executing a dirty NIF accessing a literal (via
the heap) that concurrently was removed.</p><p>Own Id: OTP-16193</p></li><li><p>Fix bug causing VM crash due to memory corruption of distribution entry.
Probability of crash increases if Erlang distribution is frequently
disconnected and reestablished towards same node names. Bug exists since
OTP-21.0.</p><p>Own Id: OTP-16224 Aux Id: ERL-1044</p></li><li><p>Fixed bug causing crash of VM built with configuration
<code class="inline">--enable--sharing-preserving</code>. Provoked when a sent message contains both a
bit string and the heap binary (&lt; 65 bytes) which the bit string was matched
from. Bug exists since OTP-19.0 but has seen to be easier to provoke since
OTP-22.1.</p><p>Own Id: OTP-16265 Aux Id: ERL-1064</p></li></ul><h2 id="erts-10-5-4" class="section-heading"><a href="#erts-10-5-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.5.4</span></h2><h3 id="fixed-bugs-and-malfunctions-161" class="section-heading"><a href="#fixed-bugs-and-malfunctions-161" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler could do an unsafe optimization of receives, which would cause a
receive to only scan part of the message queue.</p><p>This bug fix in the compiler fixes a bug in the socket module.</p><p>Own Id: OTP-16219 Aux Id: ERL-1076</p></li><li><p>Fix bug where the receive marker used by the runtime to do the receive queue
optimization could be incorrectly set. The symptom of this would be that a
message that should match in a receive never matches.</p><p>The bug requires the OTP-22 compiler and multiple selective receives to
trigger. See OTP-16219 for details about the bug fix in the compiler.</p><p>Own Id: OTP-16241 Aux Id: ERL-1076 OTP-16219</p></li></ul><h2 id="erts-10-5-3" class="section-heading"><a href="#erts-10-5-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.5.3</span></h2><h3 id="fixed-bugs-and-malfunctions-162" class="section-heading"><a href="#fixed-bugs-and-malfunctions-162" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Erlang/OTP can now be built on macOS Catalina (10.15).</p><p>Own Id: OTP-16177 Aux Id: ERL-1063</p></li></ul><h2 id="erts-10-5-2" class="section-heading"><a href="#erts-10-5-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.5.2</span></h2><h3 id="improvements-and-new-features-38" class="section-heading"><a href="#improvements-and-new-features-38" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Added the environment variable <code class="inline">ERLC_SERVER_ID</code>, which allows multiple compile
servers to run separately under the same user.</p><p>Own Id: OTP-16125 Aux Id: ERIERL-412</p></li></ul><h2 id="erts-10-5-1" class="section-heading"><a href="#erts-10-5-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.5.1</span></h2><h3 id="fixed-bugs-and-malfunctions-163" class="section-heading"><a href="#fixed-bugs-and-malfunctions-163" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A terminating process sending distributed <code class="inline">'EXIT'</code> or <code class="inline">'DOWN'</code> signals while
terminating could end up in a state where no progress at all was made. This
was triggered by a distribution channel that the terminating process was
sending on got busy. This bug has existed since ERTS version 10.4 (OTP 22.0).</p><p>Own Id: OTP-16069</p></li><li><p>When communicating with a simultaneously exiting port via the
<code class="inline">erlang:port_*()</code> BIFs one could sometimes get stray <code class="inline">{Ref, What}</code> messages.
Where <code class="inline">Ref</code> was a reference and <code class="inline">What</code> usually were the atom <code class="inline">badarg</code>.</p><p>Own Id: OTP-16107 Aux Id: ERL-1049</p></li></ul><h2 id="erts-10-5" class="section-heading"><a href="#erts-10-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.5</span></h2><h3 id="fixed-bugs-and-malfunctions-164" class="section-heading"><a href="#fixed-bugs-and-malfunctions-164" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>If you set <code class="inline">{linger,{true,0}}</code> on a <code class="inline">gen_tcp</code> listen socket, accept a
connection on that socket, and then close the accepted socket, now the linger
zero setting is transferred to the accepted socket. Before this correction
that information was lost and the close behaviour on the accepted socket
incorrect.</p><p>Own Id: OTP-15370 Aux Id: ERIERL-353</p></li><li><p>Sending ancillary data implemented in OTP-15747 accidentally left behind test
code that caused all UDP sends to fail on Windows. This has now been fixed.</p><p>Own Id: OTP-15422 Aux Id: OTP-15747</p></li><li><p>In the socket nif, used invalid flags when if-def'ing for supported TCP flags:
TCP_MAXSEG and TCP_NODELAY (the support function).</p><p>Own Id: OTP-15827</p></li><li><p>Fixed memory leaks in experimental socket module.</p><p>Own Id: OTP-15830</p></li><li><p><code class="inline">re:run()</code> now yields when validating utf8 in a large subject.</p><p>Own Id: OTP-15836 Aux Id: ERL-876</p></li><li><p>Fixed bug in <code class="inline">seq_trace:set_token(label,Term)</code> which could cause VM crash if
<code class="inline">Term</code> was heap allocated (not an atom, small integer, local pid or port). Bug
exists since OTP 21.0 when terms other than small integers were first allowed
as labels.</p><p>Own Id: OTP-15849 Aux Id: ERL-700</p></li><li><p>Extra <code class="inline">-mode</code> flags given to <code class="inline">erl</code> are ignored with a warning.</p><p>Own Id: OTP-15852</p></li><li><p>Don't loop indefinitely when <code class="inline">--enable-pgo</code> is given to configure, but
compiler does not support pgo.</p><p>Own Id: OTP-15853 Aux Id: PR-2254</p></li><li><p>Fix <a href="../../apps/kernel/seq_trace.html#print/2"><code class="inline">seq_trace:print/2</code></a> not to raise <code class="inline">badarg</code> exception if label is not a
small integer. Bug exists since OTP 21.0.</p><p>Own Id: OTP-15859 Aux Id: ERL-700</p></li><li><p>Fixed hipe_flush_icache_range for non-Linux OS on ARM.</p><p>Own Id: OTP-15874 Aux Id: ERL-958, PR-2266</p></li><li><p>The fix in OTP-15871 was too conservative and disabled the offending load-time
optimization in some cases where it was safe.</p><p>Own Id: OTP-15881</p></li><li><p>Upgraded the ERTS internal PCRE library from version 8.42 to version 8.43. See
<a href="http://pcre.org/original/changelog.txt">http://pcre.org/original/changelog.txt</a>
for information about changes made to PCRE. This library implements major
parts of the <a href="../../apps/stdlib/re.html"><code class="inline">re</code></a> regular expressions module.</p><p>Own Id: OTP-15889</p></li><li><p>Fix race condition when closing a socket while using <code class="inline">{active,N}</code> on Windows.</p><p>Own Id: OTP-15901 Aux Id: ERL-960 PR-2272</p></li><li><p>Allow more than one <code class="inline">-config</code> command line option to <code class="inline">erl</code> on Windows to
conform with other OS.</p><p>Own Id: OTP-15918 Aux Id: ERL-912</p></li><li><p>Fix so that ERL_FLAGS environment variable does not interfere with command
line arguments. Before this fix you could write:</p><p><code class="inline">ERL_FLAGS=&quot;10&quot; erl +S</code></p><p>and erlang would start as if <code class="inline">+S</code> had been given the argument <code class="inline">10</code>.</p><p>Own Id: OTP-15931</p></li><li><p>The bug with ID ERL-717 has been fixed. The functions <code class="inline">io:columns()</code> and
<code class="inline">io:rows()</code> only worked correctly inside interactive erlang shells before this
fix. These functions returned <code class="inline">{error,enotsup}</code> before this fix even if stdout
and stdin were connected to a terminal when they were invoked from an escript
or a program started with e.g., <code class="inline">erl -noshell</code>.</p><p>Own Id: OTP-15959 Aux Id: ERL-717</p></li><li><p>Do not use named label in <code class="inline">ethread.c</code> inline assemble. This allows erts to be
compiled using gcc 9.1.0 with LTO enabled.</p><p>Own Id: OTP-15971 Aux Id: PR-2333</p></li><li><p><a href="erlang.html#fun_to_list/1"><code class="inline">erlang:fun_to_list/1</code></a> will now escape the module and function name when
necessary.</p><p>Own Id: OTP-15975 Aux Id: ERL-1009</p></li><li><p><a href="erlang.html#process_info/2"><code class="inline">process_info(P,binary)</code></a> would neglect to look through
heap fragments, potentially missing a few binaries associated with the
process.</p><p>Own Id: OTP-15978 Aux Id: ERIERL-366</p></li><li><p>HiPE is now automatically disabled on systems with non-glibc implementation
(for instance musl). This is because musl does not provide the API's for
guaranteeing that signals are delivered on the correct native stack.</p><p>Own Id: OTP-16037</p></li><li><p>Fixed bug triggered if a process is killed during call to
<code class="inline">persistent_term:put</code> or <code class="inline">persistent_term:erase</code>.</p><p>Own Id: OTP-16041</p></li><li><p>Add units to all memory slogans in the crash dump documentation.</p><p>Own Id: OTP-16042</p></li><li><p>Fix a bug in <code class="inline">binary_to_term</code> that would crash the emulator if a term larger
than 16GB was to be decoded.</p><p>Own Id: OTP-16058 Aux Id: PR-2382</p></li><li><p>Fixed bug related to an exiting process sending EXIT and DOWN signals to
remote linked/monitored processes. Bugs exists since OTP 22.0.</p><p>Own Id: OTP-16060</p></li></ul><h3 id="improvements-and-new-features-39" class="section-heading"><a href="#improvements-and-new-features-39" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p><code class="inline">erlc</code> can now automatically use a compile server to avoid starting an Erlang
system for each file to be compiled in a multi-file project. See the
documentation for how to enable it.</p><p>Own Id: OTP-15738 Aux Id: PR-2361</p></li><li><p>The possibility to send ancillary data, in particular the TOS field, has been
added to <code class="inline">gen_udp:send/4,5</code>.</p><p>Own Id: OTP-15747 Aux Id: ERIERL-294</p></li><li><p>The net module has been split into 'net' (kernel) and prim_net (preloaded).</p><p>Own Id: OTP-15765</p></li><li><p>Socket counters now works as expected and can also be extracted with the (new)
info function.</p><p>Own Id: OTP-15818</p></li><li><p><code class="inline">re:run()</code> now avoids validating utf8 in the subject more than once in the
same call. This validation could previously be performed multiple times when
the <code class="inline">global</code> option was passed.</p><p>Own Id: OTP-15831 Aux Id: ERL-876</p></li><li><p>The un-documented function <code class="inline">erlang:dist_get_stat/1</code> now returns the real value
of what the distribution queue contains instead of a boolean.</p><p>Own Id: OTP-15905 Aux Id: PR-2270</p></li><li><p>ETS <code class="inline">ordered_set</code> tables with <code class="inline">write_concurrency</code> enabled has got a
performance issue fixed. There were no limits for the values of internal
statistics counters before this fix. This could result in that the data
structure sometimes reacted slowly to a change in how many parallel processes
were using it.</p><p>Own Id: OTP-15906</p></li><li><p>Optimize the reception of large distribution messages.</p><p>Own Id: OTP-15926 Aux Id: PR-2291</p></li><li><p>Binary matching and functions like <a href="erlang.html#split_binary/2"><code class="inline">split_binary/2</code></a> will
now create heap binaries when the results are small enough, reducing the
chances of small sub-binaries keeping large binaries alive.</p><p>Own Id: OTP-15977 Aux Id: ERIERL-366</p></li><li><p>Fixed rare emulator crash in <code class="inline">instrument:allocations/0-1</code>.</p><p>Own Id: OTP-15983</p></li><li><p>Ports could pass very small binaries as reference counted off heap binaries to
processes. This could cause an unnecessary large memory usage and an
unnecessary load on the binary allocator. Small binaries are now always passed
as heap binaries to processes.</p><p>Own Id: OTP-16001 Aux Id: ERIERL-366</p></li><li><p><code class="inline">unicode:characters_to_binary()</code> could return very small binaries as reference
counted off heap binaries. This could cause an unnecessary large memory usage
and an unnecessary load on the binary allocator. Small binaries are now always
returned as heap binaries.</p><p>Own Id: OTP-16002 Aux Id: ERIERL-366</p></li><li><p>Improved <code class="inline">erl_nif</code> documentation regarding <code class="inline">on_load</code> and Erlang stub/fallback
functions.</p><p>Own Id: OTP-16028 Aux Id: PR-2362</p></li><li><p>New feature <code class="inline">ets:info(_, binary)</code> to get information about all reference
counted binaries kept by a table. This is the same kind of debug information
that <a href="erlang.html#process_info/2"><code class="inline">process_info(_, binary)</code></a> returns for a process.</p><p>Own Id: OTP-16035 Aux Id: ERIERL-366</p></li></ul><h2 id="erts-10-4-4" class="section-heading"><a href="#erts-10-4-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.4.4</span></h2><h3 id="fixed-bugs-and-malfunctions-165" class="section-heading"><a href="#fixed-bugs-and-malfunctions-165" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>An invalid value test caused the socket:setopt(Socket, ip, add_membership,
ip_mreq()) to fail with badarg. The same for drop_membership.</p><p>Own Id: OTP-15908 Aux Id: ERL-980</p></li><li><p>Fixed bug causing VM crash when doing textual dump of a process containing an
unhandled monitor down signal. Textual process dumps can be done with
<code class="inline">erlang:system_info(procs)</code>, trace feature <code class="inline">process_dump</code>, Erlang shell break
menu and a crashdump. Bug exist since OTP 21.0.</p><p>Own Id: OTP-15909 Aux Id: ERL-979</p></li><li><p><a href="../../apps/stdlib/lists.html#subtract/2"><code class="inline">lists:subtract/2</code></a> would produce incorrect results for some inputs on 64-bit
platforms.</p><p>Own Id: OTP-15938 Aux Id: ERL-986</p></li><li><p>Fixed a bug in the loader that was similar to <code class="inline">OTP-15938</code>, yielding incorrect
code for some inputs on 64-bit platforms.</p><p>Own Id: OTP-15939</p></li><li><p>Fixed bug causing scheduler threads in rare cases to block spinnning
indefinitely. Bug exists since OTP 21.0.</p><p>Own Id: OTP-15941 Aux Id: PR-2313</p></li></ul><h2 id="erts-10-4-3" class="section-heading"><a href="#erts-10-4-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.4.3</span></h2><h3 id="fixed-bugs-and-malfunctions-166" class="section-heading"><a href="#fixed-bugs-and-malfunctions-166" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a buffer overflow when
<a href="erlang.html#binary_to_existing_atom/2"><code class="inline">binary_to_existing_atom/2</code></a> and
<code class="inline">list_to_existing_atom/2</code> was used with the <code class="inline">latin1</code> encoding.</p><p>Own Id: OTP-15819 Aux Id: ERL-944</p></li><li><p>The runtime system disconnected a connection if it received an
<a href="erlang.html#exit/2"><code class="inline">exit/2</code></a> signal where the recipient was a process on an old
incarnation of the current node. That is, the receiving node had the same node
name, but another &quot;creation&quot; number. The signal will now just be dropped since
the receiving process no longer exists.</p><p>Own Id: OTP-15867 Aux Id: ERIERL-373</p></li></ul><h2 id="erts-10-4-2" class="section-heading"><a href="#erts-10-4-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.4.2</span></h2><h3 id="fixed-bugs-and-malfunctions-167" class="section-heading"><a href="#fixed-bugs-and-malfunctions-167" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed <a href="erlang.html#process_info/2"><code class="inline">process_info(Pid,reductions)</code></a> to not categorically
increase reduction count of the measured process <code class="inline">Pid</code>. Repeated reduction
measure of an idle process will most often (but not guaranteed) return the
same value, like it behaved before OTP 21.3.8.</p><p>Own Id: OTP-15865 Aux Id: ERL-964</p></li><li><p>Fixed an incorrect load-time optimization that could cause a crash when
extracting deeply nested tuple elements.</p><p>Own Id: OTP-15871 Aux Id: ERIERL-374</p></li><li><p>Fix bug causing VM crash when pressing P for &quot;proc info&quot; in Erlang shell break
menu. Bug exists since OTP 22.0.</p><p>Own Id: OTP-15873 Aux Id: ERL-965</p></li></ul><h2 id="erts-10-4-1" class="section-heading"><a href="#erts-10-4-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.4.1</span></h2><h3 id="fixed-bugs-and-malfunctions-168" class="section-heading"><a href="#fixed-bugs-and-malfunctions-168" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In nested use of <code class="inline">try</code>/<code class="inline">catch</code>, rethrowing an exception using <a href="erlang.html#raise/3"><code class="inline">erlang:raise/3</code></a>
with a different class would not always be able to change the class of the
exception.</p><p>Own Id: OTP-15834 Aux Id: ERIERL-367</p></li></ul><h2 id="erts-10-4" class="section-heading"><a href="#erts-10-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.4</span></h2><h3 id="fixed-bugs-and-malfunctions-169" class="section-heading"><a href="#fixed-bugs-and-malfunctions-169" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Do not allocate new bitstring/binary when an empty binary is appended.</p><p>Own Id: OTP-15535 Aux Id: PR-2055</p></li><li><p>Document that <a href="erlang.html#process_info/2"><code class="inline">process_info(_, current_function)</code></a> can
return <code class="inline">{current_function, undefined}</code> in case of execution of native code.</p><p>Own Id: OTP-15543 Aux Id: PR-2089</p></li><li><p>Fixed bug in <code class="inline">ets:select</code>, <code class="inline">ets:match</code> and friends which could cause the table
to remain fixated (as if <code class="inline">ets:safe_fixtable</code> had been called) after the call
returned. This could happen for <code class="inline">protected</code> tables if another concurrent
running process transferred table ownership to the process during its
ets:select/match call. Ownership can be transferred using either
<code class="inline">ets:give_away</code> or the <code class="inline">heir</code> table option.</p><p>Own Id: OTP-15672</p></li><li><p>Fixed a Windows-specific bug in <a href="../../apps/kernel/file.html#list_dir/1"><code class="inline">file:list_dir/1</code></a> that caused it to misbehave
on network shares.</p><p>Own Id: OTP-15693</p></li><li><p>Fixed bug when calling <code class="inline">enif_whereis_*</code> from NIF resource destructor. Symptoms
could be emulator crash or hanging scheduler threads.</p><p>Own Id: OTP-15694 Aux Id: ERL-863</p></li><li><p>Fixed a bug in the error case of <a href="erlang.html#apply/3"><code class="inline">apply/3</code></a>, where the exception
would erroneously have an empty argument list in some cases.</p><p>Own Id: OTP-15698</p></li><li><p>A bug has been fixed in the <code class="inline">maps</code> implementation that could cause a crash or
memory usage to grow until the machine ran out of memory. This could happen
when inserting a new key-value pair with a key <code class="inline">K1</code> containing a binary <code class="inline">B1</code>
into a map <code class="inline">M</code> having a key <code class="inline">K2</code> with a binary <code class="inline">B2</code> if the following
conditions were met:</p><ul><li><code class="inline">B1 =/= B2</code></li><li><code class="inline">size(B1) &gt;= 4294967296</code></li><li><code class="inline">size(B2) &gt;= 4294967296</code></li><li><code class="inline">size(M) &gt;= 32</code></li><li><code class="inline">(size(B1) rem 4294967296) == (size(B2) rem 4294967296)</code></li><li>the first <code class="inline">(size(B1) rem 4294967296)</code> bytes are the same both in <code class="inline">B1</code> and
<code class="inline">B2</code></li><li>substituting <code class="inline">B1</code> in <code class="inline">K1</code> with <code class="inline">B2</code> would create a term with the same value
as <code class="inline">K2</code></li></ul><p>The root cause of the problem is that the <code class="inline">maps</code> implementation only hashed
the first <code class="inline">(X rem 4294967296)</code> bytes of binaries so that different binaries
could get the same hash value independently of the hash seed.</p><p>Own Id: OTP-15707</p></li><li><p><code class="inline">term_to_binary()</code> and distributed sends will now throw a <code class="inline">system_limit</code>
exception instead of producing erroneous results when trying to encode a
binary larger than 4 GB.</p><p>Own Id: OTP-15708</p></li><li><p>The vxworks configure has been updated to respect the environment CFLAGS.</p><p>Own Id: OTP-15773</p></li><li><p>Fix configure to not enable PGO (profile guided optimizations) when linking of
the PGO binary fails. For instance this happens when there is no gcov lib
installed.</p><p>Own Id: OTP-15788</p></li><li><p>Fix bug on OpenBSD where sockets using <code class="inline">active, true</code> or <code class="inline">active, N</code> could
cause the system to live lock. The bug was introduced in erts-10.2 (OTP-21.2).</p><p>Own Id: OTP-15791</p></li></ul><h3 id="improvements-and-new-features-40" class="section-heading"><a href="#improvements-and-new-features-40" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Add support for Erlang Distribution protocol to split the payload of large
signals into several fragments. This allows other processes to communicate
uninterrupted during the transmission of these signals.</p><p>Own Id: OTP-13397</p></li><li><p>A simple socket API is provided through the socket module. This is a low level
API that does <em>not</em> replace gen_[tcp|udp|sctp]. It is intended to
<em>eventually</em> replace the inet driver, but not the high level gen-modules
(gen_tcp, gen_udp and gen_sctp). It also provides a basic API that facilitates
the implementation of other protocols, that is TCP, UDP and SCTP.</p><p>Known issues are; No support for the Windows OS (currently).</p><p>Own Id: OTP-14831</p></li><li><p>Added NIF functions
<a href="erl_nif.html#enif_set_pid_undefined"><code class="inline">enif_set_pid_undefined</code></a>,
<a href="erl_nif.html#enif_is_pid_undefined"><code class="inline">enif_is_pid_undefined</code></a> and
<a href="erl_nif.html#enif_compare_pids"><code class="inline">enif_compare_pids</code></a>.</p><p>Own Id: OTP-15011 Aux Id: PR-2147</p></li><li><p>Underutilized memory segments (carriers) can now move between all allocator
instances, rather than just between instances of the same type, which greatly
reduces memory usage in some scenarios.</p><p>Own Id: OTP-15063</p></li><li><p>The emulator will now mark free blocks in pooled carriers with
<code class="inline">madvise(2) + MADV_FREE</code> (or similar), letting the OS reclaim the associated
physical memory if necessary.</p><p>Own Id: OTP-15075</p></li><li><p>New <code class="inline">ERL_NIF_SELECT_CANCEL</code> feature added to <code class="inline">enif_select</code> in order to cancel
(or &quot;deselect&quot;) a read or write event on a previously selected file
descriptor.</p><p>Own Id: OTP-15095</p></li><li><p>ETS option <code class="inline">write_concurrency</code> now also affects and improves the scalability
of <code class="inline">ordered_set</code> tables. The implementation is based on a data structure
called contention adapting search tree, where the lock granularity adapts to
the actual amount of concurrency exploited by the applications in runtime.</p><p>Own Id: OTP-15128</p></li><li><p>Build configuration of the <code class="inline">crypto</code> application has been moved from the <code class="inline">erts</code>
application into the <code class="inline">crypto</code> application.</p><p>Own Id: OTP-15129</p></li><li><p>Anonymous functions that don't capture environment are now created at
load-time instead of in run-time.</p><p>Own Id: OTP-15195 Aux Id: PR-1812</p></li><li><p>Optimize updates of maps with identical keys and values. E.g. in the example
below the original Map will be reused as the return of the update.</p><p>1&gt; Map = #{ a =&gt; b }. #{ a =&gt; b } 2&gt; Map#{ a := b }.</p><p>Own Id: OTP-15211 Aux Id: PR-1889</p></li><li><p>Optimize <a href="../../apps/stdlib/binary.html#match/2"><code class="inline">binary:match/2</code></a> and <a href="../../apps/stdlib/binary.html#matches/2"><code class="inline">binary:matches/2</code></a> to use memchr internally.</p><p>Own Id: OTP-15238 Aux Id: PR-1803</p></li><li><p>The runtime system used to terminate when a message larger than 2 Gb was
passed over the distribution. The send operation will now instead throw a
<code class="inline">system_limit</code> exception.</p><p>Own Id: OTP-15261</p></li><li><p>Change the first module called by erts to be named erl_init instead of
otp_ring0. systools in sasl have been updated to reflect this change.</p><p>Own Id: OTP-15336 Aux Id: PR-1825</p></li><li><p>Minor adjustments made to build system for parallel configure.</p><p>Own Id: OTP-15340 Aux Id: OTP-14625</p></li><li><p>Two new NIF interface functions <code class="inline">enif_select_read</code> and <code class="inline">enif_select_write</code>.
They are similar to existing <code class="inline">enif_select</code> but allow a custom event message as
an argument.</p><p>Own Id: OTP-15349 Aux Id: PR-2084</p></li><li><p>The embedded copy of <code class="inline">zlib</code> has been updated from <code class="inline">1.2.8</code> to <code class="inline">1.2.11</code>.</p><p>Note that this copy is only used as a fallback when the target platform
doesn't provide any <code class="inline">zlib</code> development libraries. If your system provides
<code class="inline">zlib</code> then it will be used even if it is older than <code class="inline">1.2.11</code>.</p><p>Own Id: OTP-15351 Aux Id: ERL-749</p></li><li><p>New NIF function <code class="inline">enif_make_monitor_term</code>.</p><p>Own Id: OTP-15362 Aux Id: PR-2127</p></li><li><p>Appending lists (The ++ operator) will now yield properly on large inputs.</p><p>Own Id: OTP-15427</p></li><li><p>The <a href="erlang.html#length/1"><code class="inline">length/1</code></a> BIF used to calculate the length of the list in
one go without yielding, even if the list was very long. In OTP 22,
<a href="erlang.html#length/1"><code class="inline">length/1</code></a> will yield when called with long lists.</p><p>Own Id: OTP-15439</p></li><li><p>Processes sending messages are now punished with a reduction cost based on
message size. That is, a process sending a large message will yield earlier
than before.</p><p>Own Id: OTP-15513 Aux Id: ERL-773</p></li><li><p>The transitory emulator option <code class="inline">+ztma true</code> (introduced in OTP 21.3) has been
removed.</p><p>Own Id: OTP-15581 Aux Id: OTP-15580</p></li><li><p>In OTP 22, HiPE (the native code compiler) is not fully functional. The
reasons for this are:</p><p>There are new BEAM instructions for binary matching that the HiPE native code
compiler does not support.</p><p>The new optimizations in the Erlang compiler create new combination of
instructions that HiPE currently does not handle correctly.</p><p>If erlc is invoked with the <code class="inline">+native</code> option, and if any of the new binary
matching instructions are used, the compiler will issue a warning and produce
a BEAM file without native code.</p><p>Own Id: OTP-15596</p></li><li><p>The termination behaviour of processes has changed to allow processes to yield
while sending link exit/monitor down signals.</p><p>The erl crash dump has been expanded to now also include processes that are
termeinating but have not yet terminated.</p><p>Own Id: OTP-15610</p></li><li><p>The dist messages EXIT, EXIT2 and MONITOR_DOWN have been updated with new
versions that send the reason term as part of the payload of the message
instead of as part of the control message.</p><p>The old versions are still present and can be used when communicating with
nodes that don't support the new versions.</p><p>Own Id: OTP-15611</p></li><li><p>When sending messages, exit, exit2 and monitor down distributed signals, the
process sending will now yield appropriately.</p><p>This means that a terminating process will yield and possibly be suspended on
busy distribution entries while they are terminating. This means that any
memory held by such processes will not be released until after all
exit/monitor down signals have been sent.</p><p>Own Id: OTP-15612</p></li><li><p>All external pids/ports/refs created by erlang:list_to_pid/port/ref debug
functions now compare equal to any other pid/port/ref with the same number
from that node.</p><p>Before this change they compared differently because the node creation of the
pid/port/ref did not compare equal to any real pid/port/ref creation.</p><p>This will mostly effect pids/ports/refs typed in the shell.</p><p>Own Id: OTP-15613</p></li><li><p>The <code class="inline">persistent_term</code> functions <a href="erlang.html#put/2"><code class="inline">put/2</code></a> and <a href="erlang.html#erase/1"><code class="inline">erase/1</code></a>
are now yielding.</p><p>Own Id: OTP-15615</p></li><li><p>A new
<a href="erlang.html#dist_ctrl_set_opt/3"><code class="inline">erlang:dist_ctrl_set_opt(DHandle, get_size, Value)</code></a>
option has been added. This option makes it possible to configure the
distribution channel identified by <code class="inline">DHandle</code> so that
<a href="erlang.html#dist_ctrl_get_data/1"><code class="inline">erlang:dist_ctrl_get_data(DHandle)</code></a> also
returns the size of the data to pass over the channel.</p><p>Own Id: OTP-15617</p></li><li><p>Previously, all ETS tables used centralized counter variables to keep track of
the number of items stored and the amount of memory consumed. These counters
can cause scalability problems (especially on big NUMA systems). This change
adds an implementation of a decentralized counter and modifies the
implementation of ETS so that ETS tables of type <code class="inline">ordered_set</code> with
<code class="inline">write_concurrency</code> enabled use the decentralized counter. Experiments
indicate that this change substantially improves the scalability of ETS
<code class="inline">ordered_set</code> tables with <code class="inline">write_concurrency</code> enabled in scenarios with
frequent <a href="../../apps/stdlib/ets.html#insert/2"><code class="inline">ets:insert/2</code></a> and <a href="../../apps/stdlib/ets.html#delete/2"><code class="inline">ets:delete/2</code></a> calls.</p><p>Own Id: OTP-15623 Aux Id: PR-2190</p></li><li><p>The <a href="erlang.html#iolist_size/1"><code class="inline">iolist_size/1</code></a> function is now yielding which means
that an Erlang/OTP system will be responsive even if the applications running
on the system frequently call <a href="erlang.html#iolist_size/1"><code class="inline">iolist_size/1</code></a> with large
iolists.</p><p>Own Id: OTP-15631</p></li><li><p>A simple test suite for the net module has been added.</p><p>Own Id: OTP-15635</p></li><li><p>Added the NIF function <code class="inline">enif_term_type</code>, which helps avoid long sequences of
<code class="inline">enif_is_xyz</code> by returning the type of the given term. This is especially
helpful for NIFs that serialize terms, such as JSON encoders, where it can
improve both performance and readability.</p><p>Own Id: OTP-15640</p></li><li><p>The last call optimization is now applied to BIFs. When calling a BIF in the
tail position of a function, the return address and stack frame will now be
discarded before calling the BIF. As a consequence of this change, the
immediate caller of a tail-called BIF will no longer be available in stack
backtraces.</p><p>Own Id: OTP-15674 Aux Id: PR-2177</p></li><li><p>Fix GC bug where distributed messages in a processes mailbox would cause extra
GCs. This can be very expensive if there many messages in the mailbox.</p><p>Own Id: OTP-15703</p></li><li><p>Internal documentation has now been added to the <em>Erts</em> and <em>Compiler</em>
applications.</p><p>The internal documents for <em>Erts</em> describe miscellaneous interesting
implementation details. Those details can change at any time.</p><p>The internal documentation for <em>Compiler</em> documents the API for the Core
Erlang modules. While we will not change those APIs without good reason, we
don't give the same guarantees about backward compatibility as for the rest of
the APIs in OTP.</p><p>Own Id: OTP-15715</p></li><li><p>The performance of non-bignum integer arithmetic has been improved.</p><p>Own Id: OTP-15740</p></li><li><p>The <code class="inline">-remsh</code> option to <code class="inline">erl</code> now automatically adds the local systems hostname
to the target node if no nodename is given. e.g.</p><p><code class="inline">erl -name foo -remsh bar</code><br/><code class="inline">erl -sname foo -remsh bar</code></p><p>Own Id: OTP-15794 Aux Id: PR-2219</p></li></ul><h2 id="erts-10-3-5-19" class="section-heading"><a href="#erts-10-3-5-19" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.19</span></h2><h3 id="fixed-bugs-and-malfunctions-170" class="section-heading"><a href="#fixed-bugs-and-malfunctions-170" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix bug in match spec compilator seen to cause a stack overflow crash on debug
VM for certain match specs. Could potentially cause problems for standard VM,
but has not been verified. Match specs are used by <code class="inline">ets:match/select</code>
functions and <code class="inline">erlang:trace_pattern</code>.</p><p>Own Id: OTP-17379 Aux Id: PR-4804</p></li><li><p>A call to <code class="inline">port_command()</code> could cause a scheduler to end up in an eternal
loop if the port was busy and the calling process had incoming signals at the
time of the call. This bug was introduced in OTP 23.3.2 (ERTS version 11.2.1),
OTP 22.3.4.18 (ERTS version 10.7.2.10), and OTP 21.3.8.23 (ERTS version
10.3.5.18).</p><p>Own Id: OTP-17448 Aux Id: GH-4898, PR-4903, OTP-17291</p></li></ul><h2 id="erts-10-3-5-18" class="section-heading"><a href="#erts-10-3-5-18" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.18</span></h2><h3 id="fixed-bugs-and-malfunctions-171" class="section-heading"><a href="#fixed-bugs-and-malfunctions-171" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The following signals could pass before other signals from the same sender to
the same receiver. That is, these signals could arrive too early.</p><ul><li><code class="inline">garbage-collect</code> request. Sent from one process to another using one of the
<a href="erlang.html#garbage_collect/0"><code class="inline">garbage_collect/0</code></a> BIFs.</li><li><code class="inline">check-process-code</code> request. Sent from one process to another using one of
the <code class="inline">check_process_code()</code> BIFs.</li><li><code class="inline">is-process-alive</code> reply. Sent as a response to a process calling the
<code class="inline">is_process_alive()</code> BIF.</li><li><code class="inline">process-info</code> reply. Sent as a response to a process calling one of the
<code class="inline">process_info()</code> BIFs.</li><li><code class="inline">port-command</code> reply. Sent as a response to a process calling one of the
<code class="inline">port_command()</code> BIFs.</li><li><code class="inline">port-connect</code> reply. Sent as a response to a process calling the
<code class="inline">port_connect()</code> BIF.</li><li><code class="inline">port-close</code> reply. Sent as a response to a process calling the
<code class="inline">port_close()</code> BIF.</li><li><code class="inline">port-control</code> reply. Sent as a response to a process calling the
<code class="inline">port_control()</code> BIF.</li><li><code class="inline">port-call</code> reply. Sent as a response to a process calling the <code class="inline">port_call()</code>
BIF.</li><li><code class="inline">port-info</code> reply. Sent as a response to a process calling one of the
<code class="inline">port_info()</code> BIFs.</li></ul><p>Own Id: OTP-17291</p></li><li><p>A garbage collection of a literal area missed messages that entirely consisted
of a term in a literal area. This could in turn lead to a crash of the runtime
system.</p><p>Own Id: OTP-17307</p></li><li><p>A call to <a href="erlang.html#process_flag/2"><code class="inline">process_flag(message_queue_data, off_heap)</code></a>
could cause a crash of the runtime system when sequential tracing was enabled.</p><p>Own Id: OTP-17349</p></li></ul><h2 id="erts-10-3-5-17" class="section-heading"><a href="#erts-10-3-5-17" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.17</span></h2><h3 id="fixed-bugs-and-malfunctions-172" class="section-heading"><a href="#fixed-bugs-and-malfunctions-172" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in the timer implementation which could cause timers that were set
to more than 37.25 hours in the future to be delayed. This could occur if
there were multiple timers scheduled to be triggered very close in time, but
still at different times, and the scheduler thread handling the timers was not
able to handle them quickly enough. Delayed timers were in this case triggered
when another unrelated timer was triggered.</p><p>Own Id: OTP-17253</p></li></ul><h3 id="improvements-and-new-features-41" class="section-heading"><a href="#improvements-and-new-features-41" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Fix a file descriptor leak when using sendfile and the remote side closes the
connection. This bug has been present since OTP-21.0.</p><p>Own Id: OTP-17244</p></li></ul><h2 id="erts-10-3-5-16" class="section-heading"><a href="#erts-10-3-5-16" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.16</span></h2><h3 id="fixed-bugs-and-malfunctions-173" class="section-heading"><a href="#fixed-bugs-and-malfunctions-173" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug that could cause some work scheduled for execution on scheduler
threads to be delayed until other similar work appeared. Beside delaying
various cleanup of internal data structures also the following could be
delayed:</p><ul><li>Termination of a distribution controller process</li><li>Disabling of the distribution on a node</li><li>Gathering of memory allocator information using the <code class="inline">instrument</code> module</li><li>Enabling, disabling, and gathering of <code class="inline">msacc</code> information</li><li>Delivery of <code class="inline">'CHANGE'</code> messages when time offset is monitored</li><li>A call to <code class="inline">erlang:cancel_timer()</code></li><li>A call to <code class="inline">erlang:read_timer()</code></li><li><p>A call to <code class="inline">erlang:statistics(io | garbage_collection | scheduler_wall_time)</code></p></li><li>A call to <code class="inline">ets:all()</code></li><li>A call to <code class="inline">erlang:memory()</code></li><li><p>A call to <code class="inline">erlang:system_info({allocator | allocator_sizes, _})</code></p></li><li>A call to <code class="inline">erlang:trace_delivered()</code></li></ul><p>The bug existed on runtime systems running on all types of hardware except for
x86/x86_64.</p><p>Own Id: OTP-17185</p></li></ul><h2 id="erts-10-3-5-15" class="section-heading"><a href="#erts-10-3-5-15" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.15</span></h2><h3 id="fixed-bugs-and-malfunctions-174" class="section-heading"><a href="#fixed-bugs-and-malfunctions-174" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed rare distribution bug in race between received signal
(link/monitor/spawn_request/spawn_reply) and disconnection. Symptom: VM crash.
Since: OTP 21.0.</p><p>Own Id: OTP-16869 Aux Id: ERL-1337</p></li><li><p>The <code class="inline">suspend_process()</code> and <code class="inline">resume_process()</code> BIFs did not check their
arguments properly which could cause an emulator crash.</p><p>Own Id: OTP-17080</p></li><li><p>The runtime system would get into an infinite loop if the runtime system was
started with more than 1023 file descriptors already open.</p><p>Own Id: OTP-17088 Aux Id: ERIERL-580</p></li></ul><h2 id="erts-10-3-5-14" class="section-heading"><a href="#erts-10-3-5-14" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.14</span></h2><h3 id="fixed-bugs-and-malfunctions-175" class="section-heading"><a href="#fixed-bugs-and-malfunctions-175" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The ERTS internal I/O poll implementation could get into an inconsistent state
causing input events to be ignored.</p><p>Own Id: OTP-16780 Aux Id: PR-2701</p></li><li><p>The documentation of <a href="erlang.html#statistics/1"><code class="inline">statistics(run_queue)</code></a> erroneously
stated that it returns the total length of all normal run queues when it is
the total length of all normal and dirty CPU run queues that is returned. The
documentation has been updated to reflect the actual behavior.</p><p>Own Id: OTP-16866 Aux Id: ERL-1355</p></li><li><p>Two bugs in the ERTS internal thread wakeup functionality have been fixed.
These bugs mainly hit when all threads in the system tried to go to sleep.
When the bugs were triggered, certain operations were delayed until a thread
woke up due to some other reason. Most important operations effected were code
loading, persistent term updates, and memory deallocation.</p><p>Own Id: OTP-16870</p></li><li><p>Fixed bug in <a href="../../apps/stdlib/ets.html#select_replace/2"><code class="inline">ets:select_replace/2</code></a> on <code class="inline">compressed</code> tables that could produce
faulty results or VM crash. Bug exists since OTP 20.</p><p>Own Id: OTP-16874 Aux Id: ERL-1356, PR-2763</p></li></ul><h2 id="erts-10-3-5-13" class="section-heading"><a href="#erts-10-3-5-13" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.13</span></h2><h3 id="fixed-bugs-and-malfunctions-176" class="section-heading"><a href="#fixed-bugs-and-malfunctions-176" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>An unintentional reuse of an already used emulator internal event object could
cause a wakeup signal to a thread to be lost. In worst case this could cause
the runtime system to hang. This hang was however quite rare.</p><p>Own Id: OTP-16766 Aux Id: ERL-1304</p></li><li><p>NIF threads and driver threads on non-Linux systems leaked internal resources
when terminating. On Windows these resources were one event per thread. On
most other systems one mutex and one condition variable per thread. On these
other systems that also lacked <code class="inline">pthread_cond_timedwait()</code> also a pipe with its
file descriptors was leaked.</p><p>Own Id: OTP-16772 Aux Id: ERL-1304</p></li></ul><h2 id="erts-10-3-5-12" class="section-heading"><a href="#erts-10-3-5-12" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.12</span></h2><h3 id="fixed-bugs-and-malfunctions-177" class="section-heading"><a href="#fixed-bugs-and-malfunctions-177" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The functionality utilized by BIFs for temporary disabling of garbage
collection while yielding could cause system task queues to become
inconsistent on a process executing such a BIF. Process system tasks are for
example utilized when purging code, garbage collecting literal data, and when
issuing an ordinary garbage collection from another process.</p><p>The bug does not trigger frequently. Multiple code purges in direct sequence
makes it more likely that this bug is triggered. In the cases observed, this
has resulted in a hanging code purge operation.</p><p>Own Id: OTP-16639 Aux Id: ERL-1236</p></li><li><p>A literal area could prematurely be released before all uses of it had been
removed. This occurred either when a terminating process had a complex exit
reason referring to a literal that concurrently was removed, or when a
terminating process continued executing a dirty NIF accessing a literal (via
the heap) that concurrently was removed.</p><p>Own Id: OTP-16640 Aux Id: OTP-16193</p></li><li><p>The VM could potentially crash when checking process code of a process that
terminated while executing a dirty NIF. The checking of process code is part
of a code purge operation.</p><p>Own Id: OTP-16641</p></li><li><p>System tasks of <code class="inline">low</code> priority were not interleaved with <code class="inline">normal</code> priority
system tasks as they should. This could potentially delay garbage collection
of another process longer than intended if the garbage collection was
requested from a <code class="inline">low</code> priority process.</p><p>Own Id: OTP-16642</p></li></ul><h2 id="erts-10-3-5-11" class="section-heading"><a href="#erts-10-3-5-11" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.11</span></h2><h3 id="fixed-bugs-and-malfunctions-178" class="section-heading"><a href="#fixed-bugs-and-malfunctions-178" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>[re:run(Subject, RE, [unicode])](<a href="../../apps/stdlib/re.html#run/3"><code class="inline">re:run/3</code></a>) returned <code class="inline">nomatch</code> instead of
failing with a <code class="inline">badarg</code> error exception when <code class="inline">Subject</code> contained illegal utf8
and <code class="inline">RE</code> was passed as a binary. This has been corrected along with
corrections of reduction counting in <code class="inline">re:run()</code> error cases.</p><p>Own Id: OTP-16553</p></li><li><p>Fixed a bug that could cause the emulator to crash when purging modules or
persistent terms.</p><p>Own Id: OTP-16555 Aux Id: ERL-1188</p></li></ul><h2 id="erts-10-3-5-10" class="section-heading"><a href="#erts-10-3-5-10" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.10</span></h2><h3 id="fixed-bugs-and-malfunctions-179" class="section-heading"><a href="#fixed-bugs-and-malfunctions-179" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bug in <a href="../../apps/stdlib/ets.html#update_counter/4"><code class="inline">ets:update_counter/4</code></a>, when called with an invalid <code class="inline">UpdateOp</code>
and a <code class="inline">Key</code> that does not exist, causing <code class="inline">ets:info(T,size)</code> to return
incorrect values. Bug exists since OTP-19.0.2.</p><p>Own Id: OTP-16404 Aux Id: ERL-1127</p></li><li><p>A process could get into an inconsistent state where it was runnable, but
never scheduled for execution. This could occur when a mix of <code class="inline">normal</code> and
<code class="inline">low</code> priority processes where scheduled on the same type of dirty scheduler
simultaneously.</p><p>Own Id: OTP-16446 Aux Id: ERL-1157</p></li><li><p>Corrected the valid range of the <code class="inline">erl</code> command line argument
<a href="erl_cmd.html#%2BSDio"><code class="inline">+SDio &lt;NumberOfDirtyIoSchedulers&gt;</code></a> from <code class="inline">0..1024</code> to
<code class="inline">1..1024</code>. <code class="inline">+SDio 0</code> was erroneously allowed which just caused the VM to crash
on the first dirty I/O job scheduled.</p><p>Own Id: OTP-16481</p></li></ul><h2 id="erts-10-3-5-9" class="section-heading"><a href="#erts-10-3-5-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.9</span></h2><h3 id="fixed-bugs-and-malfunctions-180" class="section-heading"><a href="#fixed-bugs-and-malfunctions-180" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A process could end up in a state where it got endlessly rescheduled without
making any progress. This occurred when a system task, such as check of
process code (part of a code purge), was scheduled on a high priority process
trying to execute on a dirty scheduler.</p><p>Own Id: OTP-16436 Aux Id: ERL-1152</p></li><li><p>Fixed bug in <a href="erlang.html#list_to_ref/1"><code class="inline">erlang:list_to_ref/1</code></a> when called with a reference created by a
remote note. Function <a href="erlang.html#list_to_ref/1"><code class="inline">list_to_ref/1</code></a> is intended for
debugging and not to be used in application programs. Bug exist since OTP
20.0.</p><p>Own Id: OTP-16438</p></li></ul><h2 id="erts-10-3-5-8" class="section-heading"><a href="#erts-10-3-5-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.8</span></h2><h3 id="fixed-bugs-and-malfunctions-181" class="section-heading"><a href="#fixed-bugs-and-malfunctions-181" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Taking a scheduler offline could cause timers set while executing on that
scheduler to be delayed until the scheduler was put online again. This bug was
introduced in ERTS version 10.0 (OTP 21.0).</p><p>Own Id: OTP-16371</p></li><li><p>A process calling
<a href="erlang.html#system_flag_multi_scheduling"><code class="inline">erlang:system_flag(multi_scheduling, block)</code></a>
could end up blocked waiting for the operation to complete indefinitely.</p><p>Own Id: OTP-16379</p></li></ul><h2 id="erts-10-3-5-7" class="section-heading"><a href="#erts-10-3-5-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.7</span></h2><h3 id="fixed-bugs-and-malfunctions-182" class="section-heading"><a href="#fixed-bugs-and-malfunctions-182" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A literal area could prematurely be released before all uses of it had been
removed. This occurred either when a terminating process had a complex exit
reason referring to a literal that concurrently was removed, or when a
terminating process continued executing a dirty NIF accessing a literal (via
the heap) that concurrently was removed.</p><p>Own Id: OTP-16193</p></li><li><p>Fix bug causing VM crash due to memory corruption of distribution entry.
Probability of crash increases if Erlang distribution is frequently
disconnected and reestablished towards same node names. Bug exists since
OTP-21.0.</p><p>Own Id: OTP-16224 Aux Id: ERL-1044</p></li><li><p>Fix bug where the receive marker used by the runtime to do the receive queue
optimization could be incorrectly set. The symptom of this would be that a
message that should match in a receive never matches.</p><p>The bug requires the OTP-22 compiler and multiple selective receives to
trigger. See OTP-16219 for details about the bug fix in the compiler.</p><p>Own Id: OTP-16241 Aux Id: ERL-1076 OTP-16219</p></li><li><p>Fixed bug causing crash of VM built with configuration
<code class="inline">--enable--sharing-preserving</code>. Provoked when a sent message contains both a
bit string and the heap binary (&lt; 65 bytes) which the bit string was matched
from. Bug exists since OTP-19.0 but has seen to be easier to provoke since
OTP-22.1.</p><p>Own Id: OTP-16265 Aux Id: ERL-1064</p></li></ul><h2 id="erts-10-3-5-6" class="section-heading"><a href="#erts-10-3-5-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.6</span></h2><h3 id="fixed-bugs-and-malfunctions-183" class="section-heading"><a href="#fixed-bugs-and-malfunctions-183" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix a bug in <code class="inline">binary_to_term</code> that would crash the emulator if a term larger
than 16GB was to be decoded.</p><p>Own Id: OTP-16058 Aux Id: PR-2382</p></li><li><p>When communicating with a simultaneously exiting port via the
<code class="inline">erlang:port_*()</code> BIFs one could sometimes get stray <code class="inline">{Ref, What}</code> messages.
Where <code class="inline">Ref</code> was a reference and <code class="inline">What</code> usually were the atom <code class="inline">badarg</code>.</p><p>Own Id: OTP-16107 Aux Id: ERL-1049</p></li></ul><h2 id="erts-10-3-5-5" class="section-heading"><a href="#erts-10-3-5-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.5</span></h2><h3 id="fixed-bugs-and-malfunctions-184" class="section-heading"><a href="#fixed-bugs-and-malfunctions-184" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><a href="erlang.html#process_info/2"><code class="inline">process_info(P,binary)</code></a> would neglect to look through
heap fragments, potentially missing a few binaries associated with the
process.</p><p>Own Id: OTP-15978 Aux Id: ERIERL-366</p></li><li><p>Fixed bug triggered if a process is killed during call to
<code class="inline">persistent_term:put</code> or <code class="inline">persistent_term:erase</code>.</p><p>Own Id: OTP-16041</p></li></ul><h3 id="improvements-and-new-features-42" class="section-heading"><a href="#improvements-and-new-features-42" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Fixed rare emulator crash in <code class="inline">instrument:allocations/0-1</code>.</p><p>Own Id: OTP-15983</p></li></ul><h2 id="erts-10-3-5-4" class="section-heading"><a href="#erts-10-3-5-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.4</span></h2><h3 id="fixed-bugs-and-malfunctions-185" class="section-heading"><a href="#fixed-bugs-and-malfunctions-185" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bug causing VM crash when doing textual dump of a process containing an
unhandled monitor down signal. Textual process dumps can be done with
<code class="inline">erlang:system_info(procs)</code>, trace feature <code class="inline">process_dump</code>, Erlang shell break
menu and a crashdump. Bug exist since OTP 21.0.</p><p>Own Id: OTP-15909 Aux Id: ERL-979</p></li><li><p><a href="../../apps/stdlib/lists.html#subtract/2"><code class="inline">lists:subtract/2</code></a> would produce incorrect results for some inputs on 64-bit
platforms.</p><p>Own Id: OTP-15938 Aux Id: ERL-986</p></li><li><p>Fixed a bug in the loader that was similar to <code class="inline">OTP-15938</code>, yielding incorrect
code for some inputs on 64-bit platforms.</p><p>Own Id: OTP-15939</p></li><li><p>Fixed bug causing scheduler threads in rare cases to block spinnning
indefinitely. Bug exists since OTP 21.0.</p><p>Own Id: OTP-15941 Aux Id: PR-2313</p></li></ul><h2 id="erts-10-3-5-3" class="section-heading"><a href="#erts-10-3-5-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.3</span></h2><h3 id="fixed-bugs-and-malfunctions-186" class="section-heading"><a href="#fixed-bugs-and-malfunctions-186" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>If you set <code class="inline">{linger,{true,0}}</code> on a <code class="inline">gen_tcp</code> listen socket, accept a
connection on that socket, and then close the accepted socket, now the linger
zero setting is transferred to the accepted socket. Before this correction
that information was lost and the close behaviour on the accepted socket
incorrect.</p><p>Own Id: OTP-15370 Aux Id: ERIERL-353</p></li><li><p>Fixed <a href="erlang.html#process_info/2"><code class="inline">process_info(Pid,reductions)</code></a> to not categorically
increase reduction count of the measured process <code class="inline">Pid</code>. Repeated reduction
measure of an idle process will most often (but not guaranteed) return the
same value, like it behaved before OTP 21.3.8.</p><p>Own Id: OTP-15865 Aux Id: ERL-964</p></li><li><p>The runtime system disconnected a connection if it received an
<a href="erlang.html#exit/2"><code class="inline">exit/2</code></a> signal where the recipient was a process on an old
incarnation of the current node. That is, the receiving node had the same node
name, but another &quot;creation&quot; number. The signal will now just be dropped since
the receiving process no longer exists.</p><p>Own Id: OTP-15867 Aux Id: ERIERL-373</p></li></ul><h3 id="improvements-and-new-features-43" class="section-heading"><a href="#improvements-and-new-features-43" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The possibility to send ancillary data, in particular the TOS field, has been
added to <code class="inline">gen_udp:send/4,5</code>.</p><p>Own Id: OTP-15747 Aux Id: ERIERL-294</p></li></ul><h2 id="erts-10-3-5-2" class="section-heading"><a href="#erts-10-3-5-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.2</span></h2><h3 id="fixed-bugs-and-malfunctions-187" class="section-heading"><a href="#fixed-bugs-and-malfunctions-187" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In nested use of <code class="inline">try</code>/<code class="inline">catch</code>, rethrowing an exception using <a href="erlang.html#raise/3"><code class="inline">erlang:raise/3</code></a>
with a different class would not always be able to change the class of the
exception.</p><p>Own Id: OTP-15834 Aux Id: ERIERL-367</p></li><li><p>Fixed bug in <code class="inline">seq_trace:set_token(label,Term)</code> which could cause VM crash if
<code class="inline">Term</code> was heap allocated (not an atom, small integer, local pid or port). Bug
exists since OTP 21.0 when terms other than small integers were first allowed
as labels.</p><p>Own Id: OTP-15849 Aux Id: ERL-700</p></li><li><p>Fix <a href="../../apps/kernel/seq_trace.html#print/2"><code class="inline">seq_trace:print/2</code></a> not to raise <code class="inline">badarg</code> exception if label is not a
small integer. Bug exists since OTP 21.0.</p><p>Own Id: OTP-15859 Aux Id: ERL-700</p></li></ul><h2 id="erts-10-3-5-1" class="section-heading"><a href="#erts-10-3-5-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5.1</span></h2><h3 id="fixed-bugs-and-malfunctions-188" class="section-heading"><a href="#fixed-bugs-and-malfunctions-188" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a buffer overflow when
<a href="erlang.html#binary_to_existing_atom/2"><code class="inline">binary_to_existing_atom/2</code></a> and
<code class="inline">list_to_existing_atom/2</code> was used with the <code class="inline">latin1</code> encoding.</p><p>Own Id: OTP-15819 Aux Id: ERL-944</p></li></ul><h2 id="erts-10-3-5" class="section-heading"><a href="#erts-10-3-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.5</span></h2><h3 id="fixed-bugs-and-malfunctions-189" class="section-heading"><a href="#fixed-bugs-and-malfunctions-189" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed more bugs in <a href="erlang.html#process_info/1"><code class="inline">process_info(reductions)</code></a> causing it
to sometimes behave non-monotonic. That is, a subsequent call toward the same
process could return a lower reduction value.</p><p>Own Id: OTP-15793 Aux Id: ERIERL-337, OTP-15709</p></li></ul><h2 id="erts-10-3-4" class="section-heading"><a href="#erts-10-3-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.4</span></h2><h3 id="fixed-bugs-and-malfunctions-190" class="section-heading"><a href="#fixed-bugs-and-malfunctions-190" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Add missing documentation of new external tags <code class="inline">NEW_PID</code>, <code class="inline">NEW_PORT</code> and
<code class="inline">NEWER_REFERENCE</code> introduced in OTP 19.</p><p>These new tags are planned to be &quot;activated&quot; in OTP 23 when distribution
capability flag <code class="inline">DFLAG_BIG_CREATION</code> becomes mandatory. Older nodes (&gt;= 19)
are able to decode these new tags and send them back to the new node. Nodes
older than OTP 23 will however never encode their own local pids, ports and
references using the new tags.</p><p>Own Id: OTP-15766</p></li></ul><h2 id="erts-10-3-3" class="section-heading"><a href="#erts-10-3-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.3</span></h2><h3 id="fixed-bugs-and-malfunctions-191" class="section-heading"><a href="#fixed-bugs-and-malfunctions-191" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix <a href="erlang.html#open_port/2"><code class="inline">erlang:open_port/2</code></a> with the <code class="inline">fd</code> option to correctly cleanup the pollset
when the port is closed. Before this fix there would be error printouts sent
to logger when the same fd was reused in a new port.</p><p>Own Id: OTP-15753 Aux Id: ERL-900</p></li></ul><h2 id="erts-10-3-2" class="section-heading"><a href="#erts-10-3-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.2</span></h2><h3 id="fixed-bugs-and-malfunctions-192" class="section-heading"><a href="#fixed-bugs-and-malfunctions-192" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in <a href="../../apps/kernel/seq_trace.html#reset_trace/0"><code class="inline">seq_trace:reset_trace/0</code></a> that could crash the emulator.</p><p>Own Id: OTP-15704</p></li><li><p>Fixed bug in <a href="erlang.html#process_info/1"><code class="inline">process_info(reductions)</code></a> causing it to
sometimes return invalid results.</p><p>Own Id: OTP-15709 Aux Id: ERIERL-337</p></li></ul><h2 id="erts-10-3-1" class="section-heading"><a href="#erts-10-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3.1</span></h2><h3 id="fixed-bugs-and-malfunctions-193" class="section-heading"><a href="#fixed-bugs-and-malfunctions-193" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>If a suspend/resume signal pair was sent to a process while it was executing
dirty, the receiving process could later end up in a suspended state
indefinitely. This bug was introduced in ERTS version 10.0 (OTP 21.0).</p><p>Suspend/resume signals are sent from
<a href="erlang.html#suspend_process/1"><code class="inline">erlang:suspend_process()</code></a>/<a href="erlang.html#resume_process/1"><code class="inline">erlang:resume_process()</code></a>.
The <a href="../../apps/runtime_tools/dbg.html"><code class="inline">dbg</code></a> trace tool utilize this functionality and could thus trigger this
bug.</p><p>Own Id: OTP-15688</p></li><li><p>Fix a possible deadlock when terminating the ERTS caused by a dirty scheduler
not releasing it's run-queue lock when terminating.</p><p>Own Id: OTP-15690 Aux Id: PR-2172</p></li></ul><h2 id="erts-10-3" class="section-heading"><a href="#erts-10-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.3</span></h2><h3 id="fixed-bugs-and-malfunctions-194" class="section-heading"><a href="#fixed-bugs-and-malfunctions-194" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>When multiplying a number by itself, a word beyond the number on the heap
could be read (and ignored). This bug was extremely unlikely to actually cause
a real problem.</p><p>Own Id: OTP-15484</p></li><li><p>Fix bug where doing <code class="inline">seq_trace:reset_trace()</code> while another process was doing
a garbage collection could cause the run-time system to segfault.</p><p>Own Id: OTP-15490</p></li><li><p>Fix reading of ancillary data from packet oriented sockets on old Linux kernel
versions. Without this fix, getting the data would cause the port to enter an
infinite loop.</p><p>Own Id: OTP-15494</p></li><li><p>Fix bug where crash dumping or doing <code class="inline">erlang:system_info(procs)</code> while another
process was doing a garbage collection could cause the run-time system to
segfault.</p><p>Own Id: OTP-15527</p></li><li><p>Fix <code class="inline">erlang:system_info(kernel_poll)</code> to return correct value. Before this
fix, the call always returned <code class="inline">false</code>.</p><p>Own Id: OTP-15556</p></li><li><p>Fix bug in <code class="inline">enif_make_map_from_arrays</code> that would produce broken maps when
number of keys were 32. Bug exists since OTP 21.0.</p><p>Own Id: OTP-15567</p></li><li><p>Fix a bug in <code class="inline">binary:encode_unsigned</code> that may cause a read of uninitialized
memory.</p><p>The bug existed since the function was added (OTP R16B02).</p><p>Own Id: OTP-15583 Aux Id: PR-2118</p></li><li><p>Fixed a bug that could cause <code class="inline">heart</code> to kill an exiting node before it had
time to flush all buffered writes. If environment variable
<code class="inline">HEART_KILL_SIGNAL=SIGABRT</code> was set a superfluous core dump could also be
generated.</p><p>Own Id: OTP-15599 Aux Id: ERIERL-298</p></li><li><p>Fix <code class="inline">enif_consume_timeslice</code> to be a no-op on dirty scheduler and not crash
debug compiled emulator.</p><p>Own Id: OTP-15604</p></li><li><p>Fixed macro redefinition warnings.</p><p>Own Id: OTP-15629</p></li><li><p><code class="inline">to_erl</code> fixed to not garble terminal input beyond 7-bit ASCII.</p><p>Own Id: OTP-15650 Aux Id: ERL-854, PR-2161</p></li><li><p>Minor fixes for <code class="inline">make clean</code>.</p><p>Own Id: OTP-15657</p></li><li><p>Fixed a bug in all <code class="inline">ets:select*</code> and <code class="inline">ets:match*</code> functions that could in some
rare cases lead to very poor performance.</p><p>Own Id: OTP-15660 Aux Id: ERL-869</p></li></ul><h3 id="improvements-and-new-features-44" class="section-heading"><a href="#improvements-and-new-features-44" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Add <code class="inline">erlang:system_flag(system_logger, Pid)</code> and
<code class="inline">erlang:system_info(system_logger)</code>. This system_flag can be used to set the
process that will receive the logging messages generated by ERTS.</p><p>Own Id: OTP-15375</p></li><li><p><a href="erlang.html#integer_to_list/2"><code class="inline">integer_to_list/2</code></a> and
<a href="erlang.html#integer_to_binary/2"><code class="inline">integer_to_binary/2</code></a> are now implemented in C,
improving their performance.</p><p>Own Id: OTP-15503 Aux Id: PR-2052</p></li><li><p>Improved <code class="inline">term_to_binary</code> to do more fair reduction count and yielding when
encoding large byte lists (strings).</p><p>Own Id: OTP-15514 Aux Id: ERL-774</p></li><li><p>Made internal port drivers more robust against <code class="inline">erlang:port_control</code> with
invalid arguments and added documentation warnings about such abuse.</p><p>Own Id: OTP-15555 Aux Id: ERIERL-231</p></li><li><p>Fix bug on NetBSD where the <code class="inline">exit_status</code> from a port program would never be
sent.</p><p>Own Id: OTP-15558 Aux Id: ERL-725</p></li><li><p>There is a new function <code class="inline">persistent:term(Key, Default)</code> to allow specifying a
default when looking up a persistent term.</p><p>Own Id: OTP-15576 Aux Id: ERL-843</p></li><li><p>A transitory emulator option '<code class="inline">+ztma true</code>' has been added to allow running
existing BEAM code that relies on &quot;tuple calls&quot; (dispatch on parameterized
modules) which has been compiled under OTP 20 or earlier. This option will be
removed in OTP 22, so such modules should eventually be recompiled with the
<code class="inline">+tuple_calls</code> option.</p><p>Own Id: OTP-15580 Aux Id: PR-2113</p></li></ul><h2 id="erts-10-2-5" class="section-heading"><a href="#erts-10-2-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.2.5</span></h2><h3 id="fixed-bugs-and-malfunctions-195" class="section-heading"><a href="#fixed-bugs-and-malfunctions-195" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixes of install/release phase in build system.</p><ul><li>The source tree was modified when installing/releasing and/or applying a
patch.</li><li>Some files were installed with wrong access rights.</li><li>If applying a patch (using <code class="inline">otp_patch_apply</code>) as another user (except root)
than the user that built the source, the documentation was not properly
updated.</li></ul><p>Own Id: OTP-15551</p></li><li><p>Setting the <code class="inline">recbuf</code> size of an inet socket the <code class="inline">buffer</code> is also automatically
increased. Fix a bug where the auto adjustment of inet buffer size would be
triggered even if an explicit inet buffer size had already been set.</p><p>Own Id: OTP-15651 Aux Id: ERIERL-304</p></li><li><p>Reading from UDP using active <code class="inline">true</code> or active <code class="inline">N</code> mode has been optimized
when more packets than specified by <code class="inline">read_packets</code> are available on the
socket.</p><p>Own Id: OTP-15652 Aux Id: ERIERL-304</p></li></ul><h2 id="erts-10-2-4" class="section-heading"><a href="#erts-10-2-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.2.4</span></h2><h3 id="fixed-bugs-and-malfunctions-196" class="section-heading"><a href="#fixed-bugs-and-malfunctions-196" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>When using the <code class="inline">{linger,{true,T}}</code> option; <a href="../../apps/kernel/gen_tcp.html#listen/2"><code class="inline">gen_tcp:listen/2</code></a> used the full
linger time before returning for example <code class="inline">eaddrinuse</code>. This bug has now been
corrected.</p><p>Own Id: OTP-14728 Aux Id: ERIERL-303</p></li></ul><h2 id="erts-10-2-3" class="section-heading"><a href="#erts-10-2-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.2.3</span></h2><h3 id="fixed-bugs-and-malfunctions-197" class="section-heading"><a href="#fixed-bugs-and-malfunctions-197" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix bug where doing a <code class="inline">gen_tcp:send</code> on a socket with <code class="inline">delay_send</code> set to true
could cause a segfault if the other side closes the connection.</p><p>Bug was introduced in erts-10.2 (OTP-21.2).</p><p>Own Id: OTP-15536 Aux Id: ERL-827</p></li><li><p>Fix a race condition when a port program closes that could result in the next
started port to hang during startup.</p><p>When this fault happens the following error is normally (but not always)
logged:</p><p><code class="inline">=ERROR REPORT==== 14-Jan-2019::10:45:52.868246 ===</code><br/><code class="inline">Bad input fd in erts_poll()! fd=11, port=#Port&lt;0.505&gt;, driver=spawn, name=/bin/sh -s unix:cmd</code></p><p>Bug was introduced in erts-10.0 (OTP-21.0).</p><p>Own Id: OTP-15537</p></li><li><p>Fix a bug where polling for external events could be delayed for a very long
time if all active schedulers were 100% loaded.</p><p>Bug was introduced in erts-10.2 (OTP-21.2).</p><p>Own Id: OTP-15538 Aux Id: ERIERL-229</p></li></ul><h2 id="erts-10-2-2" class="section-heading"><a href="#erts-10-2-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.2.2</span></h2><h3 id="fixed-bugs-and-malfunctions-198" class="section-heading"><a href="#fixed-bugs-and-malfunctions-198" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a crash when dangling files were closed after <a href="init.html#restart/0"><code class="inline">init:restart/0</code></a>.</p><p>Own Id: OTP-15495 Aux Id: ERL-821</p></li><li><p>A bug that could cause dirty schedulers to become unresponsive has been fixed.</p><p>Own Id: OTP-15509 Aux Id: PR-2027, PR-2093</p></li></ul><h2 id="erts-10-2-1" class="section-heading"><a href="#erts-10-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-199" class="section-heading"><a href="#fixed-bugs-and-malfunctions-199" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bug on big endian architectures when changing file permissions or
ownership with <code class="inline">file:change_mode</code>, <code class="inline">change_owner</code>, <code class="inline">change_group</code> or
<code class="inline">write_file_info</code>. Bug exists since OTP-21.0.</p><p>Own Id: OTP-15485</p></li><li><p>Fixed bug in <code class="inline">atomics</code> with option <code class="inline">{signed,false}</code> when returned values are
<code class="inline">(1 bsl 63)</code> or larger. Could cause heap corruption leading to VM crash or
other unpleasant symptoms. Bug exists since OTP-21.2 when module <code class="inline">atomics</code> was
introduced.</p><p>Own Id: OTP-15486 Aux Id: PR-2061</p></li><li><p>Fixed bug in operator <code class="inline">band</code> of two negative operands causing erroneous result
if the absolute value of one of the operands have the lowest <code class="inline">N*W</code> bits as
zero and the other absolute value is not larger than <code class="inline">N*W</code> bits. <code class="inline">N</code> is an
integer of 1 or larger and <code class="inline">W</code> is 32 or 64 depending on word size.</p><p>Own Id: OTP-15487 Aux Id: ERL-804</p></li></ul><h2 id="erts-10-2" class="section-heading"><a href="#erts-10-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.2</span></h2><h3 id="fixed-bugs-and-malfunctions-200" class="section-heading"><a href="#fixed-bugs-and-malfunctions-200" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>When a process was waiting for a TCP socket send operation to complete, and
another process closed the socket during that send, the sending process could
hang. This bug has now been corrected.</p><p>Own Id: OTP-12242 Aux Id: ERL-561</p></li><li><p>Document <code class="inline">bit_size</code> in match specifications and allow it in <code class="inline">ets:fun2ms</code>.</p><p>Own Id: OTP-15343 Aux Id: PR-1962</p></li><li><p>Fixed bug in <code class="inline">ets:select_replace</code> when called with a fully bound key could
cause a following call to <code class="inline">ets:next</code> or <code class="inline">ets:prev</code> to crash the emulator or
return invalid result.</p><p>Own Id: OTP-15346</p></li><li><p>When a module has been purged from memory, any literals belonging to that
module will be copied to all processes that hold references to them. The max
heap size limit would be ignored in the garbage collection initiated when
copying literals to a process. If the max heap size was exceeded, the process
would typically be terminated in the following garbage collection. Corrected
to terminate the process directly if copying a literal would exceed the max
heap size.</p><p>Own Id: OTP-15360</p></li><li><p>Fix compilation of run_erl on Solaris 11.4 and later.</p><p>Own Id: OTP-15389</p></li><li><p>Fixed a bug where <code class="inline">lists:reverse/1-2</code> could use far too many reductions. This
bug was introduced in <code class="inline">OTP 21.1</code>.</p><p>Own Id: OTP-15436</p></li><li><p>Fixed a bug where a dirty scheduler could stay awake forever if a distribution
entry was removed as part of a dirty GC.</p><p>Own Id: OTP-15446 Aux Id: PR-2024</p></li><li><p>Fix microstate accounting handing in various places. Most importantly the GC
states when the GC is run on a dirty scheduler are now managed correctly.</p><p>Own Id: OTP-15450 Aux Id: ERIERL-229</p></li><li><p>Fixed bug in <code class="inline">file:sendfile</code> when the send operation failed. For sockets in
<code class="inline">active</code> modes it could cause emulator crash or a hanging call. For sockets
with <code class="inline">{active,false}</code> an unexpected <code class="inline">{inet_reply, _, _}</code> message could be sent
to the calling process. The bug exists since OTP-21.0.</p><p>Own Id: OTP-15461 Aux Id: ERL-784</p></li><li><p>The erts configure script has been updated to reject any CFLAGS that does not
have <code class="inline">-O</code>. This in order to prevent the common mistake of forgetting to add
<code class="inline">-O2</code> to custom CFLAGS.</p><p>Own Id: OTP-15465</p></li><li><p>Fix reduction count in lists:member/2</p><p>Own Id: OTP-15474 Aux Id: ERIERL-229</p></li></ul><h3 id="improvements-and-new-features-45" class="section-heading"><a href="#improvements-and-new-features-45" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>New <code class="inline">counters</code> and <code class="inline">atomics</code> modules supplies access to highly efficient
operations on mutable fixed word sized variables.</p><p>Own Id: OTP-13468</p></li><li><p>There is a new module <code class="inline">persistent_term</code> that implements a term storage
suitable for terms that are frequently used but never or infrequently updated.
Lookups are done in constant time without copying the terms.</p><p>Own Id: OTP-14669 Aux Id: PR-1989</p></li><li><p>A function <a href="../../apps/kernel/inet.html#getifaddrs/1"><code class="inline">inet:getifaddrs/1</code></a> that takes a list with a namespace option has
been added, for platforms that support that feature, for example Linux
(only?).</p><p>Own Id: OTP-15121 Aux Id: ERIERL-189, PR-1974</p></li><li><p>Added the <code class="inline">nopush</code> option for TCP sockets, which corresponds to <code class="inline">TCP_NOPUSH</code>
on *BSD and <code class="inline">TCP_CORK</code> on Linux.</p><p>This is also used internally in <code class="inline">file:sendfile</code> to reduce latency on
subsequent send operations.</p><p>Own Id: OTP-15357 Aux Id: ERL-698</p></li><li><p>List subtraction (The <code class="inline">--</code> operator) will now yield properly on large inputs.</p><p>Own Id: OTP-15371</p></li><li><p>Optimize handling of send_delay for tcp sockes to better work with the new
pollthread implementation introduced in OTP-21.</p><p>Own Id: OTP-15471 Aux Id: ERIERL-229</p></li><li><p>Optimize driver_set_timer with a zero timeout to short-circuit and not create
any timer structure, but instead schedule the timer immediately.</p><p>Own Id: OTP-15472 Aux Id: ERIERL-229</p></li><li><p>Add <code class="inline">erl_xcomp_code_model_small</code> as a cross configure variable in order to let
the emulator be build with the assumption that a small code model will be used
on the target machine.</p><p>Own Id: OTP-15473 Aux Id: ERIERL-229</p></li><li><p>Add a new pollset that is made to handle sockets that use <code class="inline">{active, true}</code> or
<code class="inline">{active, N}</code>. The new pollset will not be polled by a pollthread, but instead
polled by a normal scheduler.</p><p>This change was made because of the overhead associated with constantly having
to re-apply the ONESHOT mechanism on fds that all input events were
interesting.</p><p>The new pollset is only active on platforms that support concurrent kernel
poll updates, i.e. Linux and BSD.</p><p>Own Id: OTP-15475 Aux Id: ERIERL-229</p></li><li><p>Fix bug where emulator would segfault if a literal message was sent when
sequence tracing was enabled.</p><p>Own Id: OTP-15478 Aux Id: ERL-741</p></li></ul><h2 id="erts-10-1-3" class="section-heading"><a href="#erts-10-1-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.1.3</span></h2><h3 id="improvements-and-new-features-46" class="section-heading"><a href="#improvements-and-new-features-46" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Added an optional <code class="inline">./configure</code> flag to compile the emulator with spectre
mitigation: <code class="inline">--with-spectre-mitigation</code></p><p>Note that this requires a recent version of GCC with support for spectre
mitigation and the <code class="inline">--mindirect-branch=thunk</code> flag, such as <code class="inline">8.1</code>.</p><p>Own Id: OTP-15430 Aux Id: ERIERL-237</p></li></ul><h2 id="erts-10-1-2" class="section-heading"><a href="#erts-10-1-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.1.2</span></h2><h3 id="fixed-bugs-and-malfunctions-201" class="section-heading"><a href="#fixed-bugs-and-malfunctions-201" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a rare bug where files could be closed on a normal instead of an IO
scheduler, resulting in system instability if the operation blocked.</p><p>Own Id: OTP-15421</p></li></ul><h2 id="erts-10-1-1" class="section-heading"><a href="#erts-10-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-202" class="section-heading"><a href="#fixed-bugs-and-malfunctions-202" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A bug where the socket option 'pktoptions' caused a read of uninitialized
memory has been fixed. Would cause malfunction on FreeBSD.</p><p>Own Id: OTP-14297 Aux Id: OTP-15141</p></li><li><p>Fixed a memory leak on errors when reading files.</p><p>Own Id: OTP-15318</p></li><li><p>File access through UNC paths works again on Windows. This regression was
introduced in OTP 21.</p><p>Own Id: OTP-15333 Aux Id: ERL-737</p></li></ul><h2 id="erts-10-1" class="section-heading"><a href="#erts-10-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.1</span></h2><h3 id="fixed-bugs-and-malfunctions-203" class="section-heading"><a href="#fixed-bugs-and-malfunctions-203" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix the seq_trace token to not be cleared when a process receives messages
sent by erts. Some examples of when this could happen is all port BIFs, i.e.
<code class="inline">open_port</code>, <code class="inline">port_command</code> etc etc.</p><p>Fix so that messages sent by nifs can be traced using normal and <code class="inline">seq_trace</code>
tracing.</p><p>Own Id: OTP-15038 Aux Id: ERL-602</p></li><li><p>Fixed specs and documentation for <code class="inline">process_info</code> item <code class="inline">monitored_by</code> to
include port identifiers and nif resources as possible types.</p><p>Own Id: OTP-15180 Aux Id: ERL-648</p></li><li><p>Fix bug in generation of erl_crash.dump, which could cause VM to crash.</p><p>Bug exist since erts-9.2 (OTP-20.2).</p><p>Own Id: OTP-15181</p></li><li><p>Fix bug where ctrl-break or ctrl-c would not trigger the break mode properly
on Windows. This bug was introduced in erts-10.0 (OTP-21).</p><p>Own Id: OTP-15205</p></li><li><p>Fix a performance bug for reception of UDP packages, where a memory buffer
would be reallocated when it should not have been.</p><p>Introduce a limit on the maximum automatic increase of the UDP user-space
buffer to the theoretical max of the network PATH, i.e. 65535.</p><p>Own Id: OTP-15206</p></li><li><p>Fix alignment of erts allocator state internally in erts. With the improper
alignment the emulator would refuse to start when compiled with clang on
32-bit systems.</p><p>Own Id: OTP-15208 Aux Id: PR-1897 ERL-677</p></li><li><p>Fix bug where too many concurrent calls to
<code class="inline">erlang:open_port({spawn,&quot;cmd&quot;},...)</code> would result in the emulator terminating
with the reason &quot;Failed to write to erl_child_setup: &quot;. After this fix the
<code class="inline">open_port</code> call will throw an <code class="inline">emfile</code> exception instead.</p><p>Own Id: OTP-15210</p></li><li><p>Upgraded the ERTS internal PCRE library from version 8.41 to version 8.42. See
<a href="http://pcre.org/original/changelog.txt">http://pcre.org/original/changelog.txt</a>
for information about changes made to PCRE. This library implements major
parts of the <a href="../../apps/stdlib/re.html"><code class="inline">re</code></a> regular expressions module.</p><p>Own Id: OTP-15217</p></li><li><p>Fix <code class="inline">open_port({fd,X,Y}, ...)</code> to release the file descriptors from the
pollset when closing the port. Without this fix the same file descriptor
number could not be reused when doing multiple open_port and port_close
sequences.</p><p>Own Id: OTP-15236 Aux Id: ERL-692</p></li><li><p>Fixed bug in <a href="erlang.html#float_to_list/2"><code class="inline">float_to_list/2</code></a> and
<a href="erlang.html#float_to_binary/2"><code class="inline">float_to_binary/2</code></a> with options
<code class="inline">[{decimals,0},compact]</code> causing totally wrong results. Bug exists since
OTP-21.0.</p><p>Own Id: OTP-15276 Aux Id: PR-1920</p></li><li><p>Fixed bug in <code class="inline">erlang:memory</code> causing <code class="inline">ets</code> to report too much. This small
false memory leak (16 bytes each time) can only happen when a specific race
condition occurs between scheduler threads on a table with option
<code class="inline">write_concurrency</code>.</p><p>Own Id: OTP-15278</p></li><li><p>Minor <code class="inline">configure</code> test fixes</p><p>Own Id: OTP-15282</p></li><li><p>Improved robustness of distribution connection setup. In OTP-21.0 a truly
asynchronous connection setup was introduced. This is further improvement on
that work to make the emulator more robust and also be able to recover in
cases when involved Erlang processes misbehave.</p><p>Own Id: OTP-15297 Aux Id: OTP-15279, OTP-15280</p></li></ul><h3 id="improvements-and-new-features-47" class="section-heading"><a href="#improvements-and-new-features-47" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The socket options <code class="inline">recvtos</code>, <code class="inline">recvttl</code>, <code class="inline">recvtclass</code> and <code class="inline">pktoptions</code> have
been implemented in the socket modules. See the documentation for the
<code class="inline">gen_tcp</code>, <code class="inline">gen_udp</code> and <code class="inline">inet</code> modules. Note that support for these in the
runtime system is platform dependent. Especially for <code class="inline">pktoptions</code> which is
very Linux specific and obsoleted by the RFCs that defined it.</p><p>Own Id: OTP-15145 Aux Id: ERIERL-187</p></li></ul><h2 id="erts-10-0-8" class="section-heading"><a href="#erts-10-0-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.0.8</span></h2><h3 id="fixed-bugs-and-malfunctions-204" class="section-heading"><a href="#fixed-bugs-and-malfunctions-204" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>As of ERTS version 10.0 (OTP 21.0) the <code class="inline">erl_child_setup</code> program, which
creates port programs, ignores <code class="inline">TERM</code> signals. This setting was
unintentionally inherited by port programs. Handling of <code class="inline">TERM</code> signals in port
programs has now been restored to the default behavior. That is, terminate the
process.</p><p>Own Id: OTP-15289 Aux Id: ERIERL-235, OTP-14943, ERL-576</p></li><li><p>The fix made for OTP-15279 in erts-10.07 (OTP-21.0.8) was not complete. It
could cause a new connection attempt to be incorrectly aborted in certain
cases. This fix will amend that flaw.</p><p>Own Id: OTP-15296 Aux Id: OTP-15279, ERIERL-226</p></li></ul><h2 id="erts-10-0-7" class="section-heading"><a href="#erts-10-0-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.0.7</span></h2><h3 id="fixed-bugs-and-malfunctions-205" class="section-heading"><a href="#fixed-bugs-and-malfunctions-205" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A process could get stuck in an infinite rescheduling loop between normal and
dirty schedulers. This bug was introduced in ERTS version 10.0.</p><p>Thanks to Maxim Fedorov for finding and fixing this issue.</p><p>Own Id: OTP-15275 Aux Id: PR-1943</p></li><li><p>Garbage collection of a distribution entry could cause an emulator crash if
<code class="inline">net_kernel</code> had not brought previous connection attempts on it down properly.</p><p>Own Id: OTP-15279 Aux Id: ERIERL-226</p></li></ul><h2 id="erts-10-0-6" class="section-heading"><a href="#erts-10-0-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.0.6</span></h2><h3 id="fixed-bugs-and-malfunctions-206" class="section-heading"><a href="#fixed-bugs-and-malfunctions-206" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A race between termination of a process and resume of the same process via
<a href="erlang.html#resume_process/1"><code class="inline">erlang:resume_process/1</code></a> could cause the VM to crash. This bug was introduced
in erts version 10.0 (OTP 21.0).</p><p>Own Id: OTP-15237</p></li><li><p>When tracing on <code class="inline">running</code>, <code class="inline">in</code> trace events could be lost when a process was
rescheduled between a dirty and a normal scheduler.</p><p>Own Id: OTP-15269 Aux Id: ERL-713</p></li></ul><h2 id="erts-10-0-5" class="section-heading"><a href="#erts-10-0-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.0.5</span></h2><h3 id="fixed-bugs-and-malfunctions-207" class="section-heading"><a href="#fixed-bugs-and-malfunctions-207" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug which caused an emulator crash when <code class="inline">enif_send()</code> was called by a
NIF that executed on a dirty scheduler. The bug was either triggered when the
NIF called <code class="inline">enif_send()</code> without a message environment, or when the process
executing the NIF was <code class="inline">send</code> traced.</p><p>Own Id: OTP-15223</p></li><li><p>Fixed a bug causing some Erlang references to be inconsistently ordered. This
could for example cause failure to look up certain elements with references as
keys in search data structures. This bug was introduced in R13B02.</p><p>Thanks to Simon Cornish for finding the bug and supplying a fix.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-15225</p></li></ul><h2 id="erts-10-0-4" class="section-heading"><a href="#erts-10-0-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.0.4</span></h2><h3 id="fixed-bugs-and-malfunctions-208" class="section-heading"><a href="#fixed-bugs-and-malfunctions-208" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug that prevented the <code class="inline">noshell</code> option from working correctly on Mac
OS X and BSD.</p><p>Own Id: OTP-15169</p></li><li><p>Fixed a crash when matching directly against a literal map using a single key
that had been saved on the stack.</p><p>Own Id: OTP-15184</p></li><li><p>Fix node crash when passing a bad time option to <a href="../../apps/kernel/file.html#read_file_info/2"><code class="inline">file:read_file_info/2</code></a>.</p><p>Own Id: OTP-15196</p></li></ul><h2 id="erts-10-0-3" class="section-heading"><a href="#erts-10-0-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.0.3</span></h2><h3 id="fixed-bugs-and-malfunctions-209" class="section-heading"><a href="#fixed-bugs-and-malfunctions-209" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a scheduler bug that caused normal schedulers to run dirty code.</p><p>Own Id: OTP-15154</p></li><li><p>Fixed a bug in <a href="erlang.html#trace_info/2"><code class="inline">erlang:trace_info/2</code></a> which caused the emulator to crash when a
bad argument was passed. The bug was introduced in ERTS version 10.0.</p><p>Own Id: OTP-15183 Aux Id: ERL-670</p></li></ul><h2 id="erts-10-0-2" class="section-heading"><a href="#erts-10-0-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.0.2</span></h2><h3 id="fixed-bugs-and-malfunctions-210" class="section-heading"><a href="#fixed-bugs-and-malfunctions-210" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a rare bug that could cause processes to be scheduled after they had
been freed.</p><p>Own Id: OTP-15067 Aux Id: ERL-573</p></li><li><p>Fixed a race condition in the inet driver that could cause receive to hang
when the emulator was compiled with gcc 8.</p><p>Own Id: OTP-15158 Aux Id: ERL-654</p></li></ul><h2 id="erts-10-0-1" class="section-heading"><a href="#erts-10-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-211" class="section-heading"><a href="#fixed-bugs-and-malfunctions-211" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The keys used in <code class="inline">os:getenv</code> and <code class="inline">os:putenv</code> are case-insensitive again on
Windows.</p><p>Own Id: OTP-15147 Aux Id: ERL-644</p></li></ul><h2 id="erts-10-0" class="section-heading"><a href="#erts-10-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 10.0</span></h2><h3 id="fixed-bugs-and-malfunctions-212" class="section-heading"><a href="#fixed-bugs-and-malfunctions-212" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The type specifications for <a href="../../apps/kernel/file.html#t:posix/0"><code class="inline">file:posix/0</code></a> and
<a href="../../apps/kernel/inet.html#t:posix/0"><code class="inline">inet:posix/0</code></a> have been updated according to which errors
file and socket operations should be able to return.</p><p>Own Id: OTP-14019 Aux Id: ERL-550</p></li><li><p>Fix error printout from run_erl and a bug that could cause unintended fds to
be leaked into the started program.</p><p>Own Id: OTP-14537 Aux Id: PR1529</p></li><li><p>File operations used to accept <a href="../../apps/kernel/file.html#t:name_all/0">filenames</a> containing
null characters (integer value zero). This caused the name to be truncated and
in some cases arguments to primitive operations to be mixed up. Filenames
containing null characters inside the filename are now <em>rejected</em> and will
cause primitive file operations to fail.</p><p>Also environment variable operations used to accept
<a href="../../apps/kernel/os.html#t:env_var_name/0">names</a> and <a href="../../apps/kernel/os.html#t:env_var_value/0">values</a> of
environment variables containing null characters (integer value zero). This
caused operations to silently produce erroneous results. Environment variable
names and values containing null characters inside the name or value are now
<em>rejected</em> and will cause environment variable operations to fail.</p><p>Primitive environment variable operations also used to accept the <code class="inline">$=</code>
character in environment variable names causing various problems. <code class="inline">$=</code>
characters in environment variable names are now also <em>rejected</em>.</p><p>Also <a href="../../apps/kernel/os.html#cmd/1"><code class="inline">os:cmd/1</code></a> now reject null characters inside its
<a href="../../apps/kernel/os.html#t:os_command/0">command</a>.</p><p><a href="erlang.html#open_port/2"><code class="inline">erlang:open_port/2</code></a> will also reject null characters inside the port name
from now on.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14543 Aux Id: ERL-370</p></li><li><p>Fix bugs related to the bookkeeping of microstate accounting states.</p><p>Own Id: OTP-14652</p></li><li><p><code class="inline">os:putenv</code> and <code class="inline">os:getenv</code> no longer access the process environment directly
and instead work on a thread-safe emulation. The only observable difference is
that it's <em>not</em> kept in sync with libc <code class="inline">getenv(3)</code> / <code class="inline">putenv(3)</code>, so those who
relied on that behavior in drivers or NIFs will need to add manual
synchronization.</p><p>On Windows this means that you can no longer resolve DLL dependencies by
modifying the <code class="inline">PATH</code> just before loading the driver/NIF. To make this less of
a problem, the emulator now adds the target DLL's folder to the DLL search
path.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14666</p></li><li><p>Corrected <code class="inline">erlang:is_builtin(erlang, M, F)</code> to return <code class="inline">true</code> for
<a href="erlang.html#apply/2"><code class="inline">apply/2</code></a> and <code class="inline">yield/0</code>.</p><p>Own Id: OTP-14713 Aux Id: ERL-500</p></li><li><p>Fixed a bug where the PATH environment variable wasn't updated correctly on a
release downgrade, effectively keeping the PATH of the new release.</p><p>Own Id: OTP-14719</p></li><li><p>A receive optimization that avoids scanning the entire message queue when
receiving a message containing a freshly created reference could in rare
circumstances (involving recursive calls to the functions that does the
receive) cause the receive to hang. This has been corrected.</p><p>Own Id: OTP-14782 Aux Id: ERL-511</p></li><li><p>Fix building of Erlang/OTP on platforms which have small data area with short
addressing. For example the PowerPC/RTEMS platform.</p><p>Own Id: OTP-14909 Aux Id: PR-1692</p></li><li><p>Fixed a crash when <code class="inline">enif_make_binary</code> is called with a binary produced by
<code class="inline">enif_inspect_binary</code> in a different environment.</p><p>Own Id: OTP-14931</p></li><li><p>Fixed a crash when <code class="inline">enif_make_binary</code> is called more than once with a binary
that had previously been added to an <code class="inline">enif_ioq</code>.</p><p>Own Id: OTP-14932</p></li><li><p>The erl_child_setup program now ignores SIGTERM signals.</p><p>Own Id: OTP-14943 Aux Id: ERL-576</p></li><li><p>Force 64-bit alignment on pre-allocators on architectures which needs it.</p><p>Own Id: OTP-14977</p></li><li><p>Fixed a bug where dirty scheduler picked up non-dirty work.</p><p>Own Id: OTP-14978</p></li><li><p>Calls to <a href="../../apps/kernel/gen_tcp.html#send/2"><code class="inline">gen_tcp:send/2</code></a> on closed sockets now returns <code class="inline">{error, closed}</code>
instead of <code class="inline">{error,enotconn}</code>.</p><p>Own Id: OTP-15001</p></li><li><p><a href="erlang.html#monotonic_time/1"><code class="inline">erlang:monotonic_time/1</code></a> failed with <code class="inline">badarg</code> when passing the <code class="inline">perf_counter</code>
time unit as argument.</p><p>Own Id: OTP-15008</p></li><li><p>Fix bug where rapid <code class="inline">init:restart()</code> calls would sometimes crash because a
code load request leaked in between the restarts.</p><p>Own Id: OTP-15013</p></li><li><p>Improve <a href="erlang.html#float_to_list/2"><code class="inline">float_to_list(F, [{decimals,D}])</code></a> to closer
conform with <code class="inline">io_lib:format(&quot;~.*f&quot;, [D,F])</code>.</p><p>There are however, still cases when <code class="inline">float_to_list</code> does not produce the exact
same result as <code class="inline">io_lib:format</code>, especially for large values <code class="inline">F</code> and/or many
decimals <code class="inline">D</code>.</p><p>Own Id: OTP-15015 Aux Id: OTP-14890</p></li><li><p>Fixed a deadlock that would occur on certain allocators when a reallocation
failed with <code class="inline">+ramv</code> enabled.</p><p>Own Id: OTP-15024</p></li><li><p>Fix bug that made it impossible to use an erl_tracer as the seq_trace trace
receiver.</p><p>Own Id: OTP-15029</p></li><li><p>Fix bug where a large (&gt; 1 GB) emulator generated error logger message would
cause the emulator to crash.</p><p>Own Id: OTP-15032</p></li><li><p>The emulator will no longer crash when reading the file information of an
ordinary file that has an NTFS reparse point, such as files stored in a
OneDrive-mapped folder.</p><p>Own Id: OTP-15062 Aux Id: ERL-615</p></li><li><p>Fixed bug in <code class="inline">enif_binary_to_term</code> which could cause memory corruption for
immediate terms (atoms, small integers, pids, ports, empty lists).</p><p>Own Id: OTP-15080</p></li><li><p>Fixed bug in <a href="erlang.html#system_profile/2"><code class="inline">erlang:system_profile/2</code></a> that could cause superfluous
<code class="inline">{profile,_,active,_,_}</code> messages for terminating processes.</p><p>Own Id: OTP-15085</p></li><li><p>On OSs with per thread CPU time support, change <code class="inline">cpu_timestamp</code> in
<a href="erlang.html#trace/3"><code class="inline">erlang:trace/3</code></a> to use it instead of per process CPU time. This makes this
option usable on such OSs when running multiple schedulers.</p><p>Own Id: OTP-15090</p></li><li><p>Fix segfault in abort_signal_task which could happen if a port terminated
while there were outstanding port tasks that were not signals, for example a
ready_input/ready_output event.</p><p>Own Id: OTP-15108 Aux Id: ERL-621</p></li><li><p>Fixed bug in <code class="inline">ets</code> that could cause VM crash if process A terminates after
fixating a table and process B deletes the table at &quot;the same time&quot;. The table
fixation could be done with <code class="inline">ets:safe_fixtable</code> or if process A terminates in
the middle of a long running <code class="inline">select</code> or <code class="inline">match</code> call.</p><p>Own Id: OTP-15109</p></li><li><p>Owner and group changes through <code class="inline">file:write_file_info</code>, <code class="inline">file:change_owner</code>,
and <code class="inline">file:change_group</code> will no longer report success on permission errors.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-15118</p></li><li><p>Fix a bug error reporting from escripts on windows where the error message
would get garbled.</p><p>Own Id: OTP-15119 Aux Id: PR-1826</p></li><li><p>Fix segfault when a process is internally re-scheduled while being traced for
in out events. This bug was introduced in erts-8.0 (OTP-19.0).</p><p>Own Id: OTP-15125</p></li></ul><h3 id="improvements-and-new-features-48" class="section-heading"><a href="#improvements-and-new-features-48" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>It is now possible to open device files and FIFOs with <a href="../../apps/kernel/file.html#open/2"><code class="inline">file:open/2</code></a>.</p><p>Own Id: OTP-11462</p></li><li><p>The <code class="inline">erlang:system_flag(scheduler_wall_time,Bool)</code> call is now reference
counted and will be turned off if the (last) process that started the
performance statistics dies. Thus it is no longer possible to start the
statistics with
<code class="inline">rpc:call(Node, erlang, system_flag, [scheduler_wall_time, true])</code> since it
will be turned off directly afterwards when the rpc process dies.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-11694</p></li><li><p>A new logging API is added to Erlang/OTP, see the <a href="../../apps/kernel/logger.html"><code class="inline">logger</code></a> manual page, and
section <a href="../../apps/kernel/logger_chapter.html">Logging</a> in the Kernel User's Guide.</p><p>Calls to <code class="inline">error_logger</code> are automatically redirected to the new API, and
legacy error logger event handlers can still be used. It is, however,
recommended to use the Logger API directly when writing new code.</p><p>Notice the following potential incompatibilities:</p><ul><li><p>Kernel configuration parameters <code class="inline">error_logger</code> still works, but is overruled
if the default handler's output destination is configured with Kernel
configuration parameter <code class="inline">logger</code>.</p><p>In general, parameters for configuring error logger are overwritten by new
parameters for configuring Logger.</p></li><li><p>The concept of SASL error logging is deprecated, meaning that by default the
SASL application does not affect which log events are logged.</p><p>By default, supervisor reports and crash reports are logged by the default
Logger handler started by Kernel, and end up at the same destination
(terminal or file) as other standard log event from Erlang/OTP.</p><p>Progress reports are not logged by default, but can be enabled by setting
the primary log level to info, for example with the Kernel configuration
parameter <code class="inline">logger_level</code>.</p><p>To obtain backwards compatibility with the SASL error logging functionality
from earlier releases, set Kernel configuration parameter
<code class="inline">logger_sasl_compatible</code> to <code class="inline">true</code>. This prevents the default Logger handler
from logging any supervisor-, crash-, or progress reports. Instead, SASL
adds a separate Logger handler during application start, which takes care of
these log events. The SASL configuration parameters <code class="inline">sasl_error_logger</code> and
<code class="inline">sasl_errlog_type</code> specify the destination (terminal or file) and severity
level to log for these events.</p></li></ul><p>Since Logger is new in Erlang/OTP 21.0, we do reserve the right to introduce
changes to the Logger API and functionality in patches following this release.
These changes might or might not be backwards compatible with the initial
version.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-13295</p></li><li><p><a href="../../apps/kernel/gen_sctp.html#connect_init/4"><code class="inline">gen_sctp:connect_init/4</code></a> or rather connect in <code class="inline">inet_drv.c</code> for SCTP has been
fixed to not check the write file descriptor for writeability after a connect,
since for SCTP (SOCK_SEQPACKET) that property does not seem to be any kind of
indicator for when a connect has finished. This fixes connects that the OS
returned as &quot;in progress&quot; that was misinterpreted by <code class="inline">gen_sctp:connect_init</code>
as failed.</p><p>Own Id: OTP-13760 Aux Id: PR-1592</p></li><li><p>The file driver has been rewritten as a NIF, decreasing the latency of file
operations. Notable incompatibilities are:</p><ul><li>The <code class="inline">use_threads</code> option for <a href="../../apps/kernel/file.html#sendfile/5"><code class="inline">file:sendfile/5</code></a> no longer has any effect; we
either use non-blocking <code class="inline">sendfile(2)</code> or fall back to <code class="inline">file:read</code> +
<code class="inline">gen_tcp:send</code>.</li><li>The file-specific DTrace probes have been removed. The same effect can be
achieved with normal tracing together with the <code class="inline">nif__entry</code>/<code class="inline">nif__return</code>
probes to track scheduling.</li></ul><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14256</p></li><li><p>The I/O polling functionality of erts has been re-written to better make use
of the OSs polling mechanisms. This change means that erts will now always
prefer to use a kernel-polling mechanism if possible. Also all of the I/O
polling has been moved to dedicated threads instead of being placed in the
scheduler loops.</p><p>As a result of this, the <code class="inline">erl</code> options <code class="inline">+K</code> and <code class="inline">+secio</code> have been removed. It
is still possible to disable kernel-poll, but it has to be done at compile
time through the configure option <code class="inline">--disable-kernel-poll</code>.</p><p>The new <code class="inline">erl</code> options <a href="erl_cmd.html#%2BIOt"><code class="inline">+IOt</code></a> and
<a href="erl_cmd.html#%2BIOp"><code class="inline">+IOp</code></a> can be used to change how many IO poll threads and
poll sets that erts should use. See their respective documentation for more
details.</p><p>Own Id: OTP-14346</p></li><li><p>Truly asynchronous auto-connect. Earlier, when <code class="inline">erlang:send</code> was aimed toward
an unconnected node, the function would not return until the connection setup
had completed (or failed). Now the function returns directly after the message
has been enqueued and the connection setup started.</p><p>The same applies to all distributed operations that may trigger auto-connect,
i.e. <code class="inline">'!'</code>, <code class="inline">send</code>, <code class="inline">link</code>, <code class="inline">monitor</code>, <code class="inline">monitor_node</code>, <a href="erlang.html#exit/2"><code class="inline">exit/2</code></a>
and <code class="inline">group_leader</code>.</p><p>The interface for all these functions are unchanged as they do not return
connection failures. The only exception is <code class="inline">erlang:monitor</code> where a <em>possible
incompatibility</em> is introduced: An attempt to monitor a process on a primitive
node (such as erl_interface or jinterface), where remote process monitoring is
not implemented, will no longer fail with <code class="inline">badarg</code> exception. Instead a
monitor will be created, but it will only supervise the connection to the
node.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14370</p></li><li><p>Changed the default behaviour of <code class="inline">.erlang</code> loading: <code class="inline">.erlang</code> is no longer
loaded from the current directory. <code class="inline">c:erlangrc(PathList)</code> can be used to
search and load an <code class="inline">.erlang</code> file from user specified directories.</p><p><code class="inline">escript</code>, <code class="inline">erlc</code>, <code class="inline">dialyzer</code> and <code class="inline">typer</code> no longer load an <code class="inline">.erlang</code> at all.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14439</p></li><li><p>New functionality for implementation of alternative carriers for the Erlang
distribution has been introduced. This mainly consists of support for usage of
distribution controller processes (previously only ports could be used as
distribution controllers). For more information see
<a href="alt_dist.html#distribution-module">ERTS User's Guide âžœ How to implement an Alternative Carrier for the Erlang Distribution âžœ Distribution Module</a>.</p><p>Own Id: OTP-14459</p></li><li><p>Add support for the lcc compiler and in extension the Elbrus 2000 platform.</p><p>Own Id: OTP-14492</p></li><li><p>Support for &quot;tuple calls&quot; have been removed from the run-time system. Tuple
calls was an undocumented and unsupported feature which allowed the module
argument for an apply operation to be a tuple: <code class="inline">Var = dict:new(), Var:size()</code>.
This &quot;feature&quot; frequently caused confusion, especially when such call failed.
The stacktrace would point out functions that don't exist in the source code.</p><p>For legacy code that need to use parameterized modules or tuple calls for some
other reason, there is a new compiler option called <code class="inline">tuple_calls</code>. When this
option is given, the compiler will generate extra code that emulates the old
behavior for calls where the module is a variable.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14497</p></li><li><p>Creation of small maps with literal keys has been optimized to be faster and
potentially use less memory. The keys are combined into a literal key tuple
which is put into the literal pool. The key tuple can be shared between many
instances of maps having the same keys.</p><p>Own Id: OTP-14502</p></li><li><p>When an exception is thrown, include the arguments of the call in the
stacktrace for BIFs <code class="inline">band</code>, <code class="inline">bor</code>, <code class="inline">bsl</code>, <code class="inline">bsr</code>, <code class="inline">bxor</code>, <code class="inline">div</code>, <code class="inline">rem</code> and the
operators <code class="inline">+</code>, <code class="inline">-</code>, <code class="inline">*</code> and <code class="inline">/</code>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14508</p></li><li><p>The non-smp emulators have been removed. This means that the configure options
<code class="inline">--disable-threads</code> and <code class="inline">--enable-plain-emulator</code> have been removed and
configure will now refuse to build Erlang/OTP on platforms without thread
support.</p><p>In order to achieve a similar setup as the non-smp emulator, it is possible to
start Erlang/OTP with the <code class="inline">+S 1</code> option.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14518</p></li><li><p>Modules that use floating point constants compiled with R15 or earlier will
need to be re-compiled before they can be loaded.</p><p>Own Id: OTP-14575</p></li><li><p>Implementation of true asynchronous signaling between processes in order to
improve scalability. Signals affected include exit, monitor, demonitor,
monitor triggered, link, unlink, and group leader.</p><p>Own Id: OTP-14589</p></li><li><p>Added a PGO (profile guided optimization) pass to the build step of erts. This
can be disabled by passing --disable-pgo to configure.</p><p>Own Id: OTP-14604</p></li><li><p>Improved the performance of <code class="inline">binary:split</code> and <code class="inline">binary:match</code>.</p><p>Own Id: OTP-14610 Aux Id: PR-1480</p></li><li><p>It is not longer possible to disable dirty schedulers when building erlang.</p><p>Own Id: OTP-14613</p></li><li><p>Loaded BEAM code in a 64-bit system requires less memory because of better
packing of operands for instructions.</p><p>These memory savings were achieved by major improvements to the <code class="inline">beam_makeops</code>
scripts used when building the run time system and BEAM compiler. There is
also new for documentation for <code class="inline">beam_makeops</code> that describes how new BEAM
instructions and loader transformations can be implemented. The documentation
is found in here in a source directory or git repository:
erts/emulator/internal_doc/beam_makeops.md. An online version can be found
here:
<a href="https://github.com/erlang/otp/blob/master/erts/emulator/internal_doc/beam_makeops.md">https://github.com/erlang/otp/blob/master/erts/emulator/internal_doc/beam_makeops.md</a></p><p>Own Id: OTP-14626</p></li><li><p><code class="inline">file:read_file</code> has been changed to read the content of files that report a
size of 0 even when data can be read from them. An example of such a file is
<code class="inline">/proc/cpuinfo</code> on Linux.</p><p>Own Id: OTP-14637 Aux Id: ERL-327 PR-1524</p></li><li><p>It is no longer possible to disable the <code class="inline">temp_alloc</code> allocator. Disabling it
caused serious performance degradations and was never what was wanted.</p><p>Own Id: OTP-14651</p></li><li><p>The reduction cost of sending messages is now constant. It will no longer
scale according to the length of the receiving process' message queue.</p><p>Own Id: OTP-14667</p></li><li><p>Improved loading of modules with <code class="inline">-on_load</code> directive, to no longer block all
schedulers when the load operation is completed.</p><p>Own Id: OTP-14680</p></li><li><p>On platforms with real-time signals available, SIGRTMIN+1 is now used as the
internal scheduler suspend signal instead of SIGUSR2.</p><p>Own Id: OTP-14682</p></li><li><p>When the value returned from a '<code class="inline">catch</code>' expression is ignored, no stacktrace
will be built if an exception is caught. That will save time and produce less
garbage. There are also some minor optimizations of '<code class="inline">try</code>/<code class="inline">catch</code>' both in
the compiler and run-time system.</p><p>Own Id: OTP-14683</p></li><li><p>The guarantees and non-guarantees of <code class="inline">erlang:get_stacktrace/0</code> are now
documented.</p><p>Own Id: OTP-14687</p></li><li><p>There is a new syntax in '<code class="inline">try/catch</code>' for retrieving the stacktrace without
calling '<code class="inline">erlang:get_stacktrace/0</code>'. See the reference manual for a
description of the new syntax. The '<code class="inline">erlang:get_stacktrace/0</code>' BIF is now
deprecated.</p><p>Own Id: OTP-14692</p></li><li><p>New 'used' option for <a href="erlang.html#binary_to_term/2"><code class="inline">binary_to_term/2</code></a> that will also
return number of bytes actually read from the binary. This enables easy access
to any extra data in the binary located directly after the returned term.</p><p>Own Id: OTP-14780</p></li><li><p>Added more statistics for <code class="inline">erlang:system_info({allocator,A})</code> in the
<code class="inline">mbcs_pool</code> section.</p><p>Own Id: OTP-14795 Aux Id: ERL-88</p></li><li><p>Added <code class="inline">enif_ioq_peek_head</code> to retrieve Erlang terms from NIF IO queues without
having to resort to copying.</p><p>Own Id: OTP-14797</p></li><li><p>There is a new option '<code class="inline">makedep_side_effect</code>' for the compiler and <code class="inline">-MMD</code> for
'<code class="inline">erlc</code>' that generates dependencies and continues to compile as normal.</p><p>Own Id: OTP-14830</p></li><li><p>Added <a href="../../apps/stdlib/ets.html#whereis/1"><code class="inline">ets:whereis/1</code></a> for retrieving the table identifier of a named table.</p><p>Own Id: OTP-14884</p></li><li><p><code class="inline">seq_trace</code> labels may now be any erlang term.</p><p>Own Id: OTP-14899</p></li><li><p>Optimized the common case of <code class="inline">monitor</code> followed by <code class="inline">send</code> to the same local
process. The monitor signal is now delayed in order to be piggybacked with the
sent message and thereby only get one lock operation on the message queue of
the receiver. A delayed monitor signal is flushed if no <code class="inline">send</code> has been done
at the latest when the process is scheduled out.</p><p>Own Id: OTP-14901</p></li><li><p>Make hipe compiled code work on x86_64 (amd64) with OS security feature PIE,
where executable code can be loaded into a random location. Old behavior, if
hipe was enabled, was to disable PIE build options for the VM.</p><p>Own Id: OTP-14903</p></li><li><p>The number of driver async threads will now default to 1 as the standard
drivers do not use them anymore. Users that changed this value to tweak the
file driver should replace <code class="inline">+A</code> with <code class="inline">+SDio</code> since it now uses dirty IO
schedulers instead of async threads.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14928</p></li><li><p>Optimize <code class="inline">==</code> and <code class="inline">/=</code> for binaries with different sizes to be constant in
time instead of proportional to the size of their common prefix.</p><p>Own Id: OTP-14934 Aux Id: PR-1708</p></li><li><p>Refactorings making some internal process flags available for other usage.</p><p>Own Id: OTP-14948</p></li><li><p>Removed need for HiPE to allocate native executable memory in low 2GB address
space on x86_64. Command line option <code class="inline">+MXscs</code> is thereby obsolete and ignored.</p><p>Own Id: OTP-14951</p></li><li><p>Added <code class="inline">enif_make_map_from_arrays</code> for creating a populated map, analogous to
<code class="inline">enif_make_list_from_array</code>.</p><p>Own Id: OTP-14954</p></li><li><p>Added configuration switches for busy-wait and wake up thresholds for dirty
schedulers, and changing these settings for normal schedulers will no longer
affect dirty schedulers.</p><p>Refer to the documentation for details. The new switches are
<a href="erl_cmd.html#%2Bsbwtdcpu">+sbwtdcpu</a>, <a href="erl_cmd.html#%2Bsbwtdio">+sbwtdio</a>,
<a href="erl_cmd.html#%2Bswtdcpu">+swtdcpu</a>, and <a href="erl_cmd.html#%2Bswtdio">+swtdio</a>.</p><p>The default busy wait threshold for dirty scheduler threads has also been
lowered to <code class="inline">short</code>.</p><p>Own Id: OTP-14959</p></li><li><p>The list of &quot;taints&quot; now also includes dynamic loaded drivers in addition to
NIF libraries. Statically linked drivers and NIF libraries that are part of
erts are not included. The &quot;taints&quot; are returned by <code class="inline">system_info(taints)</code> and
printed in the header of <code class="inline">erl_crash.dump</code> files.</p><p>Own Id: OTP-14960</p></li><li><p>Added <code class="inline">instrument:allocations</code> and <code class="inline">instrument:carriers</code> for retrieving
information about memory utilization and fragmentation.</p><p>The old <code class="inline">instrument</code> interface has been removed, as have the related options
<code class="inline">+Mim</code> and <code class="inline">+Mis</code>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14961</p></li><li><p>The process suspend functionality used by the <a href="erlang.html#suspend_process/2"><code class="inline">erlang:suspend_process/2</code></a> BIF
has been reimplemented using the newly introduced true asynchronous signaling
between processes. This mainly to reduce memory usage in the process control
block of all processes, but also in order to simplify the implementation.</p><section role="note" class="admonition warning"><h4 class="admonition-title warning">Warning</h4><p>You can easily create deadlocks if processes suspends each other (directly
or in circles). In ERTS versions prior to ERTS version 10.0, the runtime
system prevented such deadlocks, but this prevention has now been removed
due to performance reasons.</p></section><p>Other ERTS internal functionality that used the previous process suspend
functionality have also been reimplemented to use asynchronous signaling
instead.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14964 Aux Id: OTP-14589</p></li><li><p>Added the <code class="inline">nifs</code> option to <code class="inline">?MODULE:module_info/1</code> for listing a module's
installed NIF functions.</p><p>Own Id: OTP-14965</p></li><li><p>New implementation of <code class="inline">erlang:process_info/[1,2]</code>.</p><p>In the general case when inspecting another process, the new implementation
sends an asynchronous process-info request signal to the other process and
waits for the result instead of locking the other process and reading the
result directly. In some special cases where no conflicts occur, signal order
won't be violated, and the amount of data requested is guaranteed to be small,
the inspected process may be inspected directly.</p><p>Appropriate amount of reductions are now also bumped when inspecting a
process.</p><p>Own Id: OTP-14966</p></li><li><p>Removed process start time from crash dump in order to save memory in process
control block.</p><p>Own Id: OTP-14975 Aux Id: PR-1597</p></li><li><p>Optimize <a href="erlang.html#put/2"><code class="inline">erlang:put/2</code></a> when updating existing key with a new immediate value
(atom, small integer, pid, port).</p><p>Own Id: OTP-14976</p></li><li><p><a href="erlang.html#process_info/1"><code class="inline">erlang:process_info/1</code></a> has been changed to no longer include <code class="inline">messages</code> by
default. Instead <a href="erlang.html#process_info/2"><code class="inline">erlang:process_info/2</code></a> should be used.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14986 Aux Id: PR-1745</p></li><li><p>New <code class="inline">erlang:system_info(ets_count)</code> to get total number of ets tables existing
at the local node.</p><p>Own Id: OTP-14987</p></li><li><p>New NIF functions: <code class="inline">enif_mutex_name</code>, <code class="inline">enif_cond_name</code>, <code class="inline">enif_rwlock_name</code>,
<code class="inline">enif_thread_name</code>, <code class="inline">enif_vfprintf</code>, <code class="inline">enif_vsnprintf</code>.</p><p>Own Id: OTP-14994</p></li><li><p>When <code class="inline">erlang:system_flag(backtrace_depth, 0)</code> has been called, all exceptions
will now contain the entry for <em>one</em> function (despite the zero). It used to
be that a hand-made stack backtrace passed to <a href="erlang.html#raise/3"><code class="inline">erlang:raise/3</code></a> would be
truncated to an empty list.</p><p>Own Id: OTP-15026</p></li><li><p>Fixed bug for named <code class="inline">ets</code> tables which could cause unexpected results from
matchspec iteration functions (<code class="inline">ets:select*</code> and <code class="inline">ets:match*</code>) if the table
was deleted and recreated with the same name during the iteration. The
iteration could incorrectly continue through the recreated table. The expected
correct behavior is now for the iteration call to fail with a <code class="inline">badarg</code>
exception if the table is deleted before the iteration has completed.</p><p>Own Id: OTP-15031</p></li><li><p>Two new guards BIFs operating on maps have been added:
<a href="erlang.html#map_get/2"><code class="inline">map_get/2</code></a> and <a href="erlang.html#is_map_key/2"><code class="inline">is_map_key/2</code></a>. They do the
same as <a href="../../apps/stdlib/maps.html#get/2"><code class="inline">maps:get/2</code></a> and <a href="../../apps/stdlib/maps.html#is_key/2"><code class="inline">maps:is_key/2</code></a>, respectively, except that they are
allowed to be used in guards.</p><p>Own Id: OTP-15037 Aux Id: PR-1784, PR-1802</p></li><li><p>Release run-queue lock while cleaning up terminated dirty process.</p><p>Own Id: OTP-15081</p></li><li><p>The callback module passed as <code class="inline">-epmd_module</code> to erl has been expanded to be
able to do name and port resolving.</p><p>Documentation has also been added in the <a href="../../apps/kernel/erl_epmd.html"><code class="inline">erl_epmd</code></a> reference manual and
ERTS User's Guide
<a href="alt_disco.html">How to Implement an Alternative Node Discovery for Erlang Distribution</a>.</p><p>Own Id: OTP-15086 Aux Id: PR-1694</p></li></ul><h2 id="erts-9-3-3-15" class="section-heading"><a href="#erts-9-3-3-15" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3.15</span></h2><h3 id="fixed-bugs-and-malfunctions-213" class="section-heading"><a href="#fixed-bugs-and-malfunctions-213" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A process could end up in a state where it got endlessly rescheduled without
making any progress. This occurred when a system task, such as check of
process code (part of a code purge), was scheduled on a high priority process
trying to execute on a dirty scheduler.</p><p>Own Id: OTP-16436 Aux Id: ERL-1152</p></li><li><p>Fixed bug in <a href="erlang.html#list_to_ref/1"><code class="inline">erlang:list_to_ref/1</code></a> when called with a reference created by a
remote note. Function <a href="erlang.html#list_to_ref/1"><code class="inline">list_to_ref/1</code></a> is intended for
debugging and not to be used in application programs. Bug exist since OTP
20.0.</p><p>Own Id: OTP-16438</p></li><li><p>A process could get into an inconsistent state where it was runnable, but
never scheduled for execution. This could occur when a mix of <code class="inline">normal</code> and
<code class="inline">low</code> priority processes where scheduled on the same type of dirty scheduler
simultaneously.</p><p>Own Id: OTP-16446 Aux Id: ERL-1157</p></li><li><p>Fixed erroneous mapping of exit reason from <code class="inline">kill</code> to <code class="inline">killed</code> on reception of
some exit signals due to a broken link. This bug has existed since ERTS
version 5.5.2 (OTP R11).</p><p>This bug was also unknowingly fixed in ERTS version 10.0 (OTP 21.0) due to a
new ERTS internal implementation of signaling between processes.</p><p>Own Id: OTP-16465 Aux Id: ERL-1165, OTP-6160, OTP-14589</p></li><li><p>Corrected the valid range of the <code class="inline">erl</code> command line argument
<a href="erl_cmd.html#%2BSDio"><code class="inline">+SDio &lt;NumberOfDirtyIoSchedulers&gt;</code></a> from <code class="inline">0..1024</code> to
<code class="inline">1..1024</code>. <code class="inline">+SDio 0</code> was erroneously allowed which just caused the VM to crash
on the first dirty I/O job scheduled.</p><p>Own Id: OTP-16481</p></li></ul><h2 id="erts-9-3-3-14" class="section-heading"><a href="#erts-9-3-3-14" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3.14</span></h2><h3 id="fixed-bugs-and-malfunctions-214" class="section-heading"><a href="#fixed-bugs-and-malfunctions-214" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A process calling
<a href="erlang.html#system_flag_multi_scheduling"><code class="inline">erlang:system_flag(multi_scheduling, block)</code></a>
could end up blocked waiting for the operation to complete indefinitely.</p><p>Own Id: OTP-16379</p></li></ul><h2 id="erts-9-3-3-13" class="section-heading"><a href="#erts-9-3-3-13" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3.13</span></h2><h3 id="fixed-bugs-and-malfunctions-215" class="section-heading"><a href="#fixed-bugs-and-malfunctions-215" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A literal area could prematurely be released before all uses of it had been
removed. This occurred either when a terminating process had a complex exit
reason referring to a literal that concurrently was removed, or when a
terminating process continued executing a dirty NIF accessing a literal (via
the heap) that concurrently was removed.</p><p>Own Id: OTP-16193</p></li></ul><h2 id="erts-9-3-3-12" class="section-heading"><a href="#erts-9-3-3-12" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3.12</span></h2><h3 id="fixed-bugs-and-malfunctions-216" class="section-heading"><a href="#fixed-bugs-and-malfunctions-216" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The runtime system disconnected a connection if it received an
<a href="erlang.html#exit/2"><code class="inline">exit/2</code></a> signal where the recipient was a process on an old
incarnation of the current node. That is, the receiving node had the same node
name, but another &quot;creation&quot; number. The signal will now just be dropped since
the receiving process no longer exists.</p><p>Own Id: OTP-15867 Aux Id: ERIERL-373</p></li><li><p>Fix a bug in <code class="inline">binary_to_term</code> that would crash the emulator if a term larger
than 16GB was to be decoded.</p><p>Own Id: OTP-16058 Aux Id: PR-2382</p></li><li><p>When communicating with a simultaneously exiting port via the
<code class="inline">erlang:port_*()</code> BIFs one could sometimes get stray <code class="inline">{Ref, What}</code> messages.
Where <code class="inline">Ref</code> was a reference and <code class="inline">What</code> usually were the atom <code class="inline">badarg</code>.</p><p>Own Id: OTP-16107 Aux Id: ERL-1049</p></li></ul><h2 id="erts-9-3-3-11" class="section-heading"><a href="#erts-9-3-3-11" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3.11</span></h2><h3 id="fixed-bugs-and-malfunctions-217" class="section-heading"><a href="#fixed-bugs-and-malfunctions-217" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a buffer overflow when
<a href="erlang.html#binary_to_existing_atom/2"><code class="inline">binary_to_existing_atom/2</code></a> and
<code class="inline">list_to_existing_atom/2</code> was used with the <code class="inline">latin1</code> encoding.</p><p>Own Id: OTP-15819 Aux Id: ERL-944</p></li></ul><h2 id="erts-9-3-3-10" class="section-heading"><a href="#erts-9-3-3-10" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3.10</span></h2><h3 id="fixed-bugs-and-malfunctions-218" class="section-heading"><a href="#fixed-bugs-and-malfunctions-218" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixes of install/release phase in build system.</p><ul><li>The source tree was modified when installing/releasing and/or applying a
patch.</li><li>Some files were installed with wrong access rights.</li><li>If applying a patch (using <code class="inline">otp_patch_apply</code>) as another user (except root)
than the user that built the source, the documentation was not properly
updated.</li></ul><p>Own Id: OTP-15551</p></li><li><p>Minor fixes for <code class="inline">make clean</code>.</p><p>Own Id: OTP-15657</p></li><li><p>Fixed a bug in all <code class="inline">ets:select*</code> and <code class="inline">ets:match*</code> functions that could in some
rare cases lead to very poor performance.</p><p>Own Id: OTP-15660 Aux Id: ERL-869</p></li><li><p>Fix a possible deadlock when terminating the ERTS caused by a dirty scheduler
not releasing it's run-queue lock when terminating.</p><p>Own Id: OTP-15690 Aux Id: PR-2172</p></li><li><p>Add missing documentation of new external tags <code class="inline">NEW_PID</code>, <code class="inline">NEW_PORT</code> and
<code class="inline">NEWER_REFERENCE</code> introduced in OTP 19.</p><p>These new tags are planned to be &quot;activated&quot; in OTP 23 when distribution
capability flag <code class="inline">DFLAG_BIG_CREATION</code> becomes mandatory. Older nodes (&gt;= 19)
are able to decode these new tags and send them back to the new node. Nodes
older than OTP 23 will however never encode their own local pids, ports and
references using the new tags.</p><p>Own Id: OTP-15766</p></li></ul><h2 id="erts-9-3-3-9" class="section-heading"><a href="#erts-9-3-3-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3.9</span></h2><h3 id="improvements-and-new-features-49" class="section-heading"><a href="#improvements-and-new-features-49" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Added an optional <code class="inline">./configure</code> flag to compile the emulator with spectre
mitigation: <code class="inline">--with-spectre-mitigation</code></p><p>Note that this requires a recent version of GCC with support for spectre
mitigation and the <code class="inline">--mindirect-branch=thunk</code> flag, such as <code class="inline">8.1</code>.</p><p>Own Id: OTP-15430 Aux Id: ERIERL-237</p></li></ul><h2 id="erts-9-3-3-8" class="section-heading"><a href="#erts-9-3-3-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3.8</span></h2><h3 id="fixed-bugs-and-malfunctions-219" class="section-heading"><a href="#fixed-bugs-and-malfunctions-219" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A bug that could cause dirty schedulers to become unresponsive has been fixed.</p><p>Own Id: OTP-15509 Aux Id: PR-2027, PR-2093</p></li></ul><h2 id="erts-9-3-3-7" class="section-heading"><a href="#erts-9-3-3-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3.7</span></h2><h3 id="fixed-bugs-and-malfunctions-220" class="section-heading"><a href="#fixed-bugs-and-malfunctions-220" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bug in operator <code class="inline">band</code> of two negative operands causing erroneous result
if the absolute value of one of the operands have the lowest <code class="inline">N*W</code> bits as
zero and the other absolute value is not larger than <code class="inline">N*W</code> bits. <code class="inline">N</code> is an
integer of 1 or larger and <code class="inline">W</code> is 32 or 64 depending on word size.</p><p>Own Id: OTP-15487 Aux Id: ERL-804</p></li></ul><h2 id="erts-9-3-3-6" class="section-heading"><a href="#erts-9-3-3-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3.6</span></h2><h3 id="improvements-and-new-features-50" class="section-heading"><a href="#improvements-and-new-features-50" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>List subtraction (The <code class="inline">--</code> operator) will now yield properly on large inputs.</p><p>Own Id: OTP-15371</p></li></ul><h2 id="erts-9-3-3-5" class="section-heading"><a href="#erts-9-3-3-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3.5</span></h2><h3 id="fixed-bugs-and-malfunctions-221" class="section-heading"><a href="#fixed-bugs-and-malfunctions-221" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>ERTS internal trees of monitor structures could get into an inconsistent
state. This could cause <code class="inline">'DOWN'</code> messages not to be delivered when they
should, as well as delivery of <code class="inline">'DOWN'</code> messages that should not be delivered.</p><p>This bug was introduced in ERTS version 9.0 (OTP 20.0) and was fixed in ERTS
version 10.0 (OTP 21.0) due to a rewrite of the monitor code. That is, this
bug only exist in the OTP 20 release.</p><p>Own Id: OTP-15399 Aux Id: ERL-751, ERIERL-262, OTP-14205</p></li></ul><h2 id="erts-9-3-3-4" class="section-heading"><a href="#erts-9-3-3-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3.4</span></h2><h3 id="fixed-bugs-and-malfunctions-222" class="section-heading"><a href="#fixed-bugs-and-malfunctions-222" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bug in <code class="inline">ets:select_replace</code> when called with a fully bound key could
cause a following call to <code class="inline">ets:next</code> or <code class="inline">ets:prev</code> to crash the emulator or
return invalid result.</p><p>Own Id: OTP-15346</p></li></ul><h2 id="erts-9-3-3-3" class="section-heading"><a href="#erts-9-3-3-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3.3</span></h2><h3 id="fixed-bugs-and-malfunctions-223" class="section-heading"><a href="#fixed-bugs-and-malfunctions-223" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug which caused an emulator crash when <code class="inline">enif_send()</code> was called by a
NIF that executed on a dirty scheduler. The bug was either triggered when the
NIF called <code class="inline">enif_send()</code> without a message environment, or when the process
executing the NIF was <code class="inline">send</code> traced.</p><p>Own Id: OTP-15223</p></li><li><p>Fixed a bug causing some Erlang references to be inconsistently ordered. This
could for example cause failure to look up certain elements with references as
keys in search data structures. This bug was introduced in R13B02.</p><p>Thanks to Simon Cornish for finding the bug and supplying a fix.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-15225</p></li></ul><h2 id="erts-9-3-3-2" class="section-heading"><a href="#erts-9-3-3-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3.2</span></h2><h3 id="fixed-bugs-and-malfunctions-224" class="section-heading"><a href="#fixed-bugs-and-malfunctions-224" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a race condition in the inet driver that could cause receive to hang
when the emulator was compiled with gcc 8.</p><p>Own Id: OTP-15158 Aux Id: ERL-654</p></li><li><p>Fix bug in generation of erl_crash.dump, which could cause VM to crash.</p><p>Bug exist since erts-9.2 (OTP-20.2).</p><p>Own Id: OTP-15181</p></li></ul><h2 id="erts-9-3-3-1" class="section-heading"><a href="#erts-9-3-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3.1</span></h2><h3 id="fixed-bugs-and-malfunctions-225" class="section-heading"><a href="#fixed-bugs-and-malfunctions-225" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a rare bug that could cause processes to be scheduled after they had
been freed.</p><p>Own Id: OTP-15067 Aux Id: ERL-573</p></li></ul><h2 id="erts-9-3-3" class="section-heading"><a href="#erts-9-3-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.3</span></h2><h3 id="fixed-bugs-and-malfunctions-226" class="section-heading"><a href="#fixed-bugs-and-malfunctions-226" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bug in <code class="inline">ets</code> that could cause VM crash if process A terminates after
fixating a table and process B deletes the table at &quot;the same time&quot;. The table
fixation could be done with <code class="inline">ets:safe_fixtable</code> or if process A terminates in
the middle of a long running <code class="inline">select</code> or <code class="inline">match</code> call.</p><p>Own Id: OTP-15109</p></li></ul><h2 id="erts-9-3-2" class="section-heading"><a href="#erts-9-3-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.2</span></h2><h3 id="fixed-bugs-and-malfunctions-227" class="section-heading"><a href="#fixed-bugs-and-malfunctions-227" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bug in <code class="inline">enif_binary_to_term</code> which could cause memory corruption for
immediate terms (atoms, small integers, pids, ports, empty lists).</p><p>Own Id: OTP-15080</p></li><li><p>Fixed bug in <a href="erlang.html#system_profile/2"><code class="inline">erlang:system_profile/2</code></a> that could cause superfluous
<code class="inline">{profile,_,active,_,_}</code> messages for terminating processes.</p><p>Own Id: OTP-15085</p></li></ul><h2 id="erts-9-3-1" class="section-heading"><a href="#erts-9-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3.1</span></h2><h3 id="fixed-bugs-and-malfunctions-228" class="section-heading"><a href="#fixed-bugs-and-malfunctions-228" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a crash in <a href="../../apps/kernel/heart.html#get_cmd/0"><code class="inline">heart:get_cmd/0</code></a> when the stored command was too long.</p><p>Own Id: OTP-15034</p></li></ul><h2 id="erts-9-3" class="section-heading"><a href="#erts-9-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.3</span></h2><h3 id="fixed-bugs-and-malfunctions-229" class="section-heading"><a href="#fixed-bugs-and-malfunctions-229" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a <code class="inline">configure</code> test for <code class="inline">libz</code> internals that unintentionally caused
various native code in OTP to link against <code class="inline">libz</code>. Under certain circumstances
this caused the build of OTP to fail.</p><p>Own Id: OTP-14840 Aux Id: ERL-529</p></li><li><p>File names containing unicode codepoints larger than 255 were not correctly
encoded in stack traces.</p><p>Own Id: OTP-14847 Aux Id: ERL-544</p></li><li><p>Fix HiPE bug for binary constructs like <code class="inline">&lt;&lt;X/utf8&gt;&gt;</code> which could in rare cases
cause faulty results or VM crash.</p><p>This fix affects both the <code class="inline">hipe</code> compiler and <code class="inline">erts</code> runtime in an
<em>incompatible</em> way. Old hipe compiled files need to be recompiled to load and
run properly as native.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14850 Aux Id: PR-1664</p></li><li><p>Fix <a href="erlang.html#term_to_binary/2"><code class="inline">term_to_binary/2</code></a> spec for <code class="inline">minor_version</code>.</p><p>Own Id: OTP-14876 Aux Id: ERL-548</p></li><li><p>Fix bug in erlang:binary_to_integer/2 where invalid characters were not
detected for bases larger then 10. e.g.
<a href="erlang.html#binary_to_integer/2"><code class="inline">binary_to_integer(&lt;&lt;&quot;:&quot;&gt;&gt;, 16)</code></a> would return 3 and
not badarg as it should.</p><p>Own Id: OTP-14879</p></li><li><p>Fixed bug in <a href="erlang.html#float_to_list/2"><code class="inline">float_to_list/2</code></a> and
<a href="erlang.html#float_to_binary/2"><code class="inline">float_to_binary/2</code></a> with option <code class="inline">decimals</code> that caused
a faulty rounding up of the last decimal digit for about 6% of floats with a
fraction part.</p><p>For example, <a href="erlang.html#float_to_list/2"><code class="inline">float_to_list(0.145, [{decimals,1}])</code></a>
returned <code class="inline">&quot;0.2&quot;</code> instead of <code class="inline">&quot;0.1&quot;</code>.</p><p>Own Id: OTP-14890</p></li><li><p>Fix bug causing slow hipe execution in modules loaded early during boot or
loaded by <code class="inline">code:atomic_load</code> or <code class="inline">code:finish_loading</code>.</p><p>Own Id: OTP-14891</p></li><li><p>Fixed a buffer overflow in an internal string formatting function that could
be hit if specifying a long floating-point format specifier to <code class="inline">erts_sprintf</code>
or similar.</p><p>Own Id: OTP-14920</p></li><li><p><a href="erlang.html#iolist_to_iovec/1"><code class="inline">erlang:iolist_to_iovec/1</code></a> and <code class="inline">enif_inspect_iovec</code> will no longer fail when
provided with binaries that have been matched-out on a non-byte boundary.</p><p>Own Id: OTP-14921</p></li><li><p><a href="erlang.html#iolist_to_binary/1"><code class="inline">iolist_to_binary/1</code></a> and <a href="erlang.html#iolist_to_iovec/1"><code class="inline">erlang:iolist_to_iovec/1</code></a>
will now badarg if supplied with a bitstring (without a list).</p><p>Own Id: OTP-14926</p></li><li><p>Reject loading modules with names containing directory separators ('/' or '\'
on Windows).</p><p>Own Id: OTP-14933 Aux Id: ERL-564, PR-1716</p></li><li><p>Fix potential dead-lock when the tracer process dies while a the traced
process is running on a dirty scheduler.</p><p>Own Id: OTP-14938</p></li></ul><h3 id="improvements-and-new-features-51" class="section-heading"><a href="#improvements-and-new-features-51" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>More crash dump info such as: process binary virtual heap stats, full info for
process causing out-of-mem during GC, more port related info, and dirty
scheduler info.</p><p>Own Id: OTP-14820</p></li></ul><h2 id="erts-9-2-1" class="section-heading"><a href="#erts-9-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.2.1</span></h2><h3 id="improvements-and-new-features-52" class="section-heading"><a href="#improvements-and-new-features-52" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Improve search algorithm of abandoned memory carriers. Instead of limited
linear search, each allocator instance maintain a balanced search tree of all
its abandoned carriers for faster and more exhaustive search.</p><p>Own Id: OTP-14915 Aux Id: ERIERL-88</p></li><li><p>New erts_alloc command line options <code class="inline">+M_acnl</code> and <code class="inline">+M_acfml</code> to limit carrier
abandonment.</p><p>Own Id: OTP-14916 Aux Id: ERIERL-88</p></li><li><p>New family of <code class="inline">erts_alloc</code> strategies: Age Order First Fit. Similar to
&quot;address order&quot;, but instead the oldest possible carrier is always chosen for
allocation.</p><p>Own Id: OTP-14917 Aux Id: ERIERL-88</p></li><li><p>Add possibility to change allocator options at runtime with
<code class="inline">system_info(erts_alloc, ...)</code>. Only option <code class="inline">sbct</code> (single block carrier
threshold) is currently supported via this interface.</p><p>Own Id: OTP-14918 Aux Id: ERIERL-88</p></li></ul><h2 id="erts-9-2-0-1" class="section-heading"><a href="#erts-9-2-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.2.0.1</span></h2><h3 id="improvements-and-new-features-53" class="section-heading"><a href="#improvements-and-new-features-53" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Extra internal consistency checks wrt communication with erl_child_setup
process.</p><p>Own Id: OTP-15488 Aux Id: ERIERL-231</p></li></ul><h2 id="erts-9-2" class="section-heading"><a href="#erts-9-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.2</span></h2><h3 id="fixed-bugs-and-malfunctions-230" class="section-heading"><a href="#fixed-bugs-and-malfunctions-230" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix a bug in tracing where the {caller} match spec function would be set to
undefined incorrectly when used in conjunction with return_to or return_trace
on some functions.</p><p>The functions effected are: erlang:put/2, erlang:erase/1,
erlang:process_info/1,2, erlang:nif_load/2, erts_internal:garbage_collection/1
and erts_internal:check_process_code/1.</p><p>Because of this bug, the analysis done by fprof could become incorrect when
the functions above are the tail-call in a function.</p><p>Own Id: OTP-14677</p></li><li><p>Fix emulator deadlock that would happen if <code class="inline">trap_exit</code> was set to true and a
process sends an exit signal to itself using
<a href="erlang.html#exit/2"><code class="inline">exit(self(), Reason)</code></a> while receive tracing was enabled for that
process.</p><p>Own Id: OTP-14678 Aux Id: ERL-495</p></li><li><p>Writing of crash dumps is significantly faster.</p><p>Maps are now included in crash dumps.</p><p>Constants terms would only be shown in one process, while other processes
referencing the same constant term would show a marker for incomplete heap.</p><p>Own Id: OTP-14685 Aux Id: OTP-14611, OTP-14603, OTP-14595</p></li><li><p>The fallback home directory for windows has been changed to be the PROFILE
directory instead of the WINDOWS directory. The fallback is used when the
environment variables HOMEDRIVE and HOMEPATH have not been set.</p><p>Own Id: OTP-14691</p></li><li><p>Fix bug for hipe compiled code using <code class="inline">&lt;&lt;X/utf32&gt;&gt;</code> binary construction that
could cause faulty result or even VM crash.</p><p>On architectures other than x86_64, code need to be recompiled to benefit from
this fix.</p><p>Own Id: OTP-14740</p></li><li><p>Fixed bug in <a href="erlang.html#garbage_collect/2"><code class="inline">erlang:garbage_collect/2</code></a> and <a href="erlang.html#check_process_code/3"><code class="inline">erlang:check_process_code/3</code></a>,
when called with option <code class="inline">{async,ReqestId}</code>. Could cause VM crash or heap
corruption if <code class="inline">RequestId</code> was an immediate term (like a pid, atom or small
integer). Bug exists since OTP-17.0.</p><p>Own Id: OTP-14752</p></li><li><p>ERL<em>NIF_MINOR_VERSION wasn't bumped with the addition of `enif_ioq</em>*`.</p><p>Own Id: OTP-14779</p></li><li><p>Purging of loaded code that contained &quot;fake literals&quot; (for example the magic
reference obtained from '<a href="../../apps/stdlib/ets.html#new/2"><code class="inline">ets:new/2</code></a>') would crash the runtime system.
Corrected.</p><p>Own Id: OTP-14791</p></li><li><p>Setting the size of the atom table to a number near 2147483647 (using the
'<code class="inline">+t</code>' option) would cause the emulator to exit with a failure to allocate a
huge amount of memory. This has been corrected. Also the usage message for the
'<code class="inline">+t</code>' option has been corrected to show the correct upper limit 2147483647
instead of 0.</p><p>Own Id: OTP-14796</p></li><li><p>Fixed a bug that prevented registered process names from being resolved in
lcnt results.</p><p>Own Id: OTP-14803</p></li><li><p>Formatting bugs were fixed in several HiPE debug BIFs.</p><p>Own Id: OTP-14804</p></li></ul><h3 id="improvements-and-new-features-54" class="section-heading"><a href="#improvements-and-new-features-54" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Binaries and some other data in crash dumps are now encoded in base64 (instead
of in hex), which will reduce the size of crash dumps.</p><p>A few bugs in the handling of sub binaries in <code class="inline">crashdump_viewer</code> have been
fixed.</p><p>Own Id: OTP-14686</p></li><li><p>Micro optimization for send operations of messages to other nodes. The local
ack-message, which is otherwise sent back from TPC/IP port driver to sending
client process, is now ignored earlier for distributed send operations.</p><p>Own Id: OTP-14689</p></li></ul><h2 id="erts-9-1-5" class="section-heading"><a href="#erts-9-1-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.1.5</span></h2><h3 id="fixed-bugs-and-malfunctions-231" class="section-heading"><a href="#fixed-bugs-and-malfunctions-231" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in file closure on Unix; close(2) was retried on EINTR which could
cause a different (recently opened) file to be closed as well.</p><p>Own Id: OTP-14775</p></li><li><p>A race-condition when tearing down a connection with active node monitors
could cause the runtime system to crash.</p><p>This bug was introduced in ERTS version 8.0 (OTP 19.0).</p><p>Own Id: OTP-14781 Aux Id: OTP-13047</p></li></ul><h2 id="erts-9-1-4" class="section-heading"><a href="#erts-9-1-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.1.4</span></h2><h3 id="fixed-bugs-and-malfunctions-232" class="section-heading"><a href="#fixed-bugs-and-malfunctions-232" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Microstate accounting sometimes produced incorrect results for dirty
schedulers.</p><p>Own Id: OTP-14707</p></li><li><p>Fixed a regression in <a href="zlib.html#gunzip/1"><code class="inline">zlib:gunzip/1</code></a> that prevented it from working when the
decompressed size was a perfect multiple of 16384. This regression was
introduced in 20.1.1</p><p>Own Id: OTP-14730 Aux Id: ERL-507</p></li><li><p>Fixed a memory corruption bug in <code class="inline">enif_inspect_iovec</code>; writable binaries
stayed writable after entering the iovec.</p><p>Own Id: OTP-14745</p></li><li><p>Fixed a crash in <code class="inline">enif_inspect_iovec</code> on encountering empty binaries.</p><p>Own Id: OTP-14750</p></li><li><p><a href="zlib.html#deflateParams/3"><code class="inline">zlib:deflateParams/3</code></a> will no longer return <code class="inline">buf_error</code> when called after
<a href="zlib.html#deflate/2"><code class="inline">zlib:deflate/2</code></a> with zlib <code class="inline">1.2.11</code>.</p><p>Own Id: OTP-14751</p></li></ul><h2 id="erts-9-1-3" class="section-heading"><a href="#erts-9-1-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.1.3</span></h2><h3 id="fixed-bugs-and-malfunctions-233" class="section-heading"><a href="#fixed-bugs-and-malfunctions-233" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Added zlib:set_controlling_process/2 to move a zstream() between processes.</p><p>Own Id: OTP-14672 Aux Id: ERL-494</p></li><li><p>Fix so that schedulers are bound correctly when the first available cpu is not
the first detected cpu. e.g. when using &quot;taskset -c X..Y&quot; when X is not equal
to 0.</p><p>Own Id: OTP-14694</p></li></ul><h2 id="erts-9-1-2" class="section-heading"><a href="#erts-9-1-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.1.2</span></h2><h3 id="fixed-bugs-and-malfunctions-234" class="section-heading"><a href="#fixed-bugs-and-malfunctions-234" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bug that could cause a VM crash when a corrupt message is received on
distribution channel from other node.</p><p>Own Id: OTP-14661 Aux Id: ERIERL-80</p></li></ul><h2 id="erts-9-1-1" class="section-heading"><a href="#erts-9-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-235" class="section-heading"><a href="#fixed-bugs-and-malfunctions-235" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The new zlib module returned a data_error when inflating concatenated streams,
which was incompatible with the old module's behavior of returning the
uncompressed data up to the end of the first stream.</p><p>Own Id: OTP-14648</p></li><li><p>zlib:gunzip/1 will no longer stop at the end of the first stream when
decompressing concatenated gzip files.</p><p>Own Id: OTP-14649</p></li></ul><h2 id="erts-9-1" class="section-heading"><a href="#erts-9-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.1</span></h2><h3 id="fixed-bugs-and-malfunctions-236" class="section-heading"><a href="#fixed-bugs-and-malfunctions-236" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Changed <a href="erlang.html#apply/2"><code class="inline">erlang:apply/2</code></a> to raise a <code class="inline">badarg</code> exception if the second argument
is not a proper list. Previous behavior was a misleading <code class="inline">undef</code> exception.</p><p>Own Id: OTP-14490 Aux Id: ERL-432</p></li><li><p>On macOS, <code class="inline">crypto</code> would crash if <code class="inline">observer</code> had been started before <code class="inline">crypto</code>.
On the beta for macOS 10.13 (High Sierra), <code class="inline">crypto</code> would crash. Both of those
bugs have been fixed.</p><p>Own Id: OTP-14499 Aux Id: ERL-251 ERL-439</p></li><li><p>Fixed bug in enif_whereis_pid/port that could cause heap corruption in rare
cases.</p><p>Own Id: OTP-14523</p></li><li><p>Fix so that trace messages generated when in a dirty nif are flushed correctly
when the dirty nif is done executing.</p><p>Own Id: OTP-14538</p></li><li><p>Fix escape code handling when using ANSI color codes in the shell.</p><p>Own Id: OTP-14549 Aux Id: PR1536</p></li><li><p>Upgraded the ERTS internal PCRE library from version 8.40 to version 8.41. See
<a href="http://pcre.org/original/changelog.txt">http://pcre.org/original/changelog.txt</a>
for information about changes made to PCRE. This library implements major
parts of the <a href="../../apps/stdlib/re.html"><code class="inline">re</code></a> regular expressions module.</p><p>Own Id: OTP-14574</p></li><li><p>Fixed a bug causing <a href="erlang.html#statistics/1"><code class="inline">statistics(runtime)</code></a> to produce
negative values and a bug in <a href="erlang.html#statistics/1"><code class="inline">statistics(wall_clock)</code></a>
causing it to produce values one second too long.</p><p><a href="erlang.html#statistics/1"><code class="inline">statistics(runtime)</code></a> now also use <code class="inline">getrusage()</code> as source
when available preventing the returned value from wrapping as frequent as
before.</p><p>Own Id: OTP-14597 Aux Id: ERL-465</p></li><li><p>Fixed small memory leak that could occur when sending to a terminating port.</p><p>Own Id: OTP-14609</p></li><li><p>Fix bug causing VM crash when a module with <code class="inline">-on_load</code> directive is loaded
while <code class="inline">erlang:trace(on_load, ...)</code> is enabled.</p><p>Own Id: OTP-14612</p></li><li><p>A warning that the compiler may optimize away atoms have been added to the
documentation of <a href="erlang.html#list_to_existing_atom/1"><code class="inline">list_to_existing_atom/1</code></a> and
<a href="erlang.html#binary_to_existing_atom/2"><code class="inline">binary_to_existing_atom/2</code></a>.</p><p>Own Id: OTP-14614 Aux Id: ERL-453</p></li></ul><h3 id="improvements-and-new-features-55" class="section-heading"><a href="#improvements-and-new-features-55" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Lock counting can now be fully toggled at runtime in the lock counting
emulator (<code class="inline">-emu_type lcnt</code>). Everything is enabled by default to match the old
behavior, but specific categories can be toggled at will with minimal runtime
overhead when disabled. Refer to the documentation on <a href="../../apps/tools/lcnt.html#rt_mask/1"><code class="inline">lcnt:rt_mask/1</code></a> for
details.</p><p>Own Id: OTP-13170</p></li><li><p>The <code class="inline">zlib</code> module has been refactored and all its operations will now yield
appropriately, allowing them to be used freely in concurrent applications.</p><p>The following functions have been deprecated, but will not produce compiler
warnings until OTP 21: <code class="inline">zlib:adler32</code>, <code class="inline">zlib:crc32</code>, <code class="inline">zlib:inflateChunk</code>,
<code class="inline">zlib:getBufSize</code>, <code class="inline">zlib:setBufSize</code>.</p><p>The behavior of throwing an error when a dictionary is required for
decompression has also been deprecated. Refer to the documentation on
<code class="inline">inflateSetDictionary/2</code> for details.</p><p>Own Id: OTP-14185</p></li><li><p><code class="inline">lcnt:collect</code> and <code class="inline">lcnt:clear</code> will no longer block all other threads in the
runtime system.</p><p>Own Id: OTP-14412</p></li><li><p>Add <a href="erlang.html#iolist_to_iovec/1"><code class="inline">erlang:iolist_to_iovec/1</code></a>, which converts an iolist() to an
erlang:iovec(), which suitable for use with <code class="inline">enif_inspect_iovec</code>.</p><p>Own Id: OTP-14520</p></li><li><p>When provided with bad arguments, the <code class="inline">zlib</code> module will now raise named
exceptions instead of just <code class="inline">badarg</code>. For example, <code class="inline">not_initialized</code> when using
<a href="zlib.html#inflate/2"><code class="inline">zlib:inflate/2</code></a> with an uninitialized stream.</p><p>Own Id: OTP-14527</p></li><li><p><a href="erlang.html#halt/2"><code class="inline">erlang:halt/2</code></a> allows any Unicode string as slogan for the crash dump.</p><p>Own Id: OTP-14553</p></li><li><p>Add new nif API functions for managing an I/O Queue. The added functions are:</p><ul><li><a href="erl_nif.html#enif_ioq_create"><code class="inline">enif_ioq_create()</code></a></li><li><a href="erl_nif.html#enif_ioq_destroy"><code class="inline">enif_ioq_destroy()</code></a></li><li><a href="erl_nif.html#enif_ioq_enq_binary"><code class="inline">enif_ioq_enq_binary()</code></a></li><li><a href="erl_nif.html#enif_ioq_enqv"><code class="inline">enif_ioq_enqv()</code></a></li><li><a href="erl_nif.html#enif_ioq_deq"><code class="inline">enif_ioq_deq()</code></a></li><li><a href="erl_nif.html#enif_ioq_peek"><code class="inline">enif_ioq_peek()</code></a></li><li><a href="erl_nif.html#enif_inspect_iovec"><code class="inline">enif_inspect_iovec()</code></a></li><li><a href="erl_nif.html#enif_free_iovec"><code class="inline">enif_free_iovec()</code></a></li></ul><p>Own Id: OTP-14598</p></li></ul><h2 id="erts-9-0-5" class="section-heading"><a href="#erts-9-0-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.0.5</span></h2><h3 id="fixed-bugs-and-malfunctions-237" class="section-heading"><a href="#fixed-bugs-and-malfunctions-237" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bug in <code class="inline">binary_to_term</code> and <code class="inline">binary_to_atom</code> that could cause VM crash.
Typically happens when the last character of an UTF8 string is in the range
128 to 255, but truncated to only one byte. Bug exists in <code class="inline">binary_to_term</code>
since ERTS version 5.10.2 (OTP_R16B01) and <code class="inline">binary_to_atom</code> since ERTS version
9.0 (OTP-20.0).</p><p>Own Id: OTP-14590 Aux Id: ERL-474</p></li></ul><h2 id="erts-9-0-4" class="section-heading"><a href="#erts-9-0-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.0.4</span></h2><h3 id="fixed-bugs-and-malfunctions-238" class="section-heading"><a href="#fixed-bugs-and-malfunctions-238" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A timer internal bit-field used for storing scheduler id was too small. As a
result, VM internal timer data structures could become inconsistent when using
1024 schedulers on the system. Note that systems with less than 1024
schedulers are not effected by this bug.</p><p>This bug was introduced in ERTS version 7.0 (OTP 18.0).</p><p>Own Id: OTP-14548 Aux Id: OTP-11997, ERL-468</p></li><li><p>Automatic cleanup of a BIF timer, when the owner process terminated, could
race with the timeout of the timer. This could cause the VM internal data
structures to become inconsistent which very likely caused a VM crash.</p><p>This bug was introduced in ERTS version 9.0 (OTP 20.0).</p><p>Own Id: OTP-14554 Aux Id: OTP-14356, ERL-468</p></li></ul><h2 id="erts-9-0-3" class="section-heading"><a href="#erts-9-0-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.0.3</span></h2><h3 id="fixed-bugs-and-malfunctions-239" class="section-heading"><a href="#fixed-bugs-and-malfunctions-239" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Binary append operations did not check for overflow, resulting in nonsensical
results when huge binaries were appended.</p><p>Own Id: OTP-14524</p></li></ul><h2 id="erts-9-0-2" class="section-heading"><a href="#erts-9-0-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.0.2</span></h2><h3 id="fixed-bugs-and-malfunctions-240" class="section-heading"><a href="#fixed-bugs-and-malfunctions-240" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Added missing release notes for OTP-14491 (&quot;performance bug in
pre-allocators&quot;) which was included in erts-9.0.1 (OTP-20.0.1).</p><p>Own Id: OTP-14494</p></li><li><p>Fixed a bug that prevented TCP sockets from being closed properly on send
timeouts.</p><p>Own Id: OTP-14509</p></li><li><p>Fixed bug in operator <code class="inline">bxor</code> causing erroneuos result when one operand is a
big <em>negative</em> integer with the lowest <code class="inline">N*W</code> bits as zero and the other
operand not larger than <code class="inline">N*W</code> bits. <code class="inline">N</code> is an integer of 1 or larger and <code class="inline">W</code>
is 32 or 64 depending on word size.</p><p>Own Id: OTP-14514</p></li></ul><h2 id="erts-9-0-1" class="section-heading"><a href="#erts-9-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-241" class="section-heading"><a href="#fixed-bugs-and-malfunctions-241" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in gen_tcp:send where it never returned when repeatedly called on
a remotely closed TCP socket.</p><p>Own Id: OTP-13939 Aux Id: ERL-193</p></li><li><p>Fixed segfault that could happen during cleanup of aborted
erlang:port_command/3 calls. A port_command is aborted if the port is closed
at the same time as the port_command was issued. This bug was introduced in
erts-8.0.</p><p>Own Id: OTP-14481</p></li><li><p>Fixed implementation of <a href="erlang.html#statistics/1"><code class="inline">statistics(wall_clock)</code></a> and
<a href="erlang.html#statistics/1"><code class="inline">statistics(runtime)</code></a> so that values do not unnecessarily
wrap due to the emulator. Note that the values returned by
<a href="erlang.html#statistics/1"><code class="inline">statistics(runtime)</code></a> may still wrap due to limitations in
the underlying functionality provided by the operating system.</p><p>Own Id: OTP-14484</p></li><li><p>Fix performance bug in pre-allocators that could cause them to permanently
fall back on normal more expensive memory allocation. Pre-allocators are used
for quick allocation of short lived meta data used by messages and other
scheduled tasks. Bug exists since OTP_R15B02. [this release note was missing
in erts-9.0.1]</p><p>Own Id: OTP-14491</p></li></ul><h2 id="erts-9-0" class="section-heading"><a href="#erts-9-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 9.0</span></h2><h3 id="fixed-bugs-and-malfunctions-242" class="section-heading"><a href="#fixed-bugs-and-malfunctions-242" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix various bugs regarding loading, upgrade and purge of HiPE compiled code:</p><ul><li>The native code memory for a purged module was never deallocated.</li><li>Wrong functions could in some cases be called after a module upgrade.</li><li><code class="inline">erlang:check_process_code</code> did not check for recursive calls made from
native code.</li></ul><p>Own Id: OTP-13968</p></li><li><p>Hipe optional LLVM backend does require LLVM version 3.9 or later as older
versions forced strong dependencies on erts internals structures.</p><p>Own Id: OTP-14238</p></li><li><p>When an exception such as '<a href="erlang.html#throw/1"><code class="inline">throw(HugeTerm)</code></a>' was caught,
<code class="inline">HugeTerm</code> term would be kept in the process until the next exception
occurred, potentially increasing the heap size for the process. That has been
corrected.</p><p>Own Id: OTP-14255 Aux Id: OTP-14400, OTP-14401</p></li><li><p>Slogans in crash dumps have been extended to print more complex terms.</p><p>Own Id: OTP-14303</p></li><li><p>Fixed bug when using <code class="inline">enif_inspect_binary</code> in combination with <code class="inline">enif_copy</code>. In
some circumstances the inspected binary could be reallocated by the
<code class="inline">enif_copy</code> call when it shouldn't have been.</p><p>Own Id: OTP-14304</p></li><li><p>The address family <code class="inline">local</code> (AF_UNIX / AF_LOCAL) now does not ensure zero
termination of Linux Abstract Addresses so they can use all bytes.</p><p>Own Id: OTP-14305</p></li><li><p>Use <code class="inline">-fno-PIE</code> for Gentoo Hardened and others that don't accept linker flag
<code class="inline">-no-pie</code>.</p><p>Own Id: OTP-14307 Aux Id: PR-1379</p></li><li><p>Disable hipe for <code class="inline">ppc64le</code> architecture (little endian) as it is not, and has
never been, supported. It was earlier equated with <code class="inline">ppc64</code> (big endian) which
lead to broken build without <code class="inline">--disable-hipe</code>.</p><p>Own Id: OTP-14314 Aux Id: ERL-369, PR-1394</p></li><li><p>Fix 'epmd -kill' to return a failure exit status code if epmd was not killed
because of some error.</p><p>Own Id: OTP-14324</p></li><li><p>Fixed the following dirty scheduler related bugs:</p><ul><li>the <code class="inline">+SDPcpu</code> command line argument could cause the amount of dirty CPU
schedulers to be set to zero</li><li><code class="inline">erlang:system_flag(multi_scheduling, _)</code> failed when only one normal
scheduler was used together with dirty scheduler support</li></ul><p>Own Id: OTP-14335</p></li><li><p>Fix erlexec to handle mismatch in sysconf and proc fs when figuring out the
cpu topology. This behaviour has been seen when using docker together with
<code class="inline">--cpuset-cpus</code>.</p><p>Own Id: OTP-14352</p></li><li><p>Fixed memory segment cache used for multiblock carriers. Huge (&gt; 2GB) memory
segments could cause a VM crash. Creation of such huge memory segments used
for multiblock carriers is however very uncommon.</p><p>Own Id: OTP-14360 Aux Id: ERL-401, PR-1417</p></li><li><p>Fix bug causing <code class="inline">code:is_module_native</code> to falsely return true when <code class="inline">local</code>
call trace is enabled for the module.</p><p>Own Id: OTP-14390</p></li><li><p>Fix emulator crash when receive tracing on a <code class="inline">trace_delivered</code> message.</p><p>Own Id: OTP-14411</p></li><li><p>Fix file:sendfile error handling on SunOS when a connection is closed during
transmission.</p><p>Own Id: OTP-14424</p></li><li><p><code class="inline">escript</code> did not handle paths with spaces correct.</p><p>Own Id: OTP-14433</p></li><li><p>Fix erroneous lock check assertion when <code class="inline">wx</code> is run on MacOS X.</p><p>Own Id: OTP-14437 Aux Id: ERL-360</p></li><li><p>Active-mode TCP sockets are now cleaned up properly on send/shutdown errors.</p><p>Own Id: OTP-14441 Aux Id: ERL-430</p></li><li><p>Fix compilation of hipe_mkliterals when the LIBS configure variable had to be
set.</p><p>Own Id: OTP-14447</p></li></ul><h3 id="improvements-and-new-features-56" class="section-heading"><a href="#improvements-and-new-features-56" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Added <a href="erlang.html#garbage_collect/2"><code class="inline">erlang:garbage_collect/2</code></a> that takes an option list as the last
argument that can be used to control whether a minor or a major garbage
collection is to be done. Doing a minor collection only collects terms that
have recently died, but is cheaper than a major collection.</p><p>Own Id: OTP-11695</p></li><li><p>Optimized test for tuples with an atom as first element.</p><p>Own Id: OTP-12148</p></li><li><p>Erlang literals are no longer copied during process to process messaging.</p><p>Own Id: OTP-13529</p></li><li><p>Add support in the <code class="inline">erl_nif</code> API for asynchronous message notifications when
sockets or other file descriptors are ready to accept read or write
operations. The following functions have been added:</p><ul><li>enif_select</li><li>enif_monitor_process</li><li>enif_demonitor_process</li><li>enif_compare_monitors</li><li>enif_open_resource_type_x</li></ul><p>Own Id: OTP-13684</p></li><li><p>There are two new guard BIFs '<a href="erlang.html#floor/1"><code class="inline">floor/1</code></a>' and
'<a href="erlang.html#ceil/1"><code class="inline">ceil/1</code></a>'. They both return integers. In the '<code class="inline">math</code>' module,
there are two new BIFs with the same names that return floating point values.</p><p>Own Id: OTP-13692</p></li><li><p>Remove deprecated <code class="inline">erlang:hash/2</code>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-13827</p></li><li><p>Replaced usage of deprecated symbolic <a href="erlang.html#t:time_unit/0"><code class="inline">time unit</code></a>
representations.</p><p>Own Id: OTP-13831 Aux Id: OTP-13735</p></li><li><p>Added support in zlib for extraction of the inflation dictionary.</p><p>Own Id: OTP-13842</p></li><li><p>The previously used purge strategy has been removed. The optional purge
strategy introduced in ERTS version 8.1 is now the only strategy available.</p><p>The new purge strategy is slightly incompatible with the old strategy.
Previously processes holding <code class="inline">fun</code>s that referred to the module being purged
either failed a soft purge, or was killed during a hard purge. The new
strategy completely ignores <code class="inline">fun</code>s. If <code class="inline">fun</code>s referring to the code being
purged exist, and are used after a purge, an exception will be raised upon
usage. That is, the behavior will be exactly the same as the case when a <code class="inline">fun</code>
is received by a process after the purge.</p><p>For more information see the documentation of <a href="erlang.html#check_process_code/3"><code class="inline">erlang:check_process_code/3</code></a>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-13844 Aux Id: OTP-13833</p></li><li><p>Dirty schedulers are now enabled by default when the runtime system is built
with SMP support.</p><p>Own Id: OTP-13860</p></li><li><p>Improved ETS lookup/insert/delete speed for large <code class="inline">set</code>, <code class="inline">bag</code> and
<code class="inline">duplicate_bag</code> by a significant reduction of the hash load factor. This speed
improvement comes at the expense of less than one word per table entry. Tables
with less than 256 entries are not affected at all.</p><p>Own Id: OTP-13903</p></li><li><p>The NIF library <code class="inline">reload</code> feature is not supported anymore. It has been marked
as deprecated since OTP R15B. This means that you are only allowed to do one
successful call to <a href="erlang.html#load_nif/2"><code class="inline">erlang:load_nif/2</code></a> for each module instance. A second call
to <a href="erlang.html#load_nif/2"><code class="inline">erlang:load_nif/2</code></a> will return <code class="inline">{error, {reload, _}}</code> even if the NIF
library implements the <code class="inline">reload</code> callback.</p><p>Runtime upgrade of a NIF library is still supported by using the Erlang module
upgrade mechanics with a current and an old module instance existing at the
same time with their corresponding NIF libraries.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-13908</p></li><li><p>Add <code class="inline">erlang:system_info(atom_count)</code> and <code class="inline">erlang:system_info(atom_limit)</code> to
provide a way to retrieve the current and maximum number of atoms.</p><p>Own Id: OTP-13976</p></li><li><p>The function <code class="inline">fmod/2</code> has been added to the <code class="inline">math</code> module.</p><p>Own Id: OTP-14000</p></li><li><p><a href="erlang.html#load_nif/2"><code class="inline">erlang:load_nif/2</code></a> returns new error type <code class="inline">notsup</code> when called for a HiPE
compiled module, which is not supported.</p><p>Own Id: OTP-14002</p></li><li><p>Add driver and nif lock instrumentation to lcnt</p><p>Own Id: OTP-14069</p></li><li><p>Reduce memory pressure by converting sub-binaries to heap-binaries when
possible. This is done during garbage collection.</p><p>Own Id: OTP-14149</p></li><li><p>Dirty schedulers are now enabled and supported on Erlang runtime systems with
SMP support.</p><p>Besides support for dirty NIFs also support for dirty BIFs and dirty garbage
collection have been introduced. All garbage collections that potentially will
take a long time to complete are now performed on dirty schedulers if enabled.</p><p><a href="erlang.html#statistics/1"><code class="inline">erlang:statistics/1</code></a> with arguments inspecting scheduler and run queue states
have been changed due to the dirty scheduler support. Code using this
functionality may have to be rewritten taking these incompatibilities into
consideration. Examples of such uses are calls to
<a href="erlang.html#statistics_scheduler_wall_time"><code class="inline">erlang:statistics(scheduler_wall_time)</code></a>,
<a href="erlang.html#statistics_total_run_queue_lengths"><code class="inline">statistics(total_run_queue_lengths)</code></a>,
<a href="erlang.html#statistics_total_active_tasks"><code class="inline">statistics(total_active_tasks)</code></a>,
etc.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14152</p></li><li><p>Atoms may now contain arbitrary Unicode characters.</p><p>Own Id: OTP-14178</p></li><li><p>Introduce an event manager in Erlang to handle OS signals. A subset of OS
signals may be subscribed to and those are described in the Kernel
application.</p><p>Own Id: OTP-14186</p></li><li><p>The <code class="inline">escript</code> program now handles symbolic links to escripts.</p><p>This is useful for standalone systems with <code class="inline">escript</code>s residing on a bin
directory not included in the execution path (as it may cause their <code class="inline">erl</code>
program(s) to override the desired one). Instead the <code class="inline">escript</code>s can be
referred to via symbolic links from a bin directory in the path.</p><p>Own Id: OTP-14201 Aux Id: PR-1293</p></li><li><p>All uses of the magic binary kludge has been replaced by uses of erlang
references.</p><p>A magic binary was presented as an empty binary, but actually referred other
data internally in the Erlang VM. Since they were presented as empty binaries,
different magic binaries compared as equal, and also lost their internal data
when passed out of an erlang node.</p><p>The new usage of references has not got any of these strange semantic issues,
and the usage of these references has been optimized to give the same
performance benefits as well as memory usage benefits as magic binaries had.</p><p>A couple of examples of previous uses of magic binaries are match
specifications and NIF resources.</p><p>Own Id: OTP-14205</p></li><li><p>The non-smp emulators have been deprecated and are scheduled for removal in
OTP-21.</p><p>In preparation for this, the threaded non-smp emulator is no longer built by
default and has to be enabled using the --enable-plain-emulator to configure.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14272</p></li><li><p>Allow HiPE to run on VM built with <code class="inline">--enable-m32-build</code>.</p><p>Own Id: OTP-14330 Aux Id: PR-1397</p></li><li><p>Upgraded the OTP internal PCRE library from version 8.33 to version 8.40. This
library is used for implementation of the <a href="../../apps/stdlib/re.html"><code class="inline">re</code></a> regular expressions module.</p><p>Besides various bug fixes, the new version allows for better stack protection.
In order to utilize this feature, the stack size of normal scheduler threads
is now by default set to 128 kilo words on all platforms. The stack size of
normal scheduler threads can be set upon system start by passing the
<a href="erl_cmd.html#sched_thread_stack_size"><code class="inline">+sss</code></a> command line argument to the
<a href="erl_cmd.html"><code class="inline">erl</code></a> command.</p><p>See
<a href="http://pcre.org/original/changelog.txt">http://pcre.org/original/changelog.txt</a>
for information about changes made to PCRE between the versions 8.33 and 8.40.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14331 Aux Id: ERL-208</p></li><li><p>Remove generation of atoms in old latin1 external format in the distribution
between erlang nodes, <code class="inline">erl_interface</code>, and <code class="inline">jinterface</code>. The new utf8 format
for atoms was introduced in OTP R16. An OTP 20 node can therefore not connect
to nodes older than R16.</p><p>Atoms that can be encoded using latin1 are still encoded by <code class="inline">term_to_binary()</code>
using latin1 encoding. Note that all atoms will by default be encoded using
utf8 in a future Erlang/OTP release. For more information see the
documentation of <a href="erlang.html#term_to_binary/2"><code class="inline">erlang:term_to_binary/2</code></a>.</p><p>Own Id: OTP-14337</p></li><li><p>Added function <a href="../../apps/stdlib/re.html#version/0"><code class="inline">re:version/0</code></a> which returns information about the OTP internal
PCRE version used for implementation of the <code class="inline">re</code> module.</p><p>Own Id: OTP-14347 Aux Id: PR-1412</p></li><li><p>Added new debug bif <a href="erlang.html#list_to_port/1"><code class="inline">erlang:list_to_port/1</code></a>.</p><p>Own Id: OTP-14348</p></li><li><p>Various improvements of timer management internally in the VM. These
improvements both reduced memory consumption of timer wheels as well as reduce
the amount of work that has to be performed in order to handle timers.</p><p>Own Id: OTP-14356</p></li><li><p>Sockets can now be bound to device (SO_BINDTODEVICE) on platforms where it is
supported.</p><p>This has been implemented e.g to support VRF-Lite under Linux; see
<a href="https://www.kernel.org/doc/Documentation/networking/vrf.txt">VRF </a>, and
GitHub pull request <a href="https://github.com/erlang/otp/pull/1326">#1326</a>.</p><p>Own Id: OTP-14357 Aux Id: PR-1326</p></li><li><p>Added the following <a href="erl_cmd.html"><code class="inline">erl</code></a> command line arguments with which you
can set suggested stack for dirty schedulers:</p><ul><li><p><strong><a href="erl_cmd.html#dcpu_sched_thread_stack_size"><code class="inline">+sssdcpu</code></a></strong> - for dirty CPU
schedulers</p></li><li><p><strong><a href="erl_cmd.html#dio_sched_thread_stack_size"><code class="inline">+sssdio</code></a></strong> - for dirty IO
schedulers</p></li></ul><p>The default suggested stack size for dirty schedulers is 40 kilo words.</p><p>Own Id: OTP-14380</p></li><li><p>Changed erts startup program name, argv 0, to use the environment variable
<code class="inline">ESCRIPT_NAME</code> so that <code class="inline">erlc</code>, <code class="inline">dialyzer</code>, <code class="inline">typer</code>, <code class="inline">ct_run</code>, or the escript
name can be seen with external programs, such as ps and htop (depending on
options), on unix.</p><p>Own Id: OTP-14381</p></li><li><p>Improvements of <code class="inline">escript</code> documentation.</p><p>Own Id: OTP-14384 Aux Id: OTP-14201</p></li><li><p>Add function <code class="inline">enif_hash</code> for NIFs to calculate hash values of arbitrary terms.</p><p>Own Id: OTP-14385 Aux Id: PR-1413</p></li><li><p>'<code class="inline">./configure --enable-lock-counter</code>' will enabling building of an additional
emulator that has support for lock counting. (The option previously existed,
but would turn on lock counting in the default emulator being built.) To start
the lock-counting emulator, use '<code class="inline">erl -emu_type lcnt</code>'.</p><p>On Windows, <code class="inline">erl</code> recognized the undocumented option <code class="inline">-debug</code> for starting a
debug-compiled emulator. That option has been removed. Use
'<code class="inline">erl -emu_type debug</code>' instead.</p><p>Own Id: OTP-14407</p></li><li><p>Warnings have been added to the relevant documentation about not using
un-secure distributed nodes in exposed environments.</p><p>Own Id: OTP-14425</p></li><li><p>Improvement of the documentation of the environment variable
<code class="inline">ERL_CRASH_DUMP_SECONDS</code> as well as the default behavior when it is not set.</p><p>Own Id: OTP-14434</p></li><li><p>Enabled off-heap message queue for some system processes that might receive
large amounts of messages.</p><p>Own Id: OTP-14438</p></li><li><p>ETS lock indexes have been replaced with the table name in LCNT results.</p><p>Own Id: OTP-14442 Aux Id: ERIERL-22</p></li><li><p>Introduced the new functions
<a href="erl_nif.html#enif_whereis_pid"><code class="inline">enif_whereis_pid()</code></a> and
<a href="erl_nif.html#enif_whereis_port"><code class="inline">enif_whereis_port()</code></a>.</p><p>Own Id: OTP-14453 Aux Id: PR-1400</p></li></ul><h2 id="erts-8-3-5-7" class="section-heading"><a href="#erts-8-3-5-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.3.5.7</span></h2><h3 id="fixed-bugs-and-malfunctions-243" class="section-heading"><a href="#fixed-bugs-and-malfunctions-243" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed bug in operator <code class="inline">band</code> of two negative operands causing erroneous result
if the absolute value of one of the operands have the lowest <code class="inline">N*W</code> bits as
zero and the other absolute value is not larger than <code class="inline">N*W</code> bits. <code class="inline">N</code> is an
integer of 1 or larger and <code class="inline">W</code> is 32 or 64 depending on word size.</p><p>Own Id: OTP-15487 Aux Id: ERL-804</p></li></ul><h3 id="improvements-and-new-features-57" class="section-heading"><a href="#improvements-and-new-features-57" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Added an optional <code class="inline">./configure</code> flag to compile the emulator with spectre
mitigation: <code class="inline">--with-spectre-mitigation</code></p><p>Note that this requires a recent version of GCC with support for spectre
mitigation and the <code class="inline">--mindirect-branch=thunk</code> flag, such as <code class="inline">8.1</code>.</p><p>Own Id: OTP-15430 Aux Id: ERIERL-237</p></li></ul><h2 id="erts-8-3-5-6" class="section-heading"><a href="#erts-8-3-5-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.3.5.6</span></h2><h3 id="fixed-bugs-and-malfunctions-244" class="section-heading"><a href="#fixed-bugs-and-malfunctions-244" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed small memory leak that could occur when sending to a terminating port.</p><p>Own Id: OTP-14609 Aux Id: ERIERL-238</p></li></ul><h2 id="erts-8-3-5-5" class="section-heading"><a href="#erts-8-3-5-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.3.5.5</span></h2><h3 id="fixed-bugs-and-malfunctions-245" class="section-heading"><a href="#fixed-bugs-and-malfunctions-245" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a race condition in the inet driver that could cause receive to hang
when the emulator was compiled with gcc 8.</p><p>Own Id: OTP-15158 Aux Id: ERL-654</p></li><li><p>Fixed a bug causing some Erlang references to be inconsistently ordered. This
could for example cause failure to look up certain elements with references as
keys in search data structures. This bug was introduced in R13B02.</p><p>Thanks to Simon Cornish for finding the bug and supplying a fix.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-15225</p></li></ul><h2 id="erts-8-3-5-4" class="section-heading"><a href="#erts-8-3-5-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.3.5.4</span></h2><h3 id="fixed-bugs-and-malfunctions-246" class="section-heading"><a href="#fixed-bugs-and-malfunctions-246" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in file closure on Unix; close(2) was retried on EINTR which could
cause a different (recently opened) file to be closed as well.</p><p>Own Id: OTP-14775</p></li><li><p>A race-condition when tearing down a connection with active node monitors
could cause the runtime system to crash.</p><p>This bug was introduced in ERTS version 8.0 (OTP 19.0).</p><p>Own Id: OTP-14781 Aux Id: OTP-13047</p></li></ul><h2 id="erts-8-3-5-3" class="section-heading"><a href="#erts-8-3-5-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.3.5.3</span></h2><h3 id="fixed-bugs-and-malfunctions-247" class="section-heading"><a href="#fixed-bugs-and-malfunctions-247" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A timer internal bit-field used for storing scheduler id was too small. As a
result, VM internal timer data structures could become inconsistent when using
1024 schedulers on the system. Note that systems with less than 1024
schedulers are not effected by this bug.</p><p>This bug was introduced in ERTS version 7.0 (OTP 18.0).</p><p>Own Id: OTP-14548 Aux Id: OTP-11997, ERL-468</p></li><li><p>Fixed bug in <code class="inline">binary_to_term</code> and <code class="inline">binary_to_atom</code> that could cause VM crash.
Typically happens when the last character of an UTF8 string is in the range
128 to 255, but truncated to only one byte. Bug exists in <code class="inline">binary_to_term</code>
since ERTS version 5.10.2 (OTP_R16B01) and <code class="inline">binary_to_atom</code> since ERTS version
9.0 (OTP-20.0).</p><p>Own Id: OTP-14590 Aux Id: ERL-474</p></li><li><p>Fix bug causing VM crash when a module with <code class="inline">-on_load</code> directive is loaded
while <code class="inline">erlang:trace(on_load, ...)</code> is enabled.</p><p>Own Id: OTP-14612</p></li><li><p>Fixed bug that could cause a VM crash when a corrupt message is received on
distribution channel from other node.</p><p>Own Id: OTP-14661 Aux Id: ERIERL-80</p></li></ul><h2 id="erts-8-3-5-2" class="section-heading"><a href="#erts-8-3-5-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.3.5.2</span></h2><h3 id="fixed-bugs-and-malfunctions-248" class="section-heading"><a href="#fixed-bugs-and-malfunctions-248" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix performance bug in pre-allocators that could cause them to permanently
fall back on normal more expensive memory allocation. Pre-allocators are used
for quick allocation of short lived meta data used by messages and other
scheduled tasks. Bug exists since OTP_R15B02.</p><p>Own Id: OTP-14491</p></li><li><p>Fixed a bug that prevented TCP sockets from being closed properly on send
timeouts.</p><p>Own Id: OTP-14509</p></li><li><p>Fixed bug in operator <code class="inline">bxor</code> causing erroneuos result when one operand is a
big <em>negative</em> integer with the lowest <code class="inline">N*W</code> bits as zero and the other
operand not larger than <code class="inline">N*W</code> bits. <code class="inline">N</code> is an integer of 1 or larger and <code class="inline">W</code>
is 32 or 64 depending on word size.</p><p>Own Id: OTP-14514</p></li></ul><h2 id="erts-8-3-5-1" class="section-heading"><a href="#erts-8-3-5-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.3.5.1</span></h2><h3 id="fixed-bugs-and-malfunctions-249" class="section-heading"><a href="#fixed-bugs-and-malfunctions-249" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in gen_tcp:send where it never returned when repeatedly called on
a remotely closed TCP socket.</p><p>Own Id: OTP-13939 Aux Id: ERL-193</p></li><li><p>Fixed segfault that could happen during cleanup of aborted
erlang:port_command/3 calls. A port_command is aborted if the port is closed
at the same time as the port_command was issued. This bug was introduced in
erts-8.0.</p><p>Own Id: OTP-14481</p></li><li><p>Fixed implementation of <a href="erlang.html#statistics/1"><code class="inline">statistics(wall_clock)</code></a> and
<a href="erlang.html#statistics/1"><code class="inline">statistics(runtime)</code></a> so that values do not unnecessarily
wrap due to the emulator. Note that the values returned by
<a href="erlang.html#statistics/1"><code class="inline">statistics(runtime)</code></a> may still wrap due to limitations in
the underlying functionality provided by the operating system.</p><p>Own Id: OTP-14484</p></li></ul><h2 id="erts-8-3-5" class="section-heading"><a href="#erts-8-3-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.3.5</span></h2><h3 id="fixed-bugs-and-malfunctions-250" class="section-heading"><a href="#fixed-bugs-and-malfunctions-250" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Active-mode TCP sockets are now cleaned up properly on send/shutdown errors.</p><p>Own Id: OTP-14441 Aux Id: ERL-430</p></li><li><p>A code purge operation could under certain circumstances expand the size of
hibernated processes.</p><p>Own Id: OTP-14444 Aux Id: ERIERL-24</p></li><li><p>Fix so that the ERL_ZZ_SIGTERM_KILL introduced in erts-8.3.4 works.</p><p>Own Id: OTP-14451</p></li></ul><h2 id="erts-8-3-4" class="section-heading"><a href="#erts-8-3-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.3.4</span></h2><h3 id="fixed-bugs-and-malfunctions-251" class="section-heading"><a href="#fixed-bugs-and-malfunctions-251" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Add option to make SIGTERM trigger the OS default behaviour instead of doing a
graceful shutdown. To activate this bahviour the environment variable
ERL_ZZ_SIGTERM_KILL should be set to &quot;true&quot;. This option only works in OTP 19
as OTP 20 will have a different way to deal with SIGTERM.</p><p>Own Id: OTP-14418 Aux Id: ERIERL-15</p></li></ul><h2 id="erts-8-3-3" class="section-heading"><a href="#erts-8-3-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.3.3</span></h2><h3 id="fixed-bugs-and-malfunctions-252" class="section-heading"><a href="#fixed-bugs-and-malfunctions-252" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed memory segment cache used for multiblock carriers. Huge (&gt; 2GB) memory
segments could cause a VM crash. Creation of such huge memory segments used
for multiblock carriers is however very uncommon.</p><p>Own Id: OTP-14360 Aux Id: ERL-401, PR-1417</p></li><li><p>Fix release note for OTP-14290 in ERTS version 8.3.1. It was erroneously
placed under &quot;Known Bugs and Problems&quot;.</p><p>Own Id: OTP-14363 Aux Id: OTP-14290</p></li></ul><h2 id="erts-8-3-2" class="section-heading"><a href="#erts-8-3-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.3.2</span></h2><h3 id="fixed-bugs-and-malfunctions-253" class="section-heading"><a href="#fixed-bugs-and-malfunctions-253" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The <code class="inline">+Bi</code> command line argument of <code class="inline">erl</code> erroneously caused <code class="inline">SIGTERM</code> to be
ignored by the VM as well as of all its child processes. This bug was
introduced in erts version 8.3.</p><p>Own Id: OTP-14358 Aux Id: OTP-14085</p></li></ul><h2 id="erts-8-3-1" class="section-heading"><a href="#erts-8-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.3.1</span></h2><h3 id="fixed-bugs-and-malfunctions-254" class="section-heading"><a href="#fixed-bugs-and-malfunctions-254" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Invoking <a href="init.html#stop/0"><code class="inline">init:stop/0</code></a> via the SIGTERM signal, in a non-SMP BEAM, could cause
BEAM to terminate with fatal error. This has now been fixed and the BEAM will
terminate normally when SIGTERM is received.</p><p>Own Id: OTP-14290</p></li><li><p>Trying to open a directory with file:read_file/1 on Unix leaked a file
descriptor. This bug has now been fixed.</p><p>Own Id: OTP-14308 Aux Id: ERL-383</p></li></ul><h2 id="erts-8-3" class="section-heading"><a href="#erts-8-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.3</span></h2><h3 id="fixed-bugs-and-malfunctions-255" class="section-heading"><a href="#fixed-bugs-and-malfunctions-255" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a number of bugs that caused faulty stack-traces to be generated. The
faulty stack traces were generated either when applying the following
functions or tracing the following functions:</p><ul><li><a href="erlang.html#error/1"><code class="inline">erlang:error/1</code></a></li><li><a href="erlang.html#error/2"><code class="inline">erlang:error/2</code></a></li><li><a href="erlang.html#exit/1"><code class="inline">erlang:exit/1</code></a></li><li><a href="erlang.html#throw/1"><code class="inline">erlang:throw/1</code></a></li></ul><p>Own Id: OTP-14055</p></li><li><p>Corrected documentation about memory footprint for maps.</p><p>Own Id: OTP-14118</p></li><li><p>Fix <a href="erlang.html#process_info/2"><code class="inline">process_info(Pid, current_stacktrace)</code></a> to use stack
depth limit set by <code class="inline">system_flag(backtrace_depth)</code>. The old behavior was a hard
coded depth limit of 8.</p><p>Own Id: OTP-14119 Aux Id: PR-1263</p></li><li><p>A process calling
<a href="erlang.html#system_flag_multi_scheduling"><code class="inline">erlang:system_flag(multi_scheduling, block)</code></a>
could end up hanging forever in the call.</p><p>Own Id: OTP-14121</p></li><li><p>Dirty scheduler bug fixes:</p><ul><li>Fixed call time tracing of process being scheduled on dirty scheduler.</li><li>GC info from dirty schedulers.</li><li>Multi scheduling block with dirty schedulers could crash the runtime system.</li><li>Process structures could be removed prematurely.</li><li>GC on dirty scheduler could crash the runtime system.</li><li>Termination of a process executing on a dirty scheduler could cause a
runtime system crash.</li></ul><p>Own Id: OTP-14122</p></li><li><p>Fixed crash that occurred when writing timer data to a crash dump.</p><p>Own Id: OTP-14133</p></li><li><p>A literal area could be removed while still referred from processes.</p><p>Own Id: OTP-14134</p></li><li><p>Fixed a bug in the garbage collector that could crash the runtime system.</p><p>Own Id: OTP-14135</p></li><li><p>Fixed a bug in call-time trace for NIFs which caused tracing to erroneously be
started multiple times for one call.</p><p>Own Id: OTP-14136</p></li><li><p>Remove a debug printout and an unnecessary garbage collection when handling
exceptions in hipe compiled code.</p><p>Own Id: OTP-14153</p></li><li><p>Fix bug in tracing of garbage collection that could cause VM crash. Bug exists
since OTP 19.0.</p><p>Own Id: OTP-14154</p></li><li><p>Fix bug in <code class="inline">binary_to_term</code> for binaries created by <code class="inline">term_to_binary</code>with
option <code class="inline">compressed</code>. The bug can cause <code class="inline">badarg</code> exception for a valid binary
when Erlang VM is linked against a <code class="inline">zlib</code> library of version 1.2.9 or newer.
Bug exists since OTP 17.0.</p><p>Own Id: OTP-14159 Aux Id: ERL-340</p></li><li><p>Fix suspension of schedulers when generating a crashdump.</p><p>Own Id: OTP-14164</p></li><li><p>NIF resources was not handled in a thread-safe manner in the runtime system
without SMP support.</p><p>As a consequence of this fix, the following driver functions are now
thread-safe also in the runtime system without SMP support:</p><ul><li><code class="inline">driver_free_binary()</code></li><li><code class="inline">driver_realloc_binary()</code></li><li><code class="inline">driver_binary_get_refc()</code></li><li><code class="inline">driver_binary_inc_refc()</code></li><li><code class="inline">driver_binary_dec_refc()</code></li></ul><p>Own Id: OTP-14202</p></li><li><p>Fix <a href="erlang.html#round/1"><code class="inline">erlang:round/1</code></a> for large floating point numbers with an odd absolute
value between <code class="inline">(1 bsl 52)</code> and <code class="inline">(1 bsl 53)</code>. The result was falsely calculated
as the next higher even number even though all integer values up to
<code class="inline">(1 bsl 53)</code> can be represented as floats with full precision.</p><p>Own Id: OTP-14227</p></li><li><p>Add size of literals to module code size in crash dump and <code class="inline">(l)oaded</code> command
in break menu like it used to be before OTP-19.0.</p><p>Own Id: OTP-14228</p></li><li><p>Fix potential bug in <code class="inline">enif_send</code> when called without a process context and
with argument <code class="inline">msg_env</code> as <code class="inline">NULL</code>.</p><p>Own Id: OTP-14229</p></li><li><p>Fix bug where passing an appendable binary to <code class="inline">erlang:port_control()</code> could
crash the emulator.</p><p>Own Id: OTP-14231</p></li><li><p>Receive expressions with timeout in the Erlang shell could cause a VM crash.</p><p>Own Id: OTP-14241 Aux Id: ERL-365</p></li></ul><h3 id="improvements-and-new-features-58" class="section-heading"><a href="#improvements-and-new-features-58" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>A received SIGTERM signal to beam will generate a <code class="inline">'stop'</code> message to the
<code class="inline">init</code> process and terminate the Erlang VM nicely. This is equivalent to
calling <a href="init.html#stop/0"><code class="inline">init:stop/0</code></a>.</p><p>Own Id: OTP-14085</p></li><li><p>Workaround for buggy Android implementation of <code class="inline">PTHREAD_STACK_MIN</code> causing
build of runtime system to crash on undeclared <code class="inline">PAGE_SIZE</code>.</p><p>Own Id: OTP-14165 Aux Id: ERL-319</p></li><li><p>Add configure option --without-thread-names that removes the naming of
individual emulator threads.</p><p>Own Id: OTP-14234</p></li><li><p>Add warning in documentation of <a href="zlib.html#deflateInit/6"><code class="inline">zlib:deflateInit/6</code></a> about option
<code class="inline">WindowsBits</code> values 8 and -8.</p><p>Own Id: OTP-14254 Aux Id: ERL-362</p></li></ul><h2 id="erts-8-2-2" class="section-heading"><a href="#erts-8-2-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.2.2</span></h2><h3 id="fixed-bugs-and-malfunctions-256" class="section-heading"><a href="#fixed-bugs-and-malfunctions-256" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix bug in <code class="inline">binary_to_term</code> for binaries created by <code class="inline">term_to_binary</code>with
option <code class="inline">compressed</code>. The bug can cause <code class="inline">badarg</code> exception for a valid binary
when Erlang VM is linked against a <code class="inline">zlib</code> library of version 1.2.9 or newer.
Bug exists since OTP 17.0.</p><p>Own Id: OTP-14159 Aux Id: ERL-340</p></li><li><p>The driver efile_drv when opening a file now use fstat() on the open file
instead of stat() before opening, if fstat() exists. This avoids a race when
the file happens to change between stat() and open().</p><p>Own Id: OTP-14184 Aux Id: seq-13266</p></li></ul><h2 id="erts-8-2-1" class="section-heading"><a href="#erts-8-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-257" class="section-heading"><a href="#fixed-bugs-and-malfunctions-257" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix a quite rare bug causing VM crash during code loading and the use of
export funs (fun M:F/A) of not yet loaded modules. Requires a very specific
timing of concurrent scheduler threads. Has been seen on ARM but can probably
also occurred on other architectures. Bug has existed since OTP R16.</p><p>Own Id: OTP-14144 Aux Id: seq13242</p></li></ul><h2 id="erts-8-2" class="section-heading"><a href="#erts-8-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.2</span></h2><h3 id="fixed-bugs-and-malfunctions-258" class="section-heading"><a href="#fixed-bugs-and-malfunctions-258" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed <code class="inline">configure</code> failures on MacOSX. Most important <code class="inline">clock_gettime()</code> was
detected when building for MacOSX - El Capitan using XCode 8 despite it is not
available until MacOSX - Sierra.</p><p>Own Id: OTP-13904 Aux Id: ERL-256</p></li><li><p><a href="../../apps/kernel/code.html#add_pathsa/1"><code class="inline">code:add_pathsa/1</code></a> and command line option <code class="inline">-pa</code> both revert the given list
of directories when adding it at the beginning of the code path. This is now
documented.</p><p>Own Id: OTP-13920 Aux Id: ERL-267</p></li><li><p>Fix a compilation error of erts in OpenBSD related to the usage of the
__errno variable.</p><p>Own Id: OTP-13927</p></li><li><p>Fixed so that when enabling tracing on a process that had an invalid tracer
associated with it, the new tracer overwrites the old tracer. Before this fix,
calling erlang:trace/3 would behave as if the tracer was still alive and not
apply the new trace.</p><p>This fault was introduced in ERTS 8.0.</p><p>Own Id: OTP-13928</p></li><li><p>Fix parsing of <code class="inline">-profile_boot 'true' | 'false'</code></p><p>Own Id: OTP-13955 Aux Id: ERL-280</p></li><li><p>A slight improvement of <code class="inline">erlang:get_stacktrace/0</code> for exceptions raised in
hipe compiled code. Beam compiled functions in such stack trace was earlier
replaced by some unrelated function. They are now instead omitted. This is an
attempt to reduce the confusion in the absence of a complete and correct stack
trace for mixed beam and hipe functions.</p><p>Own Id: OTP-13992</p></li><li><p>Correct type declaration of match specification head.</p><p>Own Id: OTP-13996</p></li><li><p>HiPE code loading failed for x86_64 if gcc was configured with
<code class="inline">--enable-default-pie</code>. Fixed by disabling PIE, if needed for HiPE, when
building the VM.</p><p>Own Id: OTP-14031 Aux Id: ERL-294, PR-1239</p></li><li><p>Faulty arguments could be presented on exception from a NIF that had
rescheduled itself using <code class="inline">enif_schedule_nif()</code>.</p><p>Own Id: OTP-14048</p></li><li><p>The runtime system could crash if a garbage collection on a process was
performed immediately after a NIF had been rescheduled using
<code class="inline">enif_schedule_nif()</code>.</p><p>Own Id: OTP-14049</p></li><li><p>A reference to purged code could be left undetected by the purge operation if
a process just had rescheduled a NIF call using <code class="inline">enif_schedule_nif()</code> when the
process was checked. This could cause a runtime system crash.</p><p>Own Id: OTP-14050</p></li><li><p>Fixed a number of dirty scheduler related bugs:</p><ul><li>Process priority was not handled correct when scheduling on a dirty
scheduler.</li><li>The runtime system could crash when an exit signal with a compound exit
reason was sent to a process executing on a dirty scheduler.</li><li>The runtime system crashed when call tracing a process executing on a dirty
scheduler.</li><li>A code purge operation could end up hanging forever when a process executed
on a dirty scheduler</li></ul><p>Own Id: OTP-14051</p></li></ul><h3 id="improvements-and-new-features-59" class="section-heading"><a href="#improvements-and-new-features-59" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Fix minor soft purge race bug that could incorrectly trigger code_server to
load new code for the module if the soft purge failed and no current version
of the module existed.</p><p>Own Id: OTP-13925</p></li><li><p>To ease troubleshooting, <a href="erlang.html#load_nif/2"><code class="inline">erlang:load_nif/2</code></a> now includes the return value
from a failed call to load/reload/upgrade in the text part of the error tuple.
The <code class="inline">crypto</code> NIF makes use of this feature by returning the source line
where/if the initialization fails.</p><p>Own Id: OTP-13951</p></li><li><p>New environment variable <code class="inline">ERL_CRASH_DUMP_BYTES</code> can be used to limit the size
of crash dumps. If the limit is reached, crash dump generation is aborted and
the generated file will be truncated.</p><p>Own Id: OTP-14046</p></li></ul><h2 id="erts-8-1-1-1" class="section-heading"><a href="#erts-8-1-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.1.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-259" class="section-heading"><a href="#fixed-bugs-and-malfunctions-259" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A code purge operation could under certain circumstances expand the size of
hibernated processes.</p><p>Own Id: OTP-14444 Aux Id: ERIERL-24</p></li></ul><h2 id="erts-8-1-1" class="section-heading"><a href="#erts-8-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-260" class="section-heading"><a href="#fixed-bugs-and-malfunctions-260" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The emulator got a dynamic library dependency towards libsctp, which on Linux
was not intended since the emulator there loads and resolves the needed sctp
functions in runtime. This has been fixed and a configure switch
--enable-sctp=lib has been added for those who want such a library dependency.</p><p>Own Id: OTP-13956 Aux Id: ERL-262, ERL-133</p></li><li><p>Fix SIGUSR1 crashdump generation</p><p>Do not generate a core when a crashdump is asked for.</p><p>Own Id: OTP-13997</p></li><li><p>The new functions in <code class="inline">code</code> that allows loading of many modules at once had a
performance problem. While executing a helper function in the
<code class="inline">erl_prim_loader</code> process, garbage messages were produced. The garbages
messages were ignored and ultimately discarded, but there would be a negative
impact on performance and memory usage. The number of garbage message depended
on both the number of modules to be loaded and the length of the code path.</p><p>The functions affected of this problem were: <code class="inline">atomic_load/1</code>,
<code class="inline">ensure_modules_loaded/1</code>, and <code class="inline">prepare_loading/1</code>.</p><p>Own Id: OTP-14009</p></li></ul><h2 id="erts-8-1" class="section-heading"><a href="#erts-8-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.1</span></h2><h3 id="fixed-bugs-and-malfunctions-261" class="section-heading"><a href="#fixed-bugs-and-malfunctions-261" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix bug for calls from hipe code to BIFs that disable GC while yielding. Has
been causing Dialyzer crashes on ARM (and presumably all other non-intel
platforms).</p><p>Own Id: OTP-13724 Aux Id: PR-1116</p></li><li><p>Fix a bug where changing the current working directory of the VM would not
change the current working directory of programs spawned using
<code class="inline">erlang:open_port({spawn,&quot;&quot;}, ...)</code>.</p><p>Own Id: OTP-13733 Aux Id: ERL-175</p></li><li><p>Fix a bug where disabling tracing from a process that had return_to tracing
enabled and was tracing on <a href="erlang.html#trace/3"><code class="inline">erlang:trace/3</code></a> would cause a segmentation fault.</p><p>Own Id: OTP-13734</p></li><li><p>Update all erts documentation to use simpler English, use consistent
terminology and be easier to navigate.</p><p>Own Id: OTP-13740</p></li><li><p>Add dirty schedulers to the microstate accounting statistics.</p><p>Own Id: OTP-13744</p></li><li><p>Fixed dirty scheduler build support on 32-bit windows.</p><p>Own Id: OTP-13759</p></li><li><p>inet:getstat(Socket) on an SCTP socket returned 0 for send stats. This bug has
now been corrected. Reported by systra as issue ERL-102 on bugs.erlang.org.</p><p>Own Id: OTP-13773 Aux Id: ERL-102</p></li><li><p>AF_UNSPEC and unknown address families were misread by UDP receive in
prim_inet resulting in an exception. This bug has now been corrected.</p><p>Own Id: OTP-13775</p></li><li><p>Sweep HiPE stack for literals during code purge.</p><p>Own Id: OTP-13777 Aux Id: PR-1122</p></li><li><p>Fix bug in run_erl for OpenBSD that could cause it on rare occations to exit
without starting the program (erl) at all.</p><p>Own Id: OTP-13795</p></li><li><p>Update build scripts to not make assumptions about where env, cp and perl are
located.</p><p>Own Id: OTP-13800</p></li><li><p>Fixed a bug where init:stop could deadlock if a process with infinite shutdown
timeout (e.g. a supervisor) attempted to load code while terminating.</p><p>Own Id: OTP-13802</p></li><li><p>Fixed a segmentation fault on sparc CPUs when free'ing a tracer module's
state.</p><p>Own Id: OTP-13803</p></li><li><p><code class="inline">fun</code>s was not properly handled during purge of a module. This could cause a
crash of the VM after a purge of a module.</p><p>Own Id: OTP-13809</p></li><li><p>Fixed a memory leak when the process monitoring a port crashed.</p><p>Own Id: OTP-13818</p></li><li><p>Fixed multiple dirty scheduler related tracing bugs.</p><p>Own Id: OTP-13822</p></li><li><p>Fix error handling in beam code runtime loader for a number of cases when
index and size fields got corrupted (negative) values.</p><p>Own Id: OTP-13848 Aux Id: ERL-216</p></li><li><p>Minor fix of dirty scheduler implementation.</p><p>Own Id: OTP-13852</p></li><li><p>Calls to <code class="inline">erl_drv_send_term()</code> or <code class="inline">erl_drv_output_term()</code> from a non-scheduler
thread while the corresponding port was invalid caused the emulator to enter
an inconsistent state which eventually caused an emulator crash.</p><p>Own Id: OTP-13866</p></li><li><p>Fix a rare race condition in <code class="inline">erlang:open_port({spawn, &quot;&quot;}, ...)</code> that would
result in the erl_child_setup program aborting and cause the emulator to exit.</p><p>Own Id: OTP-13868</p></li><li><p>Driver and NIF operations accessing processes or ports could cause an emulator
crash when used from non-scheduler threads. Those operations are:</p><ul><li><code class="inline">erl_drv_send_term()</code></li><li><code class="inline">driver_send_term()</code></li><li><code class="inline">erl_drv_output_term()</code></li><li><code class="inline">driver_output_term()</code></li><li><code class="inline">enif_send()</code></li><li><code class="inline">enif_port_command()</code></li></ul><p>Own Id: OTP-13869</p></li><li><p>Fix start scripts generation dependency in Makefile</p><p>Own Id: OTP-13871 Aux Id: ERL-241</p></li><li><p>The VM could crash if <code class="inline">erlang:get_stacktrace()</code> was called after a rescheduled
NIF had thrown an exception.</p><p>Own Id: OTP-13877</p></li><li><p>Calling <a href="../../apps/kernel/code.html#delete/1"><code class="inline">code:delete/1</code></a> before a loading a module with an on_load function,
the old code would be overwritten, causing a memory or a crash if NIFs were
involved. (Thanks to vans163 for reporting this bug.)</p><p>Own Id: OTP-13893 Aux Id: ERL-240</p></li></ul><h3 id="improvements-and-new-features-60" class="section-heading"><a href="#improvements-and-new-features-60" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Improved accuracy of timeouts on MacOS X. This by setting premature timeouts
followed by a short actual timeout during scheduler wait.</p><p>Own Id: OTP-13698</p></li><li><p>Added the following symbolic time unit representations to the
<a href="erlang.html#t:time_unit/0"><code class="inline">erlang:time_unit/0</code></a> type:</p><ul><li><code class="inline">second</code></li><li><code class="inline">millisecond</code></li><li><code class="inline">microsecond</code></li><li><code class="inline">nanosecond</code></li></ul><p>The following symbolic time unit representations are now <em>deprecated</em>, but
still part of the <a href="erlang.html#t:time_unit/0"><code class="inline">erlang:time_unit()</code></a> type:</p><ul><li><code class="inline">seconds</code></li><li><code class="inline">milli_seconds</code></li><li><code class="inline">micro_seconds</code></li><li><code class="inline">nano_seconds</code></li></ul><p>Own Id: OTP-13735</p></li><li><p>Fix maps hashing entropy of maps with maps keys.</p><p>Own Id: OTP-13763 Aux Id: ERL-199</p></li><li><p>Improved dirty scheduler support. A purge of a module can now be performed
without having to wait for completion of all ongoing dirty NIF calls.</p><p>Note that when enabling support for dirty schedulers, a new purge strategy
will as of ERTS version 8.1 be enabled. This new strategy is not fully
backwards compatible with the strategy used by default. For more information
see the documentation of <a href="erlang.html#check_process_code/3"><code class="inline">erlang:check_process_code/3</code></a>.</p><p>Own Id: OTP-13808 Aux Id: OTP-13833</p></li><li><p>A new purge strategy has been introduced. The new strategy will by default be
disabled during the OTP 19 release, but will be the only strategy available as
of the OTP 20 release.</p><p>The new strategy is slightly incompatible with the strategy being used by
default in OTP 19. Using the default strategy, processes holding <code class="inline">fun</code>s that
refer to the module being purged either fail a soft purge, or will be killed
during a hard purge. The new strategy completely ignores <code class="inline">fun</code>s. If <code class="inline">fun</code>s
referring to the code being purged exist, and are used after a purge, an
exception will be raised upon usage. That is, the behavior will be exactly the
same as the case when a <code class="inline">fun</code> is received by a process after the purge.</p><p>The new strategy can optionally be enabled when building OTP during OTP 19,
and will automatically be enabled if the runtime system is built with support
for dirty schedulers.</p><p>For more information see the documentation of <a href="erlang.html#check_process_code/3"><code class="inline">erlang:check_process_code/3</code></a>.</p><p>Own Id: OTP-13833</p></li><li><p>Fixed unnecessary overestimation of heap size need during garbage collection.</p><p>Own Id: OTP-13851</p></li></ul><h2 id="erts-8-0-5" class="section-heading"><a href="#erts-8-0-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.0.5</span></h2><h3 id="fixed-bugs-and-malfunctions-262" class="section-heading"><a href="#fixed-bugs-and-malfunctions-262" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a VM crash that occurred in a garbage collection of a process when it
had received binaries. This bug was introduced in ERTS version 8.0 (OTP 19.0).</p><p>Own Id: OTP-13890</p></li></ul><h2 id="erts-8-0-4" class="section-heading"><a href="#erts-8-0-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.0.4</span></h2><h3 id="fixed-bugs-and-malfunctions-263" class="section-heading"><a href="#fixed-bugs-and-malfunctions-263" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a VM crash that occurred in garbage collection of a process when it had
received maps over the distribution. This bug was introduced in ERTS version
8.0 (OTP 19.0).</p><p>Own Id: OTP-13889</p></li></ul><h2 id="erts-8-0-3" class="section-heading"><a href="#erts-8-0-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.0.3</span></h2><h3 id="fixed-bugs-and-malfunctions-264" class="section-heading"><a href="#fixed-bugs-and-malfunctions-264" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a race that could cause a lost wakeup of a process that timed out in a
<code class="inline">receive ... after</code>. This bug was introduced in ERTS version 7.0.</p><p>Own Id: OTP-13798 Aux Id: OTP-11997</p></li><li><p>Fixed segfault after writing an erl crash dump.</p><p>Own Id: OTP-13799</p></li></ul><h2 id="erts-8-0-2" class="section-heading"><a href="#erts-8-0-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.0.2</span></h2><h3 id="fixed-bugs-and-malfunctions-265" class="section-heading"><a href="#fixed-bugs-and-malfunctions-265" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix scheduler deadlock bug in <a href="../../apps/stdlib/ets.html#update_counter/4"><code class="inline">ets:update_counter/4</code></a> when key is not found and
inserting the default object causes the table to grow.</p><p>Own Id: OTP-13731 Aux Id: ERL-188</p></li><li><p>Fix VM abort &quot;Overrun stack and heap&quot; in garbage collection triggered by a
<code class="inline">bsl</code> operation and some very specific heap conditions.</p><p>Own Id: OTP-13732 Aux Id: seq13142</p></li></ul><h2 id="erts-8-0-1" class="section-heading"><a href="#erts-8-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-266" class="section-heading"><a href="#fixed-bugs-and-malfunctions-266" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A memory allocation bug in <a href="erlang.html#group_leader/2"><code class="inline">group_leader/2</code></a> could cause an
emulator crash when garbage collecting a process that had been assigned a
remote group leader. This bug was introduced in ERTS version 8.0.</p><p>Own Id: OTP-13716</p></li></ul><h2 id="erts-8-0" class="section-heading"><a href="#erts-8-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 8.0</span></h2><h3 id="fixed-bugs-and-malfunctions-267" class="section-heading"><a href="#fixed-bugs-and-malfunctions-267" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The handling of <code class="inline">on_load</code> functions has been improved. The major improvement
is that if a code upgrade fails because the <code class="inline">on_load</code> function fails, the
previous version of the module will now be retained.</p><p>Own Id: OTP-12593</p></li><li><p><code class="inline">is_builtin(erlang, apply, 3)</code> will now return <code class="inline">true</code>.</p><p>Own Id: OTP-13034</p></li><li><p>Fix <code class="inline">enif_get_list_length</code> to return false if list is improper or have length
larger than <code class="inline">UINT_MAX</code> (did return true and an incorrect length value).</p><p>Own Id: OTP-13288 Aux Id: PR913</p></li><li><p>Cleanup hipe signal handling code for x86 and make it more portable.</p><p>Own Id: OTP-13341 Aux Id: PR951</p></li><li><p>Make file:datasync use fsync instead of fdatasync on Mac OSX.</p><p>Own Id: OTP-13411</p></li><li><p>Make sure to create a crash dump when running out of memory. This was
accidentally removed in the erts-7.3 release.</p><p>Own Id: OTP-13419</p></li><li><p>A bug has been fixed where if erlang was started +B on a unix platform it
would be killed by a SIGUSR2 signal when creating a crash dump.</p><p>Own Id: OTP-13425</p></li><li><p>Fix race between <a href="erlang.html#process_flag/2"><code class="inline">process_flag(trap_exit,true)</code></a> and a
received exit signal.</p><p>A process could terminate due to exit signal even though
<a href="erlang.html#process_flag/2"><code class="inline">process_flag(trap_exit,true)</code></a> had returned. A very
specific timing between call to <a href="erlang.html#process_flag/2"><code class="inline">process_flag/2</code></a> and exit
signal from another scheduler was required for this to happen.</p><p>Own Id: OTP-13452</p></li><li><p>Don't search for non-existing Map keys twice</p><p>For <code class="inline">maps:get/2,3</code> and <a href="../../apps/stdlib/maps.html#find/2"><code class="inline">maps:find/2</code></a>, searching for an immediate key, e.g. an
atom, in a small map, the search was performed twice if the key did not exist.</p><p>Own Id: OTP-13459</p></li><li><p>When an abnormally large distribution message is about to be sent, the VM has
been changed to create a crash dump instead of a core dump.</p><p>Own Id: OTP-13474</p></li><li><p>Fix <a href="erlang.html#process_info/2"><code class="inline">erlang:process_info/2</code></a> type specification</p><p>Own Id: OTP-13485 Aux Id: ERL-123</p></li><li><p>Fix bug in <a href="erlang.html#open_port/2"><code class="inline">open_port/2</code></a> with option <code class="inline">{args, List}</code>. A vm
crash could be caused by an improper <code class="inline">List</code>.</p><p>Own Id: OTP-13489 Aux Id: ERL-127</p></li><li><p>Fixed a race-condition bug where the emulator could crash when
<code class="inline">erlang:system_profile/1,2</code> was enabled and a process had to be re-scheduled
during termination.</p><p>Own Id: OTP-13494 Aux Id: ERL-126</p></li><li><p>Fixed bugs where the reduction counter was not handled correct.</p><p>Own Id: OTP-13512</p></li><li><p>Fixed typo in description of the <code class="inline">EPMD_DUMP_REQ</code> response.</p><p>Own Id: OTP-13517</p></li><li><p>Fixed a bug where a process flagged as sensitive would sometimes record its
save_calls when it shouldn't.</p><p>Own Id: OTP-13540</p></li><li><p>Update configure scripts to not use hard-coded path for /bin/pwd and /bin/rm.</p><p>Own Id: OTP-13562</p></li><li><p>When passing a larger binary than the outputv callback of a linked-in driver
can handle in one io vector slot, the binary is now split into multiple slots
in the io vector. This change only effects system where the max size of an io
vector slot is smaller then the word size of the system (e.g. Windows).</p><p>This change means that it is now possible on Windows to send binaries that are
larger than 4GB to port_command, which is what is used for file:write,
gen_tcp:send etc.</p><p>Own Id: OTP-13628</p></li><li><p>Workaround of Maps output in crashdumps. Currently the atom 'undefined' is
generated instead of Map data if a Map type is encountered during crash.</p><p>Own Id: OTP-13657</p></li></ul><h3 id="improvements-and-new-features-61" class="section-heading"><a href="#improvements-and-new-features-61" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The tracing support has been extended to allow a
<a href="erl_tracer.html">tracer module</a> to be the trace event handler instead of a
process or port. The <a href="erl_tracer.html">tracer module</a> makes it possible for
trace tools to filter or manipulate trace event data without the trace event
first having to be copied from the traced process or port.</p><p>With the introduction of this feature, <code class="inline">erlang:trace(all|existing, _, _)</code> now
also returns the tracer process as part of the number of processes on which
tracing is enabled. The is incompatible with the previous releases.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-10267</p></li><li><p>Introduce LTTng tracing of Erlang Runtime System</p><p>For LTTng to be enabled OTP needs to be built with configure option
<code class="inline">--with-dynamic-trace=lttng</code>.</p><p>This feature introduces tracepoints for schedulers, drivers, memory carriers,
memory and async thread pool.</p><p>For a list of all tracepoints, see
<a href="../../apps/runtime_tools/lttng.html">Runtime Tools User's Guide</a> .</p><p>Own Id: OTP-10282</p></li><li><p>Make it possible to monitor/demonitor ports using the <a href="erlang.html#monitor/2"><code class="inline">erlang:monitor/2</code></a> API.
The process and port information functions have also been updated to include
information about monitors from processes to ports.</p><p>Own Id: OTP-11384</p></li><li><p>Add microstate accounting</p><p>Microstate accounting is a way to track which state the different threads
within ERTS are in. The main usage area is to pin point performance
bottlenecks by checking which states the threads are in and then from there
figuring out why and where to optimize.</p><p>Since checking whether microstate accounting is on or off is relatively
expensive only a few of the states are enabled by default and more states can
be enabled through configure.</p><p>There is a convenience module called msacc that has been added to
runtime_tools that can assist in gathering and interpreting the data from
Microstate accounting.</p><p>For more information see
<a href="erlang.html#statistics_microstate_accounting">erlang:statistics(microstate<em>accounting, </em>)</a>
and the <a href="../../apps/runtime_tools/msacc.html"><code class="inline">msacc</code></a> module in runtime_tools.</p><p>Own Id: OTP-12345</p></li><li><p>The port of Erlang/OTP to the real-time operating system OSE has been removed.</p><p>Own Id: OTP-12573</p></li><li><p>Sharing preserved copy for messages and exit signals</p><p>Enable sharing preserved copy with configure option
<code class="inline">--enable-sharing-preserving</code>. This will preserve sharing, within the process,
when communication with other processes in the Erlang node. There is a
trade-off, the copy is more costly but this cost can be reclaimed if there is
a lot of sharing in the message. In addition literals will not be copied in a
send except during a purge phase of the module where the literals are located.
This feature is considered experimental in 19.0.</p><p>Own Id: OTP-12590 Aux Id: OTP-10251</p></li><li><p>Halfword BEAM has been removed.</p><p>Own Id: OTP-12883</p></li><li><p>Added <a href="../../apps/kernel/os.html#perf_counter/1"><code class="inline">os:perf_counter/1</code></a>.</p><p>The perf_counter is a very very cheap and high resolution timer that can be
used to timestamp system events. It does not have monoticity guarantees, but
should on most OS's expose a monotonous time.</p><p>Own Id: OTP-12908</p></li><li><p>Support for a fragmented young heap generation. That is, the young heap
generation can consist of multiple non continuous memory areas. The main
reason for this change is to avoid extra copying of messages that could not be
allocated directly on the receivers heap.</p><p>Own Id: OTP-13047</p></li><li><p>Erlang linked-in driver can now force the call to open_port to block until a
call to erl_drv_init_ack is made inside the driver. This is useful when you
want to do some asynchronous initialization, for example getting configuration
from a pipe, and you want the initial open_port call to fail if the
configuration is incomplete or wrong. See the erl_driver documentation for
more details on the API.</p><p>Own Id: OTP-13086</p></li><li><p>Erlang linked-in drivers can now set their own pids as seen in
<a href="erlang.html#port_info/1"><code class="inline">erlang:port_info/1</code></a> by using the <code class="inline">erl_drv_set_pid</code> function. For more details
see the erl_driver documentation.</p><p>Own Id: OTP-13087</p></li><li><p>The functionality behind <a href="erlang.html#open_port/2"><code class="inline">erlang:open_port/2</code></a> when called with spawn or
spawn_executable has been redone so that the forking of the new program is
done in a separate process called erl_child_setup. This allows for a much more
robust implementation that uses less memory and does not block the entire
emulator if the program to be started is on an un-accessible NFS. Benchmarks
have shown this approach to be about 3-5 times as fast as the old approach
where the fork/vfork was done by erts. This is a pure stability and
performance fix, however some error messages may have changed, which is why it
is marked as a backwards incompatible change.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-13088</p></li><li><p>Improved yielding strategy in the implementation of the following native
functions:</p><ul><li><a href="erlang.html#binary_to_list/1"><code class="inline">erlang:binary_to_list/1</code></a></li><li><a href="erlang.html#binary_to_list/3"><code class="inline">erlang:binary_to_list/3</code></a></li><li><a href="erlang.html#bitstring_to_list/1"><code class="inline">erlang:bitstring_to_list/1</code></a></li><li><a href="erlang.html#list_to_binary/1"><code class="inline">erlang:list_to_binary/1</code></a></li><li><a href="erlang.html#iolist_to_binary/1"><code class="inline">erlang:iolist_to_binary/1</code></a></li><li><a href="erlang.html#list_to_bitstring/1"><code class="inline">erlang:list_to_bitstring/1</code></a></li><li><a href="../../apps/stdlib/binary.html#list_to_bin/1"><code class="inline">binary:list_to_bin/1</code></a></li></ul><p>This in order to improve performance of these functions.</p><p>Own Id: OTP-13096</p></li><li><p>All garbage collections of processes now bump reductions. Also the amount of
reductions bumped when garbage collecting has been adjusted. It now better
corresponds to the amount of work performed. This in order to improve the real
time characteristics of the system.</p><p>Own Id: OTP-13097</p></li><li><p>New functions that can load multiple modules at once have been added to the
'<code class="inline">code</code>' module. The functions are <a href="../../apps/kernel/code.html#atomic_load/1"><code class="inline">code:atomic_load/1</code></a>,
<a href="../../apps/kernel/code.html#prepare_loading/1"><code class="inline">code:prepare_loading/1</code></a>, <a href="../../apps/kernel/code.html#finish_loading/1"><code class="inline">code:finish_loading/1</code></a>, and
<a href="../../apps/kernel/code.html#ensure_modules_loaded/1"><code class="inline">code:ensure_modules_loaded/1</code></a>.</p><p>Own Id: OTP-13111</p></li><li><p>The <code class="inline">-boot_var</code> option for <code class="inline">erl</code> now only supports a single key and single
value (as documented). The option used to allow multiple key/value pairs, but
that behavior was undocumented.</p><p>The function <code class="inline">erl_prim_loader:start/3</code> has been removed. Its documentation has
also been removed.</p><p>The undocumented and unsupported function <code class="inline">erl_prim_loader:get_files/2</code> has
been removed.</p><p>Own Id: OTP-13112</p></li><li><p>Low level BIF <a href="erlang.html#purge_module/1"><code class="inline">erlang:purge_module/1</code></a> is made more robust against incorrect
use. Lingering processes that still refer the old code are now killed before
the module is purged to prevent fatal VM behavior.</p><p>Own Id: OTP-13122</p></li><li><p>Improved dirty scheduler implementation. For more information see the
<a href="erl_nif.html#dirty_nifs">NIF documentation</a>.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><ul><li>The dirty scheduler support is still <em>experimental</em>.</li><li>The support for determining whether dirty NIF support exist or not at
compile time using the C preprocessor macro
<code class="inline">ERL_NIF_DIRTY_SCHEDULER_SUPPORT</code> has been removed.</li><li>The <code class="inline">enif_is_on_dirty_scheduler()</code> function has been removed. Use
<a href="erl_nif.html#enif_thread_type"><code class="inline">enif_thread_type()</code></a> instead.</li></ul></section><p>Own Id: OTP-13123</p></li><li><p>Various optimizations done to process dictionary access.</p><p>Own Id: OTP-13167</p></li><li><p>Added max_heap_size process flag. max_heap_size allows the user to limit the
maximum heap used by a process. See
<a href="erlang.html#process_flag/2">erlang:process_flag</a> for more details.</p><p>Own Id: OTP-13174</p></li><li><p>Allow dynamic drivers and NIF libraries to be built with gcc option
<code class="inline">-fvisibility=hidden</code> for faster loading and more optimized code.</p><p>Own Id: OTP-13227</p></li><li><p>Add <code class="inline">erlang:process_info(Pid, garbage_collection_info)</code> which returns extended
garbage_collection information. For more details see the documentation.</p><p>Own Id: OTP-13265</p></li><li><p>The functions <a href="erlang.html#list_to_integer/1"><code class="inline">erlang:list_to_integer/1</code></a> and <a href="../../apps/stdlib/string.html#to_integer/1"><code class="inline">string:to_integer/1</code></a> have been
optimized for large inputs.</p><p>Own Id: OTP-13293</p></li><li><p>Improved memory allocation strategy for hipe native code on x86_64 (amd64)
architectures by reserving enough low virtual address space needed for the
HiPE/AMD64 small code model. The default virtual address area for hipe code is
set to 512Mb, but can be changed with emulator flag <code class="inline">+MXscs</code>.</p><p>Own Id: OTP-13359</p></li><li><p>Introduction of configurable management of data referred to by the message
queue of a process. Each process can be configured individually.</p><p>It is now possible to configure the message queue of a process, so that all
data referred by it will be kept outside of the heap, and by this prevent this
data from being part of garbage collections.</p><p>For more information see the documentation of
<a href="erlang.html#process_flag_message_queue_data"><code class="inline">process_flag(message_queue_data, MQD)</code></a>.</p><p>Own Id: OTP-13366 Aux Id: OTP-13047</p></li><li><p>Processes now yield when scanning large message queues and not finding a
matching message. This in order to improve real time characteristics.</p><p>Own Id: OTP-13401</p></li><li><p>Optimized an erts internal function that is used to traverse erlang terms. The
internal function was mainly used by term_to_binary and comparison of terms.
Benchmarks have shown up to a 10% performance increase in those functions
after the optimization.</p><p>Own Id: OTP-13440</p></li><li><p>Add the following NIF API functions:</p><ul><li><a href="erl_nif.html#enif_cpu_time"><code class="inline">enif_cpu_time</code></a></li><li><a href="erl_nif.html#enif_now_time"><code class="inline">enif_now_time</code></a></li><li><a href="erl_nif.html#enif_make_unique_integer"><code class="inline">enif_make_unique_integer</code></a></li><li><a href="erl_nif.html#enif_is_process_alive"><code class="inline">enif_is_process_alive</code></a></li><li><a href="erl_nif.html#enif_is_port_alive"><code class="inline">enif_is_port_alive</code></a></li><li><a href="erl_nif.html#enif_term_to_binary"><code class="inline">enif_term_to_binary</code></a></li><li><a href="erl_nif.html#enif_binary_to_term"><code class="inline">enif_binary_to_term</code></a></li><li><a href="erl_nif.html#enif_port_command"><code class="inline">enif_port_command</code></a></li></ul><p>For details of what each function does, see the erl_nif documentation.</p><p>Own Id: OTP-13442</p></li><li><p>Optimize <code class="inline">'++'</code> operator and <a href="../../apps/stdlib/lists.html#append/2"><code class="inline">lists:append/2</code></a> by using a single pass to build
a new list while checking for properness.</p><p>Own Id: OTP-13487</p></li><li><p>Handle terms (pids,ports and refs) from nodes with a 'creation' value larger
than 3. This is a preparation of the distribution protocol to allow OTP 19
nodes to correctly communicate with future nodes (20 or higher). The
'creation' value differentiates different incarnations of the same node
(name).</p><p>Own Id: OTP-13488</p></li><li><p>Don't send unasked for systemd notifications in epmd</p><p>Own Id: OTP-13493 Aux Id: PR-999</p></li><li><p>The enif_send API has been extended to allow NULL to be used as the message
environment. When used this way, a message environment is implicitly created
and the given term is copied into that environment before sending. This can be
an optimization if many small messages are being sent by the nif.</p><p>Own Id: OTP-13495</p></li><li><p>The tracing support has been extended to allow tracing on ports. Ports can be
traced on using the 'ports', 'send' and 'receive' trace flags.</p><p>The first argument of <a href="erlang.html#trace/3"><code class="inline">erlang:trace/3</code></a> has been extended so that <code class="inline">'all'</code>,
<code class="inline">'existing'</code> and <code class="inline">'new'</code> now include both processes and ports. New <code class="inline">Tracee</code>
variants, <code class="inline">'all_processes'</code>, <code class="inline">'all_ports'</code>, <code class="inline">'existing_processes'</code> etc have
been added to specify only processes or ports.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-13496</p></li><li><p>When the <code class="inline">'procs'</code> trace flag is enabled, a <code class="inline">'spawned'</code> trace event is now
also generated by a newly created process. The previous event <code class="inline">'spawn'</code>
remains, but as it is generated by the process that did the spawn, it is not
guaranteed that it is ordered with other trace events from the newly spawned
process. So when tracking the lifetime of a process this new event should be
used as the creation event.</p><p>This new trace event is marked as an incompatibility because tools that expect
certain trace events when enabling 'procs' will have to updated.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-13497</p></li><li><p>Add the <a href="erlang.html#match_spec_test/3"><code class="inline">erlang:match_spec_test/3</code></a> function. The functions allows the testing
of match specifications for both tracing and ets tables. It can be used to
test that a match specification does the expected filtering on specific data.
It also returns more verbose error reasons for incorrectly constructed match
specifications.</p><p>Own Id: OTP-13501</p></li><li><p>The erts internal tracing support has been changed to have much less overhead
and be more scalable.</p><p>This rewrite does not break any backwards incompatibilities, but it does
change the ordering of some trace messages when compared to previous releases.
It should be noted that this only applies to trace messages sent to processes
or ports, it does not apply to the new tracer module. However in future
releases they may also be effected by this.</p><p>Trace messages are only guaranteed to be ordered from one traced process or
port. In previous releases this was not visible as a <code class="inline">'send'</code> trace message
would always arrive before the corresponding <code class="inline">'receive'</code> trace message that is
no longer always the case. This also means that timestamped trace messages may
seem to arrive out of order as the timestamp is taken when the event is
triggered and not when it is put in the queue of the tracer.</p><p>Own Id: OTP-13503</p></li><li><p>Add possibility to filter <code class="inline">send</code> and <code class="inline">receive</code> trace with match
specifications.</p><p>Own Id: OTP-13507</p></li><li><p>Add <code class="inline">maps:update_with/3,4</code> and <a href="../../apps/stdlib/maps.html#take/2"><code class="inline">maps:take/2</code></a></p><p>Own Id: OTP-13522 Aux Id: PR-1025</p></li><li><p>Introduce LTTng tracing via Erlang tracing.</p><p>For LTTng to be enabled OTP needs to be built with configure option
<code class="inline">--with-dynamic-trace=lttng</code>.</p><p>The dynamic trace module <code class="inline">dyntrace</code> is now capable to be used as a LTTng sink
for Erlang tracing. For a list of all tracepoints, see
<a href="../../apps/runtime_tools/lttng.html">Runtime Tools User's Guide</a> .</p><p>This feature also introduces an incompatible change in trace tags. The trace
tags <code class="inline">gc_start</code> and <code class="inline">gc_end</code> has been split into <code class="inline">gc_minor_start</code>,
<code class="inline">gc_minor_end</code> and <code class="inline">gc_major_start</code>, <code class="inline">gc_major_end</code>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-13532</p></li><li><p>Print heap pointers for garbing processes during crashdump</p><p>Own Id: OTP-13541 Aux Id: PR-1026</p></li><li><p>Changed and improved low level memory statistics returned by
<a href="erlang.html#system_info/1"><code class="inline">erlang:system_info/1</code></a>. The info for <code class="inline">erts_mmap</code> has been moved from
<code class="inline">mseg_alloc</code> to its own section returned by <code class="inline">{allocator, erts_mmap}</code>.</p><p>Own Id: OTP-13560</p></li><li><p>Add enif_snprintf to the NIF API</p><p>The function <code class="inline">enif_snprintf</code> is similar to <code class="inline">snprintf</code> call but can handle
formatting of Erlang terms via <code class="inline">%T</code> format specifier.</p><p>Own Id: OTP-13580</p></li><li><p>The warning in the documentation for <a href="erlang.html#raise/3"><code class="inline">erlang:raise/3</code></a> has been removed. It is
now officially perfectly fine to use raise/3 in production code.</p><p>Own Id: OTP-13599</p></li><li><p>Fix bugs caused by the VM sometimes truncating object sizes or offsets to 32
bits on 64-bit hosts. These bugs were mainly found when working with large
unicode strings and nifs environments.</p><p>Own Id: OTP-13606</p></li><li><p>Add <code class="inline">-start_epmd</code> command line option, this lets you disable automatic
starting of epmd when starting a distributed node.</p><p>Add <code class="inline">-epmd_module</code> command line option, this lets you specify a module to
register and look-up node names in. The default module is <code class="inline">erl_epmd</code>.</p><p>Own Id: OTP-13627</p></li><li><p><code class="inline">erlang:halt</code> now truncates strings longer than 200 characters instead of
failing with <code class="inline">badarg</code>.</p><p>Own Id: OTP-13630</p></li><li><p>Fix possible race in poller wake up on windows</p><p>Own Id: OTP-13634</p></li></ul><h2 id="erts-7-3-1-6" class="section-heading"><a href="#erts-7-3-1-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.3.1.6</span></h2><h3 id="improvements-and-new-features-62" class="section-heading"><a href="#improvements-and-new-features-62" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>List subtraction (The <code class="inline">--</code> operator) will now yield properly on large inputs.</p><p>Own Id: OTP-15371</p></li></ul><h2 id="erts-7-3-1-5" class="section-heading"><a href="#erts-7-3-1-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.3.1.5</span></h2><h3 id="fixed-bugs-and-malfunctions-268" class="section-heading"><a href="#fixed-bugs-and-malfunctions-268" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed small memory leak that could occur when sending to a terminating port.</p><p>Own Id: OTP-14609 Aux Id: ERIERL-238</p></li></ul><h2 id="erts-7-3-1-4" class="section-heading"><a href="#erts-7-3-1-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.3.1.4</span></h2><h3 id="fixed-bugs-and-malfunctions-269" class="section-heading"><a href="#fixed-bugs-and-malfunctions-269" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix performance bug in pre-allocators that could cause them to permanently
fall back on normal more expensive memory allocation. Pre-allocators are used
for quick allocation of short lived meta data used by messages and other
scheduled tasks. Bug exists since OTP_R15B02.</p><p>Own Id: OTP-14491</p></li><li><p>Fixed bug in operator <code class="inline">bxor</code> causing erroneuos result when one operand is a
big <em>negative</em> integer with the lowest <code class="inline">N*W</code> bits as zero and the other
operand not larger than <code class="inline">N*W</code> bits. <code class="inline">N</code> is an integer of 1 or larger and <code class="inline">W</code>
is 32 or 64 depending on word size.</p><p>Own Id: OTP-14514</p></li><li><p>A timer internal bit-field used for storing scheduler id was too small. As a
result, VM internal timer data structures could become inconsistent when using
1024 schedulers on the system. Note that systems with less than 1024
schedulers are not effected by this bug.</p><p>This bug was introduced in ERTS version 7.0 (OTP 18.0).</p><p>Own Id: OTP-14548 Aux Id: OTP-11997, ERL-468</p></li><li><p>Fixed bug in <code class="inline">binary_to_term</code> and <code class="inline">binary_to_atom</code> that could cause VM crash.
Typically happens when the last character of an UTF8 string is in the range
128 to 255, but truncated to only one byte. Bug exists in <code class="inline">binary_to_term</code>
since ERTS version 5.10.2 (OTP_R16B01) and <code class="inline">binary_to_atom</code> since ERTS version
9.0 (OTP-20.0).</p><p>Own Id: OTP-14590 Aux Id: ERL-474</p></li></ul><h2 id="erts-7-3-1-3" class="section-heading"><a href="#erts-7-3-1-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.3.1.3</span></h2><h3 id="fixed-bugs-and-malfunctions-270" class="section-heading"><a href="#fixed-bugs-and-malfunctions-270" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A bug has been fixed where if erlang was started +B on a unix platform it
would be killed by a SIGUSR2 signal when creating a crash dump.</p><p>Own Id: OTP-13425 Aux Id: ERL-94</p></li><li><p>Calls to <code class="inline">erl_drv_send_term()</code> or <code class="inline">erl_drv_output_term()</code> from a non-scheduler
thread while the corresponding port was invalid caused the emulator to enter
an inconsistent state which eventually caused an emulator crash.</p><p>Own Id: OTP-13866</p></li><li><p>Driver and NIF operations accessing processes or ports could cause an emulator
crash when used from non-scheduler threads. Those operations are:</p><ul><li><code class="inline">erl_drv_send_term()</code></li><li><code class="inline">driver_send_term()</code></li><li><code class="inline">erl_drv_output_term()</code></li><li><code class="inline">driver_output_term()</code></li><li><code class="inline">enif_send()</code></li><li><code class="inline">enif_port_command()</code></li></ul><p>Own Id: OTP-13869</p></li><li><p>Fix bug in <code class="inline">binary_to_term</code> for binaries created by <code class="inline">term_to_binary</code>with
option <code class="inline">compressed</code>. The bug can cause <code class="inline">badarg</code> exception for a valid binary
when Erlang VM is linked against a <code class="inline">zlib</code> library of version 1.2.9 or newer.
Bug exists since OTP 17.0.</p><p>Own Id: OTP-14159 Aux Id: ERL-340</p></li></ul><h2 id="erts-7-3-1-2" class="section-heading"><a href="#erts-7-3-1-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.3.1.2</span></h2><h3 id="fixed-bugs-and-malfunctions-271" class="section-heading"><a href="#fixed-bugs-and-malfunctions-271" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a race that could cause a lost wakeup of a process that timed out in a
<code class="inline">receive ... after</code>. This bug was introduced in ERTS version 7.0.</p><p>Own Id: OTP-13798 Aux Id: OTP-11997</p></li><li><p>Fixed segfault after writing an erl crash dump.</p><p>Own Id: OTP-13799</p></li></ul><h2 id="erts-7-3-1-1" class="section-heading"><a href="#erts-7-3-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.3.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-272" class="section-heading"><a href="#fixed-bugs-and-malfunctions-272" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix scheduler deadlock bug in <a href="../../apps/stdlib/ets.html#update_counter/4"><code class="inline">ets:update_counter/4</code></a> when key is not found and
inserting the default object causes the table to grow.</p><p>Own Id: OTP-13731 Aux Id: ERL-188</p></li></ul><h2 id="erts-7-3-1" class="section-heading"><a href="#erts-7-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.3.1</span></h2><h3 id="fixed-bugs-and-malfunctions-273" class="section-heading"><a href="#fixed-bugs-and-malfunctions-273" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><a href="erlang.html#process_info/2"><code class="inline">process_info(Pid, last_calls)</code></a> did not work for
<code class="inline">Pid /= self()</code>.</p><p>Own Id: OTP-13418</p></li><li><p>Make sure to create a crash dump when running out of memory. This was
accidentally removed in the erts-7.3 release.</p><p>Own Id: OTP-13419</p></li><li><p>Schedulers could be woken by a premature timeout on Linux. This premature
wakeup was however harmless.</p><p>Own Id: OTP-13420</p></li><li><p>A process communicating with a port via one of the <code class="inline">erlang:port_*</code> BIFs could
potentially end up in an inconsistent state if the port terminated during the
communication. When this occurred the process could later block in a <code class="inline">receive</code>
even though it had messages matching in its message queue.</p><p>This bug was introduced in erts version 5.10 (OTP R16A).</p><p>Own Id: OTP-13424 Aux Id: OTP-10336</p></li><li><p>The reference count of a process structure could under rare circumstances be
erroneously managed. When this happened invalid memory accesses occurred.</p><p>Own Id: OTP-13446</p></li><li><p>Fix race between <a href="erlang.html#process_flag/2"><code class="inline">process_flag(trap_exit,true)</code></a> and a
received exit signal.</p><p>A process could terminate due to exit signal even though
<a href="erlang.html#process_flag/2"><code class="inline">process_flag(trap_exit,true)</code></a> had returned. A very
specific timing between call to <a href="erlang.html#process_flag/2"><code class="inline">process_flag/2</code></a> and exit
signal from another scheduler was required for this to happen.</p><p>Own Id: OTP-13452</p></li></ul><h2 id="erts-7-3" class="section-heading"><a href="#erts-7-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.3</span></h2><h3 id="fixed-bugs-and-malfunctions-274" class="section-heading"><a href="#fixed-bugs-and-malfunctions-274" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The '-path' flag to 'erl' has been documented. This flag replaces the path
specified in the boot script. It has always existed, but was earlier only
documented in SASL (script).</p><p>Own Id: OTP-13060</p></li><li><p>The <code class="inline">call_time</code> tracing functionality internally used a time based on OS
system time in order to measure call time which could cause erroneous results
if OS system time was changed during tracing.</p><p>This functionality now use Erlang monotonic time in order to measure time.
Besides fixing the erroneous results due to OS system time being used, the
results are often also better since Erlang monotonic time often has better
accuracy and precision.</p><p>Own Id: OTP-13216</p></li><li><p>Fix behaviour of -delay_write command line switch of epmd, which is used for
debugging - in some cases epmd was sleeping twice the requested amount of
time.</p><p>Own Id: OTP-13220</p></li><li><p>Fix race between timeout and exit signal that could cause a process to ignore
the exit signal and continue execution. Bug exist since OTP 18.0.</p><p>Own Id: OTP-13245</p></li><li><p>Fix bug in <code class="inline">erlang:halt/1,2</code> for large exit status values, causing either
<code class="inline">badarg</code> (on 32-bit) or exit with a crash dump and/or core dump (on 64-bit).
Make <code class="inline">erlang:halt/1,2</code> tolerate any non negative integer as exit status and
truncate high order bits if the OS does not support it.</p><p>Own Id: OTP-13251 Aux Id: ERL-49</p></li><li><p><a href="../../apps/kernel/gen_tcp.html#accept/2"><code class="inline">gen_tcp:accept/2</code></a> was not
<a href="time_correction.html#time-warp-safe-code">time warp safe</a>. This since it used
the same time as returned by <a href="erlang.html#now/0"><code class="inline">erlang:now/0</code></a> when calculating timeout. This has
now been fixed.</p><p>Own Id: OTP-13254 Aux Id: OTP-11997, OTP-13222</p></li><li><p>Fix faulty error handling when writing to a compressed file.</p><p>Own Id: OTP-13270</p></li><li><p>Fix sendfile usage for large files on FreeBSD</p><p>Own Id: OTP-13271</p></li><li><p>Fix bug that could cause
<a href="erlang.html#process_info/2"><code class="inline">process_info(P,current_location)</code></a> to crash emulator for
hipe compiled modules.</p><p>Own Id: OTP-13282 Aux Id: ERL-79</p></li><li><p>Out of memory errors have been changed to cause an exit instead of abort.</p><p>Own Id: OTP-13292</p></li><li><p>When calling <code class="inline">garbage_collect/[1,2]</code> or <code class="inline">check_process_code/[2,3]</code> from a
process with a higher priority than the priority of the process operated on,
the run queues could end up in an inconsistent state. This bug has now been
fixed.</p><p>Own Id: OTP-13298 Aux Id: OTP-11388</p></li><li><p>A workaround for an issue with older gcc versions (less than 5) and inline
assembly on 32-bit x86 caused an emulator crash when it had been compiled with
a newer gcc version. An improved <code class="inline">configure</code> test, run when building OTP, now
detects whether the workaround should be used or not.</p><p>Own Id: OTP-13326 Aux Id: ERL-80</p></li></ul><h3 id="improvements-and-new-features-63" class="section-heading"><a href="#improvements-and-new-features-63" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Introduced new statistics functionality in order to more efficiently retrieve
information about run able and active processes and ports. For more
information see:</p><ul><li><a href="erlang.html#statistics_total_run_queue_lengths"><code class="inline">statistics(total_run_queue_lengths)</code></a></li><li><a href="erlang.html#statistics_run_queue_lengths"><code class="inline">statistics(run_queue_lengths)</code></a></li><li><a href="erlang.html#statistics_total_active_tasks"><code class="inline">statistics(total_active_tasks)</code></a></li><li><a href="erlang.html#statistics_active_tasks"><code class="inline">statistics(active_tasks)</code></a></li></ul><p>Own Id: OTP-13201</p></li><li><p>Time warp safety improvements.</p><p>Introduced the options <code class="inline">monotonic_timestamp</code>, and <code class="inline">strict_monotonic_timestamp</code>
to the trace, sequential trace, and system profile functionality. This since
the already existing <code class="inline">timestamp</code> option is not time warp safe.</p><p>Introduced the option <code class="inline">safe_fixed_monotonic_time</code> to <a href="../../apps/stdlib/ets.html#info/2"><code class="inline">ets:info/2</code></a> and
<a href="../../apps/stdlib/dets.html#info/2"><code class="inline">dets:info/2</code></a>. This since the already existing <code class="inline">safe_fixed</code> option is not time
warp safe.</p><p>Own Id: OTP-13222 Aux Id: OTP-11997</p></li><li><p>Fix a register race where down nodes goes undetected in epmd</p><p>Own Id: OTP-13301</p></li><li><p>Improved the gcc inline assembly implementing double word atomic compare and
exchange on x86/x86_64 so that it also can be used when compiling with clang.</p><p>Own Id: OTP-13336</p></li><li><p>An optimization preventing a long wait for a scheduler thread looking up
information about a process executing on another scheduler thread had
unintentionally been lost in erts-5.10 (OTP R16A). This optimization has now
been reintroduced.</p><p>Own Id: OTP-13365 Aux Id: OTP-9892</p></li></ul><h2 id="erts-7-2-1-1" class="section-heading"><a href="#erts-7-2-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.2.1.1</span></h2><h3 id="improvements-and-new-features-64" class="section-heading"><a href="#improvements-and-new-features-64" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Introduced new statistics functionality in order to more efficiently retrieve
information about run able and active processes and ports. For more
information see:</p><ul><li><a href="erlang.html#statistics_total_run_queue_lengths"><code class="inline">statistics(total_run_queue_lengths)</code></a></li><li><a href="erlang.html#statistics_run_queue_lengths"><code class="inline">statistics(run_queue_lengths)</code></a></li><li><a href="erlang.html#statistics_total_active_tasks"><code class="inline">statistics(total_active_tasks)</code></a></li><li><a href="erlang.html#statistics_active_tasks"><code class="inline">statistics(active_tasks)</code></a></li></ul><p>Own Id: OTP-13201</p></li></ul><h2 id="erts-7-2-1" class="section-heading"><a href="#erts-7-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-275" class="section-heading"><a href="#fixed-bugs-and-malfunctions-275" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Revert &quot;Fix erroneous splitting of emulator path&quot;</p><p>Own Id: OTP-13202</p></li><li><p>Fix HiPE enabled emulator for FreeBSD.</p><p>Own Id: OTP-13204 Aux Id: pr926</p></li></ul><h2 id="erts-7-2" class="section-heading"><a href="#erts-7-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.2</span></h2><h3 id="fixed-bugs-and-malfunctions-276" class="section-heading"><a href="#fixed-bugs-and-malfunctions-276" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Small documentation fixes</p><p>Own Id: OTP-13017</p></li><li><p>Fix memory corruption bug caused by disabling distribution and then re-enable
distribution with a node name that has previously been used by a remote node.</p><p>Own Id: OTP-13076 Aux Id: seq12959</p></li><li><p>Renamed variables with name bool as Visual Studio 2015 now treats this is a
keyword.</p><p>Own Id: OTP-13079</p></li><li><p><code class="inline">erl_prim_loader</code> has not supported custom loaders for several releases. In
the documentation for <code class="inline">erl_prim_loader</code>, all references to custom loaders have
now been removed.</p><p>Own Id: OTP-13102</p></li><li><p>Fixed compilation of erts together with libc versions that do not define
__uint32_t.</p><p>Own Id: OTP-13105</p></li><li><p>erl -make now returns non-zero exit codes on failure</p><p>Own Id: OTP-13107</p></li><li><p>Fix crash on init:restart in embedded mode caused by on_load handler process
not being relaunched leading to load failure for modules such as crypto and
asn1rt_nif that need it to be present for correct NIF loading.</p><p>Own Id: OTP-13115</p></li><li><p>Fix maps decode in erlang:binary_to_term/1</p><p>Decoding a term with a large (HAMT) map in an small (FLAT) map could cause a
critical error if the external format was not produced by beam.</p><p>Own Id: OTP-13125</p></li><li><p>Fix very rare bug in GC when big maps with a lot of hash collisions from a
remote node are waiting in inner message queue.</p><p>Own Id: OTP-13146</p></li><li><p>Fixed a bug that could cause a crash dump to become almost empty.</p><p>Own Id: OTP-13150</p></li></ul><h3 id="improvements-and-new-features-65" class="section-heading"><a href="#improvements-and-new-features-65" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Updated the xmllint target to just check the xml files with real documentation
content.<br/>Corrected some errors and added some missing target in the DTD's.</p><p>Own Id: OTP-13026</p></li><li><p>Add function enif_getenv to read OS environment variables in a portable way
from NIFs.</p><p>Own Id: OTP-13147</p></li></ul><h2 id="erts-7-1" class="section-heading"><a href="#erts-7-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.1</span></h2><h3 id="fixed-bugs-and-malfunctions-277" class="section-heading"><a href="#fixed-bugs-and-malfunctions-277" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix bug in ETS that could cause stray objects marked for deletion to
occasionally be missed by the cleanup done by <code class="inline">safe_fixtable(_,false)</code>.</p><p>Own Id: OTP-12870</p></li><li><p>Fixed VM crash that could occur if a trace port was linked to a process, and
the trace port terminated abnormally while handling a trace message. This bug
has always existed in the runtime system with SMP support.</p><p>Own Id: OTP-12901</p></li><li><p>Instead of aborting, the vm now creates a crash dump when a system process is
terminated.</p><p>Own Id: OTP-12934</p></li><li><p>Fixed a rare emulator dead lock that occurred when
erlang:process_flag(priority,...) was called by a process that was also
scheduled for an internal system activity.</p><p>Own Id: OTP-12943</p></li><li><p>The runtime system on various posix platforms (except for Linux and Solaris)
could crash when large amounts of file-descriptors were in use.</p><p>Own Id: OTP-12954</p></li><li><p>A beam file compiled by hipe for an incompatible runtime system was sometimes
not rejected by the loader, which could lead to vm crash. This fix will also
allow the same hipe compiler to be used by both normal and debug-built vm.</p><p>Own Id: OTP-12962</p></li><li><p>Fix bug in <a href="../../apps/stdlib/maps.html#merge/2"><code class="inline">maps:merge/2</code></a> when called by hipe compiled code that could cause
vm crash. Bug exists since erts-7.0 (OTP 18.0).</p><p>Own Id: OTP-12965</p></li><li><p>When tracing with <code class="inline">process_dump</code> option, the VM could abort if there was an
ongoing binary match somewhere in the call stack of the traced process.</p><p>Own Id: OTP-12968</p></li><li><p>Fixed possible output deadlock in tty driver when hitting &quot;CTRL-C&quot; in a
non-smp emulator shell on unix.</p><p>Own Id: OTP-12987 Aux Id: Seq12947</p></li><li><p>Fix <code class="inline">binary_to_integer</code> to throw badarg for &quot;+&quot; and &quot;-&quot; similar to
<code class="inline">list_to_integer</code>.</p><p>Own Id: OTP-12988</p></li><li><p>Suppress warning of unused argument when using macro enif_make_pid.</p><p>Own Id: OTP-12989</p></li></ul><h3 id="improvements-and-new-features-66" class="section-heading"><a href="#improvements-and-new-features-66" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Changed default clock source used for OS system time on MacOS X to
<code class="inline">gettimeofday()</code> in order to improve performance. The system can be configured
during build to use the previously used higher resolution clock source by
passing the switch
<a href="../../system/install.html#advanced-configuration-and-build-of-erlang-otp_configuring"><code class="inline">--with-clock-resolution=high</code></a>
when configuring the build.</p><p>Own Id: OTP-12945 Aux Id: OTP-12892</p></li><li><p>Added the <code class="inline">configure</code> option
<a href="../../system/install.html#advanced-configuration-and-build-of-erlang-otp_configuring"><code class="inline">--disable-saved-compile-time</code></a>
which disables saving of compile date and time in the emulator binary.</p><p>Own Id: OTP-12971</p></li></ul><h2 id="erts-7-0-3" class="section-heading"><a href="#erts-7-0-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.0.3</span></h2><h3 id="fixed-bugs-and-malfunctions-278" class="section-heading"><a href="#fixed-bugs-and-malfunctions-278" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a binary memory leak when printing to shell using the tty driver (i.e.
not -oldshell).</p><p>Own Id: OTP-12941</p></li><li><p>Fix a bug where the standard error port sometimes crashes with eagain as the
reason.</p><p>Own Id: OTP-12942</p></li><li><p>When tracing with <code class="inline">process_dump</code> option, the VM could abort if there was an
ongoing binary match somewhere in the call stack of the traced process./</p><p>Own Id: OTP-12968</p></li></ul><h2 id="erts-7-0-2" class="section-heading"><a href="#erts-7-0-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.0.2</span></h2><h3 id="fixed-bugs-and-malfunctions-279" class="section-heading"><a href="#fixed-bugs-and-malfunctions-279" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A process could end up in an inconsistent half exited state in the runtime
system without SMP support. This could occur if the processes was traced by a
port that it also was linked to, and the port terminated abnormally while
handling a trace message for the process.</p><p>This bug has always existed in the runtime system without SMP support, but
never in the runtime system with SMP support.</p><p>Own Id: OTP-12889 Aux Id: seq12885</p></li><li><p>Removed unnecessary copying of data when retrieving corrected Erlang monotonic
time.</p><p>Own Id: OTP-12894</p></li><li><p>Changed default OS monotonic clock source chosen at build time. This in order
to improve performance. The behavior will now on most systems be that (both OS
and Erlang) monotonic time stops when the system is suspended.</p><p>If you prefer that monotonic time elapse during suspend of the machine, you
can pass the command line argument
<code class="inline">--enable-prefer-elapsed-monotonic-time-during-suspend</code> to <code class="inline">configure</code> when
building Erlang/OTP. The configuration stage will try to find such a clock
source, but might not be able to find it. Note that there might be a
performance penalty associated with such a clock source.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-12895</p></li><li><p><code class="inline">erlang:system_info(end_time)</code> returned a faulty value on 32-bit
architectures.</p><p>Own Id: OTP-12896</p></li></ul><h3 id="improvements-and-new-features-67" class="section-heading"><a href="#improvements-and-new-features-67" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The <code class="inline">configure</code> command line argument
<code class="inline">--enable-gettimeofday-as-os-system-time</code> has been added which force usage of
<code class="inline">gettimeofday()</code> for OS system time. This will improve performance of
<code class="inline">os:system_time()</code> and <code class="inline">os:timestamp()</code> on MacOS X, at the expense of worse
accuracy, resolution and precision of Erlang monotonic time, Erlang system
time, and OS system time.</p><p>Own Id: OTP-12892</p></li></ul><h2 id="erts-7-0-1" class="section-heading"><a href="#erts-7-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-280" class="section-heading"><a href="#fixed-bugs-and-malfunctions-280" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix a rare hanging of the VM seen to happen just after emulator start. Bug
exists since R14.</p><p>Own Id: OTP-12859 Aux Id: seq12882</p></li></ul><h2 id="erts-7-0" class="section-heading"><a href="#erts-7-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 7.0</span></h2><h3 id="fixed-bugs-and-malfunctions-281" class="section-heading"><a href="#fixed-bugs-and-malfunctions-281" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix issuing with spaces and quoting in the arguments when using
erlang:open_port spawn_executable on windows. The behavior now mimics how unix
works. This change implies a backwards incompatibility for how
spawn_executable works on windows.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-11905</p></li><li><p>Fix global call trace when hipe compiled code call beam compiled functions.
Tracing of beam functions should now always work regardless who the caller is.</p><p>Own Id: OTP-11939</p></li><li><p>Correct cache alignment for ETS <code class="inline">write_concurrency</code> locks to improve
performance by reduced false sharing. May increase memory footprint for tables
with <code class="inline">write_concurrency</code>.</p><p>Own Id: OTP-11974</p></li><li><p>All possibly blocking operations in the fd/spawn and terminal driver have been
converted to non-blocking operations. Before this fix it was possible for the
VM to be blocked for a long time if the entity consuming stdout/stderr did not
consume it fast enough.</p><p>Own Id: OTP-12239</p></li><li><p>Add missing overhead for offheap binaries created from external format. This
fix can improve the garbage collection of large binaries originating from
<code class="inline">binary_to_term</code> or messages from remote nodes.</p><p>Own Id: OTP-12554</p></li><li><p>Ensure hashing of zero is consistent</p><p>Erlang treats positive and negative zero as equal:</p><p><code class="inline">true = 0.0 =:= 0.0/-1</code></p><p>However, Erlangs hash functions: hash, phash and phash2 did not reflect this
behaviour. The hash values produced by the different hash functions would not
be identical for positive and negative zero.</p><p>This change ensures that hash value of positive zero is always produced
regardless of the signedness of the zero float, i.e.,</p><p><code class="inline">true = erlang:phash2(0.0) =:= erlang:phash2(0.0/-1)</code></p><p>Own Id: OTP-12641</p></li><li><p>Ensure NIF term creation disallows illegal floating point values and too long
atoms. Such values will cause a NIF to throw badarg exception when it returns.</p><p>Own Id: OTP-12655</p></li><li><p>Fixed building of Map results from match_specs</p><p>A faulty &quot;box-value&quot; entered into the heap which could cause a segmentation
fault in the garbage collector if it was written on a heap fragment.</p><p>Own Id: OTP-12656</p></li><li><p>Fix hipe bug when matching a &quot;writable&quot; binary. The bug has been seen to
sometimes cause a failed binary matching of a correct utf8 character, but
other symptoms are also possible.</p><p>Own Id: OTP-12667</p></li><li><p>Keep dirty schedulers from waking other schedulers.</p><p>Own Id: OTP-12685</p></li><li><p>Disable floating point exceptions if the VM is compiled by clang/llvm. This is
a known long-standing problem in clang/llvm.</p><p>Own Id: OTP-12717</p></li><li><p>Fix bug in <code class="inline">file:sendfile</code> for FreeBSD causing not the entire file to be sent.</p><p>Own Id: OTP-12720</p></li><li><p>Fix the broken Android support in erl_child_setup.c</p><p>Own Id: OTP-12751</p></li><li><p>Faulty statistics reported by the <code class="inline">fix_alloc</code> allocator.</p><p>Own Id: OTP-12766</p></li><li><p>Fix two erts_snprintf() calls to correct sizes.</p><p>- run_erl.c (ose): Use the size of the signal type, not its pointer. -
erl_node_tables.c: Use the size of the _BUFFER in erts_snprintf() to make
sure we can use the full space.</p><p>Own Id: OTP-12771</p></li><li><p>Delayed memory allocations could be delayed an unnecessarily long time.</p><p>Own Id: OTP-12812</p></li><li><p>Make sure that timeouts on a pool of acceptors are released in the correct
order.</p><p>Own Id: OTP-12817</p></li><li><p>Fix segmentation fault in module_info for deleted modules</p><p>Own Id: OTP-12820</p></li><li><p>Fix garbage collection of literals in code purge</p><p>During code purging and check_process_code, the checking of the binary
reference embedded in the match binary state was omitted for the tracing
tests. This would cause the binary match state to reference deallocated
memory.</p><p>Own Id: OTP-12821</p></li><li><p>A bug has been corrected for gen_tcp:close so when {linger,{true,0}} is in
effect it does not wait for data in the driver queue to transfer out before
closing the port. Bug fix by Rory Byrne.</p><p>Own Id: OTP-12840</p></li><li><p>The documentation of the driver callback <a href="driver_entry.html#start"><code class="inline">start()</code></a>
erroneously stated that a return value of <code class="inline">ERL_DRV_ERROR_ERRNO</code> caused the
error value to be passed via <code class="inline">erl_errno</code> when it should have been <code class="inline">errno</code>.</p><p>Own Id: OTP-12855</p></li></ul><h3 id="improvements-and-new-features-68" class="section-heading"><a href="#improvements-and-new-features-68" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Add <code class="inline">md5</code> and <code class="inline">module</code> entries to <code class="inline">?MODULE:module_info/0/1</code> and remove
obsolete entry 'import'.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-11940</p></li><li><p>Debug function <a href="erlang.html#display/1"><code class="inline">erlang:display/1</code></a> shows content of binaries and bitstrings,
not only the length.</p><p>Own Id: OTP-11941</p></li><li><p>The time functionality of Erlang has been extended. This both includes a
<a href="time_correction.html#new-time-api">new API</a> for time, as well as
<a href="time_correction.html#time-warp-modes">time warp modes</a> which alters the
behavior of the system when system time changes. <em>You are strongly encouraged
to use the new API</em> instead of the old API based on <a href="erlang.html#now/0"><code class="inline">erlang:now/0</code></a>.
<a href="erlang.html#now/0"><code class="inline">erlang:now/0</code></a> has been deprecated since it is and forever will be a
scalability bottleneck. For more information see the
<a href="time_correction.html">Time and Time Correction</a> chapter of the ERTS User's
Guide.</p><p>Besides the API changes and time warp modes a lot of scalability and
performance improvements regarding time management has been made internally in
the runtime system. Examples of such improvements are scheduler specific timer
wheels, scheduler specific BIF timer management, parallel retrieval of
monotonic time and system time on systems with primitives that are not buggy.</p><p>Own Id: OTP-11997</p></li><li><p><code class="inline">erlang:function_exported(M, F, A)</code> will now return <code class="inline">true</code> if <code class="inline">M:F/A</code> refers
to a BIF.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-12099</p></li><li><p>New BIF: <a href="erlang.html#get_keys/0"><code class="inline">erlang:get_keys/0</code></a>, lists all keys associated with the process
dictionary. Note: <a href="erlang.html#get_keys/0"><code class="inline">erlang:get_keys/0</code></a> is auto-imported.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-12151 Aux Id: seq12521</p></li><li><p>Make distributed send of large messages yield to improve real-time
characteristics.</p><p>Own Id: OTP-12232</p></li><li><p>Use high accuracy poll timeouts</p><p>Where available, use poll/select API's that can handle time resolutions less
than 1ms. In the cases where such API's are not available the timeout is
rounded up to the nearest ms.</p><p>Own Id: OTP-12236</p></li><li><p>The internal group to user_drv protocol has been changed to be synchronous in
order to guarantee that output sent to a process implementing the user_drv
protocol is printed before replying. This protocol is used by the
standard_output device and the ssh application when acting as a client.</p><p>This change changes the previous unlimited buffer when printing to standard_io
and other devices that end up in user_drv to 1KB.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-12240</p></li><li><p>The previously introduced &quot;eager check I/O&quot; feature is now enabled by default.</p><p>Eager check I/O can be disabled using the <code class="inline">erl</code> command line argument:
<code class="inline">+secio false</code></p><p>Characteristics impact compared to previous default:</p><ul><li>Lower latency and smoother management of externally triggered I/O
operations.</li><li>A slightly reduced priority of externally triggered I/O operations.</li></ul><p>Own Id: OTP-12254 Aux Id: OTP-12117</p></li><li><p>Properly support maps in match_specs</p><p>Own Id: OTP-12270</p></li><li><p>The notice that a crashdump has been written has been moved to be printed
before the crashdump is generated instead of afterwords. The wording of the
notice has also been changed.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-12292</p></li><li><p>New function <a href="../../apps/stdlib/ets.html#take/2"><code class="inline">ets:take/2</code></a>. Works the same as <a href="../../apps/stdlib/ets.html#delete/2"><code class="inline">ets:delete/2</code></a> but also returns
the deleted object(s).</p><p>Own Id: OTP-12309</p></li><li><p>Tracing with cpu_timestamp option has been enabled on Linux.</p><p>Own Id: OTP-12366</p></li><li><p>ets:info/1,2 now contains information about whether write_concurrency or
read_concurrency is enabled.</p><p>Own Id: OTP-12376</p></li><li><p>Improved usage of <code class="inline">gcc</code>'s builtins for atomic memory access. These are used
when no other implementation of atomic memory operations is available. For
example, when compiling for ARM when <code class="inline">libatomic_ops</code> is not available.</p><p>The largest improvement will be seen when compiling with a <code class="inline">gcc</code> with support
for the <code class="inline">__atomic_*</code> builtins (using a <code class="inline">gcc</code> of at least version 4.7), but
also when only the legacy <code class="inline">__sync_*</code> builtins are available (using a <code class="inline">gcc</code> of
at least version 4.1) an improvement can be seen.</p><p>For more information see the
&quot;<a href="../../system/install.html#advanced-configuration-and-build-of-erlang-otp_configuring_atomic-memory-operations-and-the-vm">Atomic Memory Operations and the VM</a>&quot;
section of <code class="inline">$ERL_TOP/HOWTO/INSTALL.md</code>.</p><p>Own Id: OTP-12383</p></li><li><p>Introduce <a href="../../apps/stdlib/math.html#log2/1"><code class="inline">math:log2/1</code></a> function to math module.</p><p>Own Id: OTP-12411</p></li><li><p>The documentation of the Abstract Format (in the ERTS User's Guide) has been
updated with types and specification. (Thanks to Anthony Ramine.)</p><p>The explicit representation of parentheses used in types of the abstract
format has been removed. Instead the new functions
<code class="inline">erl_parse:type_inop_prec()</code> and <code class="inline">erl_parse:type_preop_prec()</code> can be used for
inserting parentheses where needed.</p><p>Own Id: OTP-12492</p></li><li><p>Remove perfctr support</p><p>Development of perfctr in the linux kernel ceased in 2010. The perfctr support
code in the Erlang VM is thus effectively dead code and therefore removed.</p><p>Own Id: OTP-12508</p></li><li><p><code class="inline">zlib:inflateChunk/2</code> has been added. It works like <a href="zlib.html#inflate/2"><code class="inline">zlib:inflate/2</code></a>, but
decompresses no more data than will fit in the buffer configured by
<code class="inline">zlib:setBufSize/2</code>.</p><p>Own Id: OTP-12548</p></li><li><p>Use linear search for small select_val arrays</p><p>Own Id: OTP-12555</p></li><li><p>New BIF ets:update_counter/4 with a default object as argument, which will be
inserted in the table if the key was not found.</p><p>Own Id: OTP-12563</p></li><li><p>Export missing types from zlib module</p><p>Own Id: OTP-12584</p></li><li><p>Use persistent hashmaps for large Maps</p><p>Maps will use a persistent hashmap implementation when the number of pairs in
a Map becomes sufficiently large. The change will occur when a Map reaches 33
pairs in size but this limit might change in the future.</p><p>The most significant impact for the user by this change is speed, and to a
lesser degree memory consumption and introspection of Maps. Memory consumption
size is probalistic but lesser than <code class="inline">gb_trees</code> or <code class="inline">dict</code> for instance. Any
other impacts will be transparent for the user except for the following
changes.</p><p>Semantics of Maps have changed in two incompatible ways compared to the
experimental implementation in OTP 17:</p><ul><li>Hashing of maps is done different by <code class="inline">erlang:phash2/1,2</code>, <code class="inline">erlang:phash/1</code>
and <code class="inline">erlang:hash/2</code>.</li><li>Comparing two maps with ==, /=, =&lt;, &lt;, &gt;= and &gt;, is done different if the
keys contain floating point numbers.</li></ul><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-12585</p></li><li><p>Scalability improvement for <a href="erlang.html#make_ref/0"><code class="inline">erlang:make_ref/0</code></a>, and other functionality that
create references. Each scheduler now manage its own set of references. By
this no communication at all is needed when creating references.</p><p>Previous implementation generated a strictly monotonically increasing sequence
of references corresponding to creation time on the runtime system instance.
This is <em>not</em> the case with current implementation. You can only expect
reference to be unique. The Erlang/OTP documentation has never mentioned
anything else but the uniqueness property, so this change <em>is</em> fully
compatible. The only reason we've marked this as a potential incompatibility
is since an early draft for an Erlang specification mentions strict
monotonicity as a property.</p><p>If you need to create data with a strict monotonicity property use
[erlang:unique<em>integer([monotonic])](<a href="erlang.html#unique_integer/1"><code class="inline">erlang:unique_integer/1</code></a>). Do _not</em> use
the deprecated <a href="erlang.html#now/0">erlang:now()</a>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-12610</p></li><li><p>Enable different abort signal from heart</p><p>By using environment variable HEART_KILL_SIGNAL, heart can now use a different
signal to kill the old running Erlang.</p><p>By default the signal is SIGKILL but SIGABRT may also be used by setting
environment variable: HEART_KILL_SIGNAL=SIGABRT</p><p>Own Id: OTP-12613 Aux Id: seq12826</p></li><li><p>Update autconf to latest version 2015-03-04</p><p>Own Id: OTP-12646</p></li><li><p>Optimization of timers internally in the VM. This include process timers
(<code class="inline">receive ... after</code>), port timers (<code class="inline">driver_set_timer()</code>) as well as BIF
timers (<code class="inline">erlang:send_after()</code>/<code class="inline">erlang:start_timer()</code>).</p><p>Each scheduler thread now has its own lock-free timer service instead of one
locked central service. This dramatically improves performance of timer
management on systems with a large amount of schedulers and timers.</p><p>The timer service internal data structure has also been optimized to be able
to handle more timers than before. That is, each timer service is by its self
able to handle more timers without dramatic performance loss than the old
centralized timer service.</p><p>The API of BIF timers has also been extended. Timeout values are for example
no longer limited to 32-bit integers. For more information see the
documentation of <a href="erlang.html#start_timer/4"><code class="inline">erlang:start_timer/4</code></a>, <a href="erlang.html#send_after/4"><code class="inline">erlang:send_after/4</code></a>,
<a href="erlang.html#cancel_timer/2"><code class="inline">erlang:cancel_timer/2</code></a>, and <a href="erlang.html#read_timer/2"><code class="inline">erlang:read_timer/2</code></a>.</p><p>Characteristics impact: Calls to the synchronous versions of
<code class="inline">erlang:cancel_timer()</code>, and <code class="inline">erlang:read_timer()</code> may take substantially
longer time to complete than before. This occur when the timer that is
accessed is managed by a remote scheduler. You typically want to use the new
asynchronous option in order to avoid blocking the calling process.</p><p>Own Id: OTP-12650 Aux Id: OTP-11997</p></li><li><p>Specialize instructions from common assembler patterns</p><p>Specialize common instructions of <code class="inline">rem</code>, <code class="inline">band</code>, <code class="inline">minus</code> and <code class="inline">plus</code> in the
beam loader. This will reduce the number of fetches and thus lessen the
instruction dispatch pressure during runtime and speed up those operations in
some common cases.</p><p>Specialize move patterns from x-registers to the stack with a new
<code class="inline">move_window</code> instruction. This change will reduce instruction dispatch
pressure.</p><p>Own Id: OTP-12690</p></li><li><p>Fix cross compilation for Android.</p><p>Own Id: OTP-12693</p></li><li><p>Fix incorrect use of autoconf macro AC_EGREP_CPP, which could cause faulty
configuration if run from a path containing the string 'yes'.</p><p>Own Id: OTP-12706</p></li><li><p>Minimal Java version is now 1.6</p><p>Own Id: OTP-12715</p></li><li><p>Send format and args on process exit to error_logger</p><p>Previously, the emulator would generate a whole string with values and call
the error_logger passing <code class="inline">&quot;~s~n&quot;</code>. This changes it to a format string
containing <code class="inline">~p</code> with the respective values as arguments.</p><p>Own Id: OTP-12735</p></li><li><p>Map error logger warnings to warning messages by default.</p><p>Own Id: OTP-12755</p></li><li><p>Configure architecture ppc64le architecture as a ppc64</p><p>Own Id: OTP-12761</p></li><li><p>Add function <code class="inline">enif_raise_exception</code> to allow a NIF to raise an error exception
with any type of reason.</p><p>Own Id: OTP-12770</p></li><li><p>Optimized node table statistics retrieval.</p><p>Own Id: OTP-12777</p></li><li><p>Map beam error logger warnings to warning messages by default. Previously
these messages were mapped to the error channel by default.</p><p>Own Id: OTP-12781</p></li><li><p>gen_tcp:shutdown/2 is now asynchronous</p><p>This solves the following problems with the old implementation:</p><p>It doesn't block when the TCP peer is idle or slow. This is the expected
behaviour when shutdown() is called: the caller needs to be able to continue
reading from the socket, not be prevented from doing so.</p><p>It doesn't truncate the output. The current version of gen_tcp:shutdown/2 will
truncate any outbound data in the driver queue after about 10 seconds if the
TCP peer is idle of slow. Worse yet, it doesn't even inform anyone that the
data has been truncated: 'ok' is returned to the caller; and a FIN rather than
an RST is sent to the TCP peer.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-12797</p></li><li><p>Introduced delayed node table GC. This in order to avoid oscillation of
entries in and out of the tables. The oscillation caused unnecessary lock
contention on the table locks. The delay length can be set by passing the
<a href="erl_cmd.html#%2Bzdntgc"><code class="inline">+zdntgc</code></a> command line argument.</p><p>Characteristics impact: The tables can grow to very large sizes with unused
entries if the node is get huge amounts of short lived connections from other
nodes. This problem can be alleviated by shortening the length of the delay
using the <code class="inline">+zdntgc</code> command line argument.</p><p>Own Id: OTP-12802</p></li><li><p>Improved implementation of <a href="erlang.html#statistics/1"><code class="inline">erlang:statistics</code></a><code class="inline">(io)</code>
in order to reduce contention between schedulers.</p><p>Characteristics impact: The actual call to <code class="inline">erlang:statistics(io)</code> takes
longer time to complete, but the overall impact on the system is improved.</p><p>Own Id: OTP-12842</p></li><li><p>There are many cases where user code needs to be able to distinguish between a
socket that was closed normally and one that was aborted. Setting the option
{show_econnreset, true} enables the user to receive ECONNRESET errors on
both active and passive sockets.</p><p>Own Id: OTP-12843</p></li><li><p>Do not preallocate too large event pool</p><p>A default pool size of 4000 is too excessive for the common case. This
corresponds directly to the number of threads in the system. Change
ERTS_TS_EV_ALLOC_DEFAULT_POOL_SIZE to 2048. Change ERTS_TS_EV_ALLOC_POOL_SIZE
to 32.</p><p>Own Id: OTP-12849</p></li></ul><h2 id="erts-6-4-1-7" class="section-heading"><a href="#erts-6-4-1-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 6.4.1.7</span></h2><h3 id="fixed-bugs-and-malfunctions-282" class="section-heading"><a href="#fixed-bugs-and-malfunctions-282" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A process communicating with a port via one of the <code class="inline">erlang:port_*</code> BIFs could
potentially end up in an inconsistent state if the port terminated during the
communication. When this occurred the process could later block in a <code class="inline">receive</code>
even though it had messages matching in its message queue.</p><p>This bug was introduced in erts version 5.10 (OTP R16A).</p><p>Own Id: OTP-13424 Aux Id: OTP-10336</p></li><li><p>Calls to <code class="inline">erl_drv_send_term()</code> or <code class="inline">erl_drv_output_term()</code> from a non-scheduler
thread while the corresponding port was invalid caused the emulator to enter
an inconsistent state which eventually caused an emulator crash.</p><p>Own Id: OTP-13866</p></li><li><p>Driver and NIF operations accessing processes or ports could cause an emulator
crash when used from non-scheduler threads. Those operations are:</p><ul><li><code class="inline">erl_drv_send_term()</code></li><li><code class="inline">driver_send_term()</code></li><li><code class="inline">erl_drv_output_term()</code></li><li><code class="inline">driver_output_term()</code></li><li><code class="inline">enif_send()</code></li><li><code class="inline">enif_port_command()</code></li></ul><p>Own Id: OTP-13869</p></li><li><p>Fix bug in <code class="inline">binary_to_term</code> for binaries created by <code class="inline">term_to_binary</code>with
option <code class="inline">compressed</code>. The bug can cause <code class="inline">badarg</code> exception for a valid binary
when Erlang VM is linked against a <code class="inline">zlib</code> library of version 1.2.9 or newer.
Bug exists since OTP 17.0.</p><p>Own Id: OTP-14159 Aux Id: ERL-340</p></li><li><p>Fixed bug in operator <code class="inline">bxor</code> causing erroneuos result when one operand is a
big <em>negative</em> integer with the lowest <code class="inline">N*W</code> bits as zero and the other
operand not larger than <code class="inline">N*W</code> bits. <code class="inline">N</code> is an integer of 1 or larger and <code class="inline">W</code>
is 32 or 64 depending on word size.</p><p>Own Id: OTP-14514</p></li><li><p>Fixed bug in <code class="inline">binary_to_term</code> and <code class="inline">binary_to_atom</code> that could cause VM crash.
Typically happens when the last character of an UTF8 string is in the range
128 to 255, but truncated to only one byte. Bug exists in <code class="inline">binary_to_term</code>
since ERTS version 5.10.2 (OTP_R16B01) and <code class="inline">binary_to_atom</code> since ERTS version
9.0 (OTP-20.0).</p><p>Own Id: OTP-14590 Aux Id: ERL-474</p></li></ul><h2 id="erts-6-4-1-6" class="section-heading"><a href="#erts-6-4-1-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 6.4.1.6</span></h2><h3 id="fixed-bugs-and-malfunctions-283" class="section-heading"><a href="#fixed-bugs-and-malfunctions-283" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>When calling <code class="inline">garbage_collect/[1,2]</code> or <code class="inline">check_process_code/[2,3]</code> from a
process with a higher priority than the priority of the process operated on,
the run queues could end up in an inconsistent state. This bug has now been
fixed.</p><p>Own Id: OTP-13298 Aux Id: OTP-11388</p></li></ul><h2 id="erts-6-4-1-5" class="section-heading"><a href="#erts-6-4-1-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 6.4.1.5</span></h2><h3 id="fixed-bugs-and-malfunctions-284" class="section-heading"><a href="#fixed-bugs-and-malfunctions-284" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug that could cause a crash dump to become almost empty.</p><p>Own Id: OTP-13150</p></li></ul><h2 id="erts-6-4-1-4" class="section-heading"><a href="#erts-6-4-1-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 6.4.1.4</span></h2><h3 id="fixed-bugs-and-malfunctions-285" class="section-heading"><a href="#fixed-bugs-and-malfunctions-285" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The 'raw' socket option could not be used multiple times in one call to any
e.g gen_tcp function because only one of the occurrences were used. This bug
has been fixed, and also a small bug concerning propagating error codes from
within inet:setopts/2.</p><p>Own Id: OTP-11482 Aux Id: seq12872</p></li></ul><h2 id="erts-6-4-1" class="section-heading"><a href="#erts-6-4-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 6.4.1</span></h2><h3 id="fixed-bugs-and-malfunctions-286" class="section-heading"><a href="#fixed-bugs-and-malfunctions-286" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The VTS mode in Common Test has been modified to use a private version of the
Webtool application (ct_webtool).</p><p>Own Id: OTP-12704 Aux Id: OTP-10922</p></li></ul><h2 id="erts-6-4" class="section-heading"><a href="#erts-6-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 6.4</span></h2><h3 id="fixed-bugs-and-malfunctions-287" class="section-heading"><a href="#fixed-bugs-and-malfunctions-287" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix missing quotation in the <code class="inline">LM_FIND_EMU_CC</code> <code class="inline">autoconf</code> macro which could
cause build failures.</p><p>Own Id: OTP-12388</p></li><li><p>Fix erroneous printout of monitors in crashdump file.</p><p>Own Id: OTP-12537</p></li><li><p>The runtime system without SMP support could crash in the BIF
<a href="erlang.html#port_control/3"><code class="inline">port_control/3</code></a> if the port that was being accessed died
during the call to the BIF.</p><p>Own Id: OTP-12544 Aux Id: Seq12777</p></li><li><p>Avoid corrupt oversized integer to be created from binary matching. Instead
throw system_limit exception which is the correct behavior. A peculiar symptom
of this bug was that bitwise operations (band, bor, bxor) on such oversized
integers could return the empty list []. Credit: Mikael Pettersson, Nico
Kruber</p><p>Own Id: OTP-12556</p></li><li><p>A race condition when calling <code class="inline">port_info/1</code> could cause a memory fault has
been fixed.</p><p>Own Id: OTP-12587</p></li><li><p>Fix comparison of exact terms. An overflow that could cause faulty comparisons
has been fixed. Comparison of exact terms is exclusively used within Maps.</p><p>Own Id: OTP-12623</p></li><li><p>Fix bug in <a href="erlang.html#list_to_integer/1"><code class="inline">list_to_integer/1</code></a> for very long lists that
could cause VM crash.</p><p>Own Id: OTP-12624</p></li></ul><h3 id="improvements-and-new-features-69" class="section-heading"><a href="#improvements-and-new-features-69" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Introduced a runtime system internal 64-bit API for atomic memory operations.</p><p>Own Id: OTP-12351</p></li><li><p>Add command line argument option for the initial size of process dictionaries.</p><p>Use '+hpds &lt;size&gt;' to set initial process dictionary size for spawned
processes.</p><p>Own Id: OTP-12535 Aux Id: seq12809</p></li><li><p>Fix documentation on $char for Unicode</p><p>Own Id: OTP-12545</p></li></ul><h2 id="erts-6-3-1" class="section-heading"><a href="#erts-6-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 6.3.1</span></h2><h3 id="fixed-bugs-and-malfunctions-288" class="section-heading"><a href="#fixed-bugs-and-malfunctions-288" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix getifaddrs realloc pointer error</p><p>When a buffer was exhausted and subsequently reallocated, we could get an
unsafe pointer pointing to faulty memory.</p><p>For this to occur we would need to have a large number of interfaces and a
reallocation of memory to a lower addresses.</p><p>The symptom would be garbage returned from erlang:port_control(Port, 25, [])
(prim_inet:getifaddrs(Port) resulting in a badarg) or a segmentation fault.</p><p>Own Id: OTP-12445</p></li><li><p>Don't close all file descriptors twice in child_setup</p><p>The commit c2b4eab25c907f453a394d382c04cd04e6c06b49 introduced an error in
which child_setup erroneously tried to close all file descriptors twice.</p><p>Use closefrom() if available when closing all file descriptors.</p><p>The function closefrom() was only used in the vfork() case before but is now
also used in the fork() case if available.</p><p>Own Id: OTP-12446</p></li><li><p>During a crashdump all file descriptors are closed to ensure the closing of
the epmd port and to reserve a file descriptor for the crashdump file.</p><p>If a driver (third party library) cannot handle closing of sockets this could
result in a segmentation fault in which case a crashdump would not be
produced. This is now fixed by only closing inets sockets via an emergency
close callback to the driver and thus closing the epmd socket.</p><p>Own Id: OTP-12447</p></li></ul><h2 id="erts-6-3" class="section-heading"><a href="#erts-6-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 6.3</span></h2><h3 id="fixed-bugs-and-malfunctions-289" class="section-heading"><a href="#fixed-bugs-and-malfunctions-289" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix HiPE debug lock checking on OS X 64bit</p><p>Position-independent code is mandatory on OS X. We use r11 as an intermediate
register to fill BIF_P-&gt;hipe.bif_callee. This fixes the following error when
doing `make debug FLAVOR=smp`:</p><p>clang -cc1as: fatal error: error in backend: 32-bit absolute addressing is not
supported in 64-bit mode</p><p>Own Id: OTP-12188</p></li><li><p>Fix race bug that could cause VM crash in <code class="inline">erlang:port_get_data/1</code> if the port
was closed by a concurrent process. Also fix fatal bug if <code class="inline">port_set_data/2</code> is
called with a non-immediate data term. Both bugs exist since R16B01.</p><p>Own Id: OTP-12208</p></li><li><p>Correct make variable SSL_DED_LD_RUNTIME_LIBRARY_PATH when erl_xcomp_sysroot
ends with a slash.</p><p>Own Id: OTP-12216 Aux Id: seq12700</p></li><li><p>Fix two cases of unreachable code caused by false use of assignment operators.</p><p>Own Id: OTP-12222</p></li><li><p>Fix bug when hipe compiled code makes tail call to a BIF that disables GC
while trapping (sush as binary_to_list, list_to_binary, binary_to_term,
term_to_binary).</p><p>Own Id: OTP-12231</p></li><li><p>Fix bug when a migrated empty memory carrier is reused just before it should
be destroyed by the thread that created it.</p><p>Own Id: OTP-12249</p></li><li><p>Prevents compile-time errors in NIFs, when the compiler is instructed to treat
missing field initializers as errors, by adding an initializer for the new
options field which was added to ErlNifEntry for 17.3.</p><p>Own Id: OTP-12266</p></li><li><p>Fixed CPU topology detection on FreeBSD systems where Erlang/OTP is compiled
by new C compilers (including, but possibly not limited to, gcc 4.9 and
clang).</p><p>Own Id: OTP-12267</p></li><li><p>Use C99 function isfinite() instead of finite() when available on non GCC
compilers.</p><p>Own Id: OTP-12268</p></li><li><p>Fix bug on windows where an incorrect number of links could be returned when
doing file:read_file_info on a directory.</p><p>Own Id: OTP-12269</p></li><li><p>Fix rare bug when purging module on VM started with +Meamin.</p><p>Own Id: OTP-12273</p></li><li><p>Repair run_erl terminal window size adjustment sent from to_erl. This was
broken in OTP 17.0 which could lead to strange cursor behaviour in the to_erl
shell.</p><p>Own Id: OTP-12275 Aux Id: seq12739</p></li><li><p>Fixed bug on windows causing gen_tcp/udp to return an error when given an fd
to work with.</p><p>Own Id: OTP-12289</p></li><li><p>Fix various internal erts issues where negating a signed integer in C would
trigger undefined behavior. This fixes issues when dividing with bignums and
list_to_integer.</p><p>Own Id: OTP-12290</p></li><li><p>When flushing output to stdout on windows, the emulator could sometimes hang
indefinitely waiting for the flush to complete. This has been fixed.</p><p>Own Id: OTP-12291</p></li><li><p>Fix so that non-smp emulators with dirty scheduler support shows the correct
number of dirty schedulers when calling erlang:system_info(system_version).</p><p>Own Id: OTP-12295</p></li><li><p>Add <code class="inline">nif_version</code> to <a href="erlang.html#system_info/1"><code class="inline">erlang:system_info/1</code></a> in order to get the NIF API
version of the runtime system in a way similar to <code class="inline">driver_version</code>.</p><p>Own Id: OTP-12298</p></li><li><p>Fix bug that could cause the return value from dirty NIF with zero arity to be
treated as garbage, leading to VM crash.</p><p>Own Id: OTP-12300</p></li><li><p>Improve allocation carrier migration search logic. This will reduce the risk
of failed migrations that could lead to excess memory consumption. It will
also improve smp performance due to reduced memory contention on the migration
pool.</p><p>Own Id: OTP-12323</p></li></ul><h3 id="improvements-and-new-features-70" class="section-heading"><a href="#improvements-and-new-features-70" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Introduced support for eager check I/O.</p><p>By default eager check I/O will be disabled, but this will most likely be
changed in OTP 18. When eager check I/O is enabled, schedulers will more
frequently check for I/O work. Outstanding I/O operations will however not be
prioritized to the same extent as when eager check I/O is disabled.</p><p>Eager check I/O can be enabled using the <code class="inline">erl</code> command line argument:
<code class="inline">+secio true</code></p><p>Characteristics impact when enabled:</p><ul><li>Lower latency and smoother management of externally triggered I/O
operations.</li><li>A slightly reduced priority of externally triggered I/O operations.</li></ul><p>Own Id: OTP-12117</p></li><li><p>Fix erts .app-file</p><p>Own Id: OTP-12189</p></li><li><p>Add configure option --with-ssl-incl=PATH to support OpenSSL installations
with headers and libraries at different places.</p><p>Own Id: OTP-12215 Aux Id: seq12700</p></li><li><p>Optimization of atomic memory operations with release barrier semantics on
32-bit PowerPC when using the implementation included in OTP.</p><p>Own Id: OTP-12250</p></li><li><p>Minor adjustment of scheduler activation code making sure that an activation
of a scheduler is not prevented by its run-queue being non-empty. (Thanks to
Songlu Cai)</p><p>Own Id: OTP-12287</p></li><li><p>Improved support for atomic memory operations provided by the
<a href="https://github.com/ivmai/libatomic_ops/">libatomic_ops</a> library. Most
importantly support for use of native double word atomics when implemented by
<code class="inline">libatomic_ops</code> (for example, implemented for ARM).</p><p>The
<a href="../../system/install.html#advanced-configuration-and-build-of-erlang-otp_configuring_atomic-memory-operations-and-the-vm"><code class="inline">$ERL_TOP/HOWTO/INSTALL.md</code></a>
document now also more clearly describes when you want to build together with
a <code class="inline">libatomic_ops</code> installation.</p><p>Own Id: OTP-12302</p></li><li><p>Add configure option --with-ssl-rpath to control which runtime library path to
use for dynamic linkage toward OpenSSL.</p><p>Own Id: OTP-12316 Aux Id: seq12753</p></li><li><p>Added systemd notify support to epmd</p><p>Own Id: OTP-12321</p></li></ul><h2 id="erts-6-2-1" class="section-heading"><a href="#erts-6-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 6.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-290" class="section-heading"><a href="#fixed-bugs-and-malfunctions-290" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix bug when an migrated empty memory carrier is reused just before it should
be destroyed by the thread that created it.</p><p>Own Id: OTP-12249</p></li><li><p>Repair run_erl terminal window size adjustment sent from to_erl. This was
broken in OTP 17.0 which could lead to strange cursor behaviour in the to_erl
shell.</p><p>Own Id: OTP-12275 Aux Id: seq12739</p></li></ul><h2 id="erts-6-2" class="section-heading"><a href="#erts-6-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 6.2</span></h2><h3 id="fixed-bugs-and-malfunctions-291" class="section-heading"><a href="#fixed-bugs-and-malfunctions-291" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>General documentation updates.</p><p>Own Id: OTP-12052</p></li><li><p>A bug in the VM code implementing sending of signals to ports could cause the
receiving port queue to remain in a busy state forever. When this state had
been reached, processes sending command signals to the port either got
suspended forever, or, if the <code class="inline">nosuspend</code> feature was used, always failed to
send to the port. This bug was introduced in ERTS version 5.10.</p><p>In order for this bug to be triggered on a port, one had to at least once
utilize the <code class="inline">nosuspend</code> functionality when passing a signal to the port. This
by either calling</p><ul><li><p><a href="erlang.html#port_command/3"><code class="inline">port_command(Port, Data, [nosuspend | Options])</code></a>,</p></li><li><p><a href="erlang.html#send/3"><code class="inline">erlang:send(Port, {PortOwner, {command, Data}}, [nosuspend | Options])</code></a>,</p></li><li><a href="erlang.html#send_nosuspend/2"><code class="inline">erlang:send_nosuspend(Port, {PortOwner, {command, Data}})</code></a>,
or</li><li><a href="erlang.html#send_nosuspend/3"><code class="inline">erlang:send_nosuspend(Port, {PortOwner, {command, Data}}, Options)</code></a>.</li></ul><p>Thanks Vasily Demidenok for reporting the issue, and Sergey Kudryashov for
providing a testcase.</p><p>Own Id: OTP-12082 Aux Id: OTP-10336</p></li><li><p>Fix size overflow bug at memory allocation. A memory allocation call, with an
insane size close to the entire address space, could return successfully as if
it had allocated just a few bytes. (Thanks to Don A. Bailey for reporting)</p><p>Own Id: OTP-12091</p></li><li><p>Fix various issues where negating a signed integer would trigger undefined
behaviour. This fixes issues in the enif_make_int64 interface and some edge
cases inside the erlang runtime system.</p><p>Own Id: OTP-12097</p></li><li><p>The documentation erroneously listed the <a href="erl_cmd.html#%2Bswct"><code class="inline">+swct</code></a> command
line argument under <code class="inline">+sws</code>.</p><p>Own Id: OTP-12102 Aux Id: OTP-10994</p></li><li><p>Profiling messages could be delivered out of order when profiling on
<code class="inline">runnable_procs</code> and/or <code class="inline">runnable_ports</code> using <a href="erlang.html#system_profile/2"><code class="inline">erlang:system_profile/2</code></a>. This
bug was introduced in ERTS version 5.10.</p><p>Own Id: OTP-12105 Aux Id: OTP-10336</p></li><li><p>Various logging fixes, including: Add run queue index to the process dump in
crash dumps.<br/>Add thread index to enomem slogan when crashing.<br/>Remove error logger message for sending messages to old instances of the same
node.</p><p>Own Id: OTP-12115</p></li><li><p>Fix compiler warnings reported by LLVM</p><p>Own Id: OTP-12138</p></li><li><p>Correct conversion of <code class="inline">MIN_SMALL</code> by
<a href="erlang.html#list_to_integer/1"><code class="inline">list_to_integer/1</code></a> and
<a href="erlang.html#binary_to_integer/1"><code class="inline">binary_to_integer/1</code></a>. The bug produced an
unnormalized bignum which can cause strange behavior such as comparing
different to a correct <code class="inline">MIN_SMALL</code> integer. The value <code class="inline">MIN_SMALL</code> is
<code class="inline">-(1 bsl 27) = -134217728</code> on a 32-bit VM and
<code class="inline">-(1 bsl 59) = -576460752303423488</code> on a 64-bit VM. (Thanks to Jesper Louis
Andersen, Mikael Pettersson and Anthony Ramine for report, patch and
optimization suggestion)</p><p>Own Id: OTP-12140</p></li><li><p>Fix bug in <code class="inline">term_to_binary</code> that reallocates binary with inconsistent size
information. Bug has never been confirmed to be the cause of any faulty
behavior.</p><p>Own Id: OTP-12141</p></li><li><p>Real_path method used while prim loading archive files was not taking into
account the fact that windows directory symlinks can be across different
drives.</p><p>Own Id: OTP-12155</p></li></ul><h3 id="improvements-and-new-features-71" class="section-heading"><a href="#improvements-and-new-features-71" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Add log2 histogram to lcnt for lock wait time</p><p>Own Id: OTP-12059</p></li><li><p>Introduced <a href="erl_nif.html#enif_schedule_nif"><code class="inline">enif_schedule_nif()</code></a> to the NIF
API.</p><p>The <code class="inline">enif_schedule_nif()</code> function allows a long-running NIF to be broken into
separate NIF invocations without the help of a wrapper function written in
Erlang. The NIF first executes part of the long-running task, then calls
<code class="inline">enif_schedule_nif()</code> to schedule a NIF for later execution to continue the
task. Any number of NIFs can be scheduled in this manner, one after another.
Since the emulator regains control between invocations, this helps avoid
problems caused by native code tying up scheduler threads for too long.</p><p>The <code class="inline">enif_schedule_nif()</code> function also replaces the
<code class="inline">enif_schedule_dirty_nif()</code> in the experimental dirty NIF API. Note that the
only incompatible changes made are in the experimental dirty NIF API.</p><p>See the <a href="erl_nif.html">NIF documentation</a> for more information.</p><p>Thanks to Steve Vinoski.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-12128</p></li></ul><h2 id="erts-6-1-2" class="section-heading"><a href="#erts-6-1-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 6.1.2</span></h2><h3 id="fixed-bugs-and-malfunctions-292" class="section-heading"><a href="#fixed-bugs-and-malfunctions-292" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>OTP-11850 fixed filelib:wildcard/1 to work with broken symlinks. This
correction, however, introduced problems since symlinks were no longer
followed for functions like filelib:ensure_dir/1, filelib:is_dir/1,
filelib:file_size/1, etc. This is now corrected.</p><p>Own Id: OTP-12054 Aux Id: seq12660</p></li></ul><h2 id="erts-6-1-1" class="section-heading"><a href="#erts-6-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 6.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-293" class="section-heading"><a href="#fixed-bugs-and-malfunctions-293" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed ETHR_FORCE_INLINE which caused the build to break on some platforms
without adequate thread support (VxWorks).</p><p>Own Id: OTP-12010</p></li></ul><h2 id="erts-6-1" class="section-heading"><a href="#erts-6-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 6.1</span></h2><h3 id="fixed-bugs-and-malfunctions-294" class="section-heading"><a href="#fixed-bugs-and-malfunctions-294" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The documentation for <a href="erlang.html#spawn_opt/5"><code class="inline">spawn_opt/5</code></a> now has a note mentioning
that the <code class="inline">monitor</code> option is not supported.</p><p>Own Id: OTP-11849</p></li><li><p>Fix broken system monitoring of <code class="inline">large_heap</code> for non-smp VM. No message for
<code class="inline">large_heap</code> was ever sent on non-smp VM. Bug exist since R16B.</p><p>Own Id: OTP-11852</p></li><li><p>The emulator without SMP support crashed when passing a message to a process
without enough heap space for the message. This bug was introduced in
<code class="inline">erts-6.0</code>.</p><p>Own Id: OTP-11887 Aux Id: OTP-11388</p></li><li><p>Fix race between ETS table deletion and unfixation that could cause VM crash.
The race could happen between a terminating process that does not own the
table but has a fixation on it and another process that deletes the table
(maybe the owner terminating) at the same time. Bug existed since R15B02.</p><p>Own Id: OTP-11892</p></li><li><p>The string following the <code class="inline">-eval</code> option when invoking <code class="inline">erl</code> would not be
properly translated from UTF-8 to a list of Unicode characters (as would the
arguments for <code class="inline">-run</code>).</p><p>That bug would cause the build of Erlang/OTP to fail when building in a
directory whose pathname contained non-US ASCII characters encoded in UTF-8.
(Thanks to Eric Pailleau for reporting this bug.)</p><p>Own Id: OTP-11916</p></li><li><p>Fix erts_debug:size/1 to handle Map sizes</p><p>Own Id: OTP-11923</p></li><li><p>Removed <code class="inline">erlang:bitstr_to_list/1</code> and <code class="inline">erlang:list_to_bitstr/1</code>. They were
added by mistake, and have always raised an <code class="inline">undefined</code> exception when called.</p><p>Own Id: OTP-11942</p></li><li><p>Fixed compilation using mingw-w64 on Windows.</p><p>Thanks to Jani Hakala.</p><p>Own Id: OTP-11945</p></li><li><p>The git sha is no longer printed in the shell start header when erlang is
built from a tagged git release.</p><p>Own Id: OTP-11961</p></li><li><p>Fixed a bug where <code class="inline">send</code> trace events were erroneously dropped when the send
was done to a registered process. This bug was introduced in R16B.</p><p>Own Id: OTP-11968</p></li></ul><h3 id="improvements-and-new-features-72" class="section-heading"><a href="#improvements-and-new-features-72" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The following native functions now bump an appropriate amount of reductions
and yield when out of reductions:</p><ul><li><a href="erlang.html#binary_to_list/1"><code class="inline">erlang:binary_to_list/1</code></a></li><li><a href="erlang.html#binary_to_list/3"><code class="inline">erlang:binary_to_list/3</code></a></li><li><a href="erlang.html#bitstring_to_list/1"><code class="inline">erlang:bitstring_to_list/1</code></a></li><li><a href="erlang.html#list_to_binary/1"><code class="inline">erlang:list_to_binary/1</code></a></li><li><a href="erlang.html#iolist_to_binary/1"><code class="inline">erlang:iolist_to_binary/1</code></a></li><li><a href="erlang.html#list_to_bitstring/1"><code class="inline">erlang:list_to_bitstring/1</code></a></li><li><a href="../../apps/stdlib/binary.html#list_to_bin/1"><code class="inline">binary:list_to_bin/1</code></a></li></ul><p>Characteristics impact:</p><ul><li><p><strong>Performance</strong> - The functions converting from lists got a performance loss
for very small lists, and a performance gain for very large lists.</p></li><li><p><strong>Priority</strong> - Previously a process executing one of these functions
effectively got an unfair priority boost. This priority boost depended on
the input size. The larger the input was, the larger the priority boost got.
This unfair priority boost is now lost.</p></li></ul><p>Own Id: OTP-11888</p></li><li><p>The systemd features of epmd have been removed from epmd by default. To enable
them you have to build erlang with the configure option --enable-systemd.</p><p>Own Id: OTP-11921</p></li><li><p>Removed Erlang wrapper code used when calling
<a href="erlang.html#binary_to_term/1"><code class="inline">binary_to_term/1</code></a>, and
<a href="erlang.html#binary_to_term/2"><code class="inline">binary_to_term/2</code></a>. This improves the performance of
these BIFs especially when they are called with small binaries as input.</p><p>Own Id: OTP-11931</p></li><li><p>Add erlang:system_info(tolerant_timeofday), an API to check whether
compensation for sudden changes of system time is enabled or not.</p><p>Own Id: OTP-11970</p></li></ul><h2 id="erts-6-0-1" class="section-heading"><a href="#erts-6-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 6.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-295" class="section-heading"><a href="#fixed-bugs-and-malfunctions-295" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix broken system monitoring of <code class="inline">large_heap</code> for non-smp VM. No message for
<code class="inline">large_heap</code> was ever sent on non-smp VM. Bug exist since R16B.</p><p>Own Id: OTP-11852</p></li><li><p>Fixed type spec of <a href="erlang.html#system_info/1"><code class="inline">erlang:system_info/1</code></a>.</p><p>Own Id: OTP-11859 Aux Id: OTP-11615</p></li></ul><h2 id="erts-6-0" class="section-heading"><a href="#erts-6-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 6.0</span></h2><h3 id="fixed-bugs-and-malfunctions-296" class="section-heading"><a href="#fixed-bugs-and-malfunctions-296" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The option dupnames did not work as intended in re. When looking for names
with {capture, [Name, ...]}, re:run returned a random instance of the match
for that name, instead of the leftmost matching instance, which was what the
documentation stated. This is now corrected to adhere to the documentation.
The option {capture,all_names} along with a re:inspect/2 function is also
added to further help in using named subpatterns.</p><p>Own Id: OTP-11205</p></li><li><p>Allow loading of NIF library with unicode path name</p><p>Own Id: OTP-11408</p></li><li><p>Allow loading of driver with unicode path name</p><p>Own Id: OTP-11549</p></li><li><p>Fixed a bug where starting Erlang without having an open stdin on fd 0 would
sometimes deadlock the emulator when terminating.</p><p>Own Id: OTP-11558</p></li><li><p>The option '-names' in epmd now works on Windows (Thanks to Johannes WeiÃŸl)</p><p>Own Id: OTP-11565</p></li><li><p>Correction of the examples in escript documentation. (Thanks to Pierre
Fenoll).</p><p>Own Id: OTP-11577</p></li><li><p>Fix bs_get_integer instruction</p><p>The instruction bs_get_integer could unnecessarily trigger a garbage
collection in failure cases which is unwanted or outright dangerous.</p><p>Ex:</p><p>&lt;&lt;X:Sz,_/bits&gt;&gt; = &lt;&lt;&quot;some binary&quot;&gt;&gt;</p><p>Previously, if Sz induced X to a bignum it would reserved memory size this on
the heap via a garbage collection before checking if the size could actually
match.</p><p>It will now check the binary size before triggering a collection.</p><p>Own Id: OTP-11581</p></li><li><p>Remove heap space overestimation in <code class="inline">binary_to_term</code> (and remote message
reception) for integers in the intervals [-2147483648,-1] and
[256,2147483647] on 64-bit emulators.</p><p>Own Id: OTP-11585</p></li><li><p>Add support for detecting the separate tinfo library from ncurses (Thanks to
Dirkjan Ochtman)</p><p>Own Id: OTP-11590</p></li><li><p>Deprecation warning for system_flag(cpu_topology) has been extended for
removal in OTP 18 (Thanks to Steve Vinoski for the update)</p><p>Own Id: OTP-11602</p></li><li><p>Documentation improvement regarding some awkward wording around the +spp flag.
(Thanks to Brian L. Troutwine )</p><p>Own Id: OTP-11607</p></li><li><p>Fixed bug where sendfile would return the wrong error code for a remotely
closed socket if the socket was in passive mode. (Thanks to Vincent Siliakus
for reporting the bug.)</p><p>Own Id: OTP-11614</p></li><li><p>Increase garbage collection tenure rate</p><p>The garbage collector tries to maintain the previous heap block size during a
minor gc, i.e. 'need' is not utilized in determining the size of the new heap,
instead it relies on tenure and garbage to be sufficiently large.</p><p>In instances during intense growing with exclusively live data on the heap
coupled with delayed tenure, fullsweeps would be triggered directly after a
minor gc to make room for 'need' since the new heap would be full.</p><p>To remedy this, the tenure of terms on the minor heap will always happen (if
it is below the high watermark) instead of every other minor gc.</p><p>Characteristics Impact: Reduced CPU-time spent in garbage collection but may
infer delays in collecting garbage from the heap. Tweak 'fullsweep_after'
options to increase gc pressure if needed.</p><p>Own Id: OTP-11617</p></li><li><p>Fix bug when comparing integers with floats larger than 2^992. The bug could
potentially cause memory corruption on 32-bit emulators.</p><p>Own Id: OTP-11618</p></li><li><p>Cross-compilation fixes for TileraMDE-3.0.1.125620</p><p>Own Id: OTP-11635</p></li><li><p>sendfile no longer uses async threads by default</p><p>This has been done because a slow client attack is possible if the async
thread pool is used. The scenario is:</p><p>Client does a request for a file and then slowly receives the file one byte at
a time. This will eventually fill the async thread pool with blocking sendfile
operations and thus starving the vm of all file operations.</p><p>If you still want to use the async threads pool for sendfile an option to
enable it has been introduced.</p><p>Thanks to Christopher Faulet for identifying this vulnerability.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-11639</p></li><li><p>Do proper rollback of calls to <code class="inline">enif_open_resource_type</code> when load/upgrade
callbacks of NIF library return failure.</p><p>Own Id: OTP-11722</p></li><li><p>Changed the default configuration when configuring with <code class="inline">$ERL_TOP/configure</code>
to be the same as when configuring with <code class="inline">$ERL_TOP/otp_build configure</code>.</p><p>Previously floating point exceptions got enabled by default on Linux when HiPE
was enabled when configuring with <code class="inline">$ERL_TOP/configure</code>, but not when
configuring with <code class="inline">$ERL_TOP/otp_build configure</code>. The default is now in both
cases not to use floating point exceptions since there still exist unresolved
issues with floating point exceptions on Linux.</p><p>For more information see <a href="../../system/install.html"><code class="inline">$ERL_TOP/HOWTO/INSTALL.md</code></a>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-11723</p></li><li><p>A comment in erl_db_tree.c no longer differ from the code. (Thanks to Cobus
Carstens)</p><p>Own Id: OTP-11793</p></li><li><p>Fix epmd debug functionality for VxWorks (Thanks to Jay True)</p><p>Own Id: OTP-11808</p></li><li><p>Use closefrom/2 when available in child_setup (Thanks to Rick Reed and Anthony
Ramine)</p><p>Own Id: OTP-11809</p></li><li><p>Fix dtrace/systemtap bug where the probe arguments would be concatenated due
to faulty length calculation.</p><p>Thanks to Michal Ptaszek and Scott Lystig Fritchie</p><p>Own Id: OTP-11816</p></li><li><p>It is now better documented that the <code class="inline">+fn*</code> flags to <code class="inline">erl</code> also affect how
command line parameters and environment variables are read. (Thanks to Vlad
Dumitrescu)</p><p>Own Id: OTP-11818</p></li></ul><h3 id="improvements-and-new-features-73" class="section-heading"><a href="#improvements-and-new-features-73" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Options to set match_limit and match_limit_recursion are added to re:run. The
option report_errors is also added to get more information when re:run fails
due to limits or compilation errors.</p><p>Own Id: OTP-10285</p></li><li><p>Dialyzer's <code class="inline">unmatched_return</code> warnings have been corrected.</p><p>Own Id: OTP-10908</p></li><li><p>A common case is to wrap an argument to
<a href="erlang.html#list_to_binary/1"><code class="inline">list_to_binary/1</code></a> in a list to ensure conversion can
happen even though the argument may already be a binary. Take special care of
this case and do not copy binary.</p><p>Impact: May cause incompatibility since a single binary is no longer copied.
Use <code class="inline">binary:copy/1,2</code> instead.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-11082</p></li><li><p>Make erlang:open_port/2 spawn and spawn_executable handle unicode.</p><p>Own Id: OTP-11105</p></li><li><p>Handle unicode (widestring) in erl, erlc, heart, etc on windows.</p><p>Own Id: OTP-11135</p></li><li><p>The version of the PCRE library Used by Erlang's re module is raised to 8.33
from 7.6. This means, among other things, better Unicode and Unicode Character
Properties support. New options connected to PCRE 8.33 are also added to the
re module (ucd, notempty_atstart, no_start_optimize). PCRE has extended the
regular expression syntax between 7.6 and 8.33, why this imposes a potential
incompatibility. Only very complicated regular expressions may be affected,
but if you know you are using obscure features, please test run your regular
expressions and verify that their behavior has not changed.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-11204</p></li><li><p>Filenames containing UTF-8 encoded characters can now be handled by erlc.</p><p>If you have set the <code class="inline">ERLC_EMULATOR</code> environment variable, note that <code class="inline">erlc</code> in
OTP 17 will only work with <code class="inline">erl</code> in OTP 17 since the protocol between the
<code class="inline">erlc</code> program and the <code class="inline">erl_compile</code> module has changed.</p><p>Own Id: OTP-11248</p></li><li><p>By giving --enable-static-{nifs,drivers} to configure it is now possible to
statically linking of nifs and drivers to the main Erlang VM binary. At the
moment only the asn1 and crypto nifs of the Erlang/OTP nifs and drivers have
been prepared to be statically linked. For more details see the Installation
Guide in the System documentation.</p><p>Own Id: OTP-11258</p></li><li><p>Erlang/OTP has been ported to the realtime operating system OSE. The port
supports both smp and non-smp emulator. For details around the port and how to
started see the User's Guide in the <em>ose</em> application.</p><p>Note that not all parts of Erlang/OTP has been ported.</p><p>Notable things that work are: non-smp and smp emulators, OSE signal
interaction, crypto, asn1, run_erl/to_erl, tcp, epmd, distribution and most if
not all non-os specific functionality of Erlang.</p><p>Notable things that does not work are: udp/sctp, os_mon, erl_interface,
binding of schedulers.</p><p>Own Id: OTP-11334</p></li><li><p>Add the {active,N} socket option for TCP, UDP, and SCTP, where N is an
integer in the range -32768..32767, to allow a caller to specify the number of
data messages to be delivered to the controlling process. Once the socket's
delivered message count either reaches 0 or is explicitly set to 0 with
inet:setopts/2 or by including {active,0} as an option when the socket is
created, the socket transitions to passive ({active, false}) mode and the
socket's controlling process receives a message to inform it of the
transition. TCP sockets receive {tcp_passive,Socket}, UDP sockets receive
{udp_passive,Socket} and SCTP sockets receive {sctp_passive,Socket}.</p><p>The socket's delivered message counter defaults to 0, but it can be set using
{active,N} via any gen_tcp, gen_udp, or gen_sctp function that takes socket
options as arguments, or via inet:setopts/2. New N values are added to the
socket's current counter value, and negative numbers can be used to reduce the
counter value. Specifying a number that would cause the socket's counter value
to go above 32767 causes an einval error. If a negative number is specified
such that the counter value would become negative, the socket's counter value
is set to 0 and the socket transitions to passive mode. If the counter value
is already 0 and inet:setopts(Socket, [{active,0}]) is specified, the
counter value remains at 0 but the appropriate passive mode transition message
is generated for the socket.</p><p>Thanks to Steve Vinoski</p><p>Own Id: OTP-11368</p></li><li><p>A new optional scheduler utilization balancing mechanism has been introduced.
For more information see the <a href="erl_cmd.html#%2Bsub"><code class="inline">+sub</code></a> command line
argument.</p><p>Characteristics impact: None, when not enabled. When enabled, changed timing
in the system, normally a small overhead due to measuring of utilization and
calculating balancing information. On some systems, such as old Windows
systems, the overhead can be quite substantial. This time measurement overhead
highly depend on the underlying primitives provided by the OS.</p><p>Own Id: OTP-11385</p></li><li><p>A call to either the <a href="erlang.html#garbage_collect/1"><code class="inline">garbage_collect/1</code></a> BIF or the
<a href="erlang.html#check_process_code/2"><code class="inline">check_process_code/2</code></a> BIF may trigger garbage
collection of another processes than the process calling the BIF. The previous
implementations performed these kinds of garbage collections without
considering the internal state of the process being garbage collected. In
order to be able to more easily and more efficiently implement yielding native
code, these types of garbage collections have been rewritten. A garbage
collection like this is now triggered by an asynchronous request signal, the
actual garbage collection is performed by the process being garbage collected
itself, and finalized by a reply signal to the process issuing the request.
Using this approach processes can disable garbage collection and yield without
having to set up the heap in a state that can be garbage collected.</p><p>The <a href="erlang.html#garbage_collect/2"><code class="inline">garbage_collect/2</code></a>, and
<a href="erlang.html#check_process_code/3"><code class="inline">check_process_code/3</code></a> BIFs have been
introduced. Both taking an option list as last argument. Using these, one can
issue asynchronous requests.</p><p><a href="../../apps/kernel/code.html#purge/1"><code class="inline">code:purge/1</code></a> and <a href="../../apps/kernel/code.html#soft_purge/1"><code class="inline">code:soft_purge/1</code></a> have been rewritten to utilize
asynchronous <code class="inline">check_process_code</code> requests in order to parallelize work.</p><p>Characteristics impact: A call to the
<a href="erlang.html#garbage_collect/1"><code class="inline">garbage_collect/1</code></a> BIF or the
<a href="erlang.html#check_process_code/2"><code class="inline">check_process_code/2</code></a> BIF will normally take longer
time to complete while the system as a whole won't be as much negatively
effected by the operation as before. A call to <a href="../../apps/kernel/code.html#purge/1"><code class="inline">code:purge/1</code></a> and
<a href="../../apps/kernel/code.html#soft_purge/1"><code class="inline">code:soft_purge/1</code></a> may complete faster or slower depending on the state of
the system while the system as a whole won't be as much negatively effected by
the operation as before.</p><p>Own Id: OTP-11388 Aux Id: OTP-11535, OTP-11648</p></li><li><p>Cleanup 'Buckets' and 'Time left' fields in crashdump to ease parsing.</p><p>Own Id: OTP-11419</p></li><li><p>Add sync option to file:open/2.</p><p>The sync option adds the POSIX O_SYNC flag to the open system call on
platforms that support the flag or its equivalent, e.g.,
FILE_FLAG_WRITE_THROUGH on Windows. For platforms that don't support it,
file:open/2 returns {error, enotsup} if the sync option is passed in. Thank
to Steve Vinoski and Joseph Blomstedt</p><p>Own Id: OTP-11498</p></li><li><p>erlang:binary_to_term will now cost an appropriate amount of reductions and
will interrupt (yield) for reschedule if the term is big. This avoids too long
schedules when binary_to_term is used. (Thanks to Svante Karlsson for the
original patch)</p><p>Impact: Programs running binary_to_term on large binaries will run more
smoothly, but rescheduling will impact the single process performance of the
BIF. Single threaded benchmarks might show degraded performance of the BIF,
while general system behaviour will be improved.</p><p>Own Id: OTP-11535 Aux Id: OTP-11388</p></li><li><p>Added high resolution icon for windows. (Thanks to Daniel Goertz for the
inspiration.)</p><p>Own Id: OTP-11560</p></li><li><p>Migration of memory carriers has been enabled by default on all ERTS internal
memory allocators based on the <a href="erts_alloc.html#alloc_util"><code class="inline">alloc_util</code></a>
framework except for <code class="inline">temp_alloc</code>. That is,
<a href="erts_alloc.html#M_acul"><code class="inline">+M&lt;S&gt;acul de</code></a> is default for these allocators. Note
that this also implies changed allocation strategies for all of these
allocators. They will all now use the &quot;address order first fit carrier best
fit&quot; strategy.</p><p>By passing <code class="inline">+Muacul 0</code> on the command line, all configuration changes made by
this change will be reverted.</p><p>Characteristics impact: Improved memory characteristics with a smaller memory
footprint at the expense of a quite small performance cost.</p><p>Own Id: OTP-11604 Aux Id: OTP-10279</p></li><li><p>A clarification has been added to the documentation of <code class="inline">-on_load()</code> in the
Reference Manual that it is only recommended for loading NIF libraries.</p><p>Own Id: OTP-11611</p></li><li><p><code class="inline">+fnaw</code> is now default when starting the emulator; it used to be <code class="inline">+fnl</code>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-11612</p></li><li><p>EEP43: New data type - Maps</p><p>With Maps you may for instance:</p><ul><li><p>____ - <code class="inline">M0 = #{ a =&gt; 1, b =&gt; 2}, % create associations</code></p></li><li><p>____ - <code class="inline">M1 = M0#{ a := 10 }, % update values</code></p></li><li><p>____ - <code class="inline">M2 = M1#{ &quot;hi&quot; =&gt; &quot;hello&quot;}, % add new associations</code></p></li><li><p>____ - <code class="inline">#{ &quot;hi&quot; := V1, a := V2, b := V3} = M2. % match keys with values</code></p></li></ul><p>For information on how to use Maps please see Map Expressions in the
<a href="../../system/expressions.html#map-expressions">Reference Manual</a>.</p><p>The current implementation is without the following features:</p><ul><li><p>____ - No variable keys</p></li><li><p>____ - No single value access</p></li><li><p>____ - No map comprehensions</p></li></ul><p>Note that Maps is <em>experimental</em> during OTP 17.0.</p><p>Own Id: OTP-11616</p></li><li><p>The previously deprecated driver API function <code class="inline">driver_async_cancel()</code> has been
removed. Due to this, the driver API version has been bumped to 3.0.</p><p>Thanks to Steve Vinoski.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-11628</p></li><li><p>Experimental &quot;dirty scheduler&quot; functionality has been introduced. In order to
try the functionality out, you need to pass the command line argument
<code class="inline">--enable-dirty-schedulers</code> to <code class="inline">configure</code> when building the system.</p><p>Dirty schedulers can currently only be used by NIFs on a system with SMP
support. More information can be found in the
<a href="erl_nif.html#dirty_nifs"><code class="inline">erl_nif(3)</code></a> documentation, the
<a href="erl_cmd.html"><code class="inline">erl(1)</code></a> documentation, and in the git commit comment of commit
'c1c03ae4ee50e58b7669ea88ec4d29c6b2b67c7b'.</p><p>Note that the functionality is <em>experimental</em>, and <em>not supported</em>. This
functionality <em>will</em> be subject to backward incompatible changes. You should
<em>not</em> enable the dirty scheduler functionality on production systems. It is
only provided for testing.</p><p>Thanks to Steve Vinoski.</p><p>Own Id: OTP-11629</p></li><li><p>Improve reduction cost and yielding of <code class="inline">term_to_binary</code>. The reduction cost is
increased and garbage collection is disabled during yield.</p><p>Impact: Improves system responsiveness when <code class="inline">term_to_binary</code> is called with
large terms without significant degradation of single threaded performance.</p><p>Own Id: OTP-11648 Aux Id: OTP-11388</p></li><li><p>By default, the system's version of zlib will be used, provided its version is
1.2.4 or higher; otherwise the built-in zlib will be used. The built-in
version of zlib has been bumped to 1.2.8. (Use the <code class="inline">--enable-builtin-zlib</code>
option to <code class="inline">configure</code> to force the use of the built-in zlib.)</p><p>Own Id: OTP-11669</p></li><li><p>The default float encoding in binary_to_term and external_size has been
changed to use minor_mode 1 instead of 0.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-11738</p></li><li><p>Introduced the <code class="inline">configure</code> option <code class="inline">--with-assumed-cache-line-size=SIZE</code>. For
more information see <a href="../../system/install.html"><code class="inline">$ERL_TOP/HOWTO/INSTALL.md</code></a>.</p><p>Own Id: OTP-11742</p></li><li><p>Halfword emulator is marked as deprecated. It still works as before but is
planned to be removed in a future major release.</p><p>Own Id: OTP-11777</p></li><li><p>The external format for Maps has changed in a way that is not compatible with
the format used in OTP 17.0-rc1 and OTP 17.0-rc2.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-11782</p></li><li><p>Fixed faulty make dependency that would make some make versions fail while
building gen_git_version.mk.</p><p>Own Id: OTP-11784</p></li><li><p>Introduced functionality for allowing old drivers and NIF libraries to be
loaded during a transition period. For more information see
<a href="erl_driver.html#version_management">the version management section in the <code class="inline">erl_driver(3)</code> documentation</a>
and
<a href="erl_nif.html#version_management">the version management section in the <code class="inline">erl_nif(3)</code> documentation</a>.</p><p>Own Id: OTP-11799</p></li><li><p>Support file paths longer than 259 characters on Windows. Long absolute paths
are automatically converted to UNC format with a <code class="inline">\\?\</code> prefix which is the
only way to represent long paths. The 259 character limit still applies for
individual file names, relative paths and the current working directory.</p><p>Own Id: OTP-11813</p></li><li><p>Document that escript:create/2 also accepts a 3-elements tuple containing
files and zip:create/3 options to build a zip file.</p><p>Thanks to Pierre Fenoll</p><p>Own Id: OTP-11827</p></li><li><p>Add systemd socket activation for epmd.</p><p>Thanks to Matwey V. Kornilov</p><p>Own Id: OTP-11829</p></li></ul><h2 id="erts-5-10-4-1" class="section-heading"><a href="#erts-5-10-4-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.10.4.1</span></h2><h3 id="known-bugs-and-problems" class="section-heading"><a href="#known-bugs-and-problems" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Known Bugs and Problems</span></h3><ul><li><p>When using gen_tcp:connect and the <code class="inline">fd</code> option with <code class="inline">port</code> and/or <code class="inline">ip</code>, the
<code class="inline">port</code> and <code class="inline">ip</code> options were ignored. This has been fixed so that if <code class="inline">port</code>
and/or <code class="inline">ip</code> is specified together with <code class="inline">fd</code> a bind is requested for that <code class="inline">fd</code>.
If <code class="inline">port</code> and/or <code class="inline">ip</code> is not specified bind will not be called.</p><p>Own Id: OTP-12061</p></li></ul><h2 id="erts-5-10-4" class="section-heading"><a href="#erts-5-10-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.10.4</span></h2><h3 id="fixed-bugs-and-malfunctions-297" class="section-heading"><a href="#fixed-bugs-and-malfunctions-297" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>When normalizing paths, erl_prim_loader would always convert backslash to
forward slash. This is correct on Windows, but not on other operating systems.
erl_prim_loader now checks which OS is running before performing this
conversion.</p><p>Own Id: OTP-11170</p></li><li><p>Fixed syslog defines and defined LOG_ERR for systems without syslog.h. Thanks
to Matt Lewandowsky.</p><p>Own Id: OTP-11349</p></li><li><p>Check all pattern arguments passed to binary:matches/2. Thanks to Mike Sassak.</p><p>Own Id: OTP-11350</p></li><li><p>Fix two small silent rules omissions. Thanks to Anthony Ramine.</p><p>Own Id: OTP-11351</p></li><li><p>Teach configure to detect if posix_memalign cannot align to more than the
system page size.</p><p>For cross-compiled systems a new environment variable called
erl_xcomp_posix_memalign has been introduced to indicate whether
posix_memalign should be used.</p><p>Own Id: OTP-11371</p></li><li><p>Fix bsr bug occurring when shifting a huge number a huge number of bits to the
right. Thanks to Lars Hesel Christensen.</p><p>Own Id: OTP-11381</p></li><li><p>Fix memory leak for distributed monitors</p><p>Own Id: OTP-11410</p></li><li><p>Fix various typos in erts, kernel and ssh. Thanks to Martin HÃ¤ssler.</p><p>Own Id: OTP-11414</p></li><li><p>Crashdumps initiated by out-of-memory on process spawn could cause the beam to
segfault during crashdump writing due to invalid pointers.</p><p>The pointers are invalid since the process creation never finished. This fix
removes these processes from the printouts. Reported by Richard Carlsson.</p><p>Own Id: OTP-11420</p></li><li><p>Crash dumps from 64-bit Erlang machines would have all memory addresses
truncated to 32 bits, which could cause trouble inspecting processes message
queues and stacks in the crashdump viewer.</p><p>Own Id: OTP-11450</p></li><li><p>Threads other than schedulers threads could make thread unsafe accesses when
support for migration of memory carriers had been enabled, i.e., when the
<a href="erts_alloc.html#M_acul"><code class="inline">+M&lt;S&gt;acul</code></a> command line flag had been passed to
<a href="erl_cmd.html"><code class="inline">erl</code></a>. This could cause corruption of the VMs internal state.</p><p>This bug was introduced in erts-5.10.2 when the support for migration of
memory carriers was introduced.</p><p>Own Id: OTP-11456 Aux Id: OTP-10279</p></li><li><p>Fix bug in <code class="inline">binary_to_term</code> for invalid bitstrings and very large binaries
(&gt;2Gb).</p><p>Own Id: OTP-11479</p></li><li><p>Under rare circumstances a process calling <a href="../../apps/kernel/inet.html#close/1"><code class="inline">inet:close/1</code></a>, <a href="../../apps/kernel/gen_tcp.html#close/1"><code class="inline">gen_tcp:close/1</code></a>,
<a href="../../apps/kernel/gen_udp.html#close/1"><code class="inline">gen_udp:close/1</code></a>, or <a href="../../apps/kernel/gen_sctp.html#close/1"><code class="inline">gen_sctp:close/1</code></a> could hang in the call indefinitely.</p><p>Own Id: OTP-11491</p></li><li><p>Fix bug that could cause a 32-bit emulator to always crash at start (since
R16B01) depending on the alignment of static data in the beam executable.</p><p>Own Id: OTP-11496</p></li><li><p>Fix benign bugs regarding bitstring compare. Only a nuisance for debug and
valgrind VM.</p><p>Own Id: OTP-11501</p></li><li><p>Silence warnings (Thanks to Anthony Ramine)</p><p>Own Id: OTP-11517</p></li><li><p>The default wordsize of the emulator (beam) is now determined by compiler
default on Mac OSX (Darwin). This was previously forced to 32bits by the
configure script unless otherwise specified.</p><p>Own Id: OTP-11521</p></li></ul><h3 id="improvements-and-new-features-74" class="section-heading"><a href="#improvements-and-new-features-74" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>A new memory allocation feature called &quot;super carrier&quot; has been introduced.
The super carrier feature can be used in different ways. It can for example be
used for pre-allocation of all memory that the runtime system should be able
to use.</p><p>By default the super carrier is disabled. It is enabled by passing the
<a href="erts_alloc.html#MMscs"><code class="inline">+MMscs &lt;size in MB&gt;</code></a> command line argument. For more
information see the documentation of the <a href="erts_alloc.html#MMsco"><code class="inline">+MMsco</code></a>,
<a href="erts_alloc.html#MMscrfsd"><code class="inline">+MMscrfsd</code></a>, <a href="erts_alloc.html#MMscrpm"><code class="inline">+MMscrpm</code></a>,
<a href="erts_alloc.html#MMscs"><code class="inline">+MMscs</code></a>, <a href="erts_alloc.html#Musac"><code class="inline">+MMusac</code></a>, and,
<a href="erts_alloc.html#Mlpm"><code class="inline">+Mlpm</code></a> command line arguments in the
<a href="erts_alloc.html"><code class="inline">erts_alloc(3)</code></a> documentation.</p><p>Since it is disabled by default there should be no impact on system
characteristics if not used.</p><p>This change has been marked as a potential incompatibility since the returned
list when calling
<a href="erlang.html#system_info_allocator_tuple"><code class="inline">erlang:system_info({allocator, mseg_alloc})</code></a>
now also include an <code class="inline">{erts_mmap, _}</code> tuple as one element in the list.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-11149</p></li><li><p>Added erlang:system_info(ets_limit) to provide a way to retrieve the runtime's
maximum number of ETS tables. Thanks to Steve Vinoski</p><p>Own Id: OTP-11362</p></li><li><p>Add new BIF os:unsetenv/1 which deletes an environment variable. Thanks to
Martin HÃ¤ssler.</p><p>Own Id: OTP-11446</p></li><li><p>Introduced a new guarantee regarding exit signals from ports:</p><p>If the process calling one of the synchronous port BIFs listed below is linked
to the port identified by the first argument, and the port exits before
sending the result of the port operation, the exit signal issued due to this
link will be received by the processes before the BIF returns, or fail with an
exception due to the port not being open.</p><p>The synchronous port BIFs are:</p><ul><li><a href="erlang.html#port_close/1"><code class="inline">port_close/1</code></a></li><li><a href="erlang.html#port_command/2"><code class="inline">port_command/2</code></a></li><li><a href="erlang.html#port_command/3"><code class="inline">port_command/3</code></a></li><li><a href="erlang.html#port_connect/2"><code class="inline">port_connect/2</code></a></li><li><a href="erlang.html#port_control/3"><code class="inline">port_control/3</code></a></li><li><a href="erlang.html#port_call/3"><code class="inline">erlang:port_call/3</code></a></li><li><a href="erlang.html#port_info/1"><code class="inline">erlang:port_info/1</code></a></li><li><a href="erlang.html#port_info/2"><code class="inline">erlang:port_info/2</code></a></li></ul><p>Note that some ports under certain circumstances unlink themselves from the
calling process before exiting, i.e. even though the process linked itself to
the port there might be no link triggering an exit signal.</p><p>Characteristics impact: The return or exception from the synchronous port BIF
will be delayed if the port simultaneously exit due to some issue unrelated to
the outstanding synchronous port BIF call. In all other cases characteristics
are unchanged.</p><p>Own Id: OTP-11489</p></li></ul><h2 id="erts-5-10-3-1" class="section-heading"><a href="#erts-5-10-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.10.3.1</span></h2><h3 id="improvements-and-new-features-75" class="section-heading"><a href="#improvements-and-new-features-75" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Memory allocators will be able to create <code class="inline">sys_alloc</code> carriers as fallback, if
<code class="inline">mseg_alloc</code> cannot create more carriers, on systems with <code class="inline">posix_memalign()</code>
support. This is similar to how it worked in pre-R16 releases.</p><p>Windows systems will create carriers using <code class="inline">_aligned_malloc()</code> and can by this
use the new optimized allocator header scheme introduced in R16 on other
platforms.</p><p>Own Id: OTP-11318</p></li></ul><h2 id="erts-5-10-3" class="section-heading"><a href="#erts-5-10-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.10.3</span></h2><h3 id="fixed-bugs-and-malfunctions-298" class="section-heading"><a href="#fixed-bugs-and-malfunctions-298" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The documentation of predefined types and built-in types has been corrected.</p><p>Own Id: OTP-11090</p></li><li><p>Fix changing terminal parameters in to_erl</p><p>Change the behaviour of to_erl to use TCSADRAIN instead of TCSANOW when
changing terminal parameters. This makes the serial driver wait for the output
queues to be empty before applying the terminal parameter change. Thanks to
Stefan Zegenhagen.</p><p>Own Id: OTP-11206</p></li><li><p>The default value of {flush, boolean()} in erlang:halt/2 is documented to be
'true' if the status is an integer. The implementation behaviour was reversed.
The Implementation is now corrected to adhere to the documentation. Thanks to
Jose Valim for reporting the error.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-11218</p></li><li><p>Fix serious race bug in R16B01 that could cause PID mix-ups when a lot of
processes were spawned and terminated in a very rapid pace on an SMP emulator
with at least two scheduler threads.</p><p>Own Id: OTP-11225</p></li><li><p>Validating a trace pattern with the option silent no longer incorrectly
enables/disables the silent option of the calling process.</p><p>Own Id: OTP-11232</p></li><li><p>Fixed a bug where GCC 4.8 and later use a more aggressive loop optimization
algorithm that broke some previously working code in the efile driver. Thanks
to Tomas Abrahamsson for reporting this issue.</p><p>Own Id: OTP-11246</p></li><li><p>Fixed bug when printing memory allocator acul option in crash dump.</p><p>Own Id: OTP-11264</p></li><li><p>Opening a new compressed file on Windows could in rare (random) cases result
in {error,eisdir} or other error codes although it should have succeeded.
This is now corrected.</p><p>Own Id: OTP-11265</p></li><li><p>Fixed a race condition when closing a trace port that would cause the emulator
to crash.</p><p>Own Id: OTP-11290</p></li></ul><h3 id="improvements-and-new-features-76" class="section-heading"><a href="#improvements-and-new-features-76" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>There is a new somewhat experimental socket option 'netns' that can set the
network namespace for a socket on Linux:es where it is supported. See the
documentation.</p><p>Own Id: OTP-11157</p></li><li><p>New allocator strategy <code class="inline">aoffcbf</code> (address order first fit carrier best fit).
Supports carrier migration but with better CPU performance than <code class="inline">aoffcaobf</code>.</p><p>Own Id: OTP-11174</p></li><li><p>Introduced functionality for inspection of system and build configuration.</p><p>Own Id: OTP-11196</p></li><li><p>Fix matching of floating point middle-endian machines. Thanks to Johannes
Weissl.</p><p>Own Id: OTP-11201</p></li><li><p>Fix compile error on ARM and GCC versions greater than 4.1.0. Thanks to
Johannes Weissl.</p><p>Own Id: OTP-11214</p></li><li><p>run_erl: Redirect standard streams to /dev/null. Thanks to Johannes Weissl.</p><p>Own Id: OTP-11215</p></li><li><p>Misc. corrections in documentation for erl_driver. Thanks to Giacomo Olgeni.</p><p>Own Id: OTP-11227</p></li><li><p>Fix documentation regarding binary_part.</p><p>Own Id: OTP-11239</p></li><li><p>Make edlin understand a few important control keys. Thanks to Stefan
Zegenhagen.</p><p>Own Id: OTP-11251</p></li><li><p>Export type zlib:zstream/0. Thanks to Loic Hoguin.</p><p>Own Id: OTP-11278</p></li><li><p>Add erl option to set schedulers by percentages.</p><p>For applications where measurements show enhanced performance from the use of
a non-default number of emulator scheduler threads, having to accurately set
the right number of scheduler threads across multiple hosts each with
different numbers of logical processors is difficult because the erl +S option
requires absolute numbers of scheduler threads and scheduler threads online to
be specified.</p><p>To address this issue, add a +SP option to erl, similar to the existing +S
option but allowing the number of scheduler threads and scheduler threads
online to be set as percentages of logical processors configured and logical
processors available, respectively. For example, &quot;+SP 50:25&quot; sets the number
of scheduler threads to 50% of the logical processors configured, and the
number of scheduler threads online to 25% of the logical processors available.
The +SP option also interacts with any settings specified with the +S option,
such that the combination of options &quot;+S 4:4 +SP 50:50&quot; (in either order)
results in 2 scheduler threads and 2 scheduler threads online.</p><p>Thanks to Steve Vinoski</p><p>Own Id: OTP-11282</p></li><li><p>Extend erl_driver interface with lock names</p><p>Lock and thread names are already a feature in the driver interface. This
extension will let developers read these names which eases debugging.</p><p>Own Id: OTP-11303</p></li><li><p>Fix incorrect values returned by integer_to_binary/2. Thanks to Juan Jose
Comellas.</p><p>Own Id: OTP-11311</p></li><li><p>Fix system_flag scheduling_statistics - disable . Thanks to Steve Vinoski.</p><p>Own Id: OTP-11317</p></li><li><p>The documentation of predefined types has been corrected Thanks to Kostis
Sagonas.</p><p>Own Id: OTP-11321</p></li></ul><h2 id="erts-5-10-2" class="section-heading"><a href="#erts-5-10-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.10.2</span></h2><h3 id="fixed-bugs-and-malfunctions-299" class="section-heading"><a href="#fixed-bugs-and-malfunctions-299" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A bug in prim_inet has been corrected. If the port owner was killed at a bad
time while closing the socket port the port could become orphaned hence
causing port and socket leaking. Reported by Fred Herbert, Dmitry Belyaev and
others.</p><p>Own Id: OTP-10497 Aux Id: OTP-10562</p></li><li><p>Compilation fixes for NetBSD. Thanks to YAMAMOTO Takashi.</p><p>Own Id: OTP-10941</p></li><li><p>Fixed a race condition when using delayed_write when writing to a file which
would cause the same data to be written multiple times.</p><p>Own Id: OTP-10984</p></li><li><p>Fix small memory leak from tracing with option <code class="inline">meta</code>.</p><p>Own Id: OTP-10997</p></li><li><p>Correct typo in erlsrv usage. Thanks to Bryan Hunter</p><p>Own Id: OTP-11002</p></li><li><p>ct_run: delete unused function. Thanks to Tuncer Ayaz.</p><p>Own Id: OTP-11003</p></li><li><p>Corrections to run_erl/to_erl handshake behaviour.</p><p>Own Id: OTP-11012</p></li><li><p>Fix typo in type: erlang:process_info_item(). Thanks to Andrew Tunnell-Jones.</p><p>Own Id: OTP-11024</p></li><li><p>Fix src/dest overlap issue in ttsl driver. Thanks to Steve Vinoski.</p><p>Own Id: OTP-11064</p></li><li><p>When sending to a port using <code class="inline">erlang:send(Port, Msg, [nosuspend])</code>, the send
operation was performed synchronously. This bug has now been fixed.</p><p>Own Id: OTP-11076 Aux Id: OTP-10336</p></li><li><p>When converting a faulty binary to a list with unicode:characters_to_list, the
error return value could contain a faulty &quot;rest&quot;, i.e. the io_list of
characters that could not be converted was wrong. This happened only if input
was a sub binary and conversion was from utf8. This is now corrected.</p><p>Own Id: OTP-11080</p></li><li><p>Runtime system could crash when reporting stale <code class="inline">driver_select()</code>.</p><p>Own Id: OTP-11084</p></li><li><p>Fix lock order violation for memory instrumentation (+Mim, +Mis, +Mit).</p><p>Own Id: OTP-11085</p></li><li><p>Fixed some compilation warnings on miscellaneous platforms. Thanks to Anthony
Ramine.</p><p>Own Id: OTP-11086</p></li><li><p>Fixed issue when flushing i/o during shutdown on windows where the Erlang VM
would sometime hang due to a race condition.</p><p>Own Id: OTP-11096</p></li><li><p>Fixed issue where repeated calls to erlang:nodes() could cause unnecessary
contention in the dist_table lock.</p><p>Own Id: OTP-11097</p></li><li><p>Properly guard WIDE_TAG use with HAVE_WCWIDTH in ttsl_drv. Thanks to Anthony
Ramine</p><p>Own Id: OTP-11106</p></li><li><p>Fix some Makefile rules that didn't support silent rules. Thanks to Anthony
Ramine.</p><p>Own Id: OTP-11111</p></li><li><p>Fix receive support in erl_eval with a BEAM module. Thanks to Anthony Ramine.</p><p>Own Id: OTP-11137</p></li><li><p>erlang:now() could suddenly jump ~24 days into the future on Windows. This is
now corrected. Thanks to Garret Smith for reporting and testing fixes.</p><p>Own Id: OTP-11146</p></li><li><p>erlang:term_to_binary will now cost an appropriate amount of reductions and
will interrupt (yield) for reschedule if the term is big. This avoids too long
schedules when term_to_binary is used.</p><p>Impact: Programs running term_to_binary on large terms will run more smothly,
but rescheduling will impact the single process performance of the BIF. Single
threaded benchmarks will show degraded performance of the BIF when called with
very large terms, while general system behaviour will be improved. The
overhead for allowing restart and reduction counting also degrades local
performance of the BIF with between 5% and 10% even for small terms.</p><p>Own Id: OTP-11163</p></li></ul><h3 id="improvements-and-new-features-77" class="section-heading"><a href="#improvements-and-new-features-77" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Replaced the lock protecting gathering of garbage collection statistics with a
lock-free solution.</p><p>Own Id: OTP-10271 Aux Id: kunagi-108 [04c5410f-9cc4-4696-8639-36bf98686c7a-7]</p></li><li><p>Support for migration of memory carriers between memory allocator instances
has been introduced.</p><p>By default this feature is not enabled and do not effect the characteristics
of the system. When enabled it has the following impact on the characteristics
of the system:</p><ul><li>Reduced memory footprint when the memory load is unevenly distributed
between scheduler specific allocator instances.</li><li>Depending on the default allocation strategy used on a specific allocator
there might or might not be a slight performance loss.</li><li>When enabled on the <code class="inline">fix_alloc</code> allocator, a different strategy for
management of fix blocks will be used.</li><li>The information returned from
<a href="erlang.html#system_info_allocator_tuple"><code class="inline">erlang:system_info({allocator, A})</code></a>,
and
<a href="erlang.html#system_info_allocator_sizes"><code class="inline">erlang:system_info({allocator_sizes, A})</code></a>
will be slightly different when this feature has been enabled. An
<code class="inline">mbcs_pool</code> tuple will be present giving information about abandoned
carriers, and in the <code class="inline">fix_alloc</code> case no <code class="inline">fix_types</code> tuple will be present.</li></ul><p>For more information, see the documentation of the
<a href="erts_alloc.html#M_acul"><code class="inline">+M&lt;S&gt;acul</code></a> command line argument.</p><p>Own Id: OTP-10279</p></li><li><p>Change specs for spawn_opt to use the process_level() type declaration instead
of re-defining it in various places. Thanks to Kostis Sagonas.</p><p>Own Id: OTP-11008</p></li><li><p>Postscript files no longer needed for the generation of PDF files have been
removed.</p><p>Own Id: OTP-11016</p></li><li><p>Erlang source files with non-ASCII characters are now encoded in UTF-8
(instead of latin1).</p><p>Own Id: OTP-11041 Aux Id: OTP-10907</p></li><li><p>Optimization of simultaneous <code class="inline">inet_db</code> operations on the same socket by using
a lock free implementation.</p><p>Impact on the characteristics of the system: Improved performance.</p><p>Own Id: OTP-11074</p></li><li><p>The <code class="inline">high_msgq_watermark</code> and <code class="inline">low_msgq_watermark</code> <code class="inline">inet</code> socket options
introduced in OTP-R16A could only be set on TCP sockets. These options are now
generic and can be set on all types of sockets.</p><p>Own Id: OTP-11075 Aux Id: OTP-10336</p></li><li><p>A new better algorithm for management of the process, and port tables has been
introduced.</p><p>Impact on the characteristics of the system:</p><ul><li>The new algorithm ensures that both insert and delete operations can be made
in O(1) time complexity. Previously used algorithm either caused insert or
delete to be O(N).</li><li>The new algorithm will also ensure that reuse of identifiers will be less
frequent than when the old algorithm was used.</li><li>Previously used algorithm ensured that the latest created identifier
compared as the largest when comparing two identifiers of the same type that
had been created on the same node as long as no identifiers had been reused.
Since identifiers can be reused quite fast, one has never been able to rely
on this property. Due to the introduction of this new algorithm this
property will not hold even if no identifiers has been reused yet. This
could be considered as an incompatibility.</li></ul><p>Due to the above mensioned potential incompatibility, it will still be
possible to enable the old algorithm for some time. The command line argument
<a href="erl_cmd.html#%2BP"><code class="inline">+P legacy</code></a> will enable the old algorithm on the process
table, and <a href="erl_cmd.html#%2BQ"><code class="inline">+Q legacy</code></a> will do the same for the port table.
These command line arguments are however deprecated as of their introduction
and have been scheduled for removal in OTP-R18.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-11077</p></li><li><p>Support wide characters in the shell through wcwidth(). Thanks to Anthony
Ramine. Reported by LoÃ¯c Hoguin.</p><p>Own Id: OTP-11088</p></li><li><p>Added total used memory for each process in erlang crash dumps.</p><p>Own Id: OTP-11098</p></li><li><p>Added support for hipe on Raspberry Pi (armv6l). Thanks to Klaus Alfert.</p><p>Own Id: OTP-11125</p></li><li><p>Remove 'query' from the list of reserved words in docs. Thanks to Matthias
Endler and LoÃ¯c Hoguin.</p><p>Own Id: OTP-11158</p></li><li><p>Lift static limitation (FD_SETSIZE) for file descriptors on Mac OS X. (Thanks
to Anthony Ramine)</p><p>Own Id: OTP-11159</p></li></ul><h3 id="known-bugs-and-problems-1" class="section-heading"><a href="#known-bugs-and-problems-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Known Bugs and Problems</span></h3><ul><li><p>Miscellaneous native code in OTP misbehave either due to lengthy execution, or
due to not bumping reductions properly. Problems typically occur when passing
huge sets of data to a misbehaving BIF. Fixing this has high priority and is
being worked on, but there will remain issues like this for some time.</p><p>In order to alleviate problems with scheduling which might occur when
executing misbehaving native code, the command line argument
<a href="erl_cmd.html#%2Bsfwi">+sfwi</a> has been introduced.</p><p>By default this feature is disabled and you are advised not to enable it if
you do not encounter problems with misbehaving native code.</p><p>When enabled it has the following impact on the characteristics of the system:</p><ul><li>Work will always be distributed between schedulers even when executing
misbehaving native code.</li><li>It may cause an increased amount of processes and/or ports bouncing between
schedulers which in turn will cause a performance loss.</li><li>It may cause reduced performance due to reduced or lost work compaction when
all schedulers do not execute under full load.</li><li>An increased contention on run queue locks.</li></ul><p>Own Id: OTP-11164</p></li></ul><h2 id="erts-5-10-1-2" class="section-heading"><a href="#erts-5-10-1-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.10.1.2</span></h2><h3 id="fixed-bugs-and-malfunctions-300" class="section-heading"><a href="#fixed-bugs-and-malfunctions-300" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A bug in the implementation of offline schedulers has been fixed. The bug was
introduced in OTP-R16A/ERTS-5.10, and caused work-stealing between schedulers
to fail. This in turn, caused work to accumulate in some run-queues. The bug
was only triggered when there were offline schedulers in the system, i.e.,
when the amount of online schedulers was less than the total amount of
schedulers. The effect of the bug got more severe the larger amount of offline
schedulers the system had.</p><p>Own Id: OTP-11022 Aux Id: OTP-9892</p></li></ul><h2 id="erts-5-10-1-1" class="section-heading"><a href="#erts-5-10-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.10.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-301" class="section-heading"><a href="#fixed-bugs-and-malfunctions-301" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The BIF <a href="erlang.html#is_process_alive/1"><code class="inline">is_process_alive/1</code></a> could prematurely
return <code class="inline">false</code> while the process being inspected was terminating. This bug was
introduced in ERTS-5.10.</p><p>Own Id: OTP-10926</p></li><li><p>Fix a problem in <a href="erlang.html#delete_element/2"><code class="inline">erlang:delete_element/2</code></a> where the call could corrupt one
word of stack if the heap and stack met during call.</p><p>Own Id: OTP-10932</p></li><li><p>The <a href="erl_cmd.html#%2Bsws"><code class="inline">+sws&lt;value&gt;</code></a> and <a href="erl_cmd.html#%2Bswt"><code class="inline">+swt&lt;value&gt;</code></a>
system flags failed if no white space were passed between the parameter and
value parts of the flags. Upon failure, the runtime system refused to start.</p><p>Own Id: OTP-11000</p></li></ul><h3 id="improvements-and-new-features-78" class="section-heading"><a href="#improvements-and-new-features-78" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Scheduler threads will now by default be less eager requesting wakeup due to
certain cleanup operations. This can also be controlled using the
<a href="erl_cmd.html#%2Bswct"><code class="inline">+swct</code></a> command line argument of <a href="erl_cmd.html"><code class="inline">erl(1)</code></a>.</p><p>Own Id: OTP-10994</p></li></ul><h2 id="erts-5-10-1" class="section-heading"><a href="#erts-5-10-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.10.1</span></h2><h3 id="fixed-bugs-and-malfunctions-302" class="section-heading"><a href="#fixed-bugs-and-malfunctions-302" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Threads created internally in the runtime system by vanilla, fd, and spawn
drivers on Windows systems could make thread unsafe calls to
<code class="inline">driver_select()</code>.</p><p>Own Id: OTP-10802</p></li><li><p>Threads created internally in the runtime system by the vanilla, fd, and spawn
drivers on Windows systems could make unsafe memory accesses to driver data
after port had terminated.</p><p>Own Id: OTP-10803</p></li><li><p>The runtime system could crash when flushing data to standard out or standard
error on Windows.</p><p>Own Id: OTP-10807</p></li><li><p>Bugs due to the port optimizations introduced in erts-5.10/OTP-R16A have been
fixed:</p><ul><li>Memory leak when terminating ports</li><li>Memory leak when reaching the system limit of maximum amount of concurrently
existing ports</li><li>Crashes due to missing, or late test of bad port handle</li><li>The newly introduced driver API function <code class="inline">erl_drv_busy_msgq_limits()</code> could
not be used by dynamically linked in drivers on Windows</li></ul><p>Own Id: OTP-10809 Aux Id: OTP-10336</p></li><li><p>Fix <code class="inline">{packet,httph}</code> header capitalization for unrecognized header fields
longer than 20 characters such as <code class="inline">Sec-Websocket-Version</code>. The limit is simply
raised from 20 to 50 characters with the hope that valid headers longer than
50 are not used.</p><p>Own Id: OTP-10824</p></li><li><p>Fix rounding issues in float_to_list/1,2. Thanks to Serge Aleynikov</p><p>Own Id: OTP-10837</p></li><li><p>Fix memory leak in file driver introduced in R16A.</p><p>Own Id: OTP-10841</p></li><li><p>A bug in an ERTS internal queue implementation could cause the loss of a wake
up signal to a consumer thread. This has now been fixed.</p><p>The effect of this bug, when triggered, was often only a small or even no
delay of certain operations. This since, threads often are woken due to other
unrelated reasons. However, if the consumer thread was not woken due to other
reasons when the bug was triggered, these operations could be left hanging,
potentially for ever. Such effects seems to have been very rare, but we have
on at least one occasion gotten a report about such an issue.</p><p>Operations potentially effected by this bug:</p><ul><li><p><strong>Inspection of memory allocation status</strong> - The Erlang process calling
<code class="inline">erlang:memory/[0,1]</code>, or
<code class="inline">erlang:system_info({allocator|allocator_sizes, _})</code> could potentially hang
waiting for responses from involved threads.</p></li><li><p><strong>Async thread pool jobs</strong> - An async thread pool job request and/or reply
could potentially be left hanging. In OTP this only effected file
operations, but user implemented drivers using the async thread pool were
also effected. In the file operation case, this would typically translate
into an Erlang process potentially hanging on the file operation.</p></li><li><p><strong>Shutting down the runtime system</strong> - Due to the issue with the async
thread pool mentioned above, flushing of I/O while terminating the runtime
system could also potentially hang.</p></li><li><p><strong>ETS memory deallocation</strong> - Scheduled jobs handling deallocation of the
main structure of an ETS table could potentially hang. This more or less
only translates into minor memory leaks.</p></li><li><p><strong>Shutting down distribution</strong> - The distribution shutdown phase used when
manually shutting down the distribution, i.e., when calling
<code class="inline">net_kernel:stop()</code>, could potentially hang.</p></li></ul><p>Own Id: OTP-10854</p></li><li><p>OS X Snow Leopard now only uses write, as writev does not work properly on
very large files.</p><p>Own Id: OTP-10858</p></li><li><p>Fixed a bug where line oriented file I/O using read_ahead was very slow for
files with very large difference in line length.</p><p>Own Id: OTP-10859</p></li><li><p>In erts-5.10 (R16A) faulty hashvalues were produced for non-ASCII atoms
(characters in byte-range 128..255). This has now been fixed and hashvalues
conforms to previous OTP releases.</p><p>Own Id: OTP-10860</p></li><li><p>Fixes of memory accesses that might be thread unsafe when the runtime system
has been linked against third-party libraries for atomic memory operations
during the build. Most builds are uneffected by this bug. If triggered, the
runtime system will most likely crash more or less immediately.</p><p>Own Id: OTP-10875 Aux Id: OTP-10854</p></li><li><p>Fixed a bug where it was longer possible to give the +sws proposal flag to
non-smp emulators.</p><p>Own Id: OTP-10881 Aux Id: seq12258</p></li><li><p>Faulty type to bytes read for ReadFile on Windows. This could cause windows
systems to misbehave. The correct type is now used.</p><p>Own Id: OTP-10890</p></li><li><p>Change default max ports for Windows to 8192. Having a too large value caused
Windows to not be able to recover properly. If you want to use another value,
pass <code class="inline">+Q Value</code> to erl or werl.</p><p>Own Id: OTP-10892</p></li><li><p>Fix rare crash on halfword vm during code loading.</p><p>Own Id: OTP-10896</p></li></ul><h3 id="improvements-and-new-features-79" class="section-heading"><a href="#improvements-and-new-features-79" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Tuple funs (deprecated in R15B) are no longer supported.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-10170</p></li><li><p>Added four new bifs, <code class="inline">erlang:binary_to_integer/1,2</code>,
<a href="erlang.html#integer_to_binary/1"><code class="inline">erlang:integer_to_binary/1</code></a>, <a href="erlang.html#binary_to_float/1"><code class="inline">erlang:binary_to_float/1</code></a> and
<code class="inline">erlang:float_to_binary/1,2</code>. These bifs work similarly to how their list
counterparts work, except they operate on binaries. In most cases converting
from and to binaries is faster than converting from and to lists.</p><p>These bifs are auto-imported into erlang source files and can therefore be
used without the <code class="inline">erlang</code> prefix.</p><p>Own Id: OTP-10300 Aux Id: kunagi-74 [74]</p></li><li><p>The experimental support for packages has been removed.</p><p>Own Id: OTP-10348 Aux Id: kunagi-316 [227]</p></li><li><p>The driver API function
<a href="erl_driver.html#erl_drv_consume_timeslice"><code class="inline">erl_drv_consume_timeslice()</code></a>, and
the NIF API function
<a href="erl_nif.html#enif_consume_timeslice"><code class="inline">enif_consume_timeslice()</code></a> have been
introduced.</p><p>These functions are provided in order to better support co-operative
scheduling, improve system responsiveness, and to make it easier to prevent
misbehaviors of the VM due to a process or port monopolizing a scheduler
thread. They can be used when dividing lengthy work into a number of repeated
calls without the need to use threads.</p><p>Own Id: OTP-10810</p></li><li><p>The list_to_integer/2 bif has been optimized when used with bases other
than 10.</p><p>Own Id: OTP-10834 Aux Id: kunagi-74 [74]</p></li><li><p>The git commit sha of the HEAD commit is now added to the Erlang shell when
compiling a non-released Erlang version.</p><p>Own Id: OTP-10838</p></li><li><p>Change caching policy for memory segment allocator. For instance, prefer sbc
segments over mbc segments, caching policy is time-arrow aware, evicting older
cached segments to store newer segments.</p><p>The default number of cacheable segment has been increased from five to ten
segments. This can be modified, same as before, with the command line option
<code class="inline">+MMmcs 5</code></p><p>Impact: Increased speed for processing on larger objects, e.g. binaries.
Slight increase of mapped and resident memory. Tune your system with memory
options to <code class="inline">erl</code> for best performance.</p><p>Own Id: OTP-10840</p></li><li><p>Updated config.sub and config.guess to latest version from gnu.org</p><p>Own Id: OTP-10848</p></li><li><p>Add an xcomp file for Blue Gene/Q. Thanks to Kostis Sagonas.</p><p>Own Id: OTP-10849</p></li><li><p>Cleanup of documentation of the type language. Thanks to Kostis Sagonas.</p><p>Own Id: OTP-10850</p></li><li><p>Change the return value of hipe_bifs:remove_refs_from/1. Thanks to Kostis
Sagonas.</p><p>Own Id: OTP-10851</p></li><li><p>As of ERTS-5.10/OTP-R16A node names passed in the EPMD protocol are required
to be encoded in UTF-8. Since EPMD previously accepted latin1 encoded node
names this is an incompatibility. However, since Erlang nodes always have
required characters in node names to be 7-bit ASCII characters (and still do
require this), this incompatibility should not effect anyone using EPMD as an
Erlang Port Mapper Daemon.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-10872 Aux Id: OTP-10753</p></li><li><p>The +pc flag to erl can be used to set the range of characters considered
printable. This affects how the shell and io:format(&quot;~tp&quot;,...) functionality
does heuristic string detection. More can be read in STDLIB users guide.</p><p>Own Id: OTP-10884</p></li><li><p>Fix a number of type cast errors related to formatted printing on Win64 that
can potentially cause problem when the Erlang VM exceeds 4 GB of ram. (Thanks
to Blaine Whittle for the original patch)</p><p>Own Id: OTP-10887</p></li><li><p>The effect of the deprecated environment variable ERL_MAX_PORTS had been
removed prematurely. It has now been re-added. Note that this is still
scheduled to be released in R17B.</p><p>Own Id: OTP-10895</p></li></ul><h2 id="erts-5-10" class="section-heading"><a href="#erts-5-10" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.10</span></h2><h3 id="fixed-bugs-and-malfunctions-303" class="section-heading"><a href="#fixed-bugs-and-malfunctions-303" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Set new peeled off SCTP socket to nonblocking socket (Thanks to Jonas
Falkevik)</p><p>Own Id: OTP-10491</p></li><li><p>Fix various typos (thanks to Tuncer Ayaz)</p><p>Own Id: OTP-10611</p></li><li><p>Fix fd leak when using async thread pool</p><p>When using the async thread pool, if an erlang process asks to open a file and
it gets shutdown/killed while the file:open/2 call hasn't returned, it's
possible to leak a file descriptor against the target file. This has now been
fixed. (Thanks to Filipe David Manana)</p><p>Own Id: OTP-10677</p></li><li><p>Use sys/types.h instead of string.h to pull ssize_t definition to
erl_driver.h. This fixes build issue on NetBSD. (Thanks to Yamamoto Takashi).</p><p>Own Id: OTP-10699</p></li><li><p>Arguments given with the -run or -s flags to erl are now translated according
to the file name encoding mode of the runtime system.</p><p>Own Id: OTP-10702</p></li><li><p>The octet counters in the gen_tcp/inet interface could behave in unexpected
ways on 64bit platforms. The behaviour is now as expected.</p><p>Own Id: OTP-10746</p></li><li><p>Certain linux kernels, most notably in redhat and CentOS distribution, had a
bug in writev which generated an infinite loop in the tcp code of the VM. The
bug is now worked around.</p><p>Own Id: OTP-10747</p></li><li><p>A process that got killed (got an exit signal) while operating on a
compresseed file, could cause a segmentation fault in the VM. This is now
corrected. Thanks to Filipe David Manana for identifying the problem and
submitting a solution.</p><p>Own Id: OTP-10748</p></li><li><p>Windows previously used three digit exponent in formatting which caused
difference between platforms, as can be seen by float_to_list/1. This has now
been fixed.</p><p>Own Id: OTP-10751</p></li></ul><h3 id="improvements-and-new-features-80" class="section-heading"><a href="#improvements-and-new-features-80" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>A boolean socket option 'ipv6_v6only' for IPv6 sockets has been added. The
default value of the option is OS dependent, so applications aiming to be
portable should consider using <code class="inline">{ipv6_v6only,true}</code> when creating an <code class="inline">inet6</code>
listening/destination socket, and if necessary also create an <code class="inline">inet</code> socket on
the same port for IPv4 traffic. See the documentation.</p><p>Own Id: OTP-8928 Aux Id: kunagi-193 [104]</p></li><li><p>It is now allowed to define stubs for BIFs, to allow type specs to be written
for BIFs. For example, if there is BIF called <a href="../../apps/stdlib/lists.html#member/2"><code class="inline">lists:member/2</code></a>, a dummy
definition of <a href="../../apps/stdlib/lists.html#member/2"><code class="inline">lists:member/2</code></a> is now allowed.</p><p>Own Id: OTP-9861</p></li><li><p>Process optimizations. The most notable:</p><ul><li>New internal process table implementation allowing for both parallel reads
as well as writes. Especially read operations have become really cheap. This
reduce contention in various situations. For example when, spawning
processes, terminating processes, sending messages, etc.</li><li>Optimizations of run queue management reducing contention.</li><li>Optimizations of process internal state changes reducing contention.</li></ul><p>These changes imply changes of the characteristics the system. Most notable:
changed timing in the system.</p><p>Own Id: OTP-9892 Aux Id: OTP-10167</p></li><li><p>Non-blocking code loading. Earlier when an Erlang module was loaded, all other
execution in the VM were halted while the load operation was carried out in
single threaded mode. Now modules are loaded without blocking the VM.
Processes may continue executing undisturbed in parallel during the entire
load operation. The load operation is completed by making the loaded code
visible to all processes in a consistent way with one single atomic
instruction. Non-blocking code loading will improve realtime characteristics
when modules are loaded/upgraded on a running SMP system.</p><p>Own Id: OTP-9974</p></li><li><p>In the SMP emulator, turning on and off tracing will no longer take down the
system to single-scheduling.</p><p>Own Id: OTP-10122</p></li><li><p>Remove VxWorks support</p><p>Own Id: OTP-10146</p></li><li><p>Added a general framework for executing benchmarks of Erlang/OTP. Benchmarks
for the Erlang VM and mnesia have been incorporated in the framework.</p><p>For details about how to add more benchmarks see $ERL_TOP/HOWTO/BENCHMARKS.md
in the source distribution.</p><p>Own Id: OTP-10156</p></li><li><p>Optimized deletion of ETS-tables which significantly improves performance when
large amounts of temporary tables are used.</p><p>This change imply changes of the characteristics the system. Most notable:
changed timing in the system.</p><p>Own Id: OTP-10167 Aux Id: OTP-9892</p></li><li><p>Tuple funs (deprecated in R15B) are no longer supported.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-10170</p></li><li><p>New internal header scheme for allocators</p><p>Impact: Reduces size on object allocated in multiblock carriers by one word</p><p>Own Id: OTP-10273 Aux Id: kunagi-20 [20]</p></li><li><p>Major port improvements. The most notable:</p><ul><li>New internal port table implementation allowing for both parallel reads as
well as writes. Especially read operations have become really cheap.This
reduce contention in various situations. For example when, creating ports,
terminating ports, etc.</li><li>Dynamic allocation of port structures. This allow for a much larger maximum
amount of ports allowed as a default. The previous default of 1024 has been
raised to 65536. Maximum amount of ports can be set using the
<a href="erl_cmd.html#%2BQ">+Q</a> command line flag of <a href="erl_cmd.html">erl(1)</a>. The
previously used environment variable <code class="inline">ERL_MAX_PORTS</code> has been deprecated and
scheduled for removal in OTP-R17.</li><li>Major rewrite of scheduling of port tasks. Major benefits of the rewrite are
reduced contention on run queue locks, and reduced amount of memory
allocation operations needed. The rewrite was also necessary in order to
make it possible to schedule signals from processes to ports.</li><li>Improved internal thread progress functionality for easy management of
unmanaged threads. This improvement was necessary for the rewrite of the
port task scheduling.</li><li>Rewrite of all process to port signal implementations in order to make it
possible to schedule those operations. All port operations can now be
scheduled which allows for reduced lock contention on the port lock as well
as truly asynchronous communication with ports.</li><li>Optimized lookup of port handles from drivers.</li><li>Optimized driver lookup when creating ports.</li><li>Preemptible <a href="erlang.html#ports/0"><code class="inline">erlang:ports/0</code></a> BIF.</li><li>Improving responsiveness by bumping reductions for a process calling a
driver callback directly.</li></ul><p>These changes imply changes of the characteristics of the system. The most
notable:</p><ul><li><p><strong>Order of signal delivery</strong> - The previous implementation of the VM has
delivered signals from processes to ports in a synchronous stricter fashion
than required by the language. As of ERTS version 5.10, signals are truly
asynchronously delivered. The order of signal delivery still adheres to the
requirements of the language, but only to the requirements. That is, some
signal sequences that previously always were delivered in one specific order
may now from time to time be delivered in different orders. This may cause
Erlang programs that have made <em>false assumptions</em> about signal delivery
order to fail even though they previously succeeded. For more information
about signal ordering guarantees, see the chapter on
<a href="communication.html">communication</a> in the ERTS user's guide. The <code class="inline">+n</code> command
line flag of <a href="erl_cmd.html">erl(1)</a> can be helpful when trying to find
signaling order bugs in Erlang code that have been exposed by these changes.</p></li><li><p><strong>Latency of signals sent from processes to ports</strong> - Signals from processes
to ports where previously always delivered immediately. This kept latency
for such communication to a minimum, but it could cause lock contention
which was very expensive for the system as a whole. In order to keep this
latency low also in the future, most signals from processes to ports are by
default still delivered immediately as long as no conflicts occur. Such
conflicts include not being able to acquire the port lock, but also include
other conflicts. When a conflict occur, the signal will be scheduled for
delivery at a later time. A scheduled signal delivery may cause a higher
latency for this specific communication, but improves the overall
performance of the system since it reduce lock contention between
schedulers. The default behavior of only scheduling delivery of these
signals on conflict can be changed by passing the <a href="erl_cmd.html#%2Bspp">+spp</a>
command line flag to <a href="erl_cmd.html">erl(1)</a>. The behavior can also be changed
on port basis using the <a href="erlang.html#open_port_parallelism">parallelism</a>
option of the <a href="erlang.html#open_port/2">open_port/2</a> BIF.</p></li><li><p><strong>Execution time of the <a href="erlang.html#ports/0"><code class="inline">erlang:ports/0</code></a> BIF</strong> - Since <a href="erlang.html#ports/0"><code class="inline">erlang:ports/0</code></a> now
can be preempted, the responsiveness of the system as a whole has been
improved. A call to <a href="erlang.html#ports/0"><code class="inline">erlang:ports/0</code></a> may, however, take a much longer time
to complete than before. How much longer time heavily depends on the system
load.</p></li><li><p><strong>Reduction cost of calling driver callbacks</strong> - Calling a driver callback
is quite costly. This was previously not reflected in reduction cost at all.
Since the reduction cost now has increased, a process performing lots of
direct driver calls will be scheduled out more frequently than before.</p></li></ul><p><em>Potential incompatibilities</em>:</p><ul><li><code class="inline">driver_send_term()</code> has been deprecated and has been scheduled for removal
in OTP-R17. Replace usage of <code class="inline">driver_send_term()</code> with usage of
<a href="erl_driver.html#erl_drv_send_term">erl_drv_send_term()</a>.</li><li><code class="inline">driver_output_term()</code> has been deprecated and has been scheduled for
removal in OTP-R17. Replace usage of <code class="inline">driver_output_term()</code> with usage of
<a href="erl_driver.html#erl_drv_output_term">erl_drv_output_term()</a>.</li><li>The new function
<a href="erl_driver.html#erl_drv_busy_msgq_limits">erl_drv_busy_msgq_limits()</a> has
been added in order to able to control management of port queues.</li></ul><p>The <a href="erl_driver.html#version_management">driver API version</a> has been bumped to
2.1 from 2.0 due to the above changes in the driver API.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-10336 Aux Id: OTP-9892</p></li><li><p>The experimental support for packages has been removed.</p><p>Own Id: OTP-10348 Aux Id: kunagi-316 [227]</p></li><li><p>Wrong parameters when setting seq_trace-tokens from within a trace-pattern
could crash the VM. This is now corrected.</p><p>Own Id: OTP-10522</p></li><li><p>Erlang specification 4.7.3 defines max tuple size to 65535 elements It is now
enforced to no more than 16777215 elements (arity 24 bits)</p><p>Previous edge cases (28 bits) were not validated and could cause undefined
behaviour.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-10633</p></li><li><p>Add insert_element/3 and delete_element/2</p><p>Own Id: OTP-10643</p></li><li><p>The previous default of a maximum of 32768 simultaneous processes has been
raised to 262144. This value can be changed using the <a href="erl_cmd.html#%2BP">+P</a>
command line flag of <a href="erl_cmd.html">erl(1)</a>. Note that the value passed now is
considered as a hint, and that actual value chosen in most cases will be a
power of two.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-10647 Aux Id: OTP-9892, OTP-10336</p></li><li><p>The previously (in R15) proposed scheduler wakeup strategy is now used by
default. This strategy is not as quick to forget about previous overload as
the previous strategy.</p><p>This change imply changes of the characteristics the system. Most notable:
When a small overload comes and then disappears repeatedly, the system will
for a bit longer time be willing to wake up schedulers than before. Timing in
the system will due to this also change.</p><p>The previous strategy can still be enabled by passing the
<a href="erl_cmd.html#%2Bsws">+sws legacy</a> command line flag to <code class="inline">erl</code>.</p><p>Own Id: OTP-10661 Aux Id: OTP-10033</p></li><li><p>The <a href="erl_cmd.html#%2Bstbt">+stbt</a> command line argument of <code class="inline">erl</code> was added.
This argument can be used for trying to set scheduler bind type. Upon failure
unbound schedulers will be used.</p><p>Own Id: OTP-10668</p></li><li><p>Support ANSI in console</p><p>Unix platforms will no longer filter control sequences to the ttsl driver thus
enabling ANSI and colors in console. (Thanks to Pedram Nimreezi)</p><p>Own Id: OTP-10678</p></li><li><p>Add file:allocate/3 operation</p><p>This operation allows pre-allocation of space for files. It succeeds only on
systems that support such operation. (Thanks to Filipe David Manana)</p><p>Own Id: OTP-10680</p></li><li><p>Treat <code class="inline">-Wreturn-type</code> warnings as error when using GCC (Thanks to Tuncer Ayaz)</p><p>Own Id: OTP-10683</p></li><li><p>Implement ./otp_build configure --enable-silent-rules</p><p>With silent rules, the output of make is less verbose and compilation warnings
are easier to spot. Silent rules are disabled by default and can be disabled
or enabled at will by make V=0 and make V=1. (Thanks to Anthony Ramine)</p><p>Own Id: OTP-10726</p></li><li><p>Use share flags for all file operations on Windows. Thanks to Filipe David
Borba Manana.</p><p>Own Id: OTP-10727</p></li><li><p>Make/fakefop adjustments. Thanks to Tuncer Ayaz and Sebastian Rasmussen.</p><p>Own Id: OTP-10733</p></li><li><p>The runtime system will now by default use 10 async threads if thread support
has been enabled when building the runtime system.</p><p>This will prevent long blocking file-operations from blocking scheduler
threads for long periods of time, which can be harmful. Apart from
file-operations, it also effects other operations scheduled on the async
thread pool by user implemented drivers.</p><p>The amount of async threads can be controlled by using the
<a href="erl_cmd.html#async_thread_pool_size"><code class="inline">+A</code></a> command line argument of
<a href="erl_cmd.html">erl</a>. When running some offline tools you <em>might</em> want to disable
async threads, but you are advised <em>not</em> to in the general case. Instead, you
might want to increase the amount of async threads used.</p><p>This change imply changes of the characteristics the system compared to the
previous default. The responsiveness of the system as a whole will be
improved. Operations scheduled on the async thread pool will get an increased
latency. The throughput of these operations may increase, or decrease
depending on the type of the operations and how they get scheduled. In the
case of file operations, the throughput very much depends on how the Erlang
application access files. Multiple concurrent accesses to different files have
the potential of an increased throughput.</p><p>Own Id: OTP-10736</p></li><li><p>The default reader group limit has been increased to 64 from 8. This limit can
be set using the <code class="inline">+rg</code> command line argument of <a href="erl_cmd.html">erl</a>.</p><p>This change of default value will reduce lock contention on ETS tables using
the <code class="inline">read_concurrency</code> option at the expense of memory consumption when the
amount of schedulers and logical processors are between 8 and 64. For more
information, see documentation of the <code class="inline">+rg</code> command line argument of
<a href="erl_cmd.html">erl</a>.</p><p>Own Id: OTP-10737</p></li><li><p>New BIF float_to_list/2 which solves a problem of float_to_list/1 that doesn't
allow specifying the number of digits after the decimal point when formatting
floats (Thanks to Serge Aleynikov).</p><p>Own Id: OTP-10752</p></li><li><p>Limited support for unicode atoms in the external format and in the internal
representation of the vm. This is a preparative feature in order to support
communication with future releases of Erlang/OTP that may create unicode
atoms.</p><p>Own Id: OTP-10753</p></li><li><p>Increased potential concurrency in ETS for <code class="inline">write_concurrency</code> option. The
number of internal table locks has increased from 16 to 64. This makes it four
times less likely that two concurrent processes writing to the same table
would collide and thereby serialized. The cost is an increased constant memory
footprint for tables using write_concurrency. The memory consumption per
inserted record is not affected. The increased footprint can be particularly
large if <code class="inline">write_concurrency</code> is combined with <code class="inline">read_concurrency</code>.</p><p>Own Id: OTP-10787</p></li></ul><h2 id="erts-5-9-3-1" class="section-heading"><a href="#erts-5-9-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.9.3.1</span></h2><h3 id="known-bugs-and-problems-2" class="section-heading"><a href="#known-bugs-and-problems-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Known Bugs and Problems</span></h3><ul><li><p>Create an erl_crash.dump if no heart exists and no ERL_CRASH_DUMP_SECONDS is
set (behaviour changed).</p><p>Don't create an erl_crash.dump if heart do exists and no
ERL_CRASH_DUMP_SECONDS is set (behaviour not changed).</p><p>This changes the behaviour back to the R15B02 default considering if a beam
was running with no heart.</p><p>Own Id: OTP-10602</p></li></ul><h2 id="erts-5-9-3" class="section-heading"><a href="#erts-5-9-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.9.3</span></h2><h3 id="fixed-bugs-and-malfunctions-304" class="section-heading"><a href="#fixed-bugs-and-malfunctions-304" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix linking in OpenBSD. (Thanks to Matthew Dempsky)</p><p>Own Id: OTP-10395</p></li><li><p>Fix bug causing fallback atomics to be used even though healthy gcc atomics or
libatomic_ops was detected.</p><p>Own Id: OTP-10418</p></li><li><p>Ensure 'erl_crash.dump' when asked for it. This will change erl_crash.dump
behaviour.</p><p>* Not setting ERL_CRASH_DUMP_SECONDS will now terminate beam immediately on a
crash without writing a crash dump file.</p><p>* Setting ERL_CRASH_DUMP_SECONDS to 0 will also terminate beam immediately on
a crash without writing a crash dump file, i.e. same as not setting
ERL_CRASH_DUMP_SECONDS environment variable.</p><p>* Setting ERL_CRASH_DUMP_SECONDS to a negative value will let the beam wait
indefinitely on the crash dump file being written.</p><p>* Setting ERL_CRASH_DUMP_SECONDS to a positive value will let the beam wait
that many seconds on the crash dump file being written.</p><p>A positive value will set an alarm/timeout for restart both in beam and in
heart if heart is running.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-10422 Aux Id: kunagi-250 [161]</p></li><li><p>Fix bug where MSVRT100.dll was not included in the windows installer.</p><p>Own Id: OTP-10481</p></li><li><p>In the expression <code class="inline">&lt;&lt;Bin/binary,...&gt;&gt;</code>, if <code class="inline">Bin</code> was a bitstring with a size
not a multiple of 8, either no exception was generated or an incorrect
exception was generated. (Thanks to Adam Rutkowski for reporting this bug.)</p><p>Own Id: OTP-10524</p></li><li><p>The runtime system could crash while scheduling a port task. The port task was
scheduled either due to an external I/O event being triggered, a driver
timeout being triggered, or data being sent over a distribution channel.</p><p>Own Id: OTP-10556</p></li><li><p><code class="inline">erlang:memory(ets)</code> erroneously included the size of each ETS-table main
structure twice.</p><p>Own Id: OTP-10558</p></li><li><p>Fix compile error in generated file hipe_amd64_bifs.S for Solaris.</p><p>Own Id: OTP-10577</p></li><li><p>A faulty spec for process_info/2 could cause false dialyzer warnings. The spec
is corrected.</p><p>Own Id: OTP-10584</p></li><li><p>In very rare cases, the VM could crash if a garbage collector was called while
executing an appending bit syntax instruction. The symptom was a core when
reallocating memory in the function erts_bs_append. The garbage collector bug
is now corrected.</p><p>Own Id: OTP-10590</p></li></ul><h3 id="improvements-and-new-features-81" class="section-heading"><a href="#improvements-and-new-features-81" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Improve support for building and testing in embedded ppc environments.</p><p>Own Id: OTP-10265 Aux Id: kunagi-159 [daf97f67-5724-4812-a5b6-7e86990133d2-1]</p></li><li><p>Due to a race condition on Windows, sometimes when printing to standard output
and then immediately terminating erlang all data would not be printed. The
emulator now waits for all data to be printed before exiting.</p><p>Own Id: OTP-10325 Aux Id: kunagi-166 [dd72d0e2-3e76-4a51-8b56-7564e24eecae]</p></li><li><p>The frequency with which sleeping schedulers are woken due to outstanding
memory deallocation jobs has been reduced.</p><p>Own Id: OTP-10476 Aux Id: OTP-10162</p></li><li><p>Clearer warnings about the dangers of misuse of
<a href="erl_nif.html#WARNING">native functions</a> and <a href="erl_driver.html#WARNING">drivers</a>
have been added to the documentation.</p><p>Own Id: OTP-10557</p></li></ul><h2 id="erts-5-9-2" class="section-heading"><a href="#erts-5-9-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.9.2</span></h2><h3 id="fixed-bugs-and-malfunctions-305" class="section-heading"><a href="#fixed-bugs-and-malfunctions-305" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix erl_prim_loader errors in handling of primary archive. The following
errors have been corrected:</p><ul><li>If primary archive was named &quot;xxx&quot;, then a file in the same directory named
&quot;xxxyyy&quot; would be interpreted as a file named &quot;yyy&quot; inside the archive.</li><li>erl_prim_loader did not correctly create and normalize absolute paths for
primary archive and files inside it, so unless given with exact same path
files inside the archive would not be found. E.g. if escript was started as
/full/path/to/xxx then &quot;./xxx/file&quot; would not be found since erl_prim_loader
would try to match /full/path/to/xxx with /full/path/to/./xxx. Same problem
with ../.</li><li>Depending on how the primary archive was built, erl_prim_loader:list_dir/1
would sometimes return an empty string inside the file list. This was a
virtual element representing the top directory of the archive. This has been
removed.</li></ul><p>Thanks to Tuncer Ayaz and Shunichi Shinohara for reporting and co-authoring
corrections.</p><p>Own Id: OTP-10071</p></li><li><p>Fix: Add port-I/O statistics for active once and true and not only active
false.</p><p>Own Id: OTP-10073</p></li><li><p>The 64-bit windows installer did not look in the right directories for 64-bit
version of Microsoft Visual C++ 2010 Redistibutable Package and hence took the
wrong decision about having to install the redistributable package if the
32-bit version was installed but not the 64-bit and vice versa. This bug has
now been fixed Furthermore the sub-installer for the redistributable package
is now run in silent mode if the erlang installer is.</p><p>Own Id: OTP-10096</p></li><li><p>epmd would fail to start automatically when starting a distributed erlang node
installed in a location with a whitespace in the path.</p><p>Own Id: OTP-10106</p></li><li><p>A more or less harmless bug that sometimes caused memory deallocations to be
delayed longer than intended has been fixed.</p><p>Own Id: OTP-10116</p></li><li><p>Fix bug causing emulator crash when running HiPE on ARM. Bug has existed since
R15B.</p><p>Own Id: OTP-10137</p></li><li><p>A bug regarding spaces in C function prototypes has been fixed. (Thanks to
Richard O'Keefe.)</p><p>Own Id: OTP-10138</p></li><li><p>Corrected dtrace pid length in message related probes. (Thanks to Zheng Siyao)</p><p>Own Id: OTP-10142</p></li><li><p>Correct formatting in exit error messages</p><p>Ensure displayed sizes are not negative. (Thanks to Michael Santos)</p><p>Own Id: OTP-10148</p></li><li><p>fix escript/primary archive reloading</p><p>If the mtime of an escript/primary archive file changes after being added to
the code path, correctly reload the archive and update the cache. (Thanks to
Tuncer Ayaz)</p><p>Own Id: OTP-10151</p></li><li><p>Doc fix: link from erlang:now/0 to os:timestamp/0</p><p>Sometimes os:timestamp/0 is more appropriate than erlang:now/0. The
documentation for the former has a link to the latter; this patch adds a link
in the other direction to make os:timestamp/0 more visible. Thanks to Magnus
Henoch</p><p>Own Id: OTP-10180</p></li><li><p>The caret in the werl window (on Windows) could appear at the wrong place
after regaining focus. This is now corrected.</p><p>Own Id: OTP-10181</p></li><li><p>Fix bug that in some cases could cause corrupted binaries in ETS tables with
<code class="inline">compressed</code> option.</p><p>Own Id: OTP-10182</p></li><li><p>Fix use of &quot;clever&quot; mktime</p><p>Commit 1eef765 introduced regression (conditional _always_ evaluates to
true) in which erlang:localtime_to_universaltime/2 stopped working on systems
configured with timezone without DST (i.e. UTC) on *BSD platforms: 1&gt;
erlang:localtime_to_universaltime({{2012,1,1},{0,0,0}}, true). **
exception error: bad argument Thanks to Piotr Sikora</p><p>Own Id: OTP-10187</p></li><li><p>Relocate bodies of DTrace probes to the statically-linked VM.</p><p>Due to various operating systems (in both the DTrace and SystemTap worlds) not
fully supporting DTrace probes (or SystemTap-compatibility mode probes) in
shared libraries, we relocate those probes to the statically-linked virtual
machine. This could be seen as pollution of the pristine VM by a (yet)
experimental feature. However:</p><p>1. This code can be eliminated completely by the C preprocessor. 2. Leaving
the probes in the dyntrace NIF shared library simply does not work correctly
on too many platforms. <em>Many</em> thanks to Macneil Shonle at Basho for assisting
when my RSI-injured fingers gave out. (note: Solaris 10 and FreeBSD
9.0-RELEASE can take a long time to compile)</p><p>Own Id: OTP-10189</p></li><li><p>Fix bug in <a href="../../apps/stdlib/ets.html#test_ms/2"><code class="inline">ets:test_ms/2</code></a> that could cause emulator crash when using <code class="inline">'$_'</code>
in match spec.</p><p>Own Id: OTP-10190</p></li><li><p>Supplying a filename longer than the operating system MAX_PATH to
file:read_link/1 would cause a crash (Segemntation fault/Critical Error) on
all platforms. This is now corrected.</p><p>Own Id: OTP-10200</p></li><li><p>If Perl was configured to interpret files as being encoded in UTF-8, the build
would crash in <code class="inline">make_preload</code>. (Thanks to Aaron Harnly for noticing this
issue.)</p><p>Own Id: OTP-10201</p></li><li><p>Fix the erlc -MP flag</p><p>Because of a copy-and-paste error in erlc.c, the -MP flag had the same effect
as -MG. As a workaround, you had to pass +makedep_phony to enable the MP
option. This patch makes -MP work as intended.</p><p>Own Id: OTP-10211</p></li><li><p>Allow mixed IPv4 and IPv6 addresses to sctp_bindx</p><p>Also allow mixed address families to bind, since the first address on a
multihomed sctp socket must be bound with bind, while the rest are to be bound
using sctp_bindx. At least Linux supports adding address of mixing families.
Make inet_set_faddress function available also when HAVE_SCTP is not defined,
since we use it to find an address for bind to be able to mix ipv4 and ipv6
addresses. Thanks to Tomas Abrahamsson</p><p>Own Id: OTP-10217</p></li><li><p>Fix support for leap seconds-aware timezones</p><p>erlang:universaltime_to_localtime is leap seconds-aware (since 2008), however
erlang:localtime_to_universaltime is not, which gives surprising results on
systems configured with leap seconds-aware timezones: 1&gt;
erlang:universaltime_to_localtime({{2012,1,1},{0,0,0}}).
{{2012,1,1},{0,0,0}} 2&gt;
erlang:localtime_to_universaltime({{2012,1,1},{0,0,0}}).
{{2012,1,1},{0,0,24}} and completely breaks
calendar:local_time_to_universal_time_dst: 3&gt;
calendar:local_time_to_universal_time_dst({{2011,1,1},{0,0,0}}). []
Thanks to Piotr Sikora</p><p>Own Id: OTP-10227</p></li><li><p>erlsrv: gracefully stop emulator on Windows shutdown</p><p>Windows will send the SERVICE_CONTROL_SHUTDOWN event to the service control
handler when shutting down the system. Instead of ignoring the event, erlsrv
will now invoke the stop action. Likewise, the Erlang emulator (and it's po
drivers) must not quit upon reception of the CTRL_SHUTDOWN_EVENT event in th
console control handler. Thanks to Jan Kloetzke</p><p>Own Id: OTP-10228</p></li><li><p>Fix dtrace bug in file rename operation.</p><p>Own Id: OTP-10234</p></li><li><p>Fix bug in memory management of driver port data locks (PDL). In some cases
PDLs could be deallocated before <code class="inline">ready_async</code> or <code class="inline">async_free</code> callback was
called.</p><p>Own Id: OTP-10249</p></li></ul><h3 id="improvements-and-new-features-82" class="section-heading"><a href="#improvements-and-new-features-82" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Add port and suspend options to lock-counter profiling. (Thanks to Rick Reed)</p><p>Own Id: OTP-10051</p></li><li><p>Latency when using the active_once option in gen_tcp communication is reduced.</p><p>Own Id: OTP-10055 Aux Id: sto139</p></li><li><p>Remove bit8 option support from inet</p><p>Own Id: OTP-10056</p></li><li><p>The OS Pid of a port program is now available by calling
erlang:port_info(Port,os_pid), Thanks to Matthias Lang for the original patch.</p><p>Own Id: OTP-10057</p></li><li><p>Fix openpty usage in run_erl.</p><p>Reopening a slave file descriptor which was closed earlier could lead to a
misbehaving connection. This has now been remedied.</p><p>Own Id: OTP-10076</p></li><li><p>Remove all code, documentation, options and diagnostic functions which were
related to the experimental hybrid heap implementation.</p><p>Own Id: OTP-10105</p></li><li><p>Optimizations of memory deallocations.</p><p>Own Id: OTP-10162 Aux Id: OTP-7775</p></li><li><p>Optimization of process locking.</p><p>Own Id: OTP-10163</p></li><li><p>Added a xcomp example file for powerpc-dso-linux-gnu</p><p>Own Id: OTP-10198</p></li><li><p>Detect when middle endian doubles are used by a platform and account for it
when decoding floats. (Thanks to Mike Sperber)</p><p>Own Id: OTP-10209</p></li></ul><h2 id="erts-5-9-1-2" class="section-heading"><a href="#erts-5-9-1-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.9.1.2</span></h2><h3 id="fixed-bugs-and-malfunctions-306" class="section-heading"><a href="#fixed-bugs-and-malfunctions-306" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>On Linux systems using heart (erl -heart) and a HEAR_BEAT_TIMEOUT less than
default, heart could fire even though Erlang was running fine after approx 298
to 497 days (depending on kernel config). This was due to the behaviour of the
times(2) system call. Usage of times(2) is now replaced with clock_gettime(2)
and the CLOCK_MONOTONIC clock, resulting in a more stable solution. The Erlang
VM itself has used clock_gettime(2) on linux since before R12B, so this only
affects the heart program.</p><p>Own Id: OTP-10111 Aux Id: seq12075</p></li></ul><h2 id="erts-5-9-1-1" class="section-heading"><a href="#erts-5-9-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.9.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-307" class="section-heading"><a href="#fixed-bugs-and-malfunctions-307" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>If threads support for the runtime system had been disabled at compile time
(<code class="inline">--disable-threads</code> had been passed to <code class="inline">configure</code>), and the <code class="inline">+A</code> command
line argument of <code class="inline">erl</code> was passed when starting the runtime system,
<a href="erl_driver.html#driver_system_info">driver_system_info()</a> erroneously claimed
that the runtime system had async threads even though it had not.</p><p>Due to this bug the file driver did not split tasks into smaller chunks, but
instead completed the whole task at once, i.e., the scheduler got occupied
with I/O for a longer time than intended.</p><p>Own Id: OTP-10059</p></li></ul><h3 id="improvements-and-new-features-83" class="section-heading"><a href="#improvements-and-new-features-83" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>A proposal for a new scheduler wakeup strategy has been implemented. For more
information see the documentation of the <a href="erl_cmd.html#%2Bsws">+sws</a> command
line argument of <code class="inline">erl</code>.</p><p>Own Id: OTP-10033 Aux Id: Seq12025</p></li><li><p>A switch for configuration of busy wait length for scheduler threads has been
added. For more information see the documentation of the
<a href="erl_cmd.html#%2Bsbwt">+sbwt</a> command line argument of <code class="inline">erl</code>.</p><p>Own Id: OTP-10044 Aux Id: Seq11976</p></li><li><p>The extra memory barriers introduced by bug-fix OTP-9281 were unnecessarily
used also on tables without the <code class="inline">write_concurrency</code> option enabled. This could
unnecessarily degrade performance of ETS tables without <code class="inline">write_concurrency</code> on
some hardware (e.g. PowerPC) while not effecting performance at all on other
hardware (e.g. x86/x86_64).</p><p>OTP-9281 (R14B03): ETS tables using the <code class="inline">write_concurrency</code> option could
potentially get into an internally inconsistent state.</p><p>Own Id: OTP-10048 Aux Id: OTP-9281</p></li></ul><h2 id="erts-5-9-1" class="section-heading"><a href="#erts-5-9-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.9.1</span></h2><h3 id="fixed-bugs-and-malfunctions-308" class="section-heading"><a href="#fixed-bugs-and-malfunctions-308" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><code class="inline">erlang:system_profile</code> erroneous profiled the profiler process when observing
runnable processes. This has been corrected.</p><p>Own Id: OTP-9849</p></li><li><p>Calling trace_info/2 asking for information about a function that had native
could crash the run-time system.</p><p>Own Id: OTP-9886</p></li><li><p>reduce smp locking time range in erts_garbage_collect (thanks to Jovi Zhang)</p><p>Own Id: OTP-9912</p></li><li><p>Fix typo in supervisor behaviour doc (Thanks to Ricardo Catalinas JimÃ©nez)</p><p>Own Id: OTP-9924</p></li><li><p>Correct spelling of registered (Thanks to Richard Carlsson)</p><p>Own Id: OTP-9925</p></li><li><p>erts: Remove unused variable (Thanks to Jovi Zhang)</p><p>Own Id: OTP-9926</p></li><li><p>Fix bug in ETS with <code class="inline">compressed</code> option and insertion of term containing large
integers (&gt;2G) on 64-bit machines. Seen to cause emulator crash. (Thanks to
Diego Llarrull for excellent bug report)</p><p>Own Id: OTP-9932</p></li><li><p>Handle Linux OS where /sys/devices/system/node is only readable by root.
Fallback to /sys/devices/system/cpu for topology info.</p><p>Own Id: OTP-9978</p></li><li><p>When an escript ends now all printout to standard output and standard error
gets out on the terminal. This bug has been corrected by changing the
behaviour of erlang:halt/0,1, which should fix the same problem for other
escript-like applications, i.e that data stored in the output port driver
buffers got lost when printing on a TTY and exiting through erlang:halt/0,1.</p><p>The BIF:s erlang:halt/0,1 has gotten improved semantics and there is a new BIF
erlang:halt/2 to accomplish something like the old semantics. See the
documentation.</p><p>Now erlang:halt/0 and erlang:halt/1 with an integer argument will close all
ports and allow all pending async threads operations to finish before exiting
the emulator. Previously erlang:halt/0 and erlang:halt(0) would just wait for
pending async threads operations but not close ports. And erlang:halt/1 with a
non-zero integer argument would not even wait for pending async threads
operations.</p><p>To roughly the old behaviour, to not wait for ports and async threads
operations when you exit the emulator, you use erlang:halt/2 with an integer
first argument and an option list containing {flush,false} as the second
argument. Note that now is flushing not dependent of the exit code, and you
cannot only flush async threads operations which we deemed as a strange
behaviour anyway.</p><p>Also, erlang:halt/1,2 has gotten a new feature: If the first argument is the
atom 'abort' the emulator is aborted producing a core dump, if the operating
system so allows.</p><p>Own Id: OTP-9985</p></li><li><p>Added check to inet driver to avoid building on operating systems that do not
yet have IPv6 compatible socket API. (Thanks to Peer Stritzinger)</p><p>Own Id: OTP-9996</p></li><li><p>Fix bug when the number of CPUs actually found is lower than the configured
value. (Thanks to Benjamin Herrenschmidt)</p><p>Own Id: OTP-10004</p></li><li><p>The runtime system without SMP support and without thread support erroneously
busy waited when no work was present. This bug first appeared in <code class="inline">erts-5.9</code>.</p><p>Own Id: OTP-10019</p></li><li><p>Various typographical errors corrected in documentation for common_test,
driver, erl_driver and windows installation instructions. (Thanks to Tuncer
Ayaz)</p><p>Own Id: OTP-10037</p></li><li><p>Fix memory leak caused by race on exiting process</p><p>Own Id: OTP-10041</p></li></ul><h3 id="improvements-and-new-features-84" class="section-heading"><a href="#improvements-and-new-features-84" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Add <code class="inline">erlang:statistics(scheduler_wall_time)</code> to ensure correct determination
of scheduler utilization. Measuring scheduler utilization is strongly
preferred over CPU utilization, since CPU utilization gives very poor
indications of actual scheduler/vm usage.</p><p>Own Id: OTP-9858</p></li><li><p>ERTS internal API improvements. In some cases the amount of atomic read
operations needed have been reduced due to this.</p><p>Own Id: OTP-9922</p></li><li><p>The DTrace source patch from Scott Lystig Fritchie is integrated in the source
tree. Using an emulator with dtrace probe is still not supported for
production use, but may be a valuable debugging tool. Configure with
--with-dynamic-trace=dtrace (or --with-dynamic-trace=systemtap) to create a
build with dtrace probes enabled. See runtime_tools for documentation and
examples.</p><p>Own Id: OTP-10017</p></li></ul><h3 id="known-bugs-and-problems-3" class="section-heading"><a href="#known-bugs-and-problems-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Known Bugs and Problems</span></h3><ul><li><p>enif_make_copy may invalidate enif_inspect_binary.</p><p>Own Id: OTP-9828</p></li></ul><h2 id="erts-5-9-0-1" class="section-heading"><a href="#erts-5-9-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.9.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-309" class="section-heading"><a href="#fixed-bugs-and-malfunctions-309" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A feature test for the <code class="inline">lwsync</code> instruction performed on PowerPC hardware at
runtime system startup got into an eternal loop if the instruction was not
supported. This bug was introduced in erts-5.9/OTP-R15B.</p><p>Own Id: OTP-9843</p></li><li><p>I/O events could potentially be delayed for ever when enabling kernel-poll on
a non-SMP runtime system executing on Solaris. When also combined with
async-threads the runtime system hung before completing the boot phase. This
bug was introduced in erts-5.9/OTP-R15B.</p><p>Own Id: OTP-9844</p></li></ul><h2 id="erts-5-9" class="section-heading"><a href="#erts-5-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.9</span></h2><h3 id="fixed-bugs-and-malfunctions-310" class="section-heading"><a href="#fixed-bugs-and-malfunctions-310" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Honor option <code class="inline">packet_size</code> for http packet parsing by both TCP socket and
<code class="inline">erlang:decode_packet</code>. This gives the ability to accept HTTP headers larger
than the default setting, but also avoid DoS attacks by accepting lines only
up to whatever length you wish to allow. For consistency, packet type <code class="inline">line</code>
also honor option <code class="inline">packet_size</code>. (Thanks to Steve Vinoski)</p><p>Own Id: OTP-9389</p></li><li><p>A few contracts in the <code class="inline">lists</code> module have been corrected.</p><p>Own Id: OTP-9616</p></li><li><p>The Unicode noncharacter code points 16#FFFE and 16#FFFE were not allowed to
be encoded or decoded using the <code class="inline">unicode</code> module or bit syntax. That was
inconsistent with the other noncharacters 16#FDD0 to 16#FDEF that could be
encoded/decoded. To resolve the inconsistency, 16#FFFE and 16#FFFE can now be
encoded and decoded. (Thanks to Alisdair Sullivan.)</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-9624</p></li><li><p>Make epp search directory of current file first when including another file
This completes a partial fix in R11 that only worked for include_lib().
(Thanks to Richard Carlsson)</p><p>Own Id: OTP-9645</p></li><li><p>Fixed memory leak in <code class="inline">enif_inspect_io_list_as_binary</code> when applied on a
process independent environment.</p><p>Own Id: OTP-9668</p></li><li><p>The number of beam catches allowed in code are no longer statically defined
and will grow according to its need.</p><p>Own Id: OTP-9692</p></li><li><p>Add missing parenthesis in heart doc.</p><p>Add missing spaces in the Reference Manual distributed section.</p><p>In the HTML version of the doc those spaces are necessary to separate those
words.</p><p>Own Id: OTP-9693</p></li><li><p>Fixes module erlang doc style: option description (Thanks to Ricardo Catalinas
JimÃ©nez)</p><p>Own Id: OTP-9697</p></li><li><p>Specifying a scope to binary:match/3 when using multiple searchstrings
resulted in faulty return values. This is now corrected.</p><p>Own Id: OTP-9701</p></li><li><p>The runtime system crashed if more than one thread tried to exit the runtime
system at the same time.</p><p>Own Id: OTP-9705</p></li><li><p>Fix documentation for erlang:process_flag/2</p><p>For the subsection about process_flag(save_calls, N) there's an unrelated
paragraph about process priorities which was copied from the preceding
subsection regarding process_flag(priority, Level). (Thanks to Filipe David
Manana)</p><p>Own Id: OTP-9714</p></li><li><p>Calls to <code class="inline">erlang:system_flag(schedulers_online, N)</code> and/or
<code class="inline">erlang:system_flag(multi_scheduling, block|unblock)</code> could cause internal
data used by this functionality to get into an inconsistent state. When this
happened various problems occurred. This bug was quite hard to trigger, so
hopefully no-one has been effected by it.</p><p>A spinlock used by the run-queue management sometimes got heavily contended.
This code has now been rewritten, and the spinlock has been removed.</p><p>Own Id: OTP-9727</p></li><li><p>Use libdlpi to get physical address (Thanks to Trond Norbye)</p><p>Own Id: OTP-9818</p></li></ul><h3 id="improvements-and-new-features-85" class="section-heading"><a href="#improvements-and-new-features-85" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>An option list argument can now be passed to
<code class="inline">file:read_file_info/2, file:read_link_info/2</code> and <a href="../../apps/kernel/file.html#write_file_info/3"><code class="inline">file:write_file_info/3</code></a>
and set time type information in the call. Valid options are
<code class="inline">{time, local}, {time, universal}</code> and <code class="inline">{time, posix}</code>. In the case of <code class="inline">posix</code>
time no conversions are made which makes the operation a bit faster.</p><p>Own Id: OTP-7687</p></li><li><p>A number of memory allocation optimizations have been implemented. Most
optimizations reduce contention caused by synchronization between threads
during allocation and deallocation of memory. Most notably:</p><ul><li>Synchronization of memory management in scheduler specific allocator
instances has been rewritten to use lock-free synchronization.</li><li>Synchronization of memory management in scheduler specific pre-allocators
has been rewritten to use lock-free synchronization.</li><li>The 'mseg_alloc' memory segment allocator now use scheduler specific
instances instead of one instance. Apart from reducing contention this also
ensures that memory allocators always create memory segments on the local
NUMA node on a NUMA system.</li></ul><p>Own Id: OTP-7775</p></li><li><p>The ethread atomic memory operations API used by the runtime system has been
extended and improved.</p><p>The ethread library now also performs runtime tests for presence of hardware
features, such as for example SSE2 instructions, instead of requiring this to
be determined at compile time.</p><p>All uses of the old deprecated atomic API in the runtime system have been
replaced with the use of the new atomic API. In a lot of places this change
imply a relaxation of memory barriers used.</p><p>Own Id: OTP-9014</p></li><li><p>gen_sctp:open/0-2 may now return {error,eprotonosupport} if SCTP is not
supported</p><p>gen_sctp:peeloff/1 has been implemented and creates a one-to-one socket which
also are supported now</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-9239</p></li><li><p>Sendfile has been added to the file module's API. sendfile/2 is used to read
data from a file and send it to a tcp socket using a zero copying mechanism if
available on that OS.</p><p>Thanks to Tuncer Ayaz and Steve Vinovski for original implementation</p><p>Own Id: OTP-9240</p></li><li><p>enif_get_reverse_list function added to nif API. This function should be used
to reverse small lists which are deep within other structures making it
impractical to do the reverse in Erlang.</p><p>Own Id: OTP-9392</p></li><li><p>The deprecated concat_binary/1 BIF has been removed. Use <code class="inline">list_to_binary</code> or
<a href="erlang.html#iolist_to_binary/1"><code class="inline">iolist_to_binary/1</code></a> instead.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-9421</p></li><li><p>Erlang/OTP can now be built using parallel make if you limit the number of
jobs, for instance using '<code class="inline">make -j6</code>' or '<code class="inline">make -j10</code>'. '<code class="inline">make -j</code>' does not
work at the moment because of some missing dependencies.</p><p>Own Id: OTP-9451</p></li><li><p>Line number and filename information are now included in exception backtraces
as a fourth element in the MFA tuple. The information will be pretty-printed
by the shell and used by <code class="inline">common_test</code> to provide better indication of where a
test case.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-9468</p></li><li><p>All binary constants used to be handled as heap binaries (i.e. the entire
binary would be copied when sent to another process). Binary constants larger
than 64 bytes are now refc binaries (i.e. the actual data in the binary will
not be copied when sent to another process).</p><p>Own Id: OTP-9486</p></li><li><p>If a float and an integer is compared, the integer is only converted to a
float if the float datatype can contain it. Otherwise the float is converted
to an integer.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-9497</p></li><li><p>Add NIF function enif_is_number</p><p>This function allows for easily determining if a term represents or not a
number (integer, float, small or big).(Thanks to Filipe David Manana)</p><p>Own Id: OTP-9629</p></li><li><p>The ERTS internal system block functionality has been replaced by new
functionality for blocking the system. The old system block functionality had
contention issues and complexity issues. The new functionality piggy-backs on
thread progress tracking functionality needed by newly introduced lock-free
synchronization in the runtime system. When the functionality for blocking the
system isn't used, there is more or less no overhead at all. This since the
functionality for tracking thread progress is there and needed anyway.</p><p>Own Id: OTP-9631</p></li><li><p>An ERTS internal, generic, many to one, lock-free queue for communication
between threads has been introduced. The many to one scenario is very common
in ERTS, so it can be used in a lot of places in the future. Currently it is
used by scheduling of certain jobs, and the async thread pool, but more uses
are planned for the future.</p><p>Drivers using the driver_async functionality are not automatically locked to
the system anymore, and can be unloaded as any dynamically linked in driver.</p><p>Scheduling of ready async jobs is now also interleaved in between other jobs.
Previously all ready async jobs were performed at once.</p><p>Own Id: OTP-9632</p></li><li><p>Tuple funs (a two-element tuple with a module name and a function) are now
officially deprecated and will be removed in R16. Use '<code class="inline">fun M:F/A</code>' instead.
To make you aware that your system uses tuple funs, the very first time a
tuple fun is applied, a warning will be sent to the error logger.</p><p>Own Id: OTP-9649</p></li><li><p>Changed the internal BIF calling convention. Will make simpler faster code and
allow BIFs with an arbitrary arity.</p><p>Own Id: OTP-9662</p></li><li><p>Windows native critical sections are now used internally in the runtime system
on Windows as mutex implementation. This since they perform better under
extreme contention than our own implementation.</p><p>Own Id: OTP-9671</p></li><li><p>Convert some erl_nif macros into inline functions. Allow for better compile
time type checking. (Thanks to Tuncer Ayaz)</p><p>Own Id: OTP-9675</p></li><li><p>The <code class="inline">+scl</code> command line flag has been added. It can be used for disabling
compaction of scheduler load. For more information see the <a href="erl_cmd.html">erl</a>
documentation.</p><p>Own Id: OTP-9695</p></li><li><p>The build system has been updated so that Erlang/OTP can be built on Mac OS X
Lion systems without a GCC compiler. The INSTALL guide has been updated with
instructions on how to install a GCC compiler and build Erlang/OTP with it, in
order to get a run-time system with better performance.</p><p>Own Id: OTP-9712</p></li><li><p>When loading a module, the system use to run on a single scheduler during the
entire loading process. This has been changed to only take down the system
just before inserting the loaded code into the system tables, resulting in a
much shorter disruption if a module is loaded in a busy system. (Suggested by
Bob Ippolito.)</p><p>Own Id: OTP-9720</p></li><li><p>Possible to run HiPE without floating point exceptions (FPE). Useful on
platforms that lack reliable FPE. Slower float operations compared to HiPE
with FPE.</p><p>Own Id: OTP-9724</p></li><li><p>As of ERTS version 5.9 (OTP-R15B) the runtime system will by default <em>not</em>
bind schedulers to logical processors.</p><p>If the Erlang runtime system is the only operating system process that binds
threads to logical processors, this improves the performance of the runtime
system. However, if other operating system processes (as for example another
Erlang runtime system) also bind threads to logical processors, there might be
a performance penalty instead. In some cases this performance penalty might be
severe. Due to this, we change the default so that the user must make an
active decision in order to bind schedulers.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-9726</p></li><li><p>The use of <code class="inline">erlang:system_flag(scheduler_bind_type, _)</code> and
<code class="inline">erlang:system_flag(cpu_topology, _)</code> have been deprecated and scheduled for
removal in erts-5.10/OTP-R16. For more information see the documentation of
<a href="erlang.html#system_flag/2"><code class="inline">erlang:system_flag/2</code></a>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-9749</p></li><li><p>An ancient workaround for a Windows bug was removed from the open_port code,
open_port({spawn,...}...) is now faster. Thanks to Daniel Goertzen.</p><p>Own Id: OTP-9766</p></li><li><p>The use of deprecated 32bit time_t on 32bit Windows is removed.</p><p>Own Id: OTP-9767</p></li><li><p>The NIF <code class="inline">reload</code> mechanism is deprecated. Do not use it as an upgrade method
for live production systems. It might be removed in future releases. It can
still serve as a development feature but a warning message will be logged each
time it is used.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-9771</p></li><li><p>The driver interface has been changed to enable 64-bit aware drivers. Most
importantly the return types for ErlDrvEntry callbacks 'call' and 'control'
has ben enlarged which require drivers to be changed or they will cause
emulator crashes. See
<a href="erl_driver.html#rewrites-for-64-bit-driver-interface">Rewrites for 64-bit driver interface </a>in
the driver manual.</p><p>Due to this driver <a href="erl_driver.html#version_management">version management</a> is
now mandatory. A driver that is not written with version management or a
driver that was compiled with the wrong major version will be not be loaded by
the emulator.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-9795</p></li><li><p>Eliminate use of deprecated regexp module</p><p>Own Id: OTP-9810</p></li></ul><h2 id="erts-5-8-5" class="section-heading"><a href="#erts-5-8-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.8.5</span></h2><h3 id="fixed-bugs-and-malfunctions-311" class="section-heading"><a href="#fixed-bugs-and-malfunctions-311" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Several bugs concerning constant binary constructions such as &lt;&lt;0:4294967295&gt;&gt;
have been corrected. Depending on the actual size of the binary and the type
of run-time system (32-bit, halfword, 64-bit), such expression could either
crash the run-time system or make the loader refuse loading of the module.</p><p>Own Id: OTP-9284</p></li><li><p>The Erlsrv utility failed to stop the erlang machine if no StopAction was
defined when the service was stopped. This is now corrected.</p><p>Own Id: OTP-9344</p></li><li><p>Due to a bug in glibc the runtime system could abort while trying to destroy a
mutex. A fix for this was introduced in R14B02. This fix did, however, not
solve the problem. The runtime system will now issue a warning instead of
aborting.</p><p>Own Id: OTP-9373 Aux Id: OTP-9009</p></li><li><p>Replace atom in DRV macro in prim_file with string</p><p>An experimental version of Dialyzer discovered that the atom that replaced the
DRV macro in prim_file ends up in calls to erlang:open_port({spawn, Driver},
Portopts) as the Driver argument. The documentation states that this call
requires a string there.</p><p>This change is also consistent with the one introduced in commit
0f03b1e9d2bef3bc830c31a369261af4c5234727 by Kostis Sagonas.</p><p>Own Id: OTP-9377</p></li><li><p>Fix typos in the epmd documentation (Thanks to Holger WeiÃŸ )</p><p>Own Id: OTP-9387</p></li><li><p>Fix faulty integer terms created by NIF API from 64-bit integers on halfword
emulator. (Thanks to Paolo Negri and Paul Davis)</p><p>Own Id: OTP-9394</p></li><li><p>Fix <code class="inline">epmd</code> crash on vxworks caused by faulty argument to select() system call.</p><p>Own Id: OTP-9427 Aux Id: seq11855</p></li><li><p>The ets:test_ms function could in rare cases truncate the error messages. This
is now corrected.</p><p>Own Id: OTP-9435</p></li><li><p>Fix bug related to hibernate and HiPE (clear F_HIBERNATE_SCHED flag)</p><p>F_HIBERNATE_SCHED flag that was introduced in b7ecdcd1ae9e11b8f75e must be
cleared in hipe_mode_switch as well. Otherwise, processes running HiPE code
that hibernate, wake up and then trap into a BIF will not be
rescheduled.(Thanks to Paul Guyot)</p><p>Own Id: OTP-9452</p></li><li><p>Fix bug in FreeBSD topology detection code (Thanks to Paul Guyot)</p><p>Own Id: OTP-9453</p></li><li><p>Fix use of logical operator &amp;&amp; with constant operand instead of bitwise &amp;
(Thanks to Cristian Greco)</p><p>Own Id: OTP-9454</p></li><li><p>inet: error if fd does not match socket domain</p><p>If an IPv4 fd is opened as an IPv6 socket, unexpected behaviour can occur. For
example, if an IPv4 UDP socket is opened and passed into Erlang as an IPv6
socket, the first 3 bytes (corresponding to 1 byte representing the protocol
family, 2 bytes set to the port) are stripped from the payload. The cause of
the UDP payload truncation happens in inet_drv.c:packet_inet_input when a call
to inet_get_address fails silently because the family is set to PF_INET6 but
the buffer len is the size of an IPv4 struct sockaddr_in.</p><p>(Thanks to Andrew Tunnell-Jones for finding the bug and the test case!)</p><p>Own Id: OTP-9455</p></li><li><p>erts: use a union to avoid strict aliasing issues</p><p>Use a union for pointer type conversion to avoid compiler warnings about
strict-aliasing violations with gcc-4.1. gcc &gt;= 4.2 does not emit the warning.
erts: adapt matrix_nif to R14 erl_nif API changes (Thanks To Tuncer Ayaz)</p><p>Own Id: OTP-9487</p></li><li><p>fix 64-bit issues in the garbage collection (Thanks to Richard Carlsson)</p><p>Own Id: OTP-9488</p></li><li><p>epmd: fix compiler warnings</p><p>Suppress compiler warnings about ignored return values. (Thanks to Michael
Santos )</p><p>Own Id: OTP-9500</p></li><li><p>Fix non-existing function (erlang:disconnect/1) in distributed reference
manual (Thanks to Fabian KrÃ³l)</p><p>Own Id: OTP-9504</p></li><li><p>Document fdatasync -lrt requirement (SunOS &lt;= 5.10) (Thanks to Tuncer Ayaz)</p><p>Own Id: OTP-9512</p></li><li><p>Let epmd ignore empty ERL_EPMD_ADDRESS</p><p>If the environment variable ERL_EPMD_ADDRESS is set to the empty string, empd
now behaves like it does by default when ERL_EPMD_ADDRESS is unset. That is,
in this case, epmd now listens on all available interfaces instead of using
only the loopback interface, which happened because epmd added the loopback
address to the (in this case empty) list of addresses specified via
ERL_EPMD_ADDRESS.</p><p>Also, epmd now ignores ERL_EPMD_ADDRESS if it contains only separator
characters (comma and space).</p><p>The same applies to epmd's -address option.(Thanks to Holger WeiÃŸ)</p><p>Own Id: OTP-9525</p></li><li><p>Remove dead code in erl_compile (Thanks to Tuncer Ayaz)</p><p>Own Id: OTP-9527</p></li><li><p>Add erlang:external_size/2 BIF</p><p>This BIF's second parameter is a list of options. Currently the only allowed
option is {minor_version, Version} where version is either 0 (default) or 1.
(Thanks to Filipe David Manana )</p><p>Own Id: OTP-9528</p></li><li><p>Fix enif_compare on 64bits machines</p><p>In 64bits machines the Sint type has a size of 8 bytes, while on 32bits
machines it has a 4 bytes size. enif_compare was ignoring this and therefore
returning incorrect values when the result of the CMP function (which returns
a Sint value) doesn't fit in 4 bytes. (Thanks to Filipe David Manana)</p><p>Own Id: OTP-9533</p></li><li><p>Implement or fix -Werror option</p><p>If -Werror is enabled and there are warnings no output file is written. Also
make sure that error/warning reporting is consistent. (Thanks to Tuncer Ayaz)</p><p>Own Id: OTP-9536</p></li><li><p>In some rare cases we did not have a run queue when scheduling misc ops. This
is now fixed.</p><p>Own Id: OTP-9537</p></li><li><p>Remove misc. compiler warnings</p><p>Own Id: OTP-9542</p></li><li><p>Two bugs in gen_sctp has been corrected: getopts/setopts hence also send could
only be called from socket owner, and options 'linger', 'rcvbuf' and 'sndbuf'
was read from wrong protocol layer hence read wrong values by getopts.</p><p>Own Id: OTP-9544</p></li><li><p>Erlang/OTP can now be built on MacOS X Lion.</p><p>Own Id: OTP-9547</p></li><li><p>XML files have been corrected.</p><p>Own Id: OTP-9550 Aux Id: OTP-9541</p></li><li><p>Fix potential errors inspired by running cppcheck(1) (Thanks to Christian von
Roques)</p><p>Own Id: OTP-9557</p></li><li><p>When auxiliary work was enqueued on a scheduler, the wakeup of the scheduler
in order to handle this work could be lost. Wakeups in order to handle
ordinary work were not effected by this bug. The bug only effected runtime
systems with SMP support as follows:</p><ul><li>Deallocation of some ETS data structures could be delayed.</li><li>On Linux systems not using the NPTL thread library (typically ancient
systems with kernel versions prior to 2.6) and Windows systems, the
<code class="inline">{Port, {exit_status, Status}}</code> message from a terminating port program
could be delayed. That is, it only effected port programs which had been
started by passing <code class="inline">exit_status</code> as an option to
<a href="erlang.html#open_port/2"><code class="inline">open_port/2</code></a>.</li></ul><p>Own Id: OTP-9567</p></li><li><p>Handle rare race in the crypto key server functionality</p><p>Own Id: OTP-9586</p></li></ul><h3 id="improvements-and-new-features-86" class="section-heading"><a href="#improvements-and-new-features-86" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Types and specifications have been added.</p><p>Own Id: OTP-9356</p></li><li><p>New allocator strategy &quot;address order first fit&quot;. May ease the emptying of
memory carriers and thereby real release of memory back to the OS.</p><p>Own Id: OTP-9424</p></li><li><p>The new <a href="erlang.html#check_old_code/1"><code class="inline">erlang:check_old_code/1</code></a> BIF checks whether a module has old code.</p><p>Own Id: OTP-9495</p></li><li><p>Update documentation and specifications of some of the zlib functions.</p><p>Own Id: OTP-9506</p></li><li><p>Detect the available CPUs on IRIX</p><p>Add support for querying the number of configured and online processors on SGI
systems running IRIX.(Thanks to Holger WeiÃŸ)</p><p>Own Id: OTP-9531</p></li></ul><h2 id="erts-5-8-4" class="section-heading"><a href="#erts-5-8-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.8.4</span></h2><h3 id="fixed-bugs-and-malfunctions-312" class="section-heading"><a href="#fixed-bugs-and-malfunctions-312" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix binary and iolist overflow problems. Typically problems arose in length
calculation where the result would exceed (1 bsl 32 - 1).</p><p>Own Id: OTP-9118</p></li><li><p>Using the old erlang shell (i.e. erl instead on werl) on windows and doing
several init:restart's would eventually hang the VM. That is no longer the
case.</p><p>Own Id: OTP-9139</p></li><li><p>Removed recursive C code when printing Erlang terms to buffers, avoiding stack
overflows that could cause VM to crash.</p><p>Own Id: OTP-9140</p></li><li><p>The send_timeout option in gen_tcp did not work properly in active mode or
with {active,once} options. This is now corrected.</p><p>Own Id: OTP-9145</p></li><li><p>Fixed various typos across the documentation (Thanks to Tuncer Ayaz)</p><p>Own Id: OTP-9154</p></li><li><p>Remove duplicate stack entries which could occur after calling certain BIFs.</p><p>Own Id: OTP-9163</p></li><li><p>A race when starting two nodes simultaneously using run_erl has been removed.</p><p>Own Id: OTP-9164</p></li><li><p>Add documentation on .erlang processing back again (Thanks to Gabor Liptak)</p><p>Own Id: OTP-9189</p></li><li><p>Remove gratuitous paren in driver_entry(Thanks to Tuncer Ayaz)</p><p>Own Id: OTP-9192</p></li><li><p>Fix some wrong pointer dereferences (Thanks to Cristian Greco)</p><p>Own Id: OTP-9194</p></li><li><p>erts: Remove unused variables (Thanks to Tuncer Ayaz)</p><p>Own Id: OTP-9205</p></li><li><p>The documentation for <code class="inline">init:get_args/0</code> has been removed. <code class="inline">init:get_args/0</code>
itself was deprecated in R9C and removed in R12B. (Thanks to Eric Pailleau.)</p><p>Own Id: OTP-9209</p></li><li><p>Allow user to specify the IP address epmd binds to</p><p>The IP address(es) epmd binds to can now be specified by the user, either via
epmd's new &quot;-address&quot; option or (if that's not used) by setting the
environment variable ERL_EPMD_ADDRESS. Multiple addresses may be specified
using a comma-separated list. If the loopback address is not in this list, it
will be added implicitly, so that the daemon can be queried by an interactive
epmd process.(Thanks to Holger WeiÃŸ)</p><p>Own Id: OTP-9213</p></li><li><p>epmd: include host address in local access check</p><p>In FreeBSD jails, the source and destination address of connections to
localhost are changed to be the IP address of the jail. Consider connections
from the host's IP address to itself (e.g., the source and destination address
match) to be local for the access control checks. (Thanks to Michal Santos and
Tom at diogunix.com)</p><p>Own Id: OTP-9214</p></li><li><p>Fix list returned by net_kernel:epmd_module</p><p>Function epmd_module of net_kernel returns a list instead of an atom, when the
epmd_module-flag is used. (Thanks to Markus Knofe)</p><p>Own Id: OTP-9215</p></li><li><p>Fix epmd's dbg_perror() output</p><p>The dbg_perror() function now hands the current errno value over to
dbg_gen_printf(). This fixes the problem that errno had been reset to zero by
the time it was used (to print the corresponding error message) in the
dbg_gen_printf() function. (Thanks to Holger WeiÃŸ)</p><p>Own Id: OTP-9223</p></li><li><p>heart: remove garbage appended to heart command</p><p>heart:get_cmd/0 is documented to return an empty string if the command is
cleared. get_cmd/0 returns 2 extra bytes: 1 byte for the trailing null, 1 byte
from the op (the op is an unsigned char and 2 bytes are allocated for it in
the returned buffer). (Thanks to Michael Santos)</p><p>Own Id: OTP-9224</p></li><li><p>file: fix hang reading compressed files</p><p>The gzio driver goes into an infinite loop when reading past the end of a
compressed file. Reported-By: Alex Morarash (Thanks to Michael Santos)</p><p>Own Id: OTP-9245</p></li><li><p>Eliminate alias warnings from gcc 4.5.2</p><p>Own Id: OTP-9250</p></li><li><p>Unsigned integer may overflow in error message (Thanks to Michael Santos)</p><p>Own Id: OTP-9251</p></li><li><p>Driver names should be strings, not atoms</p><p>Own Id: OTP-9253</p></li><li><p>driver_entry: Remove gratuitous paren and fix typo (Thanks to Tuncer Ayaz)</p><p>Own Id: OTP-9254</p></li><li><p>Fix format specifiers in erl_exit messages</p><p>Fix an error message by using an unsigned integer specifier as seen in a tweet
by @metabrew: #erlang VM crashed with &quot;no next heap size found: -2090496108,
offset 0&quot;, suddenly allocated all available RAM</p><p>Also correct mis-typed string formats in bif.c.(Thanks to Michael Santos)</p><p>Own Id: OTP-9262</p></li><li><p>net_drv: remove unused tcp request id inet_drv: remove gratuitous assignment
(Thanks to Tuncer Ayaz)</p><p>Own Id: OTP-9263</p></li><li><p>Teach run_erl RUN_ERL_DISABLE_FLOWCNTRL for disabling flow control</p><p>Flow control can cause unwanted behaviour of the beam process, if accidentally
hit Ctrl-S (instead of Ctrl-D to detach) the entire beam may be blocked.</p><p>Fix this problem by making it possible to turn off flow control by setting the
environment variable RUN_ERL_DISABLE_FLOWCNTRL. (Thanks to Jonas Faklkevik)</p><p>Own Id: OTP-9270</p></li><li><p>The following bugs due to missing memory barriers have been fixed:</p><ul><li>ETS tables using the <code class="inline">write_concurrency</code> option could potentially get into
an internally inconsistent state.</li><li>ETS tables using the <code class="inline">ordered_set</code> option could potentially get into an
internally inconsistent state.</li><li>A number of memory barriers have been added when building with the
<code class="inline">libatomic_ops</code> API (i.e. when passing <code class="inline">--with-libatomic_ops=PATH</code> to
<code class="inline">configure</code>) and the tilera atomics API (i.e. when building for the tilera
chip). Note that these bugs were due to erroneous usage of the APIs, and not
in the implementations of the APIs. When using these APIs the following bugs
where present:<ul><li>The BIF <a href="erlang.html#ports/0"><code class="inline">erlang:ports/0</code></a> could return an erroneous result.</li><li>A thread blocking other threads during code loading, or setup of tracing
could potentially read invalid data.</li><li>Fixation of ETS tables could potentially get into an internally
inconsistent state.</li></ul></li></ul><p>Own Id: OTP-9281</p></li><li><p>Fix halfword bug for ETS ordered_set when doing <code class="inline">select/match</code> with partly
bound key.</p><p>Own Id: OTP-9292</p></li><li><p>Fix bug in <code class="inline">code:is_module_native</code> that caused crash for deleted modules.</p><p>Own Id: OTP-9298</p></li><li><p>Calling <code class="inline">driver_async_cancel()</code> could cause a scheduler thread to enter an
eternal loop doing no useful work. (Thanks to Anders Ramsell)</p><p>Own Id: OTP-9302</p></li></ul><h3 id="improvements-and-new-features-87" class="section-heading"><a href="#improvements-and-new-features-87" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>New <code class="inline">enif_is_exception function</code> to allow NIFs to determine whether an
<code class="inline">ERL_NIF_TERM</code> represents an exception. (Thanks to Steve Vinoski)</p><p>Own Id: OTP-9150</p></li><li><p>A process being garbage collected by another process could be scheduled on
another scheduler. This prevented this scheduler from doing any useful work
until the garbage collection was done. This either occurred due to a explicit
call to the <a href="erlang.html#garbage_collect/1"><code class="inline">garbage_collect/1</code></a> BIF, or due to a
garbage collection part of code loading. A process being garbage collected
like this will now not be scheduled until the garbage collection has
completed.</p><p>Own Id: OTP-9211</p></li><li><p>Remove unnecessary validation copy in prim_file:drv_command/3 (Thanks to Tony
Rogvall)</p><p>Own Id: OTP-9276</p></li><li><p>Symbolic link handling on windows have been slightly updated to map error
conditions more consequently and correctly read directory links created
outside of the Erlang environment.</p><p>Own Id: OTP-9279</p></li><li><p>Due to standard library DLL mismatches between versions of OpenSSL and
Erlang/OTP, OpenSSL is now linked statically to the crypto driver on Windows.
This fixes problems starting crypto when running Erlang as a service on all
Windows versions.</p><p>Own Id: OTP-9280</p></li><li><p>Halfword emulator memory handling improvements:</p><ul><li>Much more of internal memory structures have been made able to use &quot;high&quot;
memory and are no longer restricted to the 4Gb limit that still applies for
all process heap data.</li><li>Fixed faulty values from <code class="inline">erlang:memory()</code> caused by 32-bit counter
overflow.</li><li>New counter <code class="inline">low</code> in <code class="inline">erlang:memory()</code> that sums up all memory restricted by
4Gb limit.</li></ul><p>Own Id: OTP-9291 Aux Id: seq11841</p></li><li><p>The value set in the undocumented and unsupported ERL_version_FLAGS (e.g.
ERL_R14B03_FLAGS) environment variable can now be overridden by the command
line (similar to ERL_AFLAGS).</p><p>Own Id: OTP-9297</p></li></ul><h2 id="erts-5-8-3-2" class="section-heading"><a href="#erts-5-8-3-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.8.3.2</span></h2><h3 id="known-bugs-and-problems-4" class="section-heading"><a href="#known-bugs-and-problems-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Known Bugs and Problems</span></h3><ul><li><p>Fix halfword emulator bug in <code class="inline">ets:select_delete</code> for <code class="inline">ordered_set</code> that caused
emulator to crash.</p><p>Own Id: OTP-9258 Aux Id: seq11836</p></li></ul><h2 id="erts-5-8-3-1" class="section-heading"><a href="#erts-5-8-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.8.3.1</span></h2><h3 id="fixed-bugs-and-malfunctions-313" class="section-heading"><a href="#fixed-bugs-and-malfunctions-313" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Ets table type ordered_set could order large integer keys wrongly on pure
64bit platforms. This is now corrected.</p><p>Own Id: OTP-9181</p></li><li><p>The status of a process was unnecessarily set to waiting before a process was
enqueued in a run queue. This bug was harmless up until OTP-R14B01. In
OTP-R14B02 <a href="erlang.html#hibernate/3"><code class="inline">erlang:hibernate/3</code></a> was fixed (OTP-9125). After the introduction
of OTP-9125, the previously harmless process status bug sometimes caused
erroneous badarg exceptions from <code class="inline">process_info()</code>.</p><p>OTP-9125 also introduced a thread unsafe access to the status field of a
process which now also have been fixed.</p><p>*<strong> INCOMPATIBILITY with noxs *</strong></p><p>Own Id: OTP-9197</p></li></ul><h2 id="erts-5-8-3" class="section-heading"><a href="#erts-5-8-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.8.3</span></h2><h3 id="fixed-bugs-and-malfunctions-314" class="section-heading"><a href="#fixed-bugs-and-malfunctions-314" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The scroll wheel now scrolls the werl window on Windows.</p><p>Own Id: OTP-8985</p></li><li><p>Some malformed distribution messages could cause VM to crash, this is now
corrected.</p><p>Own Id: OTP-8993</p></li><li><p>The OS function getifaddrs() can return NULL in some address fields for e.g
PPP and tunnel devices which caused the emulator to segfault. This bug has now
been corrected.</p><p>Own Id: OTP-8996</p></li><li><p>The expression &lt;&lt;A:0&gt;&gt; would always produce an empty binary, even if <code class="inline">A</code> was
not an integer. Corrected to cause a <code class="inline">badarg</code> exception if the type of <code class="inline">A</code> is
invalid. (Thanks to Zvi.)</p><p>Own Id: OTP-8997</p></li><li><p>A bug that potentially could cause an emulator crash when deleting an
ETS-table has been fixed. A resource leak when hitting the maximum amount of
ETS-tables allowed has also been fixed.</p><p>Own Id: OTP-8999</p></li><li><p>A bug in the <a href="erlang.html#exit/2"><code class="inline">exit/2</code></a> BIF could potentially cause an emulator
crash.</p><p>Own Id: OTP-9005</p></li><li><p>Due to a bug in glibc the runtime system could abort while trying to destroy a
mutex. The runtime system will now issue a warning instead of aborting.</p><p>Own Id: OTP-9009</p></li><li><p>A bug in epmd could create strange behaviour when listen() calls failed. This
is now corrected thanks to Steve Vinoski.</p><p>Own Id: OTP-9024</p></li><li><p>When setting file_info the win32_driver will now correctly set access and
modified time. Previously these entities were swapped.</p><p>Own Id: OTP-9046</p></li><li><p>Setting scheduler bind type to <code class="inline">unbound</code> failed if binding of schedulers
wasn't supported, or if CPU topology wasn't present. This even though the
documentation stated that it is possible to set the bind type to <code class="inline">unbound</code>.</p><p>Own Id: OTP-9056 Aux Id: Seq11779</p></li><li><p>Two problems were fixed in crash dump: The time left for timers are now shown
as unsigned integers and the contents of ordered_set ETS tables is no longer
included.</p><p>Own Id: OTP-9057</p></li><li><p>The VM could fail to set IP_TOS and SO_PRIORITY in certain situations, either
because sockets were supplied as open file descriptors, or because SO_PRIORITY
by default was set higher than the user can explicitly set it to. Those
situations are now handled.</p><p>Own Id: OTP-9069</p></li><li><p>Wx on MacOS X generated complains on stderr about certain cocoa functions not
being called from the &quot;Main thread&quot;. This is now corrected.</p><p>Own Id: OTP-9081</p></li><li><p>Fix a couple typos in driver_entry(3) (thanks to Tuncer Ayaz).</p><p>Own Id: OTP-9085</p></li><li><p>Mention that &quot;-detached&quot; implies &quot;-noinput&quot;</p><p>Clarify that specifying &quot;-noinput&quot; is unnecessary if the &quot;-detached&quot; flag is
given. (thanks to Holger WeiÃŸ)</p><p>Own Id: OTP-9086</p></li><li><p>A potential problem (found by code inspection) when calling a fun whose code
was not loaded has been fixed.</p><p>Own Id: OTP-9095</p></li><li><p>The emulator could get into a state where it didn't check for I/O.</p><p>Own Id: OTP-9105 Aux Id: Seq11798</p></li><li><p>Attempting to create binaries exceeding 2Gb (using for example
<a href="erlang.html#term_to_binary/1"><code class="inline">term_to_binary/1</code></a>) would crash the emulator with an
attempt to allocate huge amounts of memory. (Thanks to Jon Meredith.)</p><p>Own Id: OTP-9117</p></li><li><p>Fix erlang:hibernate/3 on HiPE enabled emulator (Thanks to Paul Guyot)</p><p>Own Id: OTP-9125</p></li></ul><h3 id="improvements-and-new-features-88" class="section-heading"><a href="#improvements-and-new-features-88" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>From this release, the previously experimental halfword emulator is now
official. It can be enabled by giving the <code class="inline">--enable-halfword-emulator</code> option
to the <code class="inline">configure</code> script.</p><p>The halfword emulator is a 64-bit application, but uses halfwords (32-bit
words) for all data in Erlang processes, therefore using less memory and being
faster than the standard 64-bit emulator. The total size of all BEAM code and
all process data for all processes is limited to 4Gb, but ETS tables and
off-heap binaries are only limited by the amount of available memory.</p><p>Own Id: OTP-8941</p></li><li><p>32-bit atomic memory operations have been introduced internally in the run
time system, and are now used where appropriate. There were previously only
atomic memory operations of word size available. The 32-bit atomic memory
operations slightly reduce memory consumption, and slightly improve
performance on 64-bit runtime systems.</p><p>Own Id: OTP-8974</p></li><li><p>Performance enhancements for looking up timer-entries and removing timers from
the wheel.</p><p>Own Id: OTP-8990</p></li><li><p>Write accesses to ETS tables have been optimized by reducing the amount of
atomic memory operations needed during a write access.</p><p>Own Id: OTP-9000</p></li><li><p>Strange C coding in the VM made the -D_FORTIFY_SOURCE option to gcc-4.5 react
badly. The code is now cleaned up so that it's accepted by gcc-4.5.</p><p>Own Id: OTP-9025</p></li><li><p>The memory footprint for loaded code has been somewhat reduced (especially in
the 64-bit BEAM machine).</p><p>Own Id: OTP-9030</p></li><li><p>The maximum number of allowed arguments for an Erlang function has been
lowered from 256 to 255, so that the number of arguments can now fit in a
byte.</p><p>Own Id: OTP-9049</p></li><li><p>Dependency generation for Makefiles has been added to the compiler and erlc.
See the manual pages for <code class="inline">compile</code> and <code class="inline">erlc</code>. (Thanks to Jean-Sebastien
Pedron.)</p><p>Own Id: OTP-9065</p></li></ul><h2 id="erts-5-8-2" class="section-heading"><a href="#erts-5-8-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.8.2</span></h2><h3 id="fixed-bugs-and-malfunctions-315" class="section-heading"><a href="#fixed-bugs-and-malfunctions-315" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix format_man_pages so it handles all man sections and remove warnings/errors
in various man pages.</p><p>Own Id: OTP-8600</p></li><li><p>The <code class="inline">configure</code> command line argument
<a href="../../system/install.html#advanced-configuration-and-build-of-erlang-otp">--enable-ethread-pre-pentium4-compatibility</a>
had no effect. This option is now also automatically enabled if required on
the build machine.</p><p>Own Id: OTP-8847</p></li><li><p>Windows 2003 and Windows XP pre SP3 would sometimes not start the Erlang R14B
VM at all due to a bug in the cpu topology detection. The bug affects Windows
only, no other platform is even remotely affected. The bug is now corrected.</p><p>Own Id: OTP-8876</p></li><li><p>The HiPE run-time in the 64-bit emulator could do a 64-bit write to a 32-bit
struct field. It happened to be harmless on Intel/AMD processors. Corrected.
(Thanks to Mikael Pettersson.)</p><p>Own Id: OTP-8877</p></li><li><p>A bug in <a href="erl_driver.html#erl_drv_tsd_get">erl_drv_tsd_get()</a> and
<a href="erl_nif.html#enif_tsd_get">enif_tsd_get()</a> could cause an emulator crash. These
functions are currently not used in OTP. That is, the crash only occur on
systems with user implemented NIF libraries, or drivers that use one of these
functions.</p><p>Own Id: OTP-8889</p></li><li><p>Calling <code class="inline">erlang:system_info({cpu_topology, CpuTopologyType})</code> with another
<code class="inline">CpuTopologyType</code> element than one of the documented atoms <code class="inline">defined</code>,
<code class="inline">detected</code>, or <code class="inline">used</code> caused an emulator crash. (Thanks to Paul Guyot)</p><p>Own Id: OTP-8914</p></li><li><p>The ERTS internal rwlock implementation could get into an inconsistent state.
This bug was very seldom triggered, but could be during heavy contention. The
bug was introduced in R14B (erts-5.8.1).</p><p>The bug was most likely to be triggered when using the <code class="inline">read_concurrency</code>
option on an ETS table that was frequently accessed from multiple processes
doing lots of writes and reads. That is, in a situation where you typically
don't want to use the <code class="inline">read_concurrency</code> option in the first place.</p><p>Own Id: OTP-8925 Aux Id: OTP-8544</p></li><li><p>Tracing to port could cause an emulator crash when unloading the trace driver.</p><p>Own Id: OTP-8932</p></li><li><p>Removed use of CancelIoEx on Windows that had been shown to cause problems
with some drivers.</p><p>Own Id: OTP-8937</p></li><li><p>The fallback implementation used when no native atomic implementation was
found did not compile. (Thanks to Patrick Baggett, and Tuncer Ayaz)</p><p>Own Id: OTP-8944</p></li><li><p>Some integer values used during load balancing could under rare circumstances
wrap causing a load unbalance between schedulers.</p><p>Own Id: OTP-8950</p></li><li><p>The windows VM now correctly handles appending to large files (&gt; 4GB).</p><p>Own Id: OTP-8958</p></li><li><p>Name resolving of IPv6 addresses has been implemented for Windows versions
that support it. The use of ancient resolver flags (AI_V4MAPPED |
AI_ADDRCONFIG) to the getaddrinfo() function has been removed since e.g
FreeBSD regard mapped IPv4 addresses to be a security problem and the
semantics of the address configured flag is uncertain.</p><p>Own Id: OTP-8969</p></li></ul><h3 id="improvements-and-new-features-89" class="section-heading"><a href="#improvements-and-new-features-89" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The help texts produced by the <code class="inline">configure</code> scripts in the top directory and in
the erts directory have been aligned and cleaned up.</p><p>Own Id: OTP-8859</p></li><li><p>When the runtime system had fewer schedulers than logical processors, the
system could get an unnecessarily large amount reader groups.</p><p>Own Id: OTP-8861</p></li><li><p><code class="inline">run_rel</code> has been updated to support Solaris's /dev/ptmx device and to load
the necessary STREAMS modules so that <code class="inline">to_erl</code> can provide terminal echo of
keyboard input. (Thanks to Ryan Tilder.)</p><p>Own Id: OTP-8878</p></li><li><p>The Erlang VM now supports Unicode filenames. The feature is turned on by
default on systems where Unicode filenames are mandatory (Windows and MacOSX),
but can be enabled on other systems with the '+fnu' emulator option. Enabling
the Unicode filename feature on systems where it is not default is however
considered experimental and not to be used for production. Together with the
Unicode file name support, the concept of &quot;raw filenames&quot; is introduced, which
means filenames provided without implicit unicode encoding translation. Raw
filenames are provided as binaries, not lists. For further information, see
stdlib users guide and the chapter about using Unicode in Erlang. Also see the
file module manual page.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-8887</p></li><li><p>Buffer overflows have been prevented in <code class="inline">erlc</code>, <code class="inline">dialyzer</code>, <code class="inline">typer</code>,
<code class="inline">run_test</code>, <code class="inline">heart</code>, <code class="inline">escript</code>, and <code class="inline">erlexec</code>.</p><p>(Thanks to Michael Santos.)</p><p>Own Id: OTP-8892</p></li><li><p>The runtime system is now less eager to suspend processes sending messages
over the distribution. The default value of the distribution buffer busy limit
has also been increased from 128 KB to 1 MB. This in order to improve
throughput.</p><p>Own Id: OTP-8901</p></li><li><p>The distribution buffer busy limit can now be configured at system startup.
For more information see the documentation of the <code class="inline">erl</code>
<a href="erl_cmd.html#%2Bzdbbl">+zdbbl</a> command line flag. (Thanks to Scott Lystig
Fritchie)</p><p>Own Id: OTP-8912</p></li><li><p>The inet driver internal buffer stack implementation has been rewritten in
order to reduce lock contention.</p><p>Own Id: OTP-8916</p></li><li><p>New ETS option <code class="inline">compressed</code>, to enable a more compact storage format at the
expence of heavier table operations. For test and evaluation, <code class="inline">erl +ec</code> can be
used to force compression on all ETS tables.</p><p>Own Id: OTP-8922 Aux Id: seq11658</p></li><li><p>There is now a new function inet:getifaddrs/0 modeled after C library function
getifaddrs() on BSD and LInux that reports existing interfaces and their
addresses on the host. This replaces the undocumented and unsupported
inet:getiflist/0 and inet:ifget/2.</p><p>Own Id: OTP-8926</p></li><li><p>Support for detection of CPU topology and binding of schedulers on FreeBSD 8
have been added. (Thanks to Paul Guyot)</p><p>Own Id: OTP-8939</p></li><li><p>Several bugs related to hibernate/3 and HiPE have been corrected. (Thanks to
Paul Guyot.)</p><p>Own Id: OTP-8952</p></li><li><p>Support for soft and hard links on Windows versions and filesystems that
support them is added.</p><p>Own Id: OTP-8955</p></li><li><p>The win32 virtual machine is now linked large address aware. his allows the
Erlang VM to use up to 3 gigs of address space on Windows instead of the
default of 2 gigs.</p><p>Own Id: OTP-8956</p></li></ul><h2 id="erts-5-8-1-2" class="section-heading"><a href="#erts-5-8-1-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.8.1.2</span></h2><h3 id="fixed-bugs-and-malfunctions-316" class="section-heading"><a href="#fixed-bugs-and-malfunctions-316" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix that the documentation top index generator can handle an Ericsson internal
application group.</p><p>Own Id: OTP-8875</p></li><li><p>In embedded mode, on_load handlers that called <a href="../../apps/kernel/code.html#priv_dir/1"><code class="inline">code:priv_dir/1</code></a> or other
functions in <code class="inline">code</code> would hang the system. Since the <code class="inline">crypto</code> application now
contains an on_loader handler that calls <a href="../../apps/kernel/code.html#priv_dir/1"><code class="inline">code:priv_dir/1</code></a>, including the
<code class="inline">crypto</code> application in the boot file would prevent the system from starting.</p><p>Also extended the <code class="inline">-init_debug</code> option to print information about on_load
handlers being run to facilitate debugging.</p><p>Own Id: OTP-8902 Aux Id: seq11703</p></li></ul><h2 id="erts-5-8-1-1" class="section-heading"><a href="#erts-5-8-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.8.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-317" class="section-heading"><a href="#fixed-bugs-and-malfunctions-317" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Windows 2003 and Windows XP pre SP3 would sometimes not start the Erlang R14B
VM at all due to a bug in the cpu topology detection. The bug affects Windows
only, no other platform is even remotely affected. The bug is now corrected.</p><p>Own Id: OTP-8876</p></li></ul><h2 id="erts-5-8-1" class="section-heading"><a href="#erts-5-8-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.8.1</span></h2><h3 id="fixed-bugs-and-malfunctions-318" class="section-heading"><a href="#fixed-bugs-and-malfunctions-318" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Very small floating point numbers generated errors when converting from list
to float in some versions of the VM, this is now corrected so that i.e.
list_to_float(&quot;1.0e-324&quot;). returns 0.0 in all versions of Erlang.</p><p>Own Id: OTP-7178</p></li><li><p>Windows Vista and Windows 7 file system virtualization, which makes &quot;old
style&quot; windows programs execute in a file system sandbox, was previously
unintentionally turned on for the Erlang VM. This is now corrected so that
i.e. writes to C:\Program Files\. without administrator privileges will
fail.</p><p>Own Id: OTP-7405</p></li><li><p>Fix faulty 64-bit integer term output from drivers. Large 64-bits integers did
not generate correct bignums and could even cause emulator crash. Only affects
drivers using ERL_DRV_INT64 or ERL_DRV_UINT64, introduced in R13B03.</p><p>Own Id: OTP-8716</p></li><li><p>Fixed: inet:setopts(S, [{linger,{true,2}}]) returned {error,einval} for
SCTP sockets. The inet_drv had a bug when checking the option size.</p><p>Own Id: OTP-8726 Aux Id: seq11617</p></li><li><p>Fix libm linking with --as-needed flag</p><p>When building with &quot;--as-needed&quot; linker flags on Linux the build will fail.
This has now been fixed.</p><p>(Thanks to Christian Faulhammer)</p><p>Own Id: OTP-8728</p></li><li><p>gen_udp:connect/3 was broken for SCTP enabled builds. It did not detect remote
end errors as it should.</p><p>Own Id: OTP-8729</p></li><li><p>Reduce the risk of integer wrapping in bin vheap size counting.</p><p>The vheap size series will now use the golden ratio instead of doubling and
fibonacci sequences.</p><p>Own Id: OTP-8730</p></li><li><p>ETS ordered_set containing <code class="inline">[]</code> as key could cause strange thing to happen,
like an infinite hanging <code class="inline">ets:select</code>.</p><p>Own Id: OTP-8732</p></li><li><p>reference() has been substituted for ref() in the documentation.</p><p>Own Id: OTP-8733</p></li><li><p>When a native compiled module called a not loaded non-native compiled module
that had an on_load function, the export entries were trashed after code
loading so on the next call from the native compiled module to the non-native
compiled the emulator crashed. This bug has now been fixed.</p><p>Own Id: OTP-8736</p></li><li><p>HiPE-enabled Erlang VMs running on BSD systems sometimes generated messages
like &quot;Yikes! erts_alloc() returned misaligned address 0x8016a512c&quot;. Fixed.
(Thanks to Mikael Pettersson.)</p><p>Own Id: OTP-8769</p></li><li><p>A race condition in <code class="inline">erts_poll()</code> could cause delay of poll for I/O.</p><p>Own Id: OTP-8773</p></li><li><p>Removed some potential vulnerabilities from the Erlang Port Mapper Daemon
(epmd) and straightened up access control. Also removed hazardous interfaces
allowing anyone on a machine to forcefully unregister other nodes. This means
that the ei_unregister/erl_unregister interfaces in erl_interface is rendered
not only error prone and mystifying as before, but totally ineffective. The
old behaviour of unchecked node unregistering can be restored if needed, see
epmd documentation for details.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-8780</p></li><li><p>Building in a source tree without prebuilt platform independent build results
failed on the SSL examples when:</p><ul><li>cross building. This has been solved by not building the SSL examples during
a cross build.</li><li>building on Windows.</li></ul><p>Own Id: OTP-8791</p></li><li><p>inet:getsockopt for SCTP sctp_default_send_param had a bug to not initialize
required feilds causing random answers. It is now corrected.</p><p>Own Id: OTP-8795 Aux Id: seq11655</p></li><li><p>The hipe_bifs:get_hrvtime/0 BIF now always returns a real value even if the
&quot;perfctr&quot; Linux kernel extension is not available. It used to return a dummy
value. (Thanks to Mikael Pettersson.)</p><p>Own Id: OTP-8798</p></li><li><p>Calling a native-code compiled module with an <code class="inline">on_load</code> function could cause a
crash. (Thanks to Mikael Pettersson.)</p><p>Own Id: OTP-8799</p></li><li><p>The emulator could crash while writing a crash dump if native-compiled modules
had been loaded. (Thanks to Paul Guyot.)</p><p>Own Id: OTP-8801</p></li><li><p>The garbage collector could crash if invoked from native-compiled code after a
call to a BIF. (Thanks to Paul Guyot.)</p><p>Own Id: OTP-8821</p></li><li><p>A rare memory leak in binary:matches is removed</p><p>Own Id: OTP-8823</p></li><li><p>For a socket in the HTTP packet mode, the return value from <code class="inline">gen_tcp:recv/2,3</code>
if there is an error in the header will be <code class="inline">{ok,{http_error,String}}</code> instead
of <code class="inline">{error,{http_error,String}}</code> to be consistent with <code class="inline">ssl:recv/2,3</code>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-8831</p></li></ul><h3 id="improvements-and-new-features-90" class="section-heading"><a href="#improvements-and-new-features-90" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>ets:select_reverse/{1,2,3} are now documented.</p><p>Own Id: OTP-7863</p></li><li><p>External format of integers changed to make full use of all 32 bits of
INTEGER_EXT. This is a compatible change as old code can read full 32-bit
integers but only produce 28-bit integers as INTEGER_EXT.</p><p>Own Id: OTP-8540 Aux Id: seq11534</p></li><li><p>Large parts of the <code class="inline">ethread</code> library have been rewritten. The <code class="inline">ethread</code>
library is an Erlang runtime system internal, portable thread library used by
the runtime system itself.</p><p>Most notable improvement is a reader optimized rwlock implementation which
dramatically improve the performance of read-lock/read-unlock operations on
multi processor systems by avoiding ping-ponging of the rwlock cache lines.
The reader optimized rwlock implementation is used by miscellaneous rwlocks in
the runtime system that are known to be read-locked frequently, and can be
enabled on ETS tables by passing the
<a href="../../apps/stdlib/ets.html#new_2_read_concurrency">{read_concurrency, true}</a> option upon table
creation. See the documentation of <a href="../../apps/stdlib/ets.html#new/2"><code class="inline">ets:new/2</code></a> for more information. The
reader optimized rwlock implementation can be fine tuned when starting the
runtime system. For more information, see the documentation of the
<a href="erl_cmd.html#%2Brg">+rg</a> command line argument of <code class="inline">erl</code>.</p><p>There is also a new implementation of rwlocks that is not optimized for
readers. Both implementations interleaves readers and writers during
contention as opposed to, e.g., the NPTL (Linux) pthread rwlock implementation
which use either a reader or writer preferred strategy. The reader/writer
preferred strategy is problematic since it starves threads doing the
non-preferred operation.</p><p>The new rwlock implementations in general performs better in ERTS than common
pthread implementations. However, in some extremely heavily contended cases
this is not the case. Such heavy contention can more or less only appear on
ETS tables. This when multiple processes do very large amounts of write locked
operations simultaneously on the same table. Such use of ETS is bad regardless
of rwlock implementation, will never scale, and is something we strongly
advise against.</p><p>The new rwlock implementations depend on atomic operations. If no native
atomic implementation is found, a fallback solution will be used. Using the
fallback implies a performance degradation. That is, it is more important now
than before to build OTP with a native atomic implementation.</p><p>The <code class="inline">ethread</code> library contains native atomic implementations for, x86 (32 and
64 bit), powerpc (32 bit), sparc V9 (32 and 64 bit), and tilera (32 bit). On
other hardware gcc's builtin support for atomic memory access will be used if
such exists. If no such support is found, <code class="inline">configure</code> will warn about no
atomic implementation available.</p><p>The <code class="inline">ethread</code> library can now also use the <code class="inline">libatomic_ops</code> library for atomic
memory accesses. This makes it possible for the Erlang runtime system to
utilize optimized native atomic operations on more platforms than before. If
<code class="inline">configure</code> warns about no atomic implementation available, try using the
<code class="inline">libatomic_ops</code> library. Use the
<a href="../../system/install.html#advanced-configuration-and-build-of-erlang-otp">--with-libatomic_ops=PATH</a>
<code class="inline">configure</code> command line argument when specifying where the <code class="inline">libatomic_ops</code>
installation is located. The <code class="inline">libatomic_ops</code> library can be downloaded from:
<a href="http://www.hpl.hp.com/research/linux/atomic_ops/">http://www.hpl.hp.com/research/linux/atomic_ops/</a></p><p>The changed API of the <code class="inline">ethread</code> library has also caused modifications in the
Erlang runtime system. Preparations for the to come &quot;delayed deallocation&quot;
feature has also been done since it depends on the <code class="inline">ethread</code> library.</p><p><em>Note</em>: When building for x86, the <code class="inline">ethread</code> library will now use instructions
that first appeared on the pentium 4 processor. If you want the runtime system
to be compatible with older processors (back to 486) you need to pass the
<a href="../../system/install.html#advanced-configuration-and-build-of-erlang-otp">--enable-ethread-pre-pentium4-compatibility</a>
<code class="inline">configure</code> command line argument when configuring the system.</p><p>Own Id: OTP-8544</p></li><li><p>erlang:localtime_to_universaltime({{2008, 8, 1}, {0, 0, 0}},true) when
TZ=UTC now behaves consistently on all Unix platforms.</p><p>The problem fixed was originally reported by Paul Guyot on erlang-bugs mailing
list:</p><p><a href="http://www.erlang.org/pipermail/erlang-bugs/2008-November/001077.html">http://www.erlang.org/pipermail/erlang-bugs/2008-November/001077.html</a></p><p>Own Id: OTP-8580</p></li><li><p>Optimization reducing memory consumption by two words per ETS object.</p><p>Own Id: OTP-8737</p></li><li><p>Fixes for unsupported halfword-emulator</p><p>Own Id: OTP-8745</p></li><li><p>NIF 64-bit integer support; <code class="inline">enif_get_int64</code>, <code class="inline">enif_get_uint64</code>,
<code class="inline">enif_make_int64</code>, <code class="inline">enif_make_uint64</code>.</p><p>Own Id: OTP-8746</p></li><li><p>Alignment of trailing data in messages has been adjusted. This in order to be
able to pass data of any type as trailing data in the future.</p><p>Own Id: OTP-8754</p></li><li><p>The obsolete/driver.h header file has been removed. It has been obsolete and
deprecated since R8B. Drivers that still include obsolete/driver.h must be
updated to include erl_driver.h.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-8758</p></li><li><p>Added erlang:system_info(build_type) which makes it easier to chose drivers,
NIF libraries, etc based on build type of the runtime system.</p><p>The NIF library for crypto can now be built for valgrind and/or debug as
separate NIF libraries that will be automatically loaded if the runtime system
has been built with a matching build type.</p><p>Own Id: OTP-8760</p></li><li><p>Further lessened the memory requirements of ETS objects.</p><p>Own Id: OTP-8762</p></li><li><p>The broken elib_malloc alternate memory allocator has been removed.
<code class="inline">erlang:system_info(elib_malloc)</code> will always return <code class="inline">false</code>, and in R15,
<code class="inline">erlang:system_info(elib_malloc)</code> will fail with a <code class="inline">badarg</code> exception.</p><p>Own Id: OTP-8764</p></li><li><p>Calling <a href="erlang.html#system_info/1"><code class="inline">erlang:system_info/1</code></a> with the new argument <code class="inline">update_cpu_info</code> will
make the runtime system reread and update the internally stored CPU
information. For more information see the documentation of
<a href="erlang.html#system_info_update_cpu_info">erlang:system_info(update_cpu_info)</a>.</p><p>The CPU topology is now automatically detected on Windows systems with less
than 33 logical processors. The runtime system will now, also on Windows, by
default bind schedulers to logical processors using the <code class="inline">default_bind</code> bind
type if the amount of schedulers is at least equal to the amount of logical
processors configured, binding of schedulers is supported, and a CPU topology
is available at startup.</p><p>Own Id: OTP-8765</p></li><li><p>The SMP ERTS internal child waiter thread used on Linux system with NPTL was
unintentionally disabled during cross compilation rewrites (OTP-8323 in
R13B03). It has now been re-enabled. Enabling it again gives a slight
performance improvement.</p><p>Own Id: OTP-8774</p></li><li><p><code class="inline">epmd</code> used to generate a message to the syslog when it started up, which
could be annoying. This has been changed to only generate the message if the
debug switch is given. (Thanks to Michael Santos.)</p><p>Own Id: OTP-8775</p></li><li><p>The scheduler wakeup threshold is now possible to adjust at system boot. For
more information see the <a href="erl_cmd.html#%2Bswt">+swt</a> command line argument of
<code class="inline">erl</code>.</p><p>Own Id: OTP-8811</p></li><li><p>The undocumented function inet:ifget/2 has been improved to return interface
hardware address (MAC) on platforms supporting getaddrinfo() (such as BSD
unixes). Note it still does not work on all platforms for example not Windows
nor Solaris, so the function is still undocumented.</p><p>Buffer overflow and field init bugs for inet:ifget/2 and inet:getservbyname/2
has also been fixed.</p><p>Thanks to Michael Santos.</p><p>Own Id: OTP-8816</p></li><li><p>Optimizations for MIPS when using gcc atomics. (Thanks to Steve Vinoski)</p><p>Own Id: OTP-8834</p></li><li><p>Lock optimization in timer functionality.</p><p>Own Id: OTP-8835</p></li></ul><h3 id="known-bugs-and-problems-5" class="section-heading"><a href="#known-bugs-and-problems-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Known Bugs and Problems</span></h3><ul><li><p>Fix epmd and build environment to build on VxWorks</p><p>Own Id: OTP-8838</p></li></ul><h2 id="erts-5-8" class="section-heading"><a href="#erts-5-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.8</span></h2><h3 id="fixed-bugs-and-malfunctions-319" class="section-heading"><a href="#fixed-bugs-and-malfunctions-319" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Driver threads, such as async threads, using
<a href="erl_driver.html#ErlDrvPDL">port data locks</a> peeked at the port status field
without proper locking when looking up the driver queue.</p><p>Own Id: OTP-8475</p></li><li><p>The use of <code class="inline">mmap()</code> was unnecessarily disabled when cross compiling.</p><p>The <code class="inline">configure</code> arguments <code class="inline">--with-ssl</code>, and <code class="inline">--with-odbc</code> refused to accept
libraries outside of <code class="inline">$erl_xcomp_sysroot</code> when cross compiling for no good
reason.</p><p>The <code class="inline">configure</code> argument <code class="inline">--with-odbc</code> didn't handle the value <code class="inline">yes</code> correct.</p><p>The <code class="inline">configure</code> arguments <code class="inline">--with-odbc</code>, and <code class="inline">--without-odbc</code> have also been
added to the configure help.</p><p>(Thanks to Steve Vinoski for reporting these issues)</p><p>Own Id: OTP-8484</p></li><li><p>A call to the BIF <a href="erlang.html#unregister/1"><code class="inline">unregister(RegName)</code></a> when a port had the
name <code class="inline">RegName</code> registered in the runtime system without SMP support caused a
runtime system crash. (Thanks to Per Hedeland for the bugfix and test case.)</p><p>Own Id: OTP-8487</p></li><li><p>The runtime system crashed if fewer logical processors were found than
reported by <code class="inline">sysconf( SC_NPROCESSORS_CONF)</code>.</p><p>Own Id: OTP-8549</p></li><li><p>Fix memory management bug causing crash of non-SMP emulator with async threads
enabled. The bug did first appear in R13B03.</p><p>Own Id: OTP-8591 Aux Id: seq11554</p></li><li><p>Port locks could be prematurely destroyed.</p><p>Own Id: OTP-8612</p></li><li><p>The <code class="inline">empd</code> program could loop and consume 100% CPU time if an unexpected error
occurred in <code class="inline">listen()</code> or <code class="inline">accept()</code>. Now <code class="inline">epmd</code> will terminate if a
non-recoverable error occurs. (Thanks to Michael Santos.)</p><p>Own Id: OTP-8618</p></li><li><p>When kernel poll has been enabled, a livelock could in rare circumstances
occur. Problem reported by Chetan Ahuja, fix by Mikael Pettersson.</p><p>Own Id: OTP-8632</p></li><li><p>Windows: Closing port of program that stalled without reading all data could
deadlock scheduler thread.</p><p>Own Id: OTP-8641</p></li><li><p>On some combination of Montavista Linux on Cavium Octeon processors, some
socket-related system calls returned other numbers than -1 for errors. This
caused a core dump in inet_drv.c. Now the code works around this problem.</p><p>Own Id: OTP-8654</p></li><li><p>Missing memory barriers in <code class="inline">erts_poll()</code> could cause the runtime system to
hang indefinitely.</p><p>Own Id: OTP-8658</p></li><li><p><code class="inline">ethr_rwmutex_tryrlock()</code> acquired and refused to acquire a lock with inverted
logic. The lock was however never acquired in a thread unsafe manner. (Thanks
to JR Zhang for noting this issue)</p><p>Own Id: OTP-8662</p></li><li><p>Extreme combinations of register/unregister in a highly parallel SMP
application could crash the VM. The error is corrected.</p><p>Own Id: OTP-8663</p></li><li><p>On Windows, files are now opened with FILE_SHARE_DELETE to get closer to Unix
semantics.</p><p>Own Id: OTP-8667</p></li><li><p><code class="inline">erlang:system_info(multi_scheduling)</code> sometimes erroneously returned
<code class="inline">enabled</code> when it should have returned <code class="inline">blocked</code>.</p><p>Own Id: OTP-8675</p></li><li><p>Fix bug causing <code class="inline">erlang:decode_packet</code> and <code class="inline">enif_make_string</code> to generate
faulty strings with negative character values for ascii values larger
than 127. (Thanks to Paul Guyot)</p><p>Own Id: OTP-8685</p></li><li><p><a href="erlang.html#open_port/2"><code class="inline">open_port/2</code></a> with the <code class="inline">spawn</code> and <code class="inline">spawn_executable</code> options
can include an <code class="inline">{env,Env}</code> option. In some cases unsetting variables would not
work on Unix (typically if more variables were unset than were actually
present in the environment).</p><p>Own Id: OTP-8701</p></li><li><p>A user defined CPU topology set via a call to
<a href="erlang.html#system_flag_cpu_topology">erlang:system_flag(cpu_topology, CPUTopology)</a>
was not properly verified, and could in worst case cause an emulator crash.
The emulator crash could only occur when a user defined CPU topology already
existed and was redefined.</p><p>Own Id: OTP-8710</p></li></ul><h3 id="improvements-and-new-features-91" class="section-heading"><a href="#improvements-and-new-features-91" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The grammar for match specifications in ERTS users guide only described the
tracing dialect of match specifications. An informal grammar for the ETS
dialect is added.</p><p>Own Id: OTP-8086 Aux Id: seq11333</p></li><li><p>The module binary from EEP31 (and EEP9) is implemented.</p><p>Own Id: OTP-8217</p></li><li><p>New NIF API function <code class="inline">enif_make_new_binary</code></p><p>Own Id: OTP-8474</p></li><li><p>The guard BIF <a href="erlang.html#is_boolean/1"><code class="inline">is_boolean/1</code></a> (introduced in R10B) has now
been included in the lists of BIFs allowed in guards in the Reference Manual.</p><p>Own Id: OTP-8477</p></li><li><p>Added function <a href="../../apps/stdlib/zip.html#foldl/3"><code class="inline">zip:foldl/3</code></a> to iterate over zip archives.</p><p>Added functions to create and extract escripts. See <a href="../../apps/stdlib/escript.html#create/2"><code class="inline">escript:create/2</code></a> and
<a href="../../apps/stdlib/escript.html#extract/2"><code class="inline">escript:extract/2</code></a>.</p><p>The undocumented function <code class="inline">escript:foldl/3</code> has been removed. The same
functionality can be achieved with the more flexible functions
<a href="../../apps/stdlib/escript.html#extract/2"><code class="inline">escript:extract/2</code></a> and <a href="../../apps/stdlib/zip.html#foldl/3"><code class="inline">zip:foldl/3</code></a>.</p><p>Record fields has been annotated with type info. Source files as been adapted
to fit within 80 chars and trailing whitespace has been removed.</p><p>Own Id: OTP-8521</p></li><li><p>A regular expression with many levels of parenthesis could cause a buffer
overflow. That has been corrected. (Thanks to Michael Santos.)</p><p>Own Id: OTP-8539</p></li><li><p><code class="inline">erlang:decode_packet(httph_bin,..)</code> could return corrupt header strings or
even crash the VM. This has been fixed. It only happened on 32-bit VM if the
header name was unknown and between 16 and 20 characters long. Sockets with
simular <code class="inline">packet</code> option did not suffer from this bug.</p><p>Own Id: OTP-8548</p></li><li><p>New NIF features:</p><ul><li>Send messages from a NIF, or from thread created by NIF, to any local
process (<code class="inline">enif_send</code>)</li><li>Store terms between NIF calls (<code class="inline">enif_alloc_env</code>, <code class="inline">enif_make_copy</code>)</li><li>Create binary terms with user defined memory management
(<code class="inline">enif_make_resource_binary</code>)</li></ul><p>And some incompatible changes made to the API. For more information see the
warning text in <a href="erl_nif.html">erl_nif(3)</a>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-8555</p></li><li><p>If the '<code class="inline">fop</code>' program (needed for building PDF files) cannot not be found, it
is now possible to build the HTML and man pages anyway (there will also be
dummy PDF files with no real content created). (Thanks to Tuncer Ayaz.)</p><p>Own Id: OTP-8559</p></li><li><p>When defining macros the closing right parenthesis before the dot is now
mandatory.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-8562</p></li><li><p>Local and imported functions now override the auto-imported BIFs when the
names clash. The pre R14 behaviour was that auto-imported BIFs would override
local functions. To avoid that old programs change behaviour, the following
will generate an error:</p><ul><li>Doing a call without explicit module name to a local function having a name
clashing with the name of an auto-imported BIF that was present (and
auto-imported) before OTP R14A</li><li>Explicitly importing a function having a name clashing with the name of an
autoimported BIF that was present (and autoimported) before OTP R14A</li><li>Using any form of the old compiler directive <code class="inline">nowarn_bif_clash</code></li></ul><p>If the BIF was added or auto-imported in OTP R14A or later, overriding it with
an import or a local function will only result in a warning,</p><p>To resolve clashes, you can either use the explicit module name <code class="inline">erlang</code> to
call the BIF, or you can remove the auto-import of that specific BIF by using
the new compiler directive <code class="inline">-compile({no_auto_import,[F/A]}).</code>, which makes
all calls to the local or imported function without explicit module name pass
without warnings or errors.</p><p>The change makes it possible to add auto-imported BIFs without breaking or
silently changing old code in the future. However some current code
ingeniously utilizing the old behaviour or the <code class="inline">nowarn_bif_clash</code> compiler
directive, might need changing to be accepted by the compiler.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-8579</p></li><li><p>A bug in re that could cause certain regular expression matches never to
terminate is corrected. (Thanks to Michael Santos and Gordon Guthrie.)</p><p>Own Id: OTP-8589</p></li><li><p>The erlang:open_port spawn and spawn_executable directives can include an
<code class="inline">{env,Env}</code> directive to set up environment variables for the spawned process.
A bug prevented applications from using <code class="inline">{env,Env}</code> to set an environment
variable whose value ended with a '<code class="inline">=</code>' (equal sign) character; the trailing
equal sign was mistaken as an indication that an environment variable was to
be cleared from the environment of the spawned process. (Thanks to Steve
Vinoski.)</p><p>Own Id: OTP-8614</p></li><li><p><code class="inline">receive</code> statements that can only read out a newly created reference are now
specially optimized so that it will execute in constant time regardless of the
number of messages in the receive queue for the process. That optimization
will benefit calls to <code class="inline">gen_server:call()</code>. (See <code class="inline">gen:do_call/4</code> for an example
of a receive statement that will be optimized.)</p><p>Own Id: OTP-8623</p></li><li><p>The functions file:advise/4 and file:datasync/1 have been added. (Thanks to
Filipe David Manana.)</p><p>Own Id: OTP-8637</p></li><li><p>New NIF API functions: <code class="inline">enif_make_atom_len</code>, <code class="inline">enif_make_existing_atom_len</code>,
<code class="inline">enif_make_string_len</code>, <code class="inline">enif_get_atom_length</code>, <code class="inline">enif_get_list_length</code>,
<code class="inline">enif_is_list</code>, <code class="inline">enif_is_tuple</code> (by Tuncer Ayaz)</p><p>Own Id: OTP-8640</p></li><li><p>Support for using gcc's built-in functions for atomic memory access has been
added. This functionality will be used if available and no other native atomic
implementation in ERTS is available.</p><p>Own Id: OTP-8659</p></li><li><p>The number of spinlocks used when implementing atomic fall-backs when no
native atomic implementation is available has been increased from 16 to 1024.</p><p>Own Id: OTP-8660</p></li><li><p>Writer preferred pthread read/write locks has been enabled on Linux.</p><p>Own Id: OTP-8661</p></li><li><p>The runtime system will by default bind schedulers to logical processors using
the <code class="inline">default_bind</code> bind type if the amount of schedulers are at least equal to
the amount of logical processors configured, binding of schedulers is
supported, and a CPU topology is available at startup.</p><p><em>NOTE:</em> If the Erlang runtime system is the only operating system process that
binds threads to logical processors, this improves the performance of the
runtime system. However, if other operating system processes (as for example
another Erlang runtime system) also bind threads to logical processors, there
might be a performance penalty instead. If this is the case you, are are
advised to unbind the schedulers using the <a href="erl_cmd.html#%2Bsbt">+sbtu</a> command
line argument, or by invoking
<a href="erlang.html#system_flag_scheduler_bind_type">erlang:system_flag(scheduler_bind_type, unbound)</a>.</p><p>Own Id: OTP-8666</p></li><li><p>The recently added BIFs erlang:min/2, erlang:max/2 and erlang:port_command/3
are now auto-imported (as they were originally intended to be). Due to the
recent compiler change (OTP-8579), the only impact on old code defining it's
own min/2, max/2 or port_command/3 functions will be a warning, the local
functions will still be used. The warning can be removed by using
-compile({no_auto_import,[min/2,max/2,port_command/3]}). in the source
file.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-8669 Aux Id: OTP-8579</p></li><li><p>There is a new option 'exclusive' to file:open/2 that uses the OS O_EXCL flag
where supported to open the file in exclusive mode.</p><p>Own Id: OTP-8670</p></li><li><p>Now, binary_to_term/2 is auto-imported. This will cause a compile warning if
and only if a module has got a local function with that name.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-8671</p></li><li><p>Alignment of scheduler data and run queues were adjusted.</p><p>Own Id: OTP-8673</p></li><li><p>Call time breakpoint tracing</p><ul><li>Introduce a <code class="inline">call_time</code> option to <a href="erlang.html#trace_pattern/3"><code class="inline">erlang:trace_pattern/3</code></a>.This option
enables call time breakpoint tracing on code that is executed by processes
with call tracing enabled. Call time tracing stores the number of calls and
the time spent of each function with this trace pattern enabled. The
information can be retrieved with <a href="erlang.html#trace_info/2"><code class="inline">erlang:trace_info/2</code></a></li><li>Add a scheduler array for BpData. To solve the issue of multiple schedulers
constantly updating the head pointer to the bp data wheel, each scheduler
now has its own entrypoint to the wheel. This head pointer can be updated
without a locking being taken.</li></ul><p>Teach call count tracing to use atomics</p><ul><li>Call count previously used a global lock for accessing and writing its
counter in the breakpoint. This is now changed to atomics instead.</li><li>The change will let call count tracing and cprof to scale better when
increasing the number of schedulers.</li></ul><p>Own Id: OTP-8677</p></li><li><p><code class="inline">eprof</code> has been reimplemented with support in the Erlang virtual machine and
is now both faster (i.e. slows down the code being measured less) and scales
much better. In measurements we saw speed-ups compared to the old eprof
ranging from 6 times (for sequential code that only uses one scheduler/core)
up to 84 times (for parallel code that uses 8 cores).</p><p>Note: The API for the <code class="inline">eprof</code> has been cleaned up and extended. See the
documentation.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-8706</p></li></ul><h2 id="erts-5-7-5-2" class="section-heading"><a href="#erts-5-7-5-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.7.5.2</span></h2><h3 id="known-bugs-and-problems-6" class="section-heading"><a href="#known-bugs-and-problems-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Known Bugs and Problems</span></h3><ul><li><p>Two bugs in gen_sctp has been corrected: getopts/setopts hence also send could
only be called from socket owner, and options 'linger', 'rcvbuf' and 'sndbuf'
was read from wrong protocol layer hence read wrong values by getopts.</p><p>Own Id: OTP-9544</p></li></ul><h2 id="erts-5-7-5-1" class="section-heading"><a href="#erts-5-7-5-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.7.5.1</span></h2><h3 id="fixed-bugs-and-malfunctions-320" class="section-heading"><a href="#fixed-bugs-and-malfunctions-320" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Driver threads, such as async threads, using
<a href="erl_driver.html#ErlDrvPDL">port data locks</a> peeked at the port status field
without proper locking when looking up the driver queue.</p><p>Own Id: OTP-8475</p></li><li><p>A call to the BIF <a href="erlang.html#unregister/1"><code class="inline">unregister(RegName)</code></a> when a port had the
name <code class="inline">RegName</code> registered in the runtime system without SMP support caused a
runtime system crash. (Thanks to Per Hedeland for the bugfix and test case.)</p><p>Own Id: OTP-8487</p></li><li><p>Fix memory management bug causing crash of non-SMP emulator with async threads
enabled. The bug did first appear in R13B03.</p><p>Own Id: OTP-8591 Aux Id: seq11554</p></li></ul><h2 id="erts-5-7-5" class="section-heading"><a href="#erts-5-7-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.7.5</span></h2><h3 id="fixed-bugs-and-malfunctions-321" class="section-heading"><a href="#fixed-bugs-and-malfunctions-321" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix <code class="inline">binary_to_term</code> crash on compressed term with corrupt size field.</p><p>Own Id: OTP-8336</p></li><li><p>Processes and/or ports could get stuck on a blocked scheduler when
<code class="inline">erlang:system_flag(multi_scheduling, block)</code> was used.</p><p>Processes and/or ports could get stuck on an offline scheduler when schedulers
online were reduced using
<code class="inline">erlang:system_flag(schedulers_online, SchedulersOnline)</code>.</p><p>Own Id: OTP-8342</p></li><li><p>Building on Windows will now work if the paths to <code class="inline">mc.exe</code> and <code class="inline">rc.exe</code>
contain spaces. The README.win32 file has been updated with some information
about building using Visual Studio 2008. (Thanks to Andrew Thompson.)</p><p>Own Id: OTP-8345</p></li><li><p>EPMD now correctly handles the extra data field which can be given in the
ALIVE2_REQ request and retrieved in the PORT2_RESP response. (Thanks to Klas
Johansson.)</p><p>Own Id: OTP-8361</p></li><li><p>The configure test for reliable floating point exceptions has been update to
work on modern versions of Mac OS X. (Thanks to Trannie Carter.)</p><p>Own Id: OTP-8368</p></li><li><p>ERTS makefiles used to detect the use of a gcc C compiler by checking if CC
equaled gcc. That is, the makefiles failed to detect gcc C compilers with
other command line names than gcc. `configure' now substitute GCC into the
makefiles. If CC is a gcc C compiler, GCC will have the value yes. (Thanks to
Jean-SÃ©bastien PÃ©dron)</p><p>Own Id: OTP-8373</p></li><li><p>ETS bug causing the <code class="inline">memory</code> counter from <code class="inline">ets:info</code> for ordered_set's to
sometimes get out of synch and absurdly high.</p><p>Own Id: OTP-8377 Aux Id: seq11442</p></li><li><p>Immediately repeated multi-scheduling block/unblock cycles using
<code class="inline">erlang:system_flag(multi_scheduling, block | unblock)</code> could deadlock the
runtime system.</p><p>Own Id: OTP-8386</p></li><li><p>A number of bugs concerning re and unicode are corrected:</p><p>re:compile no longer loses unicode option, which also fixes bug in re:split.</p><p>re:replace now handles unicode charlist replacement argument</p><p>re:replace now handles unicode RE charlist argument correctly</p><p>re:replace now handles binary unicode output correctly when nothing is
replaced.</p><p>Most code, testcases and error isolation done by Rory Byrne.</p><p>Own Id: OTP-8394</p></li><li><p>The loading of native code was not properly atomic in the SMP emulator, which
could cause crashes. Also a per-MFA information table for the native code has
now been protected with a lock since it turns that it could be accessed
concurrently in the SMP emulator. (Thanks to Mikael Pettersson.)</p><p>Own Id: OTP-8397</p></li><li><p>Fix processes in exiting status that are about to be scheduled, to not be
allowed to garbage collect.</p><p>Own Id: OTP-8420</p></li><li><p>Removed bogus &quot;\011&quot; character sequence in documentation.</p><p>Own Id: OTP-8422</p></li><li><p>The resolver routines failed to look up the own node name as hostname, if the
OS native resolver was erroneously configured, bug reported by Yogish Baliga,
now fixed.</p><p>The resolver routines now tries to parse the hostname as an IP string as most
OS resolvers do, unless the native resolver is used.</p><p>The DNS resolver inet_res and file resolver inet_hosts now do not read OS
configuration files until they are needed. Since the native resolver is
default, in most cases they are never needed.</p><p>The DNS resolver's automatic updating of OS configuration file data
(/etc/resolv.conf) now uses the 'domain' keyword as default search domain if
there is no 'search' keyword.</p><p>Own Id: OTP-8426 Aux Id: OTP-8381</p></li><li><p>The re module: A regular expression with an option change at the start of a
pattern that had top-level alternatives could cause overwriting and/or a
crash. (Thanks to Michael Santos.)</p><p>Own Id: OTP-8438</p></li><li><p>Harmless buffer overflow by one byte in asn1 and ram_file_drv.</p><p>Own Id: OTP-8451</p></li></ul><h3 id="improvements-and-new-features-92" class="section-heading"><a href="#improvements-and-new-features-92" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Improved GC performance after BIF/NIF call when a lot of heap fragments was
created. This will mainly benefit NIFs that return large compound terms.</p><p>Own Id: OTP-8240</p></li><li><p>Incompatible changes in the experimental NIF feature.</p><ul><li>Changed the NIF function prototypes in order to allow more than 3 function
arguments.</li><li><code class="inline">enif_get_data</code> renamed as <code class="inline">enif_priv_data</code>.</li><li><code class="inline">enif_make_string</code> got a third argument for character encoding.</li><li>The return value of <a href="erlang.html#load_nif/2"><code class="inline">erlang:load_nif/2</code></a> on error changed.</li></ul><p>Read more in the documentation of <code class="inline">erl_nif</code> and <a href="erlang.html#load_nif/2"><code class="inline">erlang:load_nif/2</code></a></p><p>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-8304</p></li><li><p>Cross compilation improvements and other build system improvements.</p><p>Most notable:</p><ul><li>Lots of cross compilation improvements. The old cross compilation support
was more or less non-existing as well as broken. Please, note that the cross
compilation support should still be considered as experimental. Also note
that old cross compilation configurations cannot be used without
modifications. For more information on cross compiling Erlang/OTP see the
<code class="inline">$ERL_TOP/INSTALL-CROSS.md</code> file.</li><li>Support for staged install using
<a href="http://www.gnu.org/prep/standards/html_node/DESTDIR.html">DESTDIR</a>. The old
broken <code class="inline">INSTALL_PREFIX</code> has also been fixed. For more information see the
<code class="inline">$ERL_TOP/INSTALL.md</code> file.</li><li>Documentation of the <code class="inline">release</code> target of the top <code class="inline">Makefile</code>. For more
information see the <code class="inline">$ERL_TOP/INSTALL.md</code> file.</li><li><code class="inline">make install</code> now by default creates relative symbolic links instead of
absolute ones. For more information see the <code class="inline">$ERL_TOP/INSTALL.md</code> file.</li><li><code class="inline">$ERL_TOP/configure --help=recursive</code> now works and prints help for all
applications with <code class="inline">configure</code> scripts.</li><li>Doing <code class="inline">make install</code>, or <code class="inline">make release</code> directly after <code class="inline">make all</code> no longer
triggers miscellaneous rebuilds.</li><li>Existing bootstrap system is now used when doing <code class="inline">make install</code>, or
<code class="inline">make release</code> without a preceding <code class="inline">make all</code>.</li><li>The <code class="inline">crypto</code> and <code class="inline">ssl</code> applications use the same runtime library path when
dynamically linking against <code class="inline">libssl.so</code> and <code class="inline">libcrypto.so</code>. The runtime
library search path has also been extended.</li><li>The <code class="inline">configure</code> scripts of Erl_interface and ODBC now search for thread
libraries and thread library quirks the same way as ERTS do.</li><li>The <code class="inline">configure</code> script of the <code class="inline">odbc</code> application now also looks for odbc
libraries in <code class="inline">lib64</code> and <code class="inline">lib/64</code> directories when building on a 64-bit
system.</li><li>The <code class="inline">config.h.in</code> file in the <code class="inline">erl_interface</code> application is now
automatically generated in instead of statically updated which reduces the
risk of <code class="inline">configure</code> tests without any effect.</li></ul><p>(Thanks to Henrik Riomar for suggestions and testing)</p><p>(Thanks to Winston Smith for the AVR32-Linux cross configuration and testing)</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-8323</p></li><li><p>NIF improvements:</p><ul><li>Driver API for multi-threading made available for NIFs.</li><li>Support for mempory managed (garbage collected) resource objects. A way to
pass &quot;pointers&quot; to native data structures between C and Erlang in a safe
way.</li><li>Support for references, floats and term comparison.</li><li>Various new functions, like <code class="inline">enif_inspect_iolist_as_binary</code>,
<code class="inline">enif_make_sub_binary</code>, <code class="inline">enif_get_string</code>, <code class="inline">enif_get_atom</code>,
<code class="inline">enif_make_tuple_from_array</code>, <code class="inline">enif_make_list_from_array</code>,
<code class="inline">enif_make_existing_atom</code>.</li></ul><p>Own Id: OTP-8335</p></li><li><p>Minor alignment adjustments of scheduler specific data.</p><p>Own Id: OTP-8341</p></li><li><p>The documentation is now possible to build in an open source environment after
a number of bugs are fixed and some features are added in the documentation
build process.</p><p>- The arity calculation is updated.</p><p>- The module prefix used in the function names for bif's are removed in the
generated links so the links will look like
&quot;<a href="http://www.erlang.org/doc/man/erlang.html#append_element-2%22">http://www.erlang.org/doc/man/erlang.html#append_element-2&quot;</a> instead of
&quot;<a href="http://www.erlang.org/doc/man/erlang.html#erlang:append_element-2%22">http://www.erlang.org/doc/man/erlang.html#erlang:append_element-2&quot;</a>.</p><p>- Enhanced the menu positioning in the html documentation when a new page is
loaded.</p><p>- A number of corrections in the generation of man pages (thanks to Sergei
Golovan)</p><p>- The legal notice is taken from the xml book file so OTP's build process can
be used for non OTP applications.</p><p>Own Id: OTP-8343</p></li><li><p>There is new <a href="erlang.html#binary_to_term/2"><code class="inline">erlang:binary_to_term/2</code></a> BIF that takes an option list. The
option <code class="inline">safe</code> can be used to prevent creation of resources that are not
garbage collected (such as atoms). (Thanks to Jayson Vantuyl.)</p><p>Own Id: OTP-8367</p></li><li><p>The default settings for garbage collection of binaries has been adjusted to
be less aggressive than in R13B03. It is now also possible configure the
settings for binary GC. See the documentation for <code class="inline">spawn_opt/2-5</code>,
<a href="erlang.html#system_info/1"><code class="inline">erlang:system_info/1</code></a>, <a href="erlang.html#system_flag/2"><code class="inline">erlang:system_flag/2</code></a>, <code class="inline">process_flag/2-3</code>,
<a href="erlang.html#trace/3"><code class="inline">erlang:trace/3</code></a>, and the documentation for <code class="inline">erl</code> for the new command line
options <code class="inline">+hms</code> and <code class="inline">+hmbs</code>.</p><p>Own Id: OTP-8370</p></li><li><p>A bug causing memory corruption in re:run() has been corrected. (Thanks to
Yamashina Hio.)</p><p>Own Id: OTP-8375</p></li><li><p>The <code class="inline">-Werror</code> option for <code class="inline">erlc</code> and the compiler option <code class="inline">warnings_as_errors</code>
will cause warnings to be treated as errors. (Thanks to Christopher Faulet.)</p><p>Own Id: OTP-8382</p></li><li><p>Explicit top directories in archive files are now optional.</p><p>For example, if an archive (app-vsn.ez) just contains an app-vsn/ebin/mod.beam
file, the file info for the app-vsn and app-vsn/ebin directories are faked
using the file info from the archive file as origin. The virtual directories
can also be listed. For short, the top directories are virtual if they does
not exist.</p><p>Own Id: OTP-8387</p></li><li><p>An unnecessary lock operation in os:timestamp/0 has been eliminated, making it
slightly more efficient. (Thanks to Jonas Falkevik and Tuncer Ayaz.)</p><p>Own Id: OTP-8390</p></li><li><p>There is a new <code class="inline">+t</code> emulator option for changing the maximum number of atoms.
(Thanks to Julien Barbot.)</p><p>Own Id: OTP-8405</p></li><li><p>Fixed numerous compiler warnings generated by gcc 4.4.1 and tile-cc
2.0.1.78377 when compiling the runtime system.</p><p>Own Id: OTP-8412</p></li><li><p><code class="inline">configure</code> learned the option <code class="inline">--enable-m32-build</code> to force the building of a
32-bit run-time on systems where the default C compiler generates 64-bit
executables by default.</p><p>Own Id: OTP-8415</p></li><li><p>HiPE now works in the 64-bit emulator on Mac OS X. (Thanks to Geoff Cant.)</p><p>Own Id: OTP-8416</p></li><li><p>Improved handling of symbolic links to escripts</p><p>Own Id: OTP-8417</p></li><li><p>Add lock profiling tool.</p><p>The Lock profiling tool, lcnt, can make use of the internal lock statistics
when the runtime system is built with this feature enabled.</p><p>This provides a mechanism to examine potential lock bottlenecks within the
runtime itself.</p><p>- Add erts_debug:lock_counters({copy_save, bool()}). This option enables or
disables statistics saving for destroyed processes and ets-tables. Enabling
this might consume a lot of memory.</p><p>- Add id-numbering for lock classes which is otherwise undefined.</p><p>Own Id: OTP-8424</p></li><li><p>Removed spurious options to the emulator from escript.</p><p>Own Id: OTP-8427</p></li><li><p>Minor documentation fixes. Mainly anchor adjustments.</p><p>Own Id: OTP-8457</p></li></ul><h2 id="erts-5-7-4" class="section-heading"><a href="#erts-5-7-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.7.4</span></h2><h3 id="fixed-bugs-and-malfunctions-322" class="section-heading"><a href="#fixed-bugs-and-malfunctions-322" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>An insufficient stack allocation was made when reading CPU information on BSD
operating systems. (Thanks Michael Turner and Akira Kitada)</p><p>Own Id: OTP-8207</p></li><li><p>A bug when supplying an argument without a dash directly after the program
name when starting erlang could prevent distribution to start. This is now
corrected.</p><p>Own Id: OTP-8209</p></li><li><p>A ticker process could potentially be blocked indefinitely trying to send a
tick to a node not responding. If this happened, the connection would not be
brought down as it should.</p><p>Own Id: OTP-8218</p></li><li><p>Using certain firewalls (i.e. MS IAS Client and certain versions of COMODO)
could expose an undocumented behaviour in the Win32 socket interface causing
the name resolution calls to hang infinitely. This is now worked around by
adding possibilities for port programs under Windows to use overlapped I/O on
their standard input/output file handles.</p><p>Own Id: OTP-8230</p></li><li><p>Fixed bug on ETS tables with <code class="inline">write_concurrency</code>. The emulator could crash
when doing a <code class="inline">select</code> or <code class="inline">match</code> with a bound key without finding any object.</p><p>Own Id: OTP-8242</p></li><li><p>The <code class="inline">information-request</code> / <code class="inline">information-response</code>, and
<code class="inline">group-leader-change-request</code> / <code class="inline">group-leader-changed-response</code> signal pairs
described below did not always adhere to the signal order guarantees of
Erlang's signal model in the runtime system with SMP support. These signals
could for example sometimes pass exit signals.</p><p>The following BIFs behaviors can be modeled as if an asynchronous
<code class="inline">information-request</code> signal is sent to <code class="inline">Pid</code>. If <code class="inline">Pid</code> is alive, it responds
with an asynchronous <code class="inline">information-response</code> signal; otherwise, the runtime
system responds with a <code class="inline">no-such-process</code> signal. When the response is
received, the caller transforms it into the result of the BIF.</p><ul><li><a href="erlang.html#is_process_alive/1"><code class="inline">is_process_alive(Pid)</code></a></li><li><code class="inline">erlang:process_display(Pid, Type)</code></li><li><a href="erlang.html#process_info/1"><code class="inline">process_info(Pid)</code></a></li><li><a href="erlang.html#process_info/2"><code class="inline">process_info(Pid, ItemSpec)</code></a></li></ul><p>When <code class="inline">Pid</code> resides on the same node as the caller of
<a href="erlang.html#group_leader/2"><code class="inline">group_leader(GroupLeader, Pid)</code></a>, the
<a href="erlang.html#group_leader/2"><code class="inline">group_leader/2</code></a> BIFs behavior can be modeled as if an
asynchronous <code class="inline">group-leader-change-request</code> signal is sent to <code class="inline">Pid</code>. If <code class="inline">Pid</code>
is alive, it responds with an asynchronous <code class="inline">group-leader-changed-response</code>
signal; otherwise, the runtime system responds with a <code class="inline">no-such-process</code>
signal. When the response is received, the caller transforms it into the
result of the BIF. The distributed case which only consists of an asynchronous
<code class="inline">group-leader-change-request</code> signal and no response is not effected.</p><p>Own Id: OTP-8245</p></li><li><p>Errors in the <code class="inline">system_profile</code> documentation has been corrected.</p><p>Own Id: OTP-8257</p></li><li><p>Low watermark socket option modified high watermark instead of low watermark
in the inet_driver. (Thanks to Feng Yu and Tuncer Ayaz)</p><p>Own Id: OTP-8279</p></li><li><p>A race condition could cause the runtime system with SMP support to end up in
a completely unresponsive state.</p><p>Own Id: OTP-8297</p></li></ul><h3 id="improvements-and-new-features-93" class="section-heading"><a href="#improvements-and-new-features-93" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The use of <code class="inline">pthread_cond_timedwait()</code> have been completely removed from the
runtime system. This since its behavior is unpredictable when the system clock
is suddenly changed. The previous use of it was harmless.</p><p>Own Id: OTP-8193</p></li><li><p>The documentation is now built with open source tools (xsltproc and fop) that
exists on most platforms. One visible change is that the frames are removed.</p><p>Own Id: OTP-8201</p></li><li><p>A new garbage collecting strategy for binaries which is more aggressive than
the previous implementation. Binaries now has a virtual binary heap tied to
each process. When binaries are created or received to a process it will check
if the heap limit has been reached and if a reclaim should be done. This
imitates the behavior of ordinary Erlang terms. The virtual heaps are grown
and shrunk like ordinary heaps. This will lessen the memory footprint of
binaries in a system.</p><p>Own Id: OTP-8202</p></li><li><p>The <code class="inline">ErlDrvTermData</code> term types used by <code class="inline">driver_output_term()</code> and
<code class="inline">driver_send_term()</code> have been extended with the term types <code class="inline">ERL_DRV_INT64</code>,
and <code class="inline">ERL_DRV_UINT64</code> for passing 64-bit integers. Also the 64-bit integer data
types <code class="inline">ErlDrvSInt64</code> and <code class="inline">ErlDrvUInt64</code> have been introduced.</p><p>For more information see the <a href="erl_driver.html">erl_driver(3)</a> documentation.</p><p>Own Id: OTP-8205</p></li><li><p>[escript] The restriction that the first line in escripts must begin with
<code class="inline">#!</code> has been removed.</p><p>[escript] Some command line options to the escript executable has now been
documented. For example you can run an escript in the debugger by just adding
a command line option.</p><p>[escript] The documentation of the escript header syntax has been clarified.
For example the header is optional. This means that it is possible to directly
&quot;execute&quot; <code class="inline">.erl</code>, <code class="inline">.beam</code> and<code class="inline">.zip</code> files.</p><p>Own Id: OTP-8215</p></li><li><p>The instruction for building OTP on Windows was outdated and incomplete, the
document is updated.</p><p>Also the otp_build script required windows drives to show up in Cygwin using
the /cygdrive prefix. That requirement is now removed.</p><p>Own Id: OTP-8219</p></li><li><p>A module can have native implemented functions (NIFs) that are dynamically
loaded by calling <a href="erlang.html#load_nif/2"><code class="inline">erlang:load_nif/2</code></a>. This is an experimental feature that is
not yet intended for production systems. It is released with intention to get
some early feedback on the interfaces before they are carved in stone.</p><p>Own Id: OTP-8220</p></li><li><p>The <a href="erlang.html#float/1"><code class="inline">float/1</code></a> BIF would always force a garbage collection. The
BIFs <a href="erlang.html#size/1"><code class="inline">size/1</code></a>, <a href="erlang.html#byte_size/1"><code class="inline">byte_size/1</code></a>,
<a href="erlang.html#bit_size/1"><code class="inline">bit_size/1</code></a>, <a href="erlang.html#abs/1"><code class="inline">abs/1</code></a>, and <a href="erlang.html#round/1"><code class="inline">round/1</code></a>
would force a garbage-collection if the result was not a sufficiently small
integer.</p><p>Own Id: OTP-8221</p></li><li><p>The <a href="erlang.html#port_command/3"><code class="inline">erlang:port_command/3</code></a> BIF has been added. <a href="erlang.html#port_command/3"><code class="inline">erlang:port_command/3</code></a> is
currently not auto imported, but it is planned to be auto imported in OTP R14.
For more information see the <a href="erlang.html"><code class="inline">erlang</code></a> documentation.</p><p>Own Id: OTP-8225</p></li><li><p>'<code class="inline">configure --enable-darwin-64bit</code>' would fail if Snow Leopard had been booted
with the 64-bit kernel. (Thanks to Ryan M. Graham.)</p><p>Own Id: OTP-8236</p></li></ul><h2 id="erts-5-7-3" class="section-heading"><a href="#erts-5-7-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.7.3</span></h2><h3 id="fixed-bugs-and-malfunctions-323" class="section-heading"><a href="#fixed-bugs-and-malfunctions-323" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>On Windows, open_port({spawn,Command},Opts) could not run executables with
spaces in the path or filename, regardless of quoting efforts. While
open_port({spawn_executable,Exec},Opts) can run any executable, it was still
impossible to use 'spawn' to do the same thing. This is now corrected.</p><p>Own Id: OTP-8055</p></li><li><p>The scheduler bind type <code class="inline">processor_spread</code> spread schedulers too much on large
NUMA systems.</p><p>The new scheduler bind type <code class="inline">spread</code> spreads schedulers as much as possible,
and behaves as <code class="inline">processor_spread</code> previously did. For more information see the
documentation of the <code class="inline">+sbt</code> command line argument in the <a href="erl_cmd.html">erl</a>
documentation, and the documentation of
<code class="inline">erlang:system_flag(scheduler_bind_type, SchedulerBindType)</code>.</p><p>Own Id: OTP-8063</p></li><li><p>Automatically detected CPU topology on Linux system could erroneously contain
logical processors with <code class="inline">-1</code> as identifiers. This happened when
<code class="inline">sysconf(_SC_NPROCESSORS_CONF)</code> returned a value larger than the amount of
logical processors found.</p><p>Own Id: OTP-8064</p></li><li><p>When the minimal term [] (end of list) was sent as the complete message to a
process on another node, and received there, it could not be decoded. This bug
is now corrected. Fortunately [] is uncommon as the complete message in real
applications but it is a serious bug anyway.</p><p>Own Id: OTP-8092</p></li><li><p>A bug when the floating point exception pointer was not initialized has been
corrected. It manifested itself on CentOS 5.1 sometimes when a floating point
value was sent to a remote node. Bug reported and patch suggested by David
Reiss, confirmed by Mikael Pettersson.</p><p>Some build problems on IRIX was also corrected. Problem reported by Patrick
Baggett, patch by Mikael Pettersson.</p><p>Own Id: OTP-8095</p></li><li><p>A terminating process could erroneously unregister a name for another process.
This could occur under the following conditions: The name of the terminating
process was unregistered and then registered for another process
simultaneously as the process that first had the name was terminating.</p><p>Own Id: OTP-8099 Aux Id: seq11344</p></li><li><p>Running erlc in a very deep directory (with a path length of more 256 or more
characters) would cause the emulator to crash in a call to
<a href="erlang.html#list_to_atom/1"><code class="inline">list_to_atom/1</code></a>. (Thanks to Chris Newcombe.)</p><p>Own Id: OTP-8124</p></li><li><p>A deadlock of the runtime system could occur when unregistering the name of a
port.</p><p>Own Id: OTP-8145</p></li><li><p><code class="inline">Makefile.in</code> has been updated to use the LDFLAGS environment variable (if
set). (Thanks to Davide Pesavento.)</p><p>Own Id: OTP-8157</p></li><li><p>The pthread rwlock implementation on Linux could cause starvation of writers.
We, therefore, now use our own rwlock implementation on Linux.</p><p>Own Id: OTP-8158</p></li><li><p>Open source Erlang builds are updated to work well on Snow Leopard (MacOS X
10.6)</p><p>Own Id: OTP-8168</p></li><li><p>A call to <code class="inline">erlang:system_info(schedulers_online)</code> could end up in an infinite
loop. This happened if the amount of schedulers was larger than one, the
amount of schedulers online was one, and someone was blocking
multi-scheduling.</p><p>Own Id: OTP-8169</p></li><li><p>An error in erlang:system_profile/2 could cause timestamped messages to arrive
out of order in the SMP case. This has now been fixed.</p><p>Own Id: OTP-8171</p></li><li><p><a href="erlang.html#binary_to_atom/2"><code class="inline">binary_to_atom/2</code></a> and
<a href="erlang.html#binary_to_existing_atom/2"><code class="inline">binary_to_existing_atom/2</code></a> would leak memory
if the binary contained unaligned data.</p><p>Own Id: OTP-8192</p></li><li><p>The async thread pool in the runtime system without SMP support used a memory
allocator that was not thread safe for async jobs.</p><p>Own Id: OTP-8194</p></li></ul><h3 id="improvements-and-new-features-94" class="section-heading"><a href="#improvements-and-new-features-94" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Processor internal NUMA nodes are now supported in the ERTS internal CPU
topology representation. For more information see the documentation of the
<code class="inline">+sct</code> command line argument in the <a href="erl_cmd.html">erl</a> documentation, and the
documentation of <code class="inline">erlang:system_info(cpu_topology)</code>.</p><p>Own Id: OTP-8041</p></li><li><p>Documentation for ets improved about concurrency.</p><p>Own Id: OTP-8050</p></li><li><p>Emulator flags in an escript were earlier inherited to emulators started from
the emulator running the escript. For example when an escript invoked
<code class="inline">os:cmd(&quot;erl&quot;)</code>, the new emulator were given erroneous emulator flags. This
bug has now been fixed</p><p>Escript filenames may now contain dots.</p><p>Own Id: OTP-8060</p></li><li><p>Made some BIFs non-recursive (relational operators,hash and phash) to limit
internal stack usage.</p><p>Own Id: OTP-8065</p></li><li><p>Fixed Windows specific bug in erl_prim_loader. Now it handles the root
directory (e.g. c:/) better. This bug affected the directory listing in the
debugger.</p><p>Own Id: OTP-8080</p></li><li><p>A TCP socket with option <code class="inline">{packet,4}</code> could crash the emulator if it received
a packet header with a very large size value (&gt;2Gb). The same bug caused
<a href="erlang.html#decode_packet/3"><code class="inline">erlang:decode_packet/3</code></a> to return faulty values. (Thanks to Georgos Seganos.)</p><p>Own Id: OTP-8102</p></li><li><p>The maximum size of the export table has been raised from 65536 to 524288
entries.</p><p>Own Id: OTP-8104 Aux Id: seq11345</p></li><li><p>The file module has now a read_line/1 function similar to the io:get_line/2,
but with byte oriented semantics. The function file:read_line/1 works for raw
files as well, but for good performance it is recommended to use it together
with the 'read_ahead' option for raw file access.</p><p>Own Id: OTP-8108</p></li><li><p>Fixed bug causing emulator crash when reading a term in external format
containing a corrupt list with a negative length.</p><p>Own Id: OTP-8117</p></li><li><p>New emulator flag <code class="inline">+sss</code>, to set stack size of scheduler threads.</p><p>Own Id: OTP-8119</p></li><li><p>The Windows utility Erlsrv, run in interactive mode now accepts options for
registering internal service name and description field of Windows registry
database.</p><p>Own Id: OTP-8132</p></li><li><p><code class="inline">erlang:demonitor(Mon, [flush])</code> has been optimized. Previously it always
searched the message queue of the caller for a <code class="inline">'DOWN'</code> message. Current
implementation only search the message queue when necessary. It is quite
common that the search is not necessary.</p><p>A new option <code class="inline">info</code> has been added to <a href="erlang.html#demonitor/2"><code class="inline">erlang:demonitor/2</code></a>. For more
information see the <a href="erlang.html"><code class="inline">erlang</code></a> documentation.</p><p>Own Id: OTP-8143</p></li><li><p>I/O tasks could unnecessarily be rescheduled. This was harmless, but not
useful work.</p><p>Own Id: OTP-8148</p></li><li><p>Minor improvements of <code class="inline">erlang:memory/[1,2]</code>.</p><p>Own Id: OTP-8152</p></li><li><p>New configuration option to enable use of shared zlib.</p><p>Own Id: OTP-8155</p></li><li><p>Fixed smp bug in ETS that could cause emulator crash when table with more than
1000 objects accessed by several processes, including calls to variants of
<code class="inline">select</code> or <code class="inline">match</code> combined with concurrent object deletion.</p><p>Own Id: OTP-8166 Aux Id: seq11392</p></li><li><p>The code path interpretation is now more relaxed. The flag -code_path_choice
now defaults to relaxed instead of strict. See the documentation of code and
init for more info.</p><p>Own Id: OTP-8170</p></li><li><p>Load balancing of run queues and check for I/O are triggered more often than
before in situations where processes are scheduled often but are doing very
little work each time they execute.</p><p>Own Id: OTP-8172</p></li><li><p>Call tracing binary comprehensions would cause an emulator crash. (Thanks to
Paul Mineiro.)</p><p>Own Id: OTP-8179</p></li><li><p><a href="erlang.html#binary_to_term/1"><code class="inline">binary_to_term/1</code></a> would crash the emulator instead of
generating a <code class="inline">badarg</code> exception when given certain invalid terms. (Thanks to
Scott Lystig Fritchie.)</p><p>Own Id: OTP-8180</p></li></ul><h2 id="erts-5-7-2" class="section-heading"><a href="#erts-5-7-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.7.2</span></h2><h3 id="fixed-bugs-and-malfunctions-324" class="section-heading"><a href="#fixed-bugs-and-malfunctions-324" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Crash dumps should now cause less problems for the crashdump_viewer
application. (For processes where arity was non-zero, the arguments are now
longer printed - they used to be printed in a format that was not parseable.)</p><p>Own Id: OTP-7472 Aux Id: seq11019, 11292</p></li><li><p>Processes could potentially get stuck on an offline scheduler.</p><p>Own Id: OTP-7990</p></li><li><p><a href="erlang.html#binary_to_atom/2"><code class="inline">binary_to_atom/2</code></a> and
<a href="erlang.html#binary_to_existing_atom/2"><code class="inline">binary_to_existing_atom/2</code></a> could leak memory
if they caused a <code class="inline">badarg</code> exception.</p><p>Own Id: OTP-7997</p></li><li><p>A process could under very rare circumstances erroneously be resumed.</p><p>Own Id: OTP-8000</p></li><li><p>Load balancing between schedulers could under rare circumstances cause an
emulator crash.</p><p>Own Id: OTP-8008</p></li><li><p><code class="inline">erlang:memory(processes_used)</code> always returned <code class="inline">0</code> instead of the correct
value. (Thanks to Geoff Cant)</p><p>Own Id: OTP-8022</p></li></ul><h3 id="improvements-and-new-features-95" class="section-heading"><a href="#improvements-and-new-features-95" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Major improvements of the Erlang distribution for Erlang runtime systems with
SMP support. Previously distribution port locks were heavily contended, and
all encoding and decoding for a specific distribution channel had to be done
in sequence. Lock contention due to the distribution is now negligible and
both encoding and decoding of Erlang messages can be done in parallel.</p><p>The old atom cache protocol used by the Erlang distribution has been dropped
since it effectively prevented all parallel encoding and decoding of messages
passed over the same distribution channel.</p><p>A new atom cache protocol has been introduced which isolates atom cache
accesses and makes parallel encoding and decoding of messages passed over the
same distribution channel possible. The new atom cache protocol also use an
atom cache size 8 times larger than before. The new atom cache protocol is
documented in the ERTS users guide.</p><p>Erlang messages received via the distribution are now decoded by the receiving
Erlang processes without holding any distribution channel specific locks.
Erlang messages and signals sent over the distribution are as before encoded
by the sending Erlang process, but now without holding any distribution
channel specific locks during the encoding. That is, both encoding and
decoding can be and are done in parallel regardless of distribution channel
used.</p><p>The part that cannot be parallelized is the atom cache updates. Atom cache
updates are therefore now scheduled on the distribution port. Since it is only
one entity per distribution channel doing this work there is no lock
contention due to the atom cache updates.</p><p>The new runtime system does not understand the old atom cache protocol. New
and old runtime systems can however still communicate, but no atom cache will
be used.</p><p>Own Id: OTP-7774</p></li><li><p>Fixed a bug that caused error logging from <code class="inline">driver_select</code> sometimes with
additional symptoms such as failing IP communications or even an emulator
crash.</p><p>Own Id: OTP-7898 Aux Id: seq11304</p></li><li><p>Improved SMP concurrency for ETS tables. Several mutating operations can now
be performed truly concurrent on different records of the same table. To
support this, the table has to be created with option <code class="inline">write_concurrency</code>, as
it is achieved at the expense of some execution and memory overhead.
<code class="inline">ets:select</code> and <code class="inline">select_count</code> has also been improved for all tables to not
acquire exclusive table lock during the iteration.</p><p>Own Id: OTP-7922</p></li><li><p>erl (that is erl.exe and dyn_erl) and erlexec has been made more dynamic so no
hard coded paths needs to added at installation time to erl (that is erl.ini
and erl). Reltool will make use of this in a future release.</p><p>Own Id: OTP-7952</p></li><li><p>Added functionality to get higher resolution timestamp from system. The
erlang:now function returns a timestamp that's not always consistent with the
actual operating system time (due to resilience against large time changes in
the operating system). The function os:timestamp/0 is added to get a similar
timestamp as the one being returned by erlang:now, but untouched by Erlangs
time correcting and smoothing algorithms. The timestamp returned by
os:timestamp is always consistent with the operating systems view of time,
like the calendar functions for getting wall clock time, but with higher
resolution. Example of usage can be found in the os manual page.</p><p>Own Id: OTP-7971</p></li><li><p>Two new options are added to open_port - spawn_executable which runs external
executables in a controlled way, and spawn_driver which only opens port to
loaded Erlang drivers. See the erlang manual page for details.</p><p>Own Id: OTP-7995</p></li><li><p>New functionality in ETS to transfer the ownership of a table. A table can
either change owner be declaring an &quot;heir&quot;, another process that will inherit
the table if the owner terminates. A table can also change owner by calling a
new function <code class="inline">ets:give_away</code>.</p><p>Own Id: OTP-8006</p></li><li><p>Updates to Tilera build environment.</p><p>Own Id: OTP-8009</p></li><li><p>A stack trace was unnecessarily saved during process termination.</p><p>Own Id: OTP-8014</p></li><li><p>User defined CPU topology and scheduler bind type can now be set from the
command line when starting an emulator. For more information see the
documentation of the <code class="inline">+sct</code>, and the <code class="inline">+sbt</code> emulator flags in the
<a href="erl_cmd.html">erl</a> documentation.</p><p>The CPU topologies returned from <a href="erlang.html#system_info/1"><code class="inline">erlang:system_info/1</code></a> and
<a href="erlang.html#system_flag/2"><code class="inline">erlang:system_flag/2</code></a> now always contain the <code class="inline">processor</code> level, also when not
strictly necessary.</p><p>Own Id: OTP-8030</p></li><li><p>Various fixes in ETS: <code class="inline">ets:first</code> could return a deleted key in a fixated
table. <code class="inline">ets:lookup</code> could return objects out of order if a deleted object was
re-inserted into a fixed bag. <code class="inline">ets:delete_object</code> could fail to delete
duplicate objects in a duplicate_bag.</p><p>Own Id: OTP-8040</p></li></ul><h2 id="erts-5-7-1" class="section-heading"><a href="#erts-5-7-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.7.1</span></h2><h3 id="fixed-bugs-and-malfunctions-325" class="section-heading"><a href="#fixed-bugs-and-malfunctions-325" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug on Windows that could make <code class="inline">gen_tcp:send</code> hang trying to send an
iolist of more than 16 binaries.</p><p>Own Id: OTP-7816</p></li><li><p>The runtime system could under rare circumstances crash during load balancing.</p><p>Own Id: OTP-7908 Aux Id: otp-7500</p></li><li><p><code class="inline">run_erl</code> uses fallback if Unix98 pseudo-terminal is not present on host.</p><p>Own Id: OTP-7916 Aux Id: seq11249</p></li><li><p>A message buffer memory leak in the runtime system without smp support has
been fixed.</p><p>Own Id: OTP-7941</p></li><li><p>Attempting to append a binary of 16Mb or greater to another binary using the
bit syntax would cause a <code class="inline">system_limit</code> exception. There was also several
cases when constructing binaries when a <code class="inline">badarg</code> exception was generated when
it should have been <code class="inline">system_limit</code>.</p><p>Own Id: OTP-7942</p></li><li><p>The runtime system with SMP support failed to terminate the caller of
<a href="erlang.html#link/1"><code class="inline">link(RemotePid)</code></a> properly, if <code class="inline">RemotePid</code> was the pid of a
process on an unreachable node. The calling process was in this case marked as
exiting, but never terminated.</p><p>Own Id: OTP-7946</p></li></ul><h3 id="improvements-and-new-features-96" class="section-heading"><a href="#improvements-and-new-features-96" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Rudimentary support for cross compiling is added to the source release. The
support is still in its infancy and has only been used to cross compile on
Linux for a different cpu architecture and a different Linux version, but
should be extendible to support other platforms as well. The cross
configuration files with examples are placed in $ERL_TOP/xcomp/. View
README.xcomp and run $ERL_TOP/otp_build -help for further information.</p><p>Own Id: OTP-7854</p></li><li><p>The escape sequence <code class="inline">\{</code> which was given a new interpretation in R13A has
retained its old meaning (the ASCII code for <code class="inline">{</code>), which means that codes
greater than 255 have to be stated using hexadecimal characters (for example,
<code class="inline">\x{AAA}</code>). The escape sequence <code class="inline">\xH</code> where H is a hexadecimal character
followed by something else but a hexadecimal character is no longer valid
(incompatibility with R13A). Character codes less than 256 can be stated using
two hexadecimal characters (for example, <code class="inline">\x0D</code>).</p><p>Own Id: OTP-7891 Aux Id: OTP-7855</p></li><li><p>The <a href="erlang.html#term_to_binary/1"><code class="inline">term_to_binary/1</code></a> BIF used to be implemented with
recursive C code, which could cause the Erlang emulator to terminate because
of a stack overflow.</p><p>Also fixed some minor issues in <a href="erlang.html#term_to_binary/1"><code class="inline">term_to_binary/1</code></a> and
<a href="erlang.html#binary_to_term/1"><code class="inline">binary_to_term/1</code></a> pointed out by Matthew Dempsky.</p><p>Own Id: OTP-7894</p></li><li><p>Several glitches and performance issues in the Unicode and I/O-system
implementation of R13A have been corrected.</p><p>Own Id: OTP-7896 Aux Id: OTP-7648 OTP-7887</p></li><li><p>Minor documentation improvements of the <code class="inline">scheduler_bind_type</code> argument of
<a href="erlang.html#system_flag/2"><code class="inline">erlang:system_flag/2</code></a>, and the <code class="inline">scheduler_bind_type</code>, and the
<code class="inline">scheduler_bindings</code> arguments of <a href="erlang.html#system_info/1"><code class="inline">erlang:system_info/1</code></a>.</p><p>Own Id: OTP-7901 Aux Id: OTP-7777</p></li><li><p>There is a new BIF <a href="erlang.html#make_tuple/3"><code class="inline">erlang:make_tuple/3</code></a>.</p><p>Own Id: OTP-7913</p></li></ul><h2 id="erts-5-7" class="section-heading"><a href="#erts-5-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.7</span></h2><h3 id="fixed-bugs-and-malfunctions-326" class="section-heading"><a href="#fixed-bugs-and-malfunctions-326" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><em>OpenSource:</em></p><p>FreeBSD leap-seconds are handled according to patch submitted by OpenSource
user Kenji Rikitake. No test case covers this functionality (unsupported
platform).</p><p>Own Id: OTP-7609</p></li><li><p>A corrected bug in ETS for <code class="inline">bag</code> and <code class="inline">duplicate_bag</code>. A <code class="inline">delete/2</code> or
<code class="inline">lookup_element/3</code> could miss objects in a fixed table if one or more objects
with the same key had already been deleted.</p><p>Own Id: OTP-7665</p></li><li><p>A new driver call-back <code class="inline">stop_select</code> is introduced to allow drivers to
de-select and then close a file descriptor in a safe way in a SMP emulator.
The old way was not strictly according to posix standard and could in some
rare cases lead to unexpected behavior. A new flag <code class="inline">ERL_DRV_USE</code> can be passed
to <code class="inline">driver_select()</code> to tell it that the descriptor should be closed.
<code class="inline">stop_select</code> is then called when it is safe to do so. Old drivers will
however still work as before.</p><p>Own Id: OTP-7670</p></li><li><p>A bug fixed for TCP sockets with option <code class="inline">{packet,http}</code>. An HTTP request with
an absolute URI was returned with a corrupt path string. This bug did only
exist in R12B-4 and R12B-5.</p><p>Own Id: OTP-7682 Aux Id: OTP-7647</p></li><li><p>run_erl did in some cases fail to extract control sequences from to_erl (like:
winsize=X,Y) and did instead send them to be interpreted by the erlang shell.</p><p>Own Id: OTP-7688</p></li><li><p>A bug in the installer on Windows not updating file associations properly is
now corrected.</p><p>Own Id: OTP-7746</p></li><li><p>More space than necessary could be allocated in binaries when appending to a
binary (also in a binary comprehension) and the data appended did not consist
of wholes bytes (e.g. 13 bits).</p><p>Own Id: OTP-7747</p></li><li><p>The gen_sctp option sctp_peer_addr_params,
#sctp_paddrparams{address={IP,Port} was erroneously decoded in the inet
driver. This bug has now been corrected.</p><p>Own Id: OTP-7755</p></li><li><p>Outstanding async driver jobs leaked memory if the issuing port died before
the async jobs completed.</p><p>Own Id: OTP-7784</p></li><li><p>A bug in the dynamic library loading affecting, among others, OpenSolaris is
now corrected. (Thanks to Paul Fisher.)</p><p>Own Id: OTP-7796</p></li><li><p>run_erl compile errors fixed for FreeBSD</p><p>Own Id: OTP-7817</p></li><li><p>A bug in the inet driver for SCTP on Solaris showing for e.g gen_sctp:abort/1
and gen_sctp:eof/1 has been corrected. Patch suggestion by Simon Cornish.</p><p>Own Id: OTP-7866</p></li></ul><h3 id="improvements-and-new-features-97" class="section-heading"><a href="#improvements-and-new-features-97" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The order of objects visited in select for ordered_set is now documented.</p><p>Own Id: OTP-7339</p></li><li><p>The runtime system with SMP support now uses multiple, scheduler specific run
queues, instead of one globally shared run queue.</p><p>The lock protecting the shared run queue was heavily contended, and the shared
run queue also caused Erlang processes to randomly migrate between schedulers
with negative cache effects as a result.</p><p>With the current scheduler specific run queue solution, lock contention due to
run queue protection has been reduced, and Erlang processes are only migrated
when needed to balance the load between the schedulers. The reduced amount of
migration also reduce lock contention on locks protecting the scheduler
specific instances of the erts internal memory allocators.</p><p>The scheduler specific run queues are also a necessity for a lot of future
planned NUMA (Non-Uniform Memory Access) specific optimizations.</p><p>Own Id: OTP-7500</p></li><li><p>Support for Unicode is implemented as described in EEP10. Formatting and
reading of unicode data both from terminals and files is supported by the io
and io_lib modules. Files can be opened in modes with automatic translation to
and from different unicode formats. The module 'unicode' contains functions
for conversion between external and internal unicode formats and the re module
has support for unicode data. There is also language syntax for specifying
string and character data beyond the ISO-latin-1 range.</p><p>The interactive shell will support input and output of unicode characters when
the terminal and operating system supports it.</p><p>Please see the EEP and the io/io_lib manual pages as well as the stdlib users
guide for details.</p><p><em>I/O-protocol incompatibilities:</em></p><p>The io<em>protocol between io_Server and client is updated to handle protocol
data in unicode formats. The updated protocol is now documented. The
specification resides in the stdlib _users manual</em>, which is a new part of the
manual.</p><p><em>io module incompatibilities:</em></p><p>The io:put<em>chars, io:get_chars and io:get_line all handle and return unicode
data. In the case where binaries can be provided (as to io:put_chars), they
shall be encoded in UTF-8. When binaries are returned (as by
io:get_line/get_chars when the io_server is set in _binary mode</em>) the returned
data is also <em>always</em> encoded as UTF-8. The file module however still returns
byte-oriented data, why file:read can be used instead of io:get_chars to read
binary data in ISO-latin-1.</p><p><em>io_lib module incompatibilities:</em></p><p>io_lib:format can, given new format directives (i.e &quot;~ts&quot; and &quot;~tc&quot;), return
lists containing integers larger than 255.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-7648 Aux Id: OTP-7580 OTP-7514 OTP-7494 OTP-7443 OTP-7181 EEP10
EEP11</p></li><li><p>The format of the string returned by <code class="inline">erlang:system_info(system_version)</code> (as
well as the first message when Erlang is started) has changed. The string now
contains the both the OTP version number as well as the erts version number.</p><p>Own Id: OTP-7649</p></li><li><p>Message passing has been further optimized for parallel execution. Serial
message passing is slightly more expensive than before, but parallel send to a
common receiver is much cheaper.</p><p>Own Id: OTP-7659</p></li><li><p>Lock contention on the atom table lock when decoding Erlang terms on the
external format has been drastically reduced.</p><p>Own Id: OTP-7660</p></li><li><p>The undocumented, unsupported, and deprecated guard BIF <code class="inline">is_constant/1</code> has
been removed.</p><p>*<strong> INCOMPATIBILITY with R12B *</strong></p><p>Own Id: OTP-7673</p></li><li><p>The Erlang process lock implementation has been improved by Mat Hostetter at
Tilera Corporation.</p><p>Own Id: OTP-7692</p></li><li><p>A <code class="inline">{nodedown, Node}</code> message passed by the <code class="inline">net_kernel:monitor_nodes/X</code>
functionality is now guaranteed to be sent after <code class="inline">Node</code> has been removed from
the result returned by <code class="inline">erlang:nodes/Y</code>.</p><p>Own Id: OTP-7725</p></li><li><p>The short-circuit operators <code class="inline">andalso</code> and <code class="inline">orelse</code> no longer guarantees that
their second argument is either <code class="inline">true</code> or <code class="inline">false</code>. As a consequence,
<code class="inline">andalso</code>/<code class="inline">orelse</code> are now tail-recursive.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-7748</p></li><li><p>A new BIF, <a href="../../apps/stdlib/lists.html#keyfind/3"><code class="inline">lists:keyfind/3</code></a>, has been added. It works like
<a href="../../apps/stdlib/lists.html#keysearch/3"><code class="inline">lists:keysearch/3</code></a> except that it does not wrap the returned tuple in a
<code class="inline">value</code> tuple in case of success. (Thanks to James Hague for suggesting this
function.)</p><p>Own Id: OTP-7752</p></li><li><p>Optimization for drivers by creating small binaries direct on process heap.</p><p>Own Id: OTP-7762</p></li><li><p><code class="inline">I bsl N</code> could cause the Erlang virtual machine to run of memory instead
generating a <code class="inline">system_limit</code> if N was absurdly huge. (Thanks to Daniel
Hedlund.)</p><p>There would always be a garbage collection when evaluating <code class="inline">I bsl N</code> or
<code class="inline">I bsr N</code> if <code class="inline">I</code> was a bignum.</p><p>If <code class="inline">I</code> is an integer and <code class="inline">N</code> a bignum, <code class="inline">I bsl N</code> will now cause the correct
<code class="inline">system_limit</code> exception instead of <code class="inline">bad_arith</code> as in earlier releases.</p><p>If <code class="inline">I</code> is an integer and <code class="inline">N</code> a bignum, <code class="inline">I bsr N</code> will return either 0 or -1
depending on the sign of <code class="inline">I</code> instead of causing a <code class="inline">bad_arith</code> exception as in
earlier releases.</p><p>Own Id: OTP-7764</p></li><li><p>Scheduler threads can now be bound to logical processors on newer Linux and
Solaris systems. More systems will be supported in the future.</p><p>In some cases performance has increased drastically when binding schedulers.
Schedulers are not bound by default, though. This since it might cause a
performance degradation if multiple programs have bound to processors, e.g.
multiple Erlang runtime systems. For more information see the documentation of
<a href="erlang.html#system_flag/2"><code class="inline">erlang:system_flag/2</code></a>.</p><p>In order to bind scheduler threads the CPU topology need to be known. On some
newer Linux and Solaris systems the runtime system automatically detects the
CPU topology. If the emulator isn't able to automatically detect the CPU
topology, the CPU topology can be defined. For more information see the
documentation of <a href="erlang.html#system_flag/2"><code class="inline">erlang:system_flag/2</code></a>.</p><p>Own Id: OTP-7777</p></li><li><p>The compiler will refuse to a compile file where the module name in the file
differs from the output file name.</p><p>When compiling using <code class="inline">erlc</code>, the current working directory will no be included
in the code path (unless explicitly added using &quot;-pa .&quot;).</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-7793</p></li><li><p>The BIFs <a href="erlang.html#atom_to_binary/2"><code class="inline">atom_to_binary/2</code></a>,
<a href="erlang.html#binary_to_atom/2"><code class="inline">binary_to_atom/2</code></a>, and
<a href="erlang.html#binary_to_existing_atom/2"><code class="inline">binary_to_existing_atom/2</code></a> have been added.</p><p>Own Id: OTP-7804</p></li><li><p>The amount of schedulers online can now be changed during operation. The
amount of schedulers online defaults to the same amount as available logical
processors. For more information see the documentation of
<a href="erlang.html#system_flag/2"><code class="inline">erlang:system_flag/2</code></a> and <code class="inline">erl</code>.</p><p>Own Id: OTP-7811</p></li><li><p>The deprecated functions <code class="inline">erlang:fault/1</code>, <code class="inline">erlang:fault/2</code>, and
<code class="inline">file:rawopen/2</code> have been removed.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-7812</p></li><li><p>Erts internal dynamically allocated process and port specific data for rarely
used data. This is used to reduce memory usage of processes and ports that do
not use specific functionality. More functionality will be moved to process
and port specific data in future releases.</p><p>Own Id: OTP-7818</p></li><li><p>New packet type <code class="inline">http_bin</code> for gen_tcp sockets and <code class="inline">erlang:decode_packet</code>. It
works like <code class="inline">http</code> except that strings are returned as binaries instead of
lists.</p><p>Own Id: OTP-7821</p></li><li><p>The obsolete wd_keeper program for embedded Solaris systems has been removed.</p><p>Own Id: OTP-7822</p></li><li><p>Nodes belonging to different independent clusters can now co-exist on the same
host with the help of a new environment variable setting ERL_EPMD_PORT.</p><p>Own Id: OTP-7826</p></li><li><p>There are new functions <a href="erlang.html#min/2"><code class="inline">erlang:min/2</code></a> and <a href="erlang.html#max/2"><code class="inline">erlang:max/2</code></a> to calculate the
minimum and maximum of two terms, respectively. Note that the functions are
not auto-imported, so they need to be imported explicitly or the <code class="inline">erlang</code>
prefix must be used when calling them.</p><p>Own Id: OTP-7841</p></li><li><p>The copyright notices have been updated.</p><p>Own Id: OTP-7851</p></li><li><p>Enhanced build environment for cross compilation to Tilera Tile architecture.</p><p>Support for native ethread atomics on Tilera Tile64/TilePro (Thanks to Tilera
Corporation).</p><p>Own Id: OTP-7852</p></li><li><p>The escape sequences <code class="inline">\x</code> and <code class="inline">\{</code> have been assigned new interpretations
(they used to return the ASCII code for <code class="inline">x</code> and <code class="inline">{</code> respectively). One or more
octal characters inside curly brackets after a leading backslash is from now
on an alternative to the existing syntax <code class="inline">\NNN</code>, but can also be used for
codes greater than 255. In a similar fashion, one or more hexadecimal
characters can be put inside curly brackets after a leading <code class="inline">\x</code>. Furthermore,
the escape sequences <code class="inline">\xH</code> and <code class="inline">\xHH</code>, where N is a hexadecimal character, can
be used for codes less than 256.</p><p>NOTE: These new escape sequences are still considered experimental and may be
changed in the R13B release.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-7855</p></li><li><p>The PCRE library's exported function names are now prefixed with erts_ in the
erlang emulator to avoid clashes with dynamically loaded drivers.</p><p>Own Id: OTP-7861</p></li><li><p>A runtime system with SMP support will now be built by default on most
platforms if a usable posix thread library or native windows threads are
found.</p><p>For more information see the top README file.</p><p>Own Id: OTP-7872</p></li></ul><h2 id="erts-5-6-5-1" class="section-heading"><a href="#erts-5-6-5-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.6.5.1</span></h2><h3 id="fixed-bugs-and-malfunctions-327" class="section-heading"><a href="#fixed-bugs-and-malfunctions-327" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A corrected bug in ETS for <code class="inline">bag</code> and <code class="inline">duplicate_bag</code>. A <code class="inline">delete/2</code> or
<code class="inline">lookup_element/3</code> could miss objects in a fixed table if one or more objects
with the same key had already been deleted.</p><p>Own Id: OTP-7665</p></li><li><p>A bug fixed for TCP sockets with option <code class="inline">{packet,http}</code>. An HTTP request with
an absolute URI was returned with a corrupt path string. This bug did only
exist in R12B-4 and R12B-5.</p><p>Own Id: OTP-7682 Aux Id: OTP-7647</p></li><li><p>Calling <code class="inline">gen_tcp:send()</code> from several processes on socket with option
<code class="inline">send_timeout</code> could lead to much longer timeout than specified. The solution
is a new socket option <code class="inline">{send_timeout_close,true}</code> that will do automatic
close on timeout. Subsequent calls to send will then immediately fail due to
the closed connection.</p><p>Own Id: OTP-7731 Aux Id: seq11161</p></li><li><p>A process being garbage collected via the
<a href="erlang.html#garbage_collect/1"><code class="inline">garbage_collect/1</code></a> BIF or the
<a href="erlang.html#check_process_code/2"><code class="inline">check_process_code/2</code></a> BIF didn't handle message
receive and resume correctly during the garbage collect. When this occurred,
the process returned to the state it had before the garbage collect instead of
entering the new state.</p><p>Own Id: OTP-7738</p></li></ul><h2 id="erts-5-6-5" class="section-heading"><a href="#erts-5-6-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.6.5</span></h2><h3 id="fixed-bugs-and-malfunctions-328" class="section-heading"><a href="#fixed-bugs-and-malfunctions-328" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A bug in inet_drv concerning gen_tcp:connect has been corrected. A connect
towards a non-open port through open firewalls could sometimes erroneously be
successful. Any subsequent operation would fail, though.</p><p>Own Id: OTP-6542</p></li><li><p>Floating point arithmetic in drivers could cause a runtime system crash and/or
unexpected results on runtime systems with floating point exceptions enabled.
Floating point exceptions are disabled unless explicitly enabled or if hipe is
enabled.</p><p>Own Id: OTP-7237</p></li><li><p>A bug when many sockets got signalled simultaneously causing the emulator to
panic with the message &quot;Inconsistent, why isn't io reported?&quot; is now
corrected.</p><p>Own Id: OTP-7420</p></li><li><p>Starting erl with option &quot;-detached&quot; now disconnects correctly from terminal
session on Unix.</p><p>Own Id: OTP-7461</p></li><li><p>Mended gdb etp-commands for ETS access.</p><p>Own Id: OTP-7538</p></li><li><p><a href="erlang.html#decode_packet/3"><code class="inline">erlang:decode_packet/3</code></a> allows white space between HTTP header tag and colon
according to RFC2616.</p><p>Own Id: OTP-7543</p></li><li><p>An emulator compiled for SCTP now starts even if the dynamic libraries are not
present. The SCTP driver is then of course not loaded.</p><p>Own Id: OTP-7551</p></li><li><p>To build on Mac OS X, 10.3.0 or later is now required because of fixes for two
problems:</p><p>There would be a resource leak when <code class="inline">erl_ddl</code> attempted to unload a driver.
This problem has been corrected by using <code class="inline">dlopen()</code> (which works on all modern
Unix-like platforms) instead of the Mac OS X specific API calls.</p><p>Signal handling in the run-time system for HiPE has been updated to work on
later versions of Mac OS X than 10.2.x. Therefore, <code class="inline">--enable-hipe</code> now works
on Mac OS X with Intel CPUs.</p><p>Thanks to Geoff Cant for the patches.</p><p>Own Id: OTP-7562</p></li><li><p>Corrected some information about the protocol between EPMD and Erlang nodes.
(Thanks to Michael Regen.)</p><p>Own Id: OTP-7594</p></li><li><p>When using <code class="inline">erlang:system_monitor(Pid,{long_gc,Time})</code>, and the GC time
exceeded 1 second, it sometimes erroneously showed up as about 4300 seconds.
(This bug was corrected in R9C, but re-introduced in R12B.) (Thanks to Chris
Newcombe.)</p><p>Own Id: OTP-7622 Aux Id: OTP-4903, seq8379</p></li></ul><h3 id="improvements-and-new-features-98" class="section-heading"><a href="#improvements-and-new-features-98" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The driver entry of a dynamically loaded driver is now copied when loaded
which enables some internal optimizations. Note that drivers that modify the
driver entry during execution will not work anymore. Such a miss-use of the
driver interface is however not supported.</p><p>Own Id: OTP-6900</p></li><li><p>The split function is now added to the re library. Exceptions and errors from
both run, replace and split are made more consistent.</p><p>Own Id: OTP-7514 Aux Id: OTP-7494</p></li><li><p>Fixed harmless compiler warnings when building the emulator and minor build
changes in order to avoid unnecessary rebuilds.</p><p>Own Id: OTP-7530</p></li><li><p>There is now experimental support for loading of code from archive files. See
the documentation of <code class="inline">code</code>, <code class="inline">init</code>, <code class="inline">erl_prim_loader</code>and <code class="inline">escript</code> for more
info.</p><p>The error handling of <code class="inline">escripts</code> has been improved.</p><p>An <code class="inline">escript</code> may now set explicit arguments to the emulator, such as
<code class="inline">-smp enabled</code>.</p><p>An <code class="inline">escript</code> may now contain a precompiled beam file.</p><p>An <code class="inline">escript</code> may now contain an archive file containing one or more
applications (experimental).</p><p>The internal module <code class="inline">code_aux</code> has been removed.</p><p>Own Id: OTP-7548 Aux Id: otp-6622</p></li><li><p>The reallocation functionality part of the ERTS internal memory allocators,
now consider current block in combination with surrounding free blocks as an
alternative location for a reallocation.</p><p>Own Id: OTP-7555</p></li><li><p>There could remain false references from a process to a module that has been
called earlier, so that the process would be killed if the module was
reloaded. (Thanks to Richard Carlsson.)</p><p>Also, the fix for this bug also made it possible to make stack backtraces (as
returned from <code class="inline">erlang:get_stacktrace/0</code> and other functions) more correct in
that the immediate caller is always included in the stack backtrace (it could
sometimes be missing).</p><p>Own Id: OTP-7559</p></li><li><p>Improved locking in IO-handling for better smp performance.</p><p>Own Id: OTP-7560</p></li><li><p>Improved BIF rescheduling functionality.</p><p>Own Id: OTP-7587</p></li><li><p>Loading a module compiled with Erlang/OTP R9C and calling <code class="inline">module_info/0</code> in
the module would crash the emulator. The emulator now refuses to load any
module compiled with R9C or earlier. (Note: only trivial modules compiled with
R10B or earlier could be loaded anyway.) (Thanks to Martin Kjellin.)</p><p>Own Id: OTP-7590</p></li></ul><h2 id="erts-5-6-4-2" class="section-heading"><a href="#erts-5-6-4-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.6.4.2</span></h2><h3 id="fixed-bugs-and-malfunctions-329" class="section-heading"><a href="#fixed-bugs-and-malfunctions-329" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A process calling one of the following BIFs could under very rare conditions
deadlock in the runtime system with SMP support:
<a href="erlang.html#check_process_code/2"><code class="inline">check_process_code/2</code></a>,
<a href="erlang.html#garbage_collect/1"><code class="inline">garbage_collect/1</code></a>, <code class="inline">process_info/[1,2]</code>,
<code class="inline">system_flag/2</code>, and <code class="inline">erlang:suspend_process/[1,2]</code>.</p><p>Own Id: OTP-7582</p></li><li><p>A couple of statistics variables were not managed in a thread safe manner in
the runtime system with SMP support.</p><p>Own Id: OTP-7583</p></li><li><p>An extremely rare race condition when terminating a process could potentially
cause a runtime system crash.</p><p>Own Id: OTP-7584</p></li><li><p>Under certain conditions and when using run_erl/to_erl, the terminal Erlang
driver (ttsl_drv) could crash the emulator by doing a division by zero due to
incorrect handling of terminals reporting a zero width. For terminals
reporting zero width, the driver now fallbacks to a default width of 80 and a
default height of 24 (vt100), as a fallback behaviour. This fixes the crashes
and also makes output on &quot;dumb&quot; terminals much more readable.</p><p>Own Id: OTP-7592 Aux Id: seq11073</p></li></ul><h2 id="erts-5-6-4-1" class="section-heading"><a href="#erts-5-6-4-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.6.4.1</span></h2><h3 id="improvements-and-new-features-99" class="section-heading"><a href="#improvements-and-new-features-99" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>A new <code class="inline">erts_alloc</code> parameter <code class="inline">+M&lt;S&gt;rmbcmt</code> (relative multiblock carrier move
threshold) has been added. It determines when to force a moving realloc in a
multiblock carrier when a block is shrunk. For more information see the
<code class="inline">erts_alloc(3)</code> documentation.</p><p>Own Id: OTP-7540</p></li><li><p>The new option <code class="inline">+d</code> can be given to <code class="inline">erl</code> to suppress the crash dump
generation if an internal error is detected. As a result, a more useful core
dump is produced.</p><p>Own Id: OTP-7578 Aux Id: seq11052</p></li></ul><h2 id="erts-5-6-4" class="section-heading"><a href="#erts-5-6-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.6.4</span></h2><h3 id="fixed-bugs-and-malfunctions-330" class="section-heading"><a href="#fixed-bugs-and-malfunctions-330" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Double backslashes in format string passed to the erts internal printf
implementation produced erroneous results. No such format strings were passed
to the erts internal printf implementation, i.e., the bug was therefore
completely harmless. (Thanks to Perry Smith.)</p><p>Own Id: OTP-7408</p></li><li><p>Large files are now handled on Windows, where the filesystem supports it.</p><p>Own Id: OTP-7410</p></li><li><p>Bug fixed for <code class="inline">{packet,http}</code> when space follows http headers.</p><p>Own Id: OTP-7458</p></li><li><p>The trace option <code class="inline">running</code> could cause an emulator crash if the current
function couldn't be determined.</p><p>Own Id: OTP-7484</p></li><li><p>Using 16#ffffFFFF as a timeout value in receive...after would often cause a
timeout almost at once due to an 32-bit integer overflow. (Thanks to Serge
Aleynikov and Matthias Lang.)</p><p>Own Id: OTP-7493</p></li><li><p>For the process that an escript runs in, the <code class="inline">trap_exit</code> process flag is now
<code class="inline">false</code> instead of <code class="inline">true</code> (as in previous releases). Scripts that depend on
the previous (counter-intuitive) behaviour might not work. (Thanks to Bengt
Kleberg.)</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-7517</p></li><li><p>A bug in the <a href="../../apps/stdlib/string.html#to_integer/1"><code class="inline">string:to_integer/1</code></a> builtin made the emulator unstable. This is
now corrected. (Thanks to Lev Walkin.)</p><p>Own Id: OTP-7526</p></li></ul><h3 id="improvements-and-new-features-100" class="section-heading"><a href="#improvements-and-new-features-100" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Performance for ETS intensive applications should now be better in the SMP
emulator. Also, ETS table identifiers (as returned by <a href="../../apps/stdlib/ets.html#new/2"><code class="inline">ets:new/2</code></a>) are now
spread out in wider range than before (using 28 bits in a 32-bit emulator) to
make sure that the table identifier for a deleted table will not be quickly
re-used.</p><p>NOTE: Table identifiers can now be negative integers. Programs that
(incorrectly) assume that table identifiers can only be positive integers
might stop to work. (The type of a table identifier is intentionally not
documented, and may change in a future release.)</p><p>Own Id: OTP-7348</p></li><li><p>New BIF <a href="erlang.html#decode_packet/3"><code class="inline">erlang:decode_packet/3</code></a> that extracts a protocol packet from a
binary. Similar to the socket option <code class="inline">{packet, Type}</code>. Also documented the
socket packet type <code class="inline">http</code> and made it official. <em>NOTE</em>: The tuple format for
<code class="inline">http</code> packets sent from an active socket has been changed in an incompatible
way.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-7404</p></li><li><p>The source code for the documentation for some applications (erts, kernel,
stdlib, and several others) are now included in the source tar ball. There is
currently no Makefile support for building HTML files from the source (such
support will be included in a future release).</p><p>Own Id: OTP-7406</p></li><li><p>A lot of frequently accessed memory counters (erts internal) have been
removed. This since they hurt performance on the runtime system with SMP
support. As a result <code class="inline">erlang:memory/[0,1]</code> will only deliver a result if all
<code class="inline">erts_alloc(3)</code> allocators are enabled (default). The result delivered when
all <code class="inline">erts_alloc(3)</code> allocators are enabled are both more accurate and less
accurate than before. More memory than before are included in the result, but
the different parts that are summed are not gathered atomically. A call to
<code class="inline">erlang:memory/[0,1]</code> is much cheaper for the system than before. This since
the information isn't gathered atomically anymore which was very expensive.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-7468</p></li><li><p>Pre-allocators used for, for example, timers, and messages have been rewritten
to be scheduler specific. That is, different schedulers will now allocate from
different pools which reduces lock contention.</p><p>Own Id: OTP-7470</p></li><li><p>On Mac OS X, file:sync/1 now guarantees that all filesystem buffers are
written to the disk by using the fcntl() with F_FULLFSYNC option. Previously,
file:sync/1 called fsync(), which only guaranteed that the data had been
transferred to the disk drive. (Thanks to Jan Lehnardt.)</p><p>Own Id: OTP-7471</p></li><li><p>Termination of a process that takes a long time can now be preempted, i.e.,
the terminating process will be rescheduled for later continuation of
termination so that other processes can execute. Termination of a process that
owns many and/or large ets tables typically takes a long time.</p><p>Own Id: OTP-7477</p></li><li><p>A new trace option <code class="inline">exiting</code> has been added. The <code class="inline">exiting</code> trace is similar to
the <code class="inline">running</code> trace, but for exiting processes. For more information see the
erlang(3) documentation.</p><p>The <a href="erlang.html#trace/3"><code class="inline">erlang:trace/3</code></a> bif now doesn't block other scheduler threads if only one
tracee is specified in the call to <a href="erlang.html#trace/3"><code class="inline">erlang:trace/3</code></a>.</p><p>Own Id: OTP-7481</p></li><li><p>The re module is extended with repetitive matches (global option) and
replacement function.</p><p>Own Id: OTP-7494 Aux Id: OTP-7181</p></li><li><p>In the section about binary construction, the reference manual now mentions
what happens when an integer value does not fit into an integer segment of
size N (namely, that the N least significant bits will be put into the binary
and that the most significant bits will be silently discarded). (Thanks to
Edwin Fine.)</p><p>Own Id: OTP-7506</p></li><li><p>Setting the <code class="inline">{active,once}</code> for a socket (using inets:setopts/2) is now
specially optimized (because the <code class="inline">{active,once}</code> option is typically used much
more frequently than other options).</p><p>Own Id: OTP-7520</p></li></ul><h3 id="known-bugs-and-problems-7" class="section-heading"><a href="#known-bugs-and-problems-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Known Bugs and Problems</span></h3><ul><li><p>Floating point arithmetic in drivers can cause a runtime system crash and/or
unexpected results on runtime systems with floating point exceptions enabled.
Floating point exceptions are disabled unless explicitly enabled or if hipe is
enabled.</p><p>Own Id: OTP-7237</p></li></ul><h2 id="erts-5-6-3-3" class="section-heading"><a href="#erts-5-6-3-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.6.3.3</span></h2><h3 id="fixed-bugs-and-malfunctions-331" class="section-heading"><a href="#fixed-bugs-and-malfunctions-331" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Binary construction with an integer field of size 0 at the end of the
constructed binary (and the size given in a variable), would cause a write of
one byte outside the memory reserved for the binary, which in turn could cause
an emulator crash.</p><p>Own Id: OTP-7422</p></li><li><p>A race condition in the dynamic driver implementation could cause an emulator
crash. (Thanks to Paul Fisher)</p><p>Own Id: OTP-7464</p></li><li><p>Calls to <code class="inline">erlang:system_info(allocated_areas)</code> could cause the runtime system
with SMP support to crash.</p><p>Own Id: OTP-7474</p></li><li><p>The <code class="inline">env</code> option to <code class="inline">open_port()</code> could cause the runtime system with SMP
support to crash.</p><p>Own Id: OTP-7475</p></li></ul><h3 id="improvements-and-new-features-101" class="section-heading"><a href="#improvements-and-new-features-101" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Operations that needed to block other threads in the runtime system with SMP
support unnecessarily waited for async threads to block. Most important the
<code class="inline">erlang:memory/[0,1]</code> bif, code loading, and the <a href="erlang.html#trace/3"><code class="inline">erlang:trace/3</code></a> bif.</p><p>Own Id: OTP-7480</p></li></ul><h2 id="erts-5-6-3-2" class="section-heading"><a href="#erts-5-6-3-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.6.3.2</span></h2><h3 id="fixed-bugs-and-malfunctions-332" class="section-heading"><a href="#fixed-bugs-and-malfunctions-332" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Calls to <code class="inline">erlang:memory/[0,1]</code> could cause the runtime system with SMP support
to crash.</p><p>Own Id: OTP-7415</p></li></ul><h2 id="erts-5-6-3-1" class="section-heading"><a href="#erts-5-6-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.6.3.1</span></h2><h3 id="fixed-bugs-and-malfunctions-333" class="section-heading"><a href="#fixed-bugs-and-malfunctions-333" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Doing local call trace on bit syntax matching code that has been optimized
with delayed sub-binary creation could crash the emulator.</p><p>Own Id: OTP-7399 Aux Id: seq10978</p></li></ul><h2 id="erts-5-6-3" class="section-heading"><a href="#erts-5-6-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.6.3</span></h2><h3 id="fixed-bugs-and-malfunctions-334" class="section-heading"><a href="#fixed-bugs-and-malfunctions-334" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Only one to_erl process at a time is allowed to connect to the same run_erl
pipe. Prevents buggy behaviour when IO from several to_erl's get interleaved.</p><p>Own Id: OTP-5107</p></li><li><p>IPv6 name resolving has now been fixed to use getaddrinfo() patch (thoroughly
reworked) courtesy of Love HÃ¶rnquist-Ã…strand submitted by Fredrik Thulin. It
also can use gethostname2() patch (also reworked) courtesy of Mikael Magnusson
for debian submitted by Sergei Golovan.</p><p>Own Id: OTP-5382</p></li><li><p>Improved error handling in run_erl</p><p>Own Id: OTP-7252</p></li><li><p>A permanent fix for the deadlock issue temporarily fixed by OTP-7260.</p><ul><li><strong>OTP-7260</strong> - The runtime system with SMP support could under rare
circumstances deadlock when a distribution channel was taken down while
multiple simultaneous operations were performed on it.</li></ul><p>Own Id: OTP-7267 Aux Id: OTP-7260</p></li><li><p>./configure has been improved to find 64-bit OpenSSL libraries.</p><p>Own Id: OTP-7270</p></li><li><p>A terminating process could under very rare circumstances trigger a bug which
could crash the runtime system with SMP support.</p><p>Own Id: OTP-7272</p></li><li><p>SCTP_ADDR_CONFIRMED events are now handled by gen_sctp.</p><p>Own Id: OTP-7276</p></li><li><p>binary_to_term/1 would crash the emulator if the binary data contained an
external fun with non-atom module and/or function. Corrected to generate a
badarg exception.</p><p>Own Id: OTP-7281</p></li><li><p>On Mac OS 10.5 (Leopard), sending to socket which the other end closes could
cause the emulator to consume 100% CPU time. (Thanks to Matthias Radestock.)</p><p>Own Id: OTP-7289</p></li><li><p>The vanilla driver used on Windows could crash the emulator and sometimes
produced corrupt files. The vanilla driver is the driver that is used when one
only pass a filename as first argument to <a href="erlang.html#open_port/2"><code class="inline">open_port/2</code></a>.
<em>NOTE</em>: This use of <a href="erlang.html#open_port/2"><code class="inline">open_port/2</code></a> is <em>obsolete</em>, and the
documentation of this use has previously been removed. The functionality is
only present for backward compatibility reasons and <em>will</em> eventually be
removed.</p><p>Own Id: OTP-7301</p></li><li><p>Faulty matching in binaries larger than 512Mb on 64bit machines fixed.(On
32bit, the size limit for binaries is still 512Mb). Thanks to Edwin Fine and
Per Gustafsson for finding fault and fix.</p><p>Own Id: OTP-7309</p></li><li><p>crypto:start() on Windows caused emulator to hang on error popup window if
openssl DLL was not found. Windows error popups now suppressed.</p><p>Own Id: OTP-7325</p></li><li><p>Configuration option <code class="inline">without-termcap</code> can be used to disable the use of
termcap libraries for terminal cursor control in the shell.</p><p>Own Id: OTP-7338</p></li><li><p>to_erl reports its terminal window size to run_erl in order to get output
formatted accordingly</p><p>Own Id: OTP-7342</p></li><li><p>On Solaris, the <code class="inline">compressed</code> option for file operations did not work if the
file descriptor happened to be greater than 255 (a problem with fopen() and
friends in Solaris itself).</p><p>Own Id: OTP-7343 Aux Id: seq10949</p></li><li><p>A race condition in the runtime system with SMP support causing an erroneous
removal of a newly created ets table has been fixed.</p><p>The race occurred when a process removed a table during termination
simultaneously as another process removed the same table via <a href="../../apps/stdlib/ets.html#delete/1"><code class="inline">ets:delete/1</code></a>
and a third process created a table that accidentally got the same internal
table index as the table being removed.</p><p>Own Id: OTP-7349</p></li><li><p><code class="inline">zlib:inflate</code> failed when the size of the inflated data was an exact multiple
of the internal buffer size (4000 bytes by default).</p><p>Own Id: OTP-7359</p></li><li><p>If the total number of allowed atoms is exceeded, there will now be a
controlled termination of the emulator with a crash dump file. The emulator
used to simply crash. (Thanks Howard Yeh and Thomas Lindgren.)</p><p>Own Id: OTP-7372</p></li><li><p>The break handler in werl on Windows could cause the emulator to hang or
crash, that is now corrected.</p><p>Own Id: OTP-7394 Aux Id: seq10969</p></li><li><p>The configure script now tests for an serious optimization bug in gcc-4.3.0.
If the bug is present, the configure script will abort (if this happens, the
only way to build Erlang/OTP is to change to another version of gcc). (Thanks
to Mikael Pettersson.)</p><p>Own Id: OTP-7397</p></li></ul><h3 id="improvements-and-new-features-102" class="section-heading"><a href="#improvements-and-new-features-102" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>On Unix, the emulator now notices when the width of the terminal has changed.
(Thanks to Matthew Dempsky and Patrick Mahoney.)</p><p>Own Id: OTP-7290</p></li><li><p>There is a new function <a href="init.html#stop/1"><code class="inline">init:stop/1</code></a> which can be used to shutdown the system
cleanly AND generate a non-zero exit status or crash dump. (Thanks to Magnus
Froberg.)</p><p>Own Id: OTP-7308</p></li><li><p>process_info(Pid, garbage_collection) now returns more information</p><p>Own Id: OTP-7311</p></li><li><p>The <code class="inline">hide</code> option for <a href="erlang.html#open_port/2"><code class="inline">open_port/2</code></a> is now documented.
(Thanks to Richard Carlsson.)</p><p>Own Id: OTP-7358</p></li></ul><h3 id="known-bugs-and-problems-8" class="section-heading"><a href="#known-bugs-and-problems-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Known Bugs and Problems</span></h3><ul><li><p>Floating point arithmetic in drivers can cause a runtime system crash on
runtime systems with floating point exceptions enabled. Floating point
exceptions are disabled unless explicitly enabled or if hipe is enabled.</p><p>Own Id: OTP-7237</p></li></ul><h2 id="erts-5-6-2" class="section-heading"><a href="#erts-5-6-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.6.2</span></h2><h3 id="fixed-bugs-and-malfunctions-335" class="section-heading"><a href="#fixed-bugs-and-malfunctions-335" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The maximum length of an atom of 255 characters is now strictly enforced.
<a href="erlang.html#binary_to_term/1"><code class="inline">binary_to_term/1</code></a> will now fail with a badarg if an
encoded term contains an atom longer than 255 characters. Atoms created by
drivers will now be truncated to 255 characters if necessary. (Thanks to
Matthew Dempsky.)</p><p>Own Id: OTP-7147</p></li><li><p>A bug in &quot;bignum handling&quot; on some 64bit architectures could cause rem and div
operations on large numbers to hang indefinitely. Rem operations involving the
smallest negative number representable in 28 bits or 60 bits could also cause
access violation and emulator crash. Both errors are corrected.</p><p>Own Id: OTP-7177</p></li><li><p>When doing the initial garbage collection after waking a hibernated process, a
fullsweep garbage collection was unnecessarily triggered.</p><p>Own Id: OTP-7212</p></li><li><p>The beta testing module <code class="inline">gen_sctp</code> now supports active mode as stated in the
documentation. Active mode is still rather untested, and there are some issues
about what should be the right semantics for <a href="../../apps/kernel/gen_sctp.html#connect/5"><code class="inline">gen_sctp:connect/5</code></a>. In
particular: should it be blocking or non-blocking or choosable. There is a
high probability it will change semantics in a (near) future patch.</p><p>Try it, give comments and send in bug reports!</p><p>Own Id: OTP-7225</p></li><li><p>Invalid arguments to <a href="../../apps/stdlib/ets.html#update_counter/3"><code class="inline">ets:update_counter/3</code></a> were not handled correctly. A
tuple position (<code class="inline">Pos</code>) less than 1 caused the element directly following the
key to be updated (as if no position at all had been specified). All invalid
values for <code class="inline">Pos</code> will now fail with <code class="inline">badarg</code>.</p><p>Own Id: OTP-7226</p></li><li><p>The runtime system with SMP support could under rare circumstances deadlock
when a distribution channel was taken down while multiple simultaneous
operations were performed on it.</p><p>Own Id: OTP-7260</p></li></ul><h3 id="improvements-and-new-features-103" class="section-heading"><a href="#improvements-and-new-features-103" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>More checksum/hash algorithms from the zlib library are now available as built
in functions (like md5 hashes has been for a long time).</p><p>Own Id: OTP-7128</p></li><li><p>Minor improvements in the garbage collector.</p><p>Own Id: OTP-7139 Aux Id: OTP-7132</p></li><li><p>The switch &quot;-detached&quot; to the windows werl program now can create an erlang
virtual machine without any main window and without a temporary console
showing.</p><p>Own Id: OTP-7142</p></li><li><p><a href="erlang.html#system_info/1"><code class="inline">erlang:system_info/1</code></a> now accepts the <code class="inline">logical_processors</code>, and
<code class="inline">debug_compiled</code> arguments. For more info see the, <a href="erlang.html"><code class="inline">erlang</code></a> documentation.</p><p>The scale factor returned by <code class="inline">test_server:timetrap_scale_factor/0</code> is now also
effected if the emulator uses a larger amount of scheduler threads than the
amount of logical processors on the system.</p><p>Own Id: OTP-7175</p></li><li><p>A new BIF ets:update_element/3. To update individual elements within an
ets-tuple, without having to read, update and write back the entire tuple.</p><p>Own Id: OTP-7200</p></li><li><p>A process executing the <a href="erlang.html#processes/0"><code class="inline">processes/0</code></a> BIF can now be preempted by other
processes during its execution. This in order to disturb the rest of the
system as little as possible. The returned result is, of course, still a
consistent snapshot of existing processes at a time during the call to
<a href="erlang.html#processes/0"><code class="inline">processes/0</code></a>.</p><p>The documentation of the <a href="erlang.html#processes/0"><code class="inline">processes/0</code></a> BIF and the
<a href="erlang.html#is_process_alive/1"><code class="inline">is_process_alive/1</code></a> BIF have been updated in order to
clarify the difference between an existing process and a process that is
alive.</p><p>Own Id: OTP-7213</p></li></ul><h2 id="erts-5-6-1-1" class="section-heading"><a href="#erts-5-6-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.6.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-336" class="section-heading"><a href="#fixed-bugs-and-malfunctions-336" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Not enough parameters were passed when sending an error report in
erl_check_io.c (Thanks to Matthew Dempsky).</p><p>Own Id: OTP-7176</p></li><li><p>In rare circumstances, complex binary matching code could cause the emulator
to crash or not match when it should. (Thanks to Rory Byrne.)</p><p>Own Id: OTP-7198</p></li></ul><h3 id="improvements-and-new-features-104" class="section-heading"><a href="#improvements-and-new-features-104" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The <code class="inline">{allocator_sizes, Alloc}</code> and <code class="inline">alloc_util_allocators</code> arguments are now
accepted by <a href="erlang.html#system_info/1"><code class="inline">erlang:system_info/1</code></a>. For more information see the <a href="erlang.html"><code class="inline">erlang</code></a>
documentation.</p><p>Own Id: OTP-7167</p></li><li><p>The finishing reallocation of the heap block when hibernating a process is now
always moving the heap block since it drastically reduces memory fragmentation
when hibernating large amounts of processes.</p><p>Own Id: OTP-7187</p></li></ul><h2 id="erts-5-6-1" class="section-heading"><a href="#erts-5-6-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.6.1</span></h2><h3 id="fixed-bugs-and-malfunctions-337" class="section-heading"><a href="#fixed-bugs-and-malfunctions-337" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The SMP emulator on sparc64 erroneously used the sparc32 atomic and the
sparc32 spinlock implementations which caused it to crash.</p><p>Own Id: OTP-7006</p></li><li><p>Call tracing the new guard BIFs <code class="inline">byte_size</code>, <code class="inline">bit_size</code>, or <code class="inline">tuple_size</code> and
the loading a module that uses one of those functions, could cause the
emulator to terminate.</p><p>Own Id: OTP-7008</p></li><li><p>configuring --enable-darwin-universal or --enable-darwin-64bit on MacOSX could
result in a non optimized emulator. Top level configure script now corrected.</p><p>Own Id: OTP-7014</p></li><li><p>configuring --with-gd did not produce correct include flags for percept.</p><p>Own Id: OTP-7015</p></li><li><p>Environment variables weren't handled in thread safe manner in the runtime
system with SMP support on Windows.</p><p><code class="inline">erl_drv_putenv()</code>, and <code class="inline">erl_drv_getenv()</code> has been introduced for use in
drivers. Do <em>not</em> use putenv(), or getenv() directly in drivers. For more
information see the <code class="inline">erl_driver</code> documentation.</p><p>Own Id: OTP-7035</p></li><li><p>HIPE: Corrected the choice of interface to the send/3 and setnode/3 BIFs for
native-compiled code. Using the incorrect interface could, in unusual
circumstances, lead to random runtime errors.</p><p>Own Id: OTP-7067</p></li><li><p>Garbage collections could become extremely slow when there were many keys in
the process dictionary. (Thanks to Fredrik Svahn.)</p><p>Own Id: OTP-7068</p></li><li><p>The duplicate documentation directory in the windows installation is removed.</p><p>Own Id: OTP-7070</p></li><li><p>Documentation bugfixes and clarifications.</p><p>(Thanks to Joern (opendev@gmail.com), Matthias Lang, and Richard Carlsson.)</p><p>Own Id: OTP-7079</p></li><li><p>The runtime system with SMP support <em>not</em> using the native atomic integer
implementation part of OTP could deadlock when run on a system with more than
one logical processor. That is, only the runtime system with SMP support on
<em>other</em> hardware platforms than x86, x86_64, sparc32, and powerpc32 were
effected by this bug.</p><p>Own Id: OTP-7080</p></li><li><p>The break handling code (run when Ctrl-C is hit) could could potentially
deadlock the runtime system with SMP support.</p><p>Own Id: OTP-7104</p></li><li><p>The sctp driver has been updated to work against newer lksctp packages e.g
1.0.7 that uses the API spelling change adaption -&gt; adaptation. Older lksctp
(1.0.6) still work. The erlang API in gen_sctp.erl and inet_sctp.hrl now
spells 'adaptation' regardless of the underlying C API.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-7120</p></li><li><p>A bug in <a href="erlang.html#phash2/1"><code class="inline">erlang:phash2/1</code></a> on 64-bit platforms has been fixed. (Thanks to
Scott Lystig Fritchie.)</p><p>Own Id: OTP-7127</p></li><li><p>The emulator could under rare circumstances crash while garbage collecting.</p><p>Own Id: OTP-7132</p></li></ul><h3 id="improvements-and-new-features-105" class="section-heading"><a href="#improvements-and-new-features-105" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The documentation has been updated so as to reflect the last updates of the
Erlang shell as well as the minor modifications of the control sequence <code class="inline">p</code> of
the <code class="inline">io_lib</code> module.</p><p>Superfluous empty lines have been removed from code examples and from Erlang
shell examples.</p><p>Own Id: OTP-6944 Aux Id: OTP-6554, OTP-6911</p></li><li><p>Bit syntax construction with a small integer in a non-byte aligned field wider
than the CPU's word size could cause garbage bits in the beginning of the
field.</p><p>Own Id: OTP-7085</p></li><li><p>All Windows versions older than Windows 2000 are now <em>not supported</em> by the
Erlang runtime system. This since there was a need for usage of features
introduced in Windows 2000.</p><p>Own Id: OTP-7086</p></li><li><p>Memory management improvements especially for the runtime system with SMP
support:</p><ul><li>The runtime system with SMP support can now use multiple, thread specific
instances of most memory allocators. This improves performance since it
reduces lock contention in the memory allocators. It may however increase
memory usage for some applications. The runtime system with SMP support will
by default enable this feature on most allocators. The amount of instances
used can be configured.</li><li><code class="inline">driver_alloc()</code>, <code class="inline">driver_realloc()</code>, and <code class="inline">driver_free()</code> now use their own
erts specific memory allocator instead of the default <code class="inline">malloc()</code>
implementation on the system.</li><li>The default configuration of some allocators have been changed to fit
applications that use much memory better.</li><li>Some new <code class="inline">erts_alloc</code> configuration parameters have been added.</li><li><code class="inline">erts_alloc_config</code> has been modified to be able to create configurations
suitable for multiple instances of allocators.</li><li>The returned value from <code class="inline">erlang:system_info({allocator, Alloc})</code> has been
changed. This since an allocator may now run in multiple instances.</li></ul><p>If you for some reason want the memory allocators to be configured as before,
you can pass the <code class="inline">+Mea r11b</code> command-line argument to <code class="inline">erl</code>.</p><p>For more information see the <code class="inline">erts_alloc(3)</code>, the <code class="inline">m:erts_alloc_config</code>, and
the <a href="erlang.html"><code class="inline">erlang</code></a> documentation.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-7100</p></li><li><p>On Unix, denormalized floating point numbers could not be created using
<a href="erlang.html#list_to_float/1"><code class="inline">list_to_float/1</code></a> or
<a href="erlang.html#binary_to_term/1"><code class="inline">binary_to_term/1</code></a>. (Thanks to Matthew Dempsky.)</p><p>Own Id: OTP-7122</p></li><li><p>Native atomic integers and spin-locks are now also available for the runtime
system with SMP support on sparc64.</p><p>Own Id: OTP-7130</p></li><li><p>FP exceptions support for sparc64 userspace on Linux has been added. Note that
FP exception support is now turned off by default, so to actually enable it
you need to do '<code class="inline">./configure --enable-fp-exceptions</code>'.</p><p>Own Id: OTP-7131</p></li></ul><h2 id="erts-5-6" class="section-heading"><a href="#erts-5-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.6</span></h2><h3 id="fixed-bugs-and-malfunctions-338" class="section-heading"><a href="#fixed-bugs-and-malfunctions-338" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A bug for raw files when reading 0 bytes returning 'eof' instead of empty data
has been corrected.</p><p>Own Id: OTP-6291 Aux Id: OTP-6967</p></li><li><p>All exported functions in gzio.c have now been renamed to avoid conflict with
drivers that are indirectly linked with an external zlib library.</p><p>Own Id: OTP-6816 Aux Id: OTP-6591</p></li><li><p>On the 64-bit Erlang emulator, bit syntax construction with integers
containing more than 60 bits (&quot;big numbers&quot;) into fields with more than 60
bits could produce incorrect results.</p><p>Own Id: OTP-6833</p></li><li><p>When the runtime system failed to allocate memory for binaries, it could dead
lock while writing the <code class="inline">erl_crash.dump</code>.</p><p>Own Id: OTP-6848</p></li><li><p>The runtime system with SMP support could deadlock if a process called the
<code class="inline">erlang:suspend_process(Pid)</code> BIF or the <code class="inline">erlang:garbage_collect(Pid)</code> BIF
while the process identified by <code class="inline">Pid</code> was currently running and the process
calling the BIFs was terminated during the call to the BIFs.</p><p>Processes suspending each other via the <a href="erlang.html#suspend_process/1"><code class="inline">erlang:suspend_process/1</code></a> BIF or
garbage collecting each other via the <a href="erlang.html#garbage_collect/1"><code class="inline">erlang:garbage_collect/1</code></a> BIF could
deadlock each other when the runtime system with SMP support was used.</p><p>Own Id: OTP-6920</p></li><li><p><code class="inline">dbg</code> could leave traced processes in a suspended state if the tracer process
was killed with exit reason <code class="inline">kill</code>.</p><p><a href="erlang.html#suspend_process/2"><code class="inline">erlang:suspend_process/2</code></a> has been introduced which accepts an option list as
second argument. For more information see the <a href="erlang.html"><code class="inline">erlang</code></a> documentation.</p><p>Processes suspended via <code class="inline">erlang:suspend_process/[1,2]</code> will now be
automatically resumed if the process that called
<code class="inline">erlang:suspend_process/[1,2]</code> terminates.</p><p>Processes could previously be suspended by one process and resumed by another
unless someone was tracing the suspendee. This is <em>not</em> possible anymore. The
process resuming a process <em>has</em> to be the one that suspended it.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-6946</p></li><li><p>file:write_file/3, file:write/2 and file:read/2 could crash (contrary to
documentation) for odd enough file system problems, e.g write to full file
system. This bug has now been corrected.</p><p>In this process the file module has been rewritten to produce better error
codes. Posix error codes now originate from the OS file system calls or are
generated only for very similar causes (for example 'enomem' is generated if a
memory allocation fails, and 'einval' is generated if the file handle in
Erlang is a file handle but currently invalid).</p><p>More Erlang-ish error codes are now generated. For example <code class="inline">{error,badarg}</code> is
now returned from <a href="../../apps/kernel/file.html#close/1"><code class="inline">file:close/1</code></a> if the argument is not of a file handle type.
See file(3).</p><p>The possibility to write a single byte using <a href="../../apps/kernel/file.html#write/2"><code class="inline">file:write/2</code></a> instead of a list
or binary of one byte, contradictory to the documentation, has been removed.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-6967 Aux Id: OTP-6597 OTP-6291</p></li><li><p>Monitor messages produced by the system monitor functionality, and garbage
collect trace messages could contain erroneous heap and/or stack sizes when
the actual heaps and/or stacks were huge.</p><p>As of erts version 5.6 the <code class="inline">large_heap</code> option to
<code class="inline">erlang:system_monitor/[1,2]</code> has been modified. The monitor message is sent
if the sum of the sizes of all memory blocks allocated for all heap
generations is equal to or larger than the specified size. Previously the
monitor message was sent if the memory block allocated for the youngest
generation was equal to or larger than the specified size.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-6974 Aux Id: seq10796</p></li><li><p><a href="../../apps/kernel/inet.html#getopts/2"><code class="inline">inet:getopts/2</code></a> returned random values on Windows Vista.</p><p>Own Id: OTP-7003</p></li></ul><h3 id="improvements-and-new-features-106" class="section-heading"><a href="#improvements-and-new-features-106" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The emulator internal process lock implementation has been rewritten and
optimized. A slight risk of starvation existed in the previous implementation.
This risk has also been eliminated in the new implementation.</p><p>Own Id: OTP-6500</p></li><li><p>Bitstrings (bit-level) binaries and binary comprehensions are now part of the
language. See the Reference Manual.</p><p>Own Id: OTP-6558</p></li><li><p>The windows version of erlang now has SMP support. The SMP emulator is run by
default on machines which shows more than one virtual or physical processor.</p><p>Own Id: OTP-6560 Aux Id: OTP-6925</p></li><li><p>The details of the compressed term format has been documented in
erl_ext_dist.txt. (Thanks to Daniel Goertzen.)</p><p>Own Id: OTP-6755</p></li><li><p>The runtime system with SMP support is now started by default if more than one
logical processor are detected. For more information, see the <code class="inline">erl(3)</code>
documentation.</p><p>Own Id: OTP-6756</p></li><li><p>The external format for Erlang terms and the distribution protocol are now
documented in ERTS User's Guide.</p><p>Own Id: OTP-6779</p></li><li><p>New BIF's erlang:system_profile/1 and erlang:system_profile/2. These BIF's
controls concurrency profiling options for processes, ports and schedulers.</p><p>Own Id: OTP-6783 Aux Id: OTP-6285</p></li><li><p>The <code class="inline">ErlDrvTermData</code> term types used by <code class="inline">driver_output_term()</code> and
<code class="inline">driver_send_term()</code> have been extended with the term types
<code class="inline">ERL_DRV_BUF2BINARY</code>, <code class="inline">ERL_DRV_EXT2TERM</code>, and <code class="inline">ERL_DRV_UINT</code>.
<code class="inline">ERL_DRV_BUF2BINARY</code> is used for passing and creating a binary,
<code class="inline">ERL_DRV_EXT2TERM</code> is used for passing terms encoded with the external term
format, and <code class="inline">ERL_DRV_UINT</code> is used for passing unsigned integers.</p><p>Also the data types <code class="inline">ErlDrvUInt</code> and <code class="inline">ErlDrvSInt</code> have been added which makes
it more obvious how arguments to term types are interpreted with regards to
width and signedness.</p><p>The incorrect data types <code class="inline">ErlDriverTerm</code>, <code class="inline">ErlDriverBinary</code>, and
<code class="inline">ErlDriverPort</code> in the <code class="inline">erl_driver(3)</code> documentation have been replaced with
the correct data types <code class="inline">ErlDrvTermData</code>, <code class="inline">ErlDrvBinary</code>, and <code class="inline">ErlDrvPort</code>.</p><p>For more information see the <code class="inline">erl_driver(3)</code> documentation.</p><p>Own Id: OTP-6823</p></li><li><p>Miscellaneous improvements of the erts internal thread library.</p><p>It now support optimized atomic operations and spin-locks on windows.</p><p>Fall-backs based on mutexes and/or spin-locks for missing optimized atomic
operations, spin-locks, or rwlocks has been implemented. This makes it
possible to compile the runtime system with SMP support on a lot more
platforms.</p><p>Default stack size on OpenBSD has been increased to 256 kilo-words.</p><p>Own Id: OTP-6831 Aux Id: OTP-6560</p></li><li><p>Many bit syntax operations, both construction and matching, are faster. For
further information, see the Efficiency Guide.</p><p>Own Id: OTP-6838</p></li><li><p>Literal lists, tuples, and binaries are no longer constructed at run-time as
they used to be, but are stored in a per-module constant pool. Literals that
are used more than once are stored only once.</p><p>This is not a change to the language, only in the details of its
implementation. Therefore, the implications of this change is described in the
Efficiency Guide.</p><p>Example 1: In the expression
<a href="erlang.html#element/2"><code class="inline">element(BitNum-1, {1,2,4,8,16,32,64,128})</code></a>, the tuple used to
be constructed every time the expression was executed, which could be
detrimental to performance in two ways if the expression was executed in a
loop: the time to build the tuple itself and the time spent in garbage
collections because the heap filled up with garbage faster.</p><p>Example 2: Literal strings, such as <code class="inline">&quot;abc&quot;</code>, used to be stored in the compiled
code compactly as a byte string and expanded to a list at run-time. Now all
strings will be stored expanded to lists (such as <code class="inline">[$a,$b,$c]</code>) in the
constant pool. That means that the string will be faster to use at run-time,
but that it will require more space even when not used. If space is an issue,
you might want to use binary literals (that is, <code class="inline">&lt;&lt;&quot;abc&quot;&gt;&gt;</code>) instead of string
literals for infrequently used long strings (such as error messages).</p><p>Own Id: OTP-6850</p></li><li><p>The Erlang driver API has been extended with a portable POSIX thread like API
for multi-threading. The Erlang driver thread API provides:</p><ul><li>Threads</li><li>Mutexes</li><li>Condition variables</li><li>Read/Write locks</li><li>Thread specific data</li></ul><p>For more information see the <code class="inline">erl_driver(3)</code> documentation.</p><p>Own Id: OTP-6857</p></li><li><p>Recursive calls now usually consume less stack than in R11B. See the
Efficiency Guide.</p><p>Own Id: OTP-6862 Aux Id: seq10746</p></li><li><p>The deprecated BIFs <code class="inline">erlang:old_binary_to_term/1</code> and <code class="inline">erlang:info/1</code> have
been removed.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-6876</p></li><li><p>Calls to driver call-backs triggered by external events are now scheduled and
interleaved with execution of Erlang processes also on the runtime system
without SMP support.</p><p>Own Id: OTP-6878</p></li><li><p>Faster arithmetic of integers of more than 27 bits signed (or 60 bits signed
on an 64-bit CPU), and also faster integer multiplication. (Thanks to Tony
Rogvall.)</p><p>Own Id: OTP-6891</p></li><li><p>Significant improvements of the <code class="inline">process_info</code> BIFs:</p><ul><li><a href="erlang.html#process_info/2"><code class="inline">process_info/2</code></a> can now be called with a list of items
as second argument in order to atomically retrieve information about
multiple items.</li><li><code class="inline">process_info/[1,2]</code> has been optimized in the runtime system with SMP
support. The whole scheduler could previously be blocked for a significant
period of time in <code class="inline">process_info/[1,2]</code> waiting for a lock on the process
being inspected. The Erlang process calling <code class="inline">process_info/[1,2]</code> can still
be blocked for a significant period of time waiting for the lock, but the
scheduler will now be able to run other processes while the process calling
<code class="inline">process_info/[1,2]</code> waits for the lock.</li><li><a href="erlang.html#process_info/2"><code class="inline">process_info/2</code></a> now accept a few more items than
before.</li><li>The documentation of <code class="inline">process_info/[1,2]</code> has been improved.</li></ul><p>For more information see the <a href="erlang.html"><code class="inline">erlang</code></a> documentation.</p><p>Own Id: OTP-6899</p></li><li><p><a href="erlang.html#open_port/2"><code class="inline">open_port({}, [])</code></a> could crash the emulator. (Thanks to
Matthew Dempsky.)</p><p>Own Id: OTP-6901</p></li><li><p>Two new guard BIFs have been introduced as a recommended replacement for
<a href="erlang.html#size/1"><code class="inline">size/1</code></a>. (The <a href="erlang.html#size/1"><code class="inline">size/1</code></a> BIF will be removed no earlier
than in R14B.) The BIFs are <a href="erlang.html#tuple_size/1"><code class="inline">tuple_size/1</code></a> to calculate the
size of a tuple and <a href="erlang.html#byte_size/1"><code class="inline">byte_size/1</code></a> to calculate the number of
bytes needed for the contents of the binary or bitstring (rounded up to the
nearest number of bytes if necessary).</p><p>There is also a new <a href="erlang.html#bit_size/1"><code class="inline">bit_size/1</code></a> BIF that returns the exact
number of bits that a binary or bitstring contains.</p><p>Own Id: OTP-6902</p></li><li><p>The <code class="inline">ets:fixtable/2</code> function, which has been deprecated for several releases,
has been removed.</p><p>The <a href="../../apps/stdlib/ets.html#info/1"><code class="inline">ets:info/1</code></a> function has been reimplemented as a BIF, which guarantees
that information returned is consistent.</p><p>The <a href="../../apps/stdlib/ets.html#info/2"><code class="inline">ets:info/2</code></a> function now fails with reason <code class="inline">badarg</code> if the second
argument is invalid. (Dialyzer can be used to find buggy code where the second
argument is misspelled.)</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-6906</p></li><li><p>As the linux kernel may generate a minor fault when tracing with CPU
timestamps, and there exists no patch to the Linux kernel that fixes the
problem, cpu timestamps are disabled on Linux for now.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-6922</p></li><li><p>The functions io:columns/0, io:columns/1, io:rows/0 and io:rows/1 are added to
allow the user to get information about the terminal geometry. The shell takes
some advantage of this when formatting output. For regular files and other
io-devices where height and width are not applicable, the functions return
{error,enotsup}.</p><p>Potential incompatibility: If one has written a custom io-handler, the handler
has to either return an error or take care of io-requests regarding terminal
height and width. Usually that is no problem as io-handlers, as a rule of
thumb, should give an error reply when receiving unknown io-requests, instead
of crashing.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-6933</p></li><li><p><code class="inline">driver_caller()</code> can now also be used from the <code class="inline">start</code> callback of a driver.</p><p>Own Id: OTP-6951</p></li><li><p>The emulator can now be compiled for 64bit intel, as well as a 32bit universal
binary on darwin/MacOSX 10.4 and 10.5.</p><p>Own Id: OTP-6961</p></li><li><p>If <code class="inline">open_port</code> fails because all available ports are already in use, it will
now throw a <code class="inline">system_limit</code> exception instead of an <code class="inline">enfile</code> exception.
(<code class="inline">enfile</code> might still be thrown if the operating system would return ENFILE.)</p><p>Own Id: OTP-6968</p></li><li><p>The <a href="erlang.html#spawn_monitor/1"><code class="inline">spawn_monitor/1</code></a> and
<a href="erlang.html#spawn_monitor/3"><code class="inline">spawn_monitor/3</code></a> BIFs are now auto-imported (i.e. they
no longer need an <code class="inline">erlang:</code> prefix).</p><p>Own Id: OTP-6975</p></li><li><p>On Windows, the werl window now handles resize, so that the whole window can
be utilized. Text selection is also updated to be line oriented instead of
rectangle oriented as in earlier versions.</p><p>Own Id: OTP-6994 Aux Id: OTP-6933</p></li><li><p>Kqueue support (kernel-poll) has been enabled on FreeBSD. The problem with
kqueue not detecting writes on a pipe on FreeBSD was actually not a kqueue
issue, but a writev on pipes issue. Neither poll(), nor select() detected the
write when the bug hit. NetBSD and DragonFlyBSD probably have or have had the
same bug. This bug should have been fixed in FreeBSD 6.3 and FreeBSD 7.0
thanks to Jean-Sebastien Pedron.</p><p>Own Id: OTP-7001</p></li></ul><h2 id="erts-5-5-5-5" class="section-heading"><a href="#erts-5-5-5-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.5.5</span></h2><h3 id="fixed-bugs-and-malfunctions-339" class="section-heading"><a href="#fixed-bugs-and-malfunctions-339" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Hanging writes on temporarily unavailable NFS filesystems could cause the
execution of (not file related) erlang code to get blocked even though I/O
threads were used. This is now corrected.</p><p>Own Id: OTP-6907 Aux Id: seq10771</p></li></ul><h2 id="erts-5-5-5-4" class="section-heading"><a href="#erts-5-5-5-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.5.4</span></h2><h3 id="fixed-bugs-and-malfunctions-340" class="section-heading"><a href="#fixed-bugs-and-malfunctions-340" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Data passed to a driver via <code class="inline">erlang:port_call</code> could be corrupted when the
runtime system with SMP support was used. (Thanks to YAMASHINA Hio.)</p><p>Own Id: OTP-6879</p></li><li><p>In the SMP emulator, if several processes called ets:update_counter/3 (even
for different tables) when the counter values exceeded 27 bits, the counter
values could be corrupted or the emulator could crash.</p><p>Own Id: OTP-6880 Aux Id: seq10760</p></li></ul><h2 id="erts-5-5-5-3" class="section-heading"><a href="#erts-5-5-5-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.5.3</span></h2><h3 id="fixed-bugs-and-malfunctions-341" class="section-heading"><a href="#fixed-bugs-and-malfunctions-341" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Creating a named table using <a href="../../apps/stdlib/ets.html#new/2"><code class="inline">ets:new/2</code></a> or renaming a named table using
<a href="../../apps/stdlib/ets.html#rename/2"><code class="inline">ets:rename/2</code></a> could in rare circumstances succeed, meaning that there would
be two or more tables with the same name. Now such call will fail with a
<code class="inline">badarg</code> exception as it is supposed to do.</p><p><a href="../../apps/stdlib/ets.html#delete/1"><code class="inline">ets:delete/1</code></a> used on a named table now removes the name immediately so that
a new table with the same name can be created.</p><p>Turning on call trace on the internal BIF that implements <a href="../../apps/stdlib/ets.html#delete/1"><code class="inline">ets:delete/1</code></a> would
crash the emulator.</p><p>SMP emulator only: Using <a href="../../apps/stdlib/ets.html#rename/2"><code class="inline">ets:rename/2</code></a> on a table that <a href="../../apps/stdlib/ets.html#safe_fixtable/2"><code class="inline">ets:safe_fixtable/2</code></a>
has been used on could cause an emulator crash or undefined behaviour because
of a missing lock.</p><p>Own Id: OTP-6872 Aux Id: seq10756, seq10757</p></li></ul><h2 id="erts-5-5-5-2" class="section-heading"><a href="#erts-5-5-5-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.5.2</span></h2><h3 id="known-bugs-and-problems-9" class="section-heading"><a href="#known-bugs-and-problems-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Known Bugs and Problems</span></h3><ul><li><p>ets:select/3 on ordered_set and with a chunksize a multiple of 1000 gave all
elements instead of just 1000. Also ets:slot/2 on ordered set could give
unexpected results on SMP emulator. Both problems are corrected.</p><p>Own Id: OTP-6842</p></li></ul><h2 id="erts-5-5-5-1" class="section-heading"><a href="#erts-5-5-5-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.5.1</span></h2><h3 id="fixed-bugs-and-malfunctions-342" class="section-heading"><a href="#fixed-bugs-and-malfunctions-342" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>All exported functions in gzio.c have now been renamed to avoid conflict with
drivers that are indirectly linked with an external zlib library.</p><p>Own Id: OTP-6816 Aux Id: OTP-6591</p></li><li><p>Calling binary_to_term/1 with certain invalid binaries would crash the
emulator.</p><p>Own Id: OTP-6817</p></li></ul><h3 id="improvements-and-new-features-107" class="section-heading"><a href="#improvements-and-new-features-107" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Restored speed of bit-syntax matching of 32 bits integers.</p><p>Own Id: OTP-6789 Aux Id: seq10688</p></li></ul><h2 id="erts-5-5-5" class="section-heading"><a href="#erts-5-5-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.5</span></h2><h3 id="fixed-bugs-and-malfunctions-343" class="section-heading"><a href="#fixed-bugs-and-malfunctions-343" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The functions in gzio.c have been renamed to avoid conflict with drivers that
indirectly linked with an external zlib library.</p><p>Own Id: OTP-6591</p></li><li><p>The emulator without SMP support dumped core if an async-thread finished a job
after the emulator had begun writing an <code class="inline">erl_crash.dump</code>.</p><p>Own Id: OTP-6685</p></li><li><p>In bit syntax matching, integer fields with greater size than 16Mb would fail
to match. (Thanks to Bertil Karlsson and Francesco Pierfederici.)</p><p>Matching out a 32-bit integer not aligned on a byte boundary from a binary
could cause an heap overflow (and subsequent termination of the emulator).</p><p>A module that contained bit syntax construction with a literal field size
greater than 16Mb would fail to load.</p><p>Several other similar bugs having to do with huge field sizes were eliminated.</p><p>Attempting to construct a binary longer than 536870911 bytes will now fail
with a <code class="inline">system_limit</code> exception (rather than fail in mysterious ways or
construct an binary with incorrect contents). Similarly, attempting to match a
binary longer than 536870911 bytes will now fail (instead of producing an
incorrect result). This limitation has been documented in the Efficiency
Guide. (The limit is in the 32-bit emulator; use the 64-bit emulator if you
need to handle larger binaries than 536870911.)</p><p>Own Id: OTP-6686</p></li><li><p>Bugs in rem and div of very large numbers are corrected.</p><p>Own Id: OTP-6692</p></li><li><p><code class="inline">erlang:system_info({allocator, Alloc})</code> didn't allocate enough heap when a
bignum was part of the result which could cause an emulator crash.</p><p>Own Id: OTP-6693</p></li><li><p>It was previously not possible to pass <code class="inline">erts_alloc</code> the same configuration via
the command-line, as used by default.</p><p>A <code class="inline">+M*</code> command-line argument that configure a size of some sort can now be
passed a value that equals the size of the address space. The value used, in
this case, will be <code class="inline">&quot;the size of the address space&quot; - 1</code>.</p><p>Own Id: OTP-6699</p></li><li><p><code class="inline">SysIOVec* driver_peekq(ErlDrvPort port, int *vlen)</code> did not update <code class="inline">*vlen</code> if
<code class="inline">port</code> was invalid. <code class="inline">*vlen</code> is now set to <code class="inline">-1</code> if the <code class="inline">port</code> is invalid.</p><p>The <code class="inline">efile</code> driver expects <code class="inline">*vlen</code> to be updated also when the <code class="inline">port</code> is
invalid. This situation occurs seldom, but when the runtime system has
async-threads enabled and ports are killed it can. When it occurred the
runtime system crashed.</p><p>Own Id: OTP-6729</p></li></ul><h3 id="improvements-and-new-features-108" class="section-heading"><a href="#improvements-and-new-features-108" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>For scripts written using <code class="inline">escript</code>, there is a new function
<a href="../../apps/stdlib/escript.html#script_name/0"><code class="inline">escript:script_name/0</code></a>, which can be used to retrieve the pathame of the
script. The documentation has been clarified regarding pre-defined macros such
as ?MODULE and the module name.</p><p>Own Id: OTP-6593</p></li><li><p>The section Guards in the chapter The Abstract Format of the ERTS User's Guide
has been updated.</p><p>Own Id: OTP-6600</p></li><li><p>Corrected protocol layer flue for socket options SO_LINGER, SO_SNDBUF and
SO_RCVBUF, for SCTP.</p><p>Own Id: OTP-6625 Aux Id: OTP-6336</p></li><li><p>The behaviour of the inet option {active,once} on peer close is improved and
documented.</p><p>Own Id: OTP-6681</p></li><li><p>The inet option send_timeout for connection oriented sockets is added to allow
for timeouts in communicating send requests to the underlying TCP stack.</p><p>Own Id: OTP-6684 Aux Id: seq10637 OTP-6681</p></li><li><p>The command line flag <code class="inline">-args_file FileName</code>, and the environment variables
<code class="inline">ERL_AFLAGS</code>, and <code class="inline">ERL_ZFLAGS</code> for the <code class="inline">erl</code> command have been added. For more
information see the <a href="erl_cmd.html">erl</a> documentation.</p><p>Own Id: OTP-6697</p></li><li><p>The <code class="inline">is_constant/1</code> type test has been deprecated. <code class="inline">is_constant/1</code> is
improperly named and almost entirely undocumented.</p><p>Own Id: OTP-6731</p></li></ul><h2 id="erts-5-5-4-3" class="section-heading"><a href="#erts-5-5-4-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.4.3</span></h2><h3 id="fixed-bugs-and-malfunctions-344" class="section-heading"><a href="#fixed-bugs-and-malfunctions-344" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><a href="erlang.html#process_flag/2"><code class="inline">process_flag(trap_exit, Bad)</code></a> where <code class="inline">Bad</code> was a term not
equal to <code class="inline">true</code> or <code class="inline">false</code>, didn't fail with <code class="inline">badarg</code> as it should; instead,
the failure was silently ignored. This bug was introduced in <code class="inline">erts-5.5.2</code>.</p><p>Own Id: OTP-6627 Aux Id: OTP-6160</p></li><li><p>The minimum and default stack size for async-threads has been increased to 16
kilowords. This since the previous minimum and default stack size of 8
kilowords proved to be too small (introduced in <code class="inline">erts-5.5.4.2</code>).</p><p>Own Id: OTP-6628 Aux Id: OTP-6580, Seq10633</p></li></ul><h3 id="improvements-and-new-features-109" class="section-heading"><a href="#improvements-and-new-features-109" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>process_flag/2 accepts the new flag <code class="inline">sensitive</code>.</p><p>Own Id: OTP-6592 Aux Id: seq10555</p></li></ul><h2 id="erts-5-5-4-2" class="section-heading"><a href="#erts-5-5-4-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.4.2</span></h2><h3 id="fixed-bugs-and-malfunctions-345" class="section-heading"><a href="#fixed-bugs-and-malfunctions-345" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>When a port steals control over a file descriptor from another port, the
stealing port tests if the other port is alive. This in order to be able to
give an accurate error message. In the runtime system with SMP support, this
test was done without appropriate locks held. This could in worst case lead to
an erroneous error message; therefore, this bug is to be considered harmless.</p><p>Own Id: OTP-6602</p></li></ul><h3 id="improvements-and-new-features-110" class="section-heading"><a href="#improvements-and-new-features-110" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The default stack size for threads in the async-thread pool has been shrunk to
8 kilowords, i.e., 32 KB on 32-bit architectures. This small default size has
been chosen since the amount of async-threads might be quite large. The
default stack size is enough for drivers delivered with Erlang/OTP, but might
not be sufficiently large for other dynamically linked in drivers that use the
<code class="inline">driver_async()</code> functionality. A suggested stack size for threads in the
async-thread pool can be configured via the <code class="inline">+a</code> command line argument of
<a href="erl_cmd.html">erl</a>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-6580</p></li></ul><h2 id="erts-5-5-4-1" class="section-heading"><a href="#erts-5-5-4-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.4.1</span></h2><h3 id="fixed-bugs-and-malfunctions-346" class="section-heading"><a href="#fixed-bugs-and-malfunctions-346" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Setting the time on the system while using heart on a linux machine where the
emulator was built with clock_gettime support (default from Linux
2.6/erts-5.5.4 and upwards), could make the heart command fire. This was due
to bug in the heart executable which is now corrected.</p><p>Own Id: OTP-6598 Aux Id: seq10614</p></li></ul><h2 id="erts-5-5-4" class="section-heading"><a href="#erts-5-5-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.4</span></h2><h3 id="fixed-bugs-and-malfunctions-347" class="section-heading"><a href="#fixed-bugs-and-malfunctions-347" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Corrected misspelling of '<code class="inline">-pz</code>' in the help text for <code class="inline">erlc</code>. (Thanks to Ulf
Wiger.)</p><p>Own Id: OTP-6433</p></li><li><p>The MD5 calculation of a BEAM file done by <code class="inline">code:module_md5/1</code>,
<a href="../../apps/stdlib/beam_lib.html#md5/1"><code class="inline">beam_lib:md5/1</code></a>, and by the compiler for the default value of the <code class="inline">vsn</code>
attribute have all been changed so that its result will be the same on all
platforms; modules containing funs could get different MD5s on different
platforms.</p><p>Own Id: OTP-6459</p></li><li><p>The emulator could dump core while writing an <code class="inline">erl_crash.dump</code> file if there
were funs with a large terms in its environment. Since there is no way to
inspect a fun's environment in the crashdump_viewer application anyway, a
variables in the environment are now set to [] before dumping the fun. (Thanks
to Jean-Sebastien Pedron.)</p><p>Own Id: OTP-6504</p></li><li><p><code class="inline">{Port, {exit_status, S}}</code> messages from ports opened with the <code class="inline">exit_status</code>
option could under rare circumstances be delayed. This bug was present on
Erlang runtime systems without SMP support on all unix operating systems other
than SunOS.</p><p>Own Id: OTP-6528</p></li><li><p>A bug in linuxthreads could cause the emulator to dump core when dlerror() was
called before the first call to dlopen(). As a workaround the emulator always
makes a call to dlopen() on initialization when linuxthreads is used as thread
library.</p><p>Own Id: OTP-6530</p></li><li><p>file:sync/1 did not do anything on Windows. Now it calls the system function
for flushing buffers (FlushFileBuffers()). (Thanks to Matthew Sackman.)</p><p>Own Id: OTP-6531</p></li><li><p><a href="erlang.html#open_port/2"><code class="inline">open_port/2</code></a> could on the runtime system with SMP support
fail with the wrong exit reason when a port couldn't be created. When this
happened the exit reason was typically <code class="inline">eintr</code>, or <code class="inline">ebusy</code> instead of
<code class="inline">eagain</code>.</p><p>Own Id: OTP-6536</p></li><li><p>The file driver (efile_drv) did not flush data written using the option
'delayed_write' after the set timeout time, rather at the next file operation.
This bug has now been corrected.</p><p>Own Id: OTP-6538</p></li></ul><h3 id="improvements-and-new-features-111" class="section-heading"><a href="#improvements-and-new-features-111" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>An interface towards the SCTP Socket API Extensions has been implemented.It is
an Open Source patch courtesy of Serge Aleynikov and Leonid Timochouk. The
Erlang code parts has been adapted by the OTP team, changing the Erlang API
somewhat.</p><p>The Erlang interface consists of the module <code class="inline">gen_sctp</code> and an include file
<code class="inline">-include_lib(&quot;kernel/include/inet_sctp.hrl&quot;).</code> for option record definitions.
The <code class="inline">gen_sctp</code> module is documented.</p><p>The delivered Open Source patch, before the OTP team rewrites, was written
according to <a href="http://tools.ietf.org/html/draft-ietf-tsvwg-sctpsocket-13">http://tools.ietf.org/html/draft-ietf-tsvwg-sctpsocket-13</a> and was
claimed to work fine, tested on Linux Fedora Core 5.0 (kernel 2.6.15-2054 or
later) and on Solaris 10 and 11. The OTP team rewrites used the same standard
document but might have accidentally broken some functionality. If so it will
soon be patched to working state. The tricky parts in C and the general design
has essentially not changed. During the rewrites the code was hand tested on
SuSE Linux Enterprise Server 10, and briefly on Solaris 10. Feedbach on code
and docs is very much appreciated.</p><p>The SCTP interface is in beta state. It has only been hand tested and has no
automatic test suites in OPT meaning everything is most certainly not tested.
Socket active mode is broken. IPv6 is not tested. The documentation has been
reworked due to the API changes, but has not been proofread after this.</p><p>Thank you from the OTP team to Serge Aleynikov and Leonid Timochouk for a
valuable contribution. We hope we have not messed it up too much.</p><p>Own Id: OTP-6336</p></li><li><p>A <code class="inline">{minor_version,Version}</code> option is now recognized by
<a href="erlang.html#term_to_binary/2"><code class="inline">term_to_binary/2</code></a>. {minor_version,1} will cause
floats to be encoded in an exact and more space-efficient way compared to the
previous encoding.</p><p>Own Id: OTP-6434</p></li><li><p>There is a new <code class="inline">escript</code> program that can be used for writing scripts in
Erlang. Erlang scripts don't need to be compiled and any arguments can be
passed to them without risk that they are interpreted by the Erlang system.</p><p>Own Id: OTP-6505</p></li><li><p>Setting and getting socket options in a &quot;raw&quot; fashion is now allowed. Using
this feature will inevitably produce non portable code, but will allow setting
ang getting arbitrary uncommon options on TCP stacks that do have them.</p><p>Own Id: OTP-6519</p></li><li><p>Miscellaneous signal handling improvements on the Erlang runtime system with
SMP support.</p><p>The fallback implementation of spin locks and atomic operations are now
implemented using pthread spin locks when pthread spin locks are found on the
system.</p><p>The Erlang runtime system with SMP support can now run on Linux systems that
has Linuxthreads instead of NPTL (Native POSIX Thread Library). Note that the
SMP support hasn't been as thoroughly tested with Linuxthreads as with NPTL. A
runtime system with SMP support will therefore not be built by default on
Linux when NPTL isn't found. In order to force a build of the runtime system
with SMP support, pass <code class="inline">--enable-smp-support</code> to <code class="inline">configure</code> when building
OTP.</p><p>Own Id: OTP-6525</p></li></ul><h2 id="erts-5-5-3-1" class="section-heading"><a href="#erts-5-5-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.3.1</span></h2><h3 id="fixed-bugs-and-malfunctions-348" class="section-heading"><a href="#fixed-bugs-and-malfunctions-348" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><code class="inline">erlang:system_flag(multi_scheduling, block)</code> could cause the emulator with
SMP support to deadlock.</p><p>Own Id: OTP-6431 Aux Id: OTP-6403</p></li><li><p>The runtime system with SMP support failed to call the driver timeout callback
of ports in state closing. This could cause ports to fail flushing their I/O
queues.</p><p>Own Id: OTP-6432</p></li><li><p>The <code class="inline">{Port, closed}</code> message from a closed port could arrive at the port owner
before <code class="inline">Port</code> had been removed from the result of <a href="erlang.html#ports/0"><code class="inline">erlang:ports/0</code></a> in the
runtime system with SMP support.</p><p>Own Id: OTP-6437</p></li><li><p>The async id of async jobs created via <code class="inline">driver_async</code> wasn't created in a
thread safe manner in the runtime system with SMP support. This could in worst
case cause <code class="inline">driver_async_cancel()</code> to cancel another async job than intended.</p><p>Own Id: OTP-6438</p></li><li><p>Under rare circumstances a terminating connection between two nodes could
cause an instantaneous reconnect between the two nodes to fail on the runtime
system with SMP support.</p><p>Own Id: OTP-6447</p></li><li><p>In the documentation of the driver entry field <code class="inline">extended_marker</code> of erts
version 5.5.3 (<code class="inline">driver_entry(3)</code>), the following is stated: &quot;The following
fields are ignored if this field is equal to <code class="inline">0</code>&quot;. This is a documentation bug
and has been changed to: &quot;If this field is equal to <code class="inline">0</code>, all the fields
following this field also <em>have</em> to be <code class="inline">0</code>, or <code class="inline">NULL</code> in case it is a pointer
field&quot;.</p><p>The runtime check for detection of old incompatible drivers made when loading
drivers has been improved. The emulator can, however, not make sure that a
driver that doesn't use the extended driver interface isn't incompatible.
Therefore, when loading a driver that doesn't use the extended driver
interface, there is a risk that it will be loaded also when the driver is
incompatible. When the driver use the extended driver interface, the emulator
can verify that it isn't of an incompatible driver version. You are therefore
advised to use the extended driver interface.</p><p>For more information see the <code class="inline">erl_driver(3)</code> and <code class="inline">driver_entry(3)</code>
documentation.</p><p>Own Id: OTP-6452 Aux Id: OTP-6330</p></li><li><p>When terminating ports on the runtime system with SMP support, removal of
links to processes was done without locking the link lock on processes. This
could cause an emulator crash.</p><p>Own Id: OTP-6475</p></li><li><p>The emulator with SMP support could crash when a port flushed its I/O queue by
calling <code class="inline">driver_async()</code> from the timeout driver callback.</p><p>Own Id: OTP-6479</p></li><li><p>Large exit reasons could under rare circumstances cause the runtime system
with SMP support to crash.</p><p>Own Id: OTP-6521</p></li></ul><h3 id="improvements-and-new-features-112" class="section-heading"><a href="#improvements-and-new-features-112" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Faster system calls for keeping the time accurate are used on newer Linux
kernels, which can result in a significant speed-up of the emulator on those
systems.</p><p>Own Id: OTP-6430</p></li><li><p>Added number of async threads and number of scheduler threads to the system
information that can be retrieved via <code class="inline">driver_system_info()</code>. For more
information see the <code class="inline">erl_driver(3)</code> documentation.</p><p>Own Id: OTP-6440</p></li><li><p>When <code class="inline">SIGUSR1</code> is received by the runtime system with SMP support, the
<code class="inline">erl_crash.dump</code> is now written by a special thread, instead of as before
directly from the signal handler.</p><p>Own Id: OTP-6465</p></li><li><p>term_to_binary/2 with compression is now faster.</p><p>term_to_binary/2 now accepts the option '<code class="inline">{compressed,Level}</code>' for specifying
the compression level. <code class="inline">Level</code> must be in the range 0 (no compression) through
9 (highest compression level). Default is 6.</p><p>Future compatibility bugfix: binary_to_term/1 did not handle the <code class="inline">Uniq</code> and
<code class="inline">Index</code> fields correctly.</p><p>Own Id: OTP-6494</p></li><li><p>Removed unnecessary reallocation when initializing kernel-poll set.</p><p>Own Id: OTP-6516</p></li></ul><h2 id="erts-5-5-3" class="section-heading"><a href="#erts-5-5-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.3</span></h2><h3 id="fixed-bugs-and-malfunctions-349" class="section-heading"><a href="#fixed-bugs-and-malfunctions-349" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Node and fun table entries could under rare circumstances be deallocated
multiple times on the emulator with SMP support.</p><p>Own Id: OTP-6369</p></li><li><p>epoll_wait() can repeat entries for the same file descriptor in the result
array. This could cause the ready_input, ready_output, or event callbacks of a
driver to unintentionally be called multiple times. We have only noted
repeated entries when an error condition has occurred on the file descriptor.
In this case, the repeated entries should normally not be a problem for the
driver since it should detect the error and de-select the file descriptor.
Therefore this bug should be considered harmless. The emulator now coalesce
repeated entries into one.</p><p>You are only affected by this bug if you are using erts-5.5.2.* and the
kernel-poll feature on linux.</p><p>Own Id: OTP-6376 Aux Id: OTP-6222</p></li><li><p>If a process that was waiting in gen_tcp:accept/1 was killed, calling
gen_tcp:accept/1 again on the same listen socket would fail with
'<code class="inline">{error,einval}</code>'.</p><p>Own Id: OTP-6381 Aux Id: seq10535</p></li><li><p>The emulator failed to start on Solaris 10 when kernel-poll support was
enabled and the maximum number of filedescriptors configured was less than or
equal to 256.</p><p>Own Id: OTP-6384 Aux Id: OTP-6222</p></li><li><p>The R10B compiler could generate unsafe <code class="inline">bs_save/bs_restore</code> instructions that
could cause memory corruption. (The R11B compiler does not have that problem.)
The erlang emulator will now refuse to load R10B-compiled modules that contain
such unsafe <code class="inline">bs_save/bs_restore</code> instructions. In addition, the beam_validator
module in the compiler will also reject such instructions (in case it is used
to validate R10B code). (Thanks to Matthew Reilly.)</p><p>Own Id: OTP-6386</p></li><li><p>Process and port timers could fail to work properly on the runtime system with
SMP support. Many thanks to Dmitriy Kargapolov and Serge Aleynikov who tracked
down this bug.</p><p>Own Id: OTP-6387</p></li><li><p>Bit syntax code compiled by an R10B compiler that matched out a floating point
number would not properly check that the floating point number was valid; if
the float was, for instance, NaN the emulator could crash.</p><p>Own Id: OTP-6395</p></li><li><p>statistics(runtime) on Windows used to return the elapsed system time for the
process, instead of the user time. Corrected. (Thanks to Robert Virding.)</p><p>Own Id: OTP-6407</p></li><li><p>A loadable driver (loaded by erl_ddll) which used driver_async() would cause
the emulator to crash. (Thanks to Dmitriy Kargapolov.)</p><p>Own Id: OTP-6410</p></li><li><p>Under rare circumstances the emulator on unix platforms could fail to
terminate the Erlang port corresponding to a port program opened with the
<code class="inline">exit_status</code> option.</p><p>Own Id: OTP-6411</p></li><li><p>A link removed via <a href="erlang.html#unlink/1"><code class="inline">unlink/1</code></a> could under rare circumstances
transfer exit signals for a short period of time after the call to
<a href="erlang.html#unlink/1"><code class="inline">unlink/1</code></a> had returned when the runtime system with SMP support
was used.</p><p>Own Id: OTP-6425 Aux Id: OTP-6160</p></li></ul><h3 id="improvements-and-new-features-113" class="section-heading"><a href="#improvements-and-new-features-113" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>In the runtime system with SMP support, ports are now being scheduled on the
scheduler threads interleaved with processes instead of being run in a
separate I/O thread.</p><p>Own Id: OTP-6262</p></li><li><p>More interfaces are added in erl_ddll, to support different usage scenarios.</p><p>Own Id: OTP-6307 Aux Id: OTP-6234</p></li><li><p>In the runtime system with SMP support, the global I/O lock has been replaced
with a more fine grained port locking scheme. Port locking is either done on
driver level, i.e., all ports executing the same driver share a lock, or on
port level, i.e., each port has its own lock. Currently the inet driver, the
efile driver, and the spawn driver use port level locking and all other
statically linked in drivers use driver level locking. By default dynamically
linked in drivers will use locking on driver level. For more information on
how to enable port level locking see the <code class="inline">erl_driver(3)</code> and the
<code class="inline">driver_entry(3)</code> man pages.</p><p>As of erts version 5.5.3 the driver interface has been extended. The extended
interface introduce version management, the possibility to pass capability
flags to the runtime system at driver initialization, and some new driver API
functions. For example, the <code class="inline">driver_system_info()</code> function which can be used
to determine if the driver is run in a runtime system with SMP support or not.
The extended interface doesn't have to be used, <em>but</em> dynamically linked in
driver <em>have</em> to be recompiled. For information see the <code class="inline">erl_driver(3)</code> and
the <code class="inline">driver_entry(3)</code> man pages.</p><p><em>NOTE:</em> Dynamically linked in drivers <em>have</em> to be recompiled.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-6330 Aux Id: OTP-6262</p></li><li><p>A test and debug feature which modifies the timing of the runtime system has
been added. For more information, see documentation of the <code class="inline">+T&lt;Level&gt;</code> command
line argument of <a href="erl_cmd.html">erl</a>.</p><p>Own Id: OTP-6382</p></li><li><p>The version of zlib (<a href="http://zlib.net">http://zlib.net</a>) linked into run-time system has been
updated to version 1.2.3.</p><p>Own Id: OTP-6394</p></li><li><p>The <code class="inline">erlc</code> program now passes on the <code class="inline">-smp</code> and <code class="inline">-hybrid</code> options to the
Erlang emulator it starts. This is mainly useful for compiling native code,
because native code must be compiled with same type of run-time system as in
which it will be run.</p><p>If the <code class="inline">-s</code> option is given, <code class="inline">erlc</code> now prints a warning that it is deprecated
and that it will be removed in R12B.</p><p>Own Id: OTP-6398</p></li><li><p>The <code class="inline">schedulers</code> option of <a href="erlang.html#system_flag/2"><code class="inline">erlang:system_flag/2</code></a> has been removed, i.e., the
number of scheduler threads cannot be changed after emulator boot time any
more.</p><p>A <code class="inline">multi_scheduling</code> option has been added to <a href="erlang.html#system_flag/2"><code class="inline">erlang:system_flag/2</code></a>. This
option can be used for blocking and unblocking multi-scheduling. For more
information see the <a href="erlang.html"><code class="inline">erlang</code></a> documentation.</p><p>Own Id: OTP-6403</p></li><li><p>A port program that had been started with the <code class="inline">exit_status</code> option and closed
one of the pipes used for communication with the emulator caused the emulator
to continuously poll for termination of the port program. This only became a
problem when the emulator didn't have other things to do and the port program
closed a pipe much earlier than it terminated. When the emulator had other
things to do, such as running Erlang processes, the emulator polled for
termination in between scheduling of processes.</p><p>Now the emulator doesn't poll for termination of the port program at all;
instead, it waits for the child signal from the terminated port program to
arrive and then schedules the Erlang port for termination.</p><p>The termination of any port programs have also been optimized. Previously the
termination of any port program did always cause a scan of a table of the size
equal to maximum number of file descriptors. If the maximum number of file
descriptors was large, this scan could be quite expensive. Now the search have
been reduced to the set of ports started with the <code class="inline">exit_status</code> option.</p><p>Note, all of the above only applies to Erlang emulators on Unix platforms.</p><p>Own Id: OTP-6412 Aux Id: seq10194</p></li><li><p>* BEAM: added support for floating-point exceptions on FreeBSD (32-bit x86)</p><p>* SMP: made locking procedures work even when native lock operations aren't
implemented</p><p>* SMP: improved timing accuracy in the timer thread (if enabled)</p><p>Own Id: OTP-6424</p></li></ul><h2 id="erts-5-5-2-2" class="section-heading"><a href="#erts-5-5-2-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.2.2</span></h2><h3 id="fixed-bugs-and-malfunctions-350" class="section-heading"><a href="#fixed-bugs-and-malfunctions-350" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A bug in the kernel poll implementation could cause the emulator to omit
polling for events on file descriptors. The bug was only present when using
the kernel poll implementation based on epoll or kqueue. This bug was
introduced in erts-5.5.2.</p><p>Own Id: OTP-6344 Aux Id: OTP-6222</p></li></ul><h2 id="erts-5-5-2-1" class="section-heading"><a href="#erts-5-5-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-351" class="section-heading"><a href="#fixed-bugs-and-malfunctions-351" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The run_erl program now acquires its pseudo-ttys using openpty(3), so that it
will work on newer Linux distributions that don't have the traditional
pseudo-tty devices in the file system. On platforms that don't have
openpty(3), run_erl will still search for pseudo-tty devices in the file
system.</p><p>The run_erl program will now wait using waitpid(3) to prevent the program it
spawned to become defunct. run_erl will also terminate after a delay of 5
seconds (to allow any pending output to be written to the log file) if the
spawned program terminates even if some child of it still holds stdin and/or
stdout open.</p><p>Own Id: OTP-6225 Aux Id: seq10500</p></li><li><p>A bug in ordered_set ETS datatyp caused ets:select (and match) to return
faulty results when the table contained process id's from another node.</p><p>Own Id: OTP-6338</p></li></ul><h2 id="erts-5-5-2" class="section-heading"><a href="#erts-5-5-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.2</span></h2><h3 id="fixed-bugs-and-malfunctions-352" class="section-heading"><a href="#fixed-bugs-and-malfunctions-352" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>erlc: A typo in the help text for '-pa path' was corrected.</p><p>Own Id: OTP-6218</p></li><li><p>Failure in port command/control driver callbacks could crash the non-SMP
emulator. This bug was introduced in the 5.5 version of erts.</p><p>Own Id: OTP-6224</p></li><li><p>Erroneous &quot;<code class="inline">Input driver gone away without deselecting!</code>&quot; error reports could
sometimes occur when a driver instance terminated in the ready_output()
callback of the driver. This bug was only present in emulators that used
poll(). Note, that this bug was harmless, the only effect it had was the
erroneous error report.</p><p>Own Id: OTP-6229 Aux Id: OTP-3993, Seq5266, Seq7247, OTP-4307</p></li><li><p>The emulator could cause a type assertion failure while writing an
erl_crash.dump, causing the erl_crash.dump to be terminated and a core dump
generated.</p><p>Own Id: OTP-6235 Aux Id: seq10444</p></li><li><p>The registered name of a process is now the last observable resource removed
before links and monitors are triggered when a process terminates.</p><p>Previously ets tables were removed after the registered name. This could cause
problems on the runtime system with SMP support for code that expected that
ets tables owned by a specific process had been removed if the name of the
process had been removed.</p><p>Own Id: OTP-6237</p></li><li><p>Failure to fork() a new (os) process could cause the emulator to deadlock.
This bug affect all emulators with SMP support, and emulators with async
thread support on SunOS.</p><p>Own Id: OTP-6241 Aux Id: OTP-3906</p></li><li><p>Fprof traces could become truncated for the SMP emulator. This bug has now
been corrected.</p><p>Own Id: OTP-6246</p></li><li><p>The undocumented functions inet:getiflist/0,1 inet:ifget/2,3 and inet:getif/1
were completely broken on Windows. That has been fixed.</p><p>Own Id: OTP-6255</p></li><li><p>Behavior in case of disappeared nodes when using the dist_auto_connect once
got changed in R11B-1. The timeouts regarding normal distributed operations is
now reverted to the old (pre R11B-1).</p><p>Own Id: OTP-6258 Aux Id: OTP-6200, seq10449</p></li><li><p>The bsl and bsr operators could cause the emulator to crash if given invalid
arguments. (Thanks to datacompboy and Per Gustafsson.)</p><p>Own Id: OTP-6259</p></li><li><p>driver_cancel_timer() could under certain circumstances fail to cancel the
timer on the runtime system with SMP support.</p><p>Own Id: OTP-6261</p></li><li><p>A call to erlang:system_info(info) could deadlock the runtime system with SMP
support.</p><p>Own Id: OTP-6268</p></li></ul><h3 id="improvements-and-new-features-114" class="section-heading"><a href="#improvements-and-new-features-114" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Exit signals are now truly asynchronous in the runtime system with SMP
support. This simplifies locking in bifs a lot, and makes process termination
cheaper.</p><p>Own Id: OTP-6160</p></li><li><p>When tracing on the runtime system with SMP support it can be difficult to
know when a trace has been delivered to the tracer. A new built in function
<a href="erlang.html#trace_delivered/1"><code class="inline">erlang:trace_delivered/1</code></a> has been introduced in order to make it easier to
know when the trace has been delivered. See the erlang(3) man page for more
information.</p><p>Own Id: OTP-6205 Aux Id: OTP-6269</p></li><li><p>Kernel poll support can now be combined with SMP support. Currently the
following kernel poll versions exist: <code class="inline">/dev/poll</code>, <code class="inline">epoll</code>, and <code class="inline">kqueue</code>.
Linux <code class="inline">kpoll</code> has been replaced with <code class="inline">epoll</code>. Some time in the future there
will also be a kernel poll version using Solaris event ports.</p><p>The &quot;check io&quot; implementation for unix has been completely rewritten. The
current kernel poll implementation reduce the amount of system calls needed
compared to the old kernel poll implementation.</p><p>When <code class="inline">epoll</code> or <code class="inline">kqueue</code> is used either <code class="inline">poll</code> or <code class="inline">select</code> is used as
fallback. Previously only <code class="inline">poll</code> could be used as fallback. Since <code class="inline">select</code> now
can be used as fallback, kernel poll support is now also available on newer
MacOSX. Note however, when <code class="inline">select</code> is used as fallback, the maximum number of
file descriptors is limited to <code class="inline">FD_SETSIZE</code>.</p><p>Kernel poll support is now enabled by default if <code class="inline">/dev/poll</code>, <code class="inline">epoll</code>, or
<code class="inline">kqueue</code> is found when building OTP, i.e. you do not have to pass the
<code class="inline">--enable-kernel-poll</code> argument to <code class="inline">configure</code>. As before, kernel poll is
disabled by default in the runtime system. In order to enable it, pass the
<code class="inline">+Ktrue</code> command line argument to <code class="inline">erl</code>.</p><p>Note: <code class="inline">configure</code> will refuse to enable kernel poll support on FreeBSD since
<code class="inline">kqueue</code> have problems with (at least) pipes on all version of FreeBSD that we
have tested.</p><p>Own Id: OTP-6222 Aux Id: seq10380</p></li><li><p>The <code class="inline">erl_ddll</code> module and the code in the emulator have been completely
rewritten; several bugs were fixed.</p><p>Own Id: OTP-6234</p></li><li><p>The SMP emulator now avoids locking for the following operations (thus making
them as fast as in the UP emulator): <a href="erlang.html#atom_to_list/1"><code class="inline">atom_to_list/1</code></a>,
atom comparison, atom hashing, <a href="erlang.html#apply/3"><code class="inline">erlang:apply/3</code></a>.</p><p>Own Id: OTP-6252</p></li><li><p>There are new BIFs <code class="inline">erlang:spawn_monitor/1,3</code>, and the new option <code class="inline">monitor</code>
for <code class="inline">spawn_opt/2,3,4,5</code>.</p><p>The <code class="inline">observer_backend</code> module has been updated to handle the new BIFs.</p><p>Own Id: OTP-6281</p></li></ul><h2 id="erts-5-5-1-1" class="section-heading"><a href="#erts-5-5-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.1.1</span></h2><h3 id="improvements-and-new-features-115" class="section-heading"><a href="#improvements-and-new-features-115" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>There is now an option read_packets for UDP sockets that sets the maximum
number of UDP packets that will be read for each invocation of the socket
driver.</p><p>Own Id: OTP-6249 Aux Id: seq10452</p></li></ul><h2 id="erts-5-5-1" class="section-heading"><a href="#erts-5-5-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erts 5.5.1</span></h2><h3 id="fixed-bugs-and-malfunctions-353" class="section-heading"><a href="#fixed-bugs-and-malfunctions-353" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Complex pattern matching of strings would fail in the 64 bits emulator because
of a bug in the loader. (Thanks to Igor Goryachev.)</p><p>Own Id: OTP-6142</p></li><li><p><code class="inline">-134217728 div 134217728</code> and <code class="inline">-134217728 rem 134217728</code> would be calculated
incorrectly. <a href="erlang.html#abs/1"><code class="inline">abs(-2147483648)</code></a> could in unlucky circumstances
cause a heap overflow, as could size(Binary) when size of the binary was
larger than 128Mb.</p><p>Own Id: OTP-6154</p></li><li><p>erlang:display/1 displayed erroneous values for negative integers.</p><p>Big integers (both positive and negative) were previously displayed in
hexadecimal form while small integers were displayed in decimal form. All
integers are now displayed in decimal form.</p><p>NOTE: erlang:display/1 should only be used for debugging.</p><p>Own Id: OTP-6156</p></li><li><p>A call to erlang:trace/3 with erroneous flags caused the SMP emulator to
deadlock instead of exiting the calling process with badarg.</p><p>Own Id: OTP-6175</p></li><li><p>A bug causing the emulator to hang when exiting a process that is exception
traced has been fixed.</p><p>Own Id: OTP-6180</p></li><li><p>ets:rename/1 could deadlock, or crash the SMP emulator when the table wasn't a
named table.</p><p>ets:next/2, and ets:prev/2 could return erroneous results on the SMP emulator.</p><p>Own Id: OTP-6198 Aux Id: seq10392, seq10415</p></li><li><p>A memory allocation bug could cause the SMP emulator to crash when a process
had executed a <code class="inline">receive after</code> with a larger timeout than 10 minutes.</p><p>Own Id: OTP-6199</p></li><li><p>The runtime system with SMP support did not slowly adjust its view of time
when the system time suddenly changed.</p><p>Timeouts could sometimes timeout too early on the runtime system with SMP
support.</p><p>Own Id: OTP-6202</p></li></ul><h3 id="improvements-and-new-features-116" class="section-heading"><a href="#improvements-and-new-features-116" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The smp runtime system now automatically detects the number of logical
processors on MacOSX (darwin) and OpenBSD.</p><p>The smp runtime system is now built by default on MacOSX (darwin) on x86.</p><p>Own Id: OTP-6119</p></li><li><p>The <code class="inline">-smp</code> command line argument now take the following options: <code class="inline">enable</code>,
<code class="inline">auto</code>, or <code class="inline">disable</code>.</p><p>Especially the <code class="inline">-smpauto</code> argument is useful since it starts the Erlang
runtime system with SMP support if it is available and more than one logical
processor are detected; otherwise, it starts the Erlang runtime system without
SMP support. For more information see the <a href="erl_cmd.html">erl</a> man page.</p><p>Own Id: OTP-6126</p></li><li><p>Increased the reduction cost for sending messages in the SMP emulator so it
behaves more like the non-SMP emulator.</p><p>Own Id: OTP-6196</p></li><li><p>A port running a dynamically linked-in driver that exits due to the driver
being unloaded now exits with exit reason <code class="inline">driver_unloaded</code>. Previously the
port exited with exit reason <code class="inline">-1</code>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-6204</p></li><li><p>Changed name of the <a href="erlang.html#system_info/1"><code class="inline">erlang:system_info/1</code></a> argument <code class="inline">scheduler</code> to
<code class="inline">scheduler_id</code>. This since the <code class="inline">scheduler</code> argument so easily could be mixed
up with the <code class="inline">schedulers</code> argument (both returning integers).</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-6208</p></li><li><p>The changes below were made by Mikael Pettersson, HiPE.</p><p>HiPE runtime system:</p><p>Reduce overheads in the HiPE runtime system's BIF glue code.</p><p>Fix bug when exceptions are thrown from BEAM to HiPE.</p><p>Support SPARC on Linux.</p><p>Support x86 on FreeBSD.</p><p>Floating-point exceptions:</p><p>Reduce overheads in checking results of floating-point operations.</p><p>Minor bug fix in SSE2 floating-point exception handling.</p><p>Support SSE2 floating-point exceptions on 32-bit x86 machines.</p><p>Make FP exceptions work in the SMP runtime system on FreeBSD/x86.</p><p>Support floating-point exceptions on SPARCs running Linux.</p><p>Runtime system:</p><p>Minor scheduler optimisation in the non-SMP runtime system.</p><p>Substantial reduction of I/O thread overheads in the SMP runtime system if the
separate timer thread is used. (In R11B-1, the separate timer thread is not
used.)</p><p>Own Id: OTP-6211</p></li></ul><h2 id="erts-5-5" class="section-heading"><a href="#erts-5-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.5</span></h2><h3 id="fixed-bugs-and-malfunctions-354" class="section-heading"><a href="#fixed-bugs-and-malfunctions-354" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Previously <a href="erlang.html#unlink/1"><code class="inline">unlink/1</code></a> and <a href="erlang.html#demonitor/2"><code class="inline">erlang:demonitor/2</code></a> behaved
completely asynchronous. This had one undesirable effect, though. You could
never know when you were guaranteed <em>not</em> to be affected by a link that you
had unlinked or a monitor that you had demonitored.</p><p>The new behavior of <a href="erlang.html#unlink/1"><code class="inline">unlink/1</code></a> and <a href="erlang.html#demonitor/2"><code class="inline">erlang:demonitor/2</code></a> can be
viewed as two operations performed atomically. Asynchronously send an unlink
signal or a demonitor signal, and ignore any future results of the link or
monitor.</p><p><em>NOTE</em>: This change can cause some obscure code to fail which previously did
not. For example, the following code might hang:</p><pre><code class="makeup erlang" translate="no"><span class="w">            </span><span class="n">Mon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">monitor</span><span class="p" data-group-id="9314889177-1">(</span><span class="ss">process</span><span class="p">,</span><span class="w"> </span><span class="n">Pid</span><span class="p" data-group-id="9314889177-1">)</span><span class="p">,</span><span class="w">
            </span><span class="c1">%% ...</span><span class="w">
            </span><span class="nf">exit</span><span class="p" data-group-id="9314889177-2">(</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="ss">bang</span><span class="p" data-group-id="9314889177-2">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">demonitor</span><span class="p" data-group-id="9314889177-3">(</span><span class="n">Mon</span><span class="p" data-group-id="9314889177-3">)</span><span class="p">,</span><span class="w">
            </span><span class="k">receive</span><span class="w">
                </span><span class="p" data-group-id="9314889177-4">{</span><span class="ss">&#39;DOWN&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">Mon</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="ss">process</span><span class="p">,</span><span class="w"> </span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p" data-group-id="9314889177-4">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">ok</span><span class="w">
            </span><span class="c1">%% We were previously guaranteed to get a down message</span><span class="w">
            </span><span class="c1">%% (since we exited the process ourself), so we could</span><span class="w">
            </span><span class="c1">%% in this case leave out:</span><span class="w">
            </span><span class="c1">%% after 0 -&gt; ok</span><span class="w">
            </span><span class="k">end</span><span class="p">,</span></code></pre><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-5772</p></li><li><p>Two bugs fixed: If the environment variable <code class="inline">ERL_FLAGS</code> was set, its contents
would be appended to the end of the command line even if the command line had
an <code class="inline">-extra</code> options. Changed to place the options from <code class="inline">ERL_FLAGS</code> just before
<code class="inline">-extra</code>. Also, the <code class="inline">-smp</code> and <code class="inline">-hybrid</code> flags no longer have any effect if
placed after <code class="inline">-extra</code>.</p><p>Own Id: OTP-6054</p></li></ul><h3 id="improvements-and-new-features-117" class="section-heading"><a href="#improvements-and-new-features-117" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The documentation for writing drivers in the ERTS User's Guide has been
expanded and updated.</p><p>Own Id: OTP-5192</p></li><li><p>The <code class="inline">andalso</code> and <code class="inline">orelse</code> operators are now allowed to be used in guards.
That also applies to match specifications.</p><p>Own Id: OTP-5894 Aux Id: OTP-5149</p></li><li><p>There is a new trace match spec function <code class="inline">{exception_trace}</code> and a
corresponding trace message <code class="inline">exception_from</code> that can be used to trace on any
exit from a function, both normal function return and exception return. See
the documentation for details.</p><p>The <code class="inline">return_to</code> trace message is now also generated when the execution returns
to a function due to catching an exception.</p><p>Own Id: OTP-5956</p></li><li><p>Erlang runtime system with SMP (symmetric multi processing) support.</p><p>The runtime system with SMP support is in this release focused on stability
and there are a number of steps with optimizations to follow before it will
take full advantage of multi processor systems. The released system is however
truly multi threaded and you will notice increased performance for many
applications already. We recommend that you evaluate your application on the
SMP version of the runtime system and wait for some more optimizations before
you use it in a real product. You will then discover if there are any problems
in your application that needs to be fixed in order for it to work properly in
a multi threaded environment. More optimized versions of the runtime system
with SMP support will be included in the R11B maintenance releases.</p><p>The SMP enabled runtime system will be started if the <code class="inline">-smp</code> command line
argument is passed to the <code class="inline">erl</code> command. In order to make use of more than one
processor core, multiple scheduler threads are used. By default, the number of
scheduler threads will equal the number of processor cores. The number of
scheduler threads can be set with the <code class="inline">+S</code> command line argument. For more
information see the <a href="erl_cmd.html">erl</a> man page.</p><p>A runtime system with SMP support is by default built on the following
platforms if posix threads, and a gcc compiler of at least version 2.95 is
found:</p><ul><li>Linux with at least kernel version 2.6 and the Native POSIX Thread Library
on x86, x86_64, and 32-bits PowerPC.</li><li>Solaris of at least version 8 on 32-bits SPARC-V9.</li><li>MacOSX of at least version 10.4 (Darwin 8.0) on 32-bits PowerPC.</li></ul><p>The runtime system with SMP support is known <em>not</em> to build on:</p><ul><li>Windows.</li><li>Linux with kernel versions less than 2.4, or without the Native POSIX Thread
Library.</li><li>Other hardware platforms than x86, x86_64, 32-bits SPARC-V9 and 32-bits
PowerPC.</li></ul><p>Windows will be supported in a future release.</p><p>The runtime system with SMP support might build on other operating systems in
combination with supported hardware. In order to force a build of a runtime
system with SMP support, pass the <code class="inline">--enable-smp-support</code> command line argument
to configure. Note, however, that it is not enough that it builds. The
underlying thread library and operating system has to provide SMP support as
well. If the thread library does not distribute scheduler threads over
multiple processor cores then the runtime system will only seemingly provide
SMP support. If the runtime system is not built by default on a specific
platform, we have <em>not</em> tested it on that platform.</p><p><em>NOTE</em>: The design of SMP support for drivers is ongoing. There will probably
be incompatible driver changes (only affecting drivers run on the runtime
system with SMP support) released as patches for R11B.</p><p><em>Potential incompatibility</em>: Previously, specific driver call-backs were
always called from the same thread. This is <em>not</em> true in the runtime system
with SMP support. Calls to call-backs will be made from different threads,
e.g., two consecutive calls to exactly the same call-back can be made from two
different threads. This will in <em>most</em> cases not be a problem. All calls to
call-backs are synchronized, i.e., only one call-back will be called at a
time.</p><p>In the future the default behavior will <em>probably</em> be the following: Calls to
call-backs will, as now, be made from different threads. Calls to call-backs
in the same driver <em>instance</em> will be synchronized. It will probably be
possible to configure so that all calls to call-backs in all driver instances
of a specific driver type will be synchronized. It may be possible to
configure so that all calls to call-backs of a driver instance or a of a
specific driver type will be made from the same thread.</p><p>Parallelism in the Erlang code executed is a necessity for the Erlang runtime
system to be able to take advantage of multi-core or multi-processor hardware.
There need to be at least as many Erlang processes runnable as processor cores
for the Erlang runtime system to be able to take advantage of all processor
cores.</p><p>An Erlang runtime system with SMP support with only one Erlang process
runnable all the time will almost always be slower than the same Erlang
runtime system without SMP support. This is due to thread synchronization
overhead.</p><p>Known major bottleneck in the Erlang runtime system:</p><ul><li>Currently the I/O system uses one &quot;big lock&quot;, i.e. only one thread can do
I/O at a time (with the exception of async threads and threads created by
users own linked-in drivers). This is high on the list of things to
optimize. Note, code that does not do I/O can be executed at the same time
as one thread does I/O.</li></ul><p>Some pitfalls which might cause Erlang programs that work on the non-SMP
runtime system to fail on the SMP runtime system:</p><ul><li>A newly spawned process will often begin executing immediately. Code that
expects that the parent process will be able to execute for a while before
the child process begins executing is likely to fail.</li><li>High priority processes could previously provide mutual exclusion (bad
programming style) by preventing normal and low priority processes from
being run. High priority processes cannot be used this way to provide mutual
exclusion.</li><li><code class="inline">erlang:yield()</code> could be used to provide some kind of temporary mutual
exclusion (also bad programming style). <code class="inline">erlang:yield()</code> cannot be used to
provide any kind of mutual exclusion.</li><li>Obscure pitfall, only if a process being traced also sends normal messages
to the tracer:<br/>Â Â The order between trace messages and normal messages is undefined. I.e.
the order between normal messages sent from a tracee to a tracer and the
trace messages generated from the same tracee to the same tracer is
undefined. The internal order of normal messages and the internal order of
trace messages will, of course, be preserved as before.</li></ul><p>The kernel poll feature is currently not supported by the runtime system with
SMP support. It will probably be supported in a future release.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-6006 Aux Id: OTP-6095</p></li><li><p>Linked-in driver modifications.</p><ul><li>Linked-in drivers must be recompiled.</li><li>The <code class="inline">refc</code> field in the <code class="inline">ErlDrvBinary</code> type has been removed. The reference
count can be accessed via API functions. For more information see the
<code class="inline">erl_driver(3)</code> man page.</li></ul><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-6095 Aux Id: OTP-6006</p></li></ul><h2 id="erts-5-4-13" class="section-heading"><a href="#erts-5-4-13" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.13</span></h2><h3 id="fixed-bugs-and-malfunctions-355" class="section-heading"><a href="#fixed-bugs-and-malfunctions-355" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Large files (more than 2 GBytes) are now handled on Solaris 8.</p><p>Own Id: OTP-5849 Aux Id: seq10157</p></li><li><p>A failing bit syntax construction could fail with the PREVIOUS exception
reason that had occurred in the process (instead of with <code class="inline">badarg</code>).</p><p>Own Id: OTP-5911</p></li><li><p>When building OTP, the Kernel application was built in both the primary and
secondary bootstrap steps, which would cause problems if OTP including its
bootstrap is checked into a version control system (such as CVS). (Thanks to
Sebastian Strollo.)</p><p>Own Id: OTP-5921</p></li><li><p><code class="inline">binary_to_term(&lt;&lt;131,109,255,255,255,255)</code> and similar expressions used to
crash the emulator instead of causing a <code class="inline">badarg</code> exception. (Thanks to
Matthias Lang.)</p><p>Own Id: OTP-5933</p></li><li><p><a href="erlang.html#hibernate/3"><code class="inline">erlang:hibernate/3</code></a> could sometimes crash the emulator when no heap was
needed.</p><p>Own Id: OTP-5940</p></li><li><p>Execution of match specs could under rare circumstances cause the emulator to
dump core.</p><p>Execution of match specs could cause memory leaks in the hybrid emulator.</p><p>Own Id: OTP-5955</p></li><li><p>A bug in <a href="erlang.html#trace_info/2"><code class="inline">erlang:trace_info/2</code></a> when getting info for a function in a deleted
module resulting in an emulator crash, has been corrected.</p><p>Own Id: OTP-5957</p></li><li><p>Different (and old) <code class="inline">config.guess</code> files in the ERTS and Erl_Interface
applications would cause build problems on the new Intel-based iMacs. (Thanks
to Sebastion Strollo.)</p><p>Own Id: OTP-5967</p></li><li><p>pthread header and library mismatch on Linux systems (at least some SuSE and
Debian) with both NPTL and Linuxthreads libraries installed.</p><p>Own Id: OTP-5981</p></li></ul><h3 id="improvements-and-new-features-118" class="section-heading"><a href="#improvements-and-new-features-118" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The driver_set_timer did not change the previous timeout if called a second
time. Now it works as specified, changing the timeout.</p><p>Own Id: OTP-5942</p></li><li><p>The undocumented <code class="inline">{packet,http}</code> option (for the <code class="inline">gen_tcp</code> module) did not
work correctly when there were multiple continuation lines. (Thanks to Per
Hedeland.)</p><p>Own Id: OTP-5945</p></li><li><p>The setuid_socket_wrap program was corrected to work for C compilers that
treat the <code class="inline">char</code> type as unsigned. (Thanks to Magnus Henoch.)</p><p>Own Id: OTP-5946</p></li></ul><h2 id="erts-5-4-12" class="section-heading"><a href="#erts-5-4-12" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.12</span></h2><h3 id="fixed-bugs-and-malfunctions-356" class="section-heading"><a href="#fixed-bugs-and-malfunctions-356" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a minor build problem on Windows.</p><p>Own Id: OTP-5819 Aux Id: OTP-5382 OTP-5540 OTP-5577</p></li><li><p>The <code class="inline">delay_send</code> option for <code class="inline">gen_tcp</code> was broken on Windows.</p><p>Own Id: OTP-5822</p></li><li><p>If there were user-defined variables in the boot script, and their values were
not provided using the <code class="inline">-boot_var</code> option, the emulator would refuse to start
with a confusing error message. Corrected to show a clear, understandable
message.</p><p>The <code class="inline">prim_file</code> module was modified to not depend on the <code class="inline">lists</code> module, to
make it possible to start the emulator using a user-defined loader. (Thanks to
Martin Bjorklund.)</p><p>Own Id: OTP-5828 Aux Id: seq10151</p></li></ul><h3 id="improvements-and-new-features-119" class="section-heading"><a href="#improvements-and-new-features-119" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The HiPE compiler identifies more leaf functions, giving slightly faster code.</p><p>Corrected problems in HiPE's coalescing register allocating that would cause
it to fail when compiling very large functions (e.g. some of parse modules in
the Megaco application).</p><p>Own Id: OTP-5853</p></li></ul><h2 id="erts-5-4-11" class="section-heading"><a href="#erts-5-4-11" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.11</span></h2><h3 id="fixed-bugs-and-malfunctions-357" class="section-heading"><a href="#fixed-bugs-and-malfunctions-357" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Timers could sometimes timeout too early. This bug has now been fixed.</p><p>Automatic cancellation of timers created by
<code class="inline">erlang:send_after(Time,pid(),Msg)</code> and <code class="inline">erlang:start_timer(Time,pid(),Msg)</code>
has been introduced. Timers created with the receiver specified by a pid, will
automatically be cancelled when the receiver exits. For more information see
the <a href="erlang.html"><code class="inline">erlang</code></a> man page.</p><p>In order to be able to maintain a larger amount of timers without increasing
the maintenance cost, the internal timer wheel and bif timer table have been
enlarged.</p><p>Also a number of minor bif timer optimizations have been implemented.</p><p>Own Id: OTP-5795 Aux Id: OTP-5090, seq8913, seq10139, OTP-5782</p></li><li><p><code class="inline">erlang:monitor(process,Pid)</code> hanged if <code class="inline">Pid</code> referred to a process on a
non-existing node with the same nodename as the nodename of node on which the
call was made. This bug has now been fixed.</p><p>Own Id: OTP-5827</p></li></ul><h3 id="improvements-and-new-features-120" class="section-heading"><a href="#improvements-and-new-features-120" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>By setting Unix environment variables, the priority for the emulator can be
lowered when it is writing crash dumps and the time allowed for finishing
writing a crash dump can be set to a certain number of seconds. See the
documentation for <code class="inline">erl</code> in the ERTS application. (Also, a few other previously
undocumented environment variables are now documented.)</p><p>Own Id: OTP-5818</p></li><li><p>Documentation improvements:</p><p>- documentation for <a href="erlang.html#link/1"><code class="inline">erlang:link/1</code></a> corrected</p><p>- command line flag <code class="inline">-code_path_cache</code> added</p><p>- <code class="inline">erl</code> command line flags clarifications</p><p>- <a href="../../apps/kernel/net_kernel.html"><code class="inline">net_kernel</code></a> clarifications</p><p>Own Id: OTP-5847</p></li></ul><h2 id="erts-5-4-10" class="section-heading"><a href="#erts-5-4-10" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.10</span></h2><h3 id="fixed-bugs-and-malfunctions-358" class="section-heading"><a href="#fixed-bugs-and-malfunctions-358" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>-D_GNU_SOURCE is now always passed on the compile command line on linux. This
in order to ensure that all included system headers see _GNU_SOURCE defined.</p><p>_GNU_SOURCE is now also defined on linux in configure when looking for
features.</p><p>Some minor (harmless) configure bugs were also fixed.</p><p>Own Id: OTP-5749</p></li><li><p>Some compiler warnings and Dialyzer warnings were eliminated in the Tools
application.</p><p>When tracing to a port (which <code class="inline">fprof</code> does), there could be fake schedule
out/schedule in messages sent for a process that had exited.</p><p>Own Id: OTP-5757</p></li></ul><h3 id="improvements-and-new-features-121" class="section-heading"><a href="#improvements-and-new-features-121" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The BIFs <a href="erlang.html#iolist_size/1"><code class="inline">iolist_size/1</code></a> and
<a href="erlang.html#iolist_to_binary/1"><code class="inline">iolist_to_binary/1</code></a> has been added.</p><p>The BIF <a href="erlang.html#list_to_existing_atom/1"><code class="inline">list_to_existing_atom/1</code></a> has been added.</p><p>Minor bug fix: The exception reason could be changed to <code class="inline">error</code> inside nested
try/catch constructs if the <a href="erlang.html#raise/3"><code class="inline">erlang:raise/3</code></a> BIF was called with an empty
stacktrace. (Calling <a href="erlang.html#raise/3"><code class="inline">erlang:raise/3</code></a> with an empty stacktrace is NOT
recommended.)</p><p>Minor bugfix: On Windows, <a href="../../apps/kernel/file.html#open/2"><code class="inline">file:open/2</code></a> will now return the documented error
reason <code class="inline">{error,eisdir}</code> if the filename refers to a directory (it used to
return <code class="inline">{error,eacces}</code>).</p><p>The message in the documentation for <a href="erlang.html#system_monitor/2"><code class="inline">erlang:system_monitor/2</code></a>, description of
<code class="inline">busy_dist_port</code>, was corrected.</p><p>Own Id: OTP-5709 Aux Id: seq10100</p></li><li><p>The previously undocumented and UNSUPPORTED <code class="inline">zlib</code> module has been updated in
an incompatible way and many bugs have been corrected. It is now also
documented.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-5715</p></li><li><p>New socket options <code class="inline">priority</code> and <code class="inline">tos</code> for platforms that support them
(currently only Linux).</p><p>Own Id: OTP-5756</p></li><li><p>Only the emulator is now linked with termcap library in order to decrease
library dependencies for other otp programs.</p><p>Own Id: OTP-5758</p></li></ul><h2 id="erts-5-4-9-2" class="section-heading"><a href="#erts-5-4-9-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.9.2</span></h2><h3 id="fixed-bugs-and-malfunctions-359" class="section-heading"><a href="#fixed-bugs-and-malfunctions-359" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The native resolver has gotten an control API for extended debugging and soft
restart. It is: <code class="inline">inet_gethost_native:control(Control)</code><br/><code class="inline">Control = {debug_level,Level} | soft_restart</code><br/><code class="inline">Level = integer() in the range 0-4</code>.</p><p>Own Id: OTP-5751 Aux Id: EABln25013</p></li></ul><h2 id="erts-5-4-9-1" class="section-heading"><a href="#erts-5-4-9-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.9.1</span></h2><h3 id="improvements-and-new-features-122" class="section-heading"><a href="#improvements-and-new-features-122" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>On VxWorks, epmd did not handle file descriptors with higher numbers than 63.
Also, if epmd should get a file descriptor with a number &gt;= FD_SETSIZE, it
will close a the file descriptor and write a message to the log (instead of
mysteriously fail); the Erlang node that tried to register will fail with a
duplicate_name error (unfortunately, epmd has no way to indicate to the Erlang
node why the register attempt failed).</p><p>Own Id: OTP-5716 Aux Id: seq10070</p></li></ul><h2 id="erts-5-4-9" class="section-heading"><a href="#erts-5-4-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.9</span></h2><h3 id="fixed-bugs-and-malfunctions-360" class="section-heading"><a href="#fixed-bugs-and-malfunctions-360" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Timezone data is now initialized better. (was a problem at least on NetBSD
2.0.2) Thanks to Rich Neswold.</p><p>Own Id: OTP-5621</p></li><li><p>The hybrid-heap emulator ('erl -hybrid') is much more stable. We have
corrected all known bugs that caused it to dump core while running our test
suites.</p><p>Own Id: OTP-5634</p></li><li><p>Fixed rare memory leaks in <a href="erlang.html#demonitor/1"><code class="inline">erlang:demonitor/1</code></a> when distributed monitors were
removed.</p><p>Own Id: OTP-5692</p></li><li><p>Processes were sometimes unnecessarily garbage collected when terminating.
These unnecessary garbage collections have now been eliminated.</p><p>Own Id: OTP-5693</p></li></ul><h3 id="improvements-and-new-features-123" class="section-heading"><a href="#improvements-and-new-features-123" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The <code class="inline">c:i/0</code> function will now run in a paged mode if there are more than 100
processes in the system. (Thanks to Ulf Wiger.)</p><p><code class="inline">erlang:system_info(process_count)</code> has been optimized and does now return
exactly the same value as <a href="erlang.html#length/1"><code class="inline">length(processes())</code></a>. Previously
<code class="inline">erlang:system_info(process_count)</code> did not include exiting processes which
are included in <a href="erlang.html#length/1"><code class="inline">length(processes())</code></a>.</p><p>The <code class="inline">+P</code> flag for <code class="inline">erl</code>, which sets the maximum number of processes allowed to
exist at the same, no longer accepts values higher than 134217727. (You will
still probably run out of memory before you'll be able to reach that limit.)</p><p>Own Id: OTP-5645 Aux Id: seq9984</p></li><li><p>The term-building driver functions <code class="inline">driver_output_term()</code> and
<code class="inline">driver_send_term()</code> have been updated:</p><p>The ERL_DRV_FLOAT type has been added.</p><p>For the ERL_DRV_BINARY type, the length and offset are now validated against
the length of the driver binary.</p><p>The ERL_DRV_PID type is now implemented (it was documented, but not
implemented).</p><p>Own Id: OTP-5674</p></li></ul><h2 id="erts-5-4-8" class="section-heading"><a href="#erts-5-4-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.8</span></h2><h3 id="fixed-bugs-and-malfunctions-361" class="section-heading"><a href="#fixed-bugs-and-malfunctions-361" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><a href="../../apps/stdlib/ets.html#delete/1"><code class="inline">ets:delete/1</code></a> now allows other Erlang process to run when a large table is
being deleted.</p><p>Own Id: OTP-5572</p></li><li><p>A bug regarding tcp sockets which results in hanging <a href="../../apps/kernel/gen_tcp.html#send/2"><code class="inline">gen_tcp:send/2</code></a> has been
corrected. To encounter this bug you needed one process that read from a
socket, one that wrote more date than the reader read out so the sender got
suspended, and then the reader closed the socket. (Reported and diagnosed by
Alexey Shchepin.)</p><p>Corrected a bug in the (undocumented and unsupported) option <code class="inline">{packet,http}</code>
for <code class="inline">gen_tcp.</code> (Thanks to Claes Wikstrom and Luke Gorrie.)</p><p>Updated the documentation regarding the second argument to <a href="../../apps/kernel/gen_tcp.html#recv/2"><code class="inline">gen_tcp:recv/2</code></a>,
the <code class="inline">Length</code> to receive.</p><p>Own Id: OTP-5582 Aux Id: seq9839</p></li><li><p>Erlang/OTP will now build on Mac OS X 10.4 &quot;Tiger&quot; (the problem was that 10.4
has a partially implemented poll() function that can't handle devices). Also,
on Mac OS X 10.3 &quot;Panther&quot;, Erlang/OTP will now use select() instead of poll()
(because poll() on Mac OS X 10.3 is implemented using select()).</p><p>Own Id: OTP-5595</p></li><li><p>A bug in the file driver when opening a file in compressed mode, and the
returned allocated pointer from the compressing library was in very high
memory (&gt;= 2GB), causing e.g. <a href="../../apps/kernel/file.html#read/2"><code class="inline">file:read/2</code></a> to return <code class="inline">{error,ebadf}</code>, has
been corrected.</p><p>Own Id: OTP-5618</p></li></ul><h3 id="improvements-and-new-features-124" class="section-heading"><a href="#improvements-and-new-features-124" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The new fun <code class="inline">M:F/A</code> construct creates a fun that refers to the latest version
of <code class="inline">M:F/A.</code> This syntax is meant to replace tuple funs <code class="inline">{M,F}</code> which have many
problems.</p><p>The new type test <a href="erlang.html#is_function/2"><code class="inline">is_function(Fun,A)</code></a> (which may be used
in guards) test whether <code class="inline">Fun</code> is a fun that can be applied with <code class="inline">A</code> arguments.
(Currently, <code class="inline">Fun</code> can also be a tuple fun.)</p><p>Own Id: OTP-5584</p></li><li><p>In the HiPE application, there's a new experimental register allocator
(optimistic coalescing), and the linear scan register allocator is now also
available on ppc. Plus lots of cleanups.</p><p>Minor hybrid heap corrections.</p><p>The maximum size of a heap used to be artificially limited so that the size of
a heap would fit in 28 bits; that limitation could cause the emulator to
terminate in a garbage collection even if there still was available memory.
Now the largest heap size for a 32 bit CPU is 1,699,221,830 bytes. (Thanks to
Jesper Wilhelmsson.)</p><p>Also removed the undocumented <code class="inline">+H</code> emulator option.</p><p>Own Id: OTP-5596</p></li></ul><h2 id="erts-5-4-7" class="section-heading"><a href="#erts-5-4-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.7</span></h2><h3 id="fixed-bugs-and-malfunctions-362" class="section-heading"><a href="#fixed-bugs-and-malfunctions-362" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><code class="inline">to_erl</code> could close unexpectedly on Linux systems. Also, output from the
emulator could be lost. Corrected.</p><p>Own Id: OTP-5561</p></li></ul><h3 id="improvements-and-new-features-125" class="section-heading"><a href="#improvements-and-new-features-125" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The <code class="inline">cpu_timestamp</code> option for <a href="erlang.html#trace/3"><code class="inline">erlang:trace/3</code></a> is now also supported on
Linux.</p><p>Own Id: OTP-5532 Aux Id: seq9813</p></li><li><p>The last known <code class="inline">werl</code> window size/position is now saved correctly when <code class="inline">werl</code>
is stopped with the window minimized. A problem with the placement not being
saved if the emulator is halted or stopped from the JCL menu has also been
fixed.</p><p>Own Id: OTP-5544 Aux Id: OTP-5522</p></li></ul><h2 id="erts-5-4-6" class="section-heading"><a href="#erts-5-4-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.6</span></h2><h3 id="fixed-bugs-and-malfunctions-363" class="section-heading"><a href="#fixed-bugs-and-malfunctions-363" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Some math libraries do not always throw floating-point exceptions on errors.
In order to be able to use these libraries, floating-point errors are now more
thoroughly checked.</p><p>Misc floating-point fixes for Linux and MacOSX.</p><p>Own Id: OTP-5467</p></li><li><p>An internal buffer was sometimes not cleared which caused garbage to appear in
error messages sent to the error logger.</p><p><code class="inline">errno</code> was sometimes clobbered which caused erroneous error reports about
<code class="inline">poll()</code> errors.</p><p>Only emulators on unix platforms were affected by these bugs.</p><p>Own Id: OTP-5492</p></li><li><p>The ethread library now works on OpenBSD.</p><p>Own Id: OTP-5515</p></li><li><p>Corrected a bug in the (undocumented and unsupported) option <code class="inline">{packet,http}</code>
for <code class="inline">gen_tcp</code>. (Thanks to Claes Wikstrom and Luke Gorrie.)</p><p>Own Id: OTP-5519</p></li></ul><h3 id="improvements-and-new-features-126" class="section-heading"><a href="#improvements-and-new-features-126" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p><a href="erlang.html#binary_to_term/1"><code class="inline">binary_to_term/1</code></a> could cause the emulator to crash
when given invalid pids or funs.</p><p>Own Id: OTP-5484 Aux Id: seq9801</p></li><li><p>Some more stability problems were fixed in the hybrid-heap emulator.</p><p>Own Id: OTP-5489</p></li><li><p>After <code class="inline">werl</code> was closed with the window minimized, it was not possible to
restart <code class="inline">werl</code> with an open window. A temporary solution has so far been
implemented that restores the initial window settings every time <code class="inline">werl</code> is
started.</p><p>Own Id: OTP-5522</p></li></ul><h2 id="erts-5-4-5" class="section-heading"><a href="#erts-5-4-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.5</span></h2><h3 id="fixed-bugs-and-malfunctions-364" class="section-heading"><a href="#fixed-bugs-and-malfunctions-364" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>If a process had node links (created by <a href="erlang.html#monitor_node/2"><code class="inline">monitor_node/2</code></a>),
executing <a href="erlang.html#process_info/2"><code class="inline">process_info(Pid,memory)</code></a> for that process
would crash the emulator.</p><p>Own Id: OTP-5420</p></li><li><p>Minor corrections to the help text printed by <code class="inline">erlc -help</code>. The documentation
for <code class="inline">erlc</code> was also slightly updated.</p><p>Own Id: OTP-5428</p></li><li><p>32-bit words were used for offsets in the garbage collector. This caused the
emulator to crash on 64-bit machines when heaps were moved more than 4 GB
during garbage collection.</p><p>Own Id: OTP-5430</p></li><li><p><a href="erlang.html#is_boolean/1"><code class="inline">is_boolean(42.5)</code></a> failed to load if optimization was
explicitly turned off.</p><p>Own Id: OTP-5448</p></li><li><p>If there was a call to <code class="inline">Module:foo/X</code> from any loaded module, the returned by
<code class="inline">M:module_info(exports)</code> would always include <code class="inline">{foo,X}</code> (even though
<code class="inline">Module:foo/X</code> if was not defined).</p><p>Own Id: OTP-5450 Aux Id: seq9722</p></li></ul><h3 id="improvements-and-new-features-127" class="section-heading"><a href="#improvements-and-new-features-127" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The <code class="inline">c</code> option for the <code class="inline">+B</code> flag has been introduced which makes it possible
to use Ctrl-C (Ctrl-Break on Windows) to interrupt the shell process rather
than to invoke the emulator break handler. All new <code class="inline">+B</code> options are also
supported on Windows (<code class="inline">werl</code>) as of now. Furthermore, Ctrl-C on Windows has
now been reserved for copying text (what Ctrl-Ins was used for previously).
Ctrl-Break should be used for break handling. Lastly, the documentation of the
system flags has been updated.</p><p>Own Id: OTP-5388</p></li></ul><h2 id="erts-5-4-4" class="section-heading"><a href="#erts-5-4-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.4</span></h2><h3 id="fixed-bugs-and-malfunctions-365" class="section-heading"><a href="#fixed-bugs-and-malfunctions-365" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The function <a href="erlang.html#float/1"><code class="inline">erlang:float/1</code></a> can now be used in match specifications and is
recognized by <a href="../../apps/runtime_tools/dbg.html#fun2ms/1"><code class="inline">dbg:fun2ms/1</code></a> and <a href="../../apps/stdlib/ets.html#fun2ms/1"><code class="inline">ets:fun2ms/1</code></a>. This addition is part of the
work to &quot;harmonize&quot; match specification guards with Erlang guards.</p><p>Own Id: OTP-5297 Aux Id: OTP-4927</p></li><li><p>The <a href="erlang.html#register/2"><code class="inline">register/2</code></a> BIF would return <code class="inline">true</code> even if the second
argument was not a pid for living process. Corrected to cause an exception.</p><p>Own Id: OTP-5324 Aux Id: seq9698</p></li><li><p>In the 'bag' type of ets tables, elements having the same key were supposed to
be order in insertion order. The would be wrong if a rehash occurred.</p><p>Own Id: OTP-5340 Aux Id: seq9704</p></li><li><p>Linked in drivers in the Crypto and Asn1 applications are now compiled with
the <code class="inline">-D_THREAD_SAFE</code> and <code class="inline">-D_REENTRANT</code> switches on unix when the emulator has
thread support enabled.</p><p>Linked in drivers on MacOSX are not compiled with the undocumented
<code class="inline">-lbundle1.o</code> switch anymore. Thanks to Sean Hinde who sent us a patch.</p><p>Linked in driver in Crypto, and port programs in SSL, now compiles on OSF1.</p><p>Minor makefile improvements in Runtime_Tools.</p><p>Own Id: OTP-5346</p></li><li><p>Fixed a bug in the hybrid heap in distributed send operations.</p><p>Own Id: OTP-5361</p></li><li><p>A BIF <a href="erlang.html#raise/3"><code class="inline">erlang:raise/3</code></a> has been added. See the manual for details. It is
intended for internal system programming only, advanced error handling.</p><p>Own Id: OTP-5376 Aux Id: OTP-5257</p></li><li><p>Mikael Pettersson (HiPE) corrected a few bugs in the emulator that caused
problems when compiled with the experimental gcc-4.0.0.</p><p>Own Id: OTP-5386</p></li></ul><h3 id="improvements-and-new-features-128" class="section-heading"><a href="#improvements-and-new-features-128" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Minor update of the internal documentation of the <code class="inline">epmd</code> protocol.</p><p>The listen port of <code class="inline">epmd</code> has now been registered at IANA:
<a href="http://www.iana.org/assignments/port-numbers">http://www.iana.org/assignments/port-numbers</a>.</p><p>Own Id: OTP-5234</p></li><li><p><code class="inline">run_erl.c</code> now works on Mac OS X and FreeBSD.</p><p>Own Id: OTP-5384</p></li><li><p>A few bugs were corrected in the HiPE application.</p><p>Own Id: OTP-5385</p></li></ul><h2 id="erts-5-4-3" class="section-heading"><a href="#erts-5-4-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.3</span></h2><h3 id="fixed-bugs-and-malfunctions-366" class="section-heading"><a href="#fixed-bugs-and-malfunctions-366" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Font and color preferences for <code class="inline">werl.exe</code> now can be saved even after the
first time you run <code class="inline">werl.exe</code>. The window position and size is also saved.
Patch from James Hague who did all the hard work.</p><p>Own Id: OTP-5250</p></li><li><p>OTP archive libraries, e.g. the <code class="inline">erl_interface</code> library, on MacOSX could not
be used without first rerunning <code class="inline">ranlib</code> on them. This bug has now been fixed.</p><p>Own Id: OTP-5274</p></li><li><p>Bugs in <code class="inline">erlang:hash/2</code> and <a href="erlang.html#phash/2"><code class="inline">erlang:phash/2</code></a> on 64-bit platforms have been
fixed.</p><p>Own Id: OTP-5292</p></li></ul><h3 id="improvements-and-new-features-129" class="section-heading"><a href="#improvements-and-new-features-129" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Corrected a crash in the 64-bits emulator.</p><p>Corrected a problem in the hybrid heap emulator.</p><p>In the chapter about the abstract format in the ERTS User's Guide, updated the
last section about how the abstract format is stored in BEAM files.</p><p>Own Id: OTP-5262</p></li><li><p>The maximum number of concurrent threads in the internal ethread thread
package has been limited to 2048.</p><p>Own Id: OTP-5280</p></li></ul><h2 id="erts-5-4-2-1" class="section-heading"><a href="#erts-5-4-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.2.1</span></h2><h3 id="improvements-and-new-features-130" class="section-heading"><a href="#improvements-and-new-features-130" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>If Erlang/OTP was installed in a short directory name, such as
<code class="inline">C:\Program\erl5.4.2</code>, the emulator would not start.</p><p>Own Id: OTP-5254</p></li></ul><h2 id="erts-5-4-2" class="section-heading"><a href="#erts-5-4-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.2</span></h2><h3 id="fixed-bugs-and-malfunctions-367" class="section-heading"><a href="#fixed-bugs-and-malfunctions-367" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>If one used <code class="inline">select/3</code> and <code class="inline">select/1</code> on a non-fixed ETS table and deleted
objects simultaneously, the emulator could crash. Note that the result of such
simultaneous operations on tables that are not in a fixed state is still
undefined, but the emulator crash is, needless to say, fixed.</p><p>Own Id: OTP-5209 Aux Id: seq9198</p></li><li><p>Arithmetic with big numbers could crash the emulator.</p><p>The HiPE native code compiler and run-time code in the emulator has been
updated. (Note: Native code is still not supported.)</p><p>Eliminated a few bugs that could crash the hybrid emulator (which is not
supported).</p><p>Own Id: OTP-5233 Aux Id: seq9587</p></li></ul><h2 id="erts-5-4-1" class="section-heading"><a href="#erts-5-4-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ERTS 5.4.1</span></h2><h3 id="fixed-bugs-and-malfunctions-368" class="section-heading"><a href="#fixed-bugs-and-malfunctions-368" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The ethread library was unnecessarily rebuilt multiple times during the build
process, also a debug version of the library was build during the install
phase. These unnecessary builds have now been removed. Note, the content of
the installed Erlang/OTP system is not effected at all by this change.</p><p>Own Id: OTP-5203</p></li><li><p>The emulator could fail to clear the memory segment cache. This could
potentially cause memory allocation to unnecessarily fail when memory usage
was close to its maximum. This bug has now been fixed.</p><p>Own Id: OTP-5211</p></li><li><p>std_alloc (std short for standard) was sometimes called def_alloc (def short
for default). std_alloc is now everywhere referred to as std_alloc.</p><p>Own Id: OTP-5216</p></li><li><p>A documentation bug has been corrected in the <code class="inline">erts_alloc(3)</code> documentation.
It was stated that some of the memory allocators present were by default
disabled. This is true for Erlang/OTP R9C, but is not true for Erlang/OTP
R10B. In R10B all memory allocators present are enabled by default.</p><p>Own Id: OTP-5217</p></li></ul><h3 id="improvements-and-new-features-131" class="section-heading"><a href="#improvements-and-new-features-131" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The emulator now close all open files and sockets immediately after receiving
an USR1 signal. This causes the emulator to unregister at <code class="inline">epmd</code> as early as
possible.</p><p>Own Id: OTP-5221 Aux Id: OTP-4985, seq9514</p></li><li><p>Try/catch support in the emulator slightly updated.</p><p>Own Id: OTP-5229</p></li></ul>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

  </div>
  <div class="bottom-actions-item">

      <a href="introduction.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page â†’
        </span>
        <span class="title">
Introduction
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright Â© 1996-2025 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js"></script>
  <script>
  let initialized = false;

  window.addEventListener("exdoc:loaded", () => {
      if (!initialized) {
      mermaid.initialize({
          startOnLoad: false,
          theme: document.body.className.includes("dark") ? "dark" : "default"
      });
      initialized = true;
      }

      let id = 0;
      for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
          graphEl.innerHTML = svg;
          bindFunctions?.(graphEl);
          preEl.insertAdjacentElement("afterend", graphEl);
          preEl.remove();
      });
      }
  });
  </script>

  </body>
</html>
