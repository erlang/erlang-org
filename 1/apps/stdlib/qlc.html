<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.1">
    <meta name="project" content="stdlib v7.0">


<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=1&q=">
<meta name="major-vsn" content="1">
<link rel="canonical" href="https://www.erlang.org/doc/apps/stdlib/qlc.html" />
    <title>qlc — stdlib v7.0</title>

    <link rel="stylesheet" href="dist/html-erlang-ZK43ZOAC.css" />

    <script defer src="dist/sidebar_items-AA1EE98A.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="stdlib" />
        </a>

      <div>
        <a href="../../index.html" class="sidebar-projectName" translate="no">
stdlib
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v7.0
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-module" id="main" data-type="modules">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of stdlib</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>
      <span translate="no">qlc</span> 
      <small class="app-vsn" translate="no">(stdlib v7.0)</small>

    </h1>

      <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L22" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


    <section id="moduledoc">
<!--%% %CopyrightBegin%%%%% SPDX-License-Identifier: Apache-2.0%%%% Copyright Ericsson AB 2004-2025. All Rights Reserved.%%%% Licensed under the Apache License, Version 2.0 (the "License");%% you may not use this file except in compliance with the License.%% You may obtain a copy of the License at%%%%     http://www.apache.org/licenses/LICENSE-2.0%%%% Unless required by applicable law or agreed to in writing, software%% distributed under the License is distributed on an "AS IS" BASIS,%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.%% See the License for the specific language governing permissions and%% limitations under the License.%%%% %CopyrightEnd%--><p>This module provides a query interface to <a href="../../apps/mnesia/mnesia.html">Mnesia</a>, <a href="ets.html">ETS</a>,
<a href="dets.html">Dets</a>, and other data structures that provide an iterator style
traversal of objects.</p><h2 id="module-overview" class="section-heading"><a href="#module-overview" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Overview</span></h2><p>This module provides a query interface to <em>QLC tables</em>. Typical QLC tables are
Mnesia, ETS, and Dets tables. Support is also provided for user-defined tables,
see section <a href="qlc.html#implementing_a_qlc_table">Implementing a QLC Table</a>. <a href="" id="query_list_comprehension"></a> A <em>query</em> is expressed using <em>Query List
Comprehensions</em> (QLCs). The answers to a query are determined by data in QLC
tables that fulfill the constraints expressed by the QLCs of the query. QLCs are
similar to ordinary list comprehensions as described in
<a href="../../system/expressions.html#lcs">Erlang Reference Manual</a> and
<a href="../../system/list_comprehensions.html">Programming Examples</a>, except that variables
introduced in patterns cannot be used in list expressions. In the absence of
optimizations and options such as <code class="inline">cache</code> and <code class="inline">unique</code> (see section
<a href="qlc.html#common_options">Common Options</a>, every QLC free of QLC tables evaluates
to the same list of answers as the identical ordinary list comprehension.</p><p>While ordinary list comprehensions evaluate to lists, calling <a href="#q/1"><code class="inline">q/1,2</code></a>
returns a <em id="query_handle">query handle</em>. To obtain all the answers to a
query, <a href="#eval/1"><code class="inline">eval/1,2</code></a> is to be called with the query handle as first
argument. Query handles are essentially functional objects (funs) created in the
module calling <code class="inline">q/1,2</code>. As the funs refer to the module code, be careful not to
keep query handles too long if the module code is to be replaced. Code
replacement is described in section
<a href="../../system/code_loading.html">Compilation and Code Loading</a> in the Erlang
Reference Manual. The list of answers can also be traversed in chunks by use of
a <em id="query_cursor">query cursor</em>. Query cursors are created by calling
<a href="#cursor/1"><code class="inline">cursor/1,2</code></a> with a query handle as first argument. Query cursors
are essentially Erlang processes. One answer at a time is sent from the query
cursor process to the process that created the cursor.</p><h2 id="module-syntax" class="section-heading"><a href="#module-syntax" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Syntax</span></h2><p>Syntactically QLCs have the same parts as ordinary list comprehensions:</p><pre><code class="text">[Expression || Qualifier1, Qualifier2, ...]</code></pre><p><code class="inline">Expression</code> (the <em>template</em>) is any Erlang expression. Qualifiers are either
<em>filters</em> or <em>generators</em>. Filters are Erlang expressions returning
<a href="../../apps/erts/erlang.html#t:boolean/0"><code class="inline">boolean/0</code></a>. Generators have the form <code class="inline">Pattern &lt;- ListExpression</code>, where
<code class="inline">ListExpression</code> is an expression evaluating to a query handle or a list. Query
handles are returned from <a href="#append/1"><code class="inline">append/1,2</code></a>,
<a href="#keysort/2"><code class="inline">keysort/2,3</code></a>, <a href="#q/1"><code class="inline">q/1,2</code></a>, <a href="#sort/1"><code class="inline">sort/1,2</code></a>,
<a href="#string_to_handle/1"><code class="inline">string_to_handle/1,2,3</code></a>, and <a href="#table/2"><code class="inline">table/2</code></a>.</p><h2 id="module-evaluation" class="section-heading"><a href="#module-evaluation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Evaluation</span></h2><p>A query handle is evaluated in the following order:</p><ul><li>Inspection of options and the collection of information about tables. As a
result, qualifiers are modified during the optimization phase.</li><li>All list expressions are evaluated. If a cursor has been created, evaluation
takes place in the cursor process. For list expressions that are QLCs, the
list expressions of the generators of the QLCs are evaluated as well. Be
careful if list expressions have side effects, as list expressions are
evaluated in unspecified order.</li><li>The answers are found by evaluating the qualifiers from left to right,
backtracking when some filter returns <code class="inline">false</code>, or collecting the template when
all filters return <code class="inline">true</code>.</li></ul><p>Filters that do not return <a href="../../apps/erts/erlang.html#t:boolean/0"><code class="inline">boolean/0</code></a> but fail are handled differently
depending on their syntax: if the filter is a guard, it returns <code class="inline">false</code>,
otherwise the query evaluation fails. This behavior makes it possible for the
<code class="inline">qlc</code> module to do some optimizations without affecting the meaning of a query.
For example, when testing some position of a table and one or more constants for
equality, only the objects with equal values are candidates for further
evaluation. The other objects are guaranteed to make the filter return <code class="inline">false</code>,
but never fail. The (small) set of candidate objects can often be found by
looking up some key values of the table or by traversing the table using a match
specification. It is necessary to place the guard filters immediately after the
table generator, otherwise the candidate objects are not restricted to a small
set. The reason is that objects that could make the query evaluation fail must
not be excluded by looking up a key or running a match specification.</p><h2 id="module-join" class="section-heading"><a href="#module-join" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Join</span></h2><p>The <code class="inline">qlc</code> module supports fast join of two query handles. Fast join is possible
if some position <code class="inline">P1</code> of one query handler and some position <code class="inline">P2</code> of another
query handler are tested for equality. Two fast join methods are provided:</p><ul><li><em>Lookup join</em> traverses all objects of one query handle and finds objects of
the other handle (a QLC table) such that the values at <code class="inline">P1</code> and <code class="inline">P2</code> match or
compare equal. The <code class="inline">qlc</code> module does not create any indexes but looks up
values using the key position and the indexed positions of the QLC table.</li><li><em>Merge join</em> sorts the objects of each query handle if necessary and filters
out objects where the values at <code class="inline">P1</code> and <code class="inline">P2</code> do not compare equal. If many
objects with the same value of <code class="inline">P2</code> exist, a temporary file is used for the
equivalence classes.</li></ul><p>The <code class="inline">qlc</code> module warns at compile time if a QLC combines query handles in such a
way that more than one join is possible. That is, no query planner is provided
that can select a good order between possible join operations. It is up to the
user to order the joins by introducing query handles.</p><p>The join is to be expressed as a guard filter. The filter must be placed
immediately after the two joined generators, possibly after guard filters that
use variables from no other generators but the two joined generators. The <code class="inline">qlc</code>
module inspects the operands of <code class="inline">=:=/2</code>, <code class="inline">==/2</code>, <a href="../../apps/erts/erlang.html#is_record/2"><code class="inline">is_record/2</code></a>,
<a href="../../apps/erts/erlang.html#element/2"><code class="inline">element/2</code></a>, and logical operators (<code class="inline">and/2</code>, <code class="inline">or/2</code>, <code class="inline">andalso/2</code>,
<code class="inline">orelse/2</code>, <code class="inline">xor/2</code>) when determining which joins to consider.</p><p><a href="" id="common_options"></a></p><h2 id="module-common-options" class="section-heading"><a href="#module-common-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Common Options</span></h2><p>The following options are accepted by <a href="#cursor/2"><code class="inline">cursor/2</code></a>, <a href="#eval/2"><code class="inline">eval/2</code></a>, <a href="#fold/4"><code class="inline">fold/4</code></a>, and
<a href="#info/2"><code class="inline">info/2</code></a>:</p><ul><li><code class="inline">{cache_all, Cache}</code>, where <code class="inline">Cache</code> is equal to <code class="inline">ets</code> or <code class="inline">list</code> adds a
<code class="inline">{cache, Cache}</code> option to every list expression of the query except tables
and lists. Defaults to <code class="inline">{cache_all, no}</code>. Option <code class="inline">cache_all</code> is equivalent to
<code class="inline">{cache_all, ets}</code>.</li><li><code class="inline" id="max_list_size">{max_list_size, MaxListSize}</code>, where <code class="inline">MaxListSize</code> is the
size in bytes of terms on the external format. If the accumulated size of
collected objects exceeds <code class="inline">MaxListSize</code>, the objects are written onto a
temporary file. This option is used by option <code class="inline">{cache, list}</code> and by the merge
join method. Defaults to 512*1024 bytes.</li><li><code class="inline">{tmpdir_usage, TmpFileUsage}</code> determines the action taken when <code class="inline">qlc</code> is about
to create temporary files on the directory set by option <code class="inline">tmpdir</code>. If the
value is <code class="inline">not_allowed</code>, an error tuple is returned, otherwise temporary files
are created as needed. Default is <code class="inline">allowed</code>, which means that no further
action is taken. The values <code class="inline">info_msg</code>, <code class="inline">warning_msg</code>, and <code class="inline">error_msg</code> mean
that the function with the corresponding name in module <a href="../../apps/kernel/error_logger.html"><code class="inline">error_logger</code></a> is
called for printing some information (currently the stacktrace).</li><li><code class="inline">{tmpdir, TempDirectory}</code> sets the directory used by merge join for temporary
files and by option <code class="inline">{cache, list}</code>. The option also overrides option <code class="inline">tmpdir</code>
of <a href="#keysort/3"><code class="inline">keysort/3</code></a> and <a href="#sort/2"><code class="inline">sort/2</code></a>. Defaults to <code class="inline">&quot;&quot;</code>, which means that the directory
returned by <code class="inline">file:get_cwd()</code> is used.</li><li><code class="inline">{unique_all, true}</code> adds a <code class="inline">{unique, true}</code> option to every list expression
of the query. Defaults to <code class="inline">{unique_all, false}</code>. Option <code class="inline">unique_all</code> is
equivalent to <code class="inline">{unique_all, true}</code>.</li></ul><p><a href="" id="getting_started"></a></p><h2 id="module-getting-started" class="section-heading"><a href="#module-getting-started" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Getting Started</span></h2><p>As mentioned earlier, queries are expressed in the list comprehension syntax as
described in section <a href="../../system/expressions.html">Expressions</a> in Erlang
Reference Manual. In the following, some familiarity with list comprehensions is
assumed. The examples in section
<a href="../../system/list_comprehensions.html">List Comprehensions</a> in Programming Examples
can get you started. Notice that list comprehensions do not add any
computational power to the language; anything that can be done with list
comprehensions can also be done without them. But they add syntax for expressing
simple search problems, which is compact and clear once you get used to it.</p><p>Many list comprehension expressions can be evaluated by the <code class="inline">qlc</code> module.
Exceptions are expressions, such that variables introduced in patterns (or
filters) are used in some generator later in the list comprehension. As an
example, consider an implementation of <code class="inline">lists:append(L)</code>:
<code class="inline">[X ||Y &lt;- L, X &lt;- Y]</code>. <code class="inline">Y</code> is introduced in the first generator and used in the
second. The ordinary list comprehension is normally to be preferred when there
is a choice as to which to use. One difference is that <a href="#eval/1"><code class="inline">eval/1,2</code></a>
collects answers in a list that is finally reversed, while list comprehensions
collect answers on the stack that is finally unwound.</p><p>What the <code class="inline">qlc</code> module primarily adds to list comprehensions is that data can be
read from QLC tables in small chunks. A QLC table is created by calling
<a href="#table/2"><code class="inline">qlc:table/2</code></a>. Usually <a href="#table/2"><code class="inline">qlc:table/2</code></a> is not called directly from
the query but through an interface function of some data structure. Erlang/OTP
includes a few examples of such functions:
<a href="../../apps/mnesia/mnesia.html#table/1"><code class="inline">mnesia:table/1,2</code></a>, <a href="ets.html#table/1"><code class="inline">ets:table/1,2</code></a>, and
<a href="dets.html#table/1"><code class="inline">dets:table/1,2</code></a>. For a given data structure, many functions
can create QLC tables, but common for these functions is that they return a
query handle created by <a href="#table/2"><code class="inline">qlc:table/2</code></a>. Using the QLC tables
provided by Erlang/OTP is usually probably sufficient, but for the more advanced
user section <a href="qlc.html#implementing_a_qlc_table">Implementing a QLC Table</a>
describes the implementation of a function calling <a href="#table/2"><code class="inline">qlc:table/2</code></a>.</p><p>Besides <a href="#table/2"><code class="inline">qlc:table/2</code></a>, other functions return query handles. They are used more
seldom than tables, but are sometimes useful. <a href="#append/1"><code class="inline">qlc:append/1,2</code></a>
traverses objects from many tables or lists after each other. If, for example,
you want to traverse all answers to a query <code class="inline">QH</code> and then finish off by a term
<code class="inline">{finished}</code>, you can do that by calling <code class="inline">qlc:append(QH, [{finished}])</code>.
<a href="#append/2"><code class="inline">append/2</code></a> first returns all objects of <code class="inline">QH</code>, then <code class="inline">{finished}</code>.
If a tuple <code class="inline">{finished}</code> exists among the answers to <code class="inline">QH</code>, it is returned twice
from <a href="#append/2"><code class="inline">append/2</code></a>.</p><p>As another example, consider concatenating the answers to two queries <code class="inline">QH1</code> and
<code class="inline">QH2</code> while removing all duplicates. This is accomplished by using option
<code class="inline">unique</code>:</p><pre><code class="makeup erlang" translate="no"><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="2199791073-1">(</span><span class="p" data-group-id="2199791073-2">[</span><span class="n">X</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">append</span><span class="p" data-group-id="2199791073-3">(</span><span class="n">QH1</span><span class="p">,</span><span class="w"> </span><span class="n">QH2</span><span class="p" data-group-id="2199791073-3">)</span><span class="p" data-group-id="2199791073-2">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2199791073-4">{</span><span class="ss">unique</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="2199791073-4">}</span><span class="p" data-group-id="2199791073-1">)</span></code></pre><p>The cost is substantial: every returned answer is stored in an ETS table. Before
returning an answer, it is looked up in the ETS table to check if it has already
been returned. Without the <code class="inline">unique</code> option, all answers to <code class="inline">QH1</code> would be
returned followed by all answers to <code class="inline">QH2</code>. The <code class="inline">unique</code> option keeps the order
between the remaining answers.</p><p>If the order of the answers is not important, there is an alternative to the
<code class="inline">unique</code> option, namely to sort the answers uniquely:</p><pre><code class="makeup erlang" translate="no"><span class="nc">qlc</span><span class="p">:</span><span class="nf">sort</span><span class="p" data-group-id="0150215492-1">(</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="0150215492-2">(</span><span class="p" data-group-id="0150215492-3">[</span><span class="n">X</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">append</span><span class="p" data-group-id="0150215492-4">(</span><span class="n">QH1</span><span class="p">,</span><span class="w"> </span><span class="n">QH2</span><span class="p" data-group-id="0150215492-4">)</span><span class="p" data-group-id="0150215492-3">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0150215492-5">{</span><span class="ss">unique</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="0150215492-5">}</span><span class="p" data-group-id="0150215492-2">)</span><span class="p" data-group-id="0150215492-1">)</span><span class="p">.</span></code></pre><p>This query also removes duplicates but the answers are sorted. If there are many
answers, temporary files are used. Notice that to get the first unique answer,
all answers must be found and sorted. Both alternatives find duplicates by
comparing answers, that is, if <code class="inline">A1</code> and <code class="inline">A2</code> are answers found in that order,
then <code class="inline">A2</code> is a removed if <code class="inline">A1 == A2</code>.</p><p>To return only a few answers, cursors can be used. The following code returns no
more than five answers using an ETS table for storing the unique answers:</p><pre><code class="makeup erlang" translate="no"><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">cursor</span><span class="p" data-group-id="7839935265-1">(</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="7839935265-2">(</span><span class="p" data-group-id="7839935265-3">[</span><span class="n">X</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">append</span><span class="p" data-group-id="7839935265-4">(</span><span class="n">QH1</span><span class="p">,</span><span class="w"> </span><span class="n">QH2</span><span class="p" data-group-id="7839935265-4">)</span><span class="p" data-group-id="7839935265-3">]</span><span class="p">,</span><span class="p" data-group-id="7839935265-5">{</span><span class="ss">unique</span><span class="p">,</span><span class="ss">true</span><span class="p" data-group-id="7839935265-5">}</span><span class="p" data-group-id="7839935265-2">)</span><span class="p" data-group-id="7839935265-1">)</span><span class="p">,</span><span class="w">
</span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">next_answers</span><span class="p" data-group-id="7839935265-6">(</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p" data-group-id="7839935265-6">)</span><span class="p">,</span><span class="w">
</span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">delete_cursor</span><span class="p" data-group-id="7839935265-7">(</span><span class="n">C</span><span class="p" data-group-id="7839935265-7">)</span><span class="p">,</span><span class="w">
</span><span class="n">R</span><span class="p">.</span></code></pre><p>QLCs are convenient for stating constraints on data from two or more tables. The
following example does a natural join on two query handles on position 2:</p><pre><code class="makeup erlang" translate="no"><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="1296147021-1">(</span><span class="p" data-group-id="1296147021-2">[</span><span class="p" data-group-id="1296147021-3">{</span><span class="n">X1</span><span class="p">,</span><span class="n">X2</span><span class="p">,</span><span class="n">X3</span><span class="p">,</span><span class="n">Y1</span><span class="p" data-group-id="1296147021-3">}</span><span class="w"> </span><span class="p">||</span><span class="w">
          </span><span class="p" data-group-id="1296147021-4">{</span><span class="n">X1</span><span class="p">,</span><span class="n">X2</span><span class="p">,</span><span class="n">X3</span><span class="p" data-group-id="1296147021-4">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">QH1</span><span class="p">,</span><span class="w">
          </span><span class="p" data-group-id="1296147021-5">{</span><span class="n">Y1</span><span class="p">,</span><span class="n">Y2</span><span class="p" data-group-id="1296147021-5">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">QH2</span><span class="p">,</span><span class="w">
          </span><span class="n">X2</span><span class="w"> </span><span class="o">=:=</span><span class="w"> </span><span class="n">Y2</span><span class="p" data-group-id="1296147021-2">]</span><span class="p" data-group-id="1296147021-1">)</span></code></pre><p>The <code class="inline">qlc</code> module evaluates this differently depending on the query handles <code class="inline">QH1</code>
and <code class="inline">QH2</code>. If, for example, <code class="inline">X2</code> is matched against the key of a QLC table, the
lookup join method traverses the objects of <code class="inline">QH2</code> while looking up key values in
the table. However, if not <code class="inline">X2</code> or <code class="inline">Y2</code> is matched against the key or an indexed
position of a QLC table, the merge join method ensures that <code class="inline">QH1</code> and <code class="inline">QH2</code> are
both sorted on position 2 and next do the join by traversing the objects one by
one.</p><p>Option <code class="inline">join</code> can be used to force the <code class="inline">qlc</code> module to use a certain join
method. For the rest of this section it is assumed that the excessively slow
join method called &quot;nested loop&quot; has been chosen:</p><pre><code class="makeup erlang" translate="no"><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="4676742388-1">(</span><span class="p" data-group-id="4676742388-2">[</span><span class="p" data-group-id="4676742388-3">{</span><span class="n">X1</span><span class="p">,</span><span class="n">X2</span><span class="p">,</span><span class="n">X3</span><span class="p">,</span><span class="n">Y1</span><span class="p" data-group-id="4676742388-3">}</span><span class="w"> </span><span class="p">||</span><span class="w">
          </span><span class="p" data-group-id="4676742388-4">{</span><span class="n">X1</span><span class="p">,</span><span class="n">X2</span><span class="p">,</span><span class="n">X3</span><span class="p" data-group-id="4676742388-4">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">QH1</span><span class="p">,</span><span class="w">
          </span><span class="p" data-group-id="4676742388-5">{</span><span class="n">Y1</span><span class="p">,</span><span class="n">Y2</span><span class="p" data-group-id="4676742388-5">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">QH2</span><span class="p">,</span><span class="w">
          </span><span class="n">X2</span><span class="w"> </span><span class="o">=:=</span><span class="w"> </span><span class="n">Y2</span><span class="p" data-group-id="4676742388-2">]</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="4676742388-6">{</span><span class="ss">join</span><span class="p">,</span><span class="w"> </span><span class="ss">nested_loop</span><span class="p" data-group-id="4676742388-6">}</span><span class="p" data-group-id="4676742388-1">)</span></code></pre><p>In this case the filter is applied to every possible pair of answers to <code class="inline">QH1</code>
and <code class="inline">QH2</code>, one at a time. If there are M answers to <code class="inline">QH1</code> and N answers to
<code class="inline">QH2</code>, the filter is run M*N times.</p><p>If <code class="inline">QH2</code> is a call to the function for <a href="gb_trees.html"><code class="inline">gb_trees</code></a>, as defined in section
<a href="qlc.html#implementing_a_qlc_table">Implementing a QLC Table</a>, then
<a href="qlc.html#gb_table"><code class="inline">gb_table:table/1</code> </a>, the iterator for the gb-tree is
initiated for each answer to <code class="inline">QH1</code>. The objects of the gb-tree are then returned
one by one. This is probably the most efficient way of traversing the table in
that case, as it takes minimal computational power to get the following object.
But if <code class="inline">QH2</code> is not a table but a more complicated QLC, it can be more efficient
to use some RAM memory for collecting the answers in a cache, particularly if
there are only a few answers. It must then be assumed that evaluating <code class="inline">QH2</code> has
no side effects so that the meaning of the query does not change if <code class="inline">QH2</code> is
evaluated only once. One way of caching the answers is to evaluate <code class="inline">QH2</code> first
of all and substitute the list of answers for <code class="inline">QH2</code> in the query. Another way is
to use option <code class="inline">cache</code>. It is expressed like this:</p><pre><code class="makeup erlang" translate="no"><span class="n">QH2</span><span class="err">&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="5993913715-1">(</span><span class="p" data-group-id="5993913715-2">[</span><span class="n">X</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">QH2</span><span class="p" data-group-id="5993913715-2">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5993913715-3">{</span><span class="ss">cache</span><span class="p">,</span><span class="w"> </span><span class="ss">ets</span><span class="p" data-group-id="5993913715-3">}</span><span class="p" data-group-id="5993913715-1">)</span></code></pre><p>or only</p><pre><code class="text">QH2' = qlc:q([X || X &lt;- QH2], cache)</code></pre><p>The effect of option <code class="inline">cache</code> is that when generator <code class="inline">QH2'</code> is run the first
time, every answer is stored in an ETS table. When the next answer of <code class="inline">QH1</code> is
tried, answers to <code class="inline">QH2'</code> are copied from the ETS table, which is very fast. As
for option <code class="inline">unique</code> the cost is a possibly substantial amount of RAM memory.</p><p>Option <code class="inline">{cache, list}</code> offers the possibility to store the answers in a list on
the process heap. This has the potential of being faster than ETS tables, as
there is no need to copy answers from the table. However, it can often result in
slower evaluation because of more garbage collections of the process heap and
increased RAM memory consumption because of larger heaps. Another drawback with
cache lists is that if the list size exceeds a limit, a temporary file is used.
Reading the answers from a file is much slower than copying them from an ETS
table. But if the available RAM memory is scarce, setting the
<a href="qlc.html#max_list_size">limit</a> to some low value is an alternative.</p><p>Option <code class="inline">cache_all</code> can be set to <code class="inline">ets</code> or <code class="inline">list</code> when evaluating a query. It
adds a <code class="inline">cache</code> or <code class="inline">{cache, list}</code> option to every list expression except QLC
tables and lists on all levels of the query. This can be used for testing if
caching would improve efficiency at all. If the answer is yes, further testing
is needed to pinpoint the generators that are to be cached.</p><p><a href="" id="implementing_a_qlc_table"></a></p><h2 id="module-implementing-a-qlc-table" class="section-heading"><a href="#module-implementing-a-qlc-table" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Implementing a QLC Table</span></h2><p>As an example of how to use function <a href="#table/2"><code class="inline">table/2</code></a>, the implementation of a QLC
table for the <a href="gb_trees.html"><code class="inline">gb_trees</code></a> module is given:</p><p><a href="" id="gb_table"></a></p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7731878420-1">(</span><span class="ss">gb_table</span><span class="p" data-group-id="7731878420-1">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7731878420-2">(</span><span class="p" data-group-id="7731878420-3">[</span><span class="ss">table</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="7731878420-3">]</span><span class="p" data-group-id="7731878420-2">)</span><span class="p">.</span><span class="w">

</span><span class="nf">table</span><span class="p" data-group-id="7731878420-4">(</span><span class="n">T</span><span class="p" data-group-id="7731878420-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">TF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="7731878420-5">(</span><span class="p" data-group-id="7731878420-5">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">qlc_next</span><span class="p" data-group-id="7731878420-6">(</span><span class="nc">gb_trees</span><span class="p">:</span><span class="nf">next</span><span class="p" data-group-id="7731878420-7">(</span><span class="nc">gb_trees</span><span class="p">:</span><span class="nf">iterator</span><span class="p" data-group-id="7731878420-8">(</span><span class="n">T</span><span class="p" data-group-id="7731878420-8">)</span><span class="p" data-group-id="7731878420-7">)</span><span class="p" data-group-id="7731878420-6">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="n">InfoFun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="7731878420-9">(</span><span class="ss">num_of_objects</span><span class="p" data-group-id="7731878420-9">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gb_trees</span><span class="p">:</span><span class="nf">size</span><span class="p" data-group-id="7731878420-10">(</span><span class="n">T</span><span class="p" data-group-id="7731878420-10">)</span><span class="p">;</span><span class="w">
                 </span><span class="p" data-group-id="7731878420-11">(</span><span class="ss">keypos</span><span class="p" data-group-id="7731878420-11">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
                 </span><span class="p" data-group-id="7731878420-12">(</span><span class="ss">is_sorted_key</span><span class="p" data-group-id="7731878420-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
                 </span><span class="p" data-group-id="7731878420-13">(</span><span class="ss">is_unique_objects</span><span class="p" data-group-id="7731878420-13">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
                 </span><span class="p" data-group-id="7731878420-14">(</span><span class="p">_</span><span class="p" data-group-id="7731878420-14">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">undefined</span><span class="w">
              </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="n">LookupFun</span><span class="w"> </span><span class="o">=</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7731878420-15">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Ks</span><span class="p" data-group-id="7731878420-15">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatmap</span><span class="p" data-group-id="7731878420-16">(</span><span class="nf">fun</span><span class="p" data-group-id="7731878420-17">(</span><span class="n">K</span><span class="p" data-group-id="7731878420-17">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                                      </span><span class="k">case</span><span class="w"> </span><span class="nc">gb_trees</span><span class="p">:</span><span class="nf">lookup</span><span class="p" data-group-id="7731878420-18">(</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7731878420-18">)</span><span class="w"> </span><span class="k">of</span><span class="w">
                                          </span><span class="p" data-group-id="7731878420-19">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p" data-group-id="7731878420-19">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="7731878420-20">[</span><span class="p" data-group-id="7731878420-21">{</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="p" data-group-id="7731878420-21">}</span><span class="p" data-group-id="7731878420-20">]</span><span class="p">;</span><span class="w">
                                          </span><span class="ss">none</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="7731878420-22">[</span><span class="p" data-group-id="7731878420-22">]</span><span class="w">
                                      </span><span class="k">end</span><span class="w">
                              </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Ks</span><span class="p" data-group-id="7731878420-16">)</span><span class="w">
        </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="n">FormatFun</span><span class="w"> </span><span class="o">=</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7731878420-23">(</span><span class="p" data-group-id="7731878420-24">{</span><span class="ss">all</span><span class="p">,</span><span class="w"> </span><span class="n">NElements</span><span class="p">,</span><span class="w"> </span><span class="n">ElementFun</span><span class="p" data-group-id="7731878420-24">}</span><span class="p" data-group-id="7731878420-23">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">ValsS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7731878420-25">(</span><span class="s">&quot;gb_trees:from_orddict(</span><span class="si">~w</span><span class="s">)&quot;</span><span class="p">,</span><span class="w">
                                      </span><span class="p" data-group-id="7731878420-26">[</span><span class="nf">gb_nodes</span><span class="p" data-group-id="7731878420-27">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">NElements</span><span class="p">,</span><span class="w"> </span><span class="n">ElementFun</span><span class="p" data-group-id="7731878420-27">)</span><span class="p" data-group-id="7731878420-26">]</span><span class="p" data-group-id="7731878420-25">)</span><span class="p">,</span><span class="w">
                </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7731878420-28">(</span><span class="s">&quot;gb_table:table(</span><span class="si">~s</span><span class="s">)&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7731878420-29">[</span><span class="n">ValsS</span><span class="p" data-group-id="7731878420-29">]</span><span class="p" data-group-id="7731878420-28">)</span><span class="p">;</span><span class="w">
           </span><span class="p" data-group-id="7731878420-30">(</span><span class="p" data-group-id="7731878420-31">{</span><span class="ss">lookup</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">KeyValues</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">NElements</span><span class="p">,</span><span class="w"> </span><span class="n">ElementFun</span><span class="p" data-group-id="7731878420-31">}</span><span class="p" data-group-id="7731878420-30">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">ValsS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7731878420-32">(</span><span class="s">&quot;gb_trees:from_orddict(</span><span class="si">~w</span><span class="s">)&quot;</span><span class="p">,</span><span class="w">
                                      </span><span class="p" data-group-id="7731878420-33">[</span><span class="nf">gb_nodes</span><span class="p" data-group-id="7731878420-34">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p">,</span><span class="w"> </span><span class="n">ElementFun</span><span class="p" data-group-id="7731878420-34">)</span><span class="p" data-group-id="7731878420-33">]</span><span class="p" data-group-id="7731878420-32">)</span><span class="p">,</span><span class="w">
                </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7731878420-35">(</span><span class="s">&quot;lists:flatmap(fun(K) -&gt; &quot;</span><span class="w">
                              </span><span class="s">&quot;case gb_trees:lookup(K, </span><span class="si">~s</span><span class="s">) of &quot;</span><span class="w">
                              </span><span class="s">&quot;{value, V} -&gt; [{K,V}];none -&gt; [] end &quot;</span><span class="w">
                              </span><span class="s">&quot;end, </span><span class="si">~w</span><span class="s">)&quot;</span><span class="p">,</span><span class="w">
                              </span><span class="p" data-group-id="7731878420-36">[</span><span class="n">ValsS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7731878420-37">[</span><span class="n">ElementFun</span><span class="p" data-group-id="7731878420-38">(</span><span class="n">KV</span><span class="p" data-group-id="7731878420-38">)</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">KV</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">KeyValues</span><span class="p" data-group-id="7731878420-37">]</span><span class="p" data-group-id="7731878420-36">]</span><span class="p" data-group-id="7731878420-35">)</span><span class="w">
        </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">table</span><span class="p" data-group-id="7731878420-39">(</span><span class="n">TF</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7731878420-40">[</span><span class="p" data-group-id="7731878420-41">{</span><span class="ss">info_fun</span><span class="p">,</span><span class="w"> </span><span class="n">InfoFun</span><span class="p" data-group-id="7731878420-41">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7731878420-42">{</span><span class="ss">format_fun</span><span class="p">,</span><span class="w"> </span><span class="n">FormatFun</span><span class="p" data-group-id="7731878420-42">}</span><span class="p">,</span><span class="w">
                   </span><span class="p" data-group-id="7731878420-43">{</span><span class="ss">lookup_fun</span><span class="p">,</span><span class="w"> </span><span class="n">LookupFun</span><span class="p" data-group-id="7731878420-43">}</span><span class="p">,</span><span class="p" data-group-id="7731878420-44">{</span><span class="ss">key_equality</span><span class="p">,</span><span class="ss">&#39;==&#39;</span><span class="p" data-group-id="7731878420-44">}</span><span class="p" data-group-id="7731878420-40">]</span><span class="p" data-group-id="7731878420-39">)</span><span class="p">.</span><span class="w">

</span><span class="nf">qlc_next</span><span class="p" data-group-id="7731878420-45">(</span><span class="p" data-group-id="7731878420-46">{</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="p" data-group-id="7731878420-46">}</span><span class="p" data-group-id="7731878420-45">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7731878420-47">[</span><span class="p" data-group-id="7731878420-48">{</span><span class="n">X</span><span class="p">,</span><span class="n">V</span><span class="p" data-group-id="7731878420-48">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="7731878420-49">(</span><span class="p" data-group-id="7731878420-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">qlc_next</span><span class="p" data-group-id="7731878420-50">(</span><span class="nc">gb_trees</span><span class="p">:</span><span class="nf">next</span><span class="p" data-group-id="7731878420-51">(</span><span class="n">S</span><span class="p" data-group-id="7731878420-51">)</span><span class="p" data-group-id="7731878420-50">)</span><span class="w"> </span><span class="k">end</span><span class="p" data-group-id="7731878420-47">]</span><span class="p">;</span><span class="w">
</span><span class="nf">qlc_next</span><span class="p" data-group-id="7731878420-52">(</span><span class="ss">none</span><span class="p" data-group-id="7731878420-52">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7731878420-53">[</span><span class="p" data-group-id="7731878420-53">]</span><span class="p">.</span><span class="w">

</span><span class="nf">gb_nodes</span><span class="p" data-group-id="7731878420-54">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p">,</span><span class="w"> </span><span class="n">ElementFun</span><span class="p" data-group-id="7731878420-54">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">gb_nodes</span><span class="p" data-group-id="7731878420-55">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ElementFun</span><span class="p" data-group-id="7731878420-55">)</span><span class="p">;</span><span class="w">
</span><span class="nf">gb_nodes</span><span class="p" data-group-id="7731878420-56">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">NElements</span><span class="p">,</span><span class="w"> </span><span class="n">ElementFun</span><span class="p" data-group-id="7731878420-56">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">gb_iter</span><span class="p" data-group-id="7731878420-57">(</span><span class="nc">gb_trees</span><span class="p">:</span><span class="nf">iterator</span><span class="p" data-group-id="7731878420-58">(</span><span class="n">T</span><span class="p" data-group-id="7731878420-58">)</span><span class="p">,</span><span class="w"> </span><span class="n">NElements</span><span class="p">,</span><span class="w"> </span><span class="n">ElementFun</span><span class="p" data-group-id="7731878420-57">)</span><span class="p">.</span><span class="w">

</span><span class="nf">gb_iter</span><span class="p" data-group-id="7731878420-59">(</span><span class="p">_</span><span class="n">I</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">EFun</span><span class="p" data-group-id="7731878420-59">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="ss">&#39;...&#39;</span><span class="p">;</span><span class="w">
</span><span class="nf">gb_iter</span><span class="p" data-group-id="7731878420-60">(</span><span class="n">I0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">EFun</span><span class="p" data-group-id="7731878420-60">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="nc">gb_trees</span><span class="p">:</span><span class="nf">next</span><span class="p" data-group-id="7731878420-61">(</span><span class="n">I0</span><span class="p" data-group-id="7731878420-61">)</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="p" data-group-id="7731878420-62">{</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">,</span><span class="w"> </span><span class="n">I</span><span class="p" data-group-id="7731878420-62">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="p" data-group-id="7731878420-63">[</span><span class="n">EFun</span><span class="p" data-group-id="7731878420-64">(</span><span class="p" data-group-id="7731878420-65">{</span><span class="n">X</span><span class="p">,</span><span class="n">V</span><span class="p" data-group-id="7731878420-65">}</span><span class="p" data-group-id="7731878420-64">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">gb_iter</span><span class="p" data-group-id="7731878420-66">(</span><span class="n">I</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">EFun</span><span class="p" data-group-id="7731878420-66">)</span><span class="p" data-group-id="7731878420-63">]</span><span class="p">;</span><span class="w">
        </span><span class="ss">none</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="p" data-group-id="7731878420-67">[</span><span class="p" data-group-id="7731878420-67">]</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span></code></pre><p><code class="inline">TF</code> is the traversal function. The <code class="inline">qlc</code> module requires that there is a way of
traversing all objects of the data structure. <code class="inline">gb_trees</code> has an iterator
function suitable for that purpose. Notice that for each object returned, a new
fun is created. As long as the list is not terminated by <code class="inline">[]</code>, it is assumed
that the tail of the list is a nullary function and that calling the function
returns further objects (and functions).</p><p>The lookup function is optional. It is assumed that the lookup function always
finds values much faster than it would take to traverse the table. The first
argument is the position of the key. As <code class="inline">qlc_next/1</code> returns the objects as
<code class="inline">{Key, Value}</code> pairs, the position is 1. Notice that the lookup function is to
return <code class="inline">{Key, Value}</code> pairs, as the traversal function does.</p><p>The format function is also optional. It is called by <a href="#info/1"><code class="inline">info/1,2</code></a> to
give feedback at runtime of how the query is to be evaluated. Try to give as
good feedback as possible without showing too much details. In the example, at
most seven objects of the table are shown. The format function handles two
cases: <code class="inline">all</code> means that all objects of the table are traversed;
<code class="inline">{lookup, 1, KeyValues}</code> means that the lookup function is used for looking up
key values.</p><p>Whether the whole table is traversed or only some keys looked up depends on how
the query is expressed. If the query has the form</p><pre><code class="text">qlc:q([T || P &lt;- LE, F])</code></pre><p>and <code class="inline">P</code> is a tuple, the <code class="inline">qlc</code> module analyzes <code class="inline">P</code> and <code class="inline">F</code> in compile time to
find positions of tuple <code class="inline">P</code> that are tested for equality to constants. If such a
position at runtime turns out to be the key position, the lookup function can be
used, otherwise all objects of the table must be traversed. The info function
<code class="inline">InfoFun</code> returns the key position. There can be indexed positions as well, also
returned by the info function. An index is an extra table that makes lookup on
some position fast. Mnesia maintains indexes upon request, and introduces so
called secondary keys. The <code class="inline">qlc</code> module prefers to look up objects using the key
before secondary keys regardless of the number of constants to look up.</p><h2 id="module-key-equality" class="section-heading"><a href="#module-key-equality" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Key Equality</span></h2><p>Erlang/OTP has two operators for testing term equality: <code class="inline">==/2</code> and <code class="inline">=:=/2</code>. The
difference is all about the integers that can be represented by floats. For
example, <code class="inline">2 == 2.0</code> evaluates to <code class="inline">true</code> while <code class="inline">2 =:= 2.0</code> evaluates to <code class="inline">false</code>.
Normally this is a minor issue, but the <code class="inline">qlc</code> module cannot ignore the
difference, which affects the user's choice of operators in QLCs.</p><p>If the <code class="inline">qlc</code> module at compile time can determine that some constant is free of
integers, it does not matter which one of <code class="inline">==/2</code> or <code class="inline">=:=/2</code> is used:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="n">E1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">new</span><span class="p" data-group-id="1112059528-1">(</span><span class="ss">t</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1112059528-2">[</span><span class="ss">set</span><span class="p" data-group-id="1112059528-2">]</span><span class="p" data-group-id="1112059528-1">)</span><span class="p">,</span><span class="w"> </span><span class="c1">% uses =:=/2 for key equality</span><span class="w">
</span><span class="n">Q1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="1112059528-3">(</span><span class="p" data-group-id="1112059528-4">[</span><span class="n">K</span><span class="w"> </span><span class="p">||</span><span class="w">
</span><span class="p" data-group-id="1112059528-5">{</span><span class="n">K</span><span class="p" data-group-id="1112059528-5">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">table</span><span class="p" data-group-id="1112059528-6">(</span><span class="n">E1</span><span class="p" data-group-id="1112059528-6">)</span><span class="p">,</span><span class="w">
</span><span class="n">K</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">2.71</span><span class="w"> </span><span class="ow">orelse</span><span class="w"> </span><span class="n">K</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">a</span><span class="p" data-group-id="1112059528-4">]</span><span class="p" data-group-id="1112059528-3">)</span><span class="p">,</span><span class="w">
</span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1112059528-7">(</span><span class="s">&quot;</span><span class="si">~s</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1112059528-8">[</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">info</span><span class="p" data-group-id="1112059528-9">(</span><span class="n">Q1</span><span class="p" data-group-id="1112059528-9">)</span><span class="p" data-group-id="1112059528-8">]</span><span class="p" data-group-id="1112059528-7">)</span><span class="p">.</span><span class="w">
</span><span class="nc">ets</span><span class="p">:</span><span class="nf">match_spec_run</span><span class="p" data-group-id="1112059528-10">(</span><span class="w">
       </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatmap</span><span class="p" data-group-id="1112059528-11">(</span><span class="nf">fun</span><span class="p" data-group-id="1112059528-12">(</span><span class="n">V</span><span class="p" data-group-id="1112059528-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
			    </span><span class="nc">ets</span><span class="p">:</span><span class="nf">lookup</span><span class="p" data-group-id="1112059528-13">(</span><span class="p">#</span><span class="n">Ref</span><span class="o">&lt;</span><span class="mf">0.3098908599</span><span class="p">.</span><span class="mf">2283929601.256025</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
				       </span><span class="n">V</span><span class="p" data-group-id="1112059528-13">)</span><span class="w">
		     </span><span class="k">end</span><span class="p">,</span><span class="w">
		     </span><span class="p" data-group-id="1112059528-14">[</span><span class="ss">a</span><span class="p">,</span><span class="w"> </span><span class="mf">2.71</span><span class="p" data-group-id="1112059528-14">]</span><span class="p" data-group-id="1112059528-11">)</span><span class="p">,</span><span class="w">
       </span><span class="nc">ets</span><span class="p">:</span><span class="nf">match_spec_compile</span><span class="p" data-group-id="1112059528-15">(</span><span class="p" data-group-id="1112059528-16">[</span><span class="p" data-group-id="1112059528-17">{</span><span class="p" data-group-id="1112059528-18">{</span><span class="ss">&#39;$1&#39;</span><span class="p" data-group-id="1112059528-18">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1112059528-19">[</span><span class="p" data-group-id="1112059528-19">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1112059528-20">[</span><span class="ss">&#39;$1&#39;</span><span class="p" data-group-id="1112059528-20">]</span><span class="p" data-group-id="1112059528-17">}</span><span class="p" data-group-id="1112059528-16">]</span><span class="p" data-group-id="1112059528-15">)</span><span class="p" data-group-id="1112059528-10">)</span></code></pre><p>In the example, operator <code class="inline">==/2</code> has been handled exactly as <code class="inline">=:=/2</code> would have
been handled. However, if it cannot be determined at compile time that some
constant is free of integers, and the table uses <code class="inline">=:=/2</code> when comparing keys for
equality (see option <a href="qlc.html#key_equality">key_equality</a>), then the <code class="inline">qlc</code>
module does not try to look up the constant. The reason is that there is in the
general case no upper limit on the number of key values that can compare equal
to such a constant; every combination of integers and floats must be looked up:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">2&gt; </span><span class="n">E2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">new</span><span class="p" data-group-id="1583759398-1">(</span><span class="ss">t</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1583759398-2">[</span><span class="ss">set</span><span class="p" data-group-id="1583759398-2">]</span><span class="p" data-group-id="1583759398-1">)</span><span class="p">,</span><span class="w">
</span><span class="ss">true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">insert</span><span class="p" data-group-id="1583759398-3">(</span><span class="n">E2</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1583759398-4">[</span><span class="p" data-group-id="1583759398-5">{</span><span class="p" data-group-id="1583759398-6">{</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="1583759398-6">}</span><span class="p">,</span><span class="ss">a</span><span class="p" data-group-id="1583759398-5">}</span><span class="p">,</span><span class="p" data-group-id="1583759398-7">{</span><span class="p" data-group-id="1583759398-8">{</span><span class="mi">2</span><span class="p">,</span><span class="mf">2.0</span><span class="p" data-group-id="1583759398-8">}</span><span class="p">,</span><span class="ss">b</span><span class="p" data-group-id="1583759398-7">}</span><span class="p">,</span><span class="p" data-group-id="1583759398-9">{</span><span class="p" data-group-id="1583759398-10">{</span><span class="mf">2.0</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="1583759398-10">}</span><span class="p">,</span><span class="ss">c</span><span class="p" data-group-id="1583759398-9">}</span><span class="p" data-group-id="1583759398-4">]</span><span class="p" data-group-id="1583759398-3">)</span><span class="p">,</span><span class="w">
</span><span class="n">F2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="1583759398-11">(</span><span class="n">I</span><span class="p" data-group-id="1583759398-11">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="1583759398-12">(</span><span class="p" data-group-id="1583759398-13">[</span><span class="n">V</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="p" data-group-id="1583759398-14">{</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="p" data-group-id="1583759398-14">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">table</span><span class="p" data-group-id="1583759398-15">(</span><span class="n">E2</span><span class="p" data-group-id="1583759398-15">)</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">I</span><span class="p" data-group-id="1583759398-13">]</span><span class="p" data-group-id="1583759398-12">)</span><span class="w">
</span><span class="k">end</span><span class="p">,</span><span class="w">
</span><span class="n">Q2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F2</span><span class="p" data-group-id="1583759398-16">(</span><span class="p" data-group-id="1583759398-17">{</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="1583759398-17">}</span><span class="p" data-group-id="1583759398-16">)</span><span class="p">,</span><span class="w">
</span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1583759398-18">(</span><span class="s">&quot;</span><span class="si">~s</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1583759398-19">[</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">info</span><span class="p" data-group-id="1583759398-20">(</span><span class="n">Q2</span><span class="p" data-group-id="1583759398-20">)</span><span class="p" data-group-id="1583759398-19">]</span><span class="p" data-group-id="1583759398-18">)</span><span class="p">.</span><span class="w">
</span><span class="nc">ets</span><span class="p">:</span><span class="nf">table</span><span class="p" data-group-id="1583759398-21">(</span><span class="p">#</span><span class="n">Ref</span><span class="o">&lt;</span><span class="mf">0.3098908599</span><span class="p">.</span><span class="mf">2283929601.256125</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
          </span><span class="p" data-group-id="1583759398-22">[</span><span class="p" data-group-id="1583759398-23">{</span><span class="ss">traverse</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1583759398-24">{</span><span class="ss">select</span><span class="p">,</span><span class="w">
             </span><span class="p" data-group-id="1583759398-25">[</span><span class="p" data-group-id="1583759398-26">{</span><span class="p" data-group-id="1583759398-27">{</span><span class="ss">&#39;$1&#39;</span><span class="p">,</span><span class="w"> </span><span class="ss">&#39;$2&#39;</span><span class="p" data-group-id="1583759398-27">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1583759398-28">[</span><span class="p" data-group-id="1583759398-29">{</span><span class="ss">&#39;==&#39;</span><span class="p">,</span><span class="w"> </span><span class="ss">&#39;$1&#39;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1583759398-30">{</span><span class="ss">const</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1583759398-31">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1583759398-31">}</span><span class="p" data-group-id="1583759398-30">}</span><span class="p" data-group-id="1583759398-29">}</span><span class="p" data-group-id="1583759398-28">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1583759398-32">[</span><span class="ss">&#39;$2&#39;</span><span class="p" data-group-id="1583759398-32">]</span><span class="p" data-group-id="1583759398-26">}</span><span class="p" data-group-id="1583759398-25">]</span><span class="p" data-group-id="1583759398-24">}</span><span class="p" data-group-id="1583759398-23">}</span><span class="p" data-group-id="1583759398-22">]</span><span class="p" data-group-id="1583759398-21">)</span><span class="gp unselectable">
3&gt; </span><span class="nc">lists</span><span class="p">:</span><span class="nf">sort</span><span class="p" data-group-id="1583759398-33">(</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">e</span><span class="p" data-group-id="1583759398-34">(</span><span class="n">Q2</span><span class="p" data-group-id="1583759398-34">)</span><span class="p" data-group-id="1583759398-33">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="1583759398-35">[</span><span class="ss">a</span><span class="p">,</span><span class="ss">b</span><span class="p">,</span><span class="ss">c</span><span class="p" data-group-id="1583759398-35">]</span></code></pre><p>Looking up only <code class="inline">{2,2}</code> would not return <code class="inline">b</code> and <code class="inline">c</code>.</p><p>If the table uses <code class="inline">==/2</code> when comparing keys for equality, the <code class="inline">qlc</code> module
looks up the constant regardless of which operator is used in the QLC. However,
<code class="inline">==/2</code> is to be preferred:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">4&gt; </span><span class="n">E3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">new</span><span class="p" data-group-id="0985769177-1">(</span><span class="ss">t</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0985769177-2">[</span><span class="ss">ordered_set</span><span class="p" data-group-id="0985769177-2">]</span><span class="p" data-group-id="0985769177-1">)</span><span class="p">,</span><span class="w"> </span><span class="c1">% uses ==/2 for key equality</span><span class="w">
</span><span class="ss">true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">insert</span><span class="p" data-group-id="0985769177-3">(</span><span class="n">E3</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0985769177-4">[</span><span class="p" data-group-id="0985769177-5">{</span><span class="p" data-group-id="0985769177-6">{</span><span class="mi">2</span><span class="p">,</span><span class="mf">2.0</span><span class="p" data-group-id="0985769177-6">}</span><span class="p">,</span><span class="ss">b</span><span class="p" data-group-id="0985769177-5">}</span><span class="p" data-group-id="0985769177-4">]</span><span class="p" data-group-id="0985769177-3">)</span><span class="p">,</span><span class="w">
</span><span class="n">F3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="0985769177-7">(</span><span class="n">I</span><span class="p" data-group-id="0985769177-7">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="0985769177-8">(</span><span class="p" data-group-id="0985769177-9">[</span><span class="n">V</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="p" data-group-id="0985769177-10">{</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="p" data-group-id="0985769177-10">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">table</span><span class="p" data-group-id="0985769177-11">(</span><span class="n">E3</span><span class="p" data-group-id="0985769177-11">)</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">I</span><span class="p" data-group-id="0985769177-9">]</span><span class="p" data-group-id="0985769177-8">)</span><span class="w">
</span><span class="k">end</span><span class="p">,</span><span class="w">
</span><span class="n">Q3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F3</span><span class="p" data-group-id="0985769177-12">(</span><span class="p" data-group-id="0985769177-13">{</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="0985769177-13">}</span><span class="p" data-group-id="0985769177-12">)</span><span class="p">,</span><span class="w">
</span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0985769177-14">(</span><span class="s">&quot;</span><span class="si">~s</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0985769177-15">[</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">info</span><span class="p" data-group-id="0985769177-16">(</span><span class="n">Q3</span><span class="p" data-group-id="0985769177-16">)</span><span class="p" data-group-id="0985769177-15">]</span><span class="p" data-group-id="0985769177-14">)</span><span class="p">.</span><span class="w">
</span><span class="nc">ets</span><span class="p">:</span><span class="nf">match_spec_run</span><span class="p" data-group-id="0985769177-17">(</span><span class="nc">ets</span><span class="p">:</span><span class="nf">lookup</span><span class="p" data-group-id="0985769177-18">(</span><span class="p">#</span><span class="n">Ref</span><span class="o">&lt;</span><span class="mf">0.3098908599</span><span class="p">.</span><span class="mf">2283929601.256211</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
                              </span><span class="p" data-group-id="0985769177-19">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="0985769177-19">}</span><span class="p" data-group-id="0985769177-18">)</span><span class="p">,</span><span class="w">
                   </span><span class="nc">ets</span><span class="p">:</span><span class="nf">match_spec_compile</span><span class="p" data-group-id="0985769177-20">(</span><span class="p" data-group-id="0985769177-21">[</span><span class="p" data-group-id="0985769177-22">{</span><span class="p" data-group-id="0985769177-23">{</span><span class="ss">&#39;$1&#39;</span><span class="p">,</span><span class="w"> </span><span class="ss">&#39;$2&#39;</span><span class="p" data-group-id="0985769177-23">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0985769177-24">[</span><span class="p" data-group-id="0985769177-24">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0985769177-25">[</span><span class="ss">&#39;$2&#39;</span><span class="p" data-group-id="0985769177-25">]</span><span class="p" data-group-id="0985769177-22">}</span><span class="p" data-group-id="0985769177-21">]</span><span class="p" data-group-id="0985769177-20">)</span><span class="p" data-group-id="0985769177-17">)</span><span class="gp unselectable">
5&gt; </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">e</span><span class="p" data-group-id="0985769177-26">(</span><span class="n">Q3</span><span class="p" data-group-id="0985769177-26">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="0985769177-27">[</span><span class="ss">b</span><span class="p" data-group-id="0985769177-27">]</span></code></pre><p>Lookup join is handled analogously to lookup of constants in a table: if the
join operator is <code class="inline">==/2</code>, and the table where constants are to be looked up uses
<code class="inline">=:=/2</code> when testing keys for equality, then the <code class="inline">qlc</code> module does not consider
lookup join for that table.</p><h2 id="module-see-also" class="section-heading"><a href="#module-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See Also</span></h2><p><a href="dets.html"><code class="inline">dets</code></a>, <a href="erl_eval.html"><code class="inline">erl_eval</code></a>, <a href="../../apps/erts/erlang.html"><code class="inline">erlang</code></a>, <a href="../../apps/kernel/error_logger.html"><code class="inline">error_logger</code></a>, <a href="ets.html"><code class="inline">ets</code></a>, <a href="../../apps/kernel/file.html"><code class="inline">file</code></a>,
<a href="file_sorter.html"><code class="inline">file_sorter</code></a>, <a href="../../apps/mnesia/mnesia.html"><code class="inline">mnesia</code></a>, <a href="shell.html"><code class="inline">shell</code></a>,
<a href="../../system/index.html">Erlang Reference Manual</a>,
<a href="../../system/index.html">Programming Examples</a></p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:abstract_expr/0" data-no-tooltip="" translate="no">abstract_expr()</a>

      </div>

        <div class="summary-synopsis"><p>Parse trees for Erlang expression, see section
<a>The Abstract Format</a> in the ERTS User's Guide.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:answer/0" data-no-tooltip="" translate="no">answer()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:answers/0" data-no-tooltip="" translate="no">answers()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:cache/0" data-no-tooltip="" translate="no">cache()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:key_pos/0" data-no-tooltip="" translate="no">key_pos()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:match_expression/0" data-no-tooltip="" translate="no">match_expression()</a>

      </div>

        <div class="summary-synopsis"><p>Match specification, see section
<a>Match Specifications in Erlang</a> in the ERTS User's
Guide and <a><code class="inline">ms_transform</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:max_list_size/0" data-no-tooltip="" translate="no">max_list_size()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:no_files/0" data-no-tooltip="" translate="no">no_files()</a>

      </div>

        <div class="summary-synopsis"><p>An integer &gt; 1.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:order/0" data-no-tooltip="" translate="no">order()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:order_fun/0" data-no-tooltip="" translate="no">order_fun()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:query_cursor/0" data-no-tooltip="" translate="no">query_cursor()</a>

      </div>

        <div class="summary-synopsis"><p>A <a>query cursor</a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:query_handle/0" data-no-tooltip="" translate="no">query_handle()</a>

      </div>

        <div class="summary-synopsis"><p>A <a>query handle</a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:query_handle_or_list/0" data-no-tooltip="" translate="no">query_handle_or_list()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:query_list_comprehension/0" data-no-tooltip="" translate="no">query_list_comprehension()</a>

      </div>

        <div class="summary-synopsis"><p>A literal <a>query list comprehension</a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:sort_option/0" data-no-tooltip="" translate="no">sort_option()</a>

      </div>

        <div class="summary-synopsis"><p>See <a><code class="inline">file_sorter</code></a> for a description of the options.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:sort_options/0" data-no-tooltip="" translate="no">sort_options()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:spawn_options/0" data-no-tooltip="" translate="no">spawn_options()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:tmp_directory/0" data-no-tooltip="" translate="no">tmp_directory()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:tmp_file_usage/0" data-no-tooltip="" translate="no">tmp_file_usage()</a>

      </div>

    </div>

</div>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#append/1" data-no-tooltip="" translate="no">append(QHL)</a>

      </div>

        <div class="summary-synopsis"><p>Returns a query handle. When evaluating query handle <code class="inline">QH</code>, all answers to the
first query handle in <code class="inline">QHL</code> are returned, followed by all answers to the
remaining query handles in <code class="inline">QHL</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#append/2" data-no-tooltip="" translate="no">append(QH1, QH2)</a>

      </div>

        <div class="summary-synopsis"><p>Returns a query handle. When evaluating query handle <code class="inline">QH3</code>, all answers to <code class="inline">QH1</code>
are returned, followed by all answers to <code class="inline">QH2</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#cursor/1" data-no-tooltip="" translate="no">cursor(QH)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">cursor(QH, [])</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#cursor/2" data-no-tooltip="" translate="no">cursor(QH, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Creates a query cursor and makes the calling process the owner of the cursor.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_cursor/1" data-no-tooltip="" translate="no">delete_cursor(QueryCursor)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes a query cursor. Only the owner of the cursor can delete the cursor.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#e/1" data-no-tooltip="" translate="no">e(QH)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">eval(QH, [])</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#e/2" data-no-tooltip="" translate="no">e(QH, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">eval(QH, Options)</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#eval/1" data-no-tooltip="" translate="no">eval(QH)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">eval(QH, [])</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#eval/2" data-no-tooltip="" translate="no">eval(QH, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Evaluates a query handle in the calling process and collects all answers in a
list.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#fold/3" data-no-tooltip="" translate="no">fold(Function, Acc0, QH)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">fold(Function, Acc0, QH, [])</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#fold/4" data-no-tooltip="" translate="no">fold(Function, Acc0, QH, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Calls <code class="inline">Function</code> on successive answers to the query handle together with an
extra argument <code class="inline">AccIn</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#format_error/1" data-no-tooltip="" translate="no">format_error(Error)</a>

      </div>

        <div class="summary-synopsis"><p>Returns a descriptive string in English of an error tuple returned by some of
the functions of the <code class="inline">qlc</code> module or the parse transform. This function is
mainly used by the compiler invoking the parse transform.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#info/1" data-no-tooltip="" translate="no">info(QH)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">info(QH, [])</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#info/2" data-no-tooltip="" translate="no">info(QH, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Returns information about a query handle. The information describes the
simplifications and optimizations that are the results of preparing the query
for evaluation. This function is probably mainly useful during debugging.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#keysort/2" data-no-tooltip="" translate="no">keysort(KeyPos, QH1)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">keysort(KeyPos, QH1, [])</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#keysort/3" data-no-tooltip="" translate="no">keysort(KeyPos, QH1, SortOptions)</a>

      </div>

        <div class="summary-synopsis"><p>Returns a query handle. When evaluating query handle <code class="inline">QH2</code>, the answers to query
handle <code class="inline">QH1</code> are sorted by <a><code class="inline">file_sorter:keysort/4</code></a> according to the options.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#next_answers/1" data-no-tooltip="" translate="no">next_answers(QueryCursor)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">next_answers(C, 10)</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#next_answers/2" data-no-tooltip="" translate="no">next_answers(QueryCursor, NumberOfAnswers)</a>

      </div>

        <div class="summary-synopsis"><p>Returns some or all of the remaining answers to a query cursor. Only the owner
of <code class="inline">QueryCursor</code> can retrieve answers.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#q/1" data-no-tooltip="" translate="no">q(QLC)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">q(QLC, [])</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#q/2" data-no-tooltip="" translate="no">q(QLC, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Returns a query handle for a QLC. The QLC must be the first argument to this
function, otherwise it is evaluated as an ordinary list comprehension. It is
also necessary to add the following line to the source code</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#sort/1" data-no-tooltip="" translate="no">sort(QH1)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">sort(QH, [])</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#sort/2" data-no-tooltip="" translate="no">sort(QH1, SortOptions)</a>

      </div>

        <div class="summary-synopsis"><p>Returns a query handle. When evaluating query handle <code class="inline">QH2</code>, the answers to query
handle <code class="inline">QH1</code> are sorted by <a><code class="inline">file_sorter:sort/3</code></a> according to the options.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#string_to_handle/1" data-no-tooltip="" translate="no">string_to_handle(QueryString)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">string_to_handle(QueryString, [])</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#string_to_handle/2" data-no-tooltip="" translate="no">string_to_handle(QueryString, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">string_to_handle(QueryString, Options, erl_eval:new_bindings())</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#string_to_handle/3" data-no-tooltip="" translate="no">string_to_handle(QueryString, Options, Bindings)</a>

      </div>

        <div class="summary-synopsis"><p>A string version of <a><code class="inline">q/1,2</code></a>. When the query handle is evaluated, the
fun created by the parse transform is interpreted by <a><code class="inline">erl_eval</code></a>. The query
string is to be one single QLC terminated by a period.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#table/2" data-no-tooltip="" translate="no">table(TraverseFun, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Returns a query handle for a QLC table. In Erlang/OTP there is support for ETS,
Dets, and Mnesia tables, but many other data structures can be turned into QLC
tables. This is accomplished by letting function(s) in the module implementing
the data structure create a query handle by calling <a><code class="inline">qlc:table/2</code></a>.</p></div>

    </div>

</div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Types</span>
    </h1>
    <div class="types-list">
<section class="detail" id="t:abstract_expr/0">

  <div class="detail-header">
    <a href="#t:abstract_expr/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">abstract_expr()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L172" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> abstract_expr() :: <a href="erl_parse.html#t:abstract_expr/0">erl_parse:abstract_expr</a>().</pre>

      </div>

<p>Parse trees for Erlang expression, see section
<a href="../../apps/erts/absform.html">The Abstract Format</a> in the ERTS User's Guide.</p>
  </section>
</section>
<section class="detail" id="t:answer/0">

  <div class="detail-header">
    <a href="#t:answer/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">answer()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L167" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> answer() :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:answers/0">

  <div class="detail-header">
    <a href="#t:answers/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">answers()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L166" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> answers() :: [<a href="#t:answer/0">answer</a>()].</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:cache/0">

  <div class="detail-header">
    <a href="#t:cache/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">cache()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L195" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> cache() :: ets | list | no.</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:key_pos/0">

  <div class="detail-header">
    <a href="#t:key_pos/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">key_pos()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L193" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> key_pos() :: <a href="../../apps/erts/erlang.html#t:pos_integer/0">pos_integer</a>() | [<a href="../../apps/erts/erlang.html#t:pos_integer/0">pos_integer</a>()].</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:match_expression/0">

  <div class="detail-header">
    <a href="#t:match_expression/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">match_expression()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L178" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> match_expression() :: <a href="ets.html#t:match_spec/0">ets:match_spec</a>().</pre>

      </div>

<p>Match specification, see section
<a href="../../apps/erts/match_spec.html">Match Specifications in Erlang</a> in the ERTS User's
Guide and <a href="ms_transform.html"><code class="inline">ms_transform</code></a>.</p>
  </section>
</section>
<section class="detail" id="t:max_list_size/0">

  <div class="detail-header">
    <a href="#t:max_list_size/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">max_list_size()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L194" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> max_list_size() :: <a href="../../apps/erts/erlang.html#t:non_neg_integer/0">non_neg_integer</a>().</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:no_files/0">

  <div class="detail-header">
    <a href="#t:no_files/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">no_files()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L192" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> no_files() :: <a href="../../apps/erts/erlang.html#t:pos_integer/0">pos_integer</a>().</pre>

      </div>

<p>An integer &gt; 1.</p>
  </section>
</section>
<section class="detail" id="t:order/0">

  <div class="detail-header">
    <a href="#t:order/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">order()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L188" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> order() :: ascending | descending | <a href="#t:order_fun/0">order_fun</a>().</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:order_fun/0">

  <div class="detail-header">
    <a href="#t:order_fun/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">order_fun()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L189" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> order_fun() :: fun((<a href="../../apps/erts/erlang.html#t:term/0">term</a>(), <a href="../../apps/erts/erlang.html#t:term/0">term</a>()) -> <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()).</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:query_cursor/0">

  <div class="detail-header">
    <a href="#t:query_cursor/0" class="detail-link" data-no-tooltip="" aria-label="Link to this opaque">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">query_cursor()</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L162" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-opaque</span> query_cursor()</pre>

      </div>

<p>A <a href="qlc.html#query_cursor">query cursor</a>.</p>
  </section>
</section>
<section class="detail" id="t:query_handle/0">

  <div class="detail-header">
    <a href="#t:query_handle/0" class="detail-link" data-no-tooltip="" aria-label="Link to this opaque">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">query_handle()</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L164" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-opaque</span> query_handle()</pre>

      </div>

<p>A <a href="qlc.html#query_handle">query handle</a>.</p>
  </section>
</section>
<section class="detail" id="t:query_handle_or_list/0">

  <div class="detail-header">
    <a href="#t:query_handle_or_list/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">query_handle_or_list()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L165" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> query_handle_or_list() :: <a href="#t:query_handle/0">query_handle</a>() | <a href="../../apps/erts/erlang.html#t:list/0">list</a>().</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:query_list_comprehension/0">

  <div class="detail-header">
    <a href="#t:query_list_comprehension/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">query_list_comprehension()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L160" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> query_list_comprehension() :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>

<p>A literal <a href="qlc.html#query_list_comprehension">query list comprehension</a>.</p>
  </section>
</section>
<section class="detail" id="t:sort_option/0">

  <div class="detail-header">
    <a href="#t:sort_option/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">sort_option()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L182" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> sort_option() ::
          {compressed, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()} |
          {no_files, <a href="#t:no_files/0">no_files</a>()} |
          {order, <a href="#t:order/0">order</a>()} |
          {size, <a href="../../apps/erts/erlang.html#t:pos_integer/0">pos_integer</a>()} |
          {tmpdir, <a href="#t:tmp_directory/0">tmp_directory</a>()} |
          {unique, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()}.</pre>

      </div>

<p>See <a href="file_sorter.html"><code class="inline">file_sorter</code></a> for a description of the options.</p>
  </section>
</section>
<section class="detail" id="t:sort_options/0">

  <div class="detail-header">
    <a href="#t:sort_options/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">sort_options()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L180" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> sort_options() :: [<a href="#t:sort_option/0">sort_option</a>()] | <a href="#t:sort_option/0">sort_option</a>().</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:spawn_options/0">

  <div class="detail-header">
    <a href="#t:spawn_options/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">spawn_options()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L179" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> spawn_options() :: default | [<a href="proc_lib.html#t:spawn_option/0">proc_lib:spawn_option</a>()].</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:tmp_directory/0">

  <div class="detail-header">
    <a href="#t:tmp_directory/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">tmp_directory()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L190" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> tmp_directory() :: [] | <a href="../../apps/kernel/file.html#t:name/0">file:name</a>().</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:tmp_file_usage/0">

  <div class="detail-header">
    <a href="#t:tmp_file_usage/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">tmp_file_usage()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L196" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> tmp_file_usage() :: allowed | not_allowed | info_msg | warning_msg | error_msg.</pre>

      </div>


  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="append/1">

  <div class="detail-header">
    <a href="#append/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">append(QHL)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L207" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> append(QHL) -> QH when QHL :: [<a href="#t:query_handle_or_list/0">query_handle_or_list</a>()], QH :: <a href="#t:query_handle/0">query_handle</a>().</pre>

      </div>

<p>Returns a query handle. When evaluating query handle <code class="inline">QH</code>, all answers to the
first query handle in <code class="inline">QHL</code> are returned, followed by all answers to the
remaining query handles in <code class="inline">QHL</code>.</p>
  </section>
</section>
<section class="detail" id="append/2">

  <div class="detail-header">
    <a href="#append/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">append(QH1, QH2)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L225" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> append(QH1, QH2) -> QH3
                when QH1 :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(), QH2 :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(), QH3 :: <a href="#t:query_handle/0">query_handle</a>().</pre>

      </div>

<p>Returns a query handle. When evaluating query handle <code class="inline">QH3</code>, all answers to <code class="inline">QH1</code>
are returned, followed by all answers to <code class="inline">QH2</code>.</p><p><a href="#append/2"><code class="inline">append(QH1, QH2)</code></a> is equivalent to
<a href="#append/1"><code class="inline">append([QH1, QH2])</code></a>.</p>
  </section>
</section>
<section class="detail" id="cursor/1">

  <div class="detail-header">
    <a href="#cursor/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">cursor(QH)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L236" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> cursor(QH) -> Cursor when QH :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(), Cursor :: <a href="#t:query_cursor/0">query_cursor</a>().</pre>

      </div>

<p>Equivalent to <a href="#cursor/2"><code class="inline">cursor(QH, [])</code></a>.</p>
  </section>
</section>
<section class="detail" id="cursor/2">

  <div class="detail-header">
    <a href="#cursor/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">cursor(QH, Options)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L273" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> cursor(QH, Options) -> Cursor
                when
                    QH :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(),
                    Options :: [Option] | Option,
                    Option ::
                        {cache_all, <a href="#t:cache/0">cache</a>()} |
                        cache_all |
                        {max_list_size, <a href="#t:max_list_size/0">max_list_size</a>()} |
                        {spawn_options, <a href="#t:spawn_options/0">spawn_options</a>()} |
                        {tmpdir_usage, <a href="#t:tmp_file_usage/0">tmp_file_usage</a>()} |
                        {tmpdir, <a href="#t:tmp_directory/0">tmp_directory</a>()} |
                        {unique_all, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()} |
                        unique_all,
                    Cursor :: <a href="#t:query_cursor/0">query_cursor</a>().</pre>

      </div>

<p>Creates a query cursor and makes the calling process the owner of the cursor.</p><p>The cursor is to be used as argument to <a href="#next_answers/1"><code class="inline">next_answers/1,2</code></a>
and (eventually) <a href="#delete_cursor/1"><code class="inline">delete_cursor/1</code></a>. Calls <a href="../../apps/erts/erlang.html#spawn_opt/2"><code class="inline">erlang:spawn_opt/2</code></a> to spawn and link
to a process that evaluates the query handle. The value of option
<code class="inline">spawn_options</code> is used as last argument when calling
<a href="../../apps/erts/erlang.html#spawn_opt/2"><code class="inline">spawn_opt/2</code></a>. Defaults to <code class="inline">[link]</code>.</p><p><em>Example:</em></p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="n">QH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="9244305702-1">(</span><span class="p" data-group-id="9244305702-2">[</span><span class="p" data-group-id="9244305702-3">{</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p" data-group-id="9244305702-3">}</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9244305702-4">[</span><span class="ss">a</span><span class="p">,</span><span class="ss">b</span><span class="p" data-group-id="9244305702-4">]</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9244305702-5">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="9244305702-5">]</span><span class="p" data-group-id="9244305702-2">]</span><span class="p" data-group-id="9244305702-1">)</span><span class="p">,</span><span class="w">
</span><span class="n">QC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">cursor</span><span class="p" data-group-id="9244305702-6">(</span><span class="n">QH</span><span class="p" data-group-id="9244305702-6">)</span><span class="p">,</span><span class="w">
</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">next_answers</span><span class="p" data-group-id="9244305702-7">(</span><span class="n">QC</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="9244305702-7">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9244305702-8">[</span><span class="p" data-group-id="9244305702-9">{</span><span class="ss">a</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="9244305702-9">}</span><span class="p" data-group-id="9244305702-8">]</span><span class="gp unselectable">
2&gt; </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">next_answers</span><span class="p" data-group-id="9244305702-10">(</span><span class="n">QC</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="9244305702-10">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9244305702-11">[</span><span class="p" data-group-id="9244305702-12">{</span><span class="ss">a</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="9244305702-12">}</span><span class="p" data-group-id="9244305702-11">]</span><span class="gp unselectable">
3&gt; </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">next_answers</span><span class="p" data-group-id="9244305702-13">(</span><span class="n">QC</span><span class="p">,</span><span class="w"> </span><span class="ss">all_remaining</span><span class="p" data-group-id="9244305702-13">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9244305702-14">[</span><span class="p" data-group-id="9244305702-15">{</span><span class="ss">b</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="9244305702-15">}</span><span class="p">,</span><span class="p" data-group-id="9244305702-16">{</span><span class="ss">b</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="9244305702-16">}</span><span class="p" data-group-id="9244305702-14">]</span><span class="gp unselectable">
4&gt; </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">delete_cursor</span><span class="p" data-group-id="9244305702-17">(</span><span class="n">QC</span><span class="p" data-group-id="9244305702-17">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span></code></pre>
  </section>
</section>
<section class="detail" id="delete_cursor/1">

  <div class="detail-header">
    <a href="#delete_cursor/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">delete_cursor(QueryCursor)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L294" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> delete_cursor(QueryCursor) -> ok when QueryCursor :: <a href="#t:query_cursor/0">query_cursor</a>().</pre>

      </div>

<p>Deletes a query cursor. Only the owner of the cursor can delete the cursor.</p>
  </section>
</section>
<section class="detail" id="e/1">

  <div class="detail-header">
    <a href="#e/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">e(QH)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L307" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> e(QH) -> Answers | Error
           when
               QH :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(),
               Answers :: <a href="#t:answers/0">answers</a>(),
               Error :: {error, <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Reason},
               Reason :: <a href="file_sorter.html#t:reason/0">file_sorter:reason</a>().</pre>

      </div>

<p>Equivalent to <a href="#eval/2"><code class="inline">eval(QH, [])</code></a>.</p>
  </section>
</section>
<section class="detail" id="e/2">

  <div class="detail-header">
    <a href="#e/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">e(QH, Options)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L322" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> e(QH, Options) -> Answers | Error
           when
               QH :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(),
               Options :: [Option] | Option,
               Option ::
                   {cache_all, <a href="#t:cache/0">cache</a>()} |
                   cache_all |
                   {max_list_size, <a href="#t:max_list_size/0">max_list_size</a>()} |
                   {tmpdir_usage, <a href="#t:tmp_file_usage/0">tmp_file_usage</a>()} |
                   {tmpdir, <a href="#t:tmp_directory/0">tmp_directory</a>()} |
                   {unique_all, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()} |
                   unique_all,
               Answers :: <a href="#t:answers/0">answers</a>(),
               Error :: {error, <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Reason},
               Reason :: <a href="file_sorter.html#t:reason/0">file_sorter:reason</a>().</pre>

      </div>

<p>Equivalent to <a href="#eval/2"><code class="inline">eval(QH, Options)</code></a>.</p>
  </section>
</section>
<section class="detail" id="eval/1">

  <div class="detail-header">
    <a href="#eval/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">eval(QH)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L331" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> eval(QH) -> Answers | Error
              when
                  QH :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(),
                  Answers :: <a href="#t:answers/0">answers</a>(),
                  Error :: {error, <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Reason},
                  Reason :: <a href="file_sorter.html#t:reason/0">file_sorter:reason</a>().</pre>

      </div>

<p>Equivalent to <a href="#eval/2"><code class="inline">eval(QH, [])</code></a>.</p>
  </section>
</section>
<section class="detail" id="eval/2">

  <div class="detail-header">
    <a href="#eval/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">eval(QH, Options)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L357" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> eval(QH, Options) -> Answers | Error
              when
                  QH :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(),
                  Answers :: <a href="#t:answers/0">answers</a>(),
                  Options :: [Option] | Option,
                  Option ::
                      {cache_all, <a href="#t:cache/0">cache</a>()} |
                      cache_all |
                      {max_list_size, <a href="#t:max_list_size/0">max_list_size</a>()} |
                      {tmpdir_usage, <a href="#t:tmp_file_usage/0">tmp_file_usage</a>()} |
                      {tmpdir, <a href="#t:tmp_directory/0">tmp_directory</a>()} |
                      {unique_all, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()} |
                      unique_all,
                  Error :: {error, <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Reason},
                  Reason :: <a href="file_sorter.html#t:reason/0">file_sorter:reason</a>().</pre>

      </div>

<p>Evaluates a query handle in the calling process and collects all answers in a
list.</p><p><em>Example:</em></p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="n">QH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="4653899319-1">(</span><span class="p" data-group-id="4653899319-2">[</span><span class="p" data-group-id="4653899319-3">{</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p" data-group-id="4653899319-3">}</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4653899319-4">[</span><span class="ss">a</span><span class="p">,</span><span class="ss">b</span><span class="p" data-group-id="4653899319-4">]</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4653899319-5">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="4653899319-5">]</span><span class="p" data-group-id="4653899319-2">]</span><span class="p" data-group-id="4653899319-1">)</span><span class="p">,</span><span class="w">
</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">eval</span><span class="p" data-group-id="4653899319-6">(</span><span class="n">QH</span><span class="p" data-group-id="4653899319-6">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="4653899319-7">[</span><span class="p" data-group-id="4653899319-8">{</span><span class="ss">a</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="4653899319-8">}</span><span class="p">,</span><span class="p" data-group-id="4653899319-9">{</span><span class="ss">a</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="4653899319-9">}</span><span class="p">,</span><span class="p" data-group-id="4653899319-10">{</span><span class="ss">b</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="4653899319-10">}</span><span class="p">,</span><span class="p" data-group-id="4653899319-11">{</span><span class="ss">b</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="4653899319-11">}</span><span class="p" data-group-id="4653899319-7">]</span></code></pre>
  </section>
</section>
<section class="detail" id="fold/3">

  <div class="detail-header">
    <a href="#fold/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">fold(Function, Acc0, QH)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L399" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> fold(Function, Acc0, QH) -> Acc1 | Error
              when
                  QH :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(),
                  Function :: fun((<a href="#t:answer/0">answer</a>(), AccIn) -> AccOut),
                  Acc0 :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                  Acc1 :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                  AccIn :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                  AccOut :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                  Error :: {error, <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Reason},
                  Reason :: <a href="file_sorter.html#t:reason/0">file_sorter:reason</a>().</pre>

      </div>

<p>Equivalent to <a href="#fold/4"><code class="inline">fold(Function, Acc0, QH, [])</code></a>.</p>
  </section>
</section>
<section class="detail" id="fold/4">

  <div class="detail-header">
    <a href="#fold/4" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">fold(Function, Acc0, QH, Options)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L434" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> fold(Function, Acc0, QH, Options) -> Acc1 | Error
              when
                  QH :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(),
                  Function :: fun((<a href="#t:answer/0">answer</a>(), AccIn) -> AccOut),
                  Acc0 :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                  Acc1 :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                  AccIn :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                  AccOut :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                  Options :: [Option] | Option,
                  Option ::
                      {cache_all, <a href="#t:cache/0">cache</a>()} |
                      cache_all |
                      {max_list_size, <a href="#t:max_list_size/0">max_list_size</a>()} |
                      {tmpdir_usage, <a href="#t:tmp_file_usage/0">tmp_file_usage</a>()} |
                      {tmpdir, <a href="#t:tmp_directory/0">tmp_directory</a>()} |
                      {unique_all, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()} |
                      unique_all,
                  Error :: {error, <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Reason},
                  Reason :: <a href="file_sorter.html#t:reason/0">file_sorter:reason</a>().</pre>

      </div>

<p>Calls <code class="inline">Function</code> on successive answers to the query handle together with an
extra argument <code class="inline">AccIn</code>.</p><p>The query handle and the function are evaluated in the
calling process. <code class="inline">Function</code> must return a new accumulator, which is passed to
the next call. <code class="inline">Acc0</code> is returned if there are no answers to the query handle.</p><p><em>Example:</em></p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="n">QH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2054269997-1">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p" data-group-id="2054269997-1">]</span><span class="p">,</span><span class="w">
</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">fold</span><span class="p" data-group-id="2054269997-2">(</span><span class="nf">fun</span><span class="p" data-group-id="2054269997-3">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Sum</span><span class="p" data-group-id="2054269997-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Sum</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">QH</span><span class="p" data-group-id="2054269997-2">)</span><span class="p">.</span><span class="w">
</span><span class="mi">21</span></code></pre>
  </section>
</section>
<section class="detail" id="format_error/1">

  <div class="detail-header">
    <a href="#format_error/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">format_error(Error)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L471" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> format_error(Error) -> Chars when Error :: {error, <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), <a href="../../apps/erts/erlang.html#t:term/0">term</a>()}, Chars :: <a href="io_lib.html#t:chars/0">io_lib:chars</a>().</pre>

      </div>

<p>Returns a descriptive string in English of an error tuple returned by some of
the functions of the <code class="inline">qlc</code> module or the parse transform. This function is
mainly used by the compiler invoking the parse transform.</p>
  </section>
</section>
<section class="detail" id="info/1">

  <div class="detail-header">
    <a href="#info/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">info(QH)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L518" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> info(QH) -> Info when QH :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(), Info :: <a href="#t:abstract_expr/0">abstract_expr</a>() | <a href="../../apps/erts/erlang.html#t:string/0">string</a>().</pre>

      </div>

<p>Equivalent to <a href="#info/2"><code class="inline">info(QH, [])</code></a>.</p>
  </section>
</section>
<section class="detail" id="info/2">

  <div class="detail-header">
    <a href="#info/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">info(QH, Options)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L629" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> info(QH, Options) -> Info
              when
                  QH :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(),
                  Options :: [Option] | Option,
                  Option :: EvalOption | ReturnOption,
                  EvalOption ::
                      {cache_all, <a href="#t:cache/0">cache</a>()} |
                      cache_all |
                      {max_list_size, <a href="#t:max_list_size/0">max_list_size</a>()} |
                      {tmpdir_usage, <a href="#t:tmp_file_usage/0">tmp_file_usage</a>()} |
                      {tmpdir, <a href="#t:tmp_directory/0">tmp_directory</a>()} |
                      {unique_all, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()} |
                      unique_all,
                  ReturnOption ::
                      {depth, Depth} | {flat, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()} | {format, Format} | {n_elements, NElements},
                  Depth :: infinity | <a href="../../apps/erts/erlang.html#t:non_neg_integer/0">non_neg_integer</a>(),
                  Format :: abstract_code | string,
                  NElements :: infinity | <a href="../../apps/erts/erlang.html#t:pos_integer/0">pos_integer</a>(),
                  Info :: <a href="#t:abstract_expr/0">abstract_expr</a>() | <a href="../../apps/erts/erlang.html#t:string/0">string</a>().</pre>

      </div>

<p>Returns information about a query handle. The information describes the
simplifications and optimizations that are the results of preparing the query
for evaluation. This function is probably mainly useful during debugging.</p><p>The information has the form of an Erlang expression where QLCs most likely
occur. Depending on the format functions of mentioned QLC tables, it is not
certain that the information is absolutely accurate.</p><p>Options:</p><ul><li>The default is to return a sequence of QLCs in a block, but if option
<code class="inline">{flat, false}</code> is specified, one single QLC is returned.</li><li>The default is to return a string, but if option <code class="inline">{format, abstract_code}</code> is
specified, abstract code is returned instead. In the abstract code, port
identifiers, references, and pids are represented by strings.</li><li>The default is to return all elements in lists, but if option
<code class="inline">{n_elements, NElements}</code> is specified, only a limited number of elements are
returned.</li><li>The default is to show all parts of objects and match specifications, but if
option <code class="inline">{depth, Depth}</code> is specified, parts of terms below a certain depth are
replaced by <code class="inline">'...'</code>.</li></ul><p><em>Examples:</em></p><p>In the following example two simple QLCs are inserted only to hold option
<code class="inline">{unique, true}</code>:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="n">QH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="6880323213-1">(</span><span class="p" data-group-id="6880323213-2">[</span><span class="p" data-group-id="6880323213-3">{</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p" data-group-id="6880323213-3">}</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6880323213-4">[</span><span class="ss">x</span><span class="p">,</span><span class="ss">y</span><span class="p" data-group-id="6880323213-4">]</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6880323213-5">[</span><span class="ss">a</span><span class="p">,</span><span class="ss">b</span><span class="p" data-group-id="6880323213-5">]</span><span class="p" data-group-id="6880323213-2">]</span><span class="p" data-group-id="6880323213-1">)</span><span class="p">,</span><span class="w">
</span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6880323213-6">(</span><span class="s">&quot;</span><span class="si">~s</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6880323213-7">[</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">info</span><span class="p" data-group-id="6880323213-8">(</span><span class="n">QH</span><span class="p">,</span><span class="w"> </span><span class="ss">unique_all</span><span class="p" data-group-id="6880323213-8">)</span><span class="p" data-group-id="6880323213-7">]</span><span class="p" data-group-id="6880323213-6">)</span><span class="p">.</span><span class="w">
</span><span class="k">begin</span><span class="w">
    </span><span class="n">V1</span><span class="w"> </span><span class="o">=</span><span class="w">
        </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="6880323213-9">(</span><span class="p" data-group-id="6880323213-10">[</span><span class="w">
               </span><span class="n">SQV</span><span class="w"> </span><span class="p">||</span><span class="w">
                   </span><span class="n">SQV</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6880323213-11">[</span><span class="ss">x</span><span class="p">,</span><span class="w"> </span><span class="ss">y</span><span class="p" data-group-id="6880323213-11">]</span><span class="w">
              </span><span class="p" data-group-id="6880323213-10">]</span><span class="p">,</span><span class="w">
              </span><span class="p" data-group-id="6880323213-12">[</span><span class="p" data-group-id="6880323213-13">{</span><span class="ss">unique</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6880323213-13">}</span><span class="p" data-group-id="6880323213-12">]</span><span class="p" data-group-id="6880323213-9">)</span><span class="p">,</span><span class="w">
    </span><span class="n">V2</span><span class="w"> </span><span class="o">=</span><span class="w">
        </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="6880323213-14">(</span><span class="p" data-group-id="6880323213-15">[</span><span class="w">
               </span><span class="n">SQV</span><span class="w"> </span><span class="p">||</span><span class="w">
                   </span><span class="n">SQV</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6880323213-16">[</span><span class="ss">a</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="p" data-group-id="6880323213-16">]</span><span class="w">
              </span><span class="p" data-group-id="6880323213-15">]</span><span class="p">,</span><span class="w">
              </span><span class="p" data-group-id="6880323213-17">[</span><span class="p" data-group-id="6880323213-18">{</span><span class="ss">unique</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6880323213-18">}</span><span class="p" data-group-id="6880323213-17">]</span><span class="p" data-group-id="6880323213-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="6880323213-19">(</span><span class="p" data-group-id="6880323213-20">[</span><span class="w">
           </span><span class="p" data-group-id="6880323213-21">{</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p" data-group-id="6880323213-21">}</span><span class="w"> </span><span class="p">||</span><span class="w">
               </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V1</span><span class="p">,</span><span class="w">
               </span><span class="n">Y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V2</span><span class="w">
          </span><span class="p" data-group-id="6880323213-20">]</span><span class="p">,</span><span class="w">
          </span><span class="p" data-group-id="6880323213-22">[</span><span class="p" data-group-id="6880323213-23">{</span><span class="ss">unique</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6880323213-23">}</span><span class="p" data-group-id="6880323213-22">]</span><span class="p" data-group-id="6880323213-19">)</span><span class="w">
</span><span class="k">end</span></code></pre><p>In the following example QLC <code class="inline">V2</code> has been inserted to show the joined
generators and the join method chosen. A convention is used for lookup join: the
first generator (<code class="inline">G2</code>) is the one traversed, the second (<code class="inline">G1</code>) is the table
where constants are looked up.</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="n">E1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">new</span><span class="p" data-group-id="3973065296-1">(</span><span class="ss">e1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3973065296-2">[</span><span class="p" data-group-id="3973065296-2">]</span><span class="p" data-group-id="3973065296-1">)</span><span class="p">,</span><span class="w">
</span><span class="n">E2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">new</span><span class="p" data-group-id="3973065296-3">(</span><span class="ss">e2</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3973065296-4">[</span><span class="p" data-group-id="3973065296-4">]</span><span class="p" data-group-id="3973065296-3">)</span><span class="p">,</span><span class="w">
</span><span class="ss">true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">insert</span><span class="p" data-group-id="3973065296-5">(</span><span class="n">E1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3973065296-6">[</span><span class="p" data-group-id="3973065296-7">{</span><span class="mi">1</span><span class="p">,</span><span class="ss">a</span><span class="p" data-group-id="3973065296-7">}</span><span class="p">,</span><span class="p" data-group-id="3973065296-8">{</span><span class="mi">2</span><span class="p">,</span><span class="ss">b</span><span class="p" data-group-id="3973065296-8">}</span><span class="p" data-group-id="3973065296-6">]</span><span class="p" data-group-id="3973065296-5">)</span><span class="p">,</span><span class="w">
</span><span class="ss">true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">insert</span><span class="p" data-group-id="3973065296-9">(</span><span class="n">E2</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3973065296-10">[</span><span class="p" data-group-id="3973065296-11">{</span><span class="ss">a</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="3973065296-11">}</span><span class="p">,</span><span class="p" data-group-id="3973065296-12">{</span><span class="ss">b</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="3973065296-12">}</span><span class="p" data-group-id="3973065296-10">]</span><span class="p" data-group-id="3973065296-9">)</span><span class="p">,</span><span class="w">
</span><span class="n">Q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="3973065296-13">(</span><span class="p" data-group-id="3973065296-14">[</span><span class="p" data-group-id="3973065296-15">{</span><span class="n">X</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">W</span><span class="p" data-group-id="3973065296-15">}</span><span class="w"> </span><span class="p">||</span><span class="w">
</span><span class="p" data-group-id="3973065296-16">{</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p" data-group-id="3973065296-16">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">table</span><span class="p" data-group-id="3973065296-17">(</span><span class="n">E1</span><span class="p" data-group-id="3973065296-17">)</span><span class="p">,</span><span class="w">
</span><span class="p" data-group-id="3973065296-18">{</span><span class="n">W</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p" data-group-id="3973065296-18">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">table</span><span class="p" data-group-id="3973065296-19">(</span><span class="n">E2</span><span class="p" data-group-id="3973065296-19">)</span><span class="p">,</span><span class="w">
</span><span class="n">X</span><span class="w"> </span><span class="o">=:=</span><span class="w"> </span><span class="n">Y</span><span class="p" data-group-id="3973065296-14">]</span><span class="p" data-group-id="3973065296-13">)</span><span class="p">,</span><span class="w">
</span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3973065296-20">(</span><span class="s">&quot;</span><span class="si">~s</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3973065296-21">[</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">info</span><span class="p" data-group-id="3973065296-22">(</span><span class="n">Q</span><span class="p" data-group-id="3973065296-22">)</span><span class="p" data-group-id="3973065296-21">]</span><span class="p" data-group-id="3973065296-20">)</span><span class="p">.</span><span class="w">
</span><span class="k">begin</span><span class="w">
    </span><span class="n">V1</span><span class="w"> </span><span class="o">=</span><span class="w">
        </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="3973065296-23">(</span><span class="p" data-group-id="3973065296-24">[</span><span class="w">
               </span><span class="n">P0</span><span class="w"> </span><span class="p">||</span><span class="w">
                   </span><span class="n">P0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3973065296-25">{</span><span class="n">W</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p" data-group-id="3973065296-25">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
                       </span><span class="nc">ets</span><span class="p">:</span><span class="nf">table</span><span class="p" data-group-id="3973065296-26">(</span><span class="p">#</span><span class="n">Ref</span><span class="o">&lt;</span><span class="mf">0.3098908599</span><span class="p">.</span><span class="mf">2283929601.256549</span><span class="o">&gt;</span><span class="p" data-group-id="3973065296-26">)</span><span class="w">
              </span><span class="p" data-group-id="3973065296-24">]</span><span class="p" data-group-id="3973065296-23">)</span><span class="p">,</span><span class="w">
    </span><span class="n">V2</span><span class="w"> </span><span class="o">=</span><span class="w">
        </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="3973065296-27">(</span><span class="p" data-group-id="3973065296-28">[</span><span class="w">
               </span><span class="p" data-group-id="3973065296-29">[</span><span class="n">G1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">G2</span><span class="p" data-group-id="3973065296-29">]</span><span class="w"> </span><span class="p">||</span><span class="w">
                   </span><span class="n">G2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V1</span><span class="p">,</span><span class="w">
                   </span><span class="n">G1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
                       </span><span class="nc">ets</span><span class="p">:</span><span class="nf">table</span><span class="p" data-group-id="3973065296-30">(</span><span class="p">#</span><span class="n">Ref</span><span class="o">&lt;</span><span class="mf">0.3098908599</span><span class="p">.</span><span class="mf">2283929601.256548</span><span class="o">&gt;</span><span class="p" data-group-id="3973065296-30">)</span><span class="p">,</span><span class="w">
                   </span><span class="nf">element</span><span class="p" data-group-id="3973065296-31">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">G1</span><span class="p" data-group-id="3973065296-31">)</span><span class="w"> </span><span class="o">=:=</span><span class="w"> </span><span class="nf">element</span><span class="p" data-group-id="3973065296-32">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">G2</span><span class="p" data-group-id="3973065296-32">)</span><span class="w">
              </span><span class="p" data-group-id="3973065296-28">]</span><span class="p">,</span><span class="w">
              </span><span class="p" data-group-id="3973065296-33">[</span><span class="p" data-group-id="3973065296-34">{</span><span class="ss">join</span><span class="p">,</span><span class="w"> </span><span class="ss">lookup</span><span class="p" data-group-id="3973065296-34">}</span><span class="p" data-group-id="3973065296-33">]</span><span class="p" data-group-id="3973065296-27">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="3973065296-35">(</span><span class="p" data-group-id="3973065296-36">[</span><span class="w">
           </span><span class="p" data-group-id="3973065296-37">{</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p">,</span><span class="w"> </span><span class="n">W</span><span class="p" data-group-id="3973065296-37">}</span><span class="w"> </span><span class="p">||</span><span class="w">
               </span><span class="p" data-group-id="3973065296-38">[</span><span class="p" data-group-id="3973065296-39">{</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p" data-group-id="3973065296-39">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="3973065296-40">{</span><span class="n">W</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p" data-group-id="3973065296-40">}</span><span class="p" data-group-id="3973065296-38">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V2</span><span class="w">
          </span><span class="p" data-group-id="3973065296-36">]</span><span class="p" data-group-id="3973065296-35">)</span><span class="w">
</span><span class="k">end</span></code></pre>
  </section>
</section>
<section class="detail" id="keysort/2">

  <div class="detail-header">
    <a href="#keysort/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">keysort(KeyPos, QH1)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L669" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> keysort(KeyPos, QH1) -> QH2
                 when KeyPos :: <a href="#t:key_pos/0">key_pos</a>(), QH1 :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(), QH2 :: <a href="#t:query_handle/0">query_handle</a>().</pre>

      </div>

<p>Equivalent to <a href="#keysort/3"><code class="inline">keysort(KeyPos, QH1, [])</code></a>.</p>
  </section>
</section>
<section class="detail" id="keysort/3">

  <div class="detail-header">
    <a href="#keysort/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">keysort(KeyPos, QH1, SortOptions)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L685" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> keysort(KeyPos, QH1, SortOptions) -> QH2
                 when
                     KeyPos :: <a href="#t:key_pos/0">key_pos</a>(),
                     SortOptions :: <a href="#t:sort_options/0">sort_options</a>(),
                     QH1 :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(),
                     QH2 :: <a href="#t:query_handle/0">query_handle</a>().</pre>

      </div>

<p>Returns a query handle. When evaluating query handle <code class="inline">QH2</code>, the answers to query
handle <code class="inline">QH1</code> are sorted by <a href="file_sorter.html#keysort/4"><code class="inline">file_sorter:keysort/4</code></a> according to the options.</p><p>The sorter uses temporary files only if <code class="inline">QH1</code> does not evaluate to a list and
the size of the binary representation of the answers exceeds <code class="inline">Size</code> bytes, where
<code class="inline">Size</code> is the value of option <code class="inline">size</code>.</p>
  </section>
</section>
<section class="detail" id="next_answers/1">

  <div class="detail-header">
    <a href="#next_answers/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">next_answers(QueryCursor)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L710" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> next_answers(QueryCursor) -> Answers | Error
                      when
                          QueryCursor :: <a href="#t:query_cursor/0">query_cursor</a>(),
                          Answers :: <a href="#t:answers/0">answers</a>(),
                          Error :: {error, <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Reason},
                          Reason :: <a href="file_sorter.html#t:reason/0">file_sorter:reason</a>().</pre>

      </div>

<p>Equivalent to <a href="#next_answers/2"><code class="inline">next_answers(C, 10)</code></a>.</p>
  </section>
</section>
<section class="detail" id="next_answers/2">

  <div class="detail-header">
    <a href="#next_answers/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">next_answers(QueryCursor, NumberOfAnswers)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L728" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> next_answers(QueryCursor, NumberOfAnswers) -> Answers | Error
                      when
                          QueryCursor :: <a href="#t:query_cursor/0">query_cursor</a>(),
                          Answers :: <a href="#t:answers/0">answers</a>(),
                          NumberOfAnswers :: all_remaining | <a href="../../apps/erts/erlang.html#t:pos_integer/0">pos_integer</a>(),
                          Error :: {error, <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Reason},
                          Reason :: <a href="file_sorter.html#t:reason/0">file_sorter:reason</a>().</pre>

      </div>

<p>Returns some or all of the remaining answers to a query cursor. Only the owner
of <code class="inline">QueryCursor</code> can retrieve answers.</p><p>Argument <code class="inline">NumberOfAnswers</code> determines the maximum number of answers
returned. If less than the requested number of answers is
returned, subsequent calls to <code class="inline">next_answers</code> return <code class="inline">[]</code>.</p>
  </section>
</section>
<section class="detail" id="q/1">

  <div class="detail-header">
    <a href="#q/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">q(QLC)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L763" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> q(QLC) -> QH when QLC :: <a href="#t:query_list_comprehension/0">query_list_comprehension</a>(), QH :: <a href="#t:query_handle/0">query_handle</a>().</pre>

      </div>

<p>Equivalent to <a href="#q/2"><code class="inline">q(QLC, [])</code></a>.</p>
  </section>
</section>
<section class="detail" id="q/2">

  <div class="detail-header">
    <a href="#q/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">q(QLC, Options)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L956" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> q(QLC, Options) -> QH
           when
               QH :: <a href="#t:query_handle/0">query_handle</a>(),
               Options :: [Option] | Option,
               Option ::
                   {max_lookup, MaxLookup} |
                   {cache, <a href="#t:cache/0">cache</a>()} |
                   cache |
                   {join, Join} |
                   {lookup, Lookup} |
                   {unique, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()} |
                   unique,
               MaxLookup :: <a href="../../apps/erts/erlang.html#t:non_neg_integer/0">non_neg_integer</a>() | infinity,
               Join :: any | lookup | merge | nested_loop,
               Lookup :: <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>() | any,
               QLC :: <a href="#t:query_list_comprehension/0">query_list_comprehension</a>().</pre>

      </div>

<p>Returns a query handle for a QLC. The QLC must be the first argument to this
function, otherwise it is evaluated as an ordinary list comprehension. It is
also necessary to add the following line to the source code:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">include_lib</span><span class="p" data-group-id="9076821162-1">(</span><span class="s">&quot;stdlib/include/qlc.hrl&quot;</span><span class="p" data-group-id="9076821162-1">)</span><span class="p">.</span></code></pre><p>This causes a parse transform to substitute a fun for the QLC. The (compiled)
fun is called when the query handle is evaluated.</p><p>When calling <code class="inline">qlc:q/1,2</code> from the Erlang shell, the parse transform is
automatically called. When this occurs, the fun substituted for the QLC is not
compiled but is evaluated by <a href="erl_eval.html"><code class="inline">erl_eval</code></a>. This is also true when expressions
are evaluated by <code class="inline">file:eval/1,2</code> or in the debugger.</p><p>To be explicit, this does not work:</p><pre><code class="makeup erlang" translate="no"><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6954477543-1">[</span><span class="n">X</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="p" data-group-id="6954477543-2">{</span><span class="n">X</span><span class="p" data-group-id="6954477543-2">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6954477543-3">[</span><span class="p" data-group-id="6954477543-4">{</span><span class="mi">1</span><span class="p" data-group-id="6954477543-4">}</span><span class="p">,</span><span class="p" data-group-id="6954477543-5">{</span><span class="mi">2</span><span class="p" data-group-id="6954477543-5">}</span><span class="p" data-group-id="6954477543-3">]</span><span class="p" data-group-id="6954477543-1">]</span><span class="p">,</span><span class="w">
</span><span class="n">QH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="6954477543-6">(</span><span class="n">A</span><span class="p" data-group-id="6954477543-6">)</span><span class="p">,</span><span class="w">
</span><span class="p">.</span><span class="p">.</span><span class="p">.</span></code></pre><p>Variable <code class="inline">A</code> is bound to the evaluated value of the list comprehension
(<code class="inline">[1,2]</code>). The compiler complains with an error message (&quot;argument is not a
query list comprehension&quot;); the shell process stops with a <code class="inline">badarg</code> reason.</p><p>Options:</p><ul><li><p>Option <code class="inline">{cache, ets}</code> can be used to cache the answers to a QLC. The answers
are stored in one ETS table for each cached QLC. When a cached QLC is
evaluated again, answers are fetched from the table without any further
computations. Therefore, when all answers to a cached QLC have been found, the
ETS tables used for caching answers to the qualifiers of the QLC can be
emptied. Option <code class="inline">cache</code> is equivalent to <code class="inline">{cache, ets}</code>.</p></li><li><p>Option <code class="inline">{cache, list}</code> can be used to cache the answers to a QLC like
<code class="inline">{cache, ets}</code>. The difference is that the answers are kept in a list (on the
process heap). If the answers would occupy more than a certain amount of RAM
memory, a temporary file is used for storing the answers. Option
<code class="inline">max_list_size</code> sets the limit in bytes and the temporary file is put on the
directory set by option <code class="inline">tmpdir</code>.</p><p>Option <code class="inline">cache</code> has no effect if it is known that the QLC is to be evaluated at
most once. This is always true for the top-most QLC and also for the list
expression of the first generator in a list of qualifiers. Notice that in the
presence of side effects in filters or callback functions, the answers to QLCs
can be affected by option <code class="inline">cache</code>.</p></li><li><p>Option <code class="inline">{unique, true}</code> can be used to remove duplicate answers to a QLC. The
unique answers are stored in one ETS table for each QLC. The table is emptied
every time it is known that there are no more answers to the QLC. Option
<code class="inline">unique</code> is equivalent to <code class="inline">{unique, true}</code>. If option <code class="inline">unique</code> is combined
with option <code class="inline">{cache, ets}</code>, two ETS tables are used, but the full answers are
stored in one table only. If option <code class="inline">unique</code> is combined with option
<code class="inline">{cache, list}</code>, the answers are sorted twice using <a href="#keysort/3"><code class="inline">keysort/3</code></a>; once to
remove duplicates and once to restore the order.</p></li></ul><p>Options <code class="inline">cache</code> and <code class="inline">unique</code> apply not only to the QLC itself but also to the
results of looking up constants, running match specifications, and joining
handles.</p><p><em>Example:</em></p><p>In the following example the cached results of the merge join are traversed for
each value of <code class="inline">A</code>. Notice that without option <code class="inline">cache</code> the join would have been
carried out three times, once for each value of <code class="inline">A</code>.</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="n">Q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="6831970588-1">(</span><span class="p" data-group-id="6831970588-2">[</span><span class="p" data-group-id="6831970588-3">{</span><span class="n">A</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">W</span><span class="p" data-group-id="6831970588-3">}</span><span class="w"> </span><span class="p">||</span><span class="w">
</span><span class="n">A</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6831970588-4">[</span><span class="ss">a</span><span class="p">,</span><span class="ss">b</span><span class="p">,</span><span class="ss">c</span><span class="p" data-group-id="6831970588-4">]</span><span class="p">,</span><span class="w">
</span><span class="p" data-group-id="6831970588-5">{</span><span class="n">X</span><span class="p">,</span><span class="n">Z</span><span class="p" data-group-id="6831970588-5">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6831970588-6">[</span><span class="p" data-group-id="6831970588-7">{</span><span class="ss">a</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="6831970588-7">}</span><span class="p">,</span><span class="p" data-group-id="6831970588-8">{</span><span class="ss">b</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="6831970588-8">}</span><span class="p">,</span><span class="p" data-group-id="6831970588-9">{</span><span class="ss">c</span><span class="p">,</span><span class="mi">6</span><span class="p" data-group-id="6831970588-9">}</span><span class="p" data-group-id="6831970588-6">]</span><span class="p">,</span><span class="w">
</span><span class="p" data-group-id="6831970588-10">{</span><span class="n">W</span><span class="p">,</span><span class="n">Y</span><span class="p" data-group-id="6831970588-10">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6831970588-11">[</span><span class="p" data-group-id="6831970588-12">{</span><span class="mi">2</span><span class="p">,</span><span class="ss">a</span><span class="p" data-group-id="6831970588-12">}</span><span class="p">,</span><span class="p" data-group-id="6831970588-13">{</span><span class="mi">3</span><span class="p">,</span><span class="ss">b</span><span class="p" data-group-id="6831970588-13">}</span><span class="p">,</span><span class="p" data-group-id="6831970588-14">{</span><span class="mi">4</span><span class="p">,</span><span class="ss">c</span><span class="p" data-group-id="6831970588-14">}</span><span class="p" data-group-id="6831970588-11">]</span><span class="p">,</span><span class="w">
</span><span class="n">X</span><span class="w"> </span><span class="o">=:=</span><span class="w"> </span><span class="n">Y</span><span class="p" data-group-id="6831970588-2">]</span><span class="p">,</span><span class="w">
</span><span class="p" data-group-id="6831970588-15">{</span><span class="ss">cache</span><span class="p">,</span><span class="w"> </span><span class="ss">list</span><span class="p" data-group-id="6831970588-15">}</span><span class="p" data-group-id="6831970588-1">)</span><span class="p">,</span><span class="w">
</span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6831970588-16">(</span><span class="s">&quot;</span><span class="si">~s</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6831970588-17">[</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">info</span><span class="p" data-group-id="6831970588-18">(</span><span class="n">Q</span><span class="p" data-group-id="6831970588-18">)</span><span class="p" data-group-id="6831970588-17">]</span><span class="p" data-group-id="6831970588-16">)</span><span class="p">.</span><span class="w">
</span><span class="k">begin</span><span class="w">
    </span><span class="n">V1</span><span class="w"> </span><span class="o">=</span><span class="w">
        </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="6831970588-19">(</span><span class="p" data-group-id="6831970588-20">[</span><span class="w">
               </span><span class="n">P0</span><span class="w"> </span><span class="p">||</span><span class="w">
                   </span><span class="n">P0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6831970588-21">{</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p" data-group-id="6831970588-21">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
                       </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">keysort</span><span class="p" data-group-id="6831970588-22">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6831970588-23">[</span><span class="p" data-group-id="6831970588-24">{</span><span class="ss">a</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="6831970588-24">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6831970588-25">{</span><span class="ss">b</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p" data-group-id="6831970588-25">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6831970588-26">{</span><span class="ss">c</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p" data-group-id="6831970588-26">}</span><span class="p" data-group-id="6831970588-23">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6831970588-27">[</span><span class="p" data-group-id="6831970588-27">]</span><span class="p" data-group-id="6831970588-22">)</span><span class="w">
              </span><span class="p" data-group-id="6831970588-20">]</span><span class="p" data-group-id="6831970588-19">)</span><span class="p">,</span><span class="w">
    </span><span class="n">V2</span><span class="w"> </span><span class="o">=</span><span class="w">
        </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="6831970588-28">(</span><span class="p" data-group-id="6831970588-29">[</span><span class="w">
               </span><span class="n">P0</span><span class="w"> </span><span class="p">||</span><span class="w">
                   </span><span class="n">P0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6831970588-30">{</span><span class="n">W</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p" data-group-id="6831970588-30">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
                       </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">keysort</span><span class="p" data-group-id="6831970588-31">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6831970588-32">[</span><span class="p" data-group-id="6831970588-33">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">a</span><span class="p" data-group-id="6831970588-33">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6831970588-34">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="p" data-group-id="6831970588-34">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6831970588-35">{</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="ss">c</span><span class="p" data-group-id="6831970588-35">}</span><span class="p" data-group-id="6831970588-32">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6831970588-36">[</span><span class="p" data-group-id="6831970588-36">]</span><span class="p" data-group-id="6831970588-31">)</span><span class="w">
              </span><span class="p" data-group-id="6831970588-29">]</span><span class="p" data-group-id="6831970588-28">)</span><span class="p">,</span><span class="w">
    </span><span class="n">V3</span><span class="w"> </span><span class="o">=</span><span class="w">
        </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="6831970588-37">(</span><span class="p" data-group-id="6831970588-38">[</span><span class="w">
               </span><span class="p" data-group-id="6831970588-39">[</span><span class="n">G1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">G2</span><span class="p" data-group-id="6831970588-39">]</span><span class="w"> </span><span class="p">||</span><span class="w">
                   </span><span class="n">G1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V1</span><span class="p">,</span><span class="w">
                   </span><span class="n">G2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V2</span><span class="p">,</span><span class="w">
                   </span><span class="nf">element</span><span class="p" data-group-id="6831970588-40">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">G1</span><span class="p" data-group-id="6831970588-40">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">element</span><span class="p" data-group-id="6831970588-41">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">G2</span><span class="p" data-group-id="6831970588-41">)</span><span class="w">
              </span><span class="p" data-group-id="6831970588-38">]</span><span class="p">,</span><span class="w">
              </span><span class="p" data-group-id="6831970588-42">[</span><span class="p" data-group-id="6831970588-43">{</span><span class="ss">join</span><span class="p">,</span><span class="w"> </span><span class="ss">merge</span><span class="p" data-group-id="6831970588-43">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6831970588-44">{</span><span class="ss">cache</span><span class="p">,</span><span class="w"> </span><span class="ss">list</span><span class="p" data-group-id="6831970588-44">}</span><span class="p" data-group-id="6831970588-42">]</span><span class="p" data-group-id="6831970588-37">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="6831970588-45">(</span><span class="p" data-group-id="6831970588-46">[</span><span class="w">
           </span><span class="p" data-group-id="6831970588-47">{</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p">,</span><span class="w"> </span><span class="n">W</span><span class="p" data-group-id="6831970588-47">}</span><span class="w"> </span><span class="p">||</span><span class="w">
               </span><span class="n">A</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6831970588-48">[</span><span class="ss">a</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="p">,</span><span class="w"> </span><span class="ss">c</span><span class="p" data-group-id="6831970588-48">]</span><span class="p">,</span><span class="w">
               </span><span class="p" data-group-id="6831970588-49">[</span><span class="p" data-group-id="6831970588-50">{</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p" data-group-id="6831970588-50">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="6831970588-51">{</span><span class="n">W</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p" data-group-id="6831970588-51">}</span><span class="p" data-group-id="6831970588-49">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V3</span><span class="p">,</span><span class="w">
               </span><span class="n">X</span><span class="w"> </span><span class="o">=:=</span><span class="w"> </span><span class="n">Y</span><span class="w">
          </span><span class="p" data-group-id="6831970588-46">]</span><span class="p" data-group-id="6831970588-45">)</span><span class="w">
</span><span class="k">end</span></code></pre><p><a href="#sort/1"><code class="inline">sort/1,2</code></a> and <a href="#keysort/2"><code class="inline">keysort/2,3</code></a> can also be used for
caching answers and for removing duplicates. When sorting answers are cached in
a list, possibly stored on a temporary file, and no ETS tables are used.</p><p>Sometimes (see <a href="#table/2"><code class="inline">table/2</code></a>) traversal of tables can be done by looking up key
values, which is assumed to be fast. Under certain (rare) circumstances there
can be too many key values to look up. <a href="" id="max_lookup"></a> Option
<code class="inline">{max_lookup, MaxLookup}</code> can then be used to limit the number of lookups: if
more than <code class="inline">MaxLookup</code> lookups would be required, no lookups are done but the
table is traversed instead. Defaults to <code class="inline">infinity</code>, which means that there is no
limit on the number of keys to look up.</p><p><em>Example:</em></p><p>In the following example, using the <code class="inline">gb_table</code> module from section
<a href="qlc.html#implementing_a_qlc_table">Implementing a QLC Table</a>, there are six keys
to look up: <code class="inline">{1,a}</code>, <code class="inline">{1,b}</code>, <code class="inline">{1,c}</code>, <code class="inline">{2,a}</code>, <code class="inline">{2,b}</code>, and <code class="inline">{2,c}</code>. The reason
is that the two elements of key <code class="inline">{X, Y}</code> are compared separately.</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gb_trees</span><span class="p">:</span><span class="nf">empty</span><span class="p" data-group-id="8617969982-1">(</span><span class="p" data-group-id="8617969982-1">)</span><span class="p">,</span><span class="w">
</span><span class="n">QH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">q</span><span class="p" data-group-id="8617969982-2">(</span><span class="p" data-group-id="8617969982-3">[</span><span class="n">X</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="p" data-group-id="8617969982-4">{</span><span class="p" data-group-id="8617969982-5">{</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p" data-group-id="8617969982-5">}</span><span class="p">,</span><span class="p">_</span><span class="p" data-group-id="8617969982-4">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">gb_table</span><span class="p">:</span><span class="nf">table</span><span class="p" data-group-id="8617969982-6">(</span><span class="n">T</span><span class="p" data-group-id="8617969982-6">)</span><span class="p">,</span><span class="w">
</span><span class="p" data-group-id="8617969982-7">(</span><span class="p" data-group-id="8617969982-8">(</span><span class="n">X</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="8617969982-8">)</span><span class="w"> </span><span class="nf">or</span><span class="w"> </span><span class="p" data-group-id="8617969982-9">(</span><span class="n">X</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="8617969982-9">)</span><span class="p" data-group-id="8617969982-7">)</span><span class="w"> </span><span class="nf">andalso</span><span class="w">
</span><span class="p" data-group-id="8617969982-10">(</span><span class="p" data-group-id="8617969982-11">(</span><span class="n">Y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">a</span><span class="p" data-group-id="8617969982-11">)</span><span class="w"> </span><span class="nf">or</span><span class="w"> </span><span class="p" data-group-id="8617969982-12">(</span><span class="n">Y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">b</span><span class="p" data-group-id="8617969982-12">)</span><span class="w"> </span><span class="nf">or</span><span class="w"> </span><span class="p" data-group-id="8617969982-13">(</span><span class="n">Y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">c</span><span class="p" data-group-id="8617969982-13">)</span><span class="p" data-group-id="8617969982-10">)</span><span class="p" data-group-id="8617969982-3">]</span><span class="p" data-group-id="8617969982-2">)</span><span class="p">,</span><span class="w">
</span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8617969982-14">(</span><span class="s">&quot;</span><span class="si">~s</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8617969982-15">[</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">info</span><span class="p" data-group-id="8617969982-16">(</span><span class="n">QH</span><span class="p" data-group-id="8617969982-16">)</span><span class="p" data-group-id="8617969982-15">]</span><span class="p" data-group-id="8617969982-14">)</span><span class="p">.</span><span class="w">
</span><span class="nc">ets</span><span class="p">:</span><span class="nf">match_spec_run</span><span class="p" data-group-id="8617969982-17">(</span><span class="w">
       </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatmap</span><span class="p" data-group-id="8617969982-18">(</span><span class="nf">fun</span><span class="p" data-group-id="8617969982-19">(</span><span class="n">K</span><span class="p" data-group-id="8617969982-19">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                            </span><span class="k">case</span><span class="w">
                                </span><span class="nc">gb_trees</span><span class="p">:</span><span class="nf">lookup</span><span class="p" data-group-id="8617969982-20">(</span><span class="n">K</span><span class="p">,</span><span class="w">
                                                </span><span class="nc">gb_trees</span><span class="p">:</span><span class="nf">from_orddict</span><span class="p" data-group-id="8617969982-21">(</span><span class="p" data-group-id="8617969982-22">[</span><span class="p" data-group-id="8617969982-22">]</span><span class="p" data-group-id="8617969982-21">)</span><span class="p" data-group-id="8617969982-20">)</span><span class="w">
                            </span><span class="k">of</span><span class="w">
                                </span><span class="p" data-group-id="8617969982-23">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p" data-group-id="8617969982-23">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                                    </span><span class="p" data-group-id="8617969982-24">[</span><span class="p" data-group-id="8617969982-25">{</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p" data-group-id="8617969982-25">}</span><span class="p" data-group-id="8617969982-24">]</span><span class="p">;</span><span class="w">
                                </span><span class="ss">none</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                                    </span><span class="p" data-group-id="8617969982-26">[</span><span class="p" data-group-id="8617969982-26">]</span><span class="w">
                            </span><span class="k">end</span><span class="w">
                     </span><span class="k">end</span><span class="p">,</span><span class="w">
                     </span><span class="p" data-group-id="8617969982-27">[</span><span class="p" data-group-id="8617969982-28">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">a</span><span class="p" data-group-id="8617969982-28">}</span><span class="p">,</span><span class="w">
                      </span><span class="p" data-group-id="8617969982-29">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="p" data-group-id="8617969982-29">}</span><span class="p">,</span><span class="w">
                      </span><span class="p" data-group-id="8617969982-30">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">c</span><span class="p" data-group-id="8617969982-30">}</span><span class="p">,</span><span class="w">
                      </span><span class="p" data-group-id="8617969982-31">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">a</span><span class="p" data-group-id="8617969982-31">}</span><span class="p">,</span><span class="w">
                      </span><span class="p" data-group-id="8617969982-32">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="p" data-group-id="8617969982-32">}</span><span class="p">,</span><span class="w">
                      </span><span class="p" data-group-id="8617969982-33">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">c</span><span class="p" data-group-id="8617969982-33">}</span><span class="p" data-group-id="8617969982-27">]</span><span class="p" data-group-id="8617969982-18">)</span><span class="p">,</span><span class="w">
       </span><span class="nc">ets</span><span class="p">:</span><span class="nf">match_spec_compile</span><span class="p" data-group-id="8617969982-34">(</span><span class="p" data-group-id="8617969982-35">[</span><span class="p" data-group-id="8617969982-36">{</span><span class="p" data-group-id="8617969982-37">{</span><span class="p" data-group-id="8617969982-38">{</span><span class="ss">&#39;$1&#39;</span><span class="p">,</span><span class="w"> </span><span class="ss">&#39;$2&#39;</span><span class="p" data-group-id="8617969982-38">}</span><span class="p">,</span><span class="w"> </span><span class="ss">&#39;_&#39;</span><span class="p" data-group-id="8617969982-37">}</span><span class="p">,</span><span class="w">
                                </span><span class="p" data-group-id="8617969982-39">[</span><span class="p" data-group-id="8617969982-39">]</span><span class="p">,</span><span class="w">
                                </span><span class="p" data-group-id="8617969982-40">[</span><span class="ss">&#39;$1&#39;</span><span class="p" data-group-id="8617969982-40">]</span><span class="p" data-group-id="8617969982-36">}</span><span class="p" data-group-id="8617969982-35">]</span><span class="p" data-group-id="8617969982-34">)</span><span class="p" data-group-id="8617969982-17">)</span></code></pre><p>Options:</p><ul><li><p>Option <code class="inline">{lookup, true}</code> can be used to ensure that the <code class="inline">qlc</code> module looks up
constants in some QLC table. If there are more than one QLC table among the
list expressions of the generators, constants must be looked up in at least
one of the tables. The evaluation of the query fails if there are no constants
to look up. This option is useful when it would be unacceptable to traverse
all objects in some table. Setting option <code class="inline">lookup</code> to <code class="inline">false</code> ensures that no
constants are looked up (<code class="inline">{max_lookup, 0}</code> has the same effect). Defaults to
<code class="inline">any</code>, which means that constants are looked up whenever possible.</p></li><li><p>Option <code class="inline">{join, Join}</code> can be used to ensure that a certain join method is
used:</p><ul><li><code class="inline">{join, lookup}</code> invokes the lookup join method.</li><li><code class="inline">{join, merge}</code> invokes the merge join method.</li><li><code class="inline">{join, nested_loop}</code> invokes the method of matching every pair of objects
from two handles. This method is mostly very slow.</li></ul><p>The evaluation of the query fails if the <code class="inline">qlc</code> module cannot carry out the
chosen join method. Defaults to <code class="inline">any</code>, which means that some fast join method
is used if possible.</p></li></ul>
  </section>
</section>
<section class="detail" id="sort/1">

  <div class="detail-header">
    <a href="#sort/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">sort(QH1)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L972" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> sort(QH1) -> QH2 when QH1 :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(), QH2 :: <a href="#t:query_handle/0">query_handle</a>().</pre>

      </div>

<p>Equivalent to <a href="#sort/2"><code class="inline">sort(QH, [])</code></a>.</p>
  </section>
</section>
<section class="detail" id="sort/2">

  <div class="detail-header">
    <a href="#sort/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">sort(QH1, SortOptions)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L987" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> sort(QH1, SortOptions) -> QH2
              when SortOptions :: <a href="#t:sort_options/0">sort_options</a>(), QH1 :: <a href="#t:query_handle_or_list/0">query_handle_or_list</a>(), QH2 :: <a href="#t:query_handle/0">query_handle</a>().</pre>

      </div>

<p>Returns a query handle. When evaluating query handle <code class="inline">QH2</code>, the answers to query
handle <code class="inline">QH1</code> are sorted by <a href="file_sorter.html#sort/3"><code class="inline">file_sorter:sort/3</code></a> according to the options.</p><p>The sorter uses temporary files only if <code class="inline">QH1</code> does not evaluate to a list and
the size of the binary representation of the answers exceeds <code class="inline">Size</code> bytes, where
<code class="inline">Size</code> is the value of option <code class="inline">size</code>.</p>
  </section>
</section>
<section class="detail" id="string_to_handle/1">

  <div class="detail-header">
    <a href="#string_to_handle/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">string_to_handle(QueryString)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L1006" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> string_to_handle(QueryString) -> QH | Error
                          when
                              QueryString :: <a href="../../apps/erts/erlang.html#t:string/0">string</a>(),
                              QH :: <a href="#t:query_handle/0">query_handle</a>(),
                              Error :: {error, <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Reason},
                              Reason :: <a href="erl_parse.html#t:error_info/0">erl_parse:error_info</a>() | <a href="erl_scan.html#t:error_info/0">erl_scan:error_info</a>().</pre>

      </div>

<p>Equivalent to <a href="#string_to_handle/2"><code class="inline">string_to_handle(QueryString, [])</code></a>.</p>
  </section>
</section>
<section class="detail" id="string_to_handle/2">

  <div class="detail-header">
    <a href="#string_to_handle/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">string_to_handle(QueryString, Options)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L1024" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> string_to_handle(QueryString, Options) -> QH | Error
                          when
                              QueryString :: <a href="../../apps/erts/erlang.html#t:string/0">string</a>(),
                              Options :: [Option] | Option,
                              Option ::
                                  {max_lookup, MaxLookup} |
                                  {cache, <a href="#t:cache/0">cache</a>()} |
                                  cache |
                                  {join, Join} |
                                  {lookup, Lookup} |
                                  {unique, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()} |
                                  unique,
                              MaxLookup :: <a href="../../apps/erts/erlang.html#t:non_neg_integer/0">non_neg_integer</a>() | infinity,
                              Join :: any | lookup | merge | nested_loop,
                              Lookup :: <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>() | any,
                              QH :: <a href="#t:query_handle/0">query_handle</a>(),
                              Error :: {error, <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Reason},
                              Reason :: <a href="erl_parse.html#t:error_info/0">erl_parse:error_info</a>() | <a href="erl_scan.html#t:error_info/0">erl_scan:error_info</a>().</pre>

      </div>

<p>Equivalent to <a href="#string_to_handle/3"><code class="inline">string_to_handle(QueryString, Options, erl_eval:new_bindings())</code></a>.</p>
  </section>
</section>
<section class="detail" id="string_to_handle/3">

  <div class="detail-header">
    <a href="#string_to_handle/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">string_to_handle(QueryString, Options, Bindings)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L1065" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> string_to_handle(QueryString, Options, Bindings) -> QH | Error
                          when
                              QueryString :: <a href="../../apps/erts/erlang.html#t:string/0">string</a>(),
                              Options :: [Option] | Option,
                              Option ::
                                  {max_lookup, MaxLookup} |
                                  {cache, <a href="#t:cache/0">cache</a>()} |
                                  cache |
                                  {join, Join} |
                                  {lookup, Lookup} |
                                  {unique, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()} |
                                  unique,
                              MaxLookup :: <a href="../../apps/erts/erlang.html#t:non_neg_integer/0">non_neg_integer</a>() | infinity,
                              Join :: any | lookup | merge | nested_loop,
                              Lookup :: <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>() | any,
                              Bindings :: <a href="erl_eval.html#t:binding_struct/0">erl_eval:binding_struct</a>(),
                              QH :: <a href="#t:query_handle/0">query_handle</a>(),
                              Error :: {error, <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Reason},
                              Reason :: <a href="erl_parse.html#t:error_info/0">erl_parse:error_info</a>() | <a href="erl_scan.html#t:error_info/0">erl_scan:error_info</a>().</pre>

      </div>

<p>A string version of <a href="#q/1"><code class="inline">q/1,2</code></a>. When the query handle is evaluated, the
fun created by the parse transform is interpreted by <a href="erl_eval.html"><code class="inline">erl_eval</code></a>. The query
string is to be one single QLC terminated by a period.</p><p><em>Example:</em></p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="n">L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3167342866-1">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="3167342866-1">]</span><span class="p">,</span><span class="w">
</span><span class="n">Bs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erl_eval</span><span class="p">:</span><span class="nf">add_binding</span><span class="p" data-group-id="3167342866-2">(</span><span class="ss">&#39;L&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="nc">erl_eval</span><span class="p">:</span><span class="nf">new_bindings</span><span class="p" data-group-id="3167342866-3">(</span><span class="p" data-group-id="3167342866-3">)</span><span class="p" data-group-id="3167342866-2">)</span><span class="p">,</span><span class="w">
</span><span class="n">QH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">qlc</span><span class="p">:</span><span class="nf">string_to_handle</span><span class="p" data-group-id="3167342866-4">(</span><span class="s">&quot;[X+1 || X &lt;- L].&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3167342866-5">[</span><span class="p" data-group-id="3167342866-5">]</span><span class="p">,</span><span class="w"> </span><span class="n">Bs</span><span class="p" data-group-id="3167342866-4">)</span><span class="p">,</span><span class="w">
</span><span class="nc">qlc</span><span class="p">:</span><span class="nf">eval</span><span class="p" data-group-id="3167342866-6">(</span><span class="n">QH</span><span class="p" data-group-id="3167342866-6">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="3167342866-7">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="3167342866-7">]</span></code></pre><p>This function is probably mainly useful when called from outside of Erlang, for
example from a driver written in C.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p>Query handles created this way may have worse performance than when created
directly via <a href="#q/1"><code class="inline">q/1,2</code></a>.</p></section>
  </section>
</section>
<section class="detail" id="table/2">

  <div class="detail-header">
    <a href="#table/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">table(TraverseFun, Options)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/stdlib/src/qlc.erl#L1281" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> table(TraverseFun, Options) -> QH
               when
                   TraverseFun :: TraverseFun0 | TraverseFun1,
                   TraverseFun0 :: fun(() -> TraverseResult),
                   TraverseFun1 :: fun((<a href="#t:match_expression/0">match_expression</a>()) -> TraverseResult),
                   TraverseResult :: Objects | <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                   Objects :: [] | [<a href="../../apps/erts/erlang.html#t:term/0">term</a>() | ObjectList],
                   ObjectList :: TraverseFun0 | Objects,
                   Options :: [Option] | Option,
                   Option ::
                       {format_fun, FormatFun} |
                       {info_fun, InfoFun} |
                       {lookup_fun, LookupFun} |
                       {parent_fun, ParentFun} |
                       {post_fun, PostFun} |
                       {pre_fun, PreFun} |
                       {key_equality, KeyComparison},
                   FormatFun :: undefined | fun((SelectedObjects) -> FormatedTable),
                   SelectedObjects ::
                       all |
                       {all, NElements, DepthFun} |
                       {match_spec, <a href="#t:match_expression/0">match_expression</a>()} |
                       {lookup, Position, Keys} |
                       {lookup, Position, Keys, NElements, DepthFun},
                   NElements :: infinity | <a href="../../apps/erts/erlang.html#t:pos_integer/0">pos_integer</a>(),
                   DepthFun :: fun((<a href="../../apps/erts/erlang.html#t:term/0">term</a>()) -> <a href="../../apps/erts/erlang.html#t:term/0">term</a>()),
                   FormatedTable :: {Mod, Fun, Args} | <a href="#t:abstract_expr/0">abstract_expr</a>() | <a href="../../apps/erts/erlang.html#t:string/0">string</a>(),
                   InfoFun :: undefined | fun((InfoTag) -> InfoValue),
                   InfoTag :: indices | is_unique_objects | keypos | num_of_objects,
                   InfoValue :: undefined | <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                   LookupFun :: undefined | fun((Position, Keys) -> LookupResult),
                   LookupResult :: [<a href="../../apps/erts/erlang.html#t:term/0">term</a>()] | <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                   ParentFun :: undefined | fun(() -> ParentFunValue),
                   PostFun :: undefined | fun(() -> <a href="../../apps/erts/erlang.html#t:term/0">term</a>()),
                   PreFun :: undefined | fun((PreArgs) -> <a href="../../apps/erts/erlang.html#t:term/0">term</a>()),
                   PreArgs :: [PreArg],
                   PreArg :: {parent_value, ParentFunValue} | {stop_fun, StopFun},
                   ParentFunValue :: undefined | <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                   StopFun :: undefined | fun(() -> <a href="../../apps/erts/erlang.html#t:term/0">term</a>()),
                   KeyComparison :: '=:=' | '==',
                   Position :: <a href="../../apps/erts/erlang.html#t:pos_integer/0">pos_integer</a>(),
                   Keys :: [<a href="../../apps/erts/erlang.html#t:term/0">term</a>()],
                   Mod :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>(),
                   Fun :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>(),
                   Args :: [<a href="../../apps/erts/erlang.html#t:term/0">term</a>()],
                   QH :: <a href="#t:query_handle/0">query_handle</a>().</pre>

      </div>

<p>Returns a query handle for a QLC table. In Erlang/OTP there is support for ETS,
Dets, and Mnesia tables, but many other data structures can be turned into QLC
tables. This is accomplished by letting function(s) in the module implementing
the data structure create a query handle by calling <a href="#table/2"><code class="inline">qlc:table/2</code></a>.</p><p>The different ways to traverse the table and properties of the table are handled
by callback functions provided as options to <a href="#table/2"><code class="inline">qlc:table/2</code></a>.</p><ul><li><p>Callback function <code class="inline">TraverseFun</code> is used for traversing the table. It is to
return a list of objects terminated by either <code class="inline">[]</code> or a nullary fun to be used
for traversing the not yet traversed objects of the table. Any other return
value is immediately returned as value of the query evaluation. Unary
<code class="inline">TraverseFun</code>s are to accept a match specification as argument. The match
specification is created by the parse transform by analyzing the pattern of
the generator calling <a href="#table/2"><code class="inline">qlc:table/2</code></a> and filters using variables introduced in
the pattern. If the parse transform cannot find a match specification
equivalent to the pattern and filters, <code class="inline">TraverseFun</code> is called with a match
specification returning every object.</p><ul><li>Modules that can use match specifications for optimized traversal of tables
are to call <a href="#table/2"><code class="inline">qlc:table/2</code></a> with an unary <code class="inline">TraverseFun</code>. An example is
<a href="ets.html#table/2"><code class="inline">ets:table/2</code></a>.</li><li>Other modules can provide a nullary <code class="inline">TraverseFun</code>. An example is
<a href="qlc.html#gb_table"><code class="inline">gb_table:table/1</code></a> in section
<a href="qlc.html#implementing_a_qlc_table">Implementing a QLC Table</a>.</li></ul></li><li><p>Unary callback function <code class="inline">PreFun</code> is called once before the table is read for
the first time. If the call fails, the query evaluation fails.</p><p>Argument <code class="inline">PreArgs</code> is a list of tagged values. There are two tags,
<code class="inline">parent_value</code> and <code class="inline">stop_fun</code>, used by Mnesia for managing transactions.</p><ul><li>The value of <code class="inline">parent_value</code> is the value returned by <code class="inline">ParentFun</code>, or
<code class="inline">undefined</code> if there is no <code class="inline">ParentFun</code>. <code class="inline">ParentFun</code> is called once just
before the call of <code class="inline">PreFun</code> in the context of the process calling
<a href="#eval/1"><code class="inline">eval/1,2</code></a>, <a href="#fold/3"><code class="inline">fold/3,4</code></a>, or
<a href="#cursor/1"><code class="inline">cursor/1,2</code></a>.</li><li>The value of <code class="inline">stop_fun</code> is a nullary fun that deletes the cursor if called
from the parent, or <code class="inline">undefined</code> if there is no cursor.</li></ul></li><li><p>Nullary callback function <code class="inline">PostFun</code> is called once after the table was last
read. The return value, which is caught, is ignored. If <code class="inline">PreFun</code> has been
called for a table, <code class="inline">PostFun</code> is guaranteed to be called for that table, even
if the evaluation of the query fails for some reason.</p><p>The pre (post) functions for different tables are evaluated in unspecified
order.</p><p>Other table access than reading, such as calling <code class="inline">InfoFun</code>, is assumed to be
OK at any time.</p></li><li><p><a href="" id="lookup_fun"></a> Binary callback function <code class="inline">LookupFun</code> is used for looking
up objects in the table. The first argument <code class="inline">Position</code> is the key position or
an indexed position and the second argument <code class="inline">Keys</code> is a sorted list of unique
values. The return value is to be a list of all objects (tuples), such that
the element at <code class="inline">Position</code> is a member of <code class="inline">Keys</code>. Any other return value is
immediately returned as value of the query evaluation. <code class="inline">LookupFun</code> is called
instead of traversing the table if the parse transform at compile time can
determine that the filters match and compare the element at <code class="inline">Position</code> in such
a way that only <code class="inline">Keys</code> need to be looked up to find all potential answers.</p><p>The key position is obtained by calling <code class="inline">InfoFun(keypos)</code> and the indexed
positions by calling <code class="inline">InfoFun(indices)</code>. If the key position can be used for
lookup, it is always chosen, otherwise the indexed position requiring the
least number of lookups is chosen. If there is a tie between two indexed
positions, the one occurring first in the list returned by <code class="inline">InfoFun</code> is
chosen. Positions requiring more than <a href="qlc.html#max_lookup">max_lookup</a> lookups
are ignored.</p></li><li><p>Unary callback function <code class="inline">InfoFun</code> is to return information about the table.
<code class="inline">undefined</code> is to be returned if the value of some tag is unknown:</p><ul><li><p><strong><code class="inline">indices</code></strong> - Returns a list of indexed positions, a list of positive
integers.</p></li><li><p><strong><code class="inline">is_unique_objects</code></strong> - Returns <code class="inline">true</code> if the objects returned by
<code class="inline">TraverseFun</code> are unique.</p></li><li><p><strong><code class="inline">keypos</code></strong> - Returns the position of the table key, a positive integer.</p></li><li><p><strong><code class="inline">is_sorted_key</code></strong> - Returns <code class="inline">true</code> if the objects returned by
<code class="inline">TraverseFun</code> are sorted on the key.</p></li><li><p><strong><code class="inline">num_of_objects</code></strong> - Returns the number of objects in the table, a
non-negative integer.</p></li></ul></li><li><p>Unary callback function <code class="inline">FormatFun</code> is used by <a href="#info/1"><code class="inline">info/1,2</code></a> for
displaying the call that created the query handle of the table. Defaults to
<code class="inline">undefined</code>, which means that <code class="inline">info/1,2</code> displays a call to <code class="inline">'$MOD':'$FUN'/0</code>.
It is up to <code class="inline">FormatFun</code> to present the selected objects of the table in a
suitable way. However, if a character list is chosen for presentation, it must
be an Erlang expression that can be scanned and parsed (a trailing dot is
added by <code class="inline">info/1,2</code> though).</p><p><code class="inline">FormatFun</code> is called with an argument that describes the selected objects
based on optimizations done as a result of analyzing the filters of the QLC
where the call to <a href="#table/2"><code class="inline">qlc:table/2</code></a> occurs. The argument can have the following
values:</p><ul><li><p><strong><code class="inline">{lookup, Position, Keys, NElements, DepthFun}</code>.</strong> - <code class="inline">LookupFun</code> is used
for looking up objects in the table.</p></li><li><p><strong><code class="inline">{match_spec, MatchExpression}</code></strong> - No way of finding all possible answers
by looking up keys was found, but the filters could be transformed into a
match specification. All answers are found by calling
<code class="inline">TraverseFun(MatchExpression)</code>.</p></li><li><p><strong><code class="inline">{all, NElements, DepthFun}</code></strong> - No optimization was found. A match
specification matching all objects is used if <code class="inline">TraverseFun</code> is unary.</p><p><code class="inline">NElements</code> is the value of the <code class="inline">info/1,2</code> option <code class="inline">n_elements</code>.</p><p><code class="inline">DepthFun</code> is a function that can be used for limiting the size of terms;
calling <code class="inline">DepthFun(Term)</code> substitutes <code class="inline">'...'</code> for parts of <code class="inline">Term</code> below the
depth specified by the <code class="inline">info/1,2</code> option <code class="inline">depth</code>.</p><p>If calling <code class="inline">FormatFun</code> with an argument including <code class="inline">NElements</code> and <code class="inline">DepthFun</code>
fails, <code class="inline">FormatFun</code> is called once again with an argument excluding
<code class="inline">NElements</code> and <code class="inline">DepthFun</code> (<code class="inline">{lookup, Position, Keys}</code> or <code class="inline">all</code>).</p></li></ul></li><li><p><a href="" id="key_equality"></a> The value of option <code class="inline">key_equality</code> is to be <code class="inline">'=:='</code> if
the table considers two keys equal if they match, and to be <code class="inline">'=='</code> if two keys
are equal if they compare equal. Defaults to <code class="inline">'=:='</code>.</p></li></ul><p>For the various options recognized by <code class="inline">table/1,2</code> in respective module, see
<a href="ets.html#table/1"><code class="inline">ets</code></a>, <a href="dets.html#table/1"><code class="inline">dets</code></a>, and
<a href="../../apps/mnesia/mnesia.html#table/1"><code class="inline">mnesia</code></a>.</p>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="stdlib.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright © 1996-2025 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js"></script>
  <script>
  let initialized = false;

  window.addEventListener("exdoc:loaded", () => {
      if (!initialized) {
      mermaid.initialize({
          startOnLoad: false,
          theme: document.body.className.includes("dark") ? "dark" : "default"
      });
      initialized = true;
      }

      let id = 0;
      for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
          graphEl.innerHTML = svg;
          bindFunctions?.(graphEl);
          preEl.insertAdjacentElement("afterend", graphEl);
          preEl.remove();
      });
      }
  });
  </script>

  </body>
</html>
