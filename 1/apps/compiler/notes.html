<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.1">
    <meta name="project" content="compiler v9.0">


<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=1&q=">
<meta name="major-vsn" content="1">
<link rel="canonical" href="https://www.erlang.org/doc/apps/compiler/notes.html" />
    <title>Compiler Release Notes — compiler v9.0</title>

    <link rel="stylesheet" href="dist/html-erlang-ZK43ZOAC.css" />

    <script defer src="dist/sidebar_items-7A6BCAFF.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="compiler" />
        </a>

      <div>
        <a href="../../index.html" class="sidebar-projectName" translate="no">
compiler
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v9.0
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of compiler</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>Compiler Release Notes</h1>


      <a href="https://github.com/erlang/otp/blob/master/lib/compiler/doc/notes.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<p>This document describes the changes made to the Compiler application.</p><h2 id="compiler-9-0" class="section-heading"><a href="#compiler-9-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 9.0</span></h2><h3 id="fixed-bugs-and-malfunctions" class="section-heading"><a href="#fixed-bugs-and-malfunctions" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler will now emit warnings when some map patterns cannot possibly match because a previous clauses matches the same pattern. For example:</p><pre><code class="makeup erlang" translate="no"><span class="nf">mm_1</span><span class="p" data-group-id="8210291425-1">(</span><span class="p" data-group-id="8210291425-2">#{</span><span class="p" data-group-id="8210291425-2">}</span><span class="p" data-group-id="8210291425-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">a</span><span class="p">;</span><span class="w">
</span><span class="nf">mm_1</span><span class="p" data-group-id="8210291425-3">(</span><span class="p" data-group-id="8210291425-4">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">B</span><span class="p" data-group-id="8210291425-4">}</span><span class="p" data-group-id="8210291425-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="8210291425-5">{</span><span class="ss">b</span><span class="p">,</span><span class="n">B</span><span class="p" data-group-id="8210291425-5">}</span><span class="p">.</span><span class="w">

</span><span class="nf">mm_2</span><span class="p" data-group-id="8210291425-6">(</span><span class="p" data-group-id="8210291425-7">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">A</span><span class="p" data-group-id="8210291425-7">}</span><span class="p" data-group-id="8210291425-6">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="8210291425-8">{</span><span class="ss">a</span><span class="p">,</span><span class="n">A</span><span class="p" data-group-id="8210291425-8">}</span><span class="p">;</span><span class="w">
</span><span class="nf">mm_2</span><span class="p" data-group-id="8210291425-9">(</span><span class="p" data-group-id="8210291425-10">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">B</span><span class="p" data-group-id="8210291425-10">}</span><span class="p" data-group-id="8210291425-9">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="8210291425-11">{</span><span class="ss">b</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p" data-group-id="8210291425-11">}</span><span class="p">.</span></code></pre><p>The second clause of these function can never match and the compiler will now emit a warning for both of them.</p><p>Note that the compiler is not guaranteed to emit warnings for every possible map pattern that cannot match.</p><p>Own Id: OTP-19141 Aux Id: <a href="https://github.com/erlang/otp/issues/8558" title="">GH-8558</a>, <a href="https://github.com/erlang/otp/pull/8600" title="">PR-8600</a></p></li><li><p>The size of an atom in the Erlang source code was limited to 255 bytes in previous releases, meaning that an atom containing only emojis could contain only 63 emojis.</p><p>While atoms are still only allowed to contain 255 characters, the number of bytes is no longer limited.</p><p>External tools that parse the <code class="inline">AtU8</code> chunk of a BEAM file directly need to be updated. Tools that use <a href="../../apps/stdlib/beam_lib.html#chunks/2"><code class="inline">beam_lib:chunks(Beam, [atoms])</code></a> to read the atom table will continue to work.</p><p><strong><em> POTENTIAL INCOMPATIBILITY </em></strong></p><p>Own Id: OTP-19285 Aux Id: <a href="https://github.com/erlang/otp/pull/8913" title="">PR-8913</a></p></li><li><p>The literals chunk in BEAM is no longer compressed, resulting in slightly smaller BEAM files when a BEAM file is stripped using <a href="../../apps/stdlib/beam_lib.html#strip_files/1"><code class="inline">beam_lib:strip_files/1</code></a>.</p><p>This is a potential incompatibility for tools that read and interpret the contents of the literal chunk. One way to update such tools to work with the new format is to retrieve the chunk using <a href="../../apps/stdlib/beam_lib.html#chunks/2"><code class="inline">beam_lib:chunks(Beam, [literals])</code></a>.</p><p><strong><em> POTENTIAL INCOMPATIBILITY </em></strong></p><p>Own Id: OTP-19323 Aux Id: <a href="https://github.com/erlang/otp/issues/8967" title="">GH-8967</a>, <a href="https://github.com/erlang/otp/pull/8988" title="">PR-8988</a></p></li><li><p>The final validation step in the compiler will now reject modules containing functions with more than 255 arguments. No impact is expected as the emulator has always refused to load these modules.</p><p>Own Id: OTP-19376 Aux Id: <a href="https://github.com/erlang/otp/issues/9113" title="">GH-9113</a>, <a href="https://github.com/erlang/otp/pull/9121" title="">PR-9121</a></p></li><li><p>Replaced calls to deprecated <code class="inline">crypto:start()</code> with <code class="inline">application:start(crypto)</code>.</p><p>Own Id: OTP-19485 Aux Id: <a href="https://github.com/erlang/otp/pull/8592" title="">PR-8592</a></p></li><li><p>Refactor code to not rely on <code class="inline">+nowarn_shadow_vars</code>.</p><p>Own Id: OTP-19574 Aux Id: <a href="https://github.com/erlang/otp/pull/9678" title="">PR-9678</a></p></li></ul><h3 id="improvements-and-new-features" class="section-heading"><a href="#improvements-and-new-features" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The EEP-48 doc chunk embedded into <code class="inline">.beam</code> files by the compiler is now <code class="inline">compressed</code> and <code class="inline">deterministic</code>.</p><p>Own Id: OTP-19096 Aux Id: <a href="https://github.com/erlang/otp/pull/8494" title="">PR-8494</a></p></li><li><p>Provided that the map argument for a <a href="../../apps/stdlib/maps.html#put/3"><code class="inline">maps:put/3</code></a> call is known to the compiler to be a map, the compiler will replace such calls with the corresponding update using the map syntax.</p><p>Own Id: OTP-19115 Aux Id: <a href="https://github.com/erlang/otp/pull/8540" title="">PR-8540</a></p></li><li><p>For various error types, the compiler now tries to suggest potential fixes by adding &quot;did you mean ...?&quot; at the end of error messages.</p><p>When a function is used with wrong arity, the compiler will try to suggest a defined function with the same name but a different arity. For example, given the following module:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2849829000-1">(</span><span class="ss">typos</span><span class="p" data-group-id="2849829000-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2849829000-2">(</span><span class="p" data-group-id="2849829000-3">[</span><span class="ss">t</span><span class="p">/</span><span class="mi">0</span><span class="p" data-group-id="2849829000-3">]</span><span class="p" data-group-id="2849829000-2">)</span><span class="p">.</span><span class="w">
</span><span class="nf">bar</span><span class="p" data-group-id="2849829000-4">(</span><span class="n">A</span><span class="p" data-group-id="2849829000-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="w">
</span><span class="nf">bar</span><span class="p" data-group-id="2849829000-5">(</span><span class="n">A</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">A</span><span class="p" data-group-id="2849829000-5">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="w">
</span><span class="nf">bar</span><span class="p" data-group-id="2849829000-6">(</span><span class="n">A</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">A</span><span class="p" data-group-id="2849829000-6">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="w">
</span><span class="nf">t</span><span class="p" data-group-id="2849829000-7">(</span><span class="p" data-group-id="2849829000-7">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">bar</span><span class="p" data-group-id="2849829000-8">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2849829000-8">)</span><span class="p">.</span></code></pre><p>The compiler will emit the following message:</p><pre><code class="makeup erlang" translate="no"><span class="ss">typo</span><span class="p">.</span><span class="nc">erl</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="w"> </span><span class="ss">function</span><span class="w"> </span><span class="ss">bar</span><span class="p">/</span><span class="mi">2</span><span class="w"> </span><span class="ss">undefined</span><span class="p">,</span><span class="w"> </span><span class="ss">did</span><span class="w"> </span><span class="ss">you</span><span class="w"> </span><span class="ss">mean</span><span class="w"> </span><span class="ss">bar</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="o">?</span><span class="w">
</span><span class="c1">%   6|     t() -&gt; bar(0, 0).</span><span class="w">
</span><span class="c1">%    |            ^</span></code></pre><p>For compiler errors that can easily be caused by typos, the compiler will try to suggest what the correct variable or function name, could be. For example, given the following module:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4554776031-1">(</span><span class="ss">typos</span><span class="p" data-group-id="4554776031-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4554776031-2">(</span><span class="p" data-group-id="4554776031-3">[</span><span class="ss">bar</span><span class="p">/</span><span class="mi">2</span><span class="p" data-group-id="4554776031-3">]</span><span class="p" data-group-id="4554776031-2">)</span><span class="p">.</span><span class="w">

</span><span class="nf">bar</span><span class="p" data-group-id="4554776031-4">(</span><span class="n">A0</span><span class="p">,</span><span class="w"> </span><span class="n">B0</span><span class="p" data-group-id="4554776031-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">B</span><span class="p">.</span></code></pre><p>the compiler will emit the following error messages:</p><pre><code class="makeup erlang" translate="no"><span class="ss">typos</span><span class="p">.</span><span class="nc">erl</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="ss">variable</span><span class="w"> </span><span class="ss">&#39;A&#39;</span><span class="w"> </span><span class="ss">is</span><span class="w"> </span><span class="ss">unbound</span><span class="p">,</span><span class="w"> </span><span class="ss">did</span><span class="w"> </span><span class="ss">you</span><span class="w"> </span><span class="ss">mean</span><span class="w"> </span><span class="ss">&#39;A0&#39;</span><span class="o">?</span><span class="w">
</span><span class="c1">%    5|     A + B.</span><span class="w">
</span><span class="c1">%     |     ^</span><span class="w">

</span><span class="ss">typos</span><span class="p">.</span><span class="nc">erl</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="mi">9</span><span class="p">:</span><span class="w"> </span><span class="ss">variable</span><span class="w"> </span><span class="ss">&#39;B&#39;</span><span class="w"> </span><span class="ss">is</span><span class="w"> </span><span class="ss">unbound</span><span class="p">,</span><span class="w"> </span><span class="ss">did</span><span class="w"> </span><span class="ss">you</span><span class="w"> </span><span class="ss">mean</span><span class="w"> </span><span class="ss">&#39;B0&#39;</span><span class="o">?</span><span class="w">
</span><span class="c1">%    5|     A + B.</span><span class="w">
</span><span class="c1">%     |         ^</span></code></pre><p>Error types that now suggest correct arities: <code class="inline">bad_inline</code>, <code class="inline">undefined_nif</code>, <code class="inline">bad_nowarn_unused_function</code>, <code class="inline">bad_nowarn_bif_clash</code>, <code class="inline">undefined_function</code>.</p><p>Error types that now suggest correct names: <code class="inline">bad_inline</code>, <code class="inline">undefined_nif</code>, <code class="inline">bad_nowarn_unused_function</code>, <code class="inline">undefined_on_load</code>, <code class="inline">undefined_function</code>, <code class="inline">undefined_record</code>, <code class="inline">undefined_field</code>, <code class="inline">unbound_var</code>.</p><p>Using a function with wrong arity has higher precedence than having a typo in the function name. If the compiler can find a defined function with the same name but a different arity, it will not suggest a defined function with a close-enough name, regardless of arity.</p><p>Own Id: OTP-19180 Aux Id: <a href="https://github.com/erlang/otp/pull/8699" title="">PR-8699</a>, <a href="https://github.com/erlang/otp/pull/9094" title="">PR-9094</a></p></li><li><p>Comprehensions have been extended with zip generators  according to <a href="https://www.erlang.org/eeps/eep-0073">EEP 73</a>. </p><p>Example:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="p" data-group-id="7410662835-1">[</span><span class="n">A</span><span class="o">+</span><span class="n">B</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7410662835-2">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="7410662835-2">]</span><span class="w"> </span><span class="p">&amp;&amp;</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7410662835-3">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p" data-group-id="7410662835-3">]</span><span class="p" data-group-id="7410662835-1">]</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="7410662835-4">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p" data-group-id="7410662835-4">]</span></code></pre><p>Own Id: OTP-19184 Aux Id: <a href="https://github.com/erlang/otp/pull/8926" title="">PR-8926</a></p></li><li><p>Documentation chunks (EEP-48) has been updated to include the following reserved metadata fields: <code class="inline">behaviours</code>, <code class="inline">group</code>, <code class="inline">source_path</code>, and <code class="inline">source_annos</code>. The compiler has also been updated to emit this metadata. See the <a href="../../apps/kernel/eep48_chapter.html">EEP-48 documentation</a> for more details.</p><p>Own Id: OTP-19306 Aux Id: <a href="https://github.com/erlang/otp/pull/8945" title="">PR-8945</a>, <a href="https://github.com/erlang/otp/pull/8975" title="">PR-8975</a></p></li><li><p>New strict generators have been added for comprehensions.</p><p>The currently existing generators are &quot;relaxed&quot;: they ignore terms in the
right-hand side expression that do not match the left-hand side pattern.</p><p>The new strict generators fail with exception <code class="inline">badmatch</code> if a pattern doesn't match.</p><p>Examples:</p><p>Using the current relaxed generator operator <code class="inline">&lt;-</code>, any element not matching
the pattern <code class="inline">{_,_}</code> will be silently discarded:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="p" data-group-id="0540266891-1">[</span><span class="n">T</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="p" data-group-id="0540266891-2">{</span><span class="p">_</span><span class="p">,</span><span class="p">_</span><span class="p" data-group-id="0540266891-2">}</span><span class="o">=</span><span class="n">T</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0540266891-3">[</span><span class="p" data-group-id="0540266891-4">{</span><span class="ss">ok</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="0540266891-4">}</span><span class="p">,</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="0540266891-5">{</span><span class="ss">error</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="0540266891-5">}</span><span class="p" data-group-id="0540266891-3">]</span><span class="p" data-group-id="0540266891-1">]</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="0540266891-6">[</span><span class="p" data-group-id="0540266891-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="0540266891-7">}</span><span class="p">,</span><span class="p" data-group-id="0540266891-8">{</span><span class="ss">error</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="0540266891-8">}</span><span class="p" data-group-id="0540266891-6">]</span></code></pre><p>If the intention is that all lists processed by a list comprehension must only
contain tuples of size two, using the new strict version of the operator ensures
that term not matching will cause a crash:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">2&gt; </span><span class="p" data-group-id="3583114743-1">[</span><span class="n">T</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="p" data-group-id="3583114743-2">{</span><span class="p">_</span><span class="p">,</span><span class="p">_</span><span class="p" data-group-id="3583114743-2">}</span><span class="o">=</span><span class="n">T</span><span class="w"> </span><span class="o">&lt;:-</span><span class="w"> </span><span class="p" data-group-id="3583114743-3">[</span><span class="p" data-group-id="3583114743-4">{</span><span class="ss">ok</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="3583114743-4">}</span><span class="p">,</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="3583114743-5">{</span><span class="ss">error</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="3583114743-5">}</span><span class="p" data-group-id="3583114743-3">]</span><span class="p" data-group-id="3583114743-1">]</span><span class="p">.</span><span class="w">
</span><span class="gt">** exception error: no match of right hand side value ok</span></code></pre><p>Using the strict generator operator to mark the intention that all list elements must match the pattern could help finding mistakes quicker if something unpexected is added to the list processed by the generator.</p><p>The strict version for bitstring generators is <code class="inline">&lt;:=</code>.</p><p>Own Id: OTP-19317 Aux Id: <a href="https://github.com/erlang/otp/pull/8625" title="">PR-8625</a></p></li><li><p>New options for suppressing behaviour warnings have been added:</p><ul><li><code class="inline">nowarn_conflicting_behaviours</code></li><li><code class="inline">nowarn_undefined_behaviour_func</code></li><li><code class="inline">nowarn_undefined_behaviour</code></li><li><code class="inline">nowarn_undefined_behaviour_callbacks</code></li><li><code class="inline">nowarn_ill_defined_behaviour_callbacks</code></li><li><code class="inline">nowarn_ill_defined_optional_callbacks</code></li></ul><p>Own Id: OTP-19334 Aux Id: <a href="https://github.com/erlang/otp/issues/8985" title="">GH-8985</a>, <a href="https://github.com/erlang/otp/pull/9020" title="">PR-9020</a></p></li><li><p>Some BIFs with side-effects are optimized in <code class="inline">try</code>/<code class="inline">catch</code> in the same way as guard BIFs in order to gain performance.</p><p>The following BIFs that are optimized in this way: <a href="../../apps/erts/erlang.html#binary_to_atom/1"><code class="inline">binary_to_atom/1</code></a>,
<a href="../../apps/erts/erlang.html#binary_to_atom/2"><code class="inline">binary_to_atom/2</code></a>, <a href="../../apps/erts/erlang.html#binary_to_existing_atom/1"><code class="inline">binary_to_existing_atom/1</code></a>, <a href="../../apps/erts/erlang.html#list_to_atom/1"><code class="inline">list_to_atom/1</code></a>, and
<a href="../../apps/erts/erlang.html#list_to_existing_atom/1"><code class="inline">list_to_existing_atom/1</code></a>.</p><p>Own Id: OTP-19339 Aux Id: <a href="https://github.com/erlang/otp/pull/9042" title="">PR-9042</a>, <a href="https://github.com/erlang/otp/pull/9122" title="">PR-9122</a></p></li><li><p>The compiler now converts known documentation attribute metadata entries from <a href="../../apps/stdlib/unicode.html#t:chardata/0"><code class="inline">unicode:chardata/0</code></a> to <a href="../../apps/stdlib/unicode.html#t:unicode_binary/0"><code class="inline">unicode:unicode_binary/0</code></a>.</p><p>Own Id: OTP-19394 Aux Id: <a href="https://github.com/erlang/otp/pull/9192" title="">PR-9192</a></p></li><li><p>The <code class="inline">warn_deprecated_catch</code> option enables warnings for use of old-style catch expressions on the form <code class="inline">catch Expr</code> instead of the modern <code class="inline">try ... catch ... end</code>. To prevent new uses of uses of old catches to be added, this compiler option can be enabled on the project level and <code class="inline">-compile(nowarn_deprecated_catch).</code> added to individual files that still contain old catches.</p><p>Own Id: OTP-19425 Aux Id: <a href="https://github.com/erlang/otp/pull/9154" title="">PR-9154</a></p></li><li><p>Defining a fun in terms of an imported function is not allowed. Before this release, the compiler would not catch this kind of error if the name of the imported function happened to be a BIF.  Consider this example:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7777389235-1">(</span><span class="ss">fun_example</span><span class="p" data-group-id="7777389235-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7777389235-2">(</span><span class="p" data-group-id="7777389235-3">[</span><span class="ss">foo</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">bar</span><span class="p">/</span><span class="mi">0</span><span class="p" data-group-id="7777389235-3">]</span><span class="p" data-group-id="7777389235-2">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">import</span><span class="p" data-group-id="7777389235-4">(</span><span class="ss">m</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7777389235-5">[</span><span class="ss">max</span><span class="p">/</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">not_a_bif</span><span class="p">/</span><span class="mi">0</span><span class="p" data-group-id="7777389235-5">]</span><span class="p" data-group-id="7777389235-4">)</span><span class="p">.</span><span class="w">

</span><span class="nf">foo</span><span class="p" data-group-id="7777389235-6">(</span><span class="p" data-group-id="7777389235-6">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">fun</span><span class="w"> </span><span class="ss">max</span><span class="p">/</span><span class="mi">2</span><span class="p">.</span><span class="w">

</span><span class="nf">bar</span><span class="p" data-group-id="7777389235-7">(</span><span class="p" data-group-id="7777389235-7">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">fun</span><span class="w"> </span><span class="ss">not_a_bif</span><span class="p">/</span><span class="mi">0</span><span class="p">.</span></code></pre><p>The compiler in Erlang/OTP 27 would generate the following messages:</p><pre><code class="text">fun_example.erl:9:5: function not_a_bif/0 undefined
%    9|     fun not_a_bif/0.
%     |     ^

fun_example.erl:3:2: Warning: import directive overrides auto-imported BIF max/2 --
use &quot;-compile({no_auto_import,[max/2]}).&quot; to resolve name clash
%    3| -import(m, [max/2, not_a_bif/0]).
%     |  ^</code></pre><p>That is, there would be a (cryptic) error for <code class="inline">fun not_a_bif/0</code>, but only a warning for <code class="inline">fun max/2</code>.</p><p>When compiling with this release, both attempts to create a fun will result in error messages (as well as a warning):</p><pre><code class="text">fun_example.erl:6:5: creating a fun from imported name max/2 is not allowed
%    6|     fun max/2.
%     |     ^

fun_example.erl:9:5: creating a fun from imported name not_a_bif/0 is not allowed
%    9|     fun not_a_bif/0.
%     |     ^

fun_example.erl:3:2: Warning: import directive overrides auto-imported BIF max/2 --
use &quot;-compile({no_auto_import,[max/2]}).&quot; to resolve name clash
%    3| -import(m, [max/2, not_a_bif/0]).
%     |  ^</code></pre><p>Also, attempting to call a local function having the same name as auto-imported BIF would result in an error if the BIF was added to Erlang/OTP before R14, and a warning for newer BIFs. This has been changed to always emit a warning. For example:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1106182243-1">(</span><span class="ss">bif_example</span><span class="p" data-group-id="1106182243-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1106182243-2">(</span><span class="p" data-group-id="1106182243-3">[</span><span class="ss">bar</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="1106182243-3">]</span><span class="p" data-group-id="1106182243-2">)</span><span class="p">.</span><span class="w">

</span><span class="nf">bar</span><span class="p" data-group-id="1106182243-4">(</span><span class="n">B</span><span class="p" data-group-id="1106182243-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">is_boolean</span><span class="p" data-group-id="1106182243-5">(</span><span class="n">B</span><span class="p" data-group-id="1106182243-5">)</span><span class="p">.</span><span class="w">

</span><span class="nf">is_boolean</span><span class="p" data-group-id="1106182243-6">(</span><span class="n">B</span><span class="p" data-group-id="1106182243-6">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
        </span><span class="n">B</span><span class="w"> </span><span class="o">=:=</span><span class="w"> </span><span class="ss">true</span><span class="w"> </span><span class="ow">orelse</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=:=</span><span class="w"> </span><span class="ss">false</span><span class="p">.</span></code></pre><p>will now result in the following warning instead of an error:</p><pre><code class="text">if_example.erl:5:5: Warning: ambiguous call of overridden auto-imported BIF is_boolean/1 --
use erlang:is_boolean/1 or &quot;-compile({no_auto_import,[is_boolean/1]}).&quot; to resolve name clash
%    5|     is_boolean(B).
%     |     ^</code></pre><p>Own Id: OTP-19432 Aux Id: <a href="https://github.com/erlang/otp/pull/9246" title="">PR-9246</a></p></li><li><p>The compiler’s alias analysis pass is now both faster and less conservative, allowing optimizations of records and binary construction to be applied in more cases.</p><p>Own Id: OTP-19502 Aux Id: <a href="https://github.com/erlang/otp/pull/8695" title="">PR-8695</a></p></li><li><p>BEAM files no longer include a <code class="inline">Meta</code> chunk if there are no features used. That slightly decreases the size of BEAM files, and it also ensures that <code class="inline">m(Module)</code> and <code class="inline">beam_lib:md5(Beam)</code> will match for preloaded modules.</p><p>Own Id: OTP-19524 Aux Id: <a href="https://github.com/erlang/otp/pull/9517" title="">PR-9517</a></p></li><li><p>The license and copyright header has changed format to include an <code class="inline">SPDX-License-Identifier</code>. At the same time, most files have been updated to follow a uniform standard for license headers.</p><p>Own Id: OTP-19575 Aux Id: <a href="https://github.com/erlang/otp/pull/9670" title="">PR-9670</a></p></li><li><p>An  <strong>experimental</strong> API for a native debugger has been added. The main components are the following:</p><ul><li><p>A new compiler option <code class="inline">beam_debug_info</code> for the Erlang compiler. When given, most optimizations are disabled and debug information suitable for the native debugger are added to generated BEAM files.</p></li><li><p>A new <code class="inline">+D</code> emulator flag. When given, the VM becomes &quot;debuggable&quot;, which means that when modules that been compiled with the <code class="inline">beam_debug_info</code> option are loaded, the code is instrumented so that one can enable and disable breakpoints on executable lines.</p></li><li><p>An experimental <code class="inline">erl_debugger</code> module with a new debugging API. Essentially, it allows a single, local, process to be registered as the &quot;debugger&quot; process for the node. This process is the one that will receive messages notifying that a process hit a breakpoint. This way, the front-end implementation of a debugger (such as <a href="https://github.com/WhatsApp/edb">edb from WhatApp</a>) can be decoupled from OTP.</p></li><li><p>The <code class="inline">erl_debugger</code> module also exposes new BIFs to inspect <code class="inline">X</code> and <code class="inline">Y</code> registers of a suspended process. Together with new code-information BIFs, this let's a debugger show the values of variables in scope for a suspended process.</p></li></ul><p>Own Id: OTP-19609 Aux Id: <a href="https://github.com/erlang/otp/pull/8670" title="">PR-8670</a>, <a href="https://github.com/erlang/otp/pull/9334" title="">PR-9334</a>, <a href="https://github.com/erlang/otp/pull/9604" title="">PR-9604</a></p></li></ul><h2 id="compiler-8-6-1" class="section-heading"><a href="#compiler-8-6-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.6.1</span></h2><h3 id="fixed-bugs-and-malfunctions-1" class="section-heading"><a href="#fixed-bugs-and-malfunctions-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix the compiler crash when the inner-most tuple in a nested tuple with 3 layers is updated.</p><p>Own Id: OTP-19561 Aux Id: ERIERL-1208, ERIERL-1210, <a href="https://github.com/erlang/otp/pull/9650" title="">PR-9650</a></p></li></ul><h2 id="compiler-8-6" class="section-heading"><a href="#compiler-8-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.6</span></h2><h3 id="improvements-and-new-features-1" class="section-heading"><a href="#improvements-and-new-features-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The <code class="inline">beam_validator</code> pass in the compiler that validates generated BEAM now does stronger checks for binary syntax matching.</p><p>Own Id: OTP-19449 Aux Id: <a href="https://github.com/erlang/otp/pull/9338" title="">PR-9338</a></p></li></ul><h2 id="compiler-8-5-5" class="section-heading"><a href="#compiler-8-5-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.5.5</span></h2><h3 id="fixed-bugs-and-malfunctions-2" class="section-heading"><a href="#fixed-bugs-and-malfunctions-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Eliminated a bug in the alias analysis pass that could potentially cause unsafe optimizations of binary construction or record updates.</p><p>Own Id: OTP-19455 Aux Id: <a href="https://github.com/erlang/otp/pull/9356" title="">PR-9356</a></p></li></ul><h2 id="compiler-8-5-4" class="section-heading"><a href="#compiler-8-5-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.5.4</span></h2><h3 id="fixed-bugs-and-malfunctions-3" class="section-heading"><a href="#fixed-bugs-and-malfunctions-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a crash in the common sub-expression elimination pass.</p><p>Own Id: OTP-19243 Aux Id: <a href="https://github.com/erlang/otp/issues/8818" title="">GH-8818</a>, <a href="https://github.com/erlang/otp/pull/8838" title="">PR-8838</a></p></li><li><p>Fixed a bug where bogus code was generated for consecutive calls to <code class="inline">erlang:setelement/2</code>, potentially crashing the runtime system.</p><p>Own Id: OTP-19270 Aux Id: <a href="https://github.com/erlang/otp/issues/8783" title="">GH-8783</a>, <a href="https://github.com/erlang/otp/pull/8898" title="">PR-8898</a></p></li><li><p>When the <code class="inline">line_coverage</code> option was used, exceptions could show the wrong line for where the exception was raised.</p><p>Own Id: OTP-19282 Aux Id: <a href="https://github.com/erlang/otp/pull/8907" title="">PR-8907</a></p></li><li><p>The <code class="inline">line_coverage</code> option would be ignored if given in a <code class="inline">compile()</code> attribute within a module.</p><p>Own Id: OTP-19309 Aux Id: <a href="https://github.com/erlang/otp/issues/8942" title="">GH-8942</a>, <a href="https://github.com/erlang/otp/pull/8970" title="">PR-8970</a></p></li><li><p>A segment matching a float in a binary generator will now skip any invalid float (such as a NaN) and continue matching the rest of the binary. Before this correction, the comprehension would stop as soon as an invalid float was encountered.</p><p>Example:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="n">BadFloat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1554068064-1">&lt;&lt;</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">64</span><span class="p" data-group-id="1554068064-1">&gt;&gt;</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="1554068064-2">&lt;&lt;</span><span class="s">&quot;ÿÿÿÿÿÿÿÿ&quot;</span><span class="p" data-group-id="1554068064-2">&gt;&gt;</span><span class="gp unselectable">
2&gt; </span><span class="p" data-group-id="1554068064-3">[</span><span class="n">X</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="p" data-group-id="1554068064-4">&lt;&lt;</span><span class="n">X</span><span class="p">:</span><span class="mi">64</span><span class="o">/</span><span class="nb">float</span><span class="p" data-group-id="1554068064-4">&gt;&gt;</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p" data-group-id="1554068064-5">&lt;&lt;</span><span class="mf">0.0</span><span class="o">/</span><span class="nb">float</span><span class="p">,</span><span class="n">BadFloat</span><span class="o">/</span><span class="ss">binary</span><span class="p">,</span><span class="mf">42.0</span><span class="o">/</span><span class="nb">float</span><span class="p" data-group-id="1554068064-5">&gt;&gt;</span><span class="p" data-group-id="1554068064-3">]</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="1554068064-6">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">42.0</span><span class="p" data-group-id="1554068064-6">]</span></code></pre><p>Own Id: OTP-19331 Aux Id: <a href="https://github.com/erlang/otp/pull/8978" title="">PR-8978</a></p></li></ul><h2 id="compiler-8-5-3" class="section-heading"><a href="#compiler-8-5-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.5.3</span></h2><h3 id="fixed-bugs-and-malfunctions-4" class="section-heading"><a href="#fixed-bugs-and-malfunctions-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In rare circumstances, the destructive tuple update optimization could be applied when it was unsafe.</p><p>Own Id: OTP-19340 Aux Id: <a href="https://github.com/erlang/otp/issues/9014" title="">GH-9014</a>, <a href="https://github.com/erlang/otp/pull/9024" title="">PR-9024</a></p></li><li><p>In rare circumstances involving appending to multiple binaries, the compile could emit unsafe code that would crash the runtime system.</p><p>Own Id: OTP-19374 Aux Id: <a href="https://github.com/erlang/otp/issues/9100" title="">GH-9100</a>, <a href="https://github.com/erlang/otp/pull/9111" title="">PR-9111</a></p></li></ul><h2 id="compiler-8-5-2" class="section-heading"><a href="#compiler-8-5-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.5.2</span></h2><h3 id="fixed-bugs-and-malfunctions-5" class="section-heading"><a href="#fixed-bugs-and-malfunctions-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a crash in an optimization pass relating to appending binaries.</p><p>Own Id: OTP-19168 Aux Id: <a href="https://github.com/erlang/otp/issues/8630" title="">GH-8630</a></p></li><li><p>Fixed a bug in the compiler's alias analysis pass that could make it emit unsafe code.</p><p>Own Id: OTP-19178 Aux Id: <a href="https://github.com/erlang/otp/pull/8686" title="">PR-8686</a></p></li></ul><h2 id="compiler-8-5-1" class="section-heading"><a href="#compiler-8-5-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.5.1</span></h2><h3 id="fixed-bugs-and-malfunctions-6" class="section-heading"><a href="#fixed-bugs-and-malfunctions-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>One of the compiler's optimization passes would get very slow when compiling certain modules. The compiler will now automatically disable that pass for input that would trigger the slowdown.</p><p>Own Id: OTP-19131 Aux Id: <a href="https://github.com/erlang/otp/pull/8567" title="">PR-8567</a></p></li><li><p>Fix <code class="inline">+deterministic</code> to work properly with documentation attributes.</p><p>Own Id: OTP-19142 Aux Id: <a href="https://github.com/erlang/otp/pull/8585" title="">PR-8585</a>, <a href="https://github.com/erlang/otp/issues/8579" title="">GH-8579</a></p></li></ul><h2 id="compiler-8-5" class="section-heading"><a href="#compiler-8-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.5</span></h2><h3 id="fixed-bugs-and-malfunctions-7" class="section-heading"><a href="#fixed-bugs-and-malfunctions-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Generators for binary comprehensions could be evaluated before it was known that they would be needed. That could result in a binary comprehensions failing if a generator that should not be evaluated until later failed.</p><p>As an example, consider this module:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6576815716-1">(</span><span class="ss">t</span><span class="p" data-group-id="6576815716-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6576815716-2">(</span><span class="p" data-group-id="6576815716-3">[</span><span class="ss">f</span><span class="p">/</span><span class="mi">0</span><span class="p" data-group-id="6576815716-3">]</span><span class="p" data-group-id="6576815716-2">)</span><span class="p">.</span><span class="w">

</span><span class="nf">f</span><span class="p" data-group-id="6576815716-4">(</span><span class="p" data-group-id="6576815716-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6576815716-5">&lt;&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="p">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6576815716-6">[</span><span class="p" data-group-id="6576815716-6">]</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6576815716-5">&gt;&gt;</span><span class="p">.</span></code></pre><p>In Erlang/OTP 26 it would fail like so:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">t</span><span class="p">:</span><span class="nf">f</span><span class="p" data-group-id="8593197155-1">(</span><span class="p" data-group-id="8593197155-1">)</span><span class="p">.</span><span class="w">
</span><span class="gt">** exception error: bad generator ok
     in function  t:f/0 (t.erl, line 6)</span></code></pre><p>In Erlang/OTP 27 it returns an empty binary:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">t</span><span class="p">:</span><span class="nf">f</span><span class="p" data-group-id="4119047214-1">(</span><span class="p" data-group-id="4119047214-1">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="4119047214-2">&lt;&lt;</span><span class="p" data-group-id="4119047214-2">&gt;&gt;</span></code></pre><p>Own Id: OTP-18703 Aux Id: <a href="https://github.com/erlang/otp/issues/7494" title="">GH-7494</a>, <a href="https://github.com/erlang/otp/pull/7538" title="">PR-7538</a></p></li><li><p>The documentation for the preprocessor now mentions that <code class="inline">defined(Name)</code> can be called in the condition for an <code class="inline">-if</code> or <code class="inline">-elif</code> directive to test whether <code class="inline">Name</code> is the name of a defined macro. (This feature was implemented in OTP 21.)</p><p>If a function call in an <code class="inline">-if</code> or <code class="inline">-elif</code> with a name that is not the name of a guard BIF, there would not be a compilation error, but would instead cause the lines following the directive to be skipped. This has now been changed to be a compilation error.</p><p><strong><em> POTENTIAL INCOMPATIBILITY </em></strong></p><p>Own Id: OTP-18784 Aux Id: <a href="https://github.com/erlang/otp/issues/7706" title="">GH-7706</a>, <a href="https://github.com/erlang/otp/pull/7726" title="">PR-7726</a></p></li></ul><h3 id="improvements-and-new-features-2" class="section-heading"><a href="#improvements-and-new-features-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The compiler now emits nicer error message for function head mismatches.
For example, given:</p><pre><code class="makeup erlang" translate="no"><span class="nf">a</span><span class="p" data-group-id="3070375075-1">(</span><span class="p" data-group-id="3070375075-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">ok</span><span class="p">;</span><span class="w">
</span><span class="nf">a</span><span class="p" data-group-id="3070375075-2">(</span><span class="p">_</span><span class="p" data-group-id="3070375075-2">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">error</span><span class="p">.</span></code></pre><p>Erlang/OTP 26 and earlier would emit a diagnostic similar to:</p><pre><code class="text">t.erl:6:1: head mismatch
%    6| a(_) -&gt; error.
%     | ^</code></pre><p>while in Erlang/OTP 27 the diagnostic is similar to:</p><pre><code class="text">t.erl:6:1: head mismatch: function a with arities 0 and 1 is regarded as two distinct functions. Is the number of arguments incorrect or is the semicolon in a/0 unwanted?
%    6| a(_) -&gt; error.
%     | ^</code></pre><p>Own Id: OTP-18648 Aux Id: <a href="https://github.com/erlang/otp/pull/7383" title="">PR-7383</a></p></li><li><p>The compiler now optimizes creation of binaries that are known to be constant.</p><p>Consider this example:</p><pre><code class="makeup erlang" translate="no"><span class="nf">bin</span><span class="p" data-group-id="8331213239-1">(</span><span class="p" data-group-id="8331213239-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">char</span><span class="p" data-group-id="8331213239-2">(</span><span class="p" data-group-id="8331213239-2">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8331213239-3">&lt;&lt;</span><span class="n">C</span><span class="p" data-group-id="8331213239-3">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">char</span><span class="p" data-group-id="8331213239-4">(</span><span class="p" data-group-id="8331213239-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="sc">$*</span><span class="p">.</span></code></pre><p>Essentially, the compiler rewrites the example to the slightly more efficient:</p><pre><code class="makeup erlang" translate="no"><span class="nf">bin</span><span class="p" data-group-id="9218454657-1">(</span><span class="p" data-group-id="9218454657-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">char</span><span class="p" data-group-id="9218454657-2">(</span><span class="p" data-group-id="9218454657-2">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9218454657-3">&lt;&lt;</span><span class="sc">$*</span><span class="p" data-group-id="9218454657-3">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">char</span><span class="p" data-group-id="9218454657-4">(</span><span class="p" data-group-id="9218454657-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="sc">$*</span><span class="p">.</span></code></pre><p>Own Id: OTP-18673 Aux Id: <a href="https://github.com/erlang/otp/pull/7474" title="">PR-7474</a>, ERIERL-964</p></li><li><p>The compiler will now merge consecutive updates of the same record.</p><p>As an example, the body of the following function will be combined into a single tuple creation instruction:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7963678576-1">(</span><span class="ss">r</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7963678576-2">{</span><span class="ss">a</span><span class="p">,</span><span class="ss">b</span><span class="p">,</span><span class="ss">c</span><span class="p">,</span><span class="ss">d</span><span class="p" data-group-id="7963678576-2">}</span><span class="p" data-group-id="7963678576-1">)</span><span class="p">.</span><span class="w">

</span><span class="nf">update</span><span class="p" data-group-id="7963678576-3">(</span><span class="n">Value</span><span class="p" data-group-id="7963678576-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">R0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">r</span><span class="p" data-group-id="7963678576-4">{</span><span class="p" data-group-id="7963678576-4">}</span><span class="p">,</span><span class="w">
    </span><span class="n">R1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R0</span><span class="o">#</span><span class="ss">r</span><span class="p" data-group-id="7963678576-5">{</span><span class="ss">a</span><span class="o">=</span><span class="n">Value</span><span class="p" data-group-id="7963678576-5">}</span><span class="p">,</span><span class="w">
    </span><span class="n">R2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R1</span><span class="o">#</span><span class="ss">r</span><span class="p" data-group-id="7963678576-6">{</span><span class="ss">b</span><span class="o">=</span><span class="mi">2</span><span class="p" data-group-id="7963678576-6">}</span><span class="p">,</span><span class="w">
    </span><span class="n">R2</span><span class="o">#</span><span class="ss">r</span><span class="p" data-group-id="7963678576-7">{</span><span class="ss">c</span><span class="o">=</span><span class="mi">3</span><span class="p" data-group-id="7963678576-7">}</span><span class="p">.</span></code></pre><p>Own Id: OTP-18680 Aux Id: <a href="https://github.com/erlang/otp/pull/7491" title="">PR-7491</a>, <a href="https://github.com/erlang/otp/pull/8086" title="">PR-8086</a>, ERIERL-967</p></li><li><p>Improved the performance of the alias analysis pass.</p><p>Own Id: OTP-18714 Aux Id: <a href="https://github.com/erlang/otp/pull/7528" title="">PR-7528</a>, <a href="https://github.com/erlang/otp/issues/7432" title="">GH-7432</a></p></li><li><p><code class="inline">-spec</code> attributes are now used for documentation.</p><p>Own Id: OTP-18801 Aux Id: <a href="https://github.com/erlang/otp/pull/7739" title="">PR-7739</a></p></li><li><p>Native coverage support has been implemented in the JIT. It will  automatically be used by the <a href="../../apps/tools/cover.html"><code class="inline">cover</code></a> tool to reduce the execution overhead when running cover-compiled code.</p><p>There are also new APIs to support native coverage without using the <code class="inline">cover</code> tool.</p><p>To instrument code for native coverage it must be compiled with the <a href="compile.html#line_coverage"><code class="inline">line_coverage</code></a> option.</p><p>To enable native coverage in the runtime system, start it like so:</p><pre><code class="text">$ erl +JPcover true</code></pre><p>There are also the following new functions for supporting native coverage:</p><ul><li><a href="../../apps/kernel/code.html#coverage_support/0"><code class="inline">code:coverage_support/0</code></a></li><li><a href="../../apps/kernel/code.html#get_coverage/2"><code class="inline">code:get_coverage/2</code></a></li><li><a href="../../apps/kernel/code.html#reset_coverage/1"><code class="inline">code:reset_coverage/1</code></a></li><li><a href="../../apps/kernel/code.html#get_coverage_mode/0"><code class="inline">code:get_coverage_mode/0</code></a></li><li><a href="../../apps/kernel/code.html#get_coverage_mode/1"><code class="inline">code:get_coverage_mode/1</code></a></li><li><a href="../../apps/kernel/code.html#set_coverage_mode/1"><code class="inline">code:set_coverage_mode/1</code></a></li></ul><p>Own Id: OTP-18856 Aux Id: <a href="https://github.com/erlang/otp/pull/7856" title="">PR-7856</a></p></li><li><p><a href="https://www.erlang.org/eeps/eep-0059">EEP-59 - Documentation Attributes</a> has been implemented.</p><p>Documentation attributes can be used to document functions, types, callbacks, and modules.
The keyword <code class="inline">-moduledoc &quot;Documentation here&quot;.</code> is used to document modules, while <code class="inline">-doc &quot;Documentation here&quot;.</code> can be used on top of functions, types, and callbacks to document them, respectively.</p><ul><li><p>Types, callbacks, and function documentation can be set to <code class="inline">hidden</code> either via <code class="inline">-doc false</code> or <code class="inline">-doc hidden</code>. When documentation attributes mark a type as hidden, they will not be part of the documentation.</p></li><li><p>The documentation from <code class="inline">moduledoc</code> and <code class="inline">doc</code> gets added by default to the binary beam file, following the format of <a href="https://www.erlang.org/eeps/eep-0048">EEP-48</a>.</p></li><li><p>Using the compiler flag <code class="inline">warn_missing_doc</code> will raise a warning when
<code class="inline">-doc</code> attributes are missing in exported functions, types, and callbacks.</p></li><li><p>Using the compiler flag <code class="inline">warn_missing_spec_documented</code> will raise a warning when
spec attributes are missing in documented functions, types, and callbacks.</p></li><li><p><code class="inline">moduledoc</code>s and <code class="inline">doc</code>s may refer to external files to be embedded, such as <code class="inline">-doc {file, &quot;README.md&quot;}.</code>, which refers to the file <code class="inline">README.md</code> found in the current working directory.</p></li><li><p>The compiler warns about exported functions whose specs refer to hidden types. Thus, there will be warnings when a hidden type (meaning, the type is not part of the documentation) gets used in an exported function.</p></li></ul><p>Own Id: OTP-18916 Aux Id: <a href="https://github.com/erlang/otp/pull/7936" title="">PR-7936</a></p></li><li><p>The documentation has been migrated to use Markdown and ExDoc.</p><p>Own Id: OTP-18955 Aux Id: <a href="https://github.com/erlang/otp/pull/8026" title="">PR-8026</a></p></li><li><p>The order in which the compiler looks up options has changed.</p><p>When there is a conflict in the compiler options given in the <code class="inline">-compile()</code> attribute and options given to the compiler, the options given in the <code class="inline">-compile()</code> attribute overrides the option given to the compiler, which in turn overrides options given in the <code class="inline">ERL_COMPILER_OPTIONS</code> environment variable.</p><p>Example:</p><p>If  <code class="inline">some_module.erl</code> has the following attribute:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">compile</span><span class="p" data-group-id="8190770212-1">(</span><span class="p" data-group-id="8190770212-2">[</span><span class="ss">nowarn_missing_spec</span><span class="p" data-group-id="8190770212-2">]</span><span class="p" data-group-id="8190770212-1">)</span><span class="p">.</span></code></pre><p>and the compiler is invoked like so:</p><pre><code class="text">% erlc +warn_missing_spec some_module.erl</code></pre><p>no warnings will be issued for functions that do not have any specs.</p><p><strong><em> POTENTIAL INCOMPATIBILITY </em></strong></p><p>Own Id: OTP-18968 Aux Id: <a href="https://github.com/erlang/otp/issues/6979" title="">GH-6979</a>, <a href="https://github.com/erlang/otp/pull/8093" title="">PR-8093</a></p></li><li><p>Safe destructive update of tuples has been implemented in the compiler and runtime system. This allows the VM to update tuples in-place when it is safe to do so, thus improving performance by doing less copying but also by producing less garbage.</p><p>Example:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9028255128-1">(</span><span class="ss">rec</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9028255128-2">{</span><span class="ss">a</span><span class="p">,</span><span class="ss">b</span><span class="p">,</span><span class="ss">c</span><span class="p" data-group-id="9028255128-2">}</span><span class="p" data-group-id="9028255128-1">)</span><span class="p">.</span><span class="w">

</span><span class="nf">update</span><span class="p" data-group-id="9028255128-3">(</span><span class="o">#</span><span class="ss">rec</span><span class="p" data-group-id="9028255128-4">{</span><span class="ss">a</span><span class="o">=</span><span class="ss">needs_update</span><span class="p">,</span><span class="ss">b</span><span class="o">=</span><span class="n">N</span><span class="p" data-group-id="9028255128-4">}</span><span class="o">=</span><span class="n">R0</span><span class="p" data-group-id="9028255128-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R0</span><span class="o">#</span><span class="ss">rec</span><span class="p" data-group-id="9028255128-5">{</span><span class="ss">a</span><span class="o">=</span><span class="ss">up_to_date</span><span class="p" data-group-id="9028255128-5">}</span><span class="p">,</span><span class="w">
    </span><span class="k">if</span><span class="w">
        </span><span class="n">N</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">R</span><span class="o">#</span><span class="ss">rec</span><span class="p" data-group-id="9028255128-6">{</span><span class="ss">c</span><span class="o">=</span><span class="ss">negative</span><span class="p" data-group-id="9028255128-6">}</span><span class="p">;</span><span class="w">
        </span><span class="n">N</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">R</span><span class="o">#</span><span class="ss">rec</span><span class="p" data-group-id="9028255128-7">{</span><span class="ss">c</span><span class="o">=</span><span class="ss">zero</span><span class="p" data-group-id="9028255128-7">}</span><span class="p">;</span><span class="w">
        </span><span class="n">N</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">R</span><span class="o">#</span><span class="ss">rec</span><span class="p" data-group-id="9028255128-8">{</span><span class="ss">c</span><span class="o">=</span><span class="ss">positive</span><span class="p" data-group-id="9028255128-8">}</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span></code></pre><p>The record updates in each of the three clauses of the <code class="inline">if</code> can safely be done in-place, because variable <code class="inline">R</code> is not used again.</p><p>Own Id: OTP-18972 Aux Id: <a href="https://github.com/erlang/otp/pull/8090" title="">PR-8090</a></p></li><li><p>Improved the match context reuse optimization slightly, allowing match contexts to be passed as-is to <a href="../../apps/erts/erlang.html#bit_size/1"><code class="inline">bit_size/1</code></a> and <a href="../../apps/erts/erlang.html#byte_size/1"><code class="inline">byte_size/1</code></a>.</p><p>Own Id: OTP-18987</p></li><li><p><a href="../../apps/stdlib/erl_lint.html"><code class="inline">erl_lint</code></a> (and by extension the <a href="compile.html"><code class="inline">compiler</code></a>) will now warn for code using deprecated callbacks.</p><p>The only callback currenly deprecated is <code class="inline">format_status/2</code> in <a href="../../apps/stdlib/gen_server.html#c:format_status/2"><code class="inline">gen_server</code></a>, <a href="../../apps/stdlib/gen_event.html#c:format_status/2"><code class="inline">gen_event</code></a> and <a href="../../apps/stdlib/gen_server.html#c:format_status/2"><code class="inline">gen_statem</code></a>.</p><p>You can use <code class="inline">nowarn_deprecated_callback</code> to silence the warning.</p><p>Own Id: OTP-19010 Aux Id: <a href="https://github.com/erlang/otp/pull/8205" title="">PR-8205</a></p></li></ul><h2 id="compiler-8-4-3-3" class="section-heading"><a href="#compiler-8-4-3-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.4.3.3</span></h2><h3 id="fixed-bugs-and-malfunctions-8" class="section-heading"><a href="#fixed-bugs-and-malfunctions-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix a bug where unloaded nifs can crash the compiler.</p><p>Own Id: OTP-19600 Aux Id: PR-9737, GH-9715</p></li></ul><h2 id="compiler-8-4-3-2" class="section-heading"><a href="#compiler-8-4-3-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.4.3.2</span></h2><h3 id="fixed-bugs-and-malfunctions-9" class="section-heading"><a href="#fixed-bugs-and-malfunctions-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug where bogus code was generated for consecutive calls to erlang:setelement/2, potentially crashing the emulator.</p><p>Own Id: OTP-19270 Aux Id: GH-8783 PR-8898</p></li></ul><h2 id="compiler-8-4-3-1" class="section-heading"><a href="#compiler-8-4-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.4.3.1</span></h2><h3 id="fixed-bugs-and-malfunctions-10" class="section-heading"><a href="#fixed-bugs-and-malfunctions-10" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a crash in an optimization pass relating to appending binaries.</p><p>Own Id: OTP-19168 Aux Id: GH-8630</p></li><li><p>Fixed a bug in the compiler's alias analysis pass that could make it emit unsafe code.</p><p>Own Id: OTP-19178 Aux Id: PR-8686</p></li></ul><h2 id="compiler-8-4-3" class="section-heading"><a href="#compiler-8-4-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.4.3</span></h2><h3 id="fixed-bugs-and-malfunctions-11" class="section-heading"><a href="#fixed-bugs-and-malfunctions-11" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In rare circumstances, the compiler code generate unsafe code for a bit syntax match.</p><p>Own Id: OTP-19019</p></li><li><p>In rare circumstances, binary matches that were supposed to succeed failed.</p><p>Own Id: OTP-19035 Aux Id: GH-8280, PR-8284</p></li><li><p>Fixed a bug where a fun's environment could be overridden by an argument if all of the following conditions were met:</p><ul><li>The fun was declared in the module that called it.</li><li>The fun's target was statically known.</li><li>The fun was called with a number of extra arguments equal to the number of environment variables.</li></ul><p>Own Id: OTP-19045 Aux Id: GH-8316</p></li></ul><h2 id="compiler-8-4-2" class="section-heading"><a href="#compiler-8-4-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.4.2</span></h2><h3 id="fixed-bugs-and-malfunctions-12" class="section-heading"><a href="#fixed-bugs-and-malfunctions-12" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In rare circumstances, an unsafe optimization could cause the compiler to generate incorrect code for list matching.</p><p>Own Id: OTP-19003 Aux Id: GH-8187, PR-8189</p></li></ul><h3 id="improvements-and-new-features-3" class="section-heading"><a href="#improvements-and-new-features-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Fix the compilation server to restart if the applications in its lib dir changes inbetween <code class="inline">erlc</code> invokations.</p><p>Own Id: OTP-18936</p></li></ul><h2 id="compiler-8-4-1" class="section-heading"><a href="#compiler-8-4-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.4.1</span></h2><h3 id="fixed-bugs-and-malfunctions-13" class="section-heading"><a href="#fixed-bugs-and-malfunctions-13" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler could become extremely slow for modules containing huge
functions.</p><p>Own Id: OTP-18770 Aux Id: GH-7667, PR-7672</p></li></ul><h2 id="compiler-8-4" class="section-heading"><a href="#compiler-8-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.4</span></h2><h3 id="fixed-bugs-and-malfunctions-14" class="section-heading"><a href="#fixed-bugs-and-malfunctions-14" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler could run forever when compiling a call to
<a href="../../apps/erts/erlang.html#is_record/3"><code class="inline">is_record/3</code></a> with a huge positive tuple size. The call
<a href="../../apps/erts/erlang.html#is_record/3"><code class="inline">is_record(A, a, 0)</code></a> would crash the compiler when used in a
function body. When used in a guard the compiler would emit incorrect code
that would accept <code class="inline">{a&gt;</code> as a record.</p><p>Own Id: OTP-18605 Aux Id: GH-7298, GH-7317</p></li><li><p>Fixed a bug that caused dialyzer to crash when analyzing bogus code that
contained the literal atom <code class="inline">undefined</code> in segment sizes.</p><p>Own Id: OTP-18629 Aux Id: GH-7325</p></li><li><p>The compiler would crash when compiling some modules that contained a call to
<a href="../../apps/erts/erlang.html#load_nif/2"><code class="inline">erlang:load_nif/2</code></a>.</p><p>Own Id: OTP-18662 Aux Id: GH-7409, PR-7416</p></li><li><p>Fixed a bug that caused the compiler to crash on legal code.</p><p>Own Id: OTP-18678 Aux Id: GH-7488</p></li><li><p>The compiler could crash when attempting to compile a call to
<a href="../../apps/erts/erlang.html#is_list/1"><code class="inline">is_list/1</code></a> in a complex expression.</p><p>Own Id: OTP-18689 Aux Id: GH-7504, PR-7518</p></li><li><p>A complex guard expression using the <code class="inline">or</code> operator could succeed when it was
supposed to fail.</p><p>Own Id: OTP-18692 Aux Id: GH-7517, PR-7519</p></li><li><p>Compiling nested <code class="inline">try</code>/<code class="inline">catch</code> and <code class="inline">catch</code> expression could result in an
internal compiler error.</p><p>Own Id: OTP-18701 Aux Id: GH-7477, PR-7532</p></li><li><p>Using the <code class="inline">bnot</code> operator in a complex expression could cause the compiler to
terminate with an internal consistency failure diagnostic.</p><p>Own Id: OTP-18719 Aux Id: GH-7468, PR-7562</p></li><li><p>Fixed a bug that caused the compiler to crash in a binary optimization pass.</p><p>Own Id: OTP-18721 Aux Id: PR-7527</p></li><li><p>The compiler could terminate with an internal error when attempting to compile
a binary pattern that could not possibly match.</p><p>Own Id: OTP-18725 Aux Id: GH-7467</p></li></ul><h3 id="improvements-and-new-features-4" class="section-heading"><a href="#improvements-and-new-features-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Fixed various performance issues related to the alias optimization pass.</p><p>Own Id: OTP-18691 Aux Id: PR-7448</p></li></ul><h2 id="compiler-8-3-2" class="section-heading"><a href="#compiler-8-3-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.3.2</span></h2><h3 id="fixed-bugs-and-malfunctions-15" class="section-heading"><a href="#fixed-bugs-and-malfunctions-15" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a type handling bug that would cause an internal consistence failure for
correct code.</p><p>Own Id: OTP-18625 Aux Id: GH-7354</p></li><li><p>Fixed a bug that could cause the stack trace of <code class="inline">throw</code> exceptions to be
erroneously optimized out.</p><p>Own Id: OTP-18626 Aux Id: GH-7356</p></li><li><p>Complex guard expression using '<code class="inline">or</code>' were not always fully evaluated, making
guards that were supposed to fail succeed.</p><p>Own Id: OTP-18634 Aux Id: GH-7370</p></li></ul><h2 id="compiler-8-3-1" class="section-heading"><a href="#compiler-8-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.3.1</span></h2><h3 id="fixed-bugs-and-malfunctions-16" class="section-heading"><a href="#fixed-bugs-and-malfunctions-16" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug where a failing <code class="inline">bsl</code> expression in a guard threw an exception
instead of causing the guard to fail.</p><p>Own Id: OTP-18576</p></li><li><p>Fixed a bug that would case the validator to reject legal code.</p><p>Own Id: OTP-18581 Aux Id: GH-7251</p></li><li><p>The compiler could re-order clauses matching binaries so that the incorrect
clause would match. That could only happen for code that used the option
<code class="inline">{error_location,line}</code> or for code without line or column number information
(e.g. generated by a parse transform).</p><p>Own Id: OTP-18583 Aux Id: GH-7259</p></li><li><p>Complex guard expression using the <code class="inline">or</code> operator and guard BIFs that can fail
could sometimes be miscompiled so that the guard would succeed even if a call
to a guard BIF failed.</p><p>Own Id: OTP-18593 Aux Id: GH-7252</p></li><li><p>With optimizations disabled, a <code class="inline">try</code>/<code class="inline">catch</code> construct could return an
incorrect value.</p><p>Own Id: OTP-18600 Aux Id: GH-7248</p></li><li><p>In rare circumstance, a combination of binary construction and
<a href="../../apps/erts/erlang.html#binary_part/3"><code class="inline">binary_part/3</code></a> would cause the compiler to generate unsafe
code that would crash the runtime system.</p><p>Own Id: OTP-18601</p></li><li><p>The compiler could be very slow when compiling guards with multiple guard
tests separated with '<code class="inline">or</code>' or '<code class="inline">;</code>'.</p><p>Own Id: OTP-18617 Aux Id: GH-7338</p></li><li><p>Complex guard expressions using '<code class="inline">or</code>' and map updates could succeed even if
the map update failed.</p><p>Own Id: OTP-18619 Aux Id: GH-7339</p></li></ul><h2 id="compiler-8-3" class="section-heading"><a href="#compiler-8-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.3</span></h2><h3 id="fixed-bugs-and-malfunctions-17" class="section-heading"><a href="#fixed-bugs-and-malfunctions-17" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler would silently accept singleton (unbound) type variables in a
union type. Starting from Erlang/OTP 26, the compiler will generate a warning
for this example. The warning can be disabled using the
<code class="inline">nowarn_singleton_typevar</code> option. In Erlang/OTP 27, the warning will become
an error.</p><p>Own Id: OTP-18389 Aux Id: GH-6508, PR-6864, GH-7116</p></li></ul><h3 id="improvements-and-new-features-5" class="section-heading"><a href="#improvements-and-new-features-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Optimized record updates.</p><p>Own Id: OTP-18126 Aux Id: PR-6033</p></li><li><p>There are several new optimization for binary syntax in the JIT:</p><ul><li>Creation and matching of binaries with segments of fixed sizes have been
optimized.</li><li>Creation and matching of UTF-8 segments have been optimized.</li><li>Appending to binaries has been optimized.</li></ul><p>Own Id: OTP-18137 Aux Id: PR-6259, PR-6404, PR-6576, PR-6804</p></li><li><p>The compiler and JIT now generate better code for creation of small maps where
all keys are literals known at compile time.</p><p>Own Id: OTP-18185 Aux Id: GH-6139</p></li><li><p>A limitation in the binary syntax has been removed. It is now possible to
match binary patterns in parallel. Example: <code class="inline">&lt;&lt;A:8&gt;&gt; = &lt;&lt;B:4,C:4&gt;&gt; = Bin</code></p><p>Own Id: OTP-18297 Aux Id: GH-6348</p></li><li><p>It is documented that <code class="inline">$\^X</code> is the ASCII code for Control X, where X is an
uppercase or lowercase letter. However, this notation would work for any
character X, even then it didn't make sense.</p><p>In Erlang/OTP 26, it is now documented that the following characters are also
allowed to follow the <code class="inline">\^</code> characters: <code class="inline">@</code>, <code class="inline">[</code>, <code class="inline">\</code>, <code class="inline">]</code>, <code class="inline">^</code>, <code class="inline">_</code>, and <code class="inline">?</code>.
Attempt to use other characters will be rejected with a compiler error.</p><p>The value for <code class="inline">$\^?</code> is now 127 (instead of 31 as in earlier releases).</p><p>Own Id: OTP-18337 Aux Id: GH-6477, PR-6503</p></li><li><p>The BIFs <a href="../../apps/erts/erlang.html#min/2"><code class="inline">min/2</code></a> and <a href="../../apps/erts/erlang.html#max/2"><code class="inline">max/2</code></a> are now allowed to be used
in guards and match specs.</p><p>Own Id: OTP-18367 Aux Id: GH-6544</p></li><li><p>Map comprehensions as suggested in EEP 58 has now been implemented.</p><p>Own Id: OTP-18413 Aux Id: EEP-58, PR-6727</p></li><li><p>Improved the selective receive optimization, which can now be enabled for
references returned from other functions.</p><p>This greatly improves the performance of <code class="inline">gen_server:send_request/3</code>,
<a href="../../apps/stdlib/gen_server.html#wait_response/2"><code class="inline">gen_server:wait_response/2</code></a>, and similar functions.</p><p>Own Id: OTP-18431 Aux Id: PR-6739</p></li><li><p>Deprecates <code class="inline">dbg:stop_clear/0</code> because it is simply a function alias to
<a href="../../apps/runtime_tools/dbg.html#stop/0"><code class="inline">dbg:stop/0</code></a></p><p>Own Id: OTP-18478 Aux Id: GH-6903</p></li><li><p>The compiler will now inline calls to <a href="../../apps/stdlib/maps.html#get/3"><code class="inline">maps:get/3</code></a>.</p><p>Own Id: OTP-18502</p></li><li><p>In Erlang/OTP 27, <code class="inline">0.0</code> will no longer be considered to be exactly equal to
<code class="inline">-0.0</code>. See
<a href="../../upcoming_incompatibilities.html#float_matching">Upcoming Potential Incompatibilities</a>.</p><p>Own Id: OTP-18574</p></li></ul><h2 id="compiler-8-2-6-4" class="section-heading"><a href="#compiler-8-2-6-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.2.6.4</span></h2><h3 id="fixed-bugs-and-malfunctions-18" class="section-heading"><a href="#fixed-bugs-and-malfunctions-18" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In rare circumstances, an unsafe optimization could cause the compiler to generate incorrect code for list matching.</p><p>Own Id: OTP-19003 Aux Id: GH-8187, PR-8189</p></li><li><p>In rare circumstances, the compiler code generate unsafe code for a bit syntax match.</p><p>Own Id: OTP-19019</p></li></ul><h2 id="compiler-8-2-6-3" class="section-heading"><a href="#compiler-8-2-6-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.2.6.3</span></h2><h3 id="fixed-bugs-and-malfunctions-19" class="section-heading"><a href="#fixed-bugs-and-malfunctions-19" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug that could cause the stack trace of <code class="inline">throw</code> exceptions to be
erroneously optimized out.</p><p>Own Id: OTP-18626 Aux Id: GH-7356</p></li></ul><h2 id="compiler-8-2-6-2" class="section-heading"><a href="#compiler-8-2-6-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.2.6.2</span></h2><h3 id="fixed-bugs-and-malfunctions-20" class="section-heading"><a href="#fixed-bugs-and-malfunctions-20" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler could be very slow when compiling guards with multiple guard
tests separated with '<code class="inline">or</code>' or '<code class="inline">;</code>'.</p><p>Own Id: OTP-18617 Aux Id: GH-7338</p></li></ul><h2 id="compiler-8-2-6-1" class="section-heading"><a href="#compiler-8-2-6-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.2.6.1</span></h2><h3 id="fixed-bugs-and-malfunctions-21" class="section-heading"><a href="#fixed-bugs-and-malfunctions-21" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug where a failing <code class="inline">bsl</code> expression in a guard threw an exception
instead of causing the guard to fail.</p><p>Own Id: OTP-18576</p></li><li><p>Complex guard expression using the <code class="inline">or</code> operator and guard BIFs that can fail
could sometimes be miscompiled so that the guard would succeed even if a call
to a guard BIF failed.</p><p>Own Id: OTP-18593 Aux Id: GH-7252</p></li></ul><h2 id="compiler-8-2-6" class="section-heading"><a href="#compiler-8-2-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.2.6</span></h2><h3 id="fixed-bugs-and-malfunctions-22" class="section-heading"><a href="#fixed-bugs-and-malfunctions-22" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed type handling bugs that could cause an internal error in the compiler
for correct code.</p><p>Own Id: OTP-18565 Aux Id: GH-7147</p></li></ul><h2 id="compiler-8-2-5" class="section-heading"><a href="#compiler-8-2-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.2.5</span></h2><h3 id="fixed-bugs-and-malfunctions-23" class="section-heading"><a href="#fixed-bugs-and-malfunctions-23" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>When a map update such as <code class="inline">#{}#{key:=value}</code> that should fail with an
exception was unused, the exception would be lost.</p><p>Own Id: OTP-18497 Aux Id: GH-6960, PR-6965</p></li><li><p>Fixed bug in the validator that made it reject valid code.</p><p>Own Id: OTP-18516 Aux Id: GH-6969</p></li></ul><h2 id="compiler-8-2-4" class="section-heading"><a href="#compiler-8-2-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.2.4</span></h2><h3 id="fixed-bugs-and-malfunctions-24" class="section-heading"><a href="#fixed-bugs-and-malfunctions-24" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug that would cause the compiler to hang.</p><p>Own Id: OTP-18378 Aux Id: GH-6604</p></li><li><p>Fixed a crash when compiling code that contained <code class="inline">maybe</code> expressions.</p><p>Own Id: OTP-18381 Aux Id: GH-6601</p></li><li><p>Constructing a binary with an explicit size of <code class="inline">all</code> for a binary segment
would crash the compiler.</p><p>Own Id: OTP-18407 Aux Id: GH-6707</p></li><li><p>The compiler would generate incorrect code for the following type of
expression:</p><p><code class="inline">Pattern = BoundVar1 = . . . = BoundVarN = Expression</code></p><p>An exception should be raised if any of the bound variables have different
values than <code class="inline">Expression</code>. The compiler would generate code that would cause
the bound variables to be bound to the value of <code class="inline">Expression</code>whether the value
matched or not.</p><p>Own Id: OTP-18470 Aux Id: GH-6873, PR-6877</p></li></ul><h2 id="compiler-8-2-3" class="section-heading"><a href="#compiler-8-2-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.2.3</span></h2><h3 id="fixed-bugs-and-malfunctions-25" class="section-heading"><a href="#fixed-bugs-and-malfunctions-25" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug that could cause legal code to fail validation.</p><p>Own Id: OTP-18365</p></li><li><p>Eliminated a rare crash in the <code class="inline">beam_types</code> module.</p><p>Own Id: OTP-18368</p></li></ul><h2 id="compiler-8-2-2" class="section-heading"><a href="#compiler-8-2-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.2.2</span></h2><h3 id="fixed-bugs-and-malfunctions-26" class="section-heading"><a href="#fixed-bugs-and-malfunctions-26" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Line number in compiler messages would be truncated to 4 digits for line
numbers greater than 9999.</p><p>Own Id: OTP-18268 Aux Id: GH-6332</p></li><li><p>In rare circumstance, matching a binary as part of a <code class="inline">receive</code> clause could
cause the compiler to terminate because of an internal consistency check
failure.</p><p>Own Id: OTP-18273 Aux Id: GH-6341</p></li><li><p>Compiling a function with complex bit syntax matching such as
<code class="inline">f(&lt;&lt;X:0, _:X&gt;&gt;, &lt;&lt;Y:0, _:Y&gt;&gt;) -&gt; ok.</code> could crash the compiler.</p><p>Own Id: OTP-18308 Aux Id: GH-6426</p></li><li><p>It is not allowed to call functions from guards. The compiler failed to reject
a call in a guard when done by constructing a record with a default
initialization expression that called a function.</p><p>Own Id: OTP-18325 Aux Id: GH-6465, GH-6466</p></li><li><p>The compiler could crash when using a record with complex field initialization
expression as a filter in a list comprehension.</p><p>Own Id: OTP-18336 Aux Id: GH-6501, PR-6502</p></li></ul><h2 id="compiler-8-2-1" class="section-heading"><a href="#compiler-8-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-27" class="section-heading"><a href="#fixed-bugs-and-malfunctions-27" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler will now forbid using the empty atom <code class="inline">''</code> as module name. Also
forbidden are modules names containing control characters, and module names
containing only spaces and soft hyphens.</p><p>Own Id: OTP-18125 Aux Id: GH-6026</p></li><li><p>The <code class="inline">bin_opt_info</code> and <code class="inline">recv_opt_info</code> options would cause the compiler to
crash when attempting to compile generated code without location information.</p><p>Own Id: OTP-18162 Aux Id: PR-6102</p></li><li><p>In rare circumstances involving floating point operations, the compiler could
terminate with an internal consistency check failure.</p><p>Own Id: OTP-18182 Aux Id: GH-6163</p></li><li><p>In rare circumstances when doing arithmetic instructions on non-numbers, the
compiler could crash.</p><p>Own Id: OTP-18183 Aux Id: GH-6169</p></li><li><p>In rare circumstances, complex boolean expressions in nested cases could cause
the compiler to crash.</p><p>Own Id: OTP-18184 Aux Id: GH-6164</p></li><li><p>Expression similar to <code class="inline">#{assoc:=V} = #key=&gt;self()}, V</code> would return the empty
map instead of raising an exception.</p><p>Own Id: OTP-18186</p></li><li><p>Eliminated a crash in the <code class="inline">beam_ssa_bool</code> pass of the compiler when compiling
a complex guard expression.</p><p>Own Id: OTP-18187 Aux Id: GH-6184</p></li><li><p>In rare circumstances, the compiler could crash with an internal consistency
check failure.</p><p>Own Id: OTP-18202 Aux Id: GH-6222</p></li><li><p>When compiling with the option <code class="inline">inline_list_funcs</code>, the compiler could produce
a nonsensical warning.</p><p>Own Id: OTP-18214 Aux Id: GH-6158</p></li><li><p>When given the <code class="inline">no_ssa_opt</code> option, the compiler could terminate with an
internal consistency failure diagnostic when compiling map matching.</p><p>Own Id: OTP-18234 Aux Id: GH-6277</p></li></ul><h3 id="improvements-and-new-features-6" class="section-heading"><a href="#improvements-and-new-features-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Made warnings for existing atoms being keywords in experimental features more
precise, by not warning about quoted atoms.</p><p>Own Id: OTP-18050</p></li><li><p>There is a new configure option, <code class="inline">--enable-deterministic-build</code>, which will
apply the <code class="inline">deterministic</code> compiler option when building Erlang/OTP. The
<code class="inline">deterministic</code> option has been improved to eliminate more sources of
non-determinism in several applications.</p><p>Own Id: OTP-18165 Aux Id: PR-5965</p></li></ul><h2 id="compiler-8-2" class="section-heading"><a href="#compiler-8-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.2</span></h2><h3 id="fixed-bugs-and-malfunctions-28" class="section-heading"><a href="#fixed-bugs-and-malfunctions-28" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A subtle bug regarding variable scoping has been corrected. Consider this
example:</p><p><code class="inline">(A=1) + fun() -&gt; A = 2() end</code></p><p>In the shell, the expression correctly evaluates to <code class="inline">3</code>. In compiled code, it
raised a <code class="inline">{badmatch, 2}</code> exception.</p><p>Own Id: OTP-17810 Aux Id: GH-5379</p></li><li><p>Fixed a rare bug that would crash the compiler during type optimization.</p><p>Own Id: OTP-17820</p></li><li><p>Starting in OTP 24, when a fun was created and immediately used, it would be
inlined. An unintended consequence of the inlining was that what would be a
<code class="inline">function_clause</code> exception without the inlining would now be a rather
confusing <code class="inline">case_clause</code> exception. This has been corrected, so that
<code class="inline">function_clause</code> exceptions remain <code class="inline">function_clause</code> exceptions in inlined
code.</p><p>Own Id: OTP-17860 Aux Id: GH-5513, OTP-17226</p></li><li><p>If a default record field initialization (<code class="inline">_ = Expr</code>) was used even though all
records fields were explicitly initialized, <code class="inline">Expr</code> would not be evaluated.
That would not be a problem, except when <code class="inline">Expr</code> would bind a variable
subsequently used, in which case the compiler would crash.</p><p>As an example, if record <code class="inline">#r{}</code> is defined to have only one field <code class="inline">a</code>, the
following code would crash the compiler:</p><p><code class="inline">#r{a=[],_=V=42}, V</code></p><p>To fix that problem, the compiler will make sure that <code class="inline">Expr</code> is always
evaluated at least once. The compiler will now rewrite the example to
essentially:</p><p><code class="inline">V=42, #r{a=[]}, V</code></p><p>Own Id: OTP-18083</p></li></ul><h3 id="improvements-and-new-features-7" class="section-heading"><a href="#improvements-and-new-features-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>To enable more optimizations, BEAM files compiled with OTP 21 and earlier
cannot be loaded in OTP 25.</p><p>Own Id: OTP-16702</p></li><li><p>Added support for the compile attribute <code class="inline">-nifs()</code> to empower compiler and
loader with information about which functions may be overridden as NIFs by
<a href="../../apps/erts/erlang.html#load_nif/2"><code class="inline">erlang:load_nif/2</code></a>. It is recommended to use this attribute in all modules
that load NIF libraries.</p><p>Own Id: OTP-17151 Aux Id: ERIERL-590, PR-5479</p></li><li><p>When binary construction using the binary syntax fails, the error message
printed in the shell and by <code class="inline">erl_error:format_exception/3,4</code> will contain more
detailed information about what went wrong.</p><p>Own Id: OTP-17504 Aux Id: GH-4971, PR-5281, PR-5752</p></li><li><p>The Erlang compiler now includes type information in BEAM files, and the JIT
can now use that type information to do optimizations such as eliminating or
simplifying type tests.</p><p>Own Id: OTP-17684 Aux Id: PR-5316, PR-5664</p></li><li><p>Improved the JIT's support for external tools like <code class="inline">perf</code> and <code class="inline">gdb</code>, allowing
them to show line numbers and even the original Erlang source code when that
can be found.</p><p>To aid them in finding the source code, the <code class="inline">absolute_path</code> compiler option
has been added to embed the absolute file path of a module.</p><p>Own Id: OTP-17685</p></li><li><p>The <code class="inline">maybe</code> ... <code class="inline">end</code> construction proposed in EEP-49 has been implemented. It
can simplify complex code where otherwise deeply nested cases would have to be
used.</p><p>To enable <code class="inline">maybe</code>, give the option <code class="inline">-enable-feature maybe_expr</code> to <code class="inline">erlc</code> or
add <code class="inline">-feature(maybe_expr, enable).</code> inside the module.</p><p>Own Id: OTP-17705 Aux Id: PR-5411</p></li><li><p>When a record matching or record update fails, a
<code class="inline">{badrecord,ExpectedRecordTag}</code> exception used to be raised. In this release,
the exception has been changed to <code class="inline">{badrecord,ActualValue}</code>, where
<code class="inline">ActualValue</code> is the actual that was found instead of the expected record.</p><p>Own Id: OTP-17841 Aux Id: PR-5694</p></li><li><p>Improved optimization of try/catch expressions.</p><p>Own Id: OTP-17842</p></li><li><p>The <code class="inline">beam_trim</code> pass of the compiler could be extremely slow for huge
straight-line functions. It will now compile such functions much faster (down
to seconds from minutes for some huge functions).</p><p>Own Id: OTP-17885 Aux Id: GH-5140</p></li><li><p>Added support for configurable features as described in EEP-60. Features can
be enabled/disabled during compilation with options
(<code class="inline">-enable-feature Feature</code>, <code class="inline">-disable-feature Feature</code> and
<code class="inline">+{feature, Feature, enable|disable}</code>) to <code class="inline">erlc</code> as well as with directives
(<code class="inline">-feature(Feature, enable|disable).</code>) in the file. Similar options can be
used to <code class="inline">erl</code> for enabling/disabling features allowed at runtime. The new
<code class="inline">maybe</code> expression (EEP-49) is fully supported as the feature <code class="inline">maybe_expr</code>.
The features support is documented in the reference manual.</p><p>Own Id: OTP-17988</p></li></ul><h2 id="compiler-8-1-1-6" class="section-heading"><a href="#compiler-8-1-1-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.1.1.6</span></h2><h3 id="fixed-bugs-and-malfunctions-29" class="section-heading"><a href="#fixed-bugs-and-malfunctions-29" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In rare circumstances, an unsafe optimization could cause the compiler to generate incorrect code for list matching.</p><p>Own Id: OTP-19003 Aux Id: GH-8187, PR-8189</p></li><li><p>In rare circumstances, the compiler code generate unsafe code for a bit syntax match.</p><p>Own Id: OTP-19019</p></li></ul><h2 id="compiler-8-1-1-5" class="section-heading"><a href="#compiler-8-1-1-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.1.1.5</span></h2><h3 id="fixed-bugs-and-malfunctions-30" class="section-heading"><a href="#fixed-bugs-and-malfunctions-30" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler could be very slow when compiling guards with multiple guard
tests separated with '<code class="inline">or</code>' or '<code class="inline">;</code>'.</p><p>Own Id: OTP-18617 Aux Id: GH-7338</p></li></ul><h2 id="compiler-8-1-1-4" class="section-heading"><a href="#compiler-8-1-1-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.1.1.4</span></h2><h3 id="fixed-bugs-and-malfunctions-31" class="section-heading"><a href="#fixed-bugs-and-malfunctions-31" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Complex guard expression using the <code class="inline">or</code> operator and guard BIFs that can fail
could sometimes be miscompiled so that the guard would succeed even if a call
to a guard BIF failed.</p><p>Own Id: OTP-18593 Aux Id: GH-7252</p></li></ul><h2 id="compiler-8-1-1-3" class="section-heading"><a href="#compiler-8-1-1-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.1.1.3</span></h2><h3 id="fixed-bugs-and-malfunctions-32" class="section-heading"><a href="#fixed-bugs-and-malfunctions-32" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler would generate incorrect code for the following type of
expression:</p><p><code class="inline">Pattern = BoundVar1 = . . . = BoundVarN = Expression</code></p><p>An exception should be raised if any of the bound variables have different
values than <code class="inline">Expression</code>. The compiler would generate code that would cause
the bound variables to be bound to the value of <code class="inline">Expression</code>whether the value
matched or not.</p><p>Own Id: OTP-18470 Aux Id: GH-6873, PR-6877</p></li></ul><h2 id="compiler-8-1-1-2" class="section-heading"><a href="#compiler-8-1-1-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.1.1.2</span></h2><h3 id="fixed-bugs-and-malfunctions-33" class="section-heading"><a href="#fixed-bugs-and-malfunctions-33" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>It is not allowed to call functions from guards. The compiler failed to reject
a call in a guard when done by constructing a record with a default
initialization expression that called a function.</p><p>Own Id: OTP-18325 Aux Id: GH-6465, GH-6466</p></li><li><p>Fixed a bug that could cause legal code to fail validation.</p><p>Own Id: OTP-18365</p></li></ul><h2 id="compiler-8-1-1-1" class="section-heading"><a href="#compiler-8-1-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.1.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-34" class="section-heading"><a href="#fixed-bugs-and-malfunctions-34" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The <code class="inline">bin_opt_info</code> and <code class="inline">recv_opt_info</code> options would cause the compiler to
crash when attempting to compile generated code without location information.</p><p>Own Id: OTP-18162 Aux Id: PR-6102</p></li><li><p>In rare circumstances involving floating point operations, the compiler could
terminate with an internal consistency check failure.</p><p>Own Id: OTP-18182 Aux Id: GH-6163</p></li></ul><h2 id="compiler-8-1-1" class="section-heading"><a href="#compiler-8-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-35" class="section-heading"><a href="#fixed-bugs-and-malfunctions-35" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a performance bug in the validator that made certain files take a very
long time to compile.</p><p>Own Id: OTP-18066 Aux Id: GH-5915</p></li><li><p>In rare circumstances, the compiler would mistakenly assume that a call to
<a href="../../apps/erts/erlang.html#setelement/3"><code class="inline">setelement/3</code></a> would always fail and remove all code
following the call.</p><p>Own Id: OTP-18082</p></li></ul><h2 id="compiler-8-1" class="section-heading"><a href="#compiler-8-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.1</span></h2><h3 id="fixed-bugs-and-malfunctions-36" class="section-heading"><a href="#fixed-bugs-and-malfunctions-36" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The expression <code class="inline">&lt;&lt;0/native-float&gt;&gt;=Bin</code> would always fail to match, while
<code class="inline">&lt;&lt;0/float-native&gt;&gt;=Bin</code> would match (provided that <code class="inline">Bin</code> contained the binary
representation of <code class="inline">0.0</code>)</p><p>Own Id: OTP-17895</p></li></ul><h3 id="improvements-and-new-features-8" class="section-heading"><a href="#improvements-and-new-features-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The compiler will now compile huge functions with straight-line code faster.</p><p>Own Id: OTP-17886 Aux Id: GH-5140, GH-5686</p></li></ul><h2 id="compiler-8-0-4" class="section-heading"><a href="#compiler-8-0-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.0.4</span></h2><h3 id="fixed-bugs-and-malfunctions-37" class="section-heading"><a href="#fixed-bugs-and-malfunctions-37" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>When the compiler is invoked by Dialyzer, it will no longer apply an
optimization of binary patterns that would turn the pattern <code class="inline">&lt;&lt;&quot;bar&quot;&gt;&gt;</code> into
<code class="inline">&lt;&lt;6447474:24&gt;&gt;</code>, which would be very confusing when printed out by Dialyzer.</p><p>Own Id: OTP-17768 Aux Id: GH-5429</p></li><li><p>The compiler would replace known failing calls (such as
<a href="../../apps/erts/erlang.html#atom_to_list/1"><code class="inline">atom_to_list(42)</code></a>) with a call to
<a href="../../apps/erts/erlang.html#error/1"><code class="inline">error(badarg)</code></a>. With the extended error information introduced
in OTP 24 (EEP 54), those &quot;optimized&quot; calls would not have extended error
information. To ensure that as much extended error information as possible is
available, the compiler now keeps the original call even when it is known to
fail.</p><p>Own Id: OTP-17786 Aux Id: GH-5440</p></li></ul><h2 id="compiler-8-0-3" class="section-heading"><a href="#compiler-8-0-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.0.3</span></h2><h3 id="fixed-bugs-and-malfunctions-38" class="section-heading"><a href="#fixed-bugs-and-malfunctions-38" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>If a parse transform raised an exception using <a href="../../apps/erts/erlang.html#throw/1"><code class="inline">throw/1</code></a> or
<a href="../../apps/erts/erlang.html#exit/1"><code class="inline">exit/1</code></a>, the compiler would report that as an internal compiler
error, which would be confusing. Amended to report that the parse transform
failed.</p><p>Own Id: OTP-17421</p></li><li><p>The failing call <code class="inline">io:format(&quot;~p\n&quot;)</code> would result in a warning for line number
0 instead of the correct line and column numbers. This has been corrected, and
all warnings for failing calls to <a href="../../apps/stdlib/io.html#t:format/0"><code class="inline">io:format()</code></a> has been
rephrased to make it clearer exactly what the problem is.</p><p>Own Id: OTP-17430</p></li><li><p>When the options <code class="inline">warn_missing_spec</code> and <code class="inline">export_all</code> were given, there would
only be warnings for missing specs for functions that had been explicitly
exported using an <code class="inline">-export</code> attribute.</p><p>Own Id: OTP-17434 Aux Id: GH-4772</p></li><li><p>In rare circumstances, the compiler could emit an incorrect warning for a term
that was constructed but never used.</p><p>Own Id: OTP-17446 Aux Id: PR-4899</p></li><li><p>Corrected bugs where builds were not reducible even when the <code class="inline">deterministic</code>
option was given. In particular, modules with map literals with more than 32
elements could cause this problem.</p><p>As part of this fix, the <code class="inline">term_to_binary</code> BIF now accepts the option
<code class="inline">deterministic</code>.</p><p>Own Id: OTP-17495 Aux Id: PR-5153</p></li><li><p>The <code class="inline">MODULE</code> and <code class="inline">MODULE_STRING</code> macros would always appear to be defined
(when tested by <code class="inline">-ifdef</code>), even though no <code class="inline">-module()</code> declaration had been
seen yet. Changed so that <code class="inline">-ifdef ?MODULE.</code> will not consider ?MODULE defined
if <code class="inline">-module()</code> has not been previously seen.</p><p>Own Id: OTP-17505 Aux Id: GH-4995</p></li><li><p>In a guard, <code class="inline">not (X =:= true)</code> would incorrectly evaluate to <code class="inline">false</code> for
non-boolean values of <code class="inline">X</code>.</p><p>Own Id: OTP-17510 Aux Id: GH-5007</p></li><li><p>When the <code class="inline">deterministic</code> option was given to the compiler, the <code class="inline">?FILE</code> macro
would be expanded to full path of the source file before the first <code class="inline">include</code>
directive and to base part of the filename after <code class="inline">include</code> directive.</p><p>Own Id: OTP-17581 Aux Id: PR-5141</p></li></ul><h2 id="compiler-8-0-2" class="section-heading"><a href="#compiler-8-0-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.0.2</span></h2><h3 id="fixed-bugs-and-malfunctions-39" class="section-heading"><a href="#fixed-bugs-and-malfunctions-39" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A compiler optimization pass could crash when given odd but legal code using
<a href="../../apps/erts/erlang.html#throw/1"><code class="inline">throw/1</code></a>.</p><p>Own Id: OTP-17489 Aux Id: GH-4953</p></li></ul><h2 id="compiler-8-0-1" class="section-heading"><a href="#compiler-8-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-40" class="section-heading"><a href="#fixed-bugs-and-malfunctions-40" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug that could cause <code class="inline">after</code> blocks to be ignored when
<a href="../../apps/erts/erlang.html#raise/3"><code class="inline">erlang:raise/3</code></a> was used in a catch block.</p><p>Own Id: OTP-17428 Aux Id: GH-4859</p></li><li><p>Fixed a bug in the validation pass that could cause it to reject valid code.</p><p>Own Id: OTP-17437 Aux Id: OTP-17357, GH-4774</p></li></ul><h2 id="compiler-8-0" class="section-heading"><a href="#compiler-8-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 8.0</span></h2><h3 id="fixed-bugs-and-malfunctions-41" class="section-heading"><a href="#fixed-bugs-and-malfunctions-41" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A floating point zero (0.0) can be both positive (+0.0) and negative (-0.0).
Multiple bugs in the compiler, runtime system, and STDLIB have been fixed to
ensure that the minus sign on 0.0 is not lost.</p><p>Own Id: OTP-17077 Aux Id: ERL-1431, PR-2903, PR-2905, PR-2906</p></li><li><p>A repeated stack trace variable in a try/catch was not rejected. The following
example will now cause a compilation error:</p><pre><code class="text">try E catch _:A:A -&gt; A
      end.</code></pre><p>Own Id: OTP-17104 Aux Id: ERL-1380</p></li><li><p>Eliminated a Dialyzer crashed when the <code class="inline">-MMD</code> option is used to generate a
dependency file and a BEAM file a the same time.</p><p>Own Id: OTP-17118 Aux Id: PR-2825</p></li><li><p>When the <code class="inline">makedep</code> option was given, the compiler would crash if the
dependency output contained non-latin1 characters. The compiler will now
output the dependency information encoded in UTF-8 to avoid crashing.</p><p>Own Id: OTP-17206</p></li></ul><h3 id="improvements-and-new-features-9" class="section-heading"><a href="#improvements-and-new-features-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Selective receive optimization will now be applied much more often.</p><p>The new <a href="../../system/eff_guide_processes.html#recv_opt_info"><code class="inline">recv_opt_info</code></a>
compile flag can be used to print diagnostics relating to this optimization.</p><p>You can read more about the
<a href="../../system/eff_guide_processes.html#receiving-messages">selective receive optimization</a>
in the Efficiency Guide.</p><p>Own Id: OTP-10391 Aux Id: OTP-16226</p></li><li><p><a href="../../apps/erts/erlang.html#throw/1"><code class="inline">erlang:throw/1</code></a> will no longer build stack traces when we can prove that they
will never be inspected.</p><p>Own Id: OTP-16334</p></li><li><p>Variables bound between the keywords 'try' and 'of' can now be used in the
clauses following the 'of' keyword (that is, in the success case when no
exception was raised).</p><p>Own Id: OTP-16706 Aux Id: ERL-1281</p></li><li><p>Compiler warnings and errors now include column numbers in addition to line
numbers.</p><p>When a compiler message is emitted, the source line is printed along with a
marker (a <code class="inline">^</code> character) that indicates the column position of the issue. The
option '<code class="inline">brief</code>' removes the printout of the source line.</p><p>The compiler option <code class="inline">{error_location, line | column}</code> has been added. The
default value is <code class="inline">column</code>. Besides adding column numbers to compilation
warnings and errors, the option also determines whether column numbers are
included in abstract code. If tools stop working, setting the environment
variable <code class="inline">ERL_COMPILER_OPTIONS</code> can help (include <code class="inline">{error_location, line}</code>).</p><p>The compiler will now call the function <code class="inline">PT</code>:<code class="inline">parse_transform_info/0</code> in parse
transforms (if it exists). It can be used by parse transforms to signal that
they can only handle line numbers in abstract code.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-16824 Aux Id: PR-2664, PR-3006</p></li><li><p>Fixed a performance bug that made functions with lots of <code class="inline">try/after</code> blocks
slow to compile.</p><p>Own Id: OTP-16867 Aux Id: ERL-1354</p></li><li><p>The experimental HiPE application has been removed, together with all related
functionality in other applications.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-16963</p></li><li><p>Generators in list and binary comprehensions will now raise a
<code class="inline">{bad_generator,Generator}</code> exception if the generator has an incorrect type
(instead of raising an ad-hoc <code class="inline">badarg</code> or <code class="inline">badarih</code> exception). Similarly,
when a filter does not evaluate to a boolean, a <code class="inline">{bad_filter,Filter}</code>
exception will be raised. Some minor bugs in the compilation of binary
comprehensions have also been fixed.</p><p>Own Id: OTP-16964</p></li><li><p>Some compiler warnings, such as the warning for an expression whose result is
ignored, could not be suppressed by assigning to a variable beginning with
'<code class="inline">_</code>', but only by assigning to the anonymous variable ('<code class="inline">_</code>'). This has now
been changed so that any warning that can be suppressed by assigning to the
anonymous variable can also be suppressed by assigning to a variable beginning
with '<code class="inline">_</code>'.</p><p>Own Id: OTP-16981 Aux Id: ERL-1113</p></li><li><p>The previously undocumented compiler options <code class="inline">warn_missing_spec</code> and
<code class="inline">warn_missing_spec_all</code> are now documented.</p><p>Own Id: OTP-17078 Aux Id: ERL-1430, PR-2918</p></li><li><p>The compiler will now emit warnings when (previously bound)
underscore-prefixed variables are matched.</p><p>Own Id: OTP-17123</p></li><li><p>Erlang source files not encoded in utf-8 will no longer be accepted by the
compiler unless it contains a &quot;coding: latin-1&quot; comment.</p><p>Own Id: OTP-17168</p></li><li><p>New compiler options <code class="inline">from_abstr</code> and <code class="inline">no_lint</code> have been added. They are
useful when implementing other languages running on the BEAM.</p><p>Own Id: OTP-17172</p></li><li><p>The bit matching and construction syntax now supports 16-bit floats (IEEE
754-2008).</p><p>Own Id: OTP-17207</p></li><li><p>The compiler will now inline funs that are used only once immediately after
their definition.</p><p>Own Id: OTP-17226 Aux Id: GH-4019, PR-4545</p></li><li><p>It is now possible to disable warnings emitted from the compiler's
optimization passes with the new options <code class="inline">nowarn_opportunistic</code>,
<code class="inline">nowarn_nomatch</code>, <code class="inline">nowarn_ignored</code>, and <code class="inline">nowarn_failed</code>.</p><p>Own Id: OTP-17260</p></li><li><p>Introduce new types <a href="../../apps/erts/erlang.html#t:nonempty_binary/0"><code class="inline">nonempty_binary/0</code></a> and <a href="../../apps/erts/erlang.html#t:nonempty_bitstring/0"><code class="inline">nonempty_bitstring/0</code></a>.</p><p>Own Id: OTP-17301 Aux Id: GH-4636</p></li><li><p>Add compiler option <code class="inline">{nowarn_unused_record, RecordNames}</code>. Document compiler
option <code class="inline">nowarn_unused_type</code>.</p><p>Own Id: OTP-17330</p></li></ul><h2 id="compiler-7-6-9-3" class="section-heading"><a href="#compiler-7-6-9-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.6.9.3</span></h2><h3 id="fixed-bugs-and-malfunctions-42" class="section-heading"><a href="#fixed-bugs-and-malfunctions-42" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>It is not allowed to call functions from guards. The compiler failed to reject
a call in a guard when done by constructing a record with a default
initialization expression that called a function.</p><p>Own Id: OTP-18325 Aux Id: GH-6465, GH-6466</p></li><li><p>Fixed a bug that could cause legal code to fail validation.</p><p>Own Id: OTP-18365</p></li><li><p>The compiler would generate incorrect code for the following type of
expression:</p><p><code class="inline">Pattern = BoundVar1 = . . . = BoundVarN = Expression</code></p><p>An exception should be raised if any of the bound variables have different
values than <code class="inline">Expression</code>. The compiler would generate code that would cause
the bound variables to be bound to the value of <code class="inline">Expression</code>whether the value
matched or not.</p><p>Own Id: OTP-18470 Aux Id: GH-6873, PR-6877</p></li></ul><h2 id="compiler-7-6-9-2" class="section-heading"><a href="#compiler-7-6-9-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.6.9.2</span></h2><h3 id="fixed-bugs-and-malfunctions-43" class="section-heading"><a href="#fixed-bugs-and-malfunctions-43" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In rare circumstances, the compiler would mistakenly assume that a call to
<a href="../../apps/erts/erlang.html#setelement/3"><code class="inline">setelement/3</code></a> would always fail and remove all code
following the call.</p><p>Own Id: OTP-18082</p></li></ul><h2 id="compiler-7-6-9-1" class="section-heading"><a href="#compiler-7-6-9-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.6.9.1</span></h2><h3 id="fixed-bugs-and-malfunctions-44" class="section-heading"><a href="#fixed-bugs-and-malfunctions-44" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in the validation pass that could cause it to reject valid code.</p><p>Own Id: OTP-17437 Aux Id: OTP-17357, GH-4774</p></li></ul><h2 id="compiler-7-6-9" class="section-heading"><a href="#compiler-7-6-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.6.9</span></h2><h3 id="fixed-bugs-and-malfunctions-45" class="section-heading"><a href="#fixed-bugs-and-malfunctions-45" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Reverted the fix for <code class="inline">OTP-17357</code> as it turned out to be incomplete and made
the validator reject much more legal code than before.</p><p>It will be fixed more thoroughly in a later patch.</p><p>Own Id: OTP-17386 Aux Id: ERIERL-650, OTP-17357</p></li></ul><h2 id="compiler-7-6-8" class="section-heading"><a href="#compiler-7-6-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.6.8</span></h2><h3 id="fixed-bugs-and-malfunctions-46" class="section-heading"><a href="#fixed-bugs-and-malfunctions-46" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in the validator that could cause it to reject valid code.</p><p>Own Id: OTP-17357 Aux Id: GH-4774</p></li></ul><h2 id="compiler-7-6-7" class="section-heading"><a href="#compiler-7-6-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.6.7</span></h2><h3 id="fixed-bugs-and-malfunctions-47" class="section-heading"><a href="#fixed-bugs-and-malfunctions-47" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in the type optimization pass that could yield incorrect values or
cause the wrong clauses to be executed.</p><p>Own Id: OTP-17073</p></li><li><p>Fixed a bug in the validator that could cause it to reject valid code.</p><p>Own Id: OTP-17126 Aux Id: ERL-1471</p></li></ul><h2 id="compiler-7-6-6" class="section-heading"><a href="#compiler-7-6-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.6.6</span></h2><h3 id="fixed-bugs-and-malfunctions-48" class="section-heading"><a href="#fixed-bugs-and-malfunctions-48" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Several minor compiler bugs have been fixed:</p><p>Constructing a binary with a list as a size of a binary segment could generate
a BEAM file that could not be loaded.</p><p>When matching a binary segment of type <code class="inline">float</code> and ignoring the matched out
value, the match would always succeed, even if the size was invalid or the
value of the float was NaN or some other non-numeric float value.</p><p>Attempting to construct an invalid external fun (e.g. <code class="inline">fun m:f:bad</code>) is
supposed to raise a '<code class="inline">badarg</code>' exception, but if the value was never used, no
exception would be raised.</p><p>Own Id: OTP-16932</p></li><li><p>Fixed multiple bugs in the validator that could cause it to reject valid code.</p><p>Own Id: OTP-17039 Aux Id: ERL-1426</p></li><li><p>The compiler could crash when a binary comprehension had a generator that
depended on another generator.</p><p>Own Id: OTP-17045 Aux Id: ERL-1427</p></li><li><p>Fixed a bug in the type optimization pass that could yield incorrect values or
cause the wrong clauses to be executed.</p><p>Own Id: OTP-17072 Aux Id: ERL-1440</p></li></ul><h2 id="compiler-7-6-5" class="section-heading"><a href="#compiler-7-6-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.6.5</span></h2><h3 id="fixed-bugs-and-malfunctions-49" class="section-heading"><a href="#fixed-bugs-and-malfunctions-49" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in the boolean optimization pass that caused the compiler to
confuse different clauses.</p><p>Own Id: OTP-16951 Aux Id: ERL-1384</p></li></ul><h2 id="compiler-7-6-4" class="section-heading"><a href="#compiler-7-6-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.6.4</span></h2><h3 id="fixed-bugs-and-malfunctions-50" class="section-heading"><a href="#fixed-bugs-and-malfunctions-50" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a performance bug that could be triggered by tuple matching in very
large functions.</p><p>Own Id: OTP-16895 Aux Id: ERL-1359</p></li></ul><h2 id="compiler-7-6-3" class="section-heading"><a href="#compiler-7-6-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.6.3</span></h2><h3 id="fixed-bugs-and-malfunctions-51" class="section-heading"><a href="#fixed-bugs-and-malfunctions-51" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>If the update of a map with the '<code class="inline">Map#{Key := Value}</code>' syntax failed, the line
number in the stack backtrace could be incorrect.</p><p>Own Id: OTP-16701 Aux Id: ERL-1271</p></li><li><p>Fixed a performance bug that slowed down compilation of modules with deeply
nested terms.</p><p>Own Id: OTP-16755 Aux Id: ERL-1297</p></li><li><p>The compiler could in rare circumstances do an an unsafe optimization that
would result in a matching of a nested map pattern would fail to match.</p><p>Own Id: OTP-16820</p></li><li><p>Fixed a bug in the validator that caused it to reject valid code.</p><p>Own Id: OTP-16838 Aux Id: ERL-1340</p></li></ul><h2 id="compiler-7-6-2" class="section-heading"><a href="#compiler-7-6-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.6.2</span></h2><h3 id="fixed-bugs-and-malfunctions-52" class="section-heading"><a href="#fixed-bugs-and-malfunctions-52" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>When calls to <code class="inline">is_map_key</code> were repeated, the compiler could terminate with an
internal consistency failure.</p><p>Own Id: OTP-16708 Aux Id: ERL-1276</p></li><li><p>Fixed a bug in the type inference pass that could cause the compiler to hang.</p><p>Own Id: OTP-16745 Aux Id: ERL-1289</p></li></ul><h2 id="compiler-7-6-1" class="section-heading"><a href="#compiler-7-6-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.6.1</span></h2><h3 id="fixed-bugs-and-malfunctions-53" class="section-heading"><a href="#fixed-bugs-and-malfunctions-53" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In rare circumstances, a guard using 'not' could evaluate to the wrong boolean
value.</p><p>Own Id: OTP-16652 Aux Id: ERL-1246</p></li><li><p>A guard expression that referenced a variable bound to a boolean expression
could evaluate to the wrong value.</p><p>Own Id: OTP-16657 Aux Id: ERL-1253</p></li></ul><h2 id="compiler-7-6" class="section-heading"><a href="#compiler-7-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.6</span></h2><h3 id="fixed-bugs-and-malfunctions-54" class="section-heading"><a href="#fixed-bugs-and-malfunctions-54" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><code class="inline">erlang:fun_info(fun foo/1, name/1)</code> used to return a function name based on
the name of the function that <code class="inline">fun foo/1</code> was used in. The name returned is
now <code class="inline">-fun.foo/1-</code>.</p><p>Own Id: OTP-15837</p></li><li><p>Initialization of record fields using <code class="inline">_</code> is no longer allowed if the number
of affected fields is zero.</p><p>Own Id: OTP-16516</p></li></ul><h3 id="improvements-and-new-features-10" class="section-heading"><a href="#improvements-and-new-features-10" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>EEP-52 has been implemented.</p><p>In binary matching, the size of the segment to be matched is now allowed to be
a guard expression, and similarly in map matching the keys can now be guard
expressions. See the Erlang Reference Manual and Programming Examples for more
details.</p><p>Language compilers or code generators that generate Core Erlang code may need
to be updated to be compatible with the compiler in OTP 23. For more details,
see the section Backwards Compatibility in
<a href="http://erlang.org/eeps/eep-0052.html">EEP 52</a>.</p><p>Own Id: OTP-14708</p></li><li><p>Allow underscores in numeric literals to improve readability. Examples:
<code class="inline">123_456_789</code>, <code class="inline">16#1234_ABCD</code>.</p><p>Own Id: OTP-16007 Aux Id: PR-2324</p></li><li><p>Improved the type optimization pass' inference of types that depend on
themselves, giving us more accurate types and letting us track the content
types of lists.</p><p>Own Id: OTP-16214 Aux Id: PR-2460</p></li><li><p>Support message queue optimization also for references returned from the new
<a href="../../apps/erts/erlang.html#spawn_request/5"><code class="inline">spawn_request()</code></a> BIFs.</p><p>Own Id: OTP-16367 Aux Id: OTP-15251</p></li><li><p>The compiler will now raise a warning when inlining is used in modules that
load NIFs.</p><p>Own Id: OTP-16429 Aux Id: ERL-303</p></li><li><p>Refactored the internal handling of deprecated and removed functions.</p><p>Own Id: OTP-16469</p></li><li><p>Line information was sometimes incorrect for floating-point math exceptions.</p><p>Own Id: OTP-16505 Aux Id: ERL-1178</p></li><li><p>The <code class="inline">debug_info</code> option can now be specified in <code class="inline">-compile()</code> attributes.</p><p>Own Id: OTP-16523 Aux Id: ERL-1058</p></li><li><p>Reduced the resource usage of <code class="inline">erlc</code> in parallel builds (e.g. <code class="inline">make -j128</code>).</p><p>Own Id: OTP-16543 Aux Id: ERL-1186</p></li></ul><h2 id="compiler-7-5-4-3" class="section-heading"><a href="#compiler-7-5-4-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.5.4.3</span></h2><h3 id="improvements-and-new-features-11" class="section-heading"><a href="#improvements-and-new-features-11" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Fixed a bug in the type optimization pass that could yield incorrect values or
cause the wrong clauses to be executed.</p><p>Own Id: OTP-17073</p></li></ul><h2 id="compiler-7-5-4-2" class="section-heading"><a href="#compiler-7-5-4-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.5.4.2</span></h2><h3 id="fixed-bugs-and-malfunctions-55" class="section-heading"><a href="#fixed-bugs-and-malfunctions-55" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in the validator that could cause it to reject valid code</p><p>Own Id: OTP-17039 Aux Id: ERL-1426</p></li></ul><h2 id="compiler-7-5-4-1" class="section-heading"><a href="#compiler-7-5-4-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.5.4.1</span></h2><h3 id="fixed-bugs-and-malfunctions-56" class="section-heading"><a href="#fixed-bugs-and-malfunctions-56" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug that could cause the compiler to crash on code that constructed
binaries.</p><p>Own Id: OTP-16747 Aux Id: ERL-1290</p></li></ul><h2 id="compiler-7-5-4" class="section-heading"><a href="#compiler-7-5-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.5.4</span></h2><h3 id="fixed-bugs-and-malfunctions-57" class="section-heading"><a href="#fixed-bugs-and-malfunctions-57" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in the validator that could cause it to reject valid code.</p><p>Own Id: OTP-16580 Aux Id: ERL-1212</p></li></ul><h2 id="compiler-7-5-3" class="section-heading"><a href="#compiler-7-5-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.5.3</span></h2><h3 id="fixed-bugs-and-malfunctions-58" class="section-heading"><a href="#fixed-bugs-and-malfunctions-58" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A '<code class="inline">receive</code>' with an '<code class="inline">after 0</code>' clause would prevent the optimization that
can avoid scanning the entire receive queue when matching on a newly created
reference.</p><p>Own Id: OTP-16350</p></li><li><p>HiPE can again handle modules with <code class="inline">catch</code> and <code class="inline">try</code> constructs.</p><p>Own Id: OTP-16418</p></li><li><p>Fixed a bug in bit-syntax optimization that could crash the compiler.</p><p>Own Id: OTP-16515</p></li></ul><h2 id="compiler-7-5-2" class="section-heading"><a href="#compiler-7-5-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.5.2</span></h2><h3 id="fixed-bugs-and-malfunctions-59" class="section-heading"><a href="#fixed-bugs-and-malfunctions-59" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug that could cause the compiler to reject valid code that used the
<a href="../../apps/erts/erlang.html#is_map_key/2"><code class="inline">is_map_key/2</code></a> BIF.</p><p>Own Id: OTP-16452 Aux Id: ERL-1161</p></li><li><p>Fixed a bug that could cause the compiler to reject valid code that matched
the same map key several times.</p><p>Own Id: OTP-16456 Aux Id: ERL-1163</p></li><li><p>The compiler could crash when compiling a convoluted <code class="inline">receive</code> statement.</p><p>Own Id: OTP-16466 Aux Id: ERL-1170</p></li><li><p>The compiler could crash when a fun was created but never used.</p><p>The compiler could crash when compiling the expression <code class="inline">true = 0 / X</code>.</p><p>Own Id: OTP-16467 Aux Id: ERL-1166, ERL-1167</p></li></ul><h2 id="compiler-7-5-1" class="section-heading"><a href="#compiler-7-5-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.5.1</span></h2><h3 id="fixed-bugs-and-malfunctions-60" class="section-heading"><a href="#fixed-bugs-and-malfunctions-60" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in the compiler that could cause it to reject valid code.</p><p>Own Id: OTP-16385 Aux Id: ERL-1128</p></li></ul><h2 id="compiler-7-5" class="section-heading"><a href="#compiler-7-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.5</span></h2><h3 id="fixed-bugs-and-malfunctions-61" class="section-heading"><a href="#fixed-bugs-and-malfunctions-61" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in the linter where list and binary comprehensions could suppress
unsafe variable errors.</p><p>Own Id: OTP-16053 Aux Id: ERL-1039</p></li><li><p>When a compilation starts from Core Erlang code, the <code class="inline">core_lint</code> pass will
always be run and the compilation will be aborted if any errors are found.</p><p>Own Id: OTP-16181 Aux Id: ERL-1065</p></li></ul><h3 id="improvements-and-new-features-12" class="section-heading"><a href="#improvements-and-new-features-12" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The warning message that appears when the compiler detects a non-utf-8 encoded
source file without an encoding string in the beginning of the file has been
changed to contain information about that support for latin1 encoded source
files without an encoding string will be removed in Erlang/OTP 24.</p><p>Own Id: OTP-16054 Aux Id: OTP-11791</p></li></ul><h2 id="compiler-7-4-9" class="section-heading"><a href="#compiler-7-4-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.4.9</span></h2><h3 id="fixed-bugs-and-malfunctions-62" class="section-heading"><a href="#fixed-bugs-and-malfunctions-62" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a performance bug that caused repeated matches of large records to take
a very long time to compile.</p><p>Own Id: OTP-16259 Aux Id: ERIERL-436</p></li></ul><h2 id="compiler-7-4-8" class="section-heading"><a href="#compiler-7-4-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.4.8</span></h2><h3 id="fixed-bugs-and-malfunctions-63" class="section-heading"><a href="#fixed-bugs-and-malfunctions-63" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler could do an unsafe optimization of receives, which would cause a
receive to only scan part of the message queue.</p><p>This bug fix in the compiler fixes a bug in the socket module.</p><p>Own Id: OTP-16219 Aux Id: ERL-1076</p></li></ul><h2 id="compiler-7-4-7" class="section-heading"><a href="#compiler-7-4-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.4.7</span></h2><h3 id="fixed-bugs-and-malfunctions-64" class="section-heading"><a href="#fixed-bugs-and-malfunctions-64" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug where the compiler could generate incorrect code for a '<code class="inline">receive</code>'
statement inside a '<code class="inline">try</code>'.</p><p>Own Id: OTP-16199</p></li></ul><h2 id="compiler-7-4-6" class="section-heading"><a href="#compiler-7-4-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.4.6</span></h2><h3 id="fixed-bugs-and-malfunctions-65" class="section-heading"><a href="#fixed-bugs-and-malfunctions-65" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in the bit-syntax optimization pass that could crash the compiler.</p><p>Own Id: OTP-16103 Aux Id: ERL-1050</p></li></ul><h2 id="compiler-7-4-5" class="section-heading"><a href="#compiler-7-4-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.4.5</span></h2><h3 id="fixed-bugs-and-malfunctions-66" class="section-heading"><a href="#fixed-bugs-and-malfunctions-66" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Code such as the following would crash the compiler in OTP 22:
<code class="inline">[some_atom = fun some_function/1]</code></p><p>Own Id: OTP-15833</p></li><li><p>Compilation could get really slow (in the order of minutes instead of seconds)
when compiling huge functions. (Thanks to Kostis Sagonas for reporting this
bug.)</p><p>Own Id: OTP-15923</p></li><li><p>Fixed a bug in the validator that could reject valid code.</p><p>Own Id: OTP-15954 Aux Id: ERL-995</p></li><li><p>In rare circumstances, when two clauses had identical bodies and guard tests
that tested a single boolean variable, the guard test for the second clause
could be discarded, executing the second clause unconditionally if the first
clause was not executed.</p><p>Own Id: OTP-15963</p></li><li><p>Fixed extremely slow compilation for huge functions doing predominantly
pattern matching.</p><p>Own Id: OTP-15966 Aux Id: ERL-1014</p></li><li><p>The compiler could generate unsafe code (that would crash the runtime system)
for map pattern matching. The code could be unsafe if the matched key was not
present in the map at runtime.</p><p>Own Id: OTP-15968 Aux Id: ERL-1017</p></li><li><p>Correct code using try/after could fail to compile when using the option
'<code class="inline">no_type_opt</code>'.</p><p>Own Id: OTP-15969 Aux Id: ERL-997</p></li><li><p>The compiler could crash when compiling code that called
'<a href="../../apps/erts/erlang.html#length/1"><code class="inline">length/1</code></a>' on a binary extracted using the binary syntax.</p><p>Own Id: OTP-15970 Aux Id: ERL-1013</p></li><li><p>Fixed a bug where the compiler could fail with an internal consistency failure
error when compiling receive statements.</p><p>Own Id: OTP-15982 Aux Id: ERL-1022</p></li><li><p>Fixed a problem where the compiler would crash when compiling binary matching
in a function head.</p><p>Own Id: OTP-15985 Aux Id: ERL-1026</p></li></ul><h2 id="compiler-7-4-4" class="section-heading"><a href="#compiler-7-4-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.4.4</span></h2><h3 id="fixed-bugs-and-malfunctions-67" class="section-heading"><a href="#fixed-bugs-and-malfunctions-67" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a compiler crash introduced in <code class="inline">22.0.6</code> (OTP-15952).</p><p>Own Id: OTP-15953 Aux Id: ERL-999</p></li></ul><h2 id="compiler-7-4-3" class="section-heading"><a href="#compiler-7-4-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.4.3</span></h2><h3 id="fixed-bugs-and-malfunctions-68" class="section-heading"><a href="#fixed-bugs-and-malfunctions-68" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed an unsafe optimization when matching <a href="../../apps/erts/erlang.html#tuple_size/1"><code class="inline">tuple_size/1</code></a>
outside of guards, which could crash the emulator if the argument was not a
tuple.</p><p>Own Id: OTP-15945</p></li><li><p>Fixed a rare bug that could cause the wrong kind of exception to be thrown
when a BIF failed in a function that matched bitstrings.</p><p>Own Id: OTP-15946</p></li><li><p>Fixed a bug where receive statements inside try/catch blocks could return
incorrect results.</p><p>Own Id: OTP-15952</p></li></ul><h2 id="compiler-7-4-2" class="section-heading"><a href="#compiler-7-4-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.4.2</span></h2><h3 id="fixed-bugs-and-malfunctions-69" class="section-heading"><a href="#fixed-bugs-and-malfunctions-69" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed an incorrect type determination for constructed binaries, which could
cause <code class="inline">is_binary</code> checks to succeed when they shouldn't have.</p><p>Own Id: OTP-15872</p></li></ul><h2 id="compiler-7-4-1" class="section-heading"><a href="#compiler-7-4-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.4.1</span></h2><h3 id="fixed-bugs-and-malfunctions-70" class="section-heading"><a href="#fixed-bugs-and-malfunctions-70" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The type optimization pass of the compiler could hang or loop for a long time
when analyzing a <a href="../../apps/erts/erlang.html#setelement/3"><code class="inline">setelement/3</code></a> call with a variable
position.</p><p>Own Id: OTP-15828 Aux Id: ERL-948</p></li><li><p>Certain complex receive statements would result in an internal compiler
failure.</p><p>Own Id: OTP-15832 Aux Id: ERL-950</p></li><li><p>Fixed an unsafe type optimization.</p><p>Own Id: OTP-15838</p></li><li><p>Fixed a crash when optimizing compiler-generated exceptions (like badmatch)
whose offending term was a constructed binary.</p><p>Own Id: OTP-15839 Aux Id: ERL-954</p></li><li><p>Fixed a bad optimization related to the <code class="inline">++/2</code> operator, where the compiler
assumed that it always produced a list (<code class="inline">[] ++ RHS</code> returns <code class="inline">RHS</code> verbatim,
even if it's not a list).</p><p>Own Id: OTP-15841</p></li><li><p>An <a href="../../apps/erts/erlang.html#is_binary/1"><code class="inline">is_binary/1</code></a> test followed by
<a href="../../apps/erts/erlang.html#is_bitstring/1"><code class="inline">is_bitstring/1</code></a> (or vice versa) could fail because of an
usafe optimization.</p><p>Own Id: OTP-15845</p></li><li><p>A Core Erlang module where the last clause in a <code class="inline">case</code> matched a map would
fail to load.</p><p>Own Id: OTP-15846 Aux Id: ERL-955</p></li><li><p>Fixed a bug that could cause the compiler to crash when compiling complex
nested case expressions.</p><p>Own Id: OTP-15848 Aux Id: ERL-956</p></li></ul><h2 id="compiler-7-4" class="section-heading"><a href="#compiler-7-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.4</span></h2><h3 id="fixed-bugs-and-malfunctions-71" class="section-heading"><a href="#fixed-bugs-and-malfunctions-71" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><code class="inline">record_info/2</code> is a pseudo-function that requires literal arguments known at
compile time. Therefore, the following usage is illegal: <code class="inline">fun record/info/2</code>.
The compiler would crash when during compilation of that kind of code.
Corrected to issue a compilation error.</p><p>Own Id: OTP-15760 Aux Id: ERL-907</p></li></ul><h3 id="improvements-and-new-features-13" class="section-heading"><a href="#improvements-and-new-features-13" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The compiler has been rewritten to internally use an intermediate
representation based on Static Single Assignment (SSA). The new intermediate
representation makes more optimizations possible.</p><p>Most noticeable is that the binary matching optimizations are now applicable
in many more circumstances than before.</p><p>Another noticeable change is that type optimizations are now applied across
local function calls, and will remove a lot more redundant type tests than
before.</p><p>Own Id: OTP-14894 Aux Id: ERL-714</p></li><li><p>Funs are no longer created when they are only used locally, greatly improving
the performance of named funs and &quot;fun-wrapped&quot; macros.</p><p>Own Id: OTP-15273 Aux Id: ERL-639</p></li><li><p>All compiler options that can be given in the source file can now also be
given in the option list or from the command line for <code class="inline">erlc</code>.</p><p>Specifically, the option <code class="inline">{nowarn_deprecated_function,MFAs}</code> was only
recognized when given in the file with the attribute <code class="inline">-compile()</code>. The option
<code class="inline">{nowarn_unused_function,FAs}</code> was incorrectly documented to only work in a
file, but it also worked when given in the option list.</p><p>Own Id: OTP-15456</p></li><li><p>Do not allow function specifications for functions residing in other modules.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-15563 Aux Id: ERL-845, OTP-15562</p></li><li><p>Internal documentation has now been added to the <em>Erts</em> and <em>Compiler</em>
applications.</p><p>The internal documents for <em>Erts</em> describe miscellaneous interesting
implementation details. Those details can change at any time.</p><p>The internal documentation for <em>Compiler</em> documents the API for the Core
Erlang modules. While we will not change those APIs without good reason, we
don't give the same guarantees about backward compatibility as for the rest of
the APIs in OTP.</p><p>Own Id: OTP-15715</p></li><li><p>There are new compiler options <code class="inline">nowarn_removed</code> and <code class="inline">{nowarn_removed,Items}</code>
to suppress warnings for functions and modules that have been removed from
OTP.</p><p>Own Id: OTP-15749 Aux Id: ERL-904</p></li></ul><h2 id="compiler-7-3-2" class="section-heading"><a href="#compiler-7-3-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.3.2</span></h2><h3 id="fixed-bugs-and-malfunctions-72" class="section-heading"><a href="#fixed-bugs-and-malfunctions-72" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>An expression such as <code class="inline">(A / B) band 16#ff</code> would crash the compiler.</p><p>Own Id: OTP-15518 Aux Id: ERL-829</p></li><li><p>There could be an incorrect warning when the <code class="inline">tuple_calls</code> option was given.
The generated code would be correct. Here is an example of code that would
trigger the warning:</p><p><code class="inline">(list_to_atom(&quot;prefix_&quot; ++ atom_to_list(suffix))):doit(X)</code>.</p><p>Own Id: OTP-15552 Aux Id: ERL-838</p></li><li><p>Optimize (again) Dialyzer's handling of left-associative use of <code class="inline">andalso</code> and
<code class="inline">orelse</code> in guards.</p><p>Own Id: OTP-15577 Aux Id: ERL-851, PR-2141, PR-1944</p></li></ul><h2 id="compiler-7-3-1" class="section-heading"><a href="#compiler-7-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.3.1</span></h2><h3 id="fixed-bugs-and-malfunctions-73" class="section-heading"><a href="#fixed-bugs-and-malfunctions-73" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>An optimization that avoided allocation of a stack frame for some <code class="inline">case</code>
expressions was introduced in OTP 21. (ERL-504/OTP-14808) It turns out that in
rare circumstances, this optimization is not safe. Therefore, this
optimization has been disabled.</p><p>A similar optimization will be included in OTP 22 in a safe way.</p><p>Own Id: OTP-15501 Aux Id: ERL-807, ERL-514, OTP-14808</p></li></ul><h2 id="compiler-7-3" class="section-heading"><a href="#compiler-7-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.3</span></h2><h3 id="fixed-bugs-and-malfunctions-74" class="section-heading"><a href="#fixed-bugs-and-malfunctions-74" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a rare internal consistency failure caused by a bug in the <code class="inline">beam_jump</code>
pass. (Thanks to Simon Cornish for reporting this bug.)</p><p>Own Id: OTP-15400 Aux Id: ERL-759</p></li><li><p>The compiler could fail with an internal consistency check failure when
compiling code that used the <a href="../../apps/erts/erlang.html#is_function/2"><code class="inline">is_function/2</code></a> BIF.</p><p>Own Id: OTP-15435 Aux Id: ERL-778</p></li><li><p>When an external fun was used, warnings for unused variables could be
suppressed.</p><p>Own Id: OTP-15437 Aux Id: ERL-762</p></li><li><p>The compiler would crash when compiling an <code class="inline">after</code> block that called
<a href="../../apps/erts/erlang.html#raise/3"><code class="inline">erlang:raise/3</code></a> like this: <code class="inline">erlang:raise(Class, Stacktrace, Stacktrace)</code></p><p>Own Id: OTP-15481</p></li></ul><h3 id="improvements-and-new-features-14" class="section-heading"><a href="#improvements-and-new-features-14" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>When specified, the <code class="inline">+{source,Name}</code> option will now override the actual file
name in stack traces, instead of only affecting the return value of
<code class="inline">Mod:module_info()</code>.</p><p>The <code class="inline">+deterministic</code> flag will also affect stack traces now, omitting all path
information except the file name, fixing a long-standing issue where
deterministic builds required deterministic paths.</p><p>Own Id: OTP-15245 Aux Id: ERL-706</p></li></ul><h2 id="compiler-7-2-7" class="section-heading"><a href="#compiler-7-2-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.2.7</span></h2><h3 id="fixed-bugs-and-malfunctions-75" class="section-heading"><a href="#fixed-bugs-and-malfunctions-75" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug where incorrect code was generated following a binary match guard.</p><p>Own Id: OTP-15353 Aux Id: ERL-753</p></li></ul><h2 id="compiler-7-2-6" class="section-heading"><a href="#compiler-7-2-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.2.6</span></h2><h3 id="fixed-bugs-and-malfunctions-76" class="section-heading"><a href="#fixed-bugs-and-malfunctions-76" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In rare circumstances, the matched out tail of a binary could be the entire
original binary. (There was partial correction to this problem in version
7.2.5 of the compiler application.)</p><p>Own Id: OTP-15335 Aux Id: ERL-689, OTP-15219</p></li></ul><h2 id="compiler-7-2-5" class="section-heading"><a href="#compiler-7-2-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.2.5</span></h2><h3 id="fixed-bugs-and-malfunctions-77" class="section-heading"><a href="#fixed-bugs-and-malfunctions-77" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug that prevented certain variable-sized binary comprehensions from
compiling.</p><p>Own Id: OTP-15186 Aux Id: ERL-665</p></li><li><p>When compiling from Core Erlang, funs created in certain expressions that were
only used for their side-effects were subtly broken.</p><p>Own Id: OTP-15188 Aux Id: ERL-658</p></li><li><p>There could be an internal consistency failure when a <code class="inline">receive</code> was nested in
a <code class="inline">try</code>/<code class="inline">catch</code>.</p><p>Own Id: OTP-15218 Aux Id: ERL-684</p></li><li><p>In rare circumstances, the matched out tail of a binary could be the entire
original binary.</p><p>Own Id: OTP-15219 Aux Id: ERL-689</p></li><li><p>When <a href="../../apps/erts/erlang.html#is_map_key/2"><code class="inline">is_map_key/2</code></a> was used in a guard together with the
<code class="inline">not/1</code> or <code class="inline">or/2</code> operators, the error behavior could be wrong when
<a href="../../apps/erts/erlang.html#is_map_key/2"><code class="inline">is_map_key/2</code></a> was passed a non-map as the second argument.</p><p>In rare circumstances, compiling code that uses
<a href="../../apps/erts/erlang.html#is_map_key/2"><code class="inline">is_map_key/2</code></a> could cause an internal consistency check
failure.</p><p>Own Id: OTP-15227 Aux Id: ERL-699</p></li><li><p>The compiler could crash when compiling a function with multiple receives in
multiple clauses.</p><p>Own Id: OTP-15235 Aux Id: ERL-703</p></li></ul><h2 id="compiler-7-2-4" class="section-heading"><a href="#compiler-7-2-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.2.4</span></h2><h3 id="fixed-bugs-and-malfunctions-78" class="section-heading"><a href="#fixed-bugs-and-malfunctions-78" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix a regression in OTP-15204 that removed <code class="inline">.beam</code> file metadata that some
external build tools relied on.</p><p>Own Id: OTP-15292</p></li></ul><h2 id="compiler-7-2-3" class="section-heading"><a href="#compiler-7-2-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.2.3</span></h2><h3 id="fixed-bugs-and-malfunctions-79" class="section-heading"><a href="#fixed-bugs-and-malfunctions-79" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed an issue where files compiled with the <code class="inline">+deterministic</code> option differed
if they were compiled in a different directory but were otherwise identical.</p><p>Own Id: OTP-15204 Aux Id: ERL-679</p></li></ul><h2 id="compiler-7-2-2" class="section-heading"><a href="#compiler-7-2-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.2.2</span></h2><h3 id="fixed-bugs-and-malfunctions-80" class="section-heading"><a href="#fixed-bugs-and-malfunctions-80" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In rare cases involving matching of binary literal strings, the compiler could
optimize away code that should be executed.</p><p>Own Id: OTP-15156 Aux Id: ERL-655</p></li><li><p>There could be an internal consistency check failure when compiling code that
called <a href="../../apps/erts/erlang.html#map_get/2"><code class="inline">map_get(Key, Map)</code></a> and then updated the same map.</p><p>Own Id: OTP-15157</p></li><li><p>In rare circumstances, the compiler could crash in <code class="inline">beam_jump</code> when compiling
a floating point operation.</p><p>Own Id: OTP-15166 Aux Id: ERL-660</p></li></ul><h2 id="compiler-7-2-1" class="section-heading"><a href="#compiler-7-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-81" class="section-heading"><a href="#fixed-bugs-and-malfunctions-81" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The could could crash when compiling a complicated function that used the
binary syntax.</p><p>Own Id: OTP-15150 Aux Id: ERL-650</p></li></ul><h2 id="compiler-7-2" class="section-heading"><a href="#compiler-7-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.2</span></h2><h3 id="fixed-bugs-and-malfunctions-82" class="section-heading"><a href="#fixed-bugs-and-malfunctions-82" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed an error in an optimization pass that caused impossible tuple matching.</p><p>Own Id: OTP-14855 Aux Id: ERL-549</p></li><li><p>The exception thrown when a list comprehension was given a non-list term was
not always correct.</p><p>Own Id: OTP-14992 Aux Id: ERL-572</p></li><li><p>The compiler could produce incorrect code in rare circumstances when the
<code class="inline">[{inline,F/A}]</code> option was used.</p><p>Own Id: OTP-15115 Aux Id: PR-1831</p></li></ul><h3 id="improvements-and-new-features-15" class="section-heading"><a href="#improvements-and-new-features-15" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Changed the default behaviour of <code class="inline">.erlang</code> loading: <code class="inline">.erlang</code> is no longer
loaded from the current directory. <code class="inline">c:erlangrc(PathList)</code> can be used to
search and load an <code class="inline">.erlang</code> file from user specified directories.</p><p><code class="inline">escript</code>, <code class="inline">erlc</code>, <code class="inline">dialyzer</code> and <code class="inline">typer</code> no longer load an <code class="inline">.erlang</code> at all.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14439</p></li><li><p>Support for &quot;tuple calls&quot; have been removed from the run-time system. Tuple
calls was an undocumented and unsupported feature which allowed the module
argument for an apply operation to be a tuple: <code class="inline">Var = dict:new(), Var:size()</code>.
This &quot;feature&quot; frequently caused confusion, especially when such call failed.
The stacktrace would point out functions that don't exist in the source code.</p><p>For legacy code that need to use parameterized modules or tuple calls for some
other reason, there is a new compiler option called <code class="inline">tuple_calls</code>. When this
option is given, the compiler will generate extra code that emulates the old
behavior for calls where the module is a variable.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-14497</p></li><li><p>In code such as <code class="inline">example({ok, Val}) -&gt; {ok, Val}.</code> a tuple would be built. The
compiler will now automatically rewrite the code to
<code class="inline">example({ok,Val}=Tuple) -&gt; Tuple.</code> which will reduce code size, execution
time, and remove GC pressure.</p><p>Own Id: OTP-14505</p></li><li><p>The optimization of <code class="inline">case</code> expression where only one of the case arms can
execute successfully has been improved.</p><p>Own Id: OTP-14525</p></li><li><p>Some uses of binary matching has been slightly improved, eliminating
unnecessary register shuffling.</p><p>Own Id: OTP-14594 Aux Id: ERL-444</p></li><li><p>There is a new <code class="inline">{compile_info,Info}</code> option for the compiler that allows
BEAM-based languages such as Elixir and LFE to add their own compiler
versions.</p><p>Own Id: OTP-14615 Aux Id: PR-1558</p></li><li><p>Loaded BEAM code in a 64-bit system requires less memory because of better
packing of operands for instructions.</p><p>These memory savings were achieved by major improvements to the <code class="inline">beam_makeops</code>
scripts used when building the run time system and BEAM compiler. There is
also new for documentation for <code class="inline">beam_makeops</code> that describes how new BEAM
instructions and loader transformations can be implemented. The documentation
is found in here in a source directory or git repository:
erts/emulator/internal_doc/beam_makeops.md. An online version can be found
here:
<a href="https://github.com/erlang/otp/blob/master/erts/emulator/internal_doc/beam_makeops.md">https://github.com/erlang/otp/blob/master/erts/emulator/internal_doc/beam_makeops.md</a></p><p>Own Id: OTP-14626</p></li><li><p>Size calculations for binary constructions has been somewhat optimized,
producing smaller code.</p><p>Own Id: OTP-14654</p></li><li><p>When the value returned from a '<code class="inline">catch</code>' expression is ignored, no stacktrace
will be built if an exception is caught. That will save time and produce less
garbage. There are also some minor optimizations of '<code class="inline">try</code>/<code class="inline">catch</code>' both in
the compiler and run-time system.</p><p>Own Id: OTP-14683</p></li><li><p>There is a new syntax in '<code class="inline">try/catch</code>' for retrieving the stacktrace without
calling '<code class="inline">erlang:get_stacktrace/0</code>'. See the reference manual for a
description of the new syntax. The '<code class="inline">erlang:get_stacktrace/0</code>' BIF is now
deprecated.</p><p>Own Id: OTP-14692</p></li><li><p>The following is an internal change in the compiler, that is not noticeable
for normal use of the compiler: The module <code class="inline">v3_life</code> has been removed. Its
functionality has been simplified and integrated into <code class="inline">v3_codegen</code>.</p><p>Own Id: OTP-14712</p></li><li><p>The optimization of binary matching that delays creation of sub binaries (see
the Efficiency Guide) could be thwarted by the argument order and could be
necessary to change the argument order. The compiler has now become smarter
and can handle any argument order.</p><p>Own Id: OTP-14774</p></li><li><p>When the compiler was faced with complex case expressions it would
unnecessarily allocate stack elements and shuffle data between x and y
registers. Improved code generation to only allocate a stack frame when
strictly necessary.</p><p>Own Id: OTP-14808 Aux Id: ERL-514</p></li><li><p>There is a new option '<code class="inline">makedep_side_effect</code>' for the compiler and <code class="inline">-MMD</code> for
'<code class="inline">erlc</code>' that generates dependencies and continues to compile as normal.</p><p>Own Id: OTP-14830</p></li><li><p>When compiling modules with huge functions, the compiler would generate a lot
of atoms for its internal, sometimes so many that the atom table would
overflow. The compiler has been rewritten to generate far less internal atoms
to avoid filling the atom table.</p><p>Own Id: OTP-14968 Aux Id: ERL-563</p></li><li><p>External funs with literal values for module, name, and arity (e.g.
<a href="../../apps/erts/erlang.html#abs/1"><code class="inline">erlang:abs/1</code></a>) are now treated as literals. That means more efficient code
that produces less garbage on the heap.</p><p>Own Id: OTP-15003</p></li><li><p>Two new guards BIFs operating on maps have been added:
<a href="../../apps/erts/erlang.html#map_get/2"><code class="inline">map_get/2</code></a> and <a href="../../apps/erts/erlang.html#is_map_key/2"><code class="inline">is_map_key/2</code></a>. They do the
same as <a href="../../apps/stdlib/maps.html#get/2"><code class="inline">maps:get/2</code></a> and <a href="../../apps/stdlib/maps.html#is_key/2"><code class="inline">maps:is_key/2</code></a>, respectively, except that they are
allowed to be used in guards.</p><p>Own Id: OTP-15037 Aux Id: PR-1784, PR-1802</p></li><li><p>A call or apply of a literal external fun will be replaced with a direct call.</p><p>Own Id: OTP-15044 Aux Id: ERL-614</p></li><li><p>Part of EEP-44 has been implemented.</p><p>There is a new predefined macro called <code class="inline">OTP_RELEASE</code> which is an integer
indicating the OTP release number (its value is <code class="inline">21</code> in this release).</p><p>There are new preprocessor directives <code class="inline">-if(Condition).</code> and
<code class="inline">-elif(Condition).</code>. The <code class="inline">if/elif</code> supports the builtin function
<code class="inline">defined(Symbol)</code>.</p><p>Own Id: OTP-15087 Aux Id: PR-1810</p></li></ul><h2 id="compiler-7-1-5-2" class="section-heading"><a href="#compiler-7-1-5-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.1.5.2</span></h2><h3 id="fixed-bugs-and-malfunctions-83" class="section-heading"><a href="#fixed-bugs-and-malfunctions-83" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix a regression in OTP-15204 that removed <code class="inline">.beam</code> file metadata that some
external build tools relied on.</p><p>Own Id: OTP-15292</p></li></ul><h2 id="compiler-7-1-5-1" class="section-heading"><a href="#compiler-7-1-5-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.1.5.1</span></h2><h3 id="fixed-bugs-and-malfunctions-84" class="section-heading"><a href="#fixed-bugs-and-malfunctions-84" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed an issue where files compiled with the <code class="inline">+deterministic</code> option differed
if they were compiled in a different directory but were otherwise identical.</p><p>Own Id: OTP-15204 Aux Id: ERL-679</p></li></ul><h2 id="compiler-7-1-5" class="section-heading"><a href="#compiler-7-1-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.1.5</span></h2><h3 id="fixed-bugs-and-malfunctions-85" class="section-heading"><a href="#fixed-bugs-and-malfunctions-85" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The internal compiler pass (<code class="inline">beam_validator</code>) that validates the generated
code has been strengthened.</p><p>When compiling from BEAM assembly code, the <code class="inline">beam_type</code> optimizer pass could
make the code unsafe. Corrected.</p><p>Own Id: OTP-14863</p></li><li><p>Corrected optimizations of integers matched out from binaries and used in bit
operations.</p><p>Own Id: OTP-14898</p></li></ul><h2 id="compiler-7-1-4" class="section-heading"><a href="#compiler-7-1-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.1.4</span></h2><h3 id="fixed-bugs-and-malfunctions-86" class="section-heading"><a href="#fixed-bugs-and-malfunctions-86" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The '<code class="inline">deterministic</code>' option was not recognized when given in a <code class="inline">-compile()</code>
attribute in the source code.</p><p>Own Id: OTP-14773 Aux Id: ERL-498</p></li></ul><h2 id="compiler-7-1-3" class="section-heading"><a href="#compiler-7-1-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.1.3</span></h2><h3 id="fixed-bugs-and-malfunctions-87" class="section-heading"><a href="#fixed-bugs-and-malfunctions-87" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler could issue an incorrect internal consistency failure diagnostic
for some complicated bit syntax matches.</p><p>Own Id: OTP-14640 Aux Id: ERL-490</p></li></ul><h2 id="compiler-7-1-2" class="section-heading"><a href="#compiler-7-1-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.1.2</span></h2><h3 id="fixed-bugs-and-malfunctions-88" class="section-heading"><a href="#fixed-bugs-and-malfunctions-88" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fail labels on guard BIFs weren't taken into account during an optimization
pass, and a bug in the validation pass sometimes prevented this from being
noticed when a fault occurred.</p><p>Own Id: OTP-14522 Aux Id: ERIERL-48</p></li><li><p>When compiling from Core Erlang, an 'apply' with a nested apply in the
function position would be treated as an invalid call. Corrected. (Thanks to
Mikael Pettersson for reporting this bug.)</p><p>Own Id: OTP-14526</p></li><li><p>Fixed checking of binary matching in the <code class="inline">beam_validator</code> module to ensure
that potential compiler bugs are found at compile-time instead as emulator
crash at run-time.</p><p>Own Id: OTP-14591</p></li><li><p>There could be false warnings for <code class="inline">erlang:get_stacktrace/0</code> being used outside
of a <code class="inline">try</code> block when using multiple <code class="inline">catch</code> clauses.</p><p>Own Id: OTP-14600 Aux Id: ERL-478</p></li></ul><h3 id="improvements-and-new-features-16" class="section-heading"><a href="#improvements-and-new-features-16" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The Erlang code linter no longer checks that the functions mentioned in
<code class="inline">nowarn_deprecated_function</code> options are declared in the module.</p><p>Own Id: OTP-14378</p></li></ul><h2 id="compiler-7-1-1" class="section-heading"><a href="#compiler-7-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-89" class="section-heading"><a href="#fixed-bugs-and-malfunctions-89" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fail labels on guard BIFs weren't taken into account during an optimization
pass, and a bug in the validation pass sometimes prevented this from being
noticed when a fault occurred.</p><p>Own Id: OTP-14522 Aux Id: ERIERL-48</p></li></ul><h2 id="compiler-7-1" class="section-heading"><a href="#compiler-7-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.1</span></h2><h3 id="fixed-bugs-and-malfunctions-90" class="section-heading"><a href="#fixed-bugs-and-malfunctions-90" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>For many releases, it has been legal to override a BIF with a local function
having the same name. However, calling a local function with the same name as
guard BIF as filter in a list comprehension was not allowed.</p><p>Own Id: OTP-13690</p></li><li><p>compile:forms/2 would not return the module name as documented when one of the
options '<code class="inline">from_core</code>', '<code class="inline">from_asm</code>', or '<code class="inline">from_beam</code>' was given. Also, the
compiler would crash if one of those options was combined with '<code class="inline">native</code>'.</p><p>Own Id: OTP-14408 Aux Id: ERL-417</p></li></ul><h3 id="improvements-and-new-features-17" class="section-heading"><a href="#improvements-and-new-features-17" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Optimized test for tuples with an atom as first element.</p><p>Own Id: OTP-12148</p></li><li><p>Compilation of modules with huge literal binary strings is now much faster.</p><p>Own Id: OTP-13794</p></li><li><p>Replaced usage of deprecated symbolic <a href="../../apps/erts/erlang.html#t:time_unit/0"><code class="inline">time unit</code></a>
representations.</p><p>Own Id: OTP-13831 Aux Id: OTP-13735</p></li><li><p>The undocumented and unsupported module <code class="inline">sys_pre_expand</code> has been removed. As
a partial replacement for the functionality, there is a new function
<a href="../../apps/stdlib/erl_internal.html#add_predefined_functions/1"><code class="inline">erl_internal:add_predefined_functions/1</code></a> and <code class="inline">erl_expand_records</code> will now
add a module prefix to calls to BIFs and imported functions.</p><p>Own Id: OTP-13856</p></li><li><p>The internal compiler passes now start all generated variables with &quot;@&quot; to
avoid any conflicts with variables in languages such as Elixir or LFE.</p><p>Own Id: OTP-13924</p></li><li><p>The function <code class="inline">fmod/2</code> has been added to the <code class="inline">math</code> module.</p><p>Own Id: OTP-14000</p></li><li><p>Code generation for complicated guards have been improved.</p><p>Own Id: OTP-14042</p></li><li><p>The compiler has new warnings for repeated identical map keys.</p><p>A map expression such as,</p><p><code class="inline">#{'a' =&gt; 1, 'b' =&gt; 2, 'a' =&gt; 3}.</code></p><p>will produce a warning for the repeated key 'a'.</p><p>Own Id: OTP-14058</p></li><li><p>By default, there will now be a warning when <code class="inline">export_all</code> is used. The warning
can be disabled using <code class="inline">nowarn_export_all</code>.</p><p>Own Id: OTP-14071</p></li><li><p>Optimize maps pattern matching by only examining the common keys in each
clause first instead of all keys. This will reduce the number of lookups of
each key in maps pattern matching.</p><p>Own Id: OTP-14072</p></li><li><p>There is a new '<code class="inline">deterministic</code>' option to omit '<code class="inline">source</code>' and '<code class="inline">options</code>'
tuples in the BEAM file.</p><p>Own Id: OTP-14087</p></li><li><p>Analyzing modules with binary construction with huge strings is now much
faster. The compiler also compiles such modules slightly faster.</p><p>Own Id: OTP-14125 Aux Id: ERL-308</p></li><li><p>Atoms may now contain arbitrary Unicode characters.</p><p>Own Id: OTP-14178</p></li><li><p><a href="compile.html#file/2"><code class="inline">compile:file/2</code></a> now accepts the option <code class="inline">extra_chunks</code> to include extra chunks
in the BEAM file.</p><p>Own Id: OTP-14221</p></li><li><p>The format of debug information that is stored in BEAM files (when
<code class="inline">debug_info</code> is used) has been changed. The purpose of the change is to better
support other BEAM-based languages such as Elixir or LFE.</p><p>All tools included in OTP (dialyzer, debugger, cover, and so on) will handle
both the new format and the previous format. Tools that retrieve the debug
information using <code class="inline">beam_lib:chunk(Beam, [abstract_code])</code> will continue to
work with both the new and old format. Tools that call
<code class="inline">beam_lib:chunk(Beam, [&quot;Abst&quot;])</code> will not work with the new format.</p><p>For more information, see the description of <code class="inline">debug_info</code> in the documentation
for <code class="inline">beam_lib</code> and the description of the <code class="inline">{debug_info,{Backend,Data}}</code> option
in the documentation for <code class="inline">compile</code>.</p><p>Own Id: OTP-14369 Aux Id: PR-1367</p></li><li><p>In a future release, <code class="inline">erlang:get_stacktrace/0</code> will probably only work when
called from within a '<code class="inline">try</code>' expression (otherwise it will return <code class="inline">[]</code>.</p><p>To help prepare for that change, the compiler will now by default warn if
'<code class="inline">get_stacktrace/0</code>' is used in a way that will not work in the future. Note
that the warning will not be issued if '<code class="inline">get_stacktrace/0</code>' is used in a
function that uses neither '<code class="inline">catch</code>' nor '<code class="inline">try</code>' (because that could be a
legal use if the function is called from within a '<code class="inline">try</code>'.</p><p>Own Id: OTP-14401</p></li></ul><h2 id="compiler-7-0-4-1" class="section-heading"><a href="#compiler-7-0-4-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.0.4.1</span></h2><h3 id="fixed-bugs-and-malfunctions-91" class="section-heading"><a href="#fixed-bugs-and-malfunctions-91" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fail labels on guard BIFs weren't taken into account during an optimization
pass, and a bug in the validation pass sometimes prevented this from being
noticed when a fault occurred.</p><p>Own Id: OTP-14522 Aux Id: ERIERL-48</p></li></ul><h2 id="compiler-7-0-4" class="section-heading"><a href="#compiler-7-0-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.0.4</span></h2><h3 id="fixed-bugs-and-malfunctions-92" class="section-heading"><a href="#fixed-bugs-and-malfunctions-92" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Minor internal changes. A typo in the documentation was also fixed.</p><p>Own Id: OTP-14240</p></li></ul><h2 id="compiler-7-0-3" class="section-heading"><a href="#compiler-7-0-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.0.3</span></h2><h3 id="fixed-bugs-and-malfunctions-93" class="section-heading"><a href="#fixed-bugs-and-malfunctions-93" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a compiler crash when maps were matched.</p><p>Own Id: OTP-13931 Aux Id: ERL-266</p></li><li><p>Fixed a compiler crash having to with the delayed sub-creation optimization.
(Thanks to Jose Valim for reporting this bug.)</p><p>Own Id: OTP-13947 Aux Id: ERL-268</p></li><li><p>The compiler option <code class="inline">inline_list_funcs</code> accidentally turned off some other
optimizations.</p><p>Own Id: OTP-13985</p></li><li><p>The compiler could sometimes generate spurious warnings when inlining was
enabled.</p><p>Own Id: OTP-14040 Aux Id: ERL-301</p></li></ul><h2 id="compiler-7-0-2" class="section-heading"><a href="#compiler-7-0-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.0.2</span></h2><h3 id="fixed-bugs-and-malfunctions-94" class="section-heading"><a href="#fixed-bugs-and-malfunctions-94" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>If the compiler fails to write the BEAM file, it will now report the reason of
the error for the write operation.</p><p>Own Id: OTP-13701</p></li><li><p>Fixed an internal compiler error. (Thanks to Svilen Ivanov for reporting this
bug.)</p><p>Own Id: OTP-13780 Aux Id: ERL-202</p></li><li><p>The compiler could crash when trying to compile a complicated expression with
multiple catches all on one line . (Thanks to Thomas Arts for reporting this
bug.)</p><p>Own Id: OTP-13804 Aux Id: ERL-209</p></li><li><p>Eliminated a few internal compiler failures.</p><p>Own Id: OTP-13863</p></li></ul><h2 id="compiler-7-0-1" class="section-heading"><a href="#compiler-7-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-95" class="section-heading"><a href="#fixed-bugs-and-malfunctions-95" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A literal binary matching regression was introduced in 19.0 where a match
could fail to resolve to the right clause. This has now been fixed.</p><p>Own Id: OTP-13738</p></li></ul><h2 id="compiler-7-0" class="section-heading"><a href="#compiler-7-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 7.0</span></h2><h3 id="fixed-bugs-and-malfunctions-96" class="section-heading"><a href="#fixed-bugs-and-malfunctions-96" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p><code class="inline">compile:forms/1,2</code> would crash when used in a working directory that had been
deleted by another process.</p><p>Own Id: OTP-13430 Aux Id: ERL-113</p></li><li><p>Dialyzer no longer crashes when there is an invalid function call such as
<code class="inline">42(7)</code> in a module being analyzed. The compiler will now warn for invalid
function calls such as <code class="inline">X = 42, x(7)</code>.</p><p>Own Id: OTP-13552 Aux Id: ERL-138</p></li></ul><h3 id="improvements-and-new-features-18" class="section-heading"><a href="#improvements-and-new-features-18" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Optimization of tuple matching has been slightly improved.</p><p>Own Id: OTP-12951</p></li><li><p>Five deprecated and undocumented functions in the module <code class="inline">core_lib</code> have been
removed. The functions are: <code class="inline">get_anno/{1,2}</code>, <code class="inline">is_literal/1</code>,
<code class="inline">is_literal_list/1</code>, and <code class="inline">literal_value</code>. Use the appropriate functions in the
<code class="inline">cerl</code> module instead.</p><p>Own Id: OTP-12979</p></li><li><p>The pre-processor can now expand the ?FUNCTION_NAME and ?FUNCTION_ARITY
macros.</p><p>Own Id: OTP-13059</p></li><li><p>The function mapfold/4 has been added to the <code class="inline">cerl_trees</code> module.</p><p>Own Id: OTP-13280</p></li><li><p>Bitstring comprehensions have been generalized to allow arbitrary expressions
in the construction part.</p><p>Own Id: OTP-13289</p></li><li><p>The compiler will now produce warnings for binary patterns that will never
match (example: <code class="inline">&lt;&lt;-1/unsigned&gt;&gt; = Bin</code>).</p><p>Own Id: OTP-13374 Aux Id: ERL-44</p></li><li><p>The compiler will no longer put the compilation date and time into BEAM files.
That means that two BEAM files compiled on the same computer from the same
source code and compilation options will be identical.</p><p>Note: If you want to find out whether a BEAM file on disk is different from
the loaded code, compared the MD5 value obtained from <code class="inline">Mod:module_info(md5)</code>
with the MD5 value obtained from <code class="inline">beam_lib:md5(BeamFileForMod)</code></p><p>.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-13504</p></li><li><p>The function <a href="compile.html#env_compiler_options/0"><code class="inline">compile:env_compiler_options/0</code></a> has been added to allow tools to
pick up the same default compiler options as the compiler itself.</p><p>Own Id: OTP-13654</p></li></ul><h2 id="compiler-6-0-3-1" class="section-heading"><a href="#compiler-6-0-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 6.0.3.1</span></h2><h3 id="fixed-bugs-and-malfunctions-97" class="section-heading"><a href="#fixed-bugs-and-malfunctions-97" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fail labels on guard BIFs weren't taken into account during an optimization
pass, and a bug in the validation pass sometimes prevented this from being
noticed when a fault occurred.</p><p>Own Id: OTP-14522 Aux Id: ERIERL-48</p></li></ul><h2 id="compiler-6-0-3" class="section-heading"><a href="#compiler-6-0-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 6.0.3</span></h2><h3 id="fixed-bugs-and-malfunctions-98" class="section-heading"><a href="#fixed-bugs-and-malfunctions-98" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>An complicated guard expression in a function call could crash the compiler.
(Thanks to Thomas Arts for reporting this bug.)</p><p>Own Id: OTP-13208</p></li><li><p>Constructing a map in a guard in a catch could crash the compiler. (Thanks to
Thomas Arts for reporting this bug.)</p><p>Own Id: OTP-13223</p></li><li><p>Updating a fun as if it were a map would cause the compiler to crash. (Thanks
to Thomas Arts for reporting this bug.)</p><p>Own Id: OTP-13231</p></li><li><p>Fix pretty printing of Core Maps</p><p>Literal maps could cause Dialyzer to crash when pretty printing the results.</p><p>Own Id: OTP-13238</p></li><li><p>A complex combination of bit syntax matching operations would cause an
internal consistency check failure during compilation. (Thanks to Jose Valim
for reporting this bug.)</p><p>Own Id: OTP-13309</p></li></ul><h2 id="compiler-6-0-2" class="section-heading"><a href="#compiler-6-0-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 6.0.2</span></h2><h3 id="fixed-bugs-and-malfunctions-99" class="section-heading"><a href="#fixed-bugs-and-malfunctions-99" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix cerl_trees:label/2 bug with map K/V swap</p><p>Own Id: OTP-13091</p></li><li><p>Warnings produced when the '<code class="inline">bin_opt_info</code>' option was given could sometimes
lack filenames and line numbers. (Thanks to José Valim for reporting this
bug.)</p><p>Own Id: OTP-13113</p></li></ul><h2 id="compiler-6-0-1" class="section-heading"><a href="#compiler-6-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 6.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-100" class="section-heading"><a href="#fixed-bugs-and-malfunctions-100" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fix <code class="inline">get_map_elements</code> register corruption</p><p>Instruction <code class="inline">get_map_elements</code> might destroy target registers when the
fail-label is taken. Only seen for patterns with two, and only two, target
registers. Specifically if we copy one register and then jump.</p><p>Own Id: OTP-12967</p></li></ul><h2 id="compiler-6-0" class="section-heading"><a href="#compiler-6-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 6.0</span></h2><h3 id="fixed-bugs-and-malfunctions-101" class="section-heading"><a href="#fixed-bugs-and-malfunctions-101" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler optimizes away building of terms that are never actually used. As
a result, the compiler in OTP 18 may produce more warnings for terms that are
built but not used than the compiler in OTP 17.</p><p>Own Id: OTP-12453</p></li><li><p>Using a map could incorrectly suppress warnings for unused variables.</p><p>Own Id: OTP-12515</p></li><li><p>The compiler now properly reports unknown parse transforms. That is, <code class="inline">undef</code>
exceptions coming from the parse transform itself is reported differently from
the absence of the parse transform.</p><p>Own Id: OTP-12723</p></li><li><p>Allow for 'creation of sub binary delayed' optimization if maps instructions
are in a clause.</p><p>Own Id: OTP-12758</p></li></ul><h3 id="improvements-and-new-features-19" class="section-heading"><a href="#improvements-and-new-features-19" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The <code class="inline">cerl</code> and <code class="inline">cerl_trees</code> modules in the Compiler application are now
documented.</p><p>Own Id: OTP-11978</p></li><li><p>The deprecated '<code class="inline">asm</code>' option has been removed.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-12100</p></li><li><p>Support variables as Map keys in expressions and patterns</p><p>Erlang will accept any expression as keys in Map expressions and it will
accept literals or bound variables as keys in Map patterns.</p><p>Own Id: OTP-12218</p></li><li><p>Infer Map type information in beam_type compiler optimization pass.</p><p>Own Id: OTP-12253</p></li><li><p>Compiler optimizations have been improved.</p><p>Own Id: OTP-12393</p></li><li><p>Five undocumented functions in the module <code class="inline">core_lib</code> have been deprecated and
will be removed in the next major release. The functions are:
<code class="inline">get_anno/{1,2}</code>, <code class="inline">is_literal/1</code>, <code class="inline">is_literal_list/1</code>, and <code class="inline">literal_value</code>.
Use the appropriate functions in the <code class="inline">cerl</code> module instead.</p><p>Own Id: OTP-12497</p></li><li><p>Change some internal data structures to Maps in order to speed up compilation
time. Measured speed up is around 10%-15%.</p><p>Own Id: OTP-12774</p></li><li><p>Fix beam_bool pass for Maps instruction get_map_elements</p><p>Before beam_split the get_map_elements instruction is still in blocks and the
helper function in beam_jump did not reflect this.</p><p>Own Id: OTP-12844 Aux Id: 17</p></li></ul><h2 id="compiler-5-0-4" class="section-heading"><a href="#compiler-5-0-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 5.0.4</span></h2><h3 id="fixed-bugs-and-malfunctions-102" class="section-heading"><a href="#fixed-bugs-and-malfunctions-102" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Matching out a map from a record and then updating the record could cause a
'badarg' exception at run-time. (Thanks to Dmitry Aleksandrov for reporting
this bug.)</p><p>Own Id: OTP-12402</p></li><li><p>The compiler would crash when compiling some complex, nonsensical guards such
as:</p><p>... <code class="inline">when {{X}}, -X</code>...</p><p>Own Id: OTP-12410</p></li><li><p>In rare circumstances, using binary pattern in the value part of a map pattern
would cause the compiler to crash.</p><p>Own Id: OTP-12414</p></li><li><p>Case expressions where a map was wrapped in a tuple or list such as:</p><p><code class="inline">case {a,Map} of</code><br/><code class="inline">{a,#{k:=_}}=Tuple -&gt; Tuple</code><br/><code class="inline">end.</code></p><p>would be unsafely &quot;optimized&quot; to either cause an exception at run-time or
would return an empty map.</p><p>Own Id: OTP-12451</p></li><li><p>When a variable was compared to a literal map using the '<code class="inline">==</code>' operator, the
compiler would change the operator to '<code class="inline">=:=</code>' since it is more efficient.
However, this optimization is not safe if the map literal has numeric keys or
values. The compiler will now only do the optimization if all keys and values
are non-numeric.</p><p>Own Id: OTP-12456</p></li></ul><h2 id="compiler-5-0-3" class="section-heading"><a href="#compiler-5-0-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 5.0.3</span></h2><h3 id="fixed-bugs-and-malfunctions-103" class="section-heading"><a href="#fixed-bugs-and-malfunctions-103" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Named funs with the same name and arity could get mixed up with each other.</p><p>Own Id: OTP-12262</p></li><li><p>Coalesce map keys in dialyzer mode</p><p>This fixes a regression introduced in commit
805f9c89fc01220bc1bb0f27e1b68fd4eca688ba The problem occurred with compounded
map keys compiled with dialyzer option turned on, '+dialyzer'.</p><p>Reported by: Ivan Uemlianin</p><p>Own Id: OTP-12347</p></li></ul><h2 id="compiler-5-0-2" class="section-heading"><a href="#compiler-5-0-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 5.0.2</span></h2><h3 id="fixed-bugs-and-malfunctions-104" class="section-heading"><a href="#fixed-bugs-and-malfunctions-104" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Corrected a bug with incorrect code generation when inlining was turned on.</p><p>Own Id: OTP-12132</p></li></ul><h2 id="compiler-5-0-1" class="section-heading"><a href="#compiler-5-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 5.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-105" class="section-heading"><a href="#fixed-bugs-and-malfunctions-105" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A Dialyzer crash involving analysis of Map types has now been fixed.</p><p>Own Id: OTP-11947</p></li><li><p>The compiler would fail to compile a file with a latin-1 character in the
false branch of an <code class="inline">-ifdef</code> or <code class="inline">-indef</code>.</p><p>Own Id: OTP-11987</p></li></ul><h2 id="compiler-5-0" class="section-heading"><a href="#compiler-5-0" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 5.0</span></h2><h3 id="fixed-bugs-and-malfunctions-106" class="section-heading"><a href="#fixed-bugs-and-malfunctions-106" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Line numbers would not be correct when a binary construction such as
'<code class="inline">&lt;&lt;Bin/binary,...&gt;&gt;</code>' fails. (Thanks to Stanislav Seletskiy for reporting
this bug.)</p><p>Own Id: OTP-11572</p></li><li><p>The compiler now properly annotates the code in value in the '<code class="inline">after</code>' clause
for a '<code class="inline">try</code>' so that Dialyzer no longer generates a false warning for an
unmatched return.</p><p>Own Id: OTP-11580</p></li><li><p>Some case statements where no clause would match could cause an internal error
in the compiler. (Thanks to Erik Soe Sorensen for reporting this bug.)</p><p>Own Id: OTP-11610</p></li><li><p>With <code class="inline">--Wunmatched_returns</code>, dialyzer will no longer warn when the value of a
list comprehension is ignored, provided that the each value in the list would
be an atomic value (such as integer or atoms, as opposed to tuples and lists).
Example: ignoring '<code class="inline">[io:format(...) || ...]</code>' will not cause a warning, while
ignoring '<code class="inline">[file:close(Fd) || ...]</code>' will.</p><p>Own Id: OTP-11626</p></li><li><p>Matching out a binary and applying the binary as if it were a fun would crash
the run-time system. (Thanks to Loïc Hoguin.)</p><p>Own Id: OTP-11672</p></li><li><p>Some local implementations of removing the last element from a list are
replaced by <a href="../../apps/stdlib/lists.html#droplast/1"><code class="inline">lists:droplast/1</code></a>. Note that this requires at least <code class="inline">stdlib-2.0</code>,
which is the stdlib version delivered in OTP 17.0. (Thanks to Hans Svensson)</p><p>Own Id: OTP-11678</p></li><li><p>Allow all auto imports to be suppressed at once. Introducing the
no_auto_import attribute: -compile(no_auto_import). Useful for code generation
tools that always use the qualified function names and want to avoid the auto
imported functions clashing with local ones. (Thanks to José Valim.)</p><p>Own Id: OTP-11682</p></li><li><p>Application upgrade (appup) files are corrected for the following
applications:</p><p><code class="inline">asn1, common_test, compiler, crypto, debugger, dialyzer, edoc, eldap, erl_docgen, et, eunit, gs, hipe, inets, observer, odbc, os_mon, otp_mibs, parsetools, percept, public_key, reltool, runtime_tools, ssh, syntax_tools, test_server, tools, typer, webtool, wx, xmerl</code></p><p>A new test utility for testing appup files is added to test_server. This is
now used by most applications in OTP.</p><p>(Thanks to Tobias Schlager)</p><p>Own Id: OTP-11744</p></li><li><p>Adapt 'asm' deprecation message to new version scheme. (Thanks to Tuncer Ayaz)</p><p>Own Id: OTP-11751</p></li><li><p>A number of compiler errors where unusual or nonsensical code would crash the
compiler have been reported by Ulf Norell and corrected by Anthony Ramine.</p><p>Own Id: OTP-11770</p></li></ul><h3 id="improvements-and-new-features-20" class="section-heading"><a href="#improvements-and-new-features-20" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Compilation times for modules with a huge number for record accesses using the
dot operator has been improved.</p><p>Own Id: OTP-10652</p></li><li><p>The compiler can generate somewhat better code by moving let expressions into
sequences. (Thanks to Anthony Ramine.)</p><p>Own Id: OTP-11056</p></li><li><p>Forbid unsized fields in patterns of binary generators and simplified
v3_core's translation of bit string generators. (Thanks to Anthony Ramine.)</p><p>Own Id: OTP-11186</p></li><li><p>Funs can now be a given a name. Thanks to to Richard O'Keefe for the idea
(EEP37) and to Anthony Ramine for the implementation.</p><p>Own Id: OTP-11537</p></li><li><p>Using the <code class="inline">from_asm</code> option to produce a BEAM file starting from BEAM assembly
code would often fail because early optimization passes would not understand
instructions that later optimization passes would introduce. (Thanks to
Anthony Ramine.)</p><p>Own Id: OTP-11544</p></li><li><p>The <code class="inline">.core</code> and <code class="inline">.S</code> extensions are now documented in the <code class="inline">erlc</code>
documentation, and the '<code class="inline">from_core</code>' and '<code class="inline">from_asm</code>' options are now
documented in the compiler documentation. (Thanks to Tuncer Ayaz.)</p><p>Own Id: OTP-11547</p></li><li><p>Optimization of case expressions that build tuples or lists have been
improved.</p><p>Own Id: OTP-11584</p></li><li><p>EEP43: New data type - Maps</p><p>With Maps you may for instance:</p><ul><li><p>____ - <code class="inline">M0 = #{ a =&gt; 1, b =&gt; 2}, % create associations</code></p></li><li><p>____ - <code class="inline">M1 = M0#{ a := 10 }, % update values</code></p></li><li><p>____ - <code class="inline">M2 = M1#{ &quot;hi&quot; =&gt; &quot;hello&quot;}, % add new associations</code></p></li><li><p>____ - <code class="inline">#{ &quot;hi&quot; := V1, a := V2, b := V3} = M2. % match keys with values</code></p></li></ul><p>For information on how to use Maps please see Map Expressions in the
<a href="../../system/expressions.html#map-expressions">Reference Manual</a>.</p><p>The current implementation is without the following features:</p><ul><li><p>____ - No variable keys</p></li><li><p>____ - No single value access</p></li><li><p>____ - No map comprehensions</p></li></ul><p>Note that Maps is <em>experimental</em> during OTP 17.0.</p><p>Own Id: OTP-11616</p></li><li><p>Some function specs are corrected or moved and some edoc comments are
corrected in order to allow use of edoc. (Thanks to Pierre Fenoll)</p><p>Own Id: OTP-11702</p></li><li><p>Thanks to Anthony Ramine for several improvements to the optimizations in the
BEAM compiler and for cleaning up the code the code that transforms list and
binary comprehensions to Core Erlang.</p><p>Own Id: OTP-11720</p></li><li><p>The default encoding for Erlang source files is now UTF-8. As a temporary
measure to ease the transition from the old default of latin-1, if the
compiler encounters byte sequences that are not valid UTF-8 sequences, the
compiler will re-try the compilation in latin-1 mode. This workaround will be
removed in a future release.</p><p>Own Id: OTP-11791</p></li></ul><h2 id="compiler-4-9-4" class="section-heading"><a href="#compiler-4-9-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.9.4</span></h2><h3 id="fixed-bugs-and-malfunctions-107" class="section-heading"><a href="#fixed-bugs-and-malfunctions-107" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Typo fix ambigous -&gt; ambiguous. Thanks to Leo Correa.</p><p>Own Id: OTP-11455</p></li></ul><h3 id="improvements-and-new-features-21" class="section-heading"><a href="#improvements-and-new-features-21" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Lift 'after' blocks to zeroary functions. Thanks to Anthony Ramine.</p><p>Own Id: OTP-11267</p></li></ul><h2 id="compiler-4-9-3" class="section-heading"><a href="#compiler-4-9-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.9.3</span></h2><h3 id="fixed-bugs-and-malfunctions-108" class="section-heading"><a href="#fixed-bugs-and-malfunctions-108" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Expressions such as <code class="inline">'B = is_integer(V), if B and B -&gt; ok end'</code> would crash
the compiler.</p><p>Own Id: OTP-11240</p></li><li><p><code class="inline">compile:file2/2</code> with the option <code class="inline">report_errors</code> could return ErrorInfo
tuples with only two elements, while the documentation says that the ErrorInfo
tuple always has three elements. Also updated the documentation to add that
the first element may be '<code class="inline">none</code>' if no line number is applicable.</p><p>Own Id: OTP-11304 Aux Id: seq12412</p></li></ul><h3 id="improvements-and-new-features-22" class="section-heading"><a href="#improvements-and-new-features-22" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Fix matching of floating point middle-endian machines. Thanks to Johannes
Weissl.</p><p>Own Id: OTP-11201</p></li><li><p>Restrict inlining of local fun references. Thanks to Anthony Ramine.</p><p>Own Id: OTP-11211</p></li><li><p>Silence a misleading warning with some comprehensions. Thanks to Anthony
Ramine.</p><p>Own Id: OTP-11212</p></li><li><p>Forbid returning a match context in beam_validator. Thanks to Anthony Ramine.</p><p>Own Id: OTP-11247</p></li></ul><h2 id="compiler-4-9-2" class="section-heading"><a href="#compiler-4-9-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.9.2</span></h2><h3 id="fixed-bugs-and-malfunctions-109" class="section-heading"><a href="#fixed-bugs-and-malfunctions-109" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Compiling functions with complex boolean operations in guards could be very
slow. (Thanks to Magnus Muller for reporting this issue.)</p><p>Own Id: OTP-10939</p></li><li><p>Certain guard expressions used in a receive statement could cause the compiler
to crash.</p><p>Own Id: OTP-11119 Aux Id: seq12342</p></li></ul><h3 id="improvements-and-new-features-23" class="section-heading"><a href="#improvements-and-new-features-23" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Fix optimization of some binary comprehensions. Thanks to Anthony Ramine.</p><p>Own Id: OTP-11005</p></li><li><p>Use a set to store ref registers in beam_receive. Thanks to Anthony Ramine.</p><p>Own Id: OTP-11069</p></li><li><p>Fix renaming of bs_put_string instructions. Thanks to Anthony Ramine.</p><p>Own Id: OTP-11129</p></li></ul><h2 id="compiler-4-9-1" class="section-heading"><a href="#compiler-4-9-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.9.1</span></h2><h3 id="fixed-bugs-and-malfunctions-110" class="section-heading"><a href="#fixed-bugs-and-malfunctions-110" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler would crash attempting to compile expressions such as &quot;element(2,
not_tuple)&quot;.</p><p>Own Id: OTP-10794</p></li><li><p>Forbid multiple values in Core Erlang sequence arguments. Thanks to José Valim
and Anthony Ramine.</p><p>Own Id: OTP-10818</p></li><li><p>An unsafe optimization would cause the compiler to crash with an internal
error for certain complex code sequences.</p><p>Own Id: OTP-10825 Aux Id: seq12247</p></li></ul><h3 id="improvements-and-new-features-24" class="section-heading"><a href="#improvements-and-new-features-24" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Integers in expression that will give a floating point result (such as
&quot;<code class="inline">X / 2</code>&quot; will now be converted to floating point at compile-time. (Suggested
by Richard O'Keefe.)</p><p>Identical floating points constans in a module will now be coalesced to one
entry in the constant pool.</p><p>Own Id: OTP-10788</p></li></ul><h2 id="compiler-4-9" class="section-heading"><a href="#compiler-4-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.9</span></h2><h3 id="improvements-and-new-features-25" class="section-heading"><a href="#improvements-and-new-features-25" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The compiler optimizations have been polished, so that the code quality will
be slightly better in some cases.</p><p>Own Id: OTP-10193</p></li><li><p>Support for Unicode has been implemented.</p><p>Own Id: OTP-10302</p></li><li><p>Where necessary a comment stating encoding has been added to Erlang files. The
comment is meant to be removed in Erlang/OTP R17B when UTF-8 becomes the
default encoding.</p><p>Own Id: OTP-10630</p></li><li><p>Fix some wrong warnings triggered by the option inline_list_funcs. Thanks to
Anthony Ramine.</p><p>Own Id: OTP-10690</p></li><li><p>Forbid local fun variables in Core Erlang guards. Thanks to Anthony Ramine.</p><p>Own Id: OTP-10706</p></li><li><p>Binary syntax matches could cause an internal consistency error in in the
compiler. (Thanks to Viktor Sovietov for reporting this bug.)</p><p>Own Id: OTP-10724</p></li></ul><h2 id="compiler-4-8-2" class="section-heading"><a href="#compiler-4-8-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.8.2</span></h2><h3 id="fixed-bugs-and-malfunctions-111" class="section-heading"><a href="#fixed-bugs-and-malfunctions-111" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Modules with very many functions would compile very slowly.</p><p>Own Id: OTP-10123</p></li><li><p><a href="compile.html#forms/2"><code class="inline">compile:forms/2</code></a> will now use a {source,SourceFilePath} to set the source
returned by <code class="inline">module_info(compile)</code> (Thanks to José Valim)</p><p>Own Id: OTP-10150</p></li><li><p>A process which had enabled trap_exit would receive EXIT messages after
calling the compiler. (Thanks to Jeremy Heater.)</p><p>Own Id: OTP-10171</p></li><li><p>Fix messages ordering with column numbers</p><p>Own Id: OTP-10183</p></li><li><p>sys_pre_expand: Fix BASE never being set</p><p>Commit a612e99fb5aaa934fe5a8591db0f083d7fa0b20a turned module attributes from
2-tuples to 3-tuples but forgot to update get_base/1, breaking BASE for
parametric modules.</p><p>Own Id: OTP-10184</p></li><li><p>The compiler will now issue a warning if literal tuple funs are used. For
example, {erlang,is_tuple}(X) will now generate a warning.</p><p>Own Id: OTP-10185</p></li><li><p>The compiler will now warn for illegal sizes for segments in binary
construction. For example, &lt;&lt;X:(2.5)&gt;&gt; will now cause the compiler to issue a
warning.</p><p>Own Id: OTP-10197</p></li><li><p>Fix the erlc -MP flag</p><p>Because of a copy-and-paste error in erlc.c, the -MP flag had the same effect
as -MG. As a workaround, you had to pass +makedep_phony to enable the MP
option. This patch makes -MP work as intended.</p><p>Own Id: OTP-10211</p></li></ul><h2 id="compiler-4-8-1" class="section-heading"><a href="#compiler-4-8-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.8.1</span></h2><h3 id="fixed-bugs-and-malfunctions-112" class="section-heading"><a href="#fixed-bugs-and-malfunctions-112" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In rare circumstance, the compiler could crash when compiling a case
statement. (Thanks to Hakan Mattsson.)</p><p>Own Id: OTP-9842</p></li><li><p>Calling a guard test (such as is_list/1) from the top-level in a guard, would
cause a compiler crash if there was a local definition with the same name.
Corrected to reject the program with an error message.</p><p>Own Id: OTP-9866</p></li><li><p>Using <a href="../../apps/erts/erlang.html#get/1"><code class="inline">get/1</code></a> in a <code class="inline">try</code> block could in some cases cause an
internal compiler error. (Thanks to Eric Merritt.)</p><p>Own Id: OTP-9867</p></li><li><p>An unexported on_load function would not get run if the module was compiled
with the <code class="inline">inline</code> option. (Thanks to Yiannis Tsiouris.)</p><p>Own Id: OTP-9910</p></li><li><p>Fixed a discrepancy in compile_info</p><p>The BEAM disassembler used the atom 'none' to signify the absence of a
compile_info chunk in a .beam file. This clashed with the type declaration of
the compile_info field of a #beam_file{} record as containing a list. Now []
signifies the absence of this chunk. This simplifies the code and avoids a
dialyzer warning.</p><p>Own Id: OTP-9917</p></li><li><p>Fix typo in `compile' doc: unmatched parenthesis (Thanks to Ricardo Catalinas
Jiménez)</p><p>Own Id: OTP-9919</p></li><li><p>In a <code class="inline">try</code>...<code class="inline">catch</code> statement that always returned <code class="inline">false</code>, the compiler
would remove calls to BIFs that could not cause an exception (such as
<a href="../../apps/erts/erlang.html#put/2"><code class="inline">put/2</code></a>). Example of such code:
<code class="inline">try put(K, V), false catch _:_ -&gt; false end.</code></p><p>Own Id: OTP-9982</p></li></ul><h2 id="compiler-4-8" class="section-heading"><a href="#compiler-4-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.8</span></h2><h3 id="fixed-bugs-and-malfunctions-113" class="section-heading"><a href="#fixed-bugs-and-malfunctions-113" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Add '-callback' attributes in stdlib's behaviours</p><p>Replace the behaviour_info(callbacks) export in stdlib's behaviours with
-callback' attributes for all the callbacks. Update the documentation with
information on the callback attribute Automatically generate 'behaviour_info'
function from '-callback' attributes</p><p>'behaviour_info(callbacks)' is a special function that is defined in a module
which describes a behaviour and returns a list of its callbacks.</p><p>This function is now automatically generated using the '-callback' specs. An
error is returned by lint if user defines both '-callback' attributes and the
behaviour_info/1 function. If no type info is needed for a callback use a
generic spec for it. Add '-callback' attribute to language syntax</p><p>Behaviours may define specs for their callbacks using the familiar spec
syntax, replacing the '-spec' keyword with '-callback'. Simple lint checks are
performed to ensure that no callbacks are defined twice and all types referred
are declared.</p><p>These attributes can be then used by tools to provide documentation to the
behaviour or find discrepancies in the callback definitions in the callback
module.</p><p>Add callback specs into 'application' module in kernel Add callback specs to
tftp module following internet documentation Add callback specs to
inets_service module following possibly deprecated comments</p><p>Own Id: OTP-9621</p></li><li><p>The calculation of the 'uniq' value for a fun (see <a href="../../apps/erts/erlang.html#fun_info/1"><code class="inline">erlang:fun_info/1</code></a>) was
too weak and has been strengthened. It used to be based on the only the code
for the fun body, but it is now based on the MD5 of the BEAM code for the
module.</p><p>Own Id: OTP-9667</p></li></ul><h3 id="improvements-and-new-features-26" class="section-heading"><a href="#improvements-and-new-features-26" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Variables are now now allowed in '<code class="inline">fun M:F/A</code>' as suggested by Richard O'Keefe
in EEP-23.</p><p>The representation of '<code class="inline">fun M:F/A</code>' in the abstract format has been changed in
an incompatible way. Tools that directly read or manipulate the abstract
format (such as parse transforms) may need to be updated. The compiler can
handle both the new and the old format (i.e. extracting the abstract format
from a pre-R15 BEAM file and compiling it using compile:forms/1,2 will work).
The <code class="inline">syntax_tools</code> application can also handle both formats.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-9643</p></li><li><p><code class="inline">filename:find_src/1,2</code> will now work on stripped BEAM files (reported by Per
Hedeland). The HiPE compiler will also work on stripped BEAM files. The BEAM
compiler will no longer include compilation options given in the source code
itself in <code class="inline">M:module_info(compile)</code> (because those options will be applied
anyway if the module is re-compiled).</p><p>Own Id: OTP-9752</p></li><li><p>Inlining binary matching could cause an internal compiler error. (Thanks to
Rene Kijewski for reporting this bug.)</p><p>Own Id: OTP-9770</p></li></ul><h2 id="compiler-4-7-5" class="section-heading"><a href="#compiler-4-7-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.7.5</span></h2><h3 id="fixed-bugs-and-malfunctions-114" class="section-heading"><a href="#fixed-bugs-and-malfunctions-114" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Compiler options given in the source code using a <code class="inline">-compile()</code> attribute used
to be included twice in <code class="inline">Mod:module_info(compile)</code>. They are now only included
once at the beginning of the list of options.</p><p>Own Id: OTP-9534</p></li><li><p>beam_disasm: Handle stripped BEAM files</p><p>beam_disasm:file/1 would crash if asked to disassemble a stripped BEAM file
without an &quot;Attr&quot; chunk. (Thanks to Haitao Li)</p><p>Own Id: OTP-9571</p></li></ul><h2 id="compiler-4-7-4" class="section-heading"><a href="#compiler-4-7-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.7.4</span></h2><h3 id="fixed-bugs-and-malfunctions-115" class="section-heading"><a href="#fixed-bugs-and-malfunctions-115" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>If a variable is matched out in binary matching and used as the size for a
binary element, it would seem to be unbound if used in a subsequent match
operation. (Thanks to Bernard Duggan.)</p><p>Own Id: OTP-9134</p></li><li><p>Eliminate incorrect warning in <code class="inline">sys_core_fold</code></p><p>Own Id: OTP-9152</p></li></ul><h2 id="compiler-4-7-3" class="section-heading"><a href="#compiler-4-7-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.7.3</span></h2><h3 id="fixed-bugs-and-malfunctions-116" class="section-heading"><a href="#fixed-bugs-and-malfunctions-116" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The <code class="inline">-export_type()</code> directive is no longer included among the attributes.</p><p>Own Id: OTP-8998</p></li></ul><h3 id="improvements-and-new-features-27" class="section-heading"><a href="#improvements-and-new-features-27" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The maximum number of allowed arguments for an Erlang function has been
lowered from 256 to 255, so that the number of arguments can now fit in a
byte.</p><p>Own Id: OTP-9049</p></li><li><p>Dependency generation for Makefiles has been added to the compiler and erlc.
See the manual pages for <code class="inline">compile</code> and <code class="inline">erlc</code>. (Thanks to Jean-Sebastien
Pedron.)</p><p>Own Id: OTP-9065</p></li></ul><h2 id="compiler-4-7-2" class="section-heading"><a href="#compiler-4-7-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.7.2</span></h2><h3 id="fixed-bugs-and-malfunctions-117" class="section-heading"><a href="#fixed-bugs-and-malfunctions-117" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Two compiler bugs (that would cause the compiler to terminate) reported by
Christopher Williams have been fixed.</p><p>Own Id: OTP-8949</p></li></ul><h3 id="improvements-and-new-features-28" class="section-heading"><a href="#improvements-and-new-features-28" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The compiler would translate binary comprehensions containing tail segments in
a way that would would confuse Dialyzer. For instance:</p><p><code class="inline">[42 || &lt;&lt;_:8/integer, _/bits&gt;&gt; &lt;= Bits]</code></p><p>would produce a Dialyzer warning.</p><p>Own Id: OTP-8864</p></li><li><p>Code such as <code class="inline">foo(A) -&gt; &lt;&lt;A:0&gt;&gt;</code> would crash the compiler.</p><p>Own Id: OTP-8865</p></li><li><p>The compiler could fail with an internal error when variables were exported
from a receive block but the return value of the receive block were not used.
(Thanks to Jim Engquist for reporting this error.)</p><p>Own Id: OTP-8888</p></li></ul><h2 id="compiler-4-7-1" class="section-heading"><a href="#compiler-4-7-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.7.1</span></h2><h3 id="improvements-and-new-features-29" class="section-heading"><a href="#improvements-and-new-features-29" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Eliminated warnings for auto-imported BIF clashes.</p><p>Own Id: OTP-8840</p></li></ul><h2 id="compiler-4-7" class="section-heading"><a href="#compiler-4-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.7</span></h2><h3 id="fixed-bugs-and-malfunctions-118" class="section-heading"><a href="#fixed-bugs-and-malfunctions-118" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Several problems in the inliner have been fixed.</p><p>Own Id: OTP-8552</p></li></ul><h3 id="improvements-and-new-features-30" class="section-heading"><a href="#improvements-and-new-features-30" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The module binary from EEP31 (and EEP9) is implemented.</p><p>Own Id: OTP-8217</p></li><li><p>Local and imported functions now override the auto-imported BIFs when the
names clash. The pre R14 behaviour was that auto-imported BIFs would override
local functions. To avoid that old programs change behaviour, the following
will generate an error:</p><ul><li>Doing a call without explicit module name to a local function having a name
clashing with the name of an auto-imported BIF that was present (and
auto-imported) before OTP R14A</li><li>Explicitly importing a function having a name clashing with the name of an
autoimported BIF that was present (and autoimported) before OTP R14A</li><li>Using any form of the old compiler directive <code class="inline">nowarn_bif_clash</code></li></ul><p>If the BIF was added or auto-imported in OTP R14A or later, overriding it with
an import or a local function will only result in a warning,</p><p>To resolve clashes, you can either use the explicit module name <code class="inline">erlang</code> to
call the BIF, or you can remove the auto-import of that specific BIF by using
the new compiler directive <code class="inline">-compile({no_auto_import,[F/A]}).</code>, which makes
all calls to the local or imported function without explicit module name pass
without warnings or errors.</p><p>The change makes it possible to add auto-imported BIFs without breaking or
silently changing old code in the future. However some current code
ingeniously utilizing the old behaviour or the <code class="inline">nowarn_bif_clash</code> compiler
directive, might need changing to be accepted by the compiler.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-8579</p></li><li><p>The undocumented, unsupported, and deprecated function <code class="inline">lists:flat_length/1</code>
has been removed.</p><p>Own Id: OTP-8584</p></li><li><p>Nested records can now be accessed without parenthesis. See the Reference
Manual for examples. (Thanks to YAMASHINA Hio and Tuncer Ayaz.)</p><p>Own Id: OTP-8597</p></li><li><p>It is now possible to suppress the warning in code such as
&quot;<code class="inline">list_to_integer(S), ok</code>&quot; by assigning the ignored value &quot;<em>&quot; like this: &quot;`</em> =
list_to_integer(S), ok`&quot;.</p><p>Own Id: OTP-8602</p></li><li><p><code class="inline">receive</code> statements that can only read out a newly created reference are now
specially optimized so that it will execute in constant time regardless of the
number of messages in the receive queue for the process. That optimization
will benefit calls to <code class="inline">gen_server:call()</code>. (See <code class="inline">gen:do_call/4</code> for an example
of a receive statement that will be optimized.)</p><p>Own Id: OTP-8623</p></li><li><p>The compiler optimizes record operations better.</p><p>Own Id: OTP-8668</p></li></ul><h2 id="compiler-4-6-5" class="section-heading"><a href="#compiler-4-6-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.6.5</span></h2><h3 id="fixed-bugs-and-malfunctions-119" class="section-heading"><a href="#fixed-bugs-and-malfunctions-119" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Using complex boolean expressions in ifs could cause the compiler to either
crash or terminate with an internal error. (Thanks to Simon Cornish.)</p><p>Own Id: OTP-8338</p></li><li><p>Bit string comprehensions can now be used in parameterized modules. (Thanks to
Jebu Ittiachen.)</p><p>Own Id: OTP-8447</p></li></ul><h3 id="improvements-and-new-features-31" class="section-heading"><a href="#improvements-and-new-features-31" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The expected return value for an on_load function has been changed. (See the
section about code loading in the Reference manual.)</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-8339</p></li><li><p>In rare circumstances when using garbaging collecting guard BIFs, the
validation pass (beam_validator) would signal that the code was unsafe, when
it in fact was correct. (Thanks to Kiran Khaladkar.)</p><p>Own Id: OTP-8378</p></li><li><p>The <code class="inline">-Werror</code> option for <code class="inline">erlc</code> and the compiler option <code class="inline">warnings_as_errors</code>
will cause warnings to be treated as errors. (Thanks to Christopher Faulet.)</p><p>Own Id: OTP-8382</p></li><li><p>Macros overloading has been implemented. (Thanks to Christopher Faulet.)</p><p>Own Id: OTP-8388</p></li></ul><h2 id="compiler-4-6-4" class="section-heading"><a href="#compiler-4-6-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.6.4</span></h2><h3 id="fixed-bugs-and-malfunctions-120" class="section-heading"><a href="#fixed-bugs-and-malfunctions-120" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler's 'E' option now works with modules with types and
specifications.</p><p>Own Id: OTP-8238 Aux Id: OTP-8150</p></li><li><p>Certain uses of binary matching in a <code class="inline">begin</code>-<code class="inline">end</code> in a list comprehension
could cause the compiler to crash or generate incorrect code.</p><p>Own Id: OTP-8271</p></li></ul><h3 id="improvements-and-new-features-32" class="section-heading"><a href="#improvements-and-new-features-32" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The documentation is now built with open source tools (xsltproc and fop) that
exists on most platforms. One visible change is that the frames are removed.</p><p>Own Id: OTP-8201</p></li><li><p>The compiler could crash if invalid calls to is_record/2 was used in (for
example) a list comprehension. (Thanks to Tobias Lindahl.)</p><p>Own Id: OTP-8269</p></li><li><p>The -on_load() directive can be used to run a function when a module is
loaded. It is documented in the section about code loading in the Reference
Manual.</p><p>Own Id: OTP-8295</p></li></ul><h2 id="compiler-4-6-3" class="section-heading"><a href="#compiler-4-6-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.6.3</span></h2><h3 id="improvements-and-new-features-33" class="section-heading"><a href="#improvements-and-new-features-33" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Corrected liveness optimization to eliminate a compiler crash that could occur
when compiling bit syntax construction code. (Thanks to Mikage Sawatari.)</p><p>Calling BIFs such as <a href="../../apps/erts/erlang.html#length/1"><code class="inline">length/1</code></a> in guard context in a try/catch
block could cause a compiler crash. (Thanks to Paul Fisher.)</p><p>Using filter expressions containing <code class="inline">andalso</code> or <code class="inline">orelse</code> in a list
comprehension could cause a compiler crash. (Thanks to Martin Engström.)</p><p>Own Id: OTP-8054</p></li><li><p>A guard with nested 'not' operators could cause the compiler to crash. (Thanks
to Tuncer Ayaz.)</p><p>Own Id: OTP-8131</p></li></ul><h2 id="compiler-4-6-2" class="section-heading"><a href="#compiler-4-6-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.6.2</span></h2><h3 id="fixed-bugs-and-malfunctions-121" class="section-heading"><a href="#fixed-bugs-and-malfunctions-121" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler would crash while compiling certain complex function bodies
containing <code class="inline">receive after</code> due to a bug in the jump optimizer (a label that
had only had backward references could still be removed). (Thanks to Vincent
de Phily.)</p><p>Own Id: OTP-7980</p></li></ul><h2 id="compiler-4-6-1" class="section-heading"><a href="#compiler-4-6-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.6.1</span></h2><h3 id="fixed-bugs-and-malfunctions-122" class="section-heading"><a href="#fixed-bugs-and-malfunctions-122" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Miscellaneous minor bugs fixed.</p><p>Own Id: OTP-7937</p></li></ul><h3 id="improvements-and-new-features-34" class="section-heading"><a href="#improvements-and-new-features-34" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>There will be more efficient code if there is a clause that matches the empty
binary and no other clauses that matches non-empty binaries.</p><p>Own Id: OTP-7924</p></li><li><p>There is new option to allow a module to have a module name other than the
filename. Do not use it unless you know what you are doing.</p><p>Own Id: OTP-7927</p></li></ul><h2 id="compiler-4-6-0-1" class="section-heading"><a href="#compiler-4-6-0-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.6.0.1</span></h2><h3 id="fixed-bugs-and-malfunctions-123" class="section-heading"><a href="#fixed-bugs-and-malfunctions-123" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Using <code class="inline">andalso</code>/<code class="inline">orelse</code> or record access in a <code class="inline">try</code>...<code class="inline">catch</code> could cause a
compiler crash.</p><p>Some large and complex functions could require extremely long compilation
times (hours or days).</p><p>Own Id: OTP-7905</p></li></ul><h2 id="compiler-4-6" class="section-heading"><a href="#compiler-4-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.6</span></h2><h3 id="fixed-bugs-and-malfunctions-124" class="section-heading"><a href="#fixed-bugs-and-malfunctions-124" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>For some complex guards which used <code class="inline">andalso</code>/<code class="inline">orelse</code>, the compiler would
crash. (Thanks to Hunter Morris.)</p><p>Own Id: OTP-7679</p></li><li><p>Code that (incorrectly) used the the value of nested applications of
<a href="../../apps/erts/erlang.html#setelement/3"><code class="inline">setelement/3</code></a> in bit syntax construction could crash the
compiler.</p><p>Own Id: OTP-7690</p></li><li><p>Modules containing huge integers (consisting of several hundreds of thousands
of digits or more) could be slow to compile. This problem has been corrected.</p><p>Own Id: OTP-7707 Aux Id: seq11129</p></li><li><p>If the generator in a list comprehension is given a non-list term, there will
now be <code class="inline">function_clause</code> exception instead of a <code class="inline">case_clause</code> exception (as it
was in all releases before R12B).</p><p>Own Id: OTP-7844</p></li></ul><h3 id="improvements-and-new-features-35" class="section-heading"><a href="#improvements-and-new-features-35" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The compiler could crash if the size for a binary segment in matching was a
complex literal such as binary or tuple.</p><p>Own Id: OTP-7650</p></li><li><p>The compiler generates more compact and faster code for matching of complex
constants (such as constant lists and tuples).</p><p>Own Id: OTP-7655</p></li><li><p>The undocumented, unsupported, and deprecated guard BIF <code class="inline">is_constant/1</code> has
been removed.</p><p>*<strong> INCOMPATIBILITY with R12B *</strong></p><p>Own Id: OTP-7673</p></li><li><p>The compiler generates better code for many guard expressions, and especially
for guards that use <code class="inline">andalso</code>/<code class="inline">orelse</code> or record fields.</p><p>(In technical terms, <code class="inline">andalso</code>/<code class="inline">orelse</code> in a guard would case the creation of
a stack frame and saving of all x registers that could potentially be alive
after the guard and restoring all x registers before leaving the guard. For
certain guards, far too many x registers were saved and subsequently restored.
In this version of the compiler, no stack frame is created and no x registers
are saved and restored.)</p><p>Own Id: OTP-7718</p></li><li><p>The default size for the resulting binary created by a binary comprehension
was 64Kb in R12B (it would grow if needed). This was often far too much. In
this release, the default is changed to 256 bytes. Furthermore, for most
binary comprehensions without filters, the exact size of the resulting binary
can be calculated beforehand and the compiler now generates code that does
that calculation.</p><p>Own Id: OTP-7737</p></li><li><p>The short-circuit operators <code class="inline">andalso</code> and <code class="inline">orelse</code> no longer guarantees that
their second argument is either <code class="inline">true</code> or <code class="inline">false</code>. As a consequence,
<code class="inline">andalso</code>/<code class="inline">orelse</code> are now tail-recursive.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-7748</p></li><li><p>The compiler will refuse to a compile file where the module name in the file
differs from the output file name.</p><p>When compiling using <code class="inline">erlc</code>, the current working directory will no be included
in the code path (unless explicitly added using &quot;-pa .&quot;).</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-7793</p></li><li><p>There will no longer be any warnings for list comprehensions without
generators, as such list comprehension have turned out to be useful.</p><p>Own Id: OTP-7846</p></li><li><p>Warnings for obsolete guard tests are now turned on. (That is, writing
<a href="../../apps/erts/erlang.html#t:list/1"><code class="inline">list(L)</code></a> in a guard instead of <a href="../../apps/erts/erlang.html#is_list/1"><code class="inline">is_list(L)</code></a> will
generate a warning.)</p><p>The warnings can be turned off using the <code class="inline">nowarn_obsolete_guard</code> option.</p><p>Own Id: OTP-7850</p></li><li><p>The copyright notices have been updated.</p><p>Own Id: OTP-7851</p></li><li><p>If a module contains an exported function with the same name as an
auto-imported BIF (such as <a href="../../apps/erts/erlang.html#length/1"><code class="inline">length/1</code></a>), any calls to the BIF
must have an explicit <code class="inline">erlang:</code> prefix, or there will be a compilation error
(such calls would only generate a warning in previous releases).</p><p>(The reason for the change is to avoid breaking code in a future major
release, R14 or R15, in which we plan to make calls without a module prefix
always call the local function in the same module even if there is an
auto-imported BIF with the same name.)</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-7873</p></li></ul><h2 id="compiler-4-5-5" class="section-heading"><a href="#compiler-4-5-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.5.5</span></h2><h3 id="fixed-bugs-and-malfunctions-125" class="section-heading"><a href="#fixed-bugs-and-malfunctions-125" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Matching on a zero-width segment in the bit syntax would crash the compiler.
(Thanks to Will.)</p><p>Own Id: OTP-7591</p></li></ul><h3 id="improvements-and-new-features-36" class="section-heading"><a href="#improvements-and-new-features-36" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>In bit syntax expressions which started with a binary segment, and was
followed by at least two segments of variable size, too little space could be
allocated for the binary, leading to memory corruption.</p><p>Own Id: OTP-7556</p></li><li><p>In user-defined attributes, <code class="inline">Name/Arity</code> is now allowed and will be translated
to <code class="inline">{Name,Arity}</code>. (An implementation of EEP-24 by Richard O'Keefe.)</p><p>The <code class="inline">module_info/{0,1}</code> functions automatically inserted into each compiled
modules are now documented in the Modules section in the Reference Manual.</p><p>Own Id: OTP-7586</p></li></ul><h2 id="compiler-4-5-4" class="section-heading"><a href="#compiler-4-5-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.5.4</span></h2><h3 id="improvements-and-new-features-37" class="section-heading"><a href="#improvements-and-new-features-37" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Certain complex bit syntax matching operations matching out binaries and
having several clauses could give incorrect results (the matched out binaries
were too short). (Thanks to Christian von Roques for bug report and
correction.)</p><p>Own Id: OTP-7498</p></li></ul><h2 id="compiler-4-5-3" class="section-heading"><a href="#compiler-4-5-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.5.3</span></h2><h3 id="improvements-and-new-features-38" class="section-heading"><a href="#improvements-and-new-features-38" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>New option <code class="inline">warn_export_all</code> to warn for a module using <code class="inline">export_all</code>. (Thanks
to Richard Carlsson.)</p><p>Own Id: OTP-7392</p></li></ul><h2 id="compiler-4-5-2-1" class="section-heading"><a href="#compiler-4-5-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.5.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-126" class="section-heading"><a href="#fixed-bugs-and-malfunctions-126" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In rare circumstances, the length/1 BIF (and a few other guard BIFs) would
seem to return an incorrect value (of any type).</p><p>Own Id: OTP-7345 Aux Id: seq10962</p></li></ul><h2 id="compiler-4-5-2" class="section-heading"><a href="#compiler-4-5-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.5.2</span></h2><h3 id="fixed-bugs-and-malfunctions-127" class="section-heading"><a href="#fixed-bugs-and-malfunctions-127" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A bug in the old inliner has been fixed. Some undocumented functionality has
been removed.</p><p>Own Id: OTP-7223</p></li><li><p>Matching several binary patterns in parallel using the '=' operator is not
allowed (an implementation limitation), but the compiler did not reject all
such attempts (depending on the patterns, the generated code might or might
not work correctly). Now the compiler rejects all binary patterns joined by
'='.</p><p>Own Id: OTP-7227</p></li><li><p>Complex combinations of record operations and binary matching could cause the
compiler to crash. (Thanks to Vladimir Klebansky.)</p><p>Own Id: OTP-7233</p></li><li><p>In rare circumstances, mixing binary matching clauses with clauses matching
other data types, the compiler could crash.</p><p>Own Id: OTP-7240 Aux Id: seq10916</p></li></ul><h2 id="compiler-4-5-1-1" class="section-heading"><a href="#compiler-4-5-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.5.1.1</span></h2><h3 id="fixed-bugs-and-malfunctions-128" class="section-heading"><a href="#fixed-bugs-and-malfunctions-128" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Corrected a compiler bug that could cause a complex binary matching operation
to fail when it shouldn't. (Thanks to Tomas Stejskal.)</p><p>Own Id: OTP-7188</p></li><li><p>In unusual circumstances, the environment for a fun could bind wrong values.</p><p>Own Id: OTP-7202 Aux Id: seq10887</p></li><li><p>Long sequences of list comprehensions without generators joined by the '++'
operator would cause a code expansion explosion, which could cause the
compiler to run out of memory. To resolve this problem, in
'<code class="inline">[...||...]++Expr</code>', <code class="inline">Expr</code> is now evaluated before the list comprehension.
This change <em>is</em> backwards compatible (see the following note about evaluation
order if you have doubts).</p><p>Note about evaluation order: The Reference manual says that subexpressions are
evaluated <em>in any order</em> before the expression itself. Therefore, in an
expression such as '<code class="inline">LeftExpr++RightExpr</code>', you should not depend on
<code class="inline">LeftExpr</code> being evaluated before <code class="inline">RightExpr</code> or vice versa. The evaluation
order is only important if the expressions contains and/or depends on
operations with side-effects, such as message passing or ETS operations.</p><p>Own Id: OTP-7206</p></li></ul><h2 id="compiler-4-5-1" class="section-heading"><a href="#compiler-4-5-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.5.1</span></h2><h3 id="fixed-bugs-and-malfunctions-129" class="section-heading"><a href="#fixed-bugs-and-malfunctions-129" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>A match expression inside a function call could cause a false &quot;a term is
constructed but never used&quot; warning.</p><p>Own Id: OTP-7018 Aux Id: seq10824</p></li><li><p>The compiler could crash if a binary tail was matched out, and then used in a
binary append operation. (Thanks to Oleg Avdeev.)</p><p>Similarly, the compiler could crash if a binary tail was matched out, and then
used (incorrectly) in binary construction in an integer field. (Thanks to
Fredrik Svahn.) Or was incorrectly used in a float field. Or was used in a
binary field with a given length. (Thanks to Chih - Wei Yu.)</p><p>Own Id: OTP-7022</p></li><li><p>Matching an empty binary in a record and then using the same record again
could cause a compiler crash. (Thanks to Fredrik Thulin.)</p><p>Own Id: OTP-7029</p></li><li><p>In rare circumstances, constants containing floating points and integers could
be confused. Example:</p><p><code class="inline">f(a) -&gt; [1]; f(b) -&gt; [1.0].</code></p><p>Both <code class="inline">f(a)</code> and <code class="inline">f(b)</code> would return <code class="inline">[1]</code>.</p><p>Own Id: OTP-7073</p></li><li><p>Some bit syntax code such as</p><p><code class="inline">matching d(_,&lt;$lt;$gt;$gt;) -&gt; one; d(0,&lt;$lt;D$gt;$gt;) -&gt;two.</code></p><p>could crash the compiler. (Thanks to Simon Cornish.)</p><p>Own Id: OTP-7094</p></li><li><p>In unusual circumstances, a call to a fun could fail due to an unsafe
optimization. (Thanks to Simon Cornish.)</p><p>Own Id: OTP-7102</p></li><li><p>Bit syntax matching with a guard containing two or more uses of andalso/orelse
could cause the compiler to crash. (Thanks to Mateusz Berezecki.)</p><p>Own Id: OTP-7113</p></li><li><p>This was only a problem if you generated or wrote your own Core Erlang code:
The Core Erlang optimizer code could move nested calls such as
<code class="inline">erlang:'$lt;'(erlang:length(L), 2)</code> as case expression into a guard, which
would change the semantics. (Thanks to Robert Virding.)</p><p>Own Id: OTP-7117</p></li></ul><h3 id="improvements-and-new-features-39" class="section-heading"><a href="#improvements-and-new-features-39" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The compiler could generate suboptimal code for record updates if the record
update code consisted of multiple source code lines.</p><p>Own Id: OTP-7101</p></li></ul><h2 id="compiler-4-5" class="section-heading"><a href="#compiler-4-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.5</span></h2><h3 id="fixed-bugs-and-malfunctions-130" class="section-heading"><a href="#fixed-bugs-and-malfunctions-130" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler used to allow that a binary field without size could be used in
other positions than at the end in bit syntax pattern. For instance,
<code class="inline">&lt;&lt;B/binary,EmptyBinary/binary&gt;&gt; = Bin</code> used to compile, but now the
compilation will fail with an an error message.</p><p>Also, it is now longer permitted to give a literal string in a binary pattern
a type or a size; for instance, <code class="inline">&lt;&lt;&quot;abc&quot;/binary&gt;&gt; = Bin</code> will no longer
compile. (In previous releases, there would always be a <code class="inline">badmatch</code> exception
at run-time.)</p><p>Own Id: OTP-6885</p></li></ul><h3 id="improvements-and-new-features-40" class="section-heading"><a href="#improvements-and-new-features-40" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Bitstrings (bit-level) binaries and binary comprehensions are now part of the
language. See the Reference Manual.</p><p>Own Id: OTP-6558</p></li><li><p>The '<code class="inline">compressed</code>' option for the compiler has been documented.</p><p>Own Id: OTP-6801</p></li><li><p>If the value of a list comprehension is not used, such as in
'<code class="inline">[do_something(X) || X &lt;- List], ok</code>', a result list will no longer be built.
For more details, see the Efficiency Guide.</p><p>If the value of an expression is not used, and the expression has no side
effects except for possibly throwing an exception, a warning will be
generated. Examples: '<code class="inline">self(),ok</code>' and '<code class="inline">{error,Reason},ok</code>'.</p><p>Own Id: OTP-6824</p></li><li><p>Three new functions have been added to the <code class="inline">compile</code> module: <code class="inline">noenv_file/2</code>,
<code class="inline">noenv_forms/2</code>, and <code class="inline">noenv_output_generated/1</code>.</p><p>Own Id: OTP-6829</p></li><li><p>Many bit syntax operations, both construction and matching, are faster. For
further information, see the Efficiency Guide.</p><p>Own Id: OTP-6838</p></li><li><p>Literal lists, tuples, and binaries are no longer constructed at run-time as
they used to be, but are stored in a per-module constant pool. Literals that
are used more than once are stored only once.</p><p>This is not a change to the language, only in the details of its
implementation. Therefore, the implications of this change is described in the
Efficiency Guide.</p><p>Example 1: In the expression
<a href="../../apps/erts/erlang.html#element/2"><code class="inline">element(BitNum-1, {1,2,4,8,16,32,64,128})</code></a>, the tuple used to
be constructed every time the expression was executed, which could be
detrimental to performance in two ways if the expression was executed in a
loop: the time to build the tuple itself and the time spent in garbage
collections because the heap filled up with garbage faster.</p><p>Example 2: Literal strings, such as <code class="inline">&quot;abc&quot;</code>, used to be stored in the compiled
code compactly as a byte string and expanded to a list at run-time. Now all
strings will be stored expanded to lists (such as <code class="inline">[$a,$b,$c]</code>) in the
constant pool. That means that the string will be faster to use at run-time,
but that it will require more space even when not used. If space is an issue,
you might want to use binary literals (that is, <code class="inline">&lt;&lt;&quot;abc&quot;&lt;&lt;</code>) instead of string
literals for infrequently used long strings (such as error messages).</p><p>Own Id: OTP-6850</p></li><li><p>Recursive calls now usually consume less stack than in R11B. See the
Efficiency Guide.</p><p>Own Id: OTP-6862 Aux Id: seq10746</p></li><li><p>Two new guard BIFs have been introduced as a recommended replacement for
<a href="../../apps/erts/erlang.html#size/1"><code class="inline">size/1</code></a>. (The <a href="../../apps/erts/erlang.html#size/1"><code class="inline">size/1</code></a> BIF will be removed no earlier
than in R14B.) The BIFs are <a href="../../apps/erts/erlang.html#tuple_size/1"><code class="inline">tuple_size/1</code></a> to calculate the
size of a tuple and <a href="../../apps/erts/erlang.html#byte_size/1"><code class="inline">byte_size/1</code></a> to calculate the number of
bytes needed for the contents of the binary or bitstring (rounded up to the
nearest number of bytes if necessary).</p><p>There is also a new <a href="../../apps/erts/erlang.html#bit_size/1"><code class="inline">bit_size/1</code></a> BIF that returns the exact
number of bits that a binary or bitstring contains.</p><p>Own Id: OTP-6902</p></li><li><p>The two internal functions <code class="inline">erl_bifs:is_bif/3</code> and <code class="inline">erl_bifs:is_guard/3</code> have
been removed. They were unsupported, undocumented, and unmaintained.</p><p>Own Id: OTP-6966</p></li></ul><h2 id="compiler-4-4-5" class="section-heading"><a href="#compiler-4-4-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.4.5</span></h2><h3 id="fixed-bugs-and-malfunctions-131" class="section-heading"><a href="#fixed-bugs-and-malfunctions-131" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler would crash if you tried to combine to non-list literals with
'<code class="inline">++</code>' (for instance, <code class="inline">an_atom++&quot;string&quot;</code>).</p><p>Own Id: OTP-6630 Aux Id: seq10635</p></li></ul><h3 id="improvements-and-new-features-41" class="section-heading"><a href="#improvements-and-new-features-41" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Minor Makefile changes.</p><p>Own Id: OTP-6689</p></li></ul><h2 id="compiler-4-4-4" class="section-heading"><a href="#compiler-4-4-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.4.4</span></h2><h3 id="fixed-bugs-and-malfunctions-132" class="section-heading"><a href="#fixed-bugs-and-malfunctions-132" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Incorrect code could be generated for bit syntax matching if the old inliner
was used with aggressive settings.</p><p>Own Id: OTP-6461</p></li></ul><h2 id="compiler-4-4-3" class="section-heading"><a href="#compiler-4-4-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.4.3</span></h2><h3 id="fixed-bugs-and-malfunctions-133" class="section-heading"><a href="#fixed-bugs-and-malfunctions-133" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The R10B compiler could generate unsafe <code class="inline">bs_save/bs_restore</code> instructions that
could cause memory corruption. (The R11B compiler does not have that problem.)
The erlang emulator will now refuse to load R10B-compiled modules that contain
such unsafe <code class="inline">bs_save/bs_restore</code> instructions. In addition, the beam_validator
module in the compiler will also reject such instructions (in case it is used
to validate R10B code). (Thanks to Matthew Reilly.)</p><p>Own Id: OTP-6386</p></li></ul><h3 id="improvements-and-new-features-42" class="section-heading"><a href="#improvements-and-new-features-42" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Directives for parse transforms that have been run are now removed from the
abstract code stored when the debug_info option is given, to prevent the parse
transforms to be run again.</p><p>Own Id: OTP-5344</p></li><li><p>Minor improvements in code generation for some guards expression involving
boolean expressions.</p><p>Own Id: OTP-6347</p></li></ul><h2 id="compiler-4-4-2-1" class="section-heading"><a href="#compiler-4-4-2-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.4.2.1</span></h2><h3 id="fixed-bugs-and-malfunctions-134" class="section-heading"><a href="#fixed-bugs-and-malfunctions-134" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler could generate incorrect code for bit syntax matching consisting
of several clauses.</p><p>Own Id: OTP-6392 Aux Id: seq10539</p></li></ul><h2 id="compiler-4-4-2" class="section-heading"><a href="#compiler-4-4-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.4.2</span></h2><h3 id="fixed-bugs-and-malfunctions-135" class="section-heading"><a href="#fixed-bugs-and-malfunctions-135" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Defining a fun itself containing a fun in an <code class="inline">after</code> block of a <code class="inline">try</code> would
cause the compiler to crash or generate incorrect code. (Thanks to Tim Rath.)</p><p>Shorter compilation times for modules containing with an extreme number of
functions (10000 functions or more).</p><p>(The compiled could generate deprecated instructions for certain bit syntax
matching operations.)</p><p>Own Id: OTP-6212 Aux Id: seq10446</p></li><li><p>Fixed several bugs that would cause warnings to be shown without file name and
line number.</p><p>Own Id: OTP-6260 Aux Id: seq10461</p></li></ul><h3 id="improvements-and-new-features-43" class="section-heading"><a href="#improvements-and-new-features-43" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The <code class="inline">strict_record_tests</code> option is now default; that is, reading a field from
a record using the <code class="inline">Record#record_tag.field</code> syntax will fail if <code class="inline">Record</code> is
not a record of the correct type.</p><p>If necessary, the record tests can be turned off by giving the
<code class="inline">no_strict_record_tests</code> option. To avoid editing Makefiles, the environment
variable <code class="inline">ERL_COMPILER_OPTIONS</code> can be set to &quot;<code class="inline">no_strict_record_tests</code>&quot;.</p><p>The <code class="inline">no_strict_record_tests</code> option will probably be removed in the R12B
release.</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-6294</p></li></ul><h2 id="compiler-4-4-1" class="section-heading"><a href="#compiler-4-4-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.4.1</span></h2><h3 id="fixed-bugs-and-malfunctions-136" class="section-heading"><a href="#fixed-bugs-and-malfunctions-136" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>The compiler used to crash if a module contained code similar to
'<code class="inline">fun(1=0) -&gt; ok end</code>'. (Thanks to Richard Carlsson.)</p><p>The compiler would spend really long time compiling bit syntax expressions
such as '<code class="inline">&lt;&lt;1:(50*1024*1024)&gt;&gt;</code>' and produce a huge .beam file. Corrected.</p><p>The compiler would compile list comprehensions with many generators really,
really slow. (Thanks to Thomas Raes.)</p><p>Module attributes would be stored in reverse order compared to the order in
the source code. (Thus, <code class="inline">M:module_info(attributes)</code> would also return the
attributes in reversed order.)</p><p>Defining a fun in an <code class="inline">after</code> block of a <code class="inline">try</code> would cause the compiler to
crash or generate incorrect code. (Thanks to Martin Bjorklund.)</p><p>The combination of binary pattern and a guard with andalso/orelse could cause
the compiler to crash.</p><p>Own Id: OTP-6121 Aux Id: seq10400</p></li></ul><h2 id="compiler-4-4" class="section-heading"><a href="#compiler-4-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.4</span></h2><h3 id="fixed-bugs-and-malfunctions-137" class="section-heading"><a href="#fixed-bugs-and-malfunctions-137" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>When a <code class="inline">.hrl</code> file is included using <code class="inline">-include_lib</code>, the include path is
temporarily updated to include the directory the <code class="inline">.hrl</code> file was found in,
which will allow that <code class="inline">.hrl</code> file to itself include files from the same
directory using <code class="inline">-include</code>. (Thanks to Richard Carlsson.)</p><p>Own Id: OTP-5944</p></li></ul><h3 id="improvements-and-new-features-44" class="section-heading"><a href="#improvements-and-new-features-44" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The <code class="inline">andalso</code> and <code class="inline">orelse</code> operators are now allowed to be used in guards.
That also applies to match specifications.</p><p>Own Id: OTP-5894 Aux Id: OTP-5149</p></li><li><p>When given the new option <code class="inline">strict_record_tests</code>, the compiler will generate
code that verifies the record type for <code class="inline">R#record.field</code> operations in guards.
Code that verifies record types in bodies has already been generated since
R10B, but in this release there will be a <code class="inline">{badrecord,RecordTag}</code> instead of a
<code class="inline">badmatch</code> if the record verification test fails. See <a href="compile.html"><code class="inline">compile</code></a> for more
information.</p><p>The Erlang shell always applies strict record tests.</p><p>Own Id: OTP-5915 Aux Id: OTP-5714</p></li><li><p>The BIF <a href="../../apps/erts/erlang.html#is_record/3"><code class="inline">is_record/3</code></a> can now be used in guards. Also,
<a href="../../apps/erts/erlang.html#is_record/3"><code class="inline">is_record/3</code></a> can now be called without an <code class="inline">erlang:</code> module
prefix for consistency with the other <code class="inline">is_*</code> functions.</p><p>Own Id: OTP-5916</p></li><li><p>The compiler options <code class="inline">ignore_try</code> and <code class="inline">ignore_cond</code>, which allowed code that
used unquoted <code class="inline">try</code> or <code class="inline">cond</code> as atoms or record tags, has been removed. Old
code that depended on the options need to be revised to have occurrences of
<code class="inline">try</code> or <code class="inline">cond</code> as atom or record tags single-quoted. (Note: Although <code class="inline">cond</code>
is a reserved keyword, there is no <code class="inline">cond</code> statement. It might be introduced in
a future release.)</p><p>*<strong> POTENTIAL INCOMPATIBILITY *</strong></p><p>Own Id: OTP-6058</p></li></ul><h2 id="compiler-4-3-12" class="section-heading"><a href="#compiler-4-3-12" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.3.12</span></h2><h3 id="improvements-and-new-features-45" class="section-heading"><a href="#improvements-and-new-features-45" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The following code would crash the compiler:
<code class="inline">case T of #r{s = &quot;&quot;} -&gt; T #r{s = &quot;x&quot;} end</code>. (Thanks to Richard Carlsson.)</p><p>The compiler could crash if binaries were constructed in certain guards
involving boolean operators (including semicolon). (Thanks to Torbjorn
Tornkvist.)</p><p>Own Id: OTP-5872</p></li><li><p>The compiler will now warn that the <code class="inline">megaco:format_versions/1</code> function is
deprecated.</p><p>Own Id: OTP-5976</p></li></ul><h2 id="compiler-4-3-11" class="section-heading"><a href="#compiler-4-3-11" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.3.11</span></h2><h3 id="improvements-and-new-features-46" class="section-heading"><a href="#improvements-and-new-features-46" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The compiler would assume that some patterns with aliases ('=') would not
match if they were split into several lines. (Thanks to Peter Nagy/Mats
Cronqvist.)</p><p>Minor cleanups to eliminate Dialyzer warnings.</p><p>Own Id: OTP-5791 Aux Id: seq10141</p></li></ul><h2 id="compiler-4-3-10" class="section-heading"><a href="#compiler-4-3-10" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.3.10</span></h2><h3 id="fixed-bugs-and-malfunctions-138" class="section-heading"><a href="#fixed-bugs-and-malfunctions-138" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>When given the new option <code class="inline">strict_record_tests</code>, the compiler will generate
code that verifies the record type for <code class="inline">R#record.field</code> operations (in body
context only, not in guards). See the documentation for the <code class="inline">compile</code> module
for more information.</p><p>The beam validator pass of the compiler could crash given in rare
circumstances when given certain combinations of catches and record
operations. (Thanks to Mats Cronqvist.)</p><p>Attributes containing binaries (such as -a(&lt;&lt;1,2,3&gt;&gt;)) would crash the
compiler. (Thanks to Roger Price.)</p><p>Multiple behaviours in the same module will no longer generate a warning,
unless one or more callbacks for the behaviours overlap. For instance, using
both the <code class="inline">application</code> and <code class="inline">supervisor</code> behaviours in the same module will NOT
generate any warning, but using <code class="inline">gen_server</code> and <code class="inline">gen_fsm</code> will.</p><p>Own Id: OTP-5714 Aux Id: seq10073</p></li><li><p>The pre-processor used to complain that the macro definition
<code class="inline">-define(S(S), ??S).</code> was circular, which it isn't. (Thanks to Richard
Carlsson.)</p><p>Own Id: OTP-5777</p></li></ul><h2 id="compiler-4-3-9" class="section-heading"><a href="#compiler-4-3-9" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.3.9</span></h2><h3 id="fixed-bugs-and-malfunctions-139" class="section-heading"><a href="#fixed-bugs-and-malfunctions-139" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Updating at least two fields of a record with a literal string could cause the
compiler to generate dangerous code that could cause a crash at run-time (e.g.
<code class="inline">R#r{a=&quot;abc&quot;,b=1}</code>). (Thanks to Mikael Karlsson.)</p><p>Unnecessary tests (such as a 'case' with two case branches that were
identical) could cause the compiler to crash. (Thanks to Fredrik Thulin.)</p><p>The validation pass of the compiler could generate an error for correct code
when floating point operations were used in try/catch statements.</p><p>In bit syntax construction, any field following a binary field would always be
marked as &quot;aligned&quot; (which may or may not be correct). That would cause the
hipe native compiler to generate incorrect code if the field was in fact
unaligned. (Thanks to Per Gustafsson.)</p><p>Some complex guard expressions (such as <code class="inline">A#a.b==&quot;&quot;; A#a.b==undefined</code>) would
crash the compiler. (Thanks to Sean Hinde.)</p><p>Compilation speed has been increased for modules with many functions and/or
atoms (such as modules generated by the Asn1 application or other code
generators).</p><p>Own Id: OTP-5632 Aux Id: seq10057</p></li></ul><h2 id="compiler-4-3-8" class="section-heading"><a href="#compiler-4-3-8" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.3.8</span></h2><h3 id="fixed-bugs-and-malfunctions-140" class="section-heading"><a href="#fixed-bugs-and-malfunctions-140" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In some circumstances, having two try/catch constructs following each in a
function body, would cause an internal error to be generated (when in fact the
generated code was correct). (Thanks to Fredrik Thulin.)</p><p>Incorrect calls such as <code class="inline">M:42()</code> would crash the compiler. The compiler now
generates a warning. (Thanks to Ulf Wiger.)</p><p>Own Id: OTP-5553</p></li></ul><h3 id="improvements-and-new-features-47" class="section-heading"><a href="#improvements-and-new-features-47" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>The new <code class="inline">fun M:F/A</code> construct creates a fun that refers to the latest version
of <code class="inline">M:F/A</code>. This syntax is meant to replace tuple funs <code class="inline">{M,F}</code> which have many
problems.</p><p>The new type test <a href="../../apps/erts/erlang.html#is_function/2"><code class="inline">is_function(Fun, A)</code></a> (which may be used
in guards) test whether <code class="inline">Fun</code> is a fun that can be applied with <code class="inline">A</code> arguments.
(Currently, <code class="inline">Fun</code> can also be a tuple fun.)</p><p>Own Id: OTP-5584</p></li></ul><h2 id="compiler-4-3-7" class="section-heading"><a href="#compiler-4-3-7" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.3.7</span></h2><h3 id="improvements-and-new-features-48" class="section-heading"><a href="#improvements-and-new-features-48" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Further improvements of encrypted debug info: New option <code class="inline">encrypt_debug_info</code>
for compiler.</p><p>Own Id: OTP-5541 Aux Id: seq9837</p></li></ul><h2 id="compiler-4-3-6" class="section-heading"><a href="#compiler-4-3-6" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.3.6</span></h2><h3 id="fixed-bugs-and-malfunctions-141" class="section-heading"><a href="#fixed-bugs-and-malfunctions-141" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Fixed a bug in the validator of the generated code (beam_validator) which
caused an internal compiler error even though the generated code was indeed
correct.</p><p>Own Id: OTP-5481 Aux Id: seq9798</p></li></ul><h3 id="improvements-and-new-features-49" class="section-heading"><a href="#improvements-and-new-features-49" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>It is now possible to encrypt the debug information in Beam files, to help
keep the source code secret. See the documentation for <code class="inline">compile</code> on how to
provide the key for encrypting, and the documentation for <code class="inline">beam_lib</code> on how to
provide the key for decryption so that tools such as the Debugger, Xref, or
Cover can be used.</p><p>The <a href="../../apps/stdlib/beam_lib.html#chunks/2"><code class="inline">beam_lib:chunks/2</code></a> functions now accepts an additional chunk type
<code class="inline">compile_info</code> to retrieve the compilation information directly as a term.
(Thanks to Tobias Lindahl.)</p><p>Own Id: OTP-5460 Aux Id: seq9787</p></li></ul><h2 id="compiler-4-3-5" class="section-heading"><a href="#compiler-4-3-5" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.3.5</span></h2><h3 id="fixed-bugs-and-malfunctions-142" class="section-heading"><a href="#fixed-bugs-and-malfunctions-142" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Complex functions could cause the internal validator in the compiler to
generate an internal error even though the generated code was correct.</p><p>Own Id: OTP-5436 Aux Id: seq9781</p></li></ul><h2 id="compiler-4-3-4" class="section-heading"><a href="#compiler-4-3-4" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.3.4</span></h2><h3 id="fixed-bugs-and-malfunctions-143" class="section-heading"><a href="#fixed-bugs-and-malfunctions-143" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In rare circumstances, incorrect code for record or tuple access could be
generated. The incorrect code would either trigger an internal error in the
compiler or cause an exception at run time. (Thanks to Martin Bjorklund.)</p><p>Corrected a bug in in bit syntax matching where clauses could match in the
wrong order. (Thanks to Ulf Wiger.)</p><p>Own Id: OTP-5404 Aux Id: seq9767</p></li></ul><h2 id="compiler-4-3-3" class="section-heading"><a href="#compiler-4-3-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.3.3</span></h2><h3 id="improvements-and-new-features-50" class="section-heading"><a href="#improvements-and-new-features-50" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Improvements and New Features</span></h3><ul><li><p>Given bit syntax construction in certain complex contexts involving a catch,
the compiler would either crash or terminate due to failure in an internal
consistency check. (Thanks to Fredrik Thulin.)</p><p>Matches such as <code class="inline">&lt;&lt;103133:64/float&gt;&gt; = &lt;&lt;103133:64/float&gt;&gt;</code> used to fail. Now
they succeed.</p><p>Shadowing of variables in bit syntax matches in fun heads such as in
<code class="inline">L = 8, F = fun(&lt;&lt;L:L,B:L&gt;&gt;) -&gt; B end</code> was handled incorrectly by the
compiler. The fun used to be compiled as if it was written
'<code class="inline">&gt;fun(&lt;&lt;8:8,B:8&gt;&gt;)</code>, while it should be compiled in the same way as
<code class="inline">fun(&lt;&lt;L:8,B:L&gt;&gt;)</code>.</p><p>A bug in the validation pass has been corrected. It sometimes occurred when
the compiler optimized by reusing code for causing an exception when the
reused code was called from within catch or try-catch statements. Then the
validator refused to approve the code and complained about
<code class="inline">fun(&lt;&lt;L:L,B:L&gt;&gt;) -&gt; B end</code> was handled incorrectly by the in the same way as
<code class="inline">fun(&lt;&lt;L:8,B:L&gt;&gt;)</code>.</p><p>A bug in the unknown_catch_try_state.</p><p>Corrected a bug in the optimizer that would cause the compiler to crash.
(Thanks to Peter-Henry Mander.)</p><p>There are now warnings generated if a bit syntax construction will fail at
run-time because of a type mismatch (e.g. <code class="inline">&lt;&lt;an_atom:8&gt;&gt;</code>).</p><p>Own Id: OTP-5342 Aux Id: OTP-5118, OTP-5270, OTP-5323</p></li><li><p>Binary pattern matching such as <code class="inline">t(&lt;&lt;A:8&gt;&gt; = &lt;&lt;A:8&gt;)</code> used to silently fail at
runtime (i.e. never match). The compiler now generates an error for any such
patterns.</p><p>Own Id: OTP-5371</p></li></ul><h2 id="compiler-4-3-2" class="section-heading"><a href="#compiler-4-3-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.3.2</span></h2><h3 id="fixed-bugs-and-malfunctions-144" class="section-heading"><a href="#fixed-bugs-and-malfunctions-144" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>In rare cases, the code compiler code generate code for a tuple match that
could crash the emulator if passed a term that was not a tuple.</p><p>If a bit syntax construction failed within a catch, previously assigned
variables could get the wrong value.</p><p>The compiler now runs a validation pass on the generated code and aborts
before writing a Beam file if any suspect code is found. In particular, the
validation pass checks for incorrect code that may cause emulator crashes or
other strange symptoms in the emulator.</p><p>Some corrections to the unsupported feature parameterized modules by Richard
Carlsson (HiPE).</p><p>Own Id: OTP-5247 Aux Id: OTP-5235</p></li></ul><h2 id="compiler-4-3-1" class="section-heading"><a href="#compiler-4-3-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Compiler 4.3.1</span></h2><h3 id="fixed-bugs-and-malfunctions-145" class="section-heading"><a href="#fixed-bugs-and-malfunctions-145" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fixed Bugs and Malfunctions</span></h3><ul><li><p>Corrected the release note regarding <code class="inline">try/catch</code> below. <code class="inline">try/catch</code> DOES work
in the initial R10B release.</p><p>A few minor issues code generation issues were corrected. Although the
generated code was correct, it was slightly slower and larger than it needed
to be.</p><p>A debug printout (that could be seen in rare circumstances) has been removed.</p><p><code class="inline">not record_test(not_a_tuple, RecordTag)</code> and similar expressions in a guard
would fail.</p><p>New options <code class="inline">basic_validation</code> and <code class="inline">strong_validation</code> to do a quick check of
the code of a module.</p><p>The <code class="inline">inline</code> option was not recognized if it appeared in a <code class="inline">-compile()</code>
directive inside the module.</p><p>Corrected some bugs in the undocumented feature &quot;parameterized modules&quot;.</p><p>Own Id: OTP-5198</p></li><li><p>When the undocumented feature &quot;parameterized modules&quot; was used, the <code class="inline">?MODULE</code>
macro did not work correctly.</p><p>Own Id: OTP-5224</p></li></ul>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

  </div>
  <div class="bottom-actions-item">

      <a href="beam_ssa.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Invariants on the Structure and Format of BEAM SSA
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="compiler.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright © 1996-2025 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js"></script>
  <script>
  let initialized = false;

  window.addEventListener("exdoc:loaded", () => {
      if (!initialized) {
      mermaid.initialize({
          startOnLoad: false,
          theme: document.body.className.includes("dark") ? "dark" : "default"
      });
      initialized = true;
      }

      let id = 0;
      for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
          graphEl.innerHTML = svg;
          bindFunctions?.(graphEl);
          preEl.insertAdjacentElement("afterend", graphEl);
          preEl.remove();
      });
      }
  });
  </script>

  </body>
</html>
