<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.1">
    <meta name="project" content="Erlang System Documentation v29.0-rc0">


<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=1&q=">
<meta name="major-vsn" content="1">
<link rel="canonical" href="https://www.erlang.org/docs/1/system/tablesdatabases.html" />
<meta name="exdoc:autocomplete" content="off">
    <title>Tables and Databases — Erlang System Documentation v29.0-rc0</title>

    <link rel="stylesheet" href="dist/html-erlang-ZK43ZOAC.css" />

    <script defer src="dist/sidebar_items-09F1912C.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Erlang System Documentation" />
        </a>

      <div>
        <a href="../index.html" class="sidebar-projectName" translate="no">
Erlang System Documentation
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v29.0-rc0
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Erlang System Documentation</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>Tables and Databases</h1>


      <a href="https://github.com/erlang/otp/blob/master/system/doc/efficiency_guide/tablesdatabases.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<h2 id="ets-dets-and-mnesia" class="section-heading"><a href="#ets-dets-and-mnesia" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Ets, Dets, and Mnesia</span></h2><p>Every example using Ets has a corresponding example in Mnesia. In general, all
Ets examples also apply to Dets tables.</p><h3 id="select-match-operations" class="section-heading"><a href="#select-match-operations" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Select/Match Operations</span></h3><p>Select/match operations on Ets and Mnesia tables can become very expensive
operations. They usually need to scan the complete table. Try to structure the
data to minimize the need for select/match operations. However, if you require a
select/match operation, it is still more efficient than using <code class="inline">tab2list</code>.
Examples of this and of how to avoid select/match are provided in the following
sections. The functions <a href="../apps/stdlib/ets.html#select/2"><code class="inline">ets:select/2</code></a> and <a href="../apps/mnesia/mnesia.html#select/3"><code class="inline">mnesia:select/3</code></a> are to be preferred
over <a href="../apps/stdlib/ets.html#match/2"><code class="inline">ets:match/2</code></a>, <a href="../apps/stdlib/ets.html#match_object/2"><code class="inline">ets:match_object/2</code></a>, and <a href="../apps/mnesia/mnesia.html#match_object/3"><code class="inline">mnesia:match_object/3</code></a>.</p><p>In some circumstances, the select/match operations do not need to scan the
complete table. For example, if part of the key is bound when searching an
<code class="inline">ordered_set</code> table, or if it is a Mnesia table and there is a secondary index
on the field that is selected/matched. If the key is fully bound, there is no
point in doing a select/match, unless you have a bag table and are only
interested in a subset of the elements with the specific key.</p><p>When creating a record to be used in a select/match operation, you want most of
the fields to have the value <code class="inline">_</code>. The easiest and fastest way to do that is as
follows:</p><pre><code class="text">#person{age = 42, _ = '_'}.</code></pre><h3 id="deleting-an-element" class="section-heading"><a href="#deleting-an-element" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Deleting an Element</span></h3><p>The <code class="inline">delete</code> operation is considered successful if the element was not present
in the table. Hence all attempts to check that the element is present in the
Ets/Mnesia table before deletion are unnecessary. Here follows an example for
Ets tables:</p><p><strong>DO</strong></p><pre><code class="text">ets:delete(Tab, Key),</code></pre><p><strong>DO NOT</strong></p><pre><code class="makeup erlang" translate="no"><span class="k">case</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">lookup</span><span class="p" data-group-id="6915862638-1">(</span><span class="n">Tab</span><span class="p">,</span><span class="w"> </span><span class="n">Key</span><span class="p" data-group-id="6915862638-1">)</span><span class="w"> </span><span class="k">of</span><span class="w">
    </span><span class="p" data-group-id="6915862638-2">[</span><span class="p" data-group-id="6915862638-2">]</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
        </span><span class="ss">ok</span><span class="p">;</span><span class="w">
    </span><span class="p" data-group-id="6915862638-3">[</span><span class="p">_</span><span class="p">|</span><span class="p">_</span><span class="p" data-group-id="6915862638-3">]</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
        </span><span class="nc">ets</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6915862638-4">(</span><span class="n">Tab</span><span class="p">,</span><span class="w"> </span><span class="n">Key</span><span class="p" data-group-id="6915862638-4">)</span><span class="w">
</span><span class="k">end</span><span class="p">,</span></code></pre><h3 id="fetching-data" class="section-heading"><a href="#fetching-data" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fetching Data</span></h3><p>Do not fetch data that you already have.</p><p>Consider that you have a module that handles the abstract data type <code class="inline">Person</code>.
You export the interface function <code class="inline">print_person/1</code>, which uses the internal
functions <code class="inline">print_name/1</code>, <code class="inline">print_age/1</code>, and <code class="inline">print_occupation/1</code>.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p>If the function <code class="inline">print_name/1</code>, and so on, had been interface functions, the
situation would have been different, as you do not want the user of the
interface to know about the internal data representation.</p></section><p><strong>DO</strong></p><pre><code class="makeup erlang" translate="no"><span class="c1">%%% Interface function</span><span class="w">
</span><span class="nf">print_person</span><span class="p" data-group-id="0111616460-1">(</span><span class="n">PersonId</span><span class="p" data-group-id="0111616460-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% Look up the person in the named table person,</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">lookup</span><span class="p" data-group-id="0111616460-2">(</span><span class="ss">person</span><span class="p">,</span><span class="w"> </span><span class="n">PersonId</span><span class="p" data-group-id="0111616460-2">)</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="p" data-group-id="0111616460-3">[</span><span class="n">Person</span><span class="p" data-group-id="0111616460-3">]</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nf">print_name</span><span class="p" data-group-id="0111616460-4">(</span><span class="n">Person</span><span class="p" data-group-id="0111616460-4">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">print_age</span><span class="p" data-group-id="0111616460-5">(</span><span class="n">Person</span><span class="p" data-group-id="0111616460-5">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">print_occupation</span><span class="p" data-group-id="0111616460-6">(</span><span class="n">Person</span><span class="p" data-group-id="0111616460-6">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0111616460-7">[</span><span class="p" data-group-id="0111616460-7">]</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0111616460-8">(</span><span class="s">&quot;No person with ID = </span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0111616460-9">[</span><span class="n">PersonID</span><span class="p" data-group-id="0111616460-9">]</span><span class="p" data-group-id="0111616460-8">)</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%%% Internal functions</span><span class="w">
</span><span class="nf">print_name</span><span class="p" data-group-id="0111616460-10">(</span><span class="n">Person</span><span class="p" data-group-id="0111616460-10">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0111616460-11">(</span><span class="s">&quot;No person </span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0111616460-12">[</span><span class="n">Person</span><span class="o">#</span><span class="ss">person</span><span class="p">.</span><span class="ss">name</span><span class="p" data-group-id="0111616460-12">]</span><span class="p" data-group-id="0111616460-11">)</span><span class="p">.</span><span class="w">

</span><span class="nf">print_age</span><span class="p" data-group-id="0111616460-13">(</span><span class="n">Person</span><span class="p" data-group-id="0111616460-13">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0111616460-14">(</span><span class="s">&quot;No person </span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0111616460-15">[</span><span class="n">Person</span><span class="o">#</span><span class="ss">person</span><span class="p">.</span><span class="ss">age</span><span class="p" data-group-id="0111616460-15">]</span><span class="p" data-group-id="0111616460-14">)</span><span class="p">.</span><span class="w">

</span><span class="nf">print_occupation</span><span class="p" data-group-id="0111616460-16">(</span><span class="n">Person</span><span class="p" data-group-id="0111616460-16">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0111616460-17">(</span><span class="s">&quot;No person </span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0111616460-18">[</span><span class="n">Person</span><span class="o">#</span><span class="ss">person</span><span class="p">.</span><span class="ss">occupation</span><span class="p" data-group-id="0111616460-18">]</span><span class="p" data-group-id="0111616460-17">)</span><span class="p">.</span></code></pre><p><strong>DO NOT</strong></p><pre><code class="makeup erlang" translate="no"><span class="c1">%%% Interface function</span><span class="w">
</span><span class="nf">print_person</span><span class="p" data-group-id="9894003499-1">(</span><span class="n">PersonId</span><span class="p" data-group-id="9894003499-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% Look up the person in the named table person,</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">lookup</span><span class="p" data-group-id="9894003499-2">(</span><span class="ss">person</span><span class="p">,</span><span class="w"> </span><span class="n">PersonId</span><span class="p" data-group-id="9894003499-2">)</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="p" data-group-id="9894003499-3">[</span><span class="n">Person</span><span class="p" data-group-id="9894003499-3">]</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nf">print_name</span><span class="p" data-group-id="9894003499-4">(</span><span class="n">PersonID</span><span class="p" data-group-id="9894003499-4">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">print_age</span><span class="p" data-group-id="9894003499-5">(</span><span class="n">PersonID</span><span class="p" data-group-id="9894003499-5">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">print_occupation</span><span class="p" data-group-id="9894003499-6">(</span><span class="n">PersonID</span><span class="p" data-group-id="9894003499-6">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9894003499-7">[</span><span class="p" data-group-id="9894003499-7">]</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9894003499-8">(</span><span class="s">&quot;No person with ID = </span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9894003499-9">[</span><span class="n">PersonID</span><span class="p" data-group-id="9894003499-9">]</span><span class="p" data-group-id="9894003499-8">)</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%%% Internal functions</span><span class="w">
</span><span class="nf">print_name</span><span class="p" data-group-id="9894003499-10">(</span><span class="n">PersonID</span><span class="p" data-group-id="9894003499-10">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9894003499-11">[</span><span class="n">Person</span><span class="p" data-group-id="9894003499-11">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">lookup</span><span class="p" data-group-id="9894003499-12">(</span><span class="ss">person</span><span class="p">,</span><span class="w"> </span><span class="n">PersonId</span><span class="p" data-group-id="9894003499-12">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9894003499-13">(</span><span class="s">&quot;No person </span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9894003499-14">[</span><span class="n">Person</span><span class="o">#</span><span class="ss">person</span><span class="p">.</span><span class="ss">name</span><span class="p" data-group-id="9894003499-14">]</span><span class="p" data-group-id="9894003499-13">)</span><span class="p">.</span><span class="w">

</span><span class="nf">print_age</span><span class="p" data-group-id="9894003499-15">(</span><span class="n">PersonID</span><span class="p" data-group-id="9894003499-15">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9894003499-16">[</span><span class="n">Person</span><span class="p" data-group-id="9894003499-16">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">lookup</span><span class="p" data-group-id="9894003499-17">(</span><span class="ss">person</span><span class="p">,</span><span class="w"> </span><span class="n">PersonId</span><span class="p" data-group-id="9894003499-17">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9894003499-18">(</span><span class="s">&quot;No person </span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9894003499-19">[</span><span class="n">Person</span><span class="o">#</span><span class="ss">person</span><span class="p">.</span><span class="ss">age</span><span class="p" data-group-id="9894003499-19">]</span><span class="p" data-group-id="9894003499-18">)</span><span class="p">.</span><span class="w">

</span><span class="nf">print_occupation</span><span class="p" data-group-id="9894003499-20">(</span><span class="n">PersonID</span><span class="p" data-group-id="9894003499-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9894003499-21">[</span><span class="n">Person</span><span class="p" data-group-id="9894003499-21">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">lookup</span><span class="p" data-group-id="9894003499-22">(</span><span class="ss">person</span><span class="p">,</span><span class="w"> </span><span class="n">PersonId</span><span class="p" data-group-id="9894003499-22">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9894003499-23">(</span><span class="s">&quot;No person </span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9894003499-24">[</span><span class="n">Person</span><span class="o">#</span><span class="ss">person</span><span class="p">.</span><span class="ss">occupation</span><span class="p" data-group-id="9894003499-24">]</span><span class="p" data-group-id="9894003499-23">)</span><span class="p">.</span></code></pre><h3 id="non-persistent-database-storage" class="section-heading"><a href="#non-persistent-database-storage" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Non-Persistent Database Storage</span></h3><p>For non-persistent database storage, prefer Ets tables over Mnesia
<code class="inline">local_content</code> tables. Even the Mnesia <code class="inline">dirty_write</code> operations carry a fixed
overhead compared to Ets writes. Mnesia must check if the table is replicated or
has indices, this involves at least one Ets lookup for each <code class="inline">dirty_write</code>. Thus,
Ets writes is always faster than Mnesia writes.</p><h3 id="tab2list" class="section-heading"><a href="#tab2list" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">tab2list</span></h3><p>Assuming an Ets table that uses <code class="inline">idno</code> as key and contains the following:</p><pre><code class="text">[#person{idno = 1, name = &quot;Adam&quot;,  age = 31, occupation = &quot;mailman&quot;},
 #person{idno = 2, name = &quot;Bryan&quot;, age = 31, occupation = &quot;cashier&quot;},
 #person{idno = 3, name = &quot;Bryan&quot;, age = 35, occupation = &quot;banker&quot;},
 #person{idno = 4, name = &quot;Carl&quot;,  age = 25, occupation = &quot;mailman&quot;}]</code></pre><p>If you <em>must</em> return all data stored in the Ets table, you can use
<a href="../apps/stdlib/ets.html#tab2list/1"><code class="inline">ets:tab2list/1</code></a>. However, usually you are only interested in a subset of the
information in which case <a href="../apps/stdlib/ets.html#tab2list/1"><code class="inline">ets:tab2list/1</code></a> is expensive. If you only want to
extract one field from each record, for example, the age of every person, then:</p><p><strong>DO</strong></p><pre><code class="makeup erlang" translate="no"><span class="nc">ets</span><span class="p">:</span><span class="nf">select</span><span class="p" data-group-id="7313384638-1">(</span><span class="n">Tab</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7313384638-2">[</span><span class="p" data-group-id="7313384638-3">{</span><span class="o">#</span><span class="ss">person</span><span class="p" data-group-id="7313384638-4">{</span><span class="ss">idno</span><span class="o">=</span><span class="ss">&#39;_&#39;</span><span class="p">,</span><span class="w">
                          </span><span class="ss">name</span><span class="o">=</span><span class="ss">&#39;_&#39;</span><span class="p">,</span><span class="w">
                          </span><span class="ss">age</span><span class="o">=</span><span class="ss">&#39;$1&#39;</span><span class="p">,</span><span class="w">
                          </span><span class="ss">occupation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&#39;_&#39;</span><span class="p" data-group-id="7313384638-4">}</span><span class="p">,</span><span class="w">
                </span><span class="p" data-group-id="7313384638-5">[</span><span class="p" data-group-id="7313384638-5">]</span><span class="p">,</span><span class="w">
                </span><span class="p" data-group-id="7313384638-6">[</span><span class="ss">&#39;$1&#39;</span><span class="p" data-group-id="7313384638-6">]</span><span class="p" data-group-id="7313384638-3">}</span><span class="p" data-group-id="7313384638-2">]</span><span class="p" data-group-id="7313384638-1">)</span><span class="p">,</span></code></pre><p><strong>DO NOT</strong></p><pre><code class="makeup erlang" translate="no"><span class="n">TabList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">tab2list</span><span class="p" data-group-id="7747460203-1">(</span><span class="n">Tab</span><span class="p" data-group-id="7747460203-1">)</span><span class="p">,</span><span class="w">
</span><span class="nc">lists</span><span class="p">:</span><span class="nf">map</span><span class="p" data-group-id="7747460203-2">(</span><span class="nf">fun</span><span class="p" data-group-id="7747460203-3">(</span><span class="n">X</span><span class="p" data-group-id="7747460203-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">X</span><span class="o">#</span><span class="ss">person</span><span class="p">.</span><span class="ss">age</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">TabList</span><span class="p" data-group-id="7747460203-2">)</span><span class="p">,</span></code></pre><p>If you are only interested in the age of all persons named &quot;Bryan&quot;, then:</p><p><strong>DO</strong></p><pre><code class="makeup erlang" translate="no"><span class="nc">ets</span><span class="p">:</span><span class="nf">select</span><span class="p" data-group-id="8722566948-1">(</span><span class="n">Tab</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8722566948-2">[</span><span class="p" data-group-id="8722566948-3">{</span><span class="o">#</span><span class="ss">person</span><span class="p" data-group-id="8722566948-4">{</span><span class="ss">idno</span><span class="o">=</span><span class="ss">&#39;_&#39;</span><span class="p">,</span><span class="w">
                          </span><span class="ss">name</span><span class="o">=</span><span class="s">&quot;Bryan&quot;</span><span class="p">,</span><span class="w">
                          </span><span class="ss">age</span><span class="o">=</span><span class="ss">&#39;$1&#39;</span><span class="p">,</span><span class="w">
                          </span><span class="ss">occupation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&#39;_&#39;</span><span class="p" data-group-id="8722566948-4">}</span><span class="p">,</span><span class="w">
                </span><span class="p" data-group-id="8722566948-5">[</span><span class="p" data-group-id="8722566948-5">]</span><span class="p">,</span><span class="w">
                </span><span class="p" data-group-id="8722566948-6">[</span><span class="ss">&#39;$1&#39;</span><span class="p" data-group-id="8722566948-6">]</span><span class="p" data-group-id="8722566948-3">}</span><span class="p" data-group-id="8722566948-2">]</span><span class="p" data-group-id="8722566948-1">)</span></code></pre><p><strong>DO NOT</strong></p><pre><code class="makeup erlang" translate="no"><span class="n">TabList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">tab2list</span><span class="p" data-group-id="4121185715-1">(</span><span class="n">Tab</span><span class="p" data-group-id="4121185715-1">)</span><span class="p">,</span><span class="w">
</span><span class="nc">lists</span><span class="p">:</span><span class="nf">foldl</span><span class="p" data-group-id="4121185715-2">(</span><span class="nf">fun</span><span class="p" data-group-id="4121185715-3">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Acc</span><span class="p" data-group-id="4121185715-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">X</span><span class="o">#</span><span class="ss">person</span><span class="p">.</span><span class="ss">name</span><span class="w"> </span><span class="k">of</span><span class="w">
                                </span><span class="s">&quot;Bryan&quot;</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                                    </span><span class="p" data-group-id="4121185715-4">[</span><span class="n">X</span><span class="o">#</span><span class="ss">person</span><span class="p">.</span><span class="ss">age</span><span class="p">|</span><span class="n">Acc</span><span class="p" data-group-id="4121185715-4">]</span><span class="p">;</span><span class="w">
                                 </span><span class="p">_</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                                     </span><span class="n">Acc</span><span class="w">
                           </span><span class="k">end</span><span class="w">
             </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4121185715-5">[</span><span class="p" data-group-id="4121185715-5">]</span><span class="p">,</span><span class="w"> </span><span class="n">TabList</span><span class="p" data-group-id="4121185715-2">)</span></code></pre><p>If you need all information stored in the Ets table about persons named &quot;Bryan&quot;,
then:</p><p><strong>DO</strong></p><pre><code class="makeup erlang" translate="no"><span class="nc">ets</span><span class="p">:</span><span class="nf">select</span><span class="p" data-group-id="5434017553-1">(</span><span class="n">Tab</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5434017553-2">[</span><span class="p" data-group-id="5434017553-3">{</span><span class="o">#</span><span class="ss">person</span><span class="p" data-group-id="5434017553-4">{</span><span class="ss">idno</span><span class="o">=</span><span class="ss">&#39;_&#39;</span><span class="p">,</span><span class="w">
                          </span><span class="ss">name</span><span class="o">=</span><span class="s">&quot;Bryan&quot;</span><span class="p">,</span><span class="w">
                          </span><span class="ss">age</span><span class="o">=</span><span class="ss">&#39;_&#39;</span><span class="p">,</span><span class="w">
                          </span><span class="ss">occupation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&#39;_&#39;</span><span class="p" data-group-id="5434017553-4">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5434017553-5">[</span><span class="p" data-group-id="5434017553-5">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5434017553-6">[</span><span class="ss">&#39;$_&#39;</span><span class="p" data-group-id="5434017553-6">]</span><span class="p" data-group-id="5434017553-3">}</span><span class="p" data-group-id="5434017553-2">]</span><span class="p" data-group-id="5434017553-1">)</span><span class="p">,</span></code></pre><p><strong>DO NOT</strong></p><pre><code class="makeup erlang" translate="no"><span class="n">TabList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">tab2list</span><span class="p" data-group-id="0388179651-1">(</span><span class="n">Tab</span><span class="p" data-group-id="0388179651-1">)</span><span class="p">,</span><span class="w">
</span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="0388179651-2">(</span><span class="nf">fun</span><span class="p" data-group-id="0388179651-3">(</span><span class="n">X</span><span class="p" data-group-id="0388179651-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">X</span><span class="o">#</span><span class="ss">person</span><span class="p">.</span><span class="ss">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Bryan&quot;</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">TabList</span><span class="p" data-group-id="0388179651-2">)</span><span class="p">,</span></code></pre><h3 id="ordered_set-tables" class="section-heading"><a href="#ordered_set-tables" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text"><code class="inline">ordered_set</code> Tables</span></h3><p>If the data in the table is to be accessed so that the order of the keys in the
table is significant, the table type <code class="inline">ordered_set</code> can be used instead of the
more usual <code class="inline">set</code> table type. An <code class="inline">ordered_set</code> is always traversed in Erlang term
order regarding the key field so that the return values from functions such as
<code class="inline">select</code>, <code class="inline">match_object</code>, and <code class="inline">foldl</code> are ordered by the key values. Traversing
an <code class="inline">ordered_set</code> with the <code class="inline">first</code> and <code class="inline">next</code> operations also returns the keys
ordered.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p>An <code class="inline">ordered_set</code> only guarantees that objects are processed in <em>key</em> order.
Results from functions such as <a href="../apps/stdlib/ets.html#select/2"><code class="inline">ets:select/2</code></a> appear in <em>key</em> order even if
the key is not included in the result.</p></section><h2 id="ets" class="section-heading"><a href="#ets" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ETS</span></h2><h3 id="using-keys-of-ets-table" class="section-heading"><a href="#using-keys-of-ets-table" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Using Keys of Ets Table</span></h3><p>An Ets table is a single-key table (either a hash table or a tree ordered by the
key) and is to be used as one. In other words, use the key to look up things
whenever possible. A lookup by a known key in a <code class="inline">set</code> Ets table is constant and
for an <code class="inline">ordered_set</code> Ets table it is <em>O(log N)</em>. A key lookup is always preferable
to a call where the whole table has to be scanned. In the previous examples, the
field <code class="inline">idno</code> is the key of the table and all lookups where only the name is
known result in a complete scan of the (possibly large) table for a matching
result.</p><p>A simple solution would be to use the <code class="inline">name</code> field as the key instead of the
<code class="inline">idno</code> field, but that would cause problems if the names were not unique. A more
general solution would be to create a second table with <code class="inline">name</code> as key and <code class="inline">idno</code>
as data, that is, to index (invert) the table regarding the <code class="inline">name</code> field.
Clearly, the second table would have to be kept consistent with the master
table. Mnesia can do this for you, but a home-brew index table can be very
efficient compared to the overhead involved in using Mnesia.</p><p>An index table for the table in the previous examples would have to be a bag (as
keys would appear more than once) and can have the following contents:</p><pre><code class="text">[#index_entry{name=&quot;Adam&quot;, idno=1},
 #index_entry{name=&quot;Bryan&quot;, idno=2},
 #index_entry{name=&quot;Bryan&quot;, idno=3},
 #index_entry{name=&quot;Carl&quot;, idno=4}]</code></pre><p>Given this index table, a lookup of the <code class="inline">age</code> fields for all persons named
&quot;Bryan&quot; can be done as follows:</p><pre><code class="makeup erlang" translate="no"><span class="n">MatchingIDs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">lookup</span><span class="p" data-group-id="0216098642-1">(</span><span class="n">IndexTable</span><span class="p">,</span><span class="s">&quot;Bryan&quot;</span><span class="p" data-group-id="0216098642-1">)</span><span class="p">,</span><span class="w">
</span><span class="nc">lists</span><span class="p">:</span><span class="nf">map</span><span class="p" data-group-id="0216098642-2">(</span><span class="nf">fun</span><span class="p" data-group-id="0216098642-3">(</span><span class="o">#</span><span class="ss">index_entry</span><span class="p" data-group-id="0216098642-4">{</span><span class="ss">idno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ID</span><span class="p" data-group-id="0216098642-4">}</span><span class="p" data-group-id="0216098642-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                 </span><span class="p" data-group-id="0216098642-5">[</span><span class="o">#</span><span class="ss">person</span><span class="p" data-group-id="0216098642-6">{</span><span class="ss">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Age</span><span class="p" data-group-id="0216098642-6">}</span><span class="p" data-group-id="0216098642-5">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">lookup</span><span class="p" data-group-id="0216098642-7">(</span><span class="n">PersonTable</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="p" data-group-id="0216098642-7">)</span><span class="p">,</span><span class="w">
                 </span><span class="n">Age</span><span class="w">
          </span><span class="k">end</span><span class="p">,</span><span class="w">
          </span><span class="n">MatchingIDs</span><span class="p" data-group-id="0216098642-2">)</span><span class="p">,</span></code></pre><p>Notice that this code does not use <a href="../apps/stdlib/ets.html#match/2"><code class="inline">ets:match/2</code></a>, but instead uses the
<a href="../apps/stdlib/ets.html#lookup/2"><code class="inline">ets:lookup/2</code></a> call. The <a href="../apps/stdlib/lists.html#map/2"><code class="inline">lists:map/2</code></a> call is only used to traverse the <code class="inline">idno</code>s
matching the name &quot;Bryan&quot; in the table; thus the number of lookups in the master
table is minimized.</p><p>Keeping an index table introduces some overhead when inserting records in the
table. The number of operations gained from the table must therefore be compared
against the number of operations inserting objects in the table. However, notice
that the gain is significant when the key can be used to lookup elements.</p><h2 id="mnesia" class="section-heading"><a href="#mnesia" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Mnesia</span></h2><h3 id="secondary-index" class="section-heading"><a href="#secondary-index" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Secondary Index</span></h3><p>If you frequently do lookups on a field that is not the key of the table, you
lose performance using <a href="../apps/mnesia/mnesia.html#select/3">mnesia:select()</a> or
<a href="../apps/mnesia/mnesia.html#match_object/1"><code class="inline">mnesia:match_object()</code></a> as these function traverse
the whole table. Instead, you can create a secondary index and use
<a href="../apps/mnesia/mnesia.html#index_read/3"><code class="inline">mnesia:index_read/3</code></a> to get faster access at the expense of using more
memory.</p><p><em>Example:</em></p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="0845162803-1">(</span><span class="ss">person</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0845162803-2">{</span><span class="ss">idno</span><span class="p">,</span><span class="w"> </span><span class="ss">name</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">,</span><span class="w"> </span><span class="ss">occupation</span><span class="p" data-group-id="0845162803-2">}</span><span class="p" data-group-id="0845162803-1">)</span><span class="p">.</span><span class="w">
        </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="0845162803-3">{</span><span class="ss">atomic</span><span class="p">,</span><span class="w"> </span><span class="ss">ok</span><span class="p" data-group-id="0845162803-3">}</span><span class="w"> </span><span class="o">=</span><span class="w">
</span><span class="nc">mnesia</span><span class="p">:</span><span class="nf">create_table</span><span class="p" data-group-id="0845162803-4">(</span><span class="ss">person</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0845162803-5">[</span><span class="p" data-group-id="0845162803-6">{</span><span class="ss">index</span><span class="p">,</span><span class="p" data-group-id="0845162803-7">[</span><span class="o">#</span><span class="ss">person</span><span class="p">.</span><span class="ss">age</span><span class="p" data-group-id="0845162803-7">]</span><span class="p" data-group-id="0845162803-6">}</span><span class="p">,</span><span class="w">
                              </span><span class="p" data-group-id="0845162803-8">{</span><span class="ss">attributes</span><span class="p">,</span><span class="w">
                                    </span><span class="nf">record_info</span><span class="p" data-group-id="0845162803-9">(</span><span class="ss">fields</span><span class="p">,</span><span class="w"> </span><span class="ss">person</span><span class="p" data-group-id="0845162803-9">)</span><span class="p" data-group-id="0845162803-8">}</span><span class="p" data-group-id="0845162803-5">]</span><span class="p" data-group-id="0845162803-4">)</span><span class="p">,</span><span class="w">
</span><span class="p" data-group-id="0845162803-10">{</span><span class="ss">atomic</span><span class="p">,</span><span class="w"> </span><span class="ss">ok</span><span class="p" data-group-id="0845162803-10">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">mnesia</span><span class="p">:</span><span class="nf">add_table_index</span><span class="p" data-group-id="0845162803-11">(</span><span class="ss">person</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p" data-group-id="0845162803-11">)</span><span class="p">,</span><span class="w">
</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">

</span><span class="n">PersonsAge42</span><span class="w"> </span><span class="o">=</span><span class="w">
     </span><span class="nc">mnesia</span><span class="p">:</span><span class="nf">dirty_index_read</span><span class="p" data-group-id="0845162803-12">(</span><span class="ss">person</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">person</span><span class="p">.</span><span class="ss">age</span><span class="p" data-group-id="0845162803-12">)</span><span class="p">,</span></code></pre><h3 id="transactions" class="section-heading"><a href="#transactions" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Transactions</span></h3><p>Using transactions is a way to guarantee that the distributed Mnesia database
remains consistent, even when many different processes update it in parallel.
However, if you have real-time requirements it is recommended to use dirtry
operations instead of transactions. When using dirty operations, you lose the
consistency guarantee; this is usually solved by only letting one process update
the table. Other processes must send update requests to that process.</p><p><em>Example:</em></p><pre><code class="makeup erlang" translate="no"><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="c1">%% Using transaction</span><span class="w">

</span><span class="n">Fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="4367691096-1">(</span><span class="p" data-group-id="4367691096-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
          </span><span class="p" data-group-id="4367691096-2">[</span><span class="nc">mnesia</span><span class="p">:</span><span class="nf">read</span><span class="p" data-group-id="4367691096-3">(</span><span class="p" data-group-id="4367691096-4">{</span><span class="n">Table</span><span class="p">,</span><span class="w"> </span><span class="n">Key</span><span class="p" data-group-id="4367691096-4">}</span><span class="p" data-group-id="4367691096-3">)</span><span class="p">,</span><span class="w">
           </span><span class="nc">mnesia</span><span class="p">:</span><span class="nf">read</span><span class="p" data-group-id="4367691096-5">(</span><span class="p" data-group-id="4367691096-6">{</span><span class="n">Table2</span><span class="p">,</span><span class="w"> </span><span class="n">Key2</span><span class="p" data-group-id="4367691096-6">}</span><span class="p" data-group-id="4367691096-5">)</span><span class="p" data-group-id="4367691096-2">]</span><span class="w">
      </span><span class="k">end</span><span class="p">,</span><span class="w">

</span><span class="p" data-group-id="4367691096-7">{</span><span class="ss">atomic</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4367691096-8">[</span><span class="n">Result1</span><span class="p">,</span><span class="w"> </span><span class="n">Result2</span><span class="p" data-group-id="4367691096-8">]</span><span class="p" data-group-id="4367691096-7">}</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nc">mnesia</span><span class="p">:</span><span class="nf">transaction</span><span class="p" data-group-id="4367691096-9">(</span><span class="n">Fun</span><span class="p" data-group-id="4367691096-9">)</span><span class="p">,</span><span class="w">
</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Same thing using dirty operations</span><span class="w">
</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">

</span><span class="n">Result1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">mnesia</span><span class="p">:</span><span class="nf">dirty_read</span><span class="p" data-group-id="4367691096-10">(</span><span class="p" data-group-id="4367691096-11">{</span><span class="n">Table</span><span class="p">,</span><span class="w"> </span><span class="n">Key</span><span class="p" data-group-id="4367691096-11">}</span><span class="p" data-group-id="4367691096-10">)</span><span class="p">,</span><span class="w">
</span><span class="n">Result2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">mnesia</span><span class="p">:</span><span class="nf">dirty_read</span><span class="p" data-group-id="4367691096-12">(</span><span class="p" data-group-id="4367691096-13">{</span><span class="n">Table2</span><span class="p">,</span><span class="w"> </span><span class="n">Key2</span><span class="p" data-group-id="4367691096-13">}</span><span class="p" data-group-id="4367691096-12">)</span><span class="p">,</span></code></pre>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="eff_guide_functions.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Functions
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="eff_guide_processes.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Processes
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Erlang System Documentation.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright © 1996-2025 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js"></script>
  <script>
  let initialized = false;

  window.addEventListener("exdoc:loaded", () => {
      if (!initialized) {
      mermaid.initialize({
          startOnLoad: false,
          theme: document.body.className.includes("dark") ? "dark" : "default"
      });
      initialized = true;
      }

      let id = 0;
      for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
          graphEl.innerHTML = svg;
          bindFunctions?.(graphEl);
          preEl.insertAdjacentElement("afterend", graphEl);
          preEl.remove();
      });
      }
  });
  </script>

  </body>
</html>
