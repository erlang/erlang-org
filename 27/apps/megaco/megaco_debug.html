<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.37.3">
    <meta name="project" content="megaco v4.7.2">


<meta name="major-vsn" content="27">
<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=27&q=">
<link rel="canonical" href="https://www.erlang.org/doc/apps/megaco/megaco_debug.html" />
    <title>Testing and tools — megaco v4.7.2</title>

    <link rel="stylesheet" href="dist/html-erlang-FDBURIED.css" />

    <script defer src="dist/sidebar_items-0FDD3384.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-ALU6OERS.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="megaco" />
        </a>

      <div>
        <a href="../../index.html" class="sidebar-projectName" translate="no">
megaco
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v4.7.2
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of megaco</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>Testing and tools</h1>


      <a href="https://github.com/erlang/otp/blob/OTP-27.3.4.6/lib/megaco/doc/guides/megaco_debug.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>

<h2 id="tracing" class="section-heading">
  <a href="#tracing" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Tracing</span>
</h2>
<p>We have instrumented our code in order to enable tracing. Running the
application with tracing deactivated, causes a negligible performance overhead
(an external call to a function which returns an atom). Activation of tracing
does not require any recompilation of the code, since we rely on Erlang/OTP's
built in support for dynamic trace activation. In our case tracing of calls to a
given external function.</p><p>Event traces can be viewed in a generic message sequence chart tool, <code class="inline">et</code>, or as
standard output (events are written to stdio).</p><p>See <a href="megaco.html#enable_trace/2">enable_trace</a>,
<a href="megaco.html#disable_trace/0">disable_trace</a> and <a href="megaco.html#set_trace/1">set_trace</a>
for more info.</p><h2 id="measurement-and-transformation" class="section-heading">
  <a href="#measurement-and-transformation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Measurement and transformation</span>
</h2>
<p>We have included some simple tool(s) for codec measurement (meas), performance
tests (mstone1 and mstone2) and message transformation.</p><p>The tool(s) are located in the example/meas directory.</p><h3 id="requirement" class="section-heading">
  <a href="#requirement" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Requirement</span>
</h3>
<ul><li>Erlang/OTP, version 24.2 or later.</li><li>Version 4.2 or later of <em>this</em> application.</li><li>Version 5.0.17 or later of the <em>asn1</em> application.</li><li>The flex libraries. Without it, the flex powered codecs cannot be used.</li></ul><h3 id="meas-results" class="section-heading">
  <a href="#meas-results" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Meas results</span>
</h3>
<p>The results from the measurement run (meas) is four excel-compatible textfiles:</p><ul><li>decode_time.xls -&gt; Decoding result</li><li>encode_time.xls -&gt; Encoding result</li><li>total_time.xls -&gt; Total (Decoding+encoding) result</li><li>message_size.xls -&gt; Message size</li></ul><h3 id="instruction" class="section-heading">
  <a href="#instruction" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Instruction</span>
</h3>
<p>The tool contain four things:</p><ul><li>The transformation module</li><li>The measurement (meas) module(s)</li><li>The mstone (mstone1 and mstone2) module(s)</li><li>The basic message file</li></ul><h4>Message Transformation</h4><p>The messages used by the different tools are contained in single message package
file (see below for more info). The messages in this file is encoded with just
one codec. During measurement initiation, the messages are read and then
transformed to all codec formats used in the measurement.</p><p>The message transformation is done by the transformation module. It is used to
transform a set of messages encoded with one codec into the other base codec's.</p><h4>Measurement(s)</h4><p>There are two different measurement tools:</p><ul><li><p><em>meas</em>:</p><p>Used to perform codec measurements. That is, to see what kind of performance
can be expected by the different codecs provided by the megaco application.</p><p>The measurement is done by iterating over the decode/encode function for
approx 2 seconds per message and counting the number of decodes/encodes.</p><p>Is best run by modifying the meas.sh.skel skeleton script provided by the
tool.</p><p>To run it manually do the following:</p><pre><code class="makeup erlang" translate="no"><span class="w">        </span><span class="c1">% erl -pa &lt;path-megaco-ebin-dir&gt; -pa &lt;path-to-meas-module-dir&gt;</span><span class="w">
        </span><span class="n">Erlang</span><span class="w"> </span><span class="p" data-group-id="1584199069-1">(</span><span class="n">BEAM</span><span class="p" data-group-id="1584199069-1">)</span><span class="w"> </span><span class="ss">emulator</span><span class="w"> </span><span class="ss">version</span><span class="w"> </span><span class="mf">5.6</span><span class="w"> </span><span class="p" data-group-id="1584199069-2">[</span><span class="ss">source</span><span class="p" data-group-id="1584199069-2">]</span><span class="w">

        </span><span class="n">Eshell</span><span class="w"> </span><span class="n">V12</span><span class="p">.</span><span class="mi">2</span><span class="w">  </span><span class="p" data-group-id="1584199069-3">(</span><span class="ss">abort</span><span class="w"> </span><span class="ss">with</span><span class="w"> </span><span class="err">^</span><span class="n">G</span><span class="p" data-group-id="1584199069-3">)</span><span class="w">
        </span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">megaco_codec_meas</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="1584199069-4">(</span><span class="p" data-group-id="1584199069-4">)</span><span class="p">.</span><span class="w">
        </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
        </span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">halt</span><span class="p" data-group-id="1584199069-5">(</span><span class="p" data-group-id="1584199069-5">)</span><span class="p">.</span></code></pre><p>or to make it even easier, assuming a measure shall be done on all the codecs
(as above):</p><pre><code class="text">        % erl -noshell -pa &lt;path-megaco-ebin-dir&gt; \\
              -pa &lt;path-to-meas-module-dir&gt; \\
              -s megaco_codec_meas -s init stop</code></pre><p>When run as above (this will take some time), the measurement process is done
as follows:</p><pre><code class="text">For each codec:
    For each message:
        Read the message from the file
            Detect message version
            Measure decode
                Measure encode
          Write results, encode, decode and total, to file</code></pre></li><li><p><em>mstone1 and mstone2</em>:</p><p>These are two different SMP performance monitoring tool(s).</p><p><em>mstone1</em> creates a process for each codec config supported by the megaco
application and let them run for a specific time (all at the same time),
encoding and decoding megaco messages. The number of messages processed in
total is the mstone1(1) value.</p><p>There are different ways to run the mstone1 tool, e.g. with or without the use
of drivers, with <em>only</em> flex-empowered configs.</p><p>Is best run by modifying the mstone1.sh.skel skeleton script provided by the
tool.</p><p>The <em>mstone2</em> is similar to the <em>mstone1</em> tool, but in this case, each created
process makes only <em>one</em> run through the messages and then exits. A soon as a
process exits, a new process (with the same config and messages) is created to
takes its place. The number of messages processed in total is the mstone2(1)
value.</p></li></ul><p>Both these tools use the message package (time_test.msgs) provided with the
tool(s), although it can run on any message package as long as it has the same
structure.</p><h4>Message package file</h4><p>This is simply an erlang compatible text-file with the following structure:
<code class="inline">{codec_name(), messages_list()}</code>.</p><pre><code class="makeup erlang" translate="no"><span class="nf">codec_name</span><span class="p" data-group-id="3743271323-1">(</span><span class="p" data-group-id="3743271323-1">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">pretty</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="ss">compact</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="ss">ber</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="ss">per</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">erlang</span><span class="w">      </span><span class="p" data-group-id="3743271323-2">(</span><span class="ss">how</span><span class="w"> </span><span class="ss">the</span><span class="w"> </span><span class="ss">messages</span><span class="w"> </span><span class="ss">are</span><span class="w"> </span><span class="ss">encoded</span><span class="p" data-group-id="3743271323-2">)</span><span class="w">
</span><span class="nf">messages_list</span><span class="p" data-group-id="3743271323-3">(</span><span class="p" data-group-id="3743271323-3">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3743271323-4">[</span><span class="p" data-group-id="3743271323-5">{</span><span class="nf">message_name</span><span class="p" data-group-id="3743271323-6">(</span><span class="p" data-group-id="3743271323-6">)</span><span class="p">,</span><span class="w"> </span><span class="nf">message</span><span class="p" data-group-id="3743271323-7">(</span><span class="p" data-group-id="3743271323-7">)</span><span class="p" data-group-id="3743271323-5">}</span><span class="p" data-group-id="3743271323-4">]</span><span class="w">
</span><span class="nf">message_name</span><span class="p" data-group-id="3743271323-8">(</span><span class="p" data-group-id="3743271323-8">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">atom</span><span class="p" data-group-id="3743271323-9">(</span><span class="p" data-group-id="3743271323-9">)</span><span class="w">
</span><span class="nf">message</span><span class="p" data-group-id="3743271323-10">(</span><span class="p" data-group-id="3743271323-10">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">binary</span><span class="p" data-group-id="3743271323-11">(</span><span class="p" data-group-id="3743271323-11">)</span></code></pre><p>The codec name is the name of the codec with which all messages in the
<code class="inline">message_list()</code> has been encoded.</p><p>This file can be <code class="inline">exported</code> to a file structure by calling the
<a href="megaco_codec_transform.html#export_messages">export_messages</a> function. This can
be usefull if a measurement shall be done with an external tool. Exporting the
messages creates a directory tree with the following structure:</p><pre><code class="text">&lt;message package&gt;/pretty/&lt;message-files&gt;
                  compact/
                  per/
                  ber/&lt;message-files&gt;
                  erlang/</code></pre><p>The file includes both version 1, 2 and version 3 messages.</p><h3 id="notes" class="section-heading">
  <a href="#notes" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Notes</span>
</h3>
<h4>Binary codecs</h4><p>There are two basic ways to use the binary encodings: With package related name
and termination id transformation (the 'native' encoding config) or without.
This transformation converts package related names and termination id's to a
more convenient internal form (equivalent with the decoded text message).</p><p>The transformation is done _after_ the actual decode has been done.</p><p>Therefor in the tests, binary codecs are tested with two different encoding
configs to determine exactly how the different options effect the performance:
with transformation ([]) and without transformation ([native]).</p><h4>Included test messages</h4><p>Some of these messages are ripped from the call flow examples in an old version
of the RFC and others are created to test a specific feature of megaco.</p><h4>Measurement tool directory name</h4><p>Be sure <em>not</em> no name the directory containing the measurement binaries starting
with 'megaco-', e.g. megaco-meas. This will confuse the erlang application
loader (erlang applications are named, e.g. megaco-5.2).</p>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="megaco_performance.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Performance comparison
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

  </div>
</div>
    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="megaco.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.37.3) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright © 1996-2025 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js"></script>
  <script>
  let initialized = false;

  window.addEventListener("exdoc:loaded", () => {
      if (!initialized) {
      mermaid.initialize({
          startOnLoad: false,
          theme: document.body.className.includes("dark") ? "dark" : "default"
      });
      initialized = true;
      }

      let id = 0;
      for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
          graphEl.innerHTML = svg;
          bindFunctions?.(graphEl);
          preEl.insertAdjacentElement("afterend", graphEl);
          preEl.remove();
      });
      }
  });
  </script>

  </body>
</html>
