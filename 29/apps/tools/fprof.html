<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.1">
    <meta name="project" content="tools v4.1.2-rc0">


<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=29&q=">
<meta name="major-vsn" content="29">
<link rel="canonical" href="https://www.erlang.org/docs/29/apps/tools/fprof.html" />
    <title>fprof — tools v4.1.2-rc0</title>

    <link rel="stylesheet" href="dist/html-erlang-ZK43ZOAC.css" />

    <script defer src="dist/sidebar_items-FEEFEFAE.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="tools" />
        </a>

      <div>
        <a href="../../index.html" class="sidebar-projectName" translate="no">
tools
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v4.1.2-rc0
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-module" id="main" data-type="modules">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of tools</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>
      <span translate="no">fprof</span> 
      <small class="app-vsn" translate="no">(tools v4.1.2-rc0)</small>

    </h1>

      <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L30" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


    <section id="moduledoc">
<p>A Time Profiling Tool using trace to file for minimal runtime performance
impact.</p><p>This module is used to profile a program to find out how the execution time is
used. Tracing to file is used to minimize the runtime performance degradation.</p><p>The <code class="inline">fprof</code> module uses tracing to collect profiling data, hence there is no
need for special compilation of any module to be profiled. When it starts
tracing, <code class="inline">fprof</code> will erase all previous tracing in the node and set the
necessary trace flags on the profiling target processes as well as local call
trace on all functions in all loaded modules and all modules to be loaded.
<code class="inline">fprof</code> disable all tracing in the node when it stops tracing.</p><p><code class="inline">fprof</code> presents both <em>own time</em> that is, how much time a function has
used for its own execution, and <em>accumulated time</em> that is, including
called functions. All presented times are collected using trace
timestamps. <code class="inline">fprof</code> tries to collect CPU time timestamps, if the host
machine OS supports it. Therefore, the times can be wallclock times and
OS scheduling will randomly strike all called functions in a
presumably fair way.</p><p>However, if the profiling time is short, and the host machine OS does
not support high resolution CPU time measurements, a few OS
schedulings can show up as ridiculously long execution times for
functions doing practically nothing. As an example, it has been
observed that a function that more or less just composing a tuple, was
running 100 times slower than normal. When tracing was repeated, the
execution time was normal.</p><p>Profiling is essentially done in 3 steps:</p><ul><li><p>Tracing: to a file. The trace data contains entries for function
calls, returns to function, process scheduling, other process
related events (for example <code class="inline">spawn</code>), and garbage collection. All trace
entries are timestamped.</p></li><li><p>Profiling: the trace file is read, the execution call stack is
simulated, and raw profile data is calculated from the simulated call stack
and the trace timestamps. The profile data is stored in the <code class="inline">fprof</code> server
state. During this step the trace data may be dumped in text format to file or
console.</p></li><li><p>Analysing: the raw profile data is sorted, filtered and dumped in
text format either to file or console. The text format intended to be both
readable for a human reader, as well as parsable with the standard erlang
parsing tools.</p></li></ul><p>Since <code class="inline">fprof</code> sends trace data to afile, the runtime performance
degradation is minimized, but still far from negligible, especially
for programs that themselves use the filesystem heavily. Where the
trace file is placed is also important, for example, on Unix systems
<code class="inline">/tmp</code> is usually a good choice since it is essentially a RAM disk,
while any network-mounted disk is a bad idea.</p><p><code class="inline">fprof</code> can also skip the file step and trace to a tracer process that does the
profiling in runtime.</p><p><a href="" id="analysis"></a></p><h2 id="module-analysis-format" class="section-heading"><a href="#module-analysis-format" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Analysis format</span></h2><p>This section describes the output format of the <a href="#analyse/1"><code class="inline">analyse/1</code></a> function.</p><p>The format is parsable with the standard Erlang parsing tools
<a href="../../apps/stdlib/erl_scan.html"><code class="inline">erl_scan</code></a> and <a href="../../apps/stdlib/erl_parse.html"><code class="inline">erl_parse</code></a>, <a href="../../apps/kernel/file.html#consult/1"><code class="inline">file:consult/1</code></a>, or <a href="../../apps/stdlib/io.html#read/2"><code class="inline">io:read/2</code></a>. The
parse format is not described here — it should be easy enough for the
interested reader to try it out. Note that some flags to
<a href="#analyse/1"><code class="inline">analyse/1</code></a> will affect the format.</p><p>The following example was run on Erlang/OTP R8 on Solaris 8; all OTP
internals in this example are version dependent.</p><p>As an example, we will use the following function, which is a
slightly modified benchmark function from module <a href="../../apps/kernel/file.html"><code class="inline">file</code></a>:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="5499858521-1">(</span><span class="ss">foo</span><span class="p" data-group-id="5499858521-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="5499858521-2">(</span><span class="p" data-group-id="5499858521-3">[</span><span class="ss">create_file_slow</span><span class="p">/</span><span class="mi">2</span><span class="p" data-group-id="5499858521-3">]</span><span class="p" data-group-id="5499858521-2">)</span><span class="p">.</span><span class="w">

</span><span class="nf">create_file_slow</span><span class="p" data-group-id="5499858521-4">(</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p" data-group-id="5499858521-4">)</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="nf">is_integer</span><span class="p" data-group-id="5499858521-5">(</span><span class="n">N</span><span class="p" data-group-id="5499858521-5">)</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5499858521-6">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">FD</span><span class="p" data-group-id="5499858521-6">}</span><span class="w"> </span><span class="o">=</span><span class="w">
        </span><span class="nc">file</span><span class="p">:</span><span class="nf">open</span><span class="p" data-group-id="5499858521-7">(</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5499858521-8">[</span><span class="ss">raw</span><span class="p">,</span><span class="w"> </span><span class="ss">write</span><span class="p">,</span><span class="w"> </span><span class="ss">delayed_write</span><span class="p">,</span><span class="w"> </span><span class="ss">binary</span><span class="p" data-group-id="5499858521-8">]</span><span class="p" data-group-id="5499858521-7">)</span><span class="p">,</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">256</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">file</span><span class="p">:</span><span class="nf">write</span><span class="p" data-group-id="5499858521-9">(</span><span class="n">FD</span><span class="p">,</span><span class="w">
                            </span><span class="nc">lists</span><span class="p">:</span><span class="nf">map</span><span class="p" data-group-id="5499858521-10">(</span><span class="nf">fun</span><span class="w"> </span><span class="p" data-group-id="5499858521-11">(</span><span class="n">X</span><span class="p" data-group-id="5499858521-11">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="5499858521-12">&lt;&lt;</span><span class="n">X</span><span class="p">:</span><span class="mi">32</span><span class="o">/</span><span class="ss">unsigned</span><span class="p" data-group-id="5499858521-12">&gt;&gt;</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
                            </span><span class="nc">lists</span><span class="p">:</span><span class="nf">seq</span><span class="p" data-group-id="5499858521-13">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p" data-group-id="5499858521-13">)</span><span class="p" data-group-id="5499858521-10">)</span><span class="p" data-group-id="5499858521-9">)</span><span class="p">,</span><span class="w">
            </span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">create_file_slow</span><span class="p" data-group-id="5499858521-14">(</span><span class="n">FD</span><span class="p">,</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p" data-group-id="5499858521-14">)</span><span class="p">;</span><span class="w">
       </span><span class="ss">true</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">create_file_slow</span><span class="p" data-group-id="5499858521-15">(</span><span class="n">FD</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p" data-group-id="5499858521-15">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">file</span><span class="p">:</span><span class="nf">close</span><span class="p" data-group-id="5499858521-16">(</span><span class="n">FD</span><span class="p" data-group-id="5499858521-16">)</span><span class="p">.</span><span class="w">

</span><span class="nf">create_file_slow</span><span class="p" data-group-id="5499858521-17">(</span><span class="n">FD</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p" data-group-id="5499858521-17">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="ss">ok</span><span class="p">;</span><span class="w">
</span><span class="nf">create_file_slow</span><span class="p" data-group-id="5499858521-18">(</span><span class="n">FD</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p" data-group-id="5499858521-18">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">file</span><span class="p">:</span><span class="nf">write</span><span class="p" data-group-id="5499858521-19">(</span><span class="n">FD</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5499858521-20">&lt;&lt;</span><span class="n">M</span><span class="p">:</span><span class="mi">32</span><span class="o">/</span><span class="ss">unsigned</span><span class="p" data-group-id="5499858521-20">&gt;&gt;</span><span class="p" data-group-id="5499858521-19">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">create_file_slow</span><span class="p" data-group-id="5499858521-21">(</span><span class="n">FD</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p" data-group-id="5499858521-21">)</span><span class="p">.</span></code></pre><p>Let us have a look at the printout after running:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">fprof</span><span class="p">:</span><span class="nf">apply</span><span class="p" data-group-id="0749507620-1">(</span><span class="ss">foo</span><span class="p">,</span><span class="w"> </span><span class="ss">create_file_slow</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0749507620-2">[</span><span class="ss">junk</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p" data-group-id="0749507620-2">]</span><span class="p" data-group-id="0749507620-1">)</span><span class="p">.</span><span class="gp unselectable">
2&gt; </span><span class="nc">fprof</span><span class="p">:</span><span class="nf">profile</span><span class="p" data-group-id="0749507620-3">(</span><span class="p" data-group-id="0749507620-3">)</span><span class="p">.</span><span class="gp unselectable">
3&gt; </span><span class="nc">fprof</span><span class="p">:</span><span class="nf">analyse</span><span class="p" data-group-id="0749507620-4">(</span><span class="p" data-group-id="0749507620-4">)</span><span class="p">.</span></code></pre><p>The printout starts with:</p><pre><code class="makeup erlang" translate="no"><span class="c1">%% Analysis results:</span><span class="w">
</span><span class="p" data-group-id="8073035685-1">{</span><span class="w">  </span><span class="ss">analysis_options</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="8073035685-2">[</span><span class="p" data-group-id="8073035685-3">{</span><span class="ss">callers</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8073035685-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="8073035685-4">{</span><span class="ss">sort</span><span class="p">,</span><span class="w"> </span><span class="ss">acc</span><span class="p" data-group-id="8073035685-4">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="8073035685-5">{</span><span class="ss">totals</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="8073035685-5">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="8073035685-6">{</span><span class="ss">details</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8073035685-6">}</span><span class="p" data-group-id="8073035685-2">]</span><span class="p" data-group-id="8073035685-1">}</span><span class="p">.</span><span class="w">

</span><span class="c1">%                                       CNT       ACC       OWN</span><span class="w">
</span><span class="p" data-group-id="8073035685-7">[</span><span class="p" data-group-id="8073035685-8">{</span><span class="w"> </span><span class="ss">totals</span><span class="p">,</span><span class="w">                             </span><span class="mi">9627</span><span class="p">,</span><span class="w"> </span><span class="mf">1691.119</span><span class="p">,</span><span class="w"> </span><span class="mf">1659.074</span><span class="p" data-group-id="8073035685-8">}</span><span class="p" data-group-id="8073035685-7">]</span><span class="p">.</span><span class="w">  </span><span class="c1">%%%</span></code></pre><p>The <code class="inline">CNT</code> column shows the total number of function calls that was found in the
trace. In the <code class="inline">ACC</code> column is the total time of the trace from first timestamp to
last. And in the <code class="inline">OWN</code> column is the sum of the execution time in functions found
in the trace, not including called functions. In this case it is very close to
the <code class="inline">ACC</code> time since the emulator had practically nothing to do except
executing our test program.</p><p>All time values in the printout are in milliseconds.</p><p>The printout continues:</p><pre><code class="makeup erlang" translate="no"><span class="c1">%                                       CNT       ACC       OWN</span><span class="w">
</span><span class="p" data-group-id="4213087327-1">[</span><span class="p" data-group-id="4213087327-2">{</span><span class="w"> </span><span class="s">&quot;&lt;0.28.0&gt;&quot;</span><span class="p">,</span><span class="w">                         </span><span class="mi">9627</span><span class="p">,</span><span class="ss">undefined</span><span class="p">,</span><span class="w"> </span><span class="mf">1659.074</span><span class="p" data-group-id="4213087327-2">}</span><span class="p" data-group-id="4213087327-1">]</span><span class="p">.</span><span class="w">   </span><span class="c1">%%</span></code></pre><p>This is the printout header of one process. The printout contains only this one
process since we called <a href="#apply/3"><code class="inline">fprof:apply/3</code></a> that traces only the current process.
Therefore the <code class="inline">CNT</code> and <code class="inline">OWN</code> columns perfectly matches the totals above. The <code class="inline">ACC</code>
column is undefined since summing the <code class="inline">ACC</code> times of all calls in the process
makes no sense — one would get something like the <code class="inline">ACC</code> value from totals above
multiplied by the average depth of the call stack.</p><p>All paragraphs up to the next process header only concerns function calls within
this process.</p><p>Now we come to something more interesting:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="7215945400-1">{</span><span class="p" data-group-id="7215945400-2">[</span><span class="p" data-group-id="7215945400-3">{</span><span class="ss">undefined</span><span class="p">,</span><span class="w">                             </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1691.076</span><span class="p">,</span><span class="w">    </span><span class="mf">0.030</span><span class="p" data-group-id="7215945400-3">}</span><span class="p" data-group-id="7215945400-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="7215945400-4">{</span><span class="w"> </span><span class="p" data-group-id="7215945400-5">{</span><span class="ss">fprof</span><span class="p">,</span><span class="ss">apply_start_stop</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="7215945400-5">}</span><span class="p">,</span><span class="w">            </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1691.076</span><span class="p">,</span><span class="w">    </span><span class="mf">0.030</span><span class="p" data-group-id="7215945400-4">}</span><span class="p">,</span><span class="w">     </span><span class="c1">%</span><span class="w">
 </span><span class="p" data-group-id="7215945400-6">[</span><span class="p" data-group-id="7215945400-7">{</span><span class="p" data-group-id="7215945400-8">{</span><span class="ss">foo</span><span class="p">,</span><span class="ss">create_file_slow</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="7215945400-8">}</span><span class="p">,</span><span class="w">              </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">1691.046</span><span class="p">,</span><span class="w">    </span><span class="mf">0.103</span><span class="p" data-group-id="7215945400-7">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7215945400-9">{</span><span class="ss">suspend</span><span class="p">,</span><span class="w">                               </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="7215945400-9">}</span><span class="p" data-group-id="7215945400-6">]</span><span class="p" data-group-id="7215945400-1">}</span><span class="p">.</span><span class="w">

</span><span class="p" data-group-id="7215945400-10">{</span><span class="p" data-group-id="7215945400-11">[</span><span class="p" data-group-id="7215945400-12">{</span><span class="p" data-group-id="7215945400-13">{</span><span class="ss">fprof</span><span class="p">,</span><span class="ss">apply_start_stop</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="7215945400-13">}</span><span class="p">,</span><span class="w">            </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">1691.046</span><span class="p">,</span><span class="w">    </span><span class="mf">0.103</span><span class="p" data-group-id="7215945400-12">}</span><span class="p" data-group-id="7215945400-11">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="7215945400-14">{</span><span class="w"> </span><span class="p" data-group-id="7215945400-15">{</span><span class="ss">foo</span><span class="p">,</span><span class="ss">create_file_slow</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="7215945400-15">}</span><span class="p">,</span><span class="w">              </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">1691.046</span><span class="p">,</span><span class="w">    </span><span class="mf">0.103</span><span class="p" data-group-id="7215945400-14">}</span><span class="p">,</span><span class="w">     </span><span class="c1">%</span><span class="w">
 </span><span class="p" data-group-id="7215945400-16">[</span><span class="p" data-group-id="7215945400-17">{</span><span class="p" data-group-id="7215945400-18">{</span><span class="ss">file</span><span class="p">,</span><span class="ss">close</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="7215945400-18">}</span><span class="p">,</span><span class="w">                        </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">1398.873</span><span class="p">,</span><span class="w">    </span><span class="mf">0.019</span><span class="p" data-group-id="7215945400-17">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7215945400-19">{</span><span class="p" data-group-id="7215945400-20">{</span><span class="ss">foo</span><span class="p">,</span><span class="ss">create_file_slow</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="7215945400-20">}</span><span class="p">,</span><span class="w">              </span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="mf">249.678</span><span class="p">,</span><span class="w">    </span><span class="mf">0.029</span><span class="p" data-group-id="7215945400-19">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7215945400-21">{</span><span class="p" data-group-id="7215945400-22">{</span><span class="ss">file</span><span class="p">,</span><span class="ss">open</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="7215945400-22">}</span><span class="p">,</span><span class="w">                         </span><span class="mi">1</span><span class="p">,</span><span class="w">   </span><span class="mf">20.778</span><span class="p">,</span><span class="w">    </span><span class="mf">0.055</span><span class="p" data-group-id="7215945400-21">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7215945400-23">{</span><span class="p" data-group-id="7215945400-24">{</span><span class="ss">lists</span><span class="p">,</span><span class="ss">map</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="7215945400-24">}</span><span class="p">,</span><span class="w">                         </span><span class="mi">1</span><span class="p">,</span><span class="w">   </span><span class="mf">16.590</span><span class="p">,</span><span class="w">    </span><span class="mf">0.043</span><span class="p" data-group-id="7215945400-23">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7215945400-25">{</span><span class="p" data-group-id="7215945400-26">{</span><span class="ss">lists</span><span class="p">,</span><span class="ss">seq</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="7215945400-26">}</span><span class="p">,</span><span class="w">                         </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">4.708</span><span class="p">,</span><span class="w">    </span><span class="mf">0.017</span><span class="p" data-group-id="7215945400-25">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7215945400-27">{</span><span class="p" data-group-id="7215945400-28">{</span><span class="ss">file</span><span class="p">,</span><span class="ss">write</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="7215945400-28">}</span><span class="p">,</span><span class="w">                        </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.316</span><span class="p">,</span><span class="w">    </span><span class="mf">0.021</span><span class="p" data-group-id="7215945400-27">}</span><span class="p" data-group-id="7215945400-16">]</span><span class="p" data-group-id="7215945400-10">}</span><span class="p">.</span></code></pre><p>The printout consists of one paragraph per called function. The function
<em>marked</em> with <code class="inline">%</code> is the one the paragraph concerns — <code class="inline">foo:create_file_slow/2</code>.
Above the marked function are the <em>calling</em> functions — those that has called
the marked, and below are those <em>called</em> by the marked function.</p><p>The paragraphs are per default sorted in descending order of the <code class="inline">ACC</code> column for
the marked function. The calling list and called list within one paragraph are
also per default sorted in descending order of their <code class="inline">ACC</code> column.</p><p>The columns are:</p><ul><li><code class="inline">CNT</code> - the number of times the function has been called</li><li><code class="inline">ACC</code> - the time spent in the function including called functions</li><li><code class="inline">OWN</code> - the time spent in the function not including called functions</li></ul><p>The rows for the <em>calling</em> functions contain statistics for the <em>marked</em>
function with the constraint that only the occasions when a call was made from
the <em>row's</em> function to the <em>marked</em> function are accounted for.</p><p>The row for the <em>marked</em> function simply contains the sum of all <em>calling</em> rows.</p><p>The rows for the <em>called</em> functions contains statistics for the <em>row's</em> function
with the constraint that only the occasions when a call was made from the
<em>marked</em> to the <em>row's</em> function are accounted for.</p><p>So, we see that <code class="inline">foo:create_file_slow/2</code> used very little time for its own
execution. It spent most of its time in <a href="../../apps/kernel/file.html#close/1"><code class="inline">file:close/1</code></a>. The function
<code class="inline">foo:create_file_slow/3</code> that writes 3/4 of the file contents is the second
biggest time thief.</p><p>We also see that the call to <a href="../../apps/kernel/file.html#write/2"><code class="inline">file:write/2</code></a> that writes 1/4 of the file contents
takes very little time in itself. What takes time is to build the data
(<a href="../../apps/stdlib/lists.html#seq/2"><code class="inline">lists:seq/2</code></a> and <a href="../../apps/stdlib/lists.html#map/2"><code class="inline">lists:map/2</code></a>).</p><p>The function <code class="inline">undefined</code> that has called <code class="inline">fprof:apply_start_stop/4</code> is an
unknown function because that call was not recorded in the trace. It was only
recorded that the execution returned from <code class="inline">fprof:apply_start_stop/4</code> to some
other function above in the call stack, or that the process exited from there.</p><p>Let us continue down the printout to find:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="8858410037-1">{</span><span class="p" data-group-id="8858410037-2">[</span><span class="p" data-group-id="8858410037-3">{</span><span class="p" data-group-id="8858410037-4">{</span><span class="ss">foo</span><span class="p">,</span><span class="ss">create_file_slow</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="8858410037-4">}</span><span class="p">,</span><span class="w">              </span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="mf">249.678</span><span class="p">,</span><span class="w">    </span><span class="mf">0.029</span><span class="p" data-group-id="8858410037-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="8858410037-5">{</span><span class="p" data-group-id="8858410037-6">{</span><span class="ss">foo</span><span class="p">,</span><span class="ss">create_file_slow</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="8858410037-6">}</span><span class="p">,</span><span class="w">            </span><span class="mi">768</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p">,</span><span class="w">   </span><span class="mf">23.294</span><span class="p" data-group-id="8858410037-5">}</span><span class="p" data-group-id="8858410037-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="8858410037-7">{</span><span class="w"> </span><span class="p" data-group-id="8858410037-8">{</span><span class="ss">foo</span><span class="p">,</span><span class="ss">create_file_slow</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="8858410037-8">}</span><span class="p">,</span><span class="w">            </span><span class="mi">769</span><span class="p">,</span><span class="w">  </span><span class="mf">249.678</span><span class="p">,</span><span class="w">   </span><span class="mf">23.323</span><span class="p" data-group-id="8858410037-7">}</span><span class="p">,</span><span class="w">     </span><span class="c1">%</span><span class="w">
 </span><span class="p" data-group-id="8858410037-9">[</span><span class="p" data-group-id="8858410037-10">{</span><span class="p" data-group-id="8858410037-11">{</span><span class="ss">file</span><span class="p">,</span><span class="ss">write</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="8858410037-11">}</span><span class="p">,</span><span class="w">                      </span><span class="mi">768</span><span class="p">,</span><span class="w">  </span><span class="mf">220.314</span><span class="p">,</span><span class="w">   </span><span class="mf">14.539</span><span class="p" data-group-id="8858410037-10">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="8858410037-12">{</span><span class="ss">suspend</span><span class="p">,</span><span class="w">                              </span><span class="mi">57</span><span class="p">,</span><span class="w">    </span><span class="mf">6.041</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="8858410037-12">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="8858410037-13">{</span><span class="p" data-group-id="8858410037-14">{</span><span class="ss">foo</span><span class="p">,</span><span class="ss">create_file_slow</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="8858410037-14">}</span><span class="p">,</span><span class="w">            </span><span class="mi">768</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p">,</span><span class="w">   </span><span class="mf">23.294</span><span class="p" data-group-id="8858410037-13">}</span><span class="p" data-group-id="8858410037-9">]</span><span class="p" data-group-id="8858410037-1">}</span><span class="p">.</span></code></pre><p>If you compare with the code you will see there also that
<code class="inline">foo:create_file_slow/3</code> was called only from <code class="inline">foo:create_file_slow/2</code> and
itself, and called only <a href="../../apps/kernel/file.html#write/2"><code class="inline">file:write/2</code></a>, note the number of calls to
<a href="../../apps/kernel/file.html#write/2"><code class="inline">file:write/2</code></a>. But here we see that <code class="inline">suspend</code> was called a few times. This is a
pseudo function that indicates that the process was suspended while executing in
<code class="inline">foo:create_file_slow/3</code>, and since there is no <code class="inline">receive</code> or <a href="../../apps/erts/erlang.html#yield/0"><code class="inline">erlang:yield/0</code></a> in
the code, it must be Erlang scheduling suspensions, or the trace file driver
compensating for large file write operations (these are regarded as a schedule
out followed by a schedule in to the same process).</p><p>Let us find the <code class="inline">suspend</code> entry:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="3837101590-1">{</span><span class="p" data-group-id="3837101590-2">[</span><span class="p" data-group-id="3837101590-3">{</span><span class="p" data-group-id="3837101590-4">{</span><span class="ss">file</span><span class="p">,</span><span class="ss">write</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="3837101590-4">}</span><span class="p">,</span><span class="w">                       </span><span class="mi">53</span><span class="p">,</span><span class="w">    </span><span class="mf">6.281</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3837101590-5">{</span><span class="p" data-group-id="3837101590-6">{</span><span class="ss">foo</span><span class="p">,</span><span class="ss">create_file_slow</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="3837101590-6">}</span><span class="p">,</span><span class="w">             </span><span class="mi">57</span><span class="p">,</span><span class="w">    </span><span class="mf">6.041</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-5">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3837101590-7">{</span><span class="p" data-group-id="3837101590-8">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">drv_command</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="3837101590-8">}</span><span class="p">,</span><span class="w">            </span><span class="mi">50</span><span class="p">,</span><span class="w">    </span><span class="mf">4.582</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-7">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3837101590-9">{</span><span class="p" data-group-id="3837101590-10">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">drv_get_response</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="3837101590-10">}</span><span class="p">,</span><span class="w">       </span><span class="mi">34</span><span class="p">,</span><span class="w">    </span><span class="mf">2.986</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-9">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3837101590-11">{</span><span class="p" data-group-id="3837101590-12">{</span><span class="ss">lists</span><span class="p">,</span><span class="ss">map</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="3837101590-12">}</span><span class="p">,</span><span class="w">                        </span><span class="mi">10</span><span class="p">,</span><span class="w">    </span><span class="mf">2.104</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-11">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3837101590-13">{</span><span class="p" data-group-id="3837101590-14">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">write</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="3837101590-14">}</span><span class="p">,</span><span class="w">                  </span><span class="mi">17</span><span class="p">,</span><span class="w">    </span><span class="mf">1.852</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-13">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3837101590-15">{</span><span class="p" data-group-id="3837101590-16">{</span><span class="ss">erlang</span><span class="p">,</span><span class="nb">port_command</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="3837101590-16">}</span><span class="p">,</span><span class="w">              </span><span class="mi">15</span><span class="p">,</span><span class="w">    </span><span class="mf">1.713</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-15">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3837101590-17">{</span><span class="p" data-group-id="3837101590-18">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">drv_command</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="3837101590-18">}</span><span class="p">,</span><span class="w">            </span><span class="mi">22</span><span class="p">,</span><span class="w">    </span><span class="mf">1.482</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-17">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3837101590-19">{</span><span class="p" data-group-id="3837101590-20">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">translate_response</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="3837101590-20">}</span><span class="p">,</span><span class="w">     </span><span class="mi">11</span><span class="p">,</span><span class="w">    </span><span class="mf">1.441</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-19">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3837101590-21">{</span><span class="p" data-group-id="3837101590-22">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">&#39;-drv_command/2-fun-0-&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="3837101590-22">}</span><span class="p">,</span><span class="w">  </span><span class="mi">15</span><span class="p">,</span><span class="w">    </span><span class="mf">1.340</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-21">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3837101590-23">{</span><span class="p" data-group-id="3837101590-24">{</span><span class="ss">lists</span><span class="p">,</span><span class="ss">seq</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="3837101590-24">}</span><span class="p">,</span><span class="w">                         </span><span class="mi">3</span><span class="p">,</span><span class="w">    </span><span class="mf">0.880</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-23">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3837101590-25">{</span><span class="p" data-group-id="3837101590-26">{</span><span class="ss">foo</span><span class="p">,</span><span class="ss">&#39;-create_file_slow/2-fun-0-&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="3837101590-26">}</span><span class="p">,</span><span class="w">   </span><span class="mi">5</span><span class="p">,</span><span class="w">    </span><span class="mf">0.523</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-25">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3837101590-27">{</span><span class="p" data-group-id="3837101590-28">{</span><span class="ss">erlang</span><span class="p">,</span><span class="nb">bump_reductions</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="3837101590-28">}</span><span class="p">,</span><span class="w">            </span><span class="mi">4</span><span class="p">,</span><span class="w">    </span><span class="mf">0.503</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-27">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3837101590-29">{</span><span class="p" data-group-id="3837101590-30">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">open_int_setopts</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="3837101590-30">}</span><span class="p">,</span><span class="w">        </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.165</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-29">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3837101590-31">{</span><span class="p" data-group-id="3837101590-32">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">i32</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="3837101590-32">}</span><span class="p">,</span><span class="w">                     </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.109</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-31">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3837101590-33">{</span><span class="p" data-group-id="3837101590-34">{</span><span class="ss">fprof</span><span class="p">,</span><span class="ss">apply_start_stop</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="3837101590-34">}</span><span class="p">,</span><span class="w">            </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-33">}</span><span class="p" data-group-id="3837101590-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="3837101590-35">{</span><span class="w"> </span><span class="ss">suspend</span><span class="p">,</span><span class="w">                             </span><span class="mi">299</span><span class="p">,</span><span class="w">   </span><span class="mf">32.002</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="3837101590-35">}</span><span class="p">,</span><span class="w">     </span><span class="c1">%</span><span class="w">
 </span><span class="p" data-group-id="3837101590-36">[</span><span class="w"> </span><span class="p" data-group-id="3837101590-36">]</span><span class="p" data-group-id="3837101590-1">}</span><span class="p">.</span></code></pre><p>We find no particularly long suspend times, so no function seems to have waited
in a receive statement. Actually, <code class="inline">prim_file:drv_command/4</code> contains a receive
statement, but in this test program, the message lies in the process receive
buffer when the receive statement is entered. We also see that the total suspend
time for the test run is small.</p><p>The <code class="inline">suspend</code> pseudo function has an <code class="inline">OWN</code> time of zero. This is to prevent
the process total <code class="inline">OWN</code> time from including time in suspension. Whether suspend
time is really <code class="inline">ACC</code> or <code class="inline">OWN</code> time is more of a philosophical question.</p><p>Now we look at another interesting pseudo function, <code class="inline">garbage_collect</code>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="0558558246-1">{</span><span class="p" data-group-id="0558558246-2">[</span><span class="p" data-group-id="0558558246-3">{</span><span class="p" data-group-id="0558558246-4">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">drv_command</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="0558558246-4">}</span><span class="p">,</span><span class="w">            </span><span class="mi">25</span><span class="p">,</span><span class="w">    </span><span class="mf">0.873</span><span class="p">,</span><span class="w">    </span><span class="mf">0.873</span><span class="p" data-group-id="0558558246-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="0558558246-5">{</span><span class="p" data-group-id="0558558246-6">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">write</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="0558558246-6">}</span><span class="p">,</span><span class="w">                  </span><span class="mi">16</span><span class="p">,</span><span class="w">    </span><span class="mf">0.692</span><span class="p">,</span><span class="w">    </span><span class="mf">0.692</span><span class="p" data-group-id="0558558246-5">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="0558558246-7">{</span><span class="p" data-group-id="0558558246-8">{</span><span class="ss">lists</span><span class="p">,</span><span class="ss">map</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="0558558246-8">}</span><span class="p">,</span><span class="w">                         </span><span class="mi">2</span><span class="p">,</span><span class="w">    </span><span class="mf">0.195</span><span class="p">,</span><span class="w">    </span><span class="mf">0.195</span><span class="p" data-group-id="0558558246-7">}</span><span class="p" data-group-id="0558558246-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="0558558246-9">{</span><span class="w"> </span><span class="nb">garbage_collect</span><span class="p">,</span><span class="w">                      </span><span class="mi">43</span><span class="p">,</span><span class="w">    </span><span class="mf">1.760</span><span class="p">,</span><span class="w">    </span><span class="mf">1.760</span><span class="p" data-group-id="0558558246-9">}</span><span class="p">,</span><span class="w">     </span><span class="c1">%</span><span class="w">
 </span><span class="p" data-group-id="0558558246-10">[</span><span class="w"> </span><span class="p" data-group-id="0558558246-10">]</span><span class="p" data-group-id="0558558246-1">}</span><span class="p">.</span></code></pre><p>Here we see that no function stands out, which is very normal.</p><p>The <code class="inline">garbage_collect</code> pseudo function has not an <code class="inline">OWN</code> time of zero like
<code class="inline">suspend</code>, instead it is equal to the <code class="inline">ACC</code> time.</p><p>Garbage collection often occurs while a process is suspended, but <code class="inline">fprof</code> hides
this fact by pretending that the suspended function was first unsuspended and
then garbage collected. Otherwise the printout would show <code class="inline">garbage_collect</code>
being called from <code class="inline">suspend</code>, but not which function that might have caused the
garbage collection.</p><p>Let us now get back to the test code:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="8088445391-1">{</span><span class="p" data-group-id="8088445391-2">[</span><span class="p" data-group-id="8088445391-3">{</span><span class="p" data-group-id="8088445391-4">{</span><span class="ss">foo</span><span class="p">,</span><span class="ss">create_file_slow</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="8088445391-4">}</span><span class="p">,</span><span class="w">            </span><span class="mi">768</span><span class="p">,</span><span class="w">  </span><span class="mf">220.314</span><span class="p">,</span><span class="w">   </span><span class="mf">14.539</span><span class="p" data-group-id="8088445391-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="8088445391-5">{</span><span class="p" data-group-id="8088445391-6">{</span><span class="ss">foo</span><span class="p">,</span><span class="ss">create_file_slow</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="8088445391-6">}</span><span class="p">,</span><span class="w">              </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.316</span><span class="p">,</span><span class="w">    </span><span class="mf">0.021</span><span class="p" data-group-id="8088445391-5">}</span><span class="p" data-group-id="8088445391-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="8088445391-7">{</span><span class="w"> </span><span class="p" data-group-id="8088445391-8">{</span><span class="ss">file</span><span class="p">,</span><span class="ss">write</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="8088445391-8">}</span><span class="p">,</span><span class="w">                      </span><span class="mi">769</span><span class="p">,</span><span class="w">  </span><span class="mf">220.630</span><span class="p">,</span><span class="w">   </span><span class="mf">14.560</span><span class="p" data-group-id="8088445391-7">}</span><span class="p">,</span><span class="w">     </span><span class="c1">%</span><span class="w">
 </span><span class="p" data-group-id="8088445391-9">[</span><span class="p" data-group-id="8088445391-10">{</span><span class="p" data-group-id="8088445391-11">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">write</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="8088445391-11">}</span><span class="p">,</span><span class="w">                 </span><span class="mi">769</span><span class="p">,</span><span class="w">  </span><span class="mf">199.789</span><span class="p">,</span><span class="w">   </span><span class="mf">22.573</span><span class="p" data-group-id="8088445391-10">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="8088445391-12">{</span><span class="ss">suspend</span><span class="p">,</span><span class="w">                              </span><span class="mi">53</span><span class="p">,</span><span class="w">    </span><span class="mf">6.281</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="8088445391-12">}</span><span class="p" data-group-id="8088445391-9">]</span><span class="p" data-group-id="8088445391-1">}</span><span class="p">.</span></code></pre><p>Not unexpectedly, we see that <a href="../../apps/kernel/file.html#write/2"><code class="inline">file:write/2</code></a> was called from
<code class="inline">foo:create_file_slow/3</code> and <code class="inline">foo:create_file_slow/2</code>. The number of calls in
each case as well as the used time are also confirms the previous results.</p><p>We see that <a href="../../apps/kernel/file.html#write/2"><code class="inline">file:write/2</code></a> only calls <code class="inline">prim_file:write/2</code>, but let us refrain
from digging into the internals of the kernel application.</p><p>If we nevertheless <em>do</em> dig down we find the call to the linked-in driver
that does the file operations towards the host operating system:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="9854227325-1">{</span><span class="p" data-group-id="9854227325-2">[</span><span class="p" data-group-id="9854227325-3">{</span><span class="p" data-group-id="9854227325-4">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">drv_command</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="9854227325-4">}</span><span class="p">,</span><span class="w">           </span><span class="mi">772</span><span class="p">,</span><span class="w"> </span><span class="mf">1458.356</span><span class="p">,</span><span class="w"> </span><span class="mf">1456.643</span><span class="p" data-group-id="9854227325-3">}</span><span class="p" data-group-id="9854227325-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="9854227325-5">{</span><span class="w"> </span><span class="p" data-group-id="9854227325-6">{</span><span class="ss">erlang</span><span class="p">,</span><span class="nb">port_command</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="9854227325-6">}</span><span class="p">,</span><span class="w">             </span><span class="mi">772</span><span class="p">,</span><span class="w"> </span><span class="mf">1458.356</span><span class="p">,</span><span class="w"> </span><span class="mf">1456.643</span><span class="p" data-group-id="9854227325-5">}</span><span class="p">,</span><span class="w">     </span><span class="c1">%</span><span class="w">
 </span><span class="p" data-group-id="9854227325-7">[</span><span class="p" data-group-id="9854227325-8">{</span><span class="ss">suspend</span><span class="p">,</span><span class="w">                              </span><span class="mi">15</span><span class="p">,</span><span class="w">    </span><span class="mf">1.713</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="9854227325-8">}</span><span class="p" data-group-id="9854227325-7">]</span><span class="p" data-group-id="9854227325-1">}</span><span class="p">.</span></code></pre><p>This is 86 % of the total run time, and as we saw before it is the close
operation the absolutely biggest contributor. We find a comparison ratio a
little bit up in the call stack:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="0556185833-1">{</span><span class="p" data-group-id="0556185833-2">[</span><span class="p" data-group-id="0556185833-3">{</span><span class="p" data-group-id="0556185833-4">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">close</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="0556185833-4">}</span><span class="p">,</span><span class="w">                   </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">1398.748</span><span class="p">,</span><span class="w">    </span><span class="mf">0.024</span><span class="p" data-group-id="0556185833-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="0556185833-5">{</span><span class="p" data-group-id="0556185833-6">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">write</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="0556185833-6">}</span><span class="p">,</span><span class="w">                 </span><span class="mi">769</span><span class="p">,</span><span class="w">  </span><span class="mf">174.672</span><span class="p">,</span><span class="w">   </span><span class="mf">12.810</span><span class="p" data-group-id="0556185833-5">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="0556185833-7">{</span><span class="p" data-group-id="0556185833-8">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">open_int</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="0556185833-8">}</span><span class="p">,</span><span class="w">                </span><span class="mi">1</span><span class="p">,</span><span class="w">   </span><span class="mf">19.755</span><span class="p">,</span><span class="w">    </span><span class="mf">0.017</span><span class="p" data-group-id="0556185833-7">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="0556185833-9">{</span><span class="p" data-group-id="0556185833-10">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">open_int_setopts</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="0556185833-10">}</span><span class="p">,</span><span class="w">        </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.147</span><span class="p">,</span><span class="w">    </span><span class="mf">0.016</span><span class="p" data-group-id="0556185833-9">}</span><span class="p" data-group-id="0556185833-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="0556185833-11">{</span><span class="w"> </span><span class="p" data-group-id="0556185833-12">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">drv_command</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="0556185833-12">}</span><span class="p">,</span><span class="w">           </span><span class="mi">772</span><span class="p">,</span><span class="w"> </span><span class="mf">1593.322</span><span class="p">,</span><span class="w">   </span><span class="mf">12.867</span><span class="p" data-group-id="0556185833-11">}</span><span class="p">,</span><span class="w">     </span><span class="c1">%</span><span class="w">
 </span><span class="p" data-group-id="0556185833-13">[</span><span class="p" data-group-id="0556185833-14">{</span><span class="p" data-group-id="0556185833-15">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">drv_command</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="0556185833-15">}</span><span class="p">,</span><span class="w">           </span><span class="mi">772</span><span class="p">,</span><span class="w"> </span><span class="mf">1578.973</span><span class="p">,</span><span class="w">   </span><span class="mf">27.265</span><span class="p" data-group-id="0556185833-14">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="0556185833-16">{</span><span class="ss">suspend</span><span class="p">,</span><span class="w">                              </span><span class="mi">22</span><span class="p">,</span><span class="w">    </span><span class="mf">1.482</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="0556185833-16">}</span><span class="p" data-group-id="0556185833-13">]</span><span class="p" data-group-id="0556185833-1">}</span><span class="p">.</span></code></pre><p>The time for file operations in the linked in driver distributes itself as 1 %
for open, 11 % for write, and 87 % for close. All data is probably buffered in
the operating system until the close.</p><p>The observant reader may notice that the ACC times for
<code class="inline">prim_file:drv_command/2</code> and <code class="inline">prim_file:drv_command/4</code> is not equal between the
paragraphs above, even though it is easy to believe that
<code class="inline">prim_file:drv_command/2</code> is just a passthrough function.</p><p>The missing time can be found in the paragraph for <code class="inline">prim_file:drv_command/4</code>
where it is evident that not only <code class="inline">prim_file:drv_command/2</code> is called but also a
fun:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="2146521716-1">{</span><span class="p" data-group-id="2146521716-2">[</span><span class="p" data-group-id="2146521716-3">{</span><span class="p" data-group-id="2146521716-4">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">drv_command</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="2146521716-4">}</span><span class="p">,</span><span class="w">           </span><span class="mi">772</span><span class="p">,</span><span class="w"> </span><span class="mf">1578.973</span><span class="p">,</span><span class="w">   </span><span class="mf">27.265</span><span class="p" data-group-id="2146521716-3">}</span><span class="p" data-group-id="2146521716-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="2146521716-5">{</span><span class="w"> </span><span class="p" data-group-id="2146521716-6">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">drv_command</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="2146521716-6">}</span><span class="p">,</span><span class="w">           </span><span class="mi">772</span><span class="p">,</span><span class="w"> </span><span class="mf">1578.973</span><span class="p">,</span><span class="w">   </span><span class="mf">27.265</span><span class="p" data-group-id="2146521716-5">}</span><span class="p">,</span><span class="w">     </span><span class="c1">%</span><span class="w">
 </span><span class="p" data-group-id="2146521716-7">[</span><span class="p" data-group-id="2146521716-8">{</span><span class="p" data-group-id="2146521716-9">{</span><span class="ss">erlang</span><span class="p">,</span><span class="nb">port_command</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="2146521716-9">}</span><span class="p">,</span><span class="w">             </span><span class="mi">772</span><span class="p">,</span><span class="w"> </span><span class="mf">1458.356</span><span class="p">,</span><span class="w"> </span><span class="mf">1456.643</span><span class="p" data-group-id="2146521716-8">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="2146521716-10">{</span><span class="p" data-group-id="2146521716-11">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">&#39;-drv_command/2-fun-0-&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="2146521716-11">}</span><span class="p">,</span><span class="w"> </span><span class="mi">772</span><span class="p">,</span><span class="w">   </span><span class="mf">87.897</span><span class="p">,</span><span class="w">   </span><span class="mf">12.736</span><span class="p" data-group-id="2146521716-10">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="2146521716-12">{</span><span class="ss">suspend</span><span class="p">,</span><span class="w">                              </span><span class="mi">50</span><span class="p">,</span><span class="w">    </span><span class="mf">4.582</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="2146521716-12">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="2146521716-13">{</span><span class="nb">garbage_collect</span><span class="p">,</span><span class="w">                      </span><span class="mi">25</span><span class="p">,</span><span class="w">    </span><span class="mf">0.873</span><span class="p">,</span><span class="w">    </span><span class="mf">0.873</span><span class="p" data-group-id="2146521716-13">}</span><span class="p" data-group-id="2146521716-7">]</span><span class="p" data-group-id="2146521716-1">}</span><span class="p">.</span></code></pre><p>And some more missing time can be explained by the fact that
<code class="inline">prim_file:open_int/4</code> both calls <code class="inline">prim_file:drv_command/2</code> directly as well as
through <code class="inline">prim_file:open_int_setopts/3</code>, which complicates the picture.</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="7222222107-1">{</span><span class="p" data-group-id="7222222107-2">[</span><span class="p" data-group-id="7222222107-3">{</span><span class="p" data-group-id="7222222107-4">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">open</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="7222222107-4">}</span><span class="p">,</span><span class="w">                    </span><span class="mi">1</span><span class="p">,</span><span class="w">   </span><span class="mf">20.309</span><span class="p">,</span><span class="w">    </span><span class="mf">0.029</span><span class="p" data-group-id="7222222107-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7222222107-5">{</span><span class="p" data-group-id="7222222107-6">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">open_int</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="7222222107-6">}</span><span class="p">,</span><span class="w">                </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p">,</span><span class="w">    </span><span class="mf">0.057</span><span class="p" data-group-id="7222222107-5">}</span><span class="p" data-group-id="7222222107-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="7222222107-7">{</span><span class="w"> </span><span class="p" data-group-id="7222222107-8">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">open_int</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="7222222107-8">}</span><span class="p">,</span><span class="w">                </span><span class="mi">2</span><span class="p">,</span><span class="w">   </span><span class="mf">20.309</span><span class="p">,</span><span class="w">    </span><span class="mf">0.086</span><span class="p" data-group-id="7222222107-7">}</span><span class="p">,</span><span class="w">     </span><span class="c1">%</span><span class="w">
 </span><span class="p" data-group-id="7222222107-9">[</span><span class="p" data-group-id="7222222107-10">{</span><span class="p" data-group-id="7222222107-11">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">drv_command</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="7222222107-11">}</span><span class="p">,</span><span class="w">             </span><span class="mi">1</span><span class="p">,</span><span class="w">   </span><span class="mf">19.755</span><span class="p">,</span><span class="w">    </span><span class="mf">0.017</span><span class="p" data-group-id="7222222107-10">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7222222107-12">{</span><span class="p" data-group-id="7222222107-13">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">open_int_setopts</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="7222222107-13">}</span><span class="p">,</span><span class="w">        </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.360</span><span class="p">,</span><span class="w">    </span><span class="mf">0.032</span><span class="p" data-group-id="7222222107-12">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7222222107-14">{</span><span class="p" data-group-id="7222222107-15">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">drv_open</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="7222222107-15">}</span><span class="p">,</span><span class="w">                </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.071</span><span class="p">,</span><span class="w">    </span><span class="mf">0.030</span><span class="p" data-group-id="7222222107-14">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7222222107-16">{</span><span class="p" data-group-id="7222222107-17">{</span><span class="ss">erlang</span><span class="p">,</span><span class="nb">list_to_binary</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="7222222107-17">}</span><span class="p">,</span><span class="w">             </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.020</span><span class="p">,</span><span class="w">    </span><span class="mf">0.020</span><span class="p" data-group-id="7222222107-16">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7222222107-18">{</span><span class="p" data-group-id="7222222107-19">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">i32</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="7222222107-19">}</span><span class="p">,</span><span class="w">                     </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.017</span><span class="p">,</span><span class="w">    </span><span class="mf">0.017</span><span class="p" data-group-id="7222222107-18">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7222222107-20">{</span><span class="p" data-group-id="7222222107-21">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">open_int</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="7222222107-21">}</span><span class="p">,</span><span class="w">                </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p">,</span><span class="w">    </span><span class="mf">0.057</span><span class="p" data-group-id="7222222107-20">}</span><span class="p" data-group-id="7222222107-9">]</span><span class="p" data-group-id="7222222107-1">}</span><span class="p">.</span><span class="w">
</span><span class="p">.</span><span class="w">
</span><span class="p">.</span><span class="w">
</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="7222222107-22">{</span><span class="p" data-group-id="7222222107-23">[</span><span class="p" data-group-id="7222222107-24">{</span><span class="p" data-group-id="7222222107-25">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">open_int</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="7222222107-25">}</span><span class="p">,</span><span class="w">                </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.360</span><span class="p">,</span><span class="w">    </span><span class="mf">0.032</span><span class="p" data-group-id="7222222107-24">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7222222107-26">{</span><span class="p" data-group-id="7222222107-27">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">open_int_setopts</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="7222222107-27">}</span><span class="p">,</span><span class="w">        </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p">,</span><span class="w">    </span><span class="mf">0.016</span><span class="p" data-group-id="7222222107-26">}</span><span class="p" data-group-id="7222222107-23">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="7222222107-28">{</span><span class="w"> </span><span class="p" data-group-id="7222222107-29">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">open_int_setopts</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="7222222107-29">}</span><span class="p">,</span><span class="w">        </span><span class="mi">2</span><span class="p">,</span><span class="w">    </span><span class="mf">0.360</span><span class="p">,</span><span class="w">    </span><span class="mf">0.048</span><span class="p" data-group-id="7222222107-28">}</span><span class="p">,</span><span class="w">     </span><span class="c1">%</span><span class="w">
 </span><span class="p" data-group-id="7222222107-30">[</span><span class="p" data-group-id="7222222107-31">{</span><span class="ss">suspend</span><span class="p">,</span><span class="w">                               </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.165</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p" data-group-id="7222222107-31">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7222222107-32">{</span><span class="p" data-group-id="7222222107-33">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">drv_command</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="7222222107-33">}</span><span class="p">,</span><span class="w">             </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.147</span><span class="p">,</span><span class="w">    </span><span class="mf">0.016</span><span class="p" data-group-id="7222222107-32">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7222222107-34">{</span><span class="p" data-group-id="7222222107-35">{</span><span class="ss">prim_file</span><span class="p">,</span><span class="ss">open_int_setopts</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="7222222107-35">}</span><span class="p">,</span><span class="w">        </span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="mf">0.000</span><span class="p">,</span><span class="w">    </span><span class="mf">0.016</span><span class="p" data-group-id="7222222107-34">}</span><span class="p" data-group-id="7222222107-30">]</span><span class="p" data-group-id="7222222107-22">}</span><span class="p">.</span></code></pre><h2 id="module-notes" class="section-heading"><a href="#module-notes" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Notes</span></h2><p>The actual supervision of execution times is in itself a CPU-intensive activity.
A message is written on the trace file for every function call that is made by
the profiled code.</p><p>The <code class="inline">ACC</code> time calculation is sometimes difficult to make correct, since it is
difficult to define. This happens especially when a function occurs in several
instances in the call stack, for example by calling itself perhaps through other
functions and perhaps even non-tail recursively.</p><p>To produce sensible results, <code class="inline">fprof</code> tries not to charge any function more than
once for <code class="inline">ACC</code> time. The instance highest up (with longest duration) in the call
stack is chosen.</p><p>Sometimes a function can unexpectedly waste a lot (some 10 ms or more depending
on host machine OS) of <code class="inline">OWN</code> (and <code class="inline">ACC</code>) time, even functions that do practically
nothing at all. The problem may be that the OS has chosen to schedule out the
Erlang runtime system process for a while, and if the OS does not support high
resolution CPU time measurements <code class="inline">fprof</code> will use wallclock time for its
calculations, and it will appear as if functions are randomly burning virtual
machine time.</p><h2 id="module-see-also" class="section-heading"><a href="#module-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See Also</span></h2><p><a href="fprof_chapter.html">fprof - The File Trace Profiler</a>, <a href="../../apps/runtime_tools/dbg.html"><code class="inline">dbg</code></a>, <a href="eprof.html"><code class="inline">eprof</code></a></p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:analyse_option/0" data-no-tooltip="" translate="no">analyse_option()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:apply_option/0" data-no-tooltip="" translate="no">apply_option()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:pid_spec/0" data-no-tooltip="" translate="no">pid_spec()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:profile_option/0" data-no-tooltip="" translate="no">profile_option()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:trace_option/0" data-no-tooltip="" translate="no">trace_option()</a>

      </div>

    </div>

</div>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#analyse/0" data-no-tooltip="" translate="no">analyse()</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">analyse([])</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#analyse/1" data-no-tooltip="" translate="no">analyse(Arg)</a>

      </div>

        <div class="summary-synopsis"><p>Analyses raw profile data in the <code class="inline">fprof</code> server.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#analyse/2" data-no-tooltip="" translate="no">analyse(OptionName, OptionValue)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">analyse([{OptionName, OptionValue}])</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#apply/2" data-no-tooltip="" translate="no">apply(Func, Args)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">apply(Func, Args, [])</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#apply/3" data-no-tooltip="" translate="no">apply(Arg1, Arg2, Arg3)</a>

      </div>

        <div class="summary-synopsis"><p>Calls the given function surrounded by
<a><code class="inline">trace([start, ...])</code></a> and
<a><code class="inline">trace(stop)</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#apply/4" data-no-tooltip="" translate="no">apply(Module, Function, Args, OptionList)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">apply({Module, Function}, Args, OptionList)</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#profile/0" data-no-tooltip="" translate="no">profile()</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">profile([])</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#profile/1" data-no-tooltip="" translate="no">profile(Arg)</a>

      </div>

        <div class="summary-synopsis"><p>Compiles a trace into raw profile data held by the <code class="inline">fprof</code> server.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#profile/2" data-no-tooltip="" translate="no">profile(OptionName, OptionValue)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">profile([{OptionName, OptionValue}])</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#start/0" data-no-tooltip="" translate="no">start()</a>

      </div>

        <div class="summary-synopsis"><p>Starts the <code class="inline">fprof</code> server.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#stop/0" data-no-tooltip="" translate="no">stop()</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a><code class="inline">stop(normal)</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#stop/1" data-no-tooltip="" translate="no">stop(Reason)</a>

      </div>

        <div class="summary-synopsis"><p>Stops the <code class="inline">fprof</code> server.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#trace/1" data-no-tooltip="" translate="no">trace(Arg)</a>

      </div>

        <div class="summary-synopsis"><p>Starts or stops tracing.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#trace/2" data-no-tooltip="" translate="no">trace(What, Value)</a>

      </div>

        <div class="summary-synopsis"><p>Starts or stop tracing.</p></div>

    </div>

</div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Types</span>
    </h1>
    <div class="types-list">
<section class="detail" id="t:analyse_option/0">

  <div class="detail-header">
    <a href="#t:analyse_option/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">analyse_option()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L1141" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> analyse_option() ::
          append | callers |
          {callers, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()} |
          {cols, Cols :: <a href="../../apps/erts/erlang.html#t:non_neg_integer/0">non_neg_integer</a>()} |
          dest |
          {dest, Dest :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>() | (Destfile :: <a href="../../apps/kernel/file.html#t:filename/0">file:filename</a>())} |
          details |
          {details, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()} |
          no_callers | no_details |
          {sort, SortSpec :: acc | own} |
          totals |
          {totals, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()}.</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:apply_option/0">

  <div class="detail-header">
    <a href="#t:apply_option/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">apply_option()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L513" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> apply_option() ::
          continue | {procs, PidList :: [<a href="../../apps/erts/erlang.html#t:pid/0">pid</a>()]} | start | (TraceStartOption :: <a href="#t:trace_option/0">trace_option</a>()).</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:pid_spec/0">

  <div class="detail-header">
    <a href="#t:pid_spec/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">pid_spec()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L500" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> pid_spec() :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>() | <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>().</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:profile_option/0">

  <div class="detail-header">
    <a href="#t:profile_option/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">profile_option()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L961" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> profile_option() ::
          append | dump |
          {dump, <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>() | (Dump :: (Dumpfile :: <a href="../../apps/kernel/file.html#t:filename/0">file:filename</a>() | []))} |
          file |
          {file, Filename :: <a href="../../apps/kernel/file.html#t:filename/0">file:filename</a>()} |
          start | stop.</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:trace_option/0">

  <div class="detail-header">
    <a href="#t:trace_option/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">trace_option()</h1>

        <span class="note">(not exported)</span>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L501" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> trace_option() ::
          cpu_time |
          {cpu_time, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()} |
          file |
          {file, Filename :: <a href="../../apps/kernel/file.html#t:filename/0">file:filename</a>()} |
          {procs, PidSpec :: <a href="#t:pid_spec/0">pid_spec</a>()} |
          {procs, [PidSpec :: <a href="#t:pid_spec/0">pid_spec</a>()]} |
          start | stop |
          {tracer, Tracer :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>() | <a href="../../apps/erts/erlang.html#t:port/0">port</a>()} |
          verbose |
          {verbose, <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()}.</pre>

      </div>


  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="analyse/0">

  <div class="detail-header">
    <a href="#analyse/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">analyse()</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L1124" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> analyse() -> ok | {error, Reason} | {'EXIT', ServerPid, Reason}
                 when ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(), Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>

<p>Equivalent to <a href="#analyse/1"><code class="inline">analyse([])</code></a>.</p>
  </section>
</section>
<section class="detail" id="analyse/1">

  <div class="detail-header">
    <a href="#analyse/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">analyse(Arg)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L1230" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> analyse(OptionName) -> ok | {error, Reason} | {'EXIT', ServerPid, Reason}
                 when OptionName :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>(), ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(), Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>();
             ({OptionName, OptionValue}) -> ok | {error, Reason} | {'EXIT', ServerPid, Reason}
                 when OptionName :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>(), OptionValue :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(), Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>();
             (OptionList) -> ok | {error, Reason} | {'EXIT', ServerPid, Reason}
                 when
                     OptionList :: [Option],
                     Option :: <a href="#t:analyse_option/0">analyse_option</a>(),
                     ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(),
                     Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>

<p>Analyses raw profile data in the <code class="inline">fprof</code> server.</p><p>If <code class="inline">Arg</code> is an atom, this call is equivalent to <code class="inline">analyse([Arg])</code>.</p><p>If <code class="inline">Arg</code> is a a tuple <code class="inline">{Option, _}</code>, this call is equivalent to
<code class="inline">analyse([Option])</code>.</p><p>Otherwise <code class="inline">Arg</code> must be a list of valid options.</p><p>If called when no raw profile data is available, <code class="inline">{error, no_profile}</code>
is returned.</p><p><code class="inline">Destfile</code> is used to call <a href="../../apps/kernel/file.html#open/2"><code class="inline">file:open/2</code></a>.</p><p>Option description:</p><ul><li><p><strong><code class="inline">dest</code> | <code class="inline">{dest, Dest}</code></strong> - Specifies the destination for the analysis. If
this option is not given or it is <code class="inline">dest</code>, the destination will be the caller's
group leader, otherwise the destination <code class="inline">Dest</code> is either the <a href="../../apps/erts/erlang.html#t:pid/0"><code class="inline">pid/0</code></a> of an
I/O device or a filename. If the filename is <code class="inline">[]</code>, <code class="inline">&quot;fprof.analysis&quot;</code> is used
instead.</p></li><li><p><strong><code class="inline">append</code></strong> - Causes the analysis to be appended to the destination file.
This option is only allowed with the <code class="inline">{dest, Destfile}</code> option.</p></li><li><p><strong><code class="inline">{cols, Cols}</code></strong> - Specifies the number of columns in the analysis text. If
this option is not given the number of columns is set to 80.</p></li><li><p><strong><code class="inline">callers</code> | <code class="inline">{callers, true}</code></strong> - Prints callers and called information in
the analysis. This is the default.</p></li><li><p><strong><code class="inline">{callers, false}</code> | <code class="inline">no_callers</code></strong> - Suppresses the printing of callers and
called information in the analysis.</p></li><li><p><strong><code class="inline">{sort, SortSpec}</code></strong> - Specifies if the analysis should be sorted according
to the ACC column, which is the default, or the OWN column. See
<a href="fprof.html#analysis">Analysis Format</a> below.</p></li><li><p><strong><code class="inline">totals</code> | <code class="inline">{totals, true}</code></strong> - Includes a section containing call
statistics for all calls regardless of process, in the analysis.</p></li><li><p><strong><code class="inline">{totals, false}</code></strong> - Suppresses the totals section in the analysis, which
is the default.</p></li><li><p><strong><code class="inline">details</code> | <code class="inline">{details, true}</code></strong> - Prints call statistics for each process in
the analysis. This is the default.</p></li><li><p><strong><code class="inline">{details, false}</code> | <code class="inline">no_details</code></strong> - Suppresses the call statistics for
each process from the analysis.</p></li></ul>
  </section>
</section>
<section class="detail" id="analyse/2">

  <div class="detail-header">
    <a href="#analyse/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">analyse(OptionName, OptionValue)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L1136" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> analyse(OptionName, OptionValue) -> ok | {error, Reason} | {'EXIT', ServerPid, Reason}
                 when OptionName :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>(), OptionValue :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(), Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>

<p>Equivalent to <a href="#analyse/1"><code class="inline">analyse([{OptionName, OptionValue}])</code></a>.</p>
  </section>
</section>
<section class="detail" id="apply/2">

  <div class="detail-header">
    <a href="#apply/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">apply(Func, Args)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L491" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> apply(Func, Args) -> <a href="../../apps/erts/erlang.html#t:term/0">term</a>()
               when Func :: fun() | {Module :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Function :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>()}, Args :: [<a href="../../apps/erts/erlang.html#t:term/0">term</a>()].</pre>

      </div>

<p>Equivalent to <a href="#apply/3"><code class="inline">apply(Func, Args, [])</code></a>.</p>
  </section>
</section>
<section class="detail" id="apply/3">

  <div class="detail-header">
    <a href="#apply/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">apply(Arg1, Arg2, Arg3)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L558" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> apply(Module, Function, Args) -> <a href="../../apps/erts/erlang.html#t:term/0">term</a>()
               when Module :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Function :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>(), Args :: [<a href="../../apps/erts/erlang.html#t:term/0">term</a>()];
           (Func, Args, OptionList) -> <a href="../../apps/erts/erlang.html#t:term/0">term</a>()
               when
                   Func :: fun() | {Module :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Function :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>()},
                   Args :: [<a href="../../apps/erts/erlang.html#t:term/0">term</a>()],
                   OptionList :: [Option],
                   Option :: <a href="#t:apply_option/0">apply_option</a>().</pre>

      </div>

<p>Calls the given function surrounded by
<a href="#trace/1"><code class="inline">trace([start, ...])</code></a> and
<a href="#trace/1"><code class="inline">trace(stop)</code></a>.</p><p>If the function arguments (<code class="inline">Arg1</code>, <code class="inline">Arg2</code>, and <code class="inline">Arg3</code>) are <code class="inline">Module</code>
(an atom), <code class="inline">Function</code> (an atom), and <code class="inline">Args</code> (a list), the function
will be called using
<a href="../../apps/erts/erlang.html#apply/3"><code class="inline">erlang:apply(Module, Function, Args)</code></a>.</p><p>If the function arguments are <code class="inline">Func</code> (a fun), <code class="inline">Args</code> (a list), and
<code class="inline">OptionList</code> (a list of options), the fun will be called using
<a href="../../apps/erts/erlang.html#apply/2"><code class="inline">erlang:apply(Func, Args)</code></a>.</p><p>Some effort is made to keep the trace clean from unnecessary trace messages;
tracing is started and stopped from a spawned process while <a href="../../apps/erts/erlang.html#apply/2"><code class="inline">erlang:apply/2</code></a>
is called in the current process only surrounded by <code class="inline">receive</code> and <code class="inline">send</code>
statements towards the trace starting process. The trace starting process exits
when it is not needed any more.</p><p>The <code class="inline">TraceStartOption</code> is any option allowed for <a href="#trace/1"><code class="inline">trace/1</code></a>. The
options <code class="inline">[start, {procs, [self() | PidList]} | OptList]</code> are given to
<a href="#trace/1"><code class="inline">trace/1</code></a>, where <code class="inline">OptList</code> is <code class="inline">OptionList</code> with the
<code class="inline">continue</code>, <code class="inline">start</code> and <code class="inline">{procs, _}</code> options removed.</p><p>The <code class="inline">continue</code> option inhibits the call to <a href="#trace/1"><code class="inline">trace(stop)</code></a> and leaves
it up to the caller to stop tracing at a suitable time.</p>
  </section>
</section>
<section class="detail" id="apply/4">

  <div class="detail-header">
    <a href="#apply/4" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">apply(Module, Function, Args, OptionList)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L577" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> apply(Module, Function, Args, OptionList) -> <a href="../../apps/erts/erlang.html#t:term/0">term</a>()
               when
                   Module :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>(),
                   Function :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>(),
                   Args :: [<a href="../../apps/erts/erlang.html#t:term/0">term</a>()],
                   OptionList :: [Option],
                   Option :: <a href="#t:apply_option/0">apply_option</a>().</pre>

      </div>

<p>Equivalent to <a href="#apply/3"><code class="inline">apply({Module, Function}, Args, OptionList)</code></a>.</p>
  </section>
</section>
<section class="detail" id="profile/0">

  <div class="detail-header">
    <a href="#profile/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">profile()</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L958" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> profile() -> ok | {error, Reason} | {'EXIT', ServerPid, Reason}
                 when ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(), Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>

<p>Equivalent to <a href="#profile/1"><code class="inline">profile([])</code></a>.</p>
  </section>
</section>
<section class="detail" id="profile/1">

  <div class="detail-header">
    <a href="#profile/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">profile(Arg)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L1056" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> profile(OptionName) -> ok | {ok, Tracer} | {error, Reason} | {'EXIT', ServerPid, Reason}
                 when OptionName :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>(), Tracer :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(), ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(), Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>();
             ({OptionName, OptionValue}) ->
                 ok | {ok, Tracer} | {error, Reason} | {'EXIT', ServerPid, Reason}
                 when
                     OptionName :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>(),
                     OptionValue :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                     Tracer :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(),
                     ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(),
                     Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>();
             (OptionList) -> ok | {ok, Tracer} | {error, Reason} | {'EXIT', ServerPid, Reason}
                 when
                     OptionList :: [Option],
                     Option :: <a href="#t:profile_option/0">profile_option</a>(),
                     Tracer :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(),
                     ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(),
                     Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>

<p>Compiles a trace into raw profile data held by the <code class="inline">fprof</code> server.</p><p>If <code class="inline">Arg</code> is an atom, this call is equivalent to <code class="inline">profile([Arg])</code>.</p><p>If <code class="inline">Arg</code> is a tuple <code class="inline">{OptionName, OptionValue}</code>,
this call is equivalent to <code class="inline">profile([Arg])</code>.</p><p>Otherwise, <code class="inline">Arg</code> must be a list of options.</p><p><code class="inline">Dumpfile</code> is used to call <a href="../../apps/kernel/file.html#open/2"><code class="inline">file:open/2</code></a>, and <code class="inline">Filename</code> is used to call
<a href="../../apps/runtime_tools/dbg.html#trace_port/2"><code class="inline">dbg:trace_port(file, Filename)</code></a>.</p><p>The following options are supported:</p><ul><li><p><strong><code class="inline">file</code> | <code class="inline">{file, Filename}</code></strong> - Reads the file <code class="inline">Filename</code> and creates raw
profile data that is stored in RAM by the <code class="inline">fprof</code> server. If the option <code class="inline">file</code>
is given, or none of these options are given, the file <code class="inline">fprof.trace</code> is
read. The call will return when the whole trace has been read with the return
value <code class="inline">ok</code> if successful. This option is not allowed with the <code class="inline">start</code> or
<code class="inline">stop</code> options.</p></li><li><p><strong><code class="inline">dump</code> | <code class="inline">{dump, Dump}</code></strong> - Specifies the destination for the trace text
dump. If this option is not given, no dump is generated, if it is <code class="inline">dump</code> the
destination will be the caller's group leader, otherwise the destination
<code class="inline">Dump</code> is either the pid of an I/O device or a filename. If the
filename is <code class="inline">[]</code>, <code class="inline">&quot;fprof.dump&quot;</code> is used instead. This option cannot be
combined with the <code class="inline">stop</code> option.</p></li><li><p><strong><code class="inline">append</code></strong> - Causes the trace text dump to be appended to the destination
file. This option is only allowed with the <code class="inline">{dump, Dumpfile}</code> option.</p></li><li><p><strong><code class="inline">start</code></strong> - Starts a tracer process that profiles trace data in runtime. The
call will return immediately with the return value <code class="inline">{ok, Tracer}</code> if
successful. This option is not allowed with the <code class="inline">stop</code>, <code class="inline">file</code>, or
<code class="inline">{file, Filename}</code> options.</p></li><li><p><strong><code class="inline">stop</code></strong> - Stops the tracer process that profiles trace data in runtime. The
return value will be value <code class="inline">ok</code> if successful. This option cannot be combined
with the <code class="inline">start</code>, <code class="inline">file</code>, or <code class="inline">{file, Filename}</code> options.</p></li></ul>
  </section>
</section>
<section class="detail" id="profile/2">

  <div class="detail-header">
    <a href="#profile/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">profile(OptionName, OptionValue)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L981" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> profile(OptionName, OptionValue) ->
                 ok | {ok, Tracer} | {error, Reason} | {'EXIT', ServerPid, Reason}
                 when
                     OptionName :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>(),
                     OptionValue :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                     Tracer :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(),
                     ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(),
                     Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>

<p>Equivalent to <a href="#profile/1"><code class="inline">profile([{OptionName, OptionValue}])</code></a>.</p>
  </section>
</section>
<section class="detail" id="start/0">

  <div class="detail-header">
    <a href="#start/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">start()</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L1461" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> start() -> {ok, Pid} | {error, {already_started, Pid}} when Pid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>().</pre>

      </div>

<p>Starts the <code class="inline">fprof</code> server.</p><p>Note that there is seldom any need to call this function directly, since
the server will be automatically started by any function that will need it.</p>
  </section>
</section>
<section class="detail" id="stop/0">

  <div class="detail-header">
    <a href="#stop/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">stop()</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L1491" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> stop() -> ok.</pre>

      </div>

<p>Equivalent to <a href="#stop/1"><code class="inline">stop(normal)</code></a>.</p>
  </section>
</section>
<section class="detail" id="stop/1">

  <div class="detail-header">
    <a href="#stop/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">stop(Reason)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L1510" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> stop(Reason) -> ok when Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>

<p>Stops the <code class="inline">fprof</code> server.</p><p>The supplied <code class="inline">Reason</code> becomes the exit reason for the server process. By default,
any <code class="inline">Reason</code> other than <code class="inline">kill</code> sends a request to the server and waits for it to
clean up, reply, and exit. If <code class="inline">Reason</code> is <code class="inline">kill</code>, the server is bluntly killed.</p><p>If the <code class="inline">fprof</code> server is not running, this function returns immediately.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p>When the <code class="inline">fprof</code> server is stopped the collected raw profile data is lost.</p></section>
  </section>
</section>
<section class="detail" id="trace/1">

  <div class="detail-header">
    <a href="#trace/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">trace(Arg)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L882" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> trace(verbose) -> ok | {error, Reason} | {'EXIT', ServerPid, Reason}
               when ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(), Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>();
           (OptionName) -> ok | {error, Reason} | {'EXIT', ServerPid, Reason}
               when OptionName :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>(), ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(), Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>();
           ({OptionName, OptionValue}) -> ok | {error, Reason} | {'EXIT', ServerPid, Reason}
               when OptionName :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>(), OptionValue :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(), Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>();
           (OptionList) -> ok | {error, Reason} | {'EXIT', ServerPid, Reason}
               when
                   OptionList :: [Option],
                   Option :: <a href="#t:trace_option/0">trace_option</a>(),
                   ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(),
                   Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>

<p>Starts or stops tracing.</p><p>If <code class="inline">Arg</code> is atom <code class="inline">verbose</code>, this call is equivalent to
<code class="inline">trace([start, verbose])</code>.</p><p>If <code class="inline">Arg</code> is an atom, this call is equivalent to
<code class="inline">trace([Arg])</code>.</p><p>If <code class="inline">Arg</code> is a tuple <code class="inline">{OptionName, OptionValue}</code>, this call is equivalent to
<code class="inline">trace([Arg])</code>.</p><p>Otherwise, <code class="inline">Arg</code> has to be a list of <a href="#t:trace_option/0">trace options</a>.</p><p><code class="inline">PidSpec</code> and <code class="inline">Tracer</code> are used in calls to
<a href="../../apps/erts/erlang.html#trace/3"><code class="inline">erlang:trace(PidSpec, true, [{tracer, Tracer} | Flags])</code></a>,
and <code class="inline">Filename</code> is used to call
<a href="../../apps/runtime_tools/dbg.html#trace_port/2"><code class="inline">dbg:trace_port(file, Filename)</code></a>.</p><p>Option description:</p><ul><li><p><strong><code class="inline">stop</code></strong> - Stops a running <code class="inline">fprof</code> trace and clears all tracing from the
node. Either option <code class="inline">stop</code> or <code class="inline">start</code> must be specified, but not both.</p></li><li><p><strong><code class="inline">start</code></strong> - Clears all tracing from the node and starts a new <code class="inline">fprof</code> trace.
Either option <code class="inline">start</code> or <code class="inline">stop</code> must be specified, but not both.</p></li><li><p><strong><code class="inline">verbose</code> | <code class="inline">{verbose, boolean()}</code></strong> - The <code class="inline">verbose</code> or
<code class="inline">{verbose, true}</code> options add some trace flags that <code class="inline">fprof</code> does not need, but that
can be interesting for general debugging purposes. These options are only allowed
with the <code class="inline">start</code> option.</p></li><li><p><strong><code class="inline">cpu_time</code> | <code class="inline">{cpu_time, boolean()}</code></strong> - The <code class="inline">cpu_time</code> or
<code class="inline">{cpu_time, true}</code> options make the timestamps in the trace be in CPU time instead of
the default wallclock time. These options are only allowed with the
<code class="inline">start</code> option.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p>Getting correct values out of <code class="inline">cpu_time</code> can be difficult. The best way to get
correct values is to run using a single scheduler and bind that scheduler to
a specific CPU. For example:</p><pre><code class="makeup bash" translate="no"><span class="">erl +S 1 +sbt db`
</span></code></pre></section></li><li><p><strong><code class="inline">{procs, PidSpec}</code> | <code class="inline">{procs, [PidSpec]}</code></strong> - Specifies which processes that
should be traced. If this option is not given, the calling process is traced.
All processes spawned by the traced processes are also traced. This option is
only allowed with the <code class="inline">start</code> option.</p></li><li><p><strong><code class="inline">file</code> | <code class="inline">{file, Filename}</code></strong> - Specifies the filename of the trace. If the
option <code class="inline">file</code> is given, or none of these options are given, the file
<code class="inline">fprof.trace</code> is used. This option is only allowed with the <code class="inline">start</code> option,
but not with the <code class="inline">{tracer, Tracer}</code> option.</p></li><li><p><strong><code class="inline">{tracer, Tracer}</code></strong> - Specifies that trace to process or port shall be done
instead of trace to file. This option is only allowed with the <code class="inline">start</code> option,
but not with the <code class="inline">{file, Filename}</code> option.</p></li></ul>
  </section>
</section>
<section class="detail" id="trace/2">

  <div class="detail-header">
    <a href="#trace/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">trace(What, Value)</h1>


        <a href="https://github.com/erlang/otp/blob/master/lib/tools/src/fprof.erl#L783" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> trace(start, Filename) -> ok | {error, Reason} | {'EXIT', ServerPid, Reason}
               when Filename :: <a href="../../apps/kernel/file.html#t:filename/0">file:filename</a>(), ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(), Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>();
           (verbose, Filename) -> ok | {error, Reason} | {'EXIT', ServerPid, Reason}
               when Filename :: <a href="../../apps/kernel/file.html#t:filename/0">file:filename</a>(), ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(), Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>();
           (OptionName, OptionValue) -> ok | {error, Reason} | {'EXIT', ServerPid, Reason}
               when OptionName :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>(), OptionValue :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), ServerPid :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(), Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>

<p>Starts or stop tracing.</p><p>If <code class="inline">What</code> is atom <code class="inline">start</code>, this call is equivalent to
<a href="#trace/1"><code class="inline">trace([start, {file, Value}])</code></a>.</p><p>If <code class="inline">What</code> is atom <code class="inline">verbose</code>, this call is equivalent to
<a href="#trace/1"><code class="inline">trace([start, verbose, {file, Value}])</code></a>.</p><p>If <code class="inline">What</code> is a tuple <code class="inline">{OptionName, OptionValue}</code>,
this call is equivalent to
<a href="#trace/1"><code class="inline">trace([What])</code></a>.</p>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="tools.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright © 1996-2025 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js"></script>
  <script>
  let initialized = false;

  window.addEventListener("exdoc:loaded", () => {
      if (!initialized) {
      mermaid.initialize({
          startOnLoad: false,
          theme: document.body.className.includes("dark") ? "dark" : "default"
      });
      initialized = true;
      }

      let id = 0;
      for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
          graphEl.innerHTML = svg;
          bindFunctions?.(graphEl);
          preEl.insertAdjacentElement("afterend", graphEl);
          preEl.remove();
      });
      }
  });
  </script>

  </body>
</html>
