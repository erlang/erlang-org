<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.1">
    <meta name="project" content="Erlang System Documentation v29.0-rc0">


<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=29&q=">
<meta name="major-vsn" content="29">
<link rel="canonical" href="https://www.erlang.org/docs/29/system/spec_proc.html" />
<meta name="exdoc:autocomplete" content="off">
    <title>sys and proc_lib — Erlang System Documentation v29.0-rc0</title>

    <link rel="stylesheet" href="dist/html-erlang-ZK43ZOAC.css" />

    <script defer src="dist/sidebar_items-6EAA27B6.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Erlang System Documentation" />
        </a>

      <div>
        <a href="../index.html" class="sidebar-projectName" translate="no">
Erlang System Documentation
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v29.0-rc0
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Erlang System Documentation</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>sys and proc_lib</h1>


      <a href="https://github.com/erlang/otp/blob/master/system/doc/design_principles/spec_proc.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<p><a href="" id="sys-and-proc_lib"></a></p><p>The <a href="../apps/stdlib/sys.html"><code class="inline">sys</code></a> module has functions for simple debugging of processes implemented
using behaviours. It also has functions that, together with functions in the
<code class="inline">proc_lib</code> module, can be used to implement a <em>special process</em> that complies to
the OTP design principles without using a standard behaviour. These functions
can also be used to implement user-defined (non-standard) behaviours.</p><p>Both <a href="../apps/stdlib/sys.html"><code class="inline">sys</code></a> and <a href="../apps/stdlib/proc_lib.html"><code class="inline">proc_lib</code></a> belong to the STDLIB application.</p><h2 id="simple-debugging" class="section-heading"><a href="#simple-debugging" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Simple Debugging</span></h2><p>The <a href="../apps/stdlib/sys.html"><code class="inline">sys</code></a> module has functions for simple debugging of processes implemented
using behaviours. The <code class="inline">code_lock</code> example from
<a href="statem.html#example">gen_statem Behaviour</a> is used to illustrate this:</p><pre><code class="makeup erlang" translate="no"><span class="n">Erlang</span><span class="o">/</span><span class="n">OTP</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="p" data-group-id="1144382546-1">[</span><span class="ss">erts</span><span class="o">-</span><span class="mf">15.0</span><span class="p" data-group-id="1144382546-1">]</span><span class="w"> </span><span class="p" data-group-id="1144382546-2">[</span><span class="mi">64</span><span class="o">-</span><span class="ss">bit</span><span class="p" data-group-id="1144382546-2">]</span><span class="w"> </span><span class="p" data-group-id="1144382546-3">[</span><span class="nc">smp</span><span class="p">:</span><span class="mi">8</span><span class="p">:</span><span class="mi">8</span><span class="p" data-group-id="1144382546-3">]</span><span class="w"> </span><span class="p" data-group-id="1144382546-4">[</span><span class="nc">ds</span><span class="p">:</span><span class="mi">8</span><span class="p">:</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p" data-group-id="1144382546-4">]</span><span class="w"> </span><span class="p" data-group-id="1144382546-5">[</span><span class="ss">async</span><span class="o">-</span><span class="nc">threads</span><span class="p">:</span><span class="mi">1</span><span class="p" data-group-id="1144382546-5">]</span><span class="w"> </span><span class="p" data-group-id="1144382546-6">[</span><span class="ss">jit</span><span class="p" data-group-id="1144382546-6">]</span><span class="w">

</span><span class="n">Eshell</span><span class="w"> </span><span class="n">V15</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="p" data-group-id="1144382546-7">(</span><span class="ss">press</span><span class="w"> </span><span class="n">Ctrl</span><span class="o">+</span><span class="n">G</span><span class="w"> </span><span class="ss">to</span><span class="w"> </span><span class="ss">abort</span><span class="p">,</span><span class="w"> </span><span class="ss">type</span><span class="w"> </span><span class="nf">help</span><span class="p" data-group-id="1144382546-8">(</span><span class="p" data-group-id="1144382546-8">)</span><span class="p">.</span><span class="w"> </span><span class="ss">for</span><span class="w"> </span><span class="ss">help</span><span class="p" data-group-id="1144382546-7">)</span><span class="gp unselectable">
1&gt; </span><span class="nc">code_lock</span><span class="p">:</span><span class="nf">start_link</span><span class="p" data-group-id="1144382546-9">(</span><span class="p" data-group-id="1144382546-10">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="1144382546-10">]</span><span class="p" data-group-id="1144382546-9">)</span><span class="p">.</span><span class="w">
</span><span class="n">Lock</span><span class="w">
</span><span class="p" data-group-id="1144382546-11">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.90</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="1144382546-11">}</span><span class="gp unselectable">
2&gt; </span><span class="nc">sys</span><span class="p">:</span><span class="nf">statistics</span><span class="p" data-group-id="1144382546-12">(</span><span class="ss">code_lock</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1144382546-12">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
3&gt; </span><span class="nc">sys</span><span class="p">:</span><span class="nf">trace</span><span class="p" data-group-id="1144382546-13">(</span><span class="ss">code_lock</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1144382546-13">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
4&gt; </span><span class="nc">code_lock</span><span class="p">:</span><span class="nf">button</span><span class="p" data-group-id="1144382546-14">(</span><span class="mi">1</span><span class="p" data-group-id="1144382546-14">)</span><span class="p">.</span><span class="w">
</span><span class="o">*</span><span class="n">DBG</span><span class="o">*</span><span class="w"> </span><span class="ss">code_lock</span><span class="w"> </span><span class="k">receive</span><span class="w"> </span><span class="ss">cast</span><span class="w"> </span><span class="p" data-group-id="1144382546-15">{</span><span class="ss">button</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="1144382546-15">}</span><span class="w"> </span><span class="ss">in</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="ss">locked</span><span class="w">
</span><span class="ss">ok</span><span class="w">
</span><span class="o">*</span><span class="n">DBG</span><span class="o">*</span><span class="w"> </span><span class="ss">code_lock</span><span class="w"> </span><span class="ss">consume</span><span class="w"> </span><span class="ss">cast</span><span class="w"> </span><span class="p" data-group-id="1144382546-16">{</span><span class="ss">button</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="1144382546-16">}</span><span class="w"> </span><span class="ss">in</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="ss">locked</span><span class="gp unselectable">
5&gt; </span><span class="nc">code_lock</span><span class="p">:</span><span class="nf">button</span><span class="p" data-group-id="1144382546-17">(</span><span class="mi">2</span><span class="p" data-group-id="1144382546-17">)</span><span class="p">.</span><span class="w">
</span><span class="o">*</span><span class="n">DBG</span><span class="o">*</span><span class="w"> </span><span class="ss">code_lock</span><span class="w"> </span><span class="k">receive</span><span class="w"> </span><span class="ss">cast</span><span class="w"> </span><span class="p" data-group-id="1144382546-18">{</span><span class="ss">button</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="1144382546-18">}</span><span class="w"> </span><span class="ss">in</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="ss">locked</span><span class="w">
</span><span class="ss">ok</span><span class="w">
</span><span class="o">*</span><span class="n">DBG</span><span class="o">*</span><span class="w"> </span><span class="ss">code_lock</span><span class="w"> </span><span class="ss">consume</span><span class="w"> </span><span class="ss">cast</span><span class="w"> </span><span class="p" data-group-id="1144382546-19">{</span><span class="ss">button</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="1144382546-19">}</span><span class="w"> </span><span class="ss">in</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="ss">locked</span><span class="gp unselectable">
6&gt; </span><span class="nc">code_lock</span><span class="p">:</span><span class="nf">button</span><span class="p" data-group-id="1144382546-20">(</span><span class="mi">3</span><span class="p" data-group-id="1144382546-20">)</span><span class="p">.</span><span class="w">
</span><span class="o">*</span><span class="n">DBG</span><span class="o">*</span><span class="w"> </span><span class="ss">code_lock</span><span class="w"> </span><span class="k">receive</span><span class="w"> </span><span class="ss">cast</span><span class="w"> </span><span class="p" data-group-id="1144382546-21">{</span><span class="ss">button</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="1144382546-21">}</span><span class="w"> </span><span class="ss">in</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="ss">locked</span><span class="w">
</span><span class="ss">ok</span><span class="w">
</span><span class="o">*</span><span class="n">DBG</span><span class="o">*</span><span class="w"> </span><span class="ss">code_lock</span><span class="w"> </span><span class="ss">consume</span><span class="w"> </span><span class="ss">cast</span><span class="w"> </span><span class="p" data-group-id="1144382546-22">{</span><span class="ss">button</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="1144382546-22">}</span><span class="w"> </span><span class="ss">in</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="ss">locked</span><span class="gp unselectable">
7&gt; </span><span class="nc">code_lock</span><span class="p">:</span><span class="nf">button</span><span class="p" data-group-id="1144382546-23">(</span><span class="mi">4</span><span class="p" data-group-id="1144382546-23">)</span><span class="p">.</span><span class="w">
</span><span class="o">*</span><span class="n">DBG</span><span class="o">*</span><span class="w"> </span><span class="ss">code_lock</span><span class="w"> </span><span class="k">receive</span><span class="w"> </span><span class="ss">cast</span><span class="w"> </span><span class="p" data-group-id="1144382546-24">{</span><span class="ss">button</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="1144382546-24">}</span><span class="w"> </span><span class="ss">in</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="ss">locked</span><span class="w">
</span><span class="ss">ok</span><span class="w">
</span><span class="n">Unlock</span><span class="w">
</span><span class="o">*</span><span class="n">DBG</span><span class="o">*</span><span class="w"> </span><span class="ss">code_lock</span><span class="w"> </span><span class="ss">consume</span><span class="w"> </span><span class="ss">cast</span><span class="w"> </span><span class="p" data-group-id="1144382546-25">{</span><span class="ss">button</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="1144382546-25">}</span><span class="w"> </span><span class="ss">in</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="ss">locked</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">open</span><span class="w">
</span><span class="o">*</span><span class="n">DBG</span><span class="o">*</span><span class="w"> </span><span class="ss">code_lock</span><span class="w"> </span><span class="nb">start_timer</span><span class="w"> </span><span class="p" data-group-id="1144382546-26">{</span><span class="ss">state_timeout</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="ss">lock</span><span class="p">,</span><span class="p" data-group-id="1144382546-27">[</span><span class="p" data-group-id="1144382546-27">]</span><span class="p" data-group-id="1144382546-26">}</span><span class="w"> </span><span class="ss">in</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="ss">open</span><span class="w">
</span><span class="o">*</span><span class="n">DBG</span><span class="o">*</span><span class="w"> </span><span class="ss">code_lock</span><span class="w"> </span><span class="k">receive</span><span class="w"> </span><span class="ss">state_timeout</span><span class="w"> </span><span class="ss">lock</span><span class="w"> </span><span class="ss">in</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="ss">open</span><span class="w">
</span><span class="n">Lock</span><span class="w">
</span><span class="o">*</span><span class="n">DBG</span><span class="o">*</span><span class="w"> </span><span class="ss">code_lock</span><span class="w"> </span><span class="ss">consume</span><span class="w"> </span><span class="ss">state_timeout</span><span class="w"> </span><span class="ss">lock</span><span class="w"> </span><span class="ss">in</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="ss">open</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">locked</span><span class="gp unselectable">
8&gt; </span><span class="nc">sys</span><span class="p">:</span><span class="nf">statistics</span><span class="p" data-group-id="1144382546-28">(</span><span class="ss">code_lock</span><span class="p">,</span><span class="w"> </span><span class="nb">get</span><span class="p" data-group-id="1144382546-28">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="1144382546-29">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="1144382546-30">[</span><span class="p" data-group-id="1144382546-31">{</span><span class="ss">start_time</span><span class="p">,</span><span class="p" data-group-id="1144382546-32">{</span><span class="p" data-group-id="1144382546-33">{</span><span class="mi">2024</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="1144382546-33">}</span><span class="p">,</span><span class="p" data-group-id="1144382546-34">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="1144382546-34">}</span><span class="p" data-group-id="1144382546-32">}</span><span class="p" data-group-id="1144382546-31">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="1144382546-35">{</span><span class="ss">current_time</span><span class="p">,</span><span class="p" data-group-id="1144382546-36">{</span><span class="p" data-group-id="1144382546-37">{</span><span class="mi">2024</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="1144382546-37">}</span><span class="p">,</span><span class="p" data-group-id="1144382546-38">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">48</span><span class="p" data-group-id="1144382546-38">}</span><span class="p" data-group-id="1144382546-36">}</span><span class="p" data-group-id="1144382546-35">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="1144382546-39">{</span><span class="ss">reductions</span><span class="p">,</span><span class="mi">4098</span><span class="p" data-group-id="1144382546-39">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="1144382546-40">{</span><span class="ss">messages_in</span><span class="p">,</span><span class="mi">5</span><span class="p" data-group-id="1144382546-40">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="1144382546-41">{</span><span class="ss">messages_out</span><span class="p">,</span><span class="mi">0</span><span class="p" data-group-id="1144382546-41">}</span><span class="p" data-group-id="1144382546-30">]</span><span class="p" data-group-id="1144382546-29">}</span><span class="gp unselectable">
9&gt; </span><span class="nc">sys</span><span class="p">:</span><span class="nf">statistics</span><span class="p" data-group-id="1144382546-42">(</span><span class="ss">code_lock</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1144382546-42">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
10&gt; </span><span class="nc">sys</span><span class="p">:</span><span class="nf">trace</span><span class="p" data-group-id="1144382546-43">(</span><span class="ss">code_lock</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1144382546-43">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
11&gt; </span><span class="nc">sys</span><span class="p">:</span><span class="nf">get_status</span><span class="p" data-group-id="1144382546-44">(</span><span class="ss">code_lock</span><span class="p" data-group-id="1144382546-44">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="1144382546-45">{</span><span class="ss">status</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.90</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="1144382546-46">{</span><span class="ss">module</span><span class="p">,</span><span class="ss">gen_statem</span><span class="p" data-group-id="1144382546-46">}</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="1144382546-47">[</span><span class="p" data-group-id="1144382546-48">[</span><span class="p" data-group-id="1144382546-49">{</span><span class="ss">&#39;$initial_call&#39;</span><span class="p">,</span><span class="p" data-group-id="1144382546-50">{</span><span class="ss">code_lock</span><span class="p">,</span><span class="ss">init</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="1144382546-50">}</span><span class="p" data-group-id="1144382546-49">}</span><span class="p">,</span><span class="w">
          </span><span class="p" data-group-id="1144382546-51">{</span><span class="ss">&#39;$ancestors&#39;</span><span class="p">,</span><span class="p" data-group-id="1144382546-52">[</span><span class="o">&lt;</span><span class="mf">0.88</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.87</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.70</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.65</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.69</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
                         </span><span class="o">&lt;</span><span class="mf">0.64</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="ss">kernel_sup</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.47</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="1144382546-52">]</span><span class="p" data-group-id="1144382546-51">}</span><span class="p" data-group-id="1144382546-48">]</span><span class="p">,</span><span class="w">
         </span><span class="ss">running</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.88</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="1144382546-53">[</span><span class="p" data-group-id="1144382546-53">]</span><span class="p">,</span><span class="w">
         </span><span class="p" data-group-id="1144382546-54">[</span><span class="p" data-group-id="1144382546-55">{</span><span class="ss">header</span><span class="p">,</span><span class="s">&quot;Status for state machine code_lock&quot;</span><span class="p" data-group-id="1144382546-55">}</span><span class="p">,</span><span class="w">
          </span><span class="p" data-group-id="1144382546-56">{</span><span class="ss">data</span><span class="p">,</span><span class="p" data-group-id="1144382546-57">[</span><span class="p" data-group-id="1144382546-58">{</span><span class="s">&quot;Status&quot;</span><span class="p">,</span><span class="ss">running</span><span class="p" data-group-id="1144382546-58">}</span><span class="p">,</span><span class="w">
                 </span><span class="p" data-group-id="1144382546-59">{</span><span class="s">&quot;Parent&quot;</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.88</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="1144382546-59">}</span><span class="p">,</span><span class="w">
                 </span><span class="p" data-group-id="1144382546-60">{</span><span class="s">&quot;Modules&quot;</span><span class="p">,</span><span class="p" data-group-id="1144382546-61">[</span><span class="ss">code_lock</span><span class="p" data-group-id="1144382546-61">]</span><span class="p" data-group-id="1144382546-60">}</span><span class="p">,</span><span class="w">
                 </span><span class="p" data-group-id="1144382546-62">{</span><span class="s">&quot;Time-outs&quot;</span><span class="p">,</span><span class="p" data-group-id="1144382546-63">{</span><span class="mi">0</span><span class="p">,</span><span class="p" data-group-id="1144382546-64">[</span><span class="p" data-group-id="1144382546-64">]</span><span class="p" data-group-id="1144382546-63">}</span><span class="p" data-group-id="1144382546-62">}</span><span class="p">,</span><span class="w">
                 </span><span class="p" data-group-id="1144382546-65">{</span><span class="s">&quot;Logged Events&quot;</span><span class="p">,</span><span class="p" data-group-id="1144382546-66">[</span><span class="p" data-group-id="1144382546-66">]</span><span class="p" data-group-id="1144382546-65">}</span><span class="p">,</span><span class="w">
                 </span><span class="p" data-group-id="1144382546-67">{</span><span class="s">&quot;Postponed&quot;</span><span class="p">,</span><span class="p" data-group-id="1144382546-68">[</span><span class="p" data-group-id="1144382546-68">]</span><span class="p" data-group-id="1144382546-67">}</span><span class="p" data-group-id="1144382546-57">]</span><span class="p" data-group-id="1144382546-56">}</span><span class="p">,</span><span class="w">
          </span><span class="p" data-group-id="1144382546-69">{</span><span class="ss">data</span><span class="p">,</span><span class="p" data-group-id="1144382546-70">[</span><span class="p" data-group-id="1144382546-71">{</span><span class="s">&quot;State&quot;</span><span class="p">,</span><span class="w">
                  </span><span class="p" data-group-id="1144382546-72">{</span><span class="ss">locked</span><span class="p">,</span><span class="p" data-group-id="1144382546-73">#{</span><span class="ss">code</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="1144382546-74">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p" data-group-id="1144382546-74">]</span><span class="p">,</span><span class="w">
                            </span><span class="nb">length</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="ss">buttons</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="1144382546-75">[</span><span class="p" data-group-id="1144382546-75">]</span><span class="p" data-group-id="1144382546-73">}</span><span class="p" data-group-id="1144382546-72">}</span><span class="p" data-group-id="1144382546-71">}</span><span class="p" data-group-id="1144382546-70">]</span><span class="p" data-group-id="1144382546-69">}</span><span class="p" data-group-id="1144382546-54">]</span><span class="p" data-group-id="1144382546-47">]</span><span class="p" data-group-id="1144382546-45">}</span></code></pre><h2 id="special-processes" class="section-heading"><a href="#special-processes" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Special Processes</span></h2><p>This section describes how to write a process that complies to the OTP design
principles, without using a standard behaviour. Such a process is to:</p><ul><li>Be started in a way that makes the process fit into a supervision tree</li><li>Support the <code class="inline">sys</code> <a href="spec_proc.html#debug">debug facilities</a></li><li>Take care of <a href="spec_proc.html#msg">system messages</a>.</li></ul><p>System messages are messages with a special meaning, used in the supervision
tree. Typical system messages are requests for trace output, and requests to
suspend or resume process execution (used during release handling). Processes
implemented using standard behaviours automatically understand these messages.</p><h3 id="example" class="section-heading"><a href="#example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example</span></h3><p>Here follows the simple server from
<a href="design_principles.html#ch1">Overview</a>,
implemented using <code class="inline">sys</code> and <code class="inline">proc_lib</code> to fit into a supervision tree:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="0656722743-1">(</span><span class="ss">ch4</span><span class="p" data-group-id="0656722743-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0656722743-2">(</span><span class="p" data-group-id="0656722743-3">[</span><span class="ss">start_link</span><span class="p">/</span><span class="mi">0</span><span class="p" data-group-id="0656722743-3">]</span><span class="p" data-group-id="0656722743-2">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0656722743-4">(</span><span class="p" data-group-id="0656722743-5">[</span><span class="ss">alloc</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">free</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="0656722743-5">]</span><span class="p" data-group-id="0656722743-4">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0656722743-6">(</span><span class="p" data-group-id="0656722743-7">[</span><span class="ss">init</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="0656722743-7">]</span><span class="p" data-group-id="0656722743-6">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0656722743-8">(</span><span class="p" data-group-id="0656722743-9">[</span><span class="ss">system_continue</span><span class="p">/</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="ss">system_terminate</span><span class="p">/</span><span class="mi">4</span><span class="p">,</span><span class="w">
         </span><span class="ss">write_debug</span><span class="p">/</span><span class="mi">3</span><span class="p">,</span><span class="w">
         </span><span class="ss">system_get_state</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">system_replace_state</span><span class="p">/</span><span class="mi">2</span><span class="p" data-group-id="0656722743-9">]</span><span class="p" data-group-id="0656722743-8">)</span><span class="p">.</span><span class="w">

</span><span class="nf">start_link</span><span class="p" data-group-id="0656722743-10">(</span><span class="p" data-group-id="0656722743-10">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">proc_lib</span><span class="p">:</span><span class="nf">start_link</span><span class="p" data-group-id="0656722743-11">(</span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="ss">init</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0656722743-12">[</span><span class="nf">self</span><span class="p" data-group-id="0656722743-13">(</span><span class="p" data-group-id="0656722743-13">)</span><span class="p" data-group-id="0656722743-12">]</span><span class="p" data-group-id="0656722743-11">)</span><span class="p">.</span><span class="w">

</span><span class="nf">alloc</span><span class="p" data-group-id="0656722743-14">(</span><span class="p" data-group-id="0656722743-14">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="ss">ch4</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="0656722743-15">{</span><span class="nf">self</span><span class="p" data-group-id="0656722743-16">(</span><span class="p" data-group-id="0656722743-16">)</span><span class="p">,</span><span class="w"> </span><span class="ss">alloc</span><span class="p" data-group-id="0656722743-15">}</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="0656722743-17">{</span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="n">Res</span><span class="p" data-group-id="0656722743-17">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Res</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="nf">free</span><span class="p" data-group-id="0656722743-18">(</span><span class="n">Ch</span><span class="p" data-group-id="0656722743-18">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="ss">ch4</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="0656722743-19">{</span><span class="ss">free</span><span class="p">,</span><span class="w"> </span><span class="n">Ch</span><span class="p" data-group-id="0656722743-19">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">init</span><span class="p" data-group-id="0656722743-20">(</span><span class="n">Parent</span><span class="p" data-group-id="0656722743-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="0656722743-21">(</span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="0656722743-22">(</span><span class="p" data-group-id="0656722743-22">)</span><span class="p" data-group-id="0656722743-21">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Chs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">channels</span><span class="p" data-group-id="0656722743-23">(</span><span class="p" data-group-id="0656722743-23">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Deb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">sys</span><span class="p">:</span><span class="nf">debug_options</span><span class="p" data-group-id="0656722743-24">(</span><span class="p" data-group-id="0656722743-25">[</span><span class="p" data-group-id="0656722743-25">]</span><span class="p" data-group-id="0656722743-24">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">proc_lib</span><span class="p">:</span><span class="nf">init_ack</span><span class="p" data-group-id="0656722743-26">(</span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0656722743-27">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="0656722743-28">(</span><span class="p" data-group-id="0656722743-28">)</span><span class="p" data-group-id="0656722743-27">}</span><span class="p" data-group-id="0656722743-26">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">loop</span><span class="p" data-group-id="0656722743-29">(</span><span class="n">Chs</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Deb</span><span class="p" data-group-id="0656722743-29">)</span><span class="p">.</span><span class="w">

</span><span class="nf">loop</span><span class="p" data-group-id="0656722743-30">(</span><span class="n">Chs</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Deb</span><span class="p" data-group-id="0656722743-30">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="0656722743-31">{</span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="ss">alloc</span><span class="p" data-group-id="0656722743-31">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Deb2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">sys</span><span class="p">:</span><span class="nf">handle_debug</span><span class="p" data-group-id="0656722743-32">(</span><span class="n">Deb</span><span class="p">,</span><span class="w"> </span><span class="k">fun</span><span class="w"> </span><span class="nc">ch4</span><span class="p">:</span><span class="ss">write_debug</span><span class="p">/</span><span class="mi">3</span><span class="p">,</span><span class="w">
                                    </span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0656722743-33">{</span><span class="ss">in</span><span class="p">,</span><span class="w"> </span><span class="ss">alloc</span><span class="p">,</span><span class="w"> </span><span class="n">From</span><span class="p" data-group-id="0656722743-33">}</span><span class="p" data-group-id="0656722743-32">)</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="0656722743-34">{</span><span class="n">Ch</span><span class="p">,</span><span class="w"> </span><span class="n">Chs2</span><span class="p" data-group-id="0656722743-34">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">alloc</span><span class="p" data-group-id="0656722743-35">(</span><span class="n">Chs</span><span class="p" data-group-id="0656722743-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">From</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="0656722743-36">{</span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="n">Ch</span><span class="p" data-group-id="0656722743-36">}</span><span class="p">,</span><span class="w">
            </span><span class="n">Deb3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">sys</span><span class="p">:</span><span class="nf">handle_debug</span><span class="p" data-group-id="0656722743-37">(</span><span class="n">Deb2</span><span class="p">,</span><span class="w"> </span><span class="k">fun</span><span class="w"> </span><span class="nc">ch4</span><span class="p">:</span><span class="ss">write_debug</span><span class="p">/</span><span class="mi">3</span><span class="p">,</span><span class="w">
                                    </span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0656722743-38">{</span><span class="ss">out</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0656722743-39">{</span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="n">Ch</span><span class="p" data-group-id="0656722743-39">}</span><span class="p">,</span><span class="w"> </span><span class="n">From</span><span class="p" data-group-id="0656722743-38">}</span><span class="p" data-group-id="0656722743-37">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">loop</span><span class="p" data-group-id="0656722743-40">(</span><span class="n">Chs2</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Deb3</span><span class="p" data-group-id="0656722743-40">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0656722743-41">{</span><span class="ss">free</span><span class="p">,</span><span class="w"> </span><span class="n">Ch</span><span class="p" data-group-id="0656722743-41">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Deb2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">sys</span><span class="p">:</span><span class="nf">handle_debug</span><span class="p" data-group-id="0656722743-42">(</span><span class="n">Deb</span><span class="p">,</span><span class="w"> </span><span class="k">fun</span><span class="w"> </span><span class="nc">ch4</span><span class="p">:</span><span class="ss">write_debug</span><span class="p">/</span><span class="mi">3</span><span class="p">,</span><span class="w">
                                    </span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0656722743-43">{</span><span class="ss">in</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0656722743-44">{</span><span class="ss">free</span><span class="p">,</span><span class="w"> </span><span class="n">Ch</span><span class="p" data-group-id="0656722743-44">}</span><span class="p" data-group-id="0656722743-43">}</span><span class="p" data-group-id="0656722743-42">)</span><span class="p">,</span><span class="w">
            </span><span class="n">Chs2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">free</span><span class="p" data-group-id="0656722743-45">(</span><span class="n">Ch</span><span class="p">,</span><span class="w"> </span><span class="n">Chs</span><span class="p" data-group-id="0656722743-45">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">loop</span><span class="p" data-group-id="0656722743-46">(</span><span class="n">Chs2</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Deb2</span><span class="p" data-group-id="0656722743-46">)</span><span class="p">;</span><span class="w">

        </span><span class="p" data-group-id="0656722743-47">{</span><span class="ss">system</span><span class="p">,</span><span class="w"> </span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="n">Request</span><span class="p" data-group-id="0656722743-47">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">sys</span><span class="p">:</span><span class="nf">handle_system_msg</span><span class="p" data-group-id="0656722743-48">(</span><span class="n">Request</span><span class="p">,</span><span class="w"> </span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w">
                                  </span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="n">Deb</span><span class="p">,</span><span class="w"> </span><span class="n">Chs</span><span class="p" data-group-id="0656722743-48">)</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="nf">system_continue</span><span class="p" data-group-id="0656722743-49">(</span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Deb</span><span class="p">,</span><span class="w"> </span><span class="n">Chs</span><span class="p" data-group-id="0656722743-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">loop</span><span class="p" data-group-id="0656722743-50">(</span><span class="n">Chs</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Deb</span><span class="p" data-group-id="0656722743-50">)</span><span class="p">.</span><span class="w">

</span><span class="nf">system_terminate</span><span class="p" data-group-id="0656722743-51">(</span><span class="n">Reason</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Deb</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Chs</span><span class="p" data-group-id="0656722743-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">exit</span><span class="p" data-group-id="0656722743-52">(</span><span class="n">Reason</span><span class="p" data-group-id="0656722743-52">)</span><span class="p">.</span><span class="w">

</span><span class="nf">system_get_state</span><span class="p" data-group-id="0656722743-53">(</span><span class="n">Chs</span><span class="p" data-group-id="0656722743-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0656722743-54">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Chs</span><span class="p" data-group-id="0656722743-54">}</span><span class="p">.</span><span class="w">

</span><span class="nf">system_replace_state</span><span class="p" data-group-id="0656722743-55">(</span><span class="n">StateFun</span><span class="p">,</span><span class="w"> </span><span class="n">Chs</span><span class="p" data-group-id="0656722743-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">NChs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StateFun</span><span class="p" data-group-id="0656722743-56">(</span><span class="n">Chs</span><span class="p" data-group-id="0656722743-56">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0656722743-57">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">NChs</span><span class="p">,</span><span class="w"> </span><span class="n">NChs</span><span class="p" data-group-id="0656722743-57">}</span><span class="p">.</span><span class="w">

</span><span class="nf">write_debug</span><span class="p" data-group-id="0656722743-58">(</span><span class="n">Dev</span><span class="p">,</span><span class="w"> </span><span class="n">Event</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p" data-group-id="0656722743-58">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0656722743-59">(</span><span class="n">Dev</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="si">~p</span><span class="s"> event = </span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0656722743-60">[</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">Event</span><span class="p" data-group-id="0656722743-60">]</span><span class="p" data-group-id="0656722743-59">)</span><span class="p">.</span></code></pre><p id="ex">As it is not relevant to the example, the channel handling functions have been
omitted. To compile this example, the
<a href="design_principles.html#channels-implementation">implementation of channel handling</a>
needs to be added to the module.</p><p>Here is an example showing how the debugging functions in the <code class="inline">sys</code>
module can be used for <code class="inline">ch4</code>:</p><pre><code class="makeup erlang" translate="no"><span class="c1">% erl</span><span class="w">
</span><span class="n">Erlang</span><span class="o">/</span><span class="n">OTP</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="p" data-group-id="9356427080-1">[</span><span class="ss">erts</span><span class="o">-</span><span class="mf">15.0</span><span class="p" data-group-id="9356427080-1">]</span><span class="w"> </span><span class="p" data-group-id="9356427080-2">[</span><span class="mi">64</span><span class="o">-</span><span class="ss">bit</span><span class="p" data-group-id="9356427080-2">]</span><span class="w"> </span><span class="p" data-group-id="9356427080-3">[</span><span class="nc">smp</span><span class="p">:</span><span class="mi">8</span><span class="p">:</span><span class="mi">8</span><span class="p" data-group-id="9356427080-3">]</span><span class="w"> </span><span class="p" data-group-id="9356427080-4">[</span><span class="nc">ds</span><span class="p">:</span><span class="mi">8</span><span class="p">:</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p" data-group-id="9356427080-4">]</span><span class="w"> </span><span class="p" data-group-id="9356427080-5">[</span><span class="ss">async</span><span class="o">-</span><span class="nc">threads</span><span class="p">:</span><span class="mi">1</span><span class="p" data-group-id="9356427080-5">]</span><span class="w"> </span><span class="p" data-group-id="9356427080-6">[</span><span class="ss">jit</span><span class="p" data-group-id="9356427080-6">]</span><span class="w">

</span><span class="n">Eshell</span><span class="w"> </span><span class="n">V15</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="p" data-group-id="9356427080-7">(</span><span class="ss">press</span><span class="w"> </span><span class="n">Ctrl</span><span class="o">+</span><span class="n">G</span><span class="w"> </span><span class="ss">to</span><span class="w"> </span><span class="ss">abort</span><span class="p">,</span><span class="w"> </span><span class="ss">type</span><span class="w"> </span><span class="nf">help</span><span class="p" data-group-id="9356427080-8">(</span><span class="p" data-group-id="9356427080-8">)</span><span class="p">.</span><span class="w"> </span><span class="ss">for</span><span class="w"> </span><span class="ss">help</span><span class="p" data-group-id="9356427080-7">)</span><span class="gp unselectable">
1&gt; </span><span class="nc">ch4</span><span class="p">:</span><span class="nf">start_link</span><span class="p" data-group-id="9356427080-9">(</span><span class="p" data-group-id="9356427080-9">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9356427080-10">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.90</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="9356427080-10">}</span><span class="gp unselectable">
2&gt; </span><span class="nc">sys</span><span class="p">:</span><span class="nf">statistics</span><span class="p" data-group-id="9356427080-11">(</span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9356427080-11">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
3&gt; </span><span class="nc">sys</span><span class="p">:</span><span class="nf">trace</span><span class="p" data-group-id="9356427080-12">(</span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9356427080-12">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
4&gt; </span><span class="nc">ch4</span><span class="p">:</span><span class="nf">alloc</span><span class="p" data-group-id="9356427080-13">(</span><span class="p" data-group-id="9356427080-13">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ch4</span><span class="w"> </span><span class="ss">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9356427080-14">{</span><span class="ss">in</span><span class="p">,</span><span class="ss">alloc</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.88</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="9356427080-14">}</span><span class="w">
</span><span class="ss">ch4</span><span class="w"> </span><span class="ss">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9356427080-15">{</span><span class="ss">out</span><span class="p">,</span><span class="p" data-group-id="9356427080-16">{</span><span class="ss">ch4</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="9356427080-16">}</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.88</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="9356427080-15">}</span><span class="w">
</span><span class="mi">1</span><span class="gp unselectable">
5&gt; </span><span class="nc">ch4</span><span class="p">:</span><span class="nf">free</span><span class="p" data-group-id="9356427080-17">(</span><span class="ss">ch1</span><span class="p" data-group-id="9356427080-17">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ch4</span><span class="w"> </span><span class="ss">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9356427080-18">{</span><span class="ss">in</span><span class="p">,</span><span class="p" data-group-id="9356427080-19">{</span><span class="ss">free</span><span class="p">,</span><span class="ss">ch1</span><span class="p" data-group-id="9356427080-19">}</span><span class="p" data-group-id="9356427080-18">}</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
6&gt; </span><span class="nc">sys</span><span class="p">:</span><span class="nf">statistics</span><span class="p" data-group-id="9356427080-20">(</span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="nb">get</span><span class="p" data-group-id="9356427080-20">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9356427080-21">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="9356427080-22">[</span><span class="p" data-group-id="9356427080-23">{</span><span class="ss">start_time</span><span class="p">,</span><span class="p" data-group-id="9356427080-24">{</span><span class="p" data-group-id="9356427080-25">{</span><span class="mi">2024</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="9356427080-25">}</span><span class="p">,</span><span class="p" data-group-id="9356427080-26">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">13</span><span class="p" data-group-id="9356427080-26">}</span><span class="p" data-group-id="9356427080-24">}</span><span class="p" data-group-id="9356427080-23">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="9356427080-27">{</span><span class="ss">current_time</span><span class="p">,</span><span class="p" data-group-id="9356427080-28">{</span><span class="p" data-group-id="9356427080-29">{</span><span class="mi">2024</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p" data-group-id="9356427080-29">}</span><span class="p">,</span><span class="p" data-group-id="9356427080-30">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">49</span><span class="p" data-group-id="9356427080-30">}</span><span class="p" data-group-id="9356427080-28">}</span><span class="p" data-group-id="9356427080-27">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="9356427080-31">{</span><span class="ss">reductions</span><span class="p">,</span><span class="mi">202</span><span class="p" data-group-id="9356427080-31">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="9356427080-32">{</span><span class="ss">messages_in</span><span class="p">,</span><span class="mi">2</span><span class="p" data-group-id="9356427080-32">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="9356427080-33">{</span><span class="ss">messages_out</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="9356427080-33">}</span><span class="p" data-group-id="9356427080-22">]</span><span class="p" data-group-id="9356427080-21">}</span><span class="gp unselectable">
7&gt; </span><span class="nc">sys</span><span class="p">:</span><span class="nf">statistics</span><span class="p" data-group-id="9356427080-34">(</span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9356427080-34">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
8&gt; </span><span class="nc">sys</span><span class="p">:</span><span class="nf">trace</span><span class="p" data-group-id="9356427080-35">(</span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9356427080-35">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
9&gt; </span><span class="nc">sys</span><span class="p">:</span><span class="nf">get_status</span><span class="p" data-group-id="9356427080-36">(</span><span class="ss">ch4</span><span class="p" data-group-id="9356427080-36">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9356427080-37">{</span><span class="ss">status</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.90</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9356427080-38">{</span><span class="ss">module</span><span class="p">,</span><span class="ss">ch4</span><span class="p" data-group-id="9356427080-38">}</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9356427080-39">[</span><span class="p" data-group-id="9356427080-40">[</span><span class="p" data-group-id="9356427080-41">{</span><span class="ss">&#39;$initial_call&#39;</span><span class="p">,</span><span class="p" data-group-id="9356427080-42">{</span><span class="ss">ch4</span><span class="p">,</span><span class="ss">init</span><span class="p">,</span><span class="mi">1</span><span class="p" data-group-id="9356427080-42">}</span><span class="p" data-group-id="9356427080-41">}</span><span class="p">,</span><span class="w">
          </span><span class="p" data-group-id="9356427080-43">{</span><span class="ss">&#39;$ancestors&#39;</span><span class="p">,</span><span class="p" data-group-id="9356427080-44">[</span><span class="o">&lt;</span><span class="mf">0.88</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.87</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.70</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.65</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.69</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
                         </span><span class="o">&lt;</span><span class="mf">0.64</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="ss">kernel_sup</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.47</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="9356427080-44">]</span><span class="p" data-group-id="9356427080-43">}</span><span class="p" data-group-id="9356427080-40">]</span><span class="p">,</span><span class="w">
         </span><span class="ss">running</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.88</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="p" data-group-id="9356427080-45">[</span><span class="p" data-group-id="9356427080-45">]</span><span class="p">,</span><span class="w">
         </span><span class="p" data-group-id="9356427080-46">{</span><span class="p" data-group-id="9356427080-47">[</span><span class="mi">1</span><span class="p" data-group-id="9356427080-47">]</span><span class="p">,</span><span class="p" data-group-id="9356427080-48">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">|</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="9356427080-48">]</span><span class="p" data-group-id="9356427080-46">}</span><span class="p" data-group-id="9356427080-39">]</span><span class="p" data-group-id="9356427080-37">}</span></code></pre><h3 id="starting-the-process" class="section-heading"><a href="#starting-the-process" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Starting the Process</span></h3><p>A function in the <a href="../apps/stdlib/proc_lib.html"><code class="inline">proc_lib</code></a> module is to be used to start the process. Several
functions are available, for example,
<a href="../apps/stdlib/proc_lib.html#spawn_link/4"><code class="inline">proc_lib:spawn_link/3,4</code></a>
for asynchronous start and
<a href="../apps/stdlib/proc_lib.html#start_link/5"><code class="inline">proc_lib:start_link/3,4,5</code></a> for synchronous start.</p><p>Information necessary for a process within a supervision tree, such as
details on ancestors and the initial call, is stored when a process
is started through one of these functions.</p><p>If the process terminates with a reason other than <code class="inline">normal</code> or <code class="inline">shutdown</code>, a
crash report is generated. For more information about the crash report, see
<a href="../apps/kernel/logger_chapter.html">Logging</a> in Kernel User's Guide.</p><p>In the example, synchronous start is used. The process starts by calling
<code class="inline">ch4:start_link()</code>:</p><pre><code class="makeup erlang" translate="no"><span class="nf">start_link</span><span class="p" data-group-id="1508290783-1">(</span><span class="p" data-group-id="1508290783-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">proc_lib</span><span class="p">:</span><span class="nf">start_link</span><span class="p" data-group-id="1508290783-2">(</span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="ss">init</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1508290783-3">[</span><span class="nf">self</span><span class="p" data-group-id="1508290783-4">(</span><span class="p" data-group-id="1508290783-4">)</span><span class="p" data-group-id="1508290783-3">]</span><span class="p" data-group-id="1508290783-2">)</span><span class="p">.</span></code></pre><p><code class="inline">ch4:start_link/0</code> calls <a href="../apps/stdlib/proc_lib.html#start_link/3"><code class="inline">proc_lib:start_link/3</code></a>, which takes a module
name, a function name, and an argument list as arguments. It then
spawns a new process and establishes a link. The new process starts
by executing the given function, here <code class="inline">ch4:init(Pid)</code>, where <code class="inline">Pid</code> is
the pid of the parent process (obtained by the call to
<a href="../apps/erts/erlang.html#self/0"><code class="inline">self()</code></a> in the call to <a href="../apps/stdlib/proc_lib.html#start_link/3"><code class="inline">proc_lib:start_link/3</code></a>).</p><p>All initialization, including name registration, is done in <code class="inline">init/1</code>. The new
process has to acknowledge that it has been started to the parent:</p><pre><code class="makeup erlang" translate="no"><span class="nf">init</span><span class="p" data-group-id="6198355561-1">(</span><span class="n">Parent</span><span class="p" data-group-id="6198355561-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
    </span><span class="nc">proc_lib</span><span class="p">:</span><span class="nf">init_ack</span><span class="p" data-group-id="6198355561-2">(</span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6198355561-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6198355561-4">(</span><span class="p" data-group-id="6198355561-4">)</span><span class="p" data-group-id="6198355561-3">}</span><span class="p" data-group-id="6198355561-2">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">loop</span><span class="p" data-group-id="6198355561-5">(</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="6198355561-5">)</span><span class="p">.</span></code></pre><p><a href="../apps/stdlib/proc_lib.html#start_link/3"><code class="inline">proc_lib:start_link/3</code></a> is synchronous and does not return until
<a href="../apps/stdlib/proc_lib.html#init_ack/2"><code class="inline">proc_lib:init_ack/1,2</code></a> or
<a href="../apps/stdlib/proc_lib.html#init_fail/3"><code class="inline">proc_lib:init_fail/2,3</code></a> has been called,
or the process has exited.</p><p><a href="" id="debug"></a></p><h3 id="debugging" class="section-heading"><a href="#debugging" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Debugging</span></h3><p>To support the debug facilities in <code class="inline">sys</code>, a <em>debug structure</em> is needed. The
<code class="inline">Deb</code> term is initialized using <a href="../apps/stdlib/sys.html#debug_options/1"><code class="inline">sys:debug_options/1</code></a>:</p><pre><code class="makeup erlang" translate="no"><span class="nf">init</span><span class="p" data-group-id="7160568900-1">(</span><span class="n">Parent</span><span class="p" data-group-id="7160568900-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
    </span><span class="n">Deb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">sys</span><span class="p">:</span><span class="nf">debug_options</span><span class="p" data-group-id="7160568900-2">(</span><span class="p" data-group-id="7160568900-3">[</span><span class="p" data-group-id="7160568900-3">]</span><span class="p" data-group-id="7160568900-2">)</span><span class="p">,</span><span class="w">
    </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
    </span><span class="nf">loop</span><span class="p" data-group-id="7160568900-4">(</span><span class="n">Chs</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Deb</span><span class="p" data-group-id="7160568900-4">)</span><span class="p">.</span></code></pre><p><a href="../apps/stdlib/sys.html#debug_options/1"><code class="inline">sys:debug_options/1</code></a> takes a list of options. Given an empty list as in this
example means that debugging is initially disabled. For information about the
possible options, see <a href="../apps/stdlib/sys.html"><code class="inline">sys</code></a> in STDLIB.</p><p>For each <em>system event</em> to be logged or traced, the following function
is to be called:</p><pre><code class="makeup erlang" translate="no"><span class="nc">sys</span><span class="p">:</span><span class="nf">handle_debug</span><span class="p" data-group-id="0209439535-1">(</span><span class="n">Deb</span><span class="p">,</span><span class="w"> </span><span class="n">Func</span><span class="p">,</span><span class="w"> </span><span class="n">Info</span><span class="p">,</span><span class="w"> </span><span class="n">Event</span><span class="p" data-group-id="0209439535-1">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="n">Deb1</span></code></pre><p>The arguments have the follow meaning:</p><ul><li><code class="inline">Deb</code> is the debug structure as returned from <a href="../apps/stdlib/sys.html#debug_options/1"><code class="inline">sys:debug_options/1</code></a>.</li><li><code class="inline">Func</code> is a fun specifying a (user-defined) function used to format trace
output. For each system event, the format function is called as
<code class="inline">Func(Dev, Event, Info)</code>, where:<ul><li><code class="inline">Dev</code> is the I/O device to which the output is to be printed. See <a href="../apps/stdlib/io.html"><code class="inline">io</code></a>
in STDLIB.</li><li><code class="inline">Event</code> and <code class="inline">Info</code> are passed as-is from the call to <a href="../apps/stdlib/sys.html#handle_debug/4"><code class="inline">sys:handle_debug/4</code></a>.</li></ul></li><li><code class="inline">Info</code> is used to pass more information to <code class="inline">Func</code>. It can be any term, and it
is passed as-is.</li><li><code class="inline">Event</code> is the system event. It is up to the user to define what a system
event is and how it is to be represented. Typically, at least incoming and
outgoing messages are considered system events and represented by the tuples
<code class="inline">{in,Msg[,From]}</code> and <code class="inline">{out,Msg,To[,State]}</code>, respectively.</li></ul><p><a href="../apps/stdlib/sys.html#handle_debug/4"><code class="inline">sys:handle_debug/4</code></a> returns an updated debug structure <code class="inline">Deb1</code>.</p><p>In the example, <a href="../apps/stdlib/sys.html#handle_debug/4"><code class="inline">sys:handle_debug/4</code></a> is called for each incoming and
outgoing message. The format function <code class="inline">Func</code> is the function
<code class="inline">ch4:write_debug/3</code>, which prints the message using <a href="../apps/stdlib/io.html#format/3"><code class="inline">io:format/3</code></a>.</p><pre><code class="makeup erlang" translate="no"><span class="nf">loop</span><span class="p" data-group-id="3652928935-1">(</span><span class="n">Chs</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Deb</span><span class="p" data-group-id="3652928935-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="3652928935-2">{</span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="ss">alloc</span><span class="p" data-group-id="3652928935-2">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Deb2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">sys</span><span class="p">:</span><span class="nf">handle_debug</span><span class="p" data-group-id="3652928935-3">(</span><span class="n">Deb</span><span class="p">,</span><span class="w"> </span><span class="k">fun</span><span class="w"> </span><span class="nc">ch4</span><span class="p">:</span><span class="ss">write_debug</span><span class="p">/</span><span class="mi">3</span><span class="p">,</span><span class="w">
                                    </span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3652928935-4">{</span><span class="ss">in</span><span class="p">,</span><span class="w"> </span><span class="ss">alloc</span><span class="p">,</span><span class="w"> </span><span class="n">From</span><span class="p" data-group-id="3652928935-4">}</span><span class="p" data-group-id="3652928935-3">)</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="3652928935-5">{</span><span class="n">Ch</span><span class="p">,</span><span class="w"> </span><span class="n">Chs2</span><span class="p" data-group-id="3652928935-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">alloc</span><span class="p" data-group-id="3652928935-6">(</span><span class="n">Chs</span><span class="p" data-group-id="3652928935-6">)</span><span class="p">,</span><span class="w">
            </span><span class="n">From</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="3652928935-7">{</span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="n">Ch</span><span class="p" data-group-id="3652928935-7">}</span><span class="p">,</span><span class="w">
            </span><span class="n">Deb3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">sys</span><span class="p">:</span><span class="nf">handle_debug</span><span class="p" data-group-id="3652928935-8">(</span><span class="n">Deb2</span><span class="p">,</span><span class="w"> </span><span class="k">fun</span><span class="w"> </span><span class="nc">ch4</span><span class="p">:</span><span class="ss">write_debug</span><span class="p">/</span><span class="mi">3</span><span class="p">,</span><span class="w">
                                    </span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3652928935-9">{</span><span class="ss">out</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3652928935-10">{</span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="n">Ch</span><span class="p" data-group-id="3652928935-10">}</span><span class="p">,</span><span class="w"> </span><span class="n">From</span><span class="p" data-group-id="3652928935-9">}</span><span class="p" data-group-id="3652928935-8">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">loop</span><span class="p" data-group-id="3652928935-11">(</span><span class="n">Chs2</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Deb3</span><span class="p" data-group-id="3652928935-11">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="3652928935-12">{</span><span class="ss">free</span><span class="p">,</span><span class="w"> </span><span class="n">Ch</span><span class="p" data-group-id="3652928935-12">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Deb2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">sys</span><span class="p">:</span><span class="nf">handle_debug</span><span class="p" data-group-id="3652928935-13">(</span><span class="n">Deb</span><span class="p">,</span><span class="w"> </span><span class="k">fun</span><span class="w"> </span><span class="nc">ch4</span><span class="p">:</span><span class="ss">write_debug</span><span class="p">/</span><span class="mi">3</span><span class="p">,</span><span class="w">
                                    </span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3652928935-14">{</span><span class="ss">in</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3652928935-15">{</span><span class="ss">free</span><span class="p">,</span><span class="w"> </span><span class="n">Ch</span><span class="p" data-group-id="3652928935-15">}</span><span class="p" data-group-id="3652928935-14">}</span><span class="p" data-group-id="3652928935-13">)</span><span class="p">,</span><span class="w">
            </span><span class="n">Chs2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">free</span><span class="p" data-group-id="3652928935-16">(</span><span class="n">Ch</span><span class="p">,</span><span class="w"> </span><span class="n">Chs</span><span class="p" data-group-id="3652928935-16">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">loop</span><span class="p" data-group-id="3652928935-17">(</span><span class="n">Chs2</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Deb2</span><span class="p" data-group-id="3652928935-17">)</span><span class="p">;</span><span class="w">
        </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="nf">write_debug</span><span class="p" data-group-id="3652928935-18">(</span><span class="n">Dev</span><span class="p">,</span><span class="w"> </span><span class="n">Event</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p" data-group-id="3652928935-18">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3652928935-19">(</span><span class="n">Dev</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="si">~p</span><span class="s"> event = </span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3652928935-20">[</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">Event</span><span class="p" data-group-id="3652928935-20">]</span><span class="p" data-group-id="3652928935-19">)</span><span class="p">.</span></code></pre><p><a href="" id="msg"></a></p><h3 id="handling-system-messages" class="section-heading"><a href="#handling-system-messages" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Handling System Messages</span></h3><p><em>System messages</em> are received as:</p><pre><code class="text">{system, From, Request}</code></pre><p>The content and meaning of these messages are not to be interpreted by the
process. Instead the following function is to be called:</p><pre><code class="makeup erlang" translate="no"><span class="nc">sys</span><span class="p">:</span><span class="nf">handle_system_msg</span><span class="p" data-group-id="2050823124-1">(</span><span class="n">Request</span><span class="p">,</span><span class="w"> </span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p">,</span><span class="w"> </span><span class="n">Deb</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p" data-group-id="2050823124-1">)</span></code></pre><p>The arguments have the following meaning:</p><ul><li><code class="inline">Request</code> and <code class="inline">From</code> from the received system message are to be
passed as-is to the call to <a href="../apps/stdlib/sys.html#handle_system_msg/6"><code class="inline">sys:handle_system_msg/6</code></a>.</li><li><code class="inline">Parent</code> is the pid of the parent process.</li><li><code class="inline">Module</code> is the name of the module implementing the speciall process.</li><li><code class="inline">Deb</code> is the debug structure.</li><li><code class="inline">State</code> is a term describing the internal state and is passed on to
<code class="inline">Module:system_continue/3</code>, <code class="inline">Module:system_terminate/4</code>/
<code class="inline">Module:system_get_state/1</code>, and <code class="inline">Module:system_replace_state/2</code>.</li></ul><p><a href="../apps/stdlib/sys.html#handle_system_msg/6"><code class="inline">sys:handle_system_msg/6</code></a> does not return. It handles the system
message and <em>eventually</em> calls either of the following functions:</p><ul><li><p><code class="inline">Module:system_continue(Parent, Deb, State)</code> - if process execution is to
continue.</p></li><li><p><code class="inline">Module:system_terminate(Reason, Parent, Deb, State)</code> - if the
process is to terminate.</p></li></ul><p>While handling the system message, <a href="../apps/stdlib/sys.html#handle_system_msg/6"><code class="inline">sys:handle_system_msg/6</code></a> can call
one of the following functions:</p><ul><li><p><code class="inline">Module:system_get_state(State)</code> - if the process is to return its state.</p></li><li><p><code class="inline">Module:system_replace_state(StateFun, State)</code> - if the process is
to replace its state using the fun <code class="inline">StateFun</code> fun. See <a href="../apps/stdlib/sys.html#replace_state/3"><code class="inline">sys:replace_state/3</code></a>
for more information.</p></li><li><p><code class="inline">system_code_change(Misc, Module, OldVsn, Extra)</code> - if the process is to
perform a code change.</p></li></ul><p>A process in a supervision tree is expected to terminate with the same reason as
its parent.</p><p>In the example, system messages are handed by the following code:</p><pre><code class="makeup erlang" translate="no"><span class="nf">loop</span><span class="p" data-group-id="1644050293-1">(</span><span class="n">Chs</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Deb</span><span class="p" data-group-id="1644050293-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">

        </span><span class="p" data-group-id="1644050293-2">{</span><span class="ss">system</span><span class="p">,</span><span class="w"> </span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="n">Request</span><span class="p" data-group-id="1644050293-2">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">sys</span><span class="p">:</span><span class="nf">handle_system_msg</span><span class="p" data-group-id="1644050293-3">(</span><span class="n">Request</span><span class="p">,</span><span class="w"> </span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w">
                                  </span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="n">Deb</span><span class="p">,</span><span class="w"> </span><span class="n">Chs</span><span class="p" data-group-id="1644050293-3">)</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="nf">system_continue</span><span class="p" data-group-id="1644050293-4">(</span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Deb</span><span class="p">,</span><span class="w"> </span><span class="n">Chs</span><span class="p" data-group-id="1644050293-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">loop</span><span class="p" data-group-id="1644050293-5">(</span><span class="n">Chs</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Deb</span><span class="p" data-group-id="1644050293-5">)</span><span class="p">.</span><span class="w">

</span><span class="nf">system_terminate</span><span class="p" data-group-id="1644050293-6">(</span><span class="n">Reason</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Deb</span><span class="p">,</span><span class="w"> </span><span class="n">Chs</span><span class="p" data-group-id="1644050293-6">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">exit</span><span class="p" data-group-id="1644050293-7">(</span><span class="n">Reason</span><span class="p" data-group-id="1644050293-7">)</span><span class="p">.</span><span class="w">

</span><span class="nf">system_get_state</span><span class="p" data-group-id="1644050293-8">(</span><span class="n">Chs</span><span class="p" data-group-id="1644050293-8">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1644050293-9">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Chs</span><span class="p">,</span><span class="w"> </span><span class="n">Chs</span><span class="p" data-group-id="1644050293-9">}</span><span class="p">.</span><span class="w">

</span><span class="nf">system_replace_state</span><span class="p" data-group-id="1644050293-10">(</span><span class="n">StateFun</span><span class="p">,</span><span class="w"> </span><span class="n">Chs</span><span class="p" data-group-id="1644050293-10">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">NChs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StateFun</span><span class="p" data-group-id="1644050293-11">(</span><span class="n">Chs</span><span class="p" data-group-id="1644050293-11">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1644050293-12">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">NChs</span><span class="p">,</span><span class="w"> </span><span class="n">NChs</span><span class="p" data-group-id="1644050293-12">}</span><span class="p">.</span></code></pre><p>If a special process is configured to trap exits, it must take notice
of 'EXIT' messages from its parent process and terminate using the
same exit reason once the parent process has terminated.</p><p>Here is an example:</p><pre><code class="makeup erlang" translate="no"><span class="nf">init</span><span class="p" data-group-id="4094475968-1">(</span><span class="n">Parent</span><span class="p" data-group-id="4094475968-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">,</span><span class="w">
    </span><span class="nf">process_flag</span><span class="p" data-group-id="4094475968-2">(</span><span class="ss">trap_exit</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4094475968-2">)</span><span class="p">,</span><span class="w">
    </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">,</span><span class="w">
    </span><span class="nf">loop</span><span class="p" data-group-id="4094475968-3">(</span><span class="n">Parent</span><span class="p" data-group-id="4094475968-3">)</span><span class="p">.</span><span class="w">

</span><span class="nf">loop</span><span class="p" data-group-id="4094475968-4">(</span><span class="n">Parent</span><span class="p" data-group-id="4094475968-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
        </span><span class="p" data-group-id="4094475968-5">{</span><span class="ss">&#39;EXIT&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Reason</span><span class="p" data-group-id="4094475968-5">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="c1">%% Clean up here, if needed.</span><span class="w">
            </span><span class="nf">exit</span><span class="p" data-group-id="4094475968-6">(</span><span class="n">Reason</span><span class="p" data-group-id="4094475968-6">)</span><span class="p">;</span><span class="w">
        </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span></code></pre><h2 id="user-defined-behaviours" class="section-heading"><a href="#user-defined-behaviours" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">User-Defined Behaviours</span></h2><p><a href="" id="behaviours"></a> To implement a user-defined behaviour, write code similar
to code for a special process, but call functions in a callback module for
handling specific tasks.</p><p>If the compiler is to warn for missing callback functions, as it does for the
OTP behaviours, add <code class="inline">-callback</code> attributes in the behaviour module to describe
the expected callbacks:</p><pre><code class="text">-callback Name1(Arg1_1, Arg1_2, ..., Arg1_N1) -&gt; Res1.
-callback Name2(Arg2_1, Arg2_2, ..., Arg2_N2) -&gt; Res2.
...
-callback NameM(ArgM_1, ArgM_2, ..., ArgM_NM) -&gt; ResM.</code></pre><p><code class="inline">NameX</code> are the names of the expected callbacks. <code class="inline">ArgX_Y</code> and <code class="inline">ResX</code> are types
as they are described in
<a href="../system/typespec.html">Types and Function Specifications</a>. The whole syntax of
the <code class="inline">-spec</code> attribute is supported by the <code class="inline">-callback</code> attribute.</p><p>Callback functions that are optional for the user of the behaviour to implement
are specified by use of the <code class="inline">-optional_callbacks</code> attribute:</p><pre><code class="text">-optional_callbacks([OptName1/OptArity1, ..., OptNameK/OptArityK]).</code></pre><p>where each <code class="inline">OptName/OptArity</code> specifies the name and arity of a callback
function. Note that the <code class="inline">-optional_callbacks</code> attribute is to be used together
with the <code class="inline">-callback</code> attribute; it cannot be combined with the
<code class="inline">behaviour_info()</code> function described below.</p><p>Tools that need to know about optional callback functions can call
<code class="inline">Behaviour:behaviour_info(optional_callbacks)</code> to get a list of all optional
callback functions.</p><section role="note" class="admonition info"><h4 class="admonition-title info">Note</h4><p>We recommend using the <code class="inline">-callback</code> attribute rather than the
<code class="inline">behaviour_info()</code> function. The reason is that the extra type information can
be used by tools to produce documentation or find discrepancies.</p></section><p>As an alternative to the <code class="inline">-callback</code> and <code class="inline">-optional_callbacks</code> attributes you
may directly implement and export <code class="inline">behaviour_info()</code>:</p><pre><code class="makeup erlang" translate="no"><span class="nf">behaviour_info</span><span class="p" data-group-id="9126076022-1">(</span><span class="ss">callbacks</span><span class="p" data-group-id="9126076022-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9126076022-2">[</span><span class="p" data-group-id="9126076022-3">{</span><span class="n">Name1</span><span class="p">,</span><span class="w"> </span><span class="n">Arity1</span><span class="p" data-group-id="9126076022-3">}</span><span class="p">,</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">,</span><span class="p" data-group-id="9126076022-4">{</span><span class="n">NameN</span><span class="p">,</span><span class="w"> </span><span class="n">ArityN</span><span class="p" data-group-id="9126076022-4">}</span><span class="p" data-group-id="9126076022-2">]</span><span class="p">.</span></code></pre><p>where each <code class="inline">{Name, Arity}</code> specifies the name and arity of a callback function.
This function is otherwise automatically generated by the compiler using the
<code class="inline">-callback</code> attributes.</p><p>When the compiler encounters the module attribute <code class="inline">-behaviour(Behaviour).</code> in a
module <code class="inline">Mod</code>, it calls <code class="inline">Behaviour:behaviour_info(callbacks)</code> and compares the
result with the set of functions actually exported from <code class="inline">Mod</code>, and issues a
warning if any callback function is missing.</p><p><em>Example:</em></p><pre><code class="makeup erlang" translate="no"><span class="c1">%% User-defined behaviour module</span><span class="w">
</span><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9905972072-1">(</span><span class="ss">simple_server</span><span class="p" data-group-id="9905972072-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9905972072-2">(</span><span class="p" data-group-id="9905972072-3">[</span><span class="ss">start_link</span><span class="p">/</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">init</span><span class="p">/</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="9905972072-3">]</span><span class="p" data-group-id="9905972072-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">callback</span><span class="w"> </span><span class="nf">init</span><span class="p" data-group-id="9905972072-4">(</span><span class="n">State</span><span class="w"> </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="9905972072-5">(</span><span class="p" data-group-id="9905972072-5">)</span><span class="p" data-group-id="9905972072-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">&#39;ok&#39;</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">callback</span><span class="w"> </span><span class="nf">handle_req</span><span class="p" data-group-id="9905972072-6">(</span><span class="n">Req</span><span class="w"> </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="9905972072-7">(</span><span class="p" data-group-id="9905972072-7">)</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="w"> </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="9905972072-8">(</span><span class="p" data-group-id="9905972072-8">)</span><span class="p" data-group-id="9905972072-6">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="9905972072-9">{</span><span class="ss">&#39;ok&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">Reply</span><span class="w"> </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="9905972072-10">(</span><span class="p" data-group-id="9905972072-10">)</span><span class="p" data-group-id="9905972072-9">}</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">callback</span><span class="w"> </span><span class="nf">terminate</span><span class="p" data-group-id="9905972072-11">(</span><span class="p" data-group-id="9905972072-11">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">&#39;ok&#39;</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">callback</span><span class="w"> </span><span class="nf">format_state</span><span class="p" data-group-id="9905972072-12">(</span><span class="n">State</span><span class="w"> </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="9905972072-13">(</span><span class="p" data-group-id="9905972072-13">)</span><span class="p" data-group-id="9905972072-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="9905972072-14">(</span><span class="p" data-group-id="9905972072-14">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">optional_callbacks</span><span class="p" data-group-id="9905972072-15">(</span><span class="p" data-group-id="9905972072-16">[</span><span class="ss">format_state</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="9905972072-16">]</span><span class="p" data-group-id="9905972072-15">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Alternatively you may define:</span><span class="w">
</span><span class="c1">%%</span><span class="w">
</span><span class="c1">%% -export([behaviour_info/1]).</span><span class="w">
</span><span class="c1">%% behaviour_info(callbacks) -&gt;</span><span class="w">
</span><span class="c1">%%     [{init,1},</span><span class="w">
</span><span class="c1">%%      {handle_req,2},</span><span class="w">
</span><span class="c1">%%      {terminate,0}].</span><span class="w">

</span><span class="nf">start_link</span><span class="p" data-group-id="9905972072-17">(</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p" data-group-id="9905972072-17">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">proc_lib</span><span class="p">:</span><span class="nf">start_link</span><span class="p" data-group-id="9905972072-18">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">init</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9905972072-19">[</span><span class="nf">self</span><span class="p" data-group-id="9905972072-20">(</span><span class="p" data-group-id="9905972072-20">)</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p" data-group-id="9905972072-19">]</span><span class="p" data-group-id="9905972072-18">)</span><span class="p">.</span><span class="w">

</span><span class="nf">init</span><span class="p" data-group-id="9905972072-21">(</span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p" data-group-id="9905972072-21">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9905972072-22">(</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9905972072-23">(</span><span class="p" data-group-id="9905972072-23">)</span><span class="p" data-group-id="9905972072-22">)</span><span class="p">,</span><span class="w">
    </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">,</span><span class="w">
    </span><span class="n">Dbg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">sys</span><span class="p">:</span><span class="nf">debug_options</span><span class="p" data-group-id="9905972072-24">(</span><span class="p" data-group-id="9905972072-25">[</span><span class="p" data-group-id="9905972072-25">]</span><span class="p" data-group-id="9905972072-24">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">proc_lib</span><span class="p">:</span><span class="nf">init_ack</span><span class="p" data-group-id="9905972072-26">(</span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9905972072-27">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9905972072-28">(</span><span class="p" data-group-id="9905972072-28">)</span><span class="p" data-group-id="9905972072-27">}</span><span class="p" data-group-id="9905972072-26">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">loop</span><span class="p" data-group-id="9905972072-29">(</span><span class="n">Parent</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p">,</span><span class="w"> </span><span class="n">Deb</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="9905972072-29">)</span><span class="p">.</span><span class="w">

</span><span class="p">.</span><span class="p">.</span><span class="p">.</span></code></pre><p>In a callback module:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="3891168408-1">(</span><span class="ss">db</span><span class="p" data-group-id="3891168408-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">behaviour</span><span class="p" data-group-id="3891168408-2">(</span><span class="ss">simple_server</span><span class="p" data-group-id="3891168408-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="3891168408-3">(</span><span class="p" data-group-id="3891168408-4">[</span><span class="ss">init</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">handle_req</span><span class="p">/</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">terminate</span><span class="p">/</span><span class="mi">0</span><span class="p" data-group-id="3891168408-4">]</span><span class="p" data-group-id="3891168408-3">)</span><span class="p">.</span><span class="w">

</span><span class="p">.</span><span class="p">.</span><span class="p">.</span></code></pre><p>The contracts specified with <code class="inline">-callback</code> attributes in behaviour modules can be
further refined by adding <code class="inline">-spec</code> attributes in callback modules. This can be
useful as <code class="inline">-callback</code> contracts are usually generic. The same callback module
with contracts for the callbacks:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="0352386193-1">(</span><span class="ss">db</span><span class="p" data-group-id="0352386193-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">behaviour</span><span class="p" data-group-id="0352386193-2">(</span><span class="ss">simple_server</span><span class="p" data-group-id="0352386193-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0352386193-3">(</span><span class="p" data-group-id="0352386193-4">[</span><span class="ss">init</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">handle_req</span><span class="p">/</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">terminate</span><span class="p">/</span><span class="mi">0</span><span class="p" data-group-id="0352386193-4">]</span><span class="p" data-group-id="0352386193-3">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="0352386193-5">(</span><span class="ss">state</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0352386193-6">{</span><span class="ss">field1</span><span class="w"> </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0352386193-7">[</span><span class="nf">atom</span><span class="p" data-group-id="0352386193-8">(</span><span class="p" data-group-id="0352386193-8">)</span><span class="p" data-group-id="0352386193-7">]</span><span class="p">,</span><span class="w"> </span><span class="ss">field2</span><span class="w"> </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="nf">integer</span><span class="p" data-group-id="0352386193-9">(</span><span class="p" data-group-id="0352386193-9">)</span><span class="p" data-group-id="0352386193-6">}</span><span class="p" data-group-id="0352386193-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">type</span><span class="w"> </span><span class="nf">state</span><span class="p" data-group-id="0352386193-10">(</span><span class="p" data-group-id="0352386193-10">)</span><span class="w">   </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="o">#</span><span class="ss">state</span><span class="p" data-group-id="0352386193-11">{</span><span class="p" data-group-id="0352386193-11">}</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">type</span><span class="w"> </span><span class="nf">request</span><span class="p" data-group-id="0352386193-12">(</span><span class="p" data-group-id="0352386193-12">)</span><span class="w"> </span><span class="p">:</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0352386193-13">{</span><span class="ss">&#39;store&#39;</span><span class="p">,</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="0352386193-14">(</span><span class="p" data-group-id="0352386193-14">)</span><span class="p">,</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="0352386193-15">(</span><span class="p" data-group-id="0352386193-15">)</span><span class="p" data-group-id="0352386193-13">}</span><span class="p">;</span><span class="w">
                   </span><span class="p" data-group-id="0352386193-16">{</span><span class="ss">&#39;lookup&#39;</span><span class="p">,</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="0352386193-17">(</span><span class="p" data-group-id="0352386193-17">)</span><span class="p" data-group-id="0352386193-16">}</span><span class="p">.</span><span class="w">

</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">spec</span><span class="w"> </span><span class="nf">handle_req</span><span class="p" data-group-id="0352386193-18">(</span><span class="nf">request</span><span class="p" data-group-id="0352386193-19">(</span><span class="p" data-group-id="0352386193-19">)</span><span class="p">,</span><span class="w"> </span><span class="nf">state</span><span class="p" data-group-id="0352386193-20">(</span><span class="p" data-group-id="0352386193-20">)</span><span class="p" data-group-id="0352386193-18">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="0352386193-21">{</span><span class="ss">&#39;ok&#39;</span><span class="p">,</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="0352386193-22">(</span><span class="p" data-group-id="0352386193-22">)</span><span class="p" data-group-id="0352386193-21">}</span><span class="p">.</span><span class="w">

</span><span class="p">.</span><span class="p">.</span><span class="p">.</span></code></pre><p>Each <code class="inline">-spec</code> contract is to be a subtype of the respective <code class="inline">-callback</code> contract.</p>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="sup_princ.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Supervisor Behaviour
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="applications.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Applications
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Erlang System Documentation.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright © 1996-2025 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js"></script>
  <script>
  let initialized = false;

  window.addEventListener("exdoc:loaded", () => {
      if (!initialized) {
      mermaid.initialize({
          startOnLoad: false,
          theme: document.body.className.includes("dark") ? "dark" : "default"
      });
      initialized = true;
      }

      let id = 0;
      for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
          graphEl.innerHTML = svg;
          bindFunctions?.(graphEl);
          preEl.insertAdjacentElement("afterend", graphEl);
          preEl.remove();
      });
      }
  });
  </script>

  </body>
</html>
