<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:erl="http://erlang.org" xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../otp_doc.css" type="text/css">
<title>Erlang -- Ports and Port Drivers</title>
</head>
<body>
<div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../js/erlresolvelinks.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function getWinHeight() {
                var myHeight = 0;
                if( typeof( window.innerHeight ) == 'number' ) {
                  //Non-IE
                  myHeight = window.innerHeight;
                } else if( document.documentElement && ( document.documentElement.clientWidth ||
                                                         document.documentElement.clientHeight ) ) {
                  //IE 6+ in 'standards compliant mode'
                  myHeight = document.documentElement.clientHeight;
                } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
                  //IE 4 compatible
                  myHeight = document.body.clientHeight;
                }
                return myHeight;
              }

              function setscrollpos() {
                var objf=document.getElementById('loadscrollpos');
                 document.getElementById("leftnav").scrollTop = objf.offsetTop - getWinHeight()/2;
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //--></script><div id="leftnav"><div class="innertube">
<div class="erlang-logo-wrapper"><a href="../index.html"><img alt="Erlang Logo" src="../erlang-logo.png" class="erlang-logo"></a></div>
<p class="section-title">Erlang Reference Manual</p>
<p class="section-subtitle">User's Guide</p>
<p class="section-version">Version 9.3</p>
<ul class="panel-sections">
<li><a href="users_guide.html">User's Guide</a></li>
<li><a href="../pdf/otp-system-documentation.pdf">PDF</a></li>
<li><a href="../index.html">Top</a></li>
</ul>
<ul class="expand-collapse-items">
<li><a href="javascript:openAllFlips()">Expand All</a></li>
<li><a href="javascript:closeAllFlips()">Contract All</a></li>
</ul>
<h3>Chapters</h3>
<ul class="flipMenu" imagePath="../js/flipmenu">
<li id="no" title="Introduction" expanded="false">Introduction<ul>
<li><a href="introduction.html">
              Top of chapter
            </a></li>
<li title="Purpose"><a href="introduction.html#id60622">Purpose</a></li>
<li title="Prerequisites"><a href="introduction.html#id58472">Prerequisites</a></li>
<li title="Document Conventions"><a href="introduction.html#id63515">Document Conventions</a></li>
<li title="Complete List of BIFs"><a href="introduction.html#id62038">Complete List of BIFs</a></li>
<li title="Reserved Words"><a href="introduction.html#id63536">Reserved Words</a></li>
</ul>
</li>
<li id="no" title="Character Set and Source File Encoding" expanded="false">Character Set and Source File Encoding<ul>
<li><a href="character_set.html">
              Top of chapter
            </a></li>
<li title="Character Set"><a href="character_set.html#id62014">Character Set</a></li>
<li title="Source File Encoding"><a href="character_set.html#id60536">Source File Encoding</a></li>
</ul>
</li>
<li id="no" title="Data Types" expanded="false">Data Types<ul>
<li><a href="data_types.html">
              Top of chapter
            </a></li>
<li title="Terms"><a href="data_types.html#id67165">Terms</a></li>
<li title="Number"><a href="data_types.html#id70187">Number</a></li>
<li title="Atom"><a href="data_types.html#id66121">Atom</a></li>
<li title="Bit Strings and Binaries"><a href="data_types.html#id65566">Bit Strings and Binaries</a></li>
<li title="Reference"><a href="data_types.html#id69419">Reference</a></li>
<li title="Fun"><a href="data_types.html#id66389">Fun</a></li>
<li title="Port Identifier"><a href="data_types.html#id66434">Port Identifier</a></li>
<li title="Pid"><a href="data_types.html#id68255">Pid</a></li>
<li title="Tuple"><a href="data_types.html#id77368">Tuple</a></li>
<li title="Map"><a href="data_types.html#id77432">Map</a></li>
<li title="List"><a href="data_types.html#id77524">List</a></li>
<li title="String"><a href="data_types.html#id77669">String</a></li>
<li title="Record"><a href="data_types.html#id72067">Record</a></li>
<li title="Boolean"><a href="data_types.html#id72117">Boolean</a></li>
<li title="Escape Sequences"><a href="data_types.html#id72152">Escape Sequences</a></li>
<li title="Type Conversions"><a href="data_types.html#id77971">Type Conversions</a></li>
</ul>
</li>
<li id="no" title="Pattern Matching" expanded="false">Pattern Matching<ul>
<li><a href="patterns.html">
              Top of chapter
            </a></li>
<li title="Pattern Matching"><a href="patterns.html#id78108">Pattern Matching</a></li>
</ul>
</li>
<li id="no" title="Modules" expanded="false">Modules<ul>
<li><a href="modules.html">
              Top of chapter
            </a></li>
<li title="Module Syntax"><a href="modules.html#id78235">Module Syntax</a></li>
<li title="Module Attributes"><a href="modules.html#id78271">Module Attributes</a></li>
<li title="Comments"><a href="modules.html#id78752">Comments</a></li>
<li title="module_info/0 and module_info/1 functions"><a href="modules.html#id78765">module_info/0 and module_info/1 functions</a></li>
</ul>
</li>
<li id="no" title="Functions" expanded="false">Functions<ul>
<li><a href="functions.html">
              Top of chapter
            </a></li>
<li title="Function Declaration Syntax"><a href="functions.html#id79067">Function Declaration Syntax</a></li>
<li title="Function Evaluation"><a href="functions.html#id79183">Function Evaluation</a></li>
<li title="Tail recursion"><a href="functions.html#id79333">Tail recursion</a></li>
<li title="Built-In Functions (BIFs)"><a href="functions.html#id79368">Built-In Functions (BIFs)</a></li>
</ul>
</li>
<li id="no" title="Types and Function Specifications" expanded="false">Types and Function Specifications<ul>
<li><a href="typespec.html">
              Top of chapter
            </a></li>
<li title="The Erlang Type Language"><a href="typespec.html#id79489">The Erlang Type Language</a></li>
<li title="Types and their Syntax"><a href="typespec.html#id79546">Types and their Syntax</a></li>
<li title="Type Declarations of User-Defined Types"><a href="typespec.html#id80458">Type Declarations of User-Defined Types</a></li>
<li title="Type Information in Record Declarations"><a href="typespec.html#id80588">Type Information in Record Declarations</a></li>
<li title="Specifications for Functions"><a href="typespec.html#id80676">Specifications for Functions</a></li>
</ul>
</li>
<li id="no" title="Expressions" expanded="false">Expressions<ul>
<li><a href="expressions.html">
              Top of chapter
            </a></li>
<li title="Expression Evaluation"><a href="expressions.html#id80929">Expression Evaluation</a></li>
<li title="Terms"><a href="expressions.html#id80972">Terms</a></li>
<li title="Variables"><a href="expressions.html#id80984">Variables</a></li>
<li title="Patterns"><a href="expressions.html#id81135">Patterns</a></li>
<li title="Match"><a href="expressions.html#id81278">Match</a></li>
<li title="Function Calls"><a href="expressions.html#id81341">Function Calls</a></li>
<li title="If"><a href="expressions.html#id81562">If</a></li>
<li title="Case"><a href="expressions.html#id81627">Case</a></li>
<li title="Send"><a href="expressions.html#id81693">Send</a></li>
<li title="Receive"><a href="expressions.html#id81776">Receive</a></li>
<li title="Term Comparisons"><a href="expressions.html#id81948">Term Comparisons</a></li>
<li title="Arithmetic Expressions"><a href="expressions.html#id82231">Arithmetic Expressions</a></li>
<li title="Boolean Expressions"><a href="expressions.html#id82738">Boolean Expressions</a></li>
<li title="Short-Circuit Expressions"><a href="expressions.html#id82894">Short-Circuit Expressions</a></li>
<li title="List Operations"><a href="expressions.html#id83040">List Operations</a></li>
<li title="Map Expressions"><a href="expressions.html#id83109">Map Expressions</a></li>
<li title="Bit Syntax Expressions"><a href="expressions.html#id83725">Bit Syntax Expressions</a></li>
<li title="Fun Expressions"><a href="expressions.html#id84308">Fun Expressions</a></li>
<li title="Catch and Throw"><a href="expressions.html#id84473">Catch and Throw</a></li>
<li title="Try"><a href="expressions.html#id84633">Try</a></li>
<li title="Parenthesized Expressions"><a href="expressions.html#id85007">Parenthesized Expressions</a></li>
<li title="Block Expressions"><a href="expressions.html#id85040">Block Expressions</a></li>
<li title="List Comprehensions"><a href="expressions.html#id85065">List Comprehensions</a></li>
<li title="Bit String Comprehensions"><a href="expressions.html#id85231">Bit String Comprehensions</a></li>
<li title="Guard Sequences"><a href="expressions.html#id85367">Guard Sequences</a></li>
<li title="Operator Precedence"><a href="expressions.html#id85932">Operator Precedence</a></li>
</ul>
</li>
<li id="no" title="Preprocessor" expanded="false">Preprocessor<ul>
<li><a href="macros.html">
              Top of chapter
            </a></li>
<li title="File Inclusion"><a href="macros.html#id86259">File Inclusion</a></li>
<li title="Defining and Using Macros"><a href="macros.html#id86419">Defining and Using Macros</a></li>
<li title="Predefined Macros"><a href="macros.html#id86552">Predefined Macros</a></li>
<li title="Macros Overloading"><a href="macros.html#id86637">Macros Overloading</a></li>
<li title="Flow Control in Macros"><a href="macros.html#id86706">Flow Control in Macros</a></li>
<li title="-error() and -warning() directives"><a href="macros.html#id86845">-error() and -warning() directives</a></li>
<li title="Stringifying Macro Arguments"><a href="macros.html#id86926">Stringifying Macro Arguments</a></li>
</ul>
</li>
<li id="no" title="Records" expanded="false">Records<ul>
<li><a href="records.html">
              Top of chapter
            </a></li>
<li title="Defining Records"><a href="records.html#id87051">Defining Records</a></li>
<li title="Creating Records"><a href="records.html#id87082">Creating Records</a></li>
<li title="Accessing Record Fields"><a href="records.html#id87140">Accessing Record Fields</a></li>
<li title="Updating Records"><a href="records.html#id87181">Updating Records</a></li>
<li title="Records in Guards"><a href="records.html#id87213">Records in Guards</a></li>
<li title="Records in Patterns"><a href="records.html#id87255">Records in Patterns</a></li>
<li title="Nested Records"><a href="records.html#id87282">Nested Records</a></li>
<li title="Internal Representation of Records"><a href="records.html#id87317">Internal Representation of Records</a></li>
</ul>
</li>
<li id="no" title="Errors and Error Handling" expanded="false">Errors and Error Handling<ul>
<li><a href="errors.html">
              Top of chapter
            </a></li>
<li title="Terminology"><a href="errors.html#id87440">Terminology</a></li>
<li title="Exceptions"><a href="errors.html#id87568">Exceptions</a></li>
<li title="Handling of Run-time Errors in Erlang"><a href="errors.html#id87744">Handling of Run-time Errors in Erlang</a></li>
<li title="Exit Reasons"><a href="errors.html#id87812">Exit Reasons</a></li>
</ul>
</li>
<li id="no" title="Processes" expanded="false">Processes<ul>
<li><a href="processes.html">
              Top of chapter
            </a></li>
<li title="Processes"><a href="processes.html#id88292">Processes</a></li>
<li title="Process Creation"><a href="processes.html#id88304">Process Creation</a></li>
<li title="Registered Processes"><a href="processes.html#id88354">Registered Processes</a></li>
<li title="Process Termination"><a href="processes.html#id88487">Process Termination</a></li>
<li title="Message Sending"><a href="processes.html#id88583">Message Sending</a></li>
<li title="Links"><a href="processes.html#id88612">Links</a></li>
<li title="Error Handling"><a href="processes.html#id88677">Error Handling</a></li>
<li title="Monitors"><a href="processes.html#id88793">Monitors</a></li>
<li title="Process Dictionary"><a href="processes.html#id88885">Process Dictionary</a></li>
</ul>
</li>
<li id="no" title="Distributed Erlang" expanded="false">Distributed Erlang<ul>
<li><a href="distributed.html">
              Top of chapter
            </a></li>
<li title="Distributed Erlang System"><a href="distributed.html#id88952">Distributed Erlang System</a></li>
<li title="Nodes"><a href="distributed.html#id89009">Nodes</a></li>
<li title="Node Connections"><a href="distributed.html#id89084">Node Connections</a></li>
<li title="epmd"><a href="distributed.html#id89135">epmd</a></li>
<li title="Hidden Nodes"><a href="distributed.html#id89158">Hidden Nodes</a></li>
<li title="C Nodes"><a href="distributed.html#id89204">C Nodes</a></li>
<li title="Security"><a href="distributed.html#id89236">Security</a></li>
<li title="Distribution BIFs"><a href="distributed.html#id89347">Distribution BIFs</a></li>
<li title="Distribution Command-Line Flags"><a href="distributed.html#id89670">Distribution Command-Line Flags</a></li>
<li title="Distribution Modules"><a href="distributed.html#id89832">Distribution Modules</a></li>
</ul>
</li>
<li id="no" title="Compilation and Code Loading" expanded="false">Compilation and Code Loading<ul>
<li><a href="code_loading.html">
              Top of chapter
            </a></li>
<li title="Compilation"><a href="code_loading.html#id90080">Compilation</a></li>
<li title="Code Loading"><a href="code_loading.html#id90200">Code Loading</a></li>
<li title="Code Replacement"><a href="code_loading.html#id90252">Code Replacement</a></li>
<li title="Running a Function When a Module is Loaded"><a href="code_loading.html#id90331">Running a Function When a Module is Loaded</a></li>
</ul>
</li>
<li id="loadscrollpos" title="Ports and Port Drivers" expanded="true">Ports and Port Drivers<ul>
<li><a href="ports.html">
              Top of chapter
            </a></li>
<li title="Ports"><a href="ports.html#id90509">Ports</a></li>
<li title="Port Drivers"><a href="ports.html#id90544">Port Drivers</a></li>
<li title="Port BIFs"><a href="ports.html#id90591">Port BIFs</a></li>
</ul>
</li>
</ul>
</div></div>
<div id="content">
<div class="innertube">
<h1>15 Ports and Port Drivers</h1>
  
  <p>Examples of how to use ports and port drivers are provided in
    <span class="bold_code bc-13"><a href="../tutorial/introduction.html#interoperability%20tutorial">Interoperability Tutorial</a></span>.
    For information about the BIFs mentioned, see the
    <span class="bold_code bc-18"><a href="../man/erlang.html">erlang(3)</a></span> manual
    page in ERTS.</p>

  <h3><a name="id90509">15.1 
        Ports</a></h3>
    
    <p><strong>Ports</strong> provide the basic mechanism for communication
      with the external world, from Erlang's point of view. They
      provide a byte-oriented interface to an external program. When a
      port has been created, Erlang can communicate with it by sending
      and receiving lists of bytes, including binaries.</p>
    <p>The Erlang process creating a port is said to be
      the <strong>port owner</strong>, or the <strong>connected process</strong> of
      the port. All communication to and from the port must go through
      the port owner. If the port owner terminates, so does the port
      (and the external program, if it is written correctly).</p>
    <p>The external program resides in another OS process. By default,
      it reads from standard input (file descriptor 0) and writes
      to standard output (file descriptor 1). The external program
      is to terminate when the port is closed.</p>
  

  <h3><a name="id90544">15.2 
        Port Drivers</a></h3>
    
    <p>It is possible to write a driver in C according to certain
      principles and dynamically link it to the Erlang runtime system.
      The linked-in driver looks like a port from the Erlang
      programmer's point of view and is called a <strong>port driver</strong>.</p>
    <div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
      <p>An erroneous port driver causes the entire Erlang runtime
        system to leak memory, hang or crash.</p>
    </p></div>
</div>
    <p>For information about port drivers, see the
      <span class="bold_code bc-18"><a href="../man/erl_driver.html">erl_driver(4)</a></span>
      manual page in ERTS,
      <span class="bold_code bc-18"><a href="../man/driver_entry.html">driver_entry(1)</a></span>
      manual page in ERTS, and
      <span class="bold_code bc-18"><a href="../man/erl_ddll.html">erl_ddll(3)</a></span>
      manual page in Kernel.</p>
  

  <h3><a name="id90591">15.3 
        Port BIFs</a></h3>
    
    <p>To create a port:</p>
    <div class="doc-table-wrapper">
<table class="doc-table"><tr>
        <td align="left" valign="middle"><span class="code">open_port(PortName, PortSettings</span></td>
        <td align="left" valign="middle">Returns a port identifier
        <span class="code">Port</span> as the result of opening a new Erlang port.
        Messages can be sent to, and received from, a port identifier,
        just like a pid. Port identifiers can also be linked to
        using <span class="code">link/1</span>, or registered under a name using
        <span class="code">register/2</span>.</td>
      </tr></table>
<p class="doc-table-caption">Table
        15.1:
         
        Port Creation BIF</p>
</div>
    <p><span class="code">PortName</span> is usually a tuple <span class="code">{spawn,Command}</span>, where
      the string <span class="code">Command</span> is the name of the external program.
      The external program runs outside the Erlang workspace, unless a
      port driver with the name <span class="code">Command</span> is found. If <span class="code">Command</span>
      is found, that driver is started.</p>
    <p><span class="code">PortSettings</span> is a list of settings (options) for the port.
      The list typically contains at least a tuple <span class="code">{packet,N}</span>,
      which specifies that data sent between the port and the external
      program are preceded by an N-byte length indicator. Valid values
      for N are 1, 2, or 4. If binaries are to be used instead of lists
      of bytes, the option <span class="code">binary</span> must be included.</p>
    <p>The port owner <span class="code">Pid</span> can communicate with the port
      <span class="code">Port</span> by sending and receiving messages. (In fact, any
      process can send the messages to the port, but the port owner must
      be identified in the message).</p>
    <p>As of Erlang/OTP R16, messages sent to ports are delivered truly
      asynchronously. The underlying implementation previously
      delivered messages to ports synchronously. Message passing has
      however always been documented as an asynchronous operation. Hence,
      this is not to be an issue for an Erlang program communicating
      with ports, unless false assumptions about ports have been made.</p>
    <p>In the following tables of examples, <span class="code">Data</span> must be an I/O list.
      An I/O list is a binary or a (possibly deep) list of binaries
      or integers in the range 0..255:</p>
    <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
        <td align="left" valign="middle"><strong>Message</strong></td>
        <td align="left" valign="middle"><strong>Description</strong></td>
      </tr>
<tr>
        <td align="left" valign="middle"><span class="code">{Pid,{command,Data}}</span></td>
        <td align="left" valign="middle">Sends <span class="code">Data</span> to the port.</td>
      </tr>
<tr>
        <td align="left" valign="middle"><span class="code">{Pid,close}</span></td>
        <td align="left" valign="middle">Closes the port. Unless the
        port is already closed, the port replies with
        <span class="code">{Port,closed}</span> when all buffers have been flushed
        and the port really closes.</td>
      </tr>
<tr>
        <td align="left" valign="middle"><span class="code">{Pid,{connect,NewPid}}</span></td>
        <td align="left" valign="middle">Sets the port owner of
        <span class="code">Port</span>to <span class="code">NewPid</span>. Unless the port is already closed,
        the port replies with<span class="code">{Port,connected}</span> to the old
        port owner. Note that the old port owner is still linked
        to the port, but the new port owner is not.</td>
      </tr>
</table>
<p class="doc-table-caption">Table
        15.2:
         
        Messages Sent To a Port</p>
</div>
    <p></p>
    <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
        <td align="left" valign="middle"><strong>Message</strong></td>
        <td align="left" valign="middle"><strong>Description</strong></td>
      </tr>
<tr>
        <td align="left" valign="middle"><span class="code">{Port,{data,Data}}</span></td>
        <td align="left" valign="middle">
<span class="code">Data</span> is received from the external program.</td>
      </tr>
<tr>
        <td align="left" valign="middle"><span class="code">{Port,closed}</span></td>
        <td align="left" valign="middle">Reply to <span class="code">Port ! {Pid,close}</span>.</td>
      </tr>
<tr>
        <td align="left" valign="middle"><span class="code">{Port,connected}</span></td>
        <td align="left" valign="middle">Reply to <span class="code">Port ! {Pid,{connect,NewPid}}</span>.</td>
      </tr>
<tr>
        <td align="left" valign="middle"><span class="code">{'EXIT',Port,Reason}</span></td>
        <td align="left" valign="middle">If the port has terminated for some reason.</td>
      </tr>
</table>
<p class="doc-table-caption">Table
        15.3:
         
        Messages Received From a Port</p>
</div>
    <p>Instead of sending and receiving messages, there are also a
      number of BIFs that can be used:</p>
    <div class="doc-table-wrapper">
<table class="doc-table">
<tr>
        <td align="left" valign="middle"><strong>Port BIF</strong></td>
        <td align="left" valign="middle"><strong>Description</strong></td>
      </tr>
<tr>
        <td align="left" valign="middle"><span class="code">port_command(Port,Data)</span></td>
        <td align="left" valign="middle">Sends <span class="code">Data</span> to the port.</td>
      </tr>
<tr>
        <td align="left" valign="middle"><span class="code">port_close(Port)</span></td>
        <td align="left" valign="middle">Closes the port.</td>
      </tr>
<tr>
        <td align="left" valign="middle"><span class="code">port_connect(Port,NewPid)</span></td>
        <td align="left" valign="middle">Sets the port owner of
        <span class="code">Port</span>to <span class="code">NewPid</span>. The old port owner <span class="code">Pid</span>
        stays linked to the port and must call <span class="code">unlink(Port)</span>
        if this is not desired.</td>
      </tr>
<tr>
        <td align="left" valign="middle"><span class="code">erlang:port_info(Port,Item)</span></td>
        <td align="left" valign="middle">Returns information as specified by <span class="code">Item</span>.</td>
      </tr>
<tr>
        <td align="left" valign="middle"><span class="code">erlang:ports()</span></td>
        <td align="left" valign="middle">Returns a list of all ports on the current node.</td>
      </tr>
</table>
<p class="doc-table-caption">Table
        15.4:
         
        Port BIFs</p>
</div>
    <p>Some additional BIFs that apply to port drivers:
      <span class="code">port_control/3</span> and <span class="code">erlang:port_call/3</span>.</p>
  
</div>
<div class="footer">
<hr>
<p>Copyright © 2003-2018 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script type="text/javascript">window.__otpTopDocDir = '../js/';</script><script type="text/javascript" src="../js/highlight.js"></script>
</body>
</html>
