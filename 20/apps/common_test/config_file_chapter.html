<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:erl="http://erlang.org" xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../../otp_doc.css" type="text/css">
<title>Erlang -- External Configuration Data</title>
</head>
<body>
<div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../../js/erlresolvelinks.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function getWinHeight() {
                var myHeight = 0;
                if( typeof( window.innerHeight ) == 'number' ) {
                  //Non-IE
                  myHeight = window.innerHeight;
                } else if( document.documentElement && ( document.documentElement.clientWidth ||
                                                         document.documentElement.clientHeight ) ) {
                  //IE 6+ in 'standards compliant mode'
                  myHeight = document.documentElement.clientHeight;
                } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
                  //IE 4 compatible
                  myHeight = document.body.clientHeight;
                }
                return myHeight;
              }

              function setscrollpos() {
                var objf=document.getElementById('loadscrollpos');
                 document.getElementById("leftnav").scrollTop = objf.offsetTop - getWinHeight()/2;
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //--></script><div id="leftnav"><div class="innertube">
<div class="erlang-logo-wrapper"><a href="../../index.html"><img alt="Erlang Logo" src="../../erlang-logo.png" class="erlang-logo"></a></div>
<p class="section-title">Common Test</p>
<p class="section-subtitle">User's Guide</p>
<p class="section-version">Version 1.15.4</p>
<ul class="panel-sections">
<li><a href="users_guide.html">User's Guide</a></li>
<li><a href="index.html">Reference Manual</a></li>
<li><a href="release_notes.html">Release Notes</a></li>
<li><a href="common_test.pdf">PDF</a></li>
<li><a href="../../index.html">Top</a></li>
</ul>
<ul class="expand-collapse-items">
<li><a href="javascript:openAllFlips()">Expand All</a></li>
<li><a href="javascript:closeAllFlips()">Contract All</a></li>
</ul>
<h3>Chapters</h3>
<ul class="flipMenu" imagePath="../../js/flipmenu">
<li id="no" title="Introduction" expanded="false">Introduction<ul>
<li><a href="introduction.html">
              Top of chapter
            </a></li>
<li title="Scope"><a href="introduction.html#id65461">Scope</a></li>
<li title="Prerequisites"><a href="introduction.html#id58060">Prerequisites</a></li>
</ul>
</li>
<li id="no" title="Common Test Basics" expanded="false">Common Test Basics<ul>
<li><a href="basics_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="basics_chapter.html#id65489">General</a></li>
<li title="Test Suite Organisation"><a href="basics_chapter.html#id71488">Test Suite Organisation</a></li>
<li title="Support Libraries"><a href="basics_chapter.html#id71478">Support Libraries</a></li>
<li title="Suites and Test Cases"><a href="basics_chapter.html#id64847">Suites and Test Cases</a></li>
<li title="External Interfaces"><a href="basics_chapter.html#id70820">External Interfaces</a></li>
</ul>
</li>
<li id="no" title="Getting Started" expanded="false">Getting Started<ul>
<li><a href="getting_started_chapter.html">
              Top of chapter
            </a></li>
<li title="Introduction for Newcomers"><a href="getting_started_chapter.html#id70026">Introduction for Newcomers</a></li>
<li title="Test Case Execution"><a href="getting_started_chapter.html#id76963">Test Case Execution</a></li>
<li title="A Simple Test Suite"><a href="getting_started_chapter.html#id62341">A Simple Test Suite</a></li>
<li title="A Test Suite with Configuration Functions"><a href="getting_started_chapter.html#id69748">A Test Suite with Configuration Functions</a></li>
<li title="Questions and Answers"><a href="getting_started_chapter.html#id66344">Questions and Answers</a></li>
</ul>
</li>
<li id="no" title="Installation" expanded="false">Installation<ul>
<li><a href="install_chapter.html">
              Top of chapter
            </a></li>
<li title="General Information"><a href="install_chapter.html#id65731">General Information</a></li>
</ul>
</li>
<li id="no" title="Writing Test Suites" expanded="false">Writing Test Suites<ul>
<li><a href="write_test_chapter.html">
              Top of chapter
            </a></li>
<li title="Support for Test Suite Authors"><a href="write_test_chapter.html#id65851">Support for Test Suite Authors</a></li>
<li title="Test Suites"><a href="write_test_chapter.html#id65915">Test Suites</a></li>
<li title="Init and End per Suite"><a href="write_test_chapter.html#id65965">Init and End per Suite</a></li>
<li title="Init and End per Test Case"><a href="write_test_chapter.html#id66114">Init and End per Test Case</a></li>
<li title="Test Cases"><a href="write_test_chapter.html#id76278">Test Cases</a></li>
<li title="Test Case Information Function"><a href="write_test_chapter.html#id76464">Test Case Information Function</a></li>
<li title="Test Suite Information Function"><a href="write_test_chapter.html#id76661">Test Suite Information Function</a></li>
<li title="Test Case Groups"><a href="write_test_chapter.html#id77838">Test Case Groups</a></li>
<li title="Parallel Property and Nested Groups"><a href="write_test_chapter.html#id78273">Parallel Property and Nested Groups</a></li>
<li title="Parallel Test Cases and I/O"><a href="write_test_chapter.html#id78310">Parallel Test Cases and I/O</a></li>
<li title="Repeated Groups"><a href="write_test_chapter.html#id78362">Repeated Groups</a></li>
<li title="Shuffled Test Case Order"><a href="write_test_chapter.html#id78516">Shuffled Test Case Order</a></li>
<li title="Group Information Function"><a href="write_test_chapter.html#id78582">Group Information Function</a></li>
<li title="Information Functions for Init- and End-Configuration"><a href="write_test_chapter.html#id78623">Information Functions for Init- and End-Configuration</a></li>
<li title="Data and Private Directories"><a href="write_test_chapter.html#id78698">Data and Private Directories</a></li>
<li title="Execution Environment"><a href="write_test_chapter.html#id78855">Execution Environment</a></li>
<li title="Timetrap Time-Outs"><a href="write_test_chapter.html#id78892">Timetrap Time-Outs</a></li>
<li title="Logging - Categories and Verbosity Levels"><a href="write_test_chapter.html#id79093">Logging - Categories and Verbosity Levels</a></li>
<li title="Illegal Dependencies"><a href="write_test_chapter.html#id79485">Illegal Dependencies</a></li>
</ul>
</li>
<li id="no" title="Test Structure" expanded="false">Test Structure<ul>
<li><a href="test_structure_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="test_structure_chapter.html#id79678">General</a></li>
<li title="Skipping Test Cases"><a href="test_structure_chapter.html#id79696">Skipping Test Cases</a></li>
<li title="Definition of Terms"><a href="test_structure_chapter.html#id79775">Definition of Terms</a></li>
</ul>
</li>
<li id="no" title="Examples and Templates" expanded="false">Examples and Templates<ul>
<li><a href="example_chapter.html">
              Top of chapter
            </a></li>
<li title="Test Suite Example"><a href="example_chapter.html#id80087">Test Suite Example</a></li>
<li title="Test Suite Templates"><a href="example_chapter.html#id80139">Test Suite Templates</a></li>
</ul>
</li>
<li id="no" title="Running Tests and Analyzing Results" expanded="false">Running Tests and Analyzing Results<ul>
<li><a href="run_test_chapter.html">
              Top of chapter
            </a></li>
<li title="Using the Common Test Framework"><a href="run_test_chapter.html#id80335">Using the Common Test Framework</a></li>
<li title="Automatic Compilation of Test Suites and Help Modules"><a href="run_test_chapter.html#id80378">Automatic Compilation of Test Suites and Help Modules</a></li>
<li title="Running Tests from the OS Command Line"><a href="run_test_chapter.html#id80571">Running Tests from the OS Command Line</a></li>
<li title="Running Tests from the Erlang Shell or from an Erlang Program"><a href="run_test_chapter.html#id81262">Running Tests from the Erlang Shell or from an Erlang Program</a></li>
<li title="Test Case Group Execution"><a href="run_test_chapter.html#id81439">Test Case Group Execution</a></li>
<li title="Running the Interactive Shell Mode"><a href="run_test_chapter.html#id81945">Running the Interactive Shell Mode</a></li>
<li title="Step-by-Step Execution of Test Cases with the Erlang Debugger"><a href="run_test_chapter.html#id82167">Step-by-Step Execution of Test Cases with the Erlang Debugger</a></li>
<li title="Test Specifications"><a href="run_test_chapter.html#id82296">Test Specifications</a></li>
<li title="Running Tests from the Web-Based GUI"><a href="run_test_chapter.html#id83281">Running Tests from the Web-Based GUI</a></li>
<li title="Log Files"><a href="run_test_chapter.html#id83392">Log Files</a></li>
<li title="HTML Style Sheets"><a href="run_test_chapter.html#id83906">HTML Style Sheets</a></li>
<li title="Repeating Tests"><a href="run_test_chapter.html#id84146">Repeating Tests</a></li>
<li title="Silent Connections"><a href="run_test_chapter.html#id84511">Silent Connections</a></li>
</ul>
</li>
<li id="loadscrollpos" title="External Configuration Data" expanded="true">External Configuration Data<ul>
<li><a href="config_file_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="config_file_chapter.html#id84747">General</a></li>
<li title="Syntax"><a href="config_file_chapter.html#id84791">Syntax</a></li>
<li title="Requiring and Reading Configuration Data"><a href="config_file_chapter.html#id84814">Requiring and Reading Configuration Data</a></li>
<li title="Using Configuration Variables Defined in Multiple Files"><a href="config_file_chapter.html#id84946">Using Configuration Variables Defined in Multiple Files</a></li>
<li title="Encrypted Configuration Files"><a href="config_file_chapter.html#id84971">Encrypted Configuration Files</a></li>
<li title="Opening Connections Using Configuration Data"><a href="config_file_chapter.html#id85034">Opening Connections Using Configuration Data</a></li>
<li title="User-Specific Configuration Data Formats"><a href="config_file_chapter.html#id85105">User-Specific Configuration Data Formats</a></li>
<li title="Examples of Configuration Data Handling"><a href="config_file_chapter.html#id85322">Examples of Configuration Data Handling</a></li>
<li title="Example of User-Specific Configuration Handler"><a href="config_file_chapter.html#id85377">Example of User-Specific Configuration Handler</a></li>
</ul>
</li>
<li id="no" title="Code Coverage Analysis" expanded="false">Code Coverage Analysis<ul>
<li><a href="cover_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="cover_chapter.html#id85504">General</a></li>
<li title="Use"><a href="cover_chapter.html#id85538">Use</a></li>
<li title="Stopping the Cover Tool When Tests Are Completed"><a href="cover_chapter.html#id85653">Stopping the Cover Tool When Tests Are Completed</a></li>
<li title="The Cover Specification File"><a href="cover_chapter.html#id85714">The Cover Specification File</a></li>
<li title="Cross Cover Analysis"><a href="cover_chapter.html#id85778">Cross Cover Analysis</a></li>
<li title="Logging"><a href="cover_chapter.html#id86005">Logging</a></li>
</ul>
</li>
<li id="no" title="Using Common Test for Large-Scale Testing" expanded="false">Using Common Test for Large-Scale Testing<ul>
<li><a href="ct_master_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="ct_master_chapter.html#id86093">General</a></li>
<li title="Use"><a href="ct_master_chapter.html#id86171">Use</a></li>
<li title="Test Specifications"><a href="ct_master_chapter.html#id86364">Test Specifications</a></li>
<li title="Automatic Startup of Test Target Nodes"><a href="ct_master_chapter.html#id86615">Automatic Startup of Test Target Nodes</a></li>
</ul>
</li>
<li id="no" title="Event Handling" expanded="false">Event Handling<ul>
<li><a href="event_handler_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="event_handler_chapter.html#id86825">General</a></li>
<li title="Use"><a href="event_handler_chapter.html#id86966">Use</a></li>
</ul>
</li>
<li id="no" title="Dependencies between Test Cases and Suites" expanded="false">Dependencies between Test Cases and Suites<ul>
<li><a href="dependencies_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="dependencies_chapter.html#id88085">General</a></li>
<li title="Saving Configuration Data"><a href="dependencies_chapter.html#id88222">Saving Configuration Data</a></li>
<li title="Sequences"><a href="dependencies_chapter.html#id88396">Sequences</a></li>
</ul>
</li>
<li id="no" title="Common Test Hooks" expanded="false">Common Test Hooks<ul>
<li><a href="ct_hooks_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="ct_hooks_chapter.html#id88602">General</a></li>
<li title="Installing a CTH"><a href="ct_hooks_chapter.html#id88662">Installing a CTH</a></li>
<li title="CTH Scope"><a href="ct_hooks_chapter.html#id88844">CTH Scope</a></li>
<li title="Manipulating Tests"><a href="ct_hooks_chapter.html#id89206">Manipulating Tests</a></li>
<li title="Synchronizing External User Applications with Common Test"><a href="ct_hooks_chapter.html#id89589">Synchronizing External User Applications with Common Test</a></li>
<li title="Example CTH"><a href="ct_hooks_chapter.html#id89666">Example CTH</a></li>
<li title="Built-In CTHs"><a href="ct_hooks_chapter.html#id89724">Built-In CTHs</a></li>
</ul>
</li>
<li id="no" title="Some Thoughts about Testing" expanded="false">Some Thoughts about Testing<ul>
<li><a href="why_test_chapter.html">
              Top of chapter
            </a></li>
<li title="Goals"><a href="why_test_chapter.html#id89916">Goals</a></li>
<li title="What to Test"><a href="why_test_chapter.html#id89935">What to Test</a></li>
</ul>
</li>
</ul>
</div></div>
<div id="content">
<div class="innertube">
<h1>9 External Configuration Data</h1>
  

    <a name="top"></a>

  <h3><a name="id84747">9.1 
        General</a></h3>
    

    <p>To avoid hard-coding data values related to the test and/or System
    Under Test (SUT) in the test suites, the data can instead be specified through
    configuration files or strings that <span class="code">Common Test</span> reads before
    the start of a test run. External configuration data makes it possible to
    change test properties without modifying the test suites
    using the data. Examples of configuration data follows:</p>

    <ul>
      <li>Addresses to the test plant or other instruments</li>
      <li>User login information</li>
      <li>Names of files needed by the test</li>
      <li>Names of programs to be executed during the test</li>
      <li>Any other variable needed by the test</li>
    </ul>

  

  <h3><a name="id84791">9.2 
        Syntax</a></h3>
    

    <p>A configuration file can contain any number of elements of the type:</p>
    <div class="example"><pre>
 {CfgVarName,Value}.</pre></div>

    <p>where</p>
    <div class="example"><pre>
 CfgVarName = atom()
 Value = term() | [{CfgVarName,Value}]</pre></div>

  

  <h3><a name="id84814">9.3 
        Requiring and Reading Configuration Data</a></h3>
    
    <a name="require_config_data"></a>

    <p>In a test suite, one must <strong>require</strong> that a configuration 
    variable (<span class="code">CfgVarName</span> in the previous definition) exists before
    attempting to read the associated value in a test case or configuration function.</p>

    <p><span class="code">require</span> is an assert statement, which can be part of the <span class="bold_code bc-15"><a href="write_test_chapter.html#suite">Test Suite Information Function</a></span> or
    <span class="bold_code bc-15"><a href="write_test_chapter.html#info_function">Test Case Information Function</a></span>. If the required variable is unavailable, the
    test is skipped (unless a default value has been specified, see section
    <span class="bold_code bc-15"><a href="write_test_chapter.html#info_function">Test Case Information Function</a></span> for details). Also, function
    <span class="bold_code bc-15"><a href="../../man/ct.html#require-1"><span class="code">ct:require/1/2</span></a></span> can be called 
    from a test case to check if a specific variable is available. The return 
    value from this function must be checked explicitly and appropriate 
    action be taken depending on the result (for example, to skip the test case
    if the variable in question does not exist).</p>

    <p>A <span class="code">require</span> statement in the test suite information case or test case 
    information-list is to look like
    <span class="code">{require,CfgVarName}</span> or <span class="code">{require,AliasName,CfgVarName}</span>.
    The arguments <span class="code">AliasName</span> and <span class="code">CfgVarName</span> are the same as the
    arguments to <span class="bold_code bc-15"><a href="../../man/ct.html#require-1"><span class="code">ct:require/1,2</span></a></span>. 
    <span class="code">AliasName</span> becomes an alias for the configuration variable,
    and can be used as reference to the configuration data value.
    The configuration variable can be associated with any
    number of alias names, but each name must be unique within
    the same test suite. The two main uses for alias names follows:</p>
    <ul>
      <li>To identify connections (described later).</li>
      <li>To help adapt configuration data to a test suite 
        (or test case) and improve readability.</li>
    </ul>
    <p>To read the value of a configuration variable, use function
    <span class="bold_code bc-15"><a href="../../man/ct.html#get_config-1"><span class="code">get_config/1,2,3</span></a></span>.
    </p>
    <p><strong>Example:</strong></p>
    <div class="example"><pre>
 suite() -&gt; 
     [{require, domain, 'CONN_SPEC_DNS_SUFFIX'}].

 ...

 testcase(Config) -&gt;
     Domain = ct:get_config(domain),
     ...</pre></div>      
  

  <h3><a name="id84946">9.4 
        Using Configuration Variables Defined in Multiple Files</a></h3>
  
    <p>If a configuration variable is defined in multiple files and you 
      want to access all possible values, use function
      <span class="bold_code bc-15"><a href="../../man/ct.html#get_config-3"><span class="code">ct:get_config/3</span></a></span>
      and specify <span class="code">all</span> in the options list. The values are then
      returned in a list and the order of the elements corresponds to the order 
      that the configuration files were specified at startup.</p>
  

  <h3><a name="id84971">9.5 
        Encrypted Configuration Files</a></h3>
    
    <a name="encrypted_config_files"></a>
      <p>Configuration files containing sensitive data can be encrypted 
      if they must be stored in open and shared directories.</p> 
       <p>To have <span class="code">Common Test</span> encrypt a
      specified file using function <span class="code">DES3</span> in application <span class="code">Crypto</span>,
      call <span class="bold_code bc-15"><a href="../../man/ct.html#encrypt_config_file-2"><span class="code">ct:encrypt_config_file/2,3</span></a></span>
      The encrypted file can then be used as a regular configuration file
      in combination with other encrypted files or normal text files. However, the 
      key for decrypting the configuration file must be provided when running the test.
      This can be done with flag/option <span class="code">decrypt_key</span> or
      <span class="code">decrypt_file</span>, or a key file in a predefined location.</p>
      
      <p><span class="code">Common Test</span> also provides decryption functions, 
      <span class="bold_code bc-15"><a href="../../man/ct.html#decrypt_config_file-2"><span class="code">ct:decrypt_config_file/2,3</span></a></span>, 
      for recreating the original text files.</p> 
  

  <h3><a name="id85034">9.6 
        Opening Connections Using Configuration Data</a></h3>
    
    <p>Two different methods for opening a connection using the support functions 
       in, for example, <span class="bold_code bc-19"><a href="../../man/ct_ssh.html"><span class="code">ct_ssh</span></a></span>, 
       <span class="bold_code bc-19"><a href="../../man/ct_ftp.html"><span class="code">ct_ftp</span></a></span>, and 
    <span class="bold_code bc-19"><a href="../../man/ct_telnet.html"><span class="code">ct_telnet</span></a></span> follows:</p>
    <ul>
      <li>Using a configuration target name (an alias) as reference.</li>
      <li>Using the configuration variable as reference.</li>
    </ul>    
    <p>When a target name is used for referencing the configuration data
      (that specifies the connection to be opened), the same name can be used 
      as connection identity in all subsequent calls related to the connection
      (also for closing it). Only one open connection per target name 
      is possible. If you attempt to open a new connection using a name
      already associated with an open connection, <span class="code">Common Test</span>
      returns the already existing handle so the previously opened connection
      is used. This feature makes it possible to
      call the function for opening a particular connection whenever 
      useful. An action like this does not necessarily open any new 
      connections unless it is required (which could be the case if, for example,
      the previous connection has been closed unexpectedly by the server).
      Using named connections also removes the need to pass handle references 
      around in the suite for these connections.
    </p>
    <p>When a configuration variable name is used as reference to the data
      specifying the connection, the handle returned as a result of opening
      the connection must be used in all subsequent calls (also for closing
      the connection). Repeated calls to the open function with the same
      variable name as reference results in multiple connections being opened. 
      This can be useful, for example, if a test case needs to open
      multiple connections to the same server on the target node (using the
      same configuration data for each connection).
    </p>
  

  <h3><a name="id85105">9.7 
        User-Specific Configuration Data Formats</a></h3>
    

    <p>The user can specify configuration data on a
      different format than key-value tuples in a text file, as described
      so far. The data can, for example, be read from any files, fetched from
      the web over HTTP, or requested from a user-specific process.
      To support this, <span class="code">Common Test</span> provides a callback module plugin
      mechanism to handle configuration data.</p>

    <h4>Default Callback Modules for Handling Configuration Data</h4>
      
      <p><span class="code">Common Test</span> includes default callback modules
	for handling configuration data specified in standard configuration files
	(described earlier) and in XML files as follows:</p>
      <ul>
        <li>
          <span class="code">ct_config_plain</span> - for reading configuration files with
          key-value tuples (standard format). This handler is used to
          parse configuration files if no user callback is specified.
        </li>
        <li>
          <span class="code">ct_config_xml</span> - for reading configuration data from XML
          files.
        </li>
      </ul>
    

    <h4>Using XML Configuration Files</h4>
      
      <p>An example of an XML configuration file follows:</p>
      <div class="example"><pre>
 
 &lt;config&gt;
    &lt;ftp_host&gt;
        &lt;ftp&gt;"targethost"&lt;/ftp&gt;
        &lt;username&gt;"tester"&lt;/username&gt;
        &lt;password&gt;"letmein"&lt;/password&gt;
    &lt;/ftp_host&gt;
    &lt;lm_directory&gt;"/test/loadmodules"&lt;/lm_directory&gt;
 &lt;/config&gt;</pre></div>

      <p>Once read, this file produces the same configuration
      variables as the following text file:</p>
      <div class="example"><pre>
 {ftp_host, [{ftp,"targethost"},
             {username,"tester"},
             {password,"letmein"}]}.

 {lm_directory, "/test/loadmodules"}.</pre></div>
    

    <h4>Implement a User-Specific Handler</h4>
      

      <p>The user-specific handler can be written to handle special
	configuration file formats. The parameter can be either file
	names or configuration strings (the empty list is valid).</p>

      <p>The callback module implementing the handler is responsible for
	checking the correctness of configuration strings.</p>

      <p>To validate the configuration strings, the callback module
	is to have function <span class="code">Callback:check_parameter/1</span> exported.</p>

       <p>The input argument is passed from <span class="code">Common Test</span>, as defined in the test
	specification, or specified as an option to <span class="code">ct_run</span> or <span class="code">ct:run_test</span>.</p>

      <p>The return value is to be any of the following values, indicating if the specified
	configuration parameter is valid:</p>
      <ul>
        <li>
          <span class="code">{ok, {file, FileName}}</span> - the parameter is a file name and
          the file exists.
        </li>
        <li>
          <span class="code">{ok, {config, ConfigString}}</span> - the parameter is a configuration string
          and it is correct.
        </li>
        <li>
          <span class="code">{error, {nofile, FileName}}</span> - there is no file with the specified
          name in the current directory.
        </li>
        <li>
          <span class="code">{error, {wrong_config, ConfigString}}</span> - the configuration string
          is wrong.
        </li>
      </ul>

      <p>The function <span class="code">Callback:read_config/1</span> is to be exported from the 
         callback module to read configuration data, initially before the tests
         start, or as a result of data being reloaded during test execution.
         The input argument is the same as for function <span class="code">check_parameter/1</span>.</p>

      <p>The return value is to be either of the following:</p>

      <ul>
        <li>
          <span class="code">{ok, Config}</span> - if the configuration variables are read successfully.
        </li>
        <li>
          <span class="code">{error, {Error, ErrorDetails}}</span> - if the callback module fails to
          proceed with the specified configuration parameters.
        </li>
      </ul>
      <p><span class="code">Config</span> is the proper Erlang key-value list, with possible
	key-value sublists as values, like the earlier configuration file
	example:</p>

      <div class="example"><pre>
 [{ftp_host, [{ftp, "targethost"}, {username, "tester"}, {password, "letmein"}]},
  {lm_directory, "/test/loadmodules"}]</pre></div>

    

  

  <h3><a name="id85322">9.8 
        Examples of Configuration Data Handling</a></h3>
    

    <p>A configuration file for using the FTP client to access files on a remote
      host can look as follows:</p>

    <div class="example"><pre>
 {ftp_host, [{ftp,"targethost"},
	     {username,"tester"},
	     {password,"letmein"}]}.

 {lm_directory, "/test/loadmodules"}.</pre></div>

    <p>The XML version shown earlier can also be used, but it is to be
    explicitly specified that the <span class="code">ct_config_xml</span> callback module is to be
    used by <span class="code">Common Test</span>.</p>

    <p>The following is an example of how to assert that the configuration data is available
      and can be used for an FTP session:</p>
    <div class="example"><pre>
 init_per_testcase(ftptest, Config) -&gt;
     {ok,_} = ct_ftp:open(ftp),
     Config.

 end_per_testcase(ftptest, _Config) -&gt;
     ct_ftp:close(ftp).

 ftptest() -&gt;
     [{require,ftp,ftp_host},
      {require,lm_directory}].

 ftptest(Config) -&gt;
     Remote = filename:join(ct:get_config(lm_directory), "loadmodX"),
     Local = filename:join(?config(priv_dir,Config), "loadmodule"),
     ok = ct_ftp:recv(ftp, Remote, Local),
     ...</pre></div>
    
    <p>The following is an example of how the functions in the previous example 
       can be rewritten if it is necessary to open multiple connections to the 
       FTP server:</p>
    <div class="example"><pre>
 init_per_testcase(ftptest, Config) -&gt;
     {ok,Handle1} = ct_ftp:open(ftp_host),
     {ok,Handle2} = ct_ftp:open(ftp_host),
     [{ftp_handles,[Handle1,Handle2]} | Config].

 end_per_testcase(ftptest, Config) -&gt;
     lists:foreach(fun(Handle) -&gt; ct_ftp:close(Handle) end, 
                   ?config(ftp_handles,Config)).

 ftptest() -&gt;
     [{require,ftp_host},
      {require,lm_directory}].

 ftptest(Config) -&gt;
     Remote = filename:join(ct:get_config(lm_directory), "loadmodX"),
     Local = filename:join(?config(priv_dir,Config), "loadmodule"),
     [Handle | MoreHandles] = ?config(ftp_handles,Config),
     ok = ct_ftp:recv(Handle, Remote, Local),
     ...</pre></div>
      
  

  <h3><a name="id85377">9.9 
        Example of User-Specific Configuration Handler</a></h3>
    
    <p>A simple configuration handling driver, asking an external server for
      configuration data, can be implemented as follows:</p>
    <div class="example"><pre>
 -module(config_driver).
 -export([read_config/1, check_parameter/1]).

 read_config(ServerName)-&gt;
     ServerModule = list_to_atom(ServerName),
     ServerModule:start(),
     ServerModule:get_config().

 check_parameter(ServerName)-&gt;
     ServerModule = list_to_atom(ServerName),
     case code:is_loaded(ServerModule) of
         {file, _}-&gt;
             {ok, {config, ServerName}};
         false-&gt;
             case code:load_file(ServerModule) of
                 {module, ServerModule}-&gt;
                     {ok, {config, ServerName}};
                 {error, nofile}-&gt;
                     {error, {wrong_config, "File not found: " ++ ServerName ++ ".beam"}}
             end
     end.</pre></div>

    <p>The configuration string for this driver can be <span class="code">config_server</span>, if the
      <span class="code">config_server.erl</span> module that follows is compiled and exists in the code path
      during test execution:</p>
    <div class="example"><pre>
 -module(config_server).
 -export([start/0, stop/0, init/1, get_config/0, loop/0]).

 -define(REGISTERED_NAME, ct_test_config_server).

 start()-&gt;
     case whereis(?REGISTERED_NAME) of
         undefined-&gt;
             spawn(?MODULE, init, [?REGISTERED_NAME]),
             wait();
         _Pid-&gt;
         ok
     end,
     ?REGISTERED_NAME.

 init(Name)-&gt;
     register(Name, self()),
     loop().

 get_config()-&gt;
     call(self(), get_config).

 stop()-&gt;
     call(self(), stop).

 call(Client, Request)-&gt;
     case whereis(?REGISTERED_NAME) of
         undefined-&gt;
             {error, {not_started, Request}};
         Pid-&gt;
             Pid ! {Client, Request},
             receive
                 Reply-&gt;
                     {ok, Reply}
             after 4000-&gt;
                 {error, {timeout, Request}}
             end
     end.

 loop()-&gt;
     receive
         {Pid, stop}-&gt;
             Pid ! ok;
         {Pid, get_config}-&gt;
             {D,T} = erlang:localtime(),
             Pid !
                 [{localtime, [{date, D}, {time, T}]},
                  {node, erlang:node()},
                  {now, erlang:now()},
                  {config_server_pid, self()},
                  {config_server_vsn, ?vsn}],
             ?MODULE:loop()
     end.

 wait()-&gt;
     case whereis(?REGISTERED_NAME) of
         undefined-&gt;
             wait();
         _Pid-&gt;
             ok
     end.</pre></div>

    <p>Here, the handler also provides for dynamically reloading of
      configuration variables. If 
      <span class="bold_code bc-15"><a href="../../man/ct.html#reload_config-1"><span class="code">ct:reload_config(localtime)</span></a></span> is called from
      the test case function, all variables loaded with <span class="code">config_driver:read_config/1</span>
      are updated with their latest values, and the new value for variable
      <span class="code">localtime</span> is returned.</p>
  

</div>
<div class="footer">
<hr>
<p>Copyright © 2003-2018 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script type="text/javascript">window.__otpTopDocDir = '../../js/';</script><script type="text/javascript" src="../../js/highlight.js"></script>
</body>
</html>
