<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../otp_doc.css" type="text/css">
<title>Erlang -- Supervisor Behaviour</title>
</head>
<body bgcolor="white" text="#000000" link="#0000ff" vlink="#ff00ff" alink="#ff0000"><div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../js/erlresolvelinks.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function getWinHeight() {
                var myHeight = 0;
                if( typeof( window.innerHeight ) == 'number' ) {
                  //Non-IE
                  myHeight = window.innerHeight;
                } else if( document.documentElement && ( document.documentElement.clientWidth ||
                                                         document.documentElement.clientHeight ) ) {
                  //IE 6+ in 'standards compliant mode'
                  myHeight = document.documentElement.clientHeight;
                } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
                  //IE 4 compatible
                  myHeight = document.body.clientHeight;
                }
                return myHeight;
              }

              function setscrollpos() {
                var objf=document.getElementById('loadscrollpos');
                 document.getElementById("leftnav").scrollTop = objf.offsetTop - getWinHeight()/2;
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //--></script><div id="leftnav"><div class="innertube">
<img alt="Erlang logo" src="../erlang-logo.png"><br><small><a href="users_guide.html">User's Guide</a><br><a href="../pdf/otp-system-documentation.pdf">PDF</a><br><a href="../index.html">Top</a></small><p><strong>OTP Design Principles</strong><br><strong>User's Guide</strong><br><small>Version 7.3</small></p>
<br><a href="javascript:openAllFlips()">Expand All</a><br><a href="javascript:closeAllFlips()">Contract All</a><p><small><strong>Chapters</strong></small></p>
<ul class="flipMenu" imagePath="../js/flipmenu">
<li id="no" title="Overview" expanded="false">Overview<ul>
<li><a href="des_princ.html">
              Top of chapter
            </a></li>
<li title="Supervision Trees"><a href="des_princ.html#id64367">Supervision Trees</a></li>
<li title="Behaviours"><a href="des_princ.html#id59018">Behaviours</a></li>
<li title="Applications"><a href="des_princ.html#id62708">Applications</a></li>
<li title="Releases"><a href="des_princ.html#id67826">Releases</a></li>
<li title="Release Handling"><a href="des_princ.html#id60992">Release Handling</a></li>
</ul>
</li>
<li id="no" title="gen_server Behaviour" expanded="false">gen_server Behaviour<ul>
<li><a href="gen_server_concepts.html">
              Top of chapter
            </a></li>
<li title="Client-Server Principles"><a href="gen_server_concepts.html#id60348">Client-Server Principles</a></li>
<li title="Example"><a href="gen_server_concepts.html#id58953">Example</a></li>
<li title="Starting a Gen_Server"><a href="gen_server_concepts.html#id60326">Starting a Gen_Server</a></li>
<li title="Synchronous Requests - Call"><a href="gen_server_concepts.html#id67860">Synchronous Requests - Call</a></li>
<li title="Asynchronous Requests - Cast"><a href="gen_server_concepts.html#id68094">Asynchronous Requests - Cast</a></li>
<li title="Stopping"><a href="gen_server_concepts.html#id67742">Stopping</a></li>
<li title="Handling Other Messages"><a href="gen_server_concepts.html#id63566">Handling Other Messages</a></li>
</ul>
</li>
<li id="no" title="gen_fsm Behaviour" expanded="false">gen_fsm Behaviour<ul>
<li><a href="fsm.html">
              Top of chapter
            </a></li>
<li title="Finite-State Machines"><a href="fsm.html#id70273">Finite-State Machines</a></li>
<li title="Example"><a href="fsm.html#id69827">Example</a></li>
<li title="Starting gen_fsm"><a href="fsm.html#id69875">Starting gen_fsm</a></li>
<li title="Notifying about Events"><a href="fsm.html#id68709">Notifying about Events</a></li>
<li title="Time-Outs"><a href="fsm.html#id68805">Time-Outs</a></li>
<li title="All State Events"><a href="fsm.html#id68846">All State Events</a></li>
<li title="Stopping"><a href="fsm.html#id68881">Stopping</a></li>
<li title="Handling Other Messages"><a href="fsm.html#id68997">Handling Other Messages</a></li>
</ul>
</li>
<li id="no" title="gen_event Behaviour" expanded="false">gen_event Behaviour<ul>
<li><a href="events.html">
              Top of chapter
            </a></li>
<li title="Event Handling Principles"><a href="events.html#id69105">Event Handling Principles</a></li>
<li title="Example"><a href="events.html#id69156">Example</a></li>
<li title="Starting an Event Manager"><a href="events.html#id69197">Starting an Event Manager</a></li>
<li title="Adding an Event Handler"><a href="events.html#id69255">Adding an Event Handler</a></li>
<li title="Notifying about Events"><a href="events.html#id69340">Notifying about Events</a></li>
<li title="Deleting an Event Handler"><a href="events.html#id69411">Deleting an Event Handler</a></li>
<li title="Stopping"><a href="events.html#id69490">Stopping</a></li>
<li title="Handling Other Messages"><a href="events.html#id69544">Handling Other Messages</a></li>
</ul>
</li>
<li id="loadscrollpos" title="Supervisor Behaviour" expanded="true">Supervisor Behaviour<ul>
<li><a href="sup_princ.html">
              Top of chapter
            </a></li>
<li title="Supervision Principles"><a href="sup_princ.html#id69652">Supervision Principles</a></li>
<li title="Example"><a href="sup_princ.html#id69676">Example</a></li>
<li title="Supervisor Flags"><a href="sup_princ.html#id73161">Supervisor Flags</a></li>
<li title="Restart Strategy"><a href="sup_princ.html#id73232">Restart Strategy</a></li>
<li title="Maximum Restart Intensity"><a href="sup_princ.html#id73357">Maximum Restart Intensity</a></li>
<li title="Child Specification"><a href="sup_princ.html#id73434">Child Specification</a></li>
<li title="Starting a Supervisor"><a href="sup_princ.html#id73869">Starting a Supervisor</a></li>
<li title="Adding a Child Process"><a href="sup_princ.html#id73986">Adding a Child Process</a></li>
<li title="Stopping a Child Process"><a href="sup_princ.html#id74030">Stopping a Child Process</a></li>
<li title="Simplified one_for_one Supervisors"><a href="sup_princ.html#id74088">Simplified one_for_one Supervisors</a></li>
<li title="Stopping"><a href="sup_princ.html#id74216">Stopping</a></li>
</ul>
</li>
<li id="no" title="sys and proc_lib" expanded="false">sys and proc_lib<ul>
<li><a href="spec_proc.html">
              Top of chapter
            </a></li>
<li title="Simple Debugging"><a href="spec_proc.html#id74314">Simple Debugging</a></li>
<li title="Special Processes"><a href="spec_proc.html#id74399">Special Processes</a></li>
<li title="User-Defined Behaviours"><a href="spec_proc.html#id75026">User-Defined Behaviours</a></li>
</ul>
</li>
<li id="no" title="Applications" expanded="false">Applications<ul>
<li><a href="applications.html">
              Top of chapter
            </a></li>
<li title="Application Concept"><a href="applications.html#id75291">Application Concept</a></li>
<li title="Application Callback Module"><a href="applications.html#id75358">Application Callback Module</a></li>
<li title="Application Resource File"><a href="applications.html#id75484">Application Resource File</a></li>
<li title="Directory Structure"><a href="applications.html#id75737">Directory Structure</a></li>
<li title="Application Controller"><a href="applications.html#id75831">Application Controller</a></li>
<li title="Loading and Unloading Applications"><a href="applications.html#id75864">Loading and Unloading Applications</a></li>
<li title="Starting and Stopping Applications"><a href="applications.html#id75926">Starting and Stopping Applications</a></li>
<li title="Configuring an Application"><a href="applications.html#id76014">Configuring an Application</a></li>
<li title="Application Start Types"><a href="applications.html#id76222">Application Start Types</a></li>
</ul>
</li>
<li id="no" title="Included Applications" expanded="false">Included Applications<ul>
<li><a href="included_applications.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="included_applications.html#id76366">Introduction</a></li>
<li title="Specifying Included Applications"><a href="included_applications.html#id76431">Specifying Included Applications</a></li>
<li title="Synchronizing Processes during Startup"><a href="included_applications.html#id76457">Synchronizing Processes during Startup</a></li>
</ul>
</li>
<li id="no" title="Distributed Applications" expanded="false">Distributed Applications<ul>
<li><a href="distributed_applications.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="distributed_applications.html#id76691">Introduction</a></li>
<li title="Specifying Distributed Applications"><a href="distributed_applications.html#id76727">Specifying Distributed Applications</a></li>
<li title="Starting and Stopping Distributed Applications"><a href="distributed_applications.html#id76924">Starting and Stopping Distributed Applications</a></li>
<li title="Failover"><a href="distributed_applications.html#id77030">Failover</a></li>
<li title="Takeover"><a href="distributed_applications.html#id77177">Takeover</a></li>
</ul>
</li>
<li id="no" title="Releases" expanded="false">Releases<ul>
<li><a href="release_structure.html">
              Top of chapter
            </a></li>
<li title="Release Concept"><a href="release_structure.html#id77382">Release Concept</a></li>
<li title="Release Resource File"><a href="release_structure.html#id77434">Release Resource File</a></li>
<li title="Generating Boot Scripts"><a href="release_structure.html#id77577">Generating Boot Scripts</a></li>
<li title="Creating a Release Package"><a href="release_structure.html#id77684">Creating a Release Package</a></li>
<li title="Directory Structure"><a href="release_structure.html#id77850">Directory Structure</a></li>
</ul>
</li>
<li id="no" title="Release Handling" expanded="false">Release Handling<ul>
<li><a href="release_handling.html">
              Top of chapter
            </a></li>
<li title="Release Handling Principles"><a href="release_handling.html#id78094">Release Handling Principles</a></li>
<li title="Requirements"><a href="release_handling.html#id78350">Requirements</a></li>
<li title="Distributed Systems"><a href="release_handling.html#id78439">Distributed Systems</a></li>
<li title="Release Handling Instructions"><a href="release_handling.html#id78465">Release Handling Instructions</a></li>
<li title="Application Upgrade File"><a href="release_handling.html#id79028">Application Upgrade File</a></li>
<li title="Release Upgrade File"><a href="release_handling.html#id79224">Release Upgrade File</a></li>
<li title="Installing a Release"><a href="release_handling.html#id79382">Installing a Release</a></li>
<li title="Updating Application Specifications"><a href="release_handling.html#id79883">Updating Application Specifications</a></li>
</ul>
</li>
<li id="no" title="Appup Cookbook" expanded="false">Appup Cookbook<ul>
<li><a href="appup_cookbook.html">
              Top of chapter
            </a></li>
<li title="Changing a Functional Module"><a href="appup_cookbook.html#id80083">Changing a Functional Module</a></li>
<li title="Changing a Residence Module"><a href="appup_cookbook.html#id80102">Changing a Residence Module</a></li>
<li title="Changing a Callback Module"><a href="appup_cookbook.html#id80140">Changing a Callback Module</a></li>
<li title="Changing Internal State"><a href="appup_cookbook.html#id80194">Changing Internal State</a></li>
<li title="Module Dependencies"><a href="appup_cookbook.html#id80338">Module Dependencies</a></li>
<li title="Changing Code for a Special Process"><a href="appup_cookbook.html#id80513">Changing Code for a Special Process</a></li>
<li title="Changing a Supervisor"><a href="appup_cookbook.html#id80695">Changing a Supervisor</a></li>
<li title="Adding or Deleting a Module"><a href="appup_cookbook.html#id80952">Adding or Deleting a Module</a></li>
<li title="Starting or Terminating a Process"><a href="appup_cookbook.html#id80980">Starting or Terminating a Process</a></li>
<li title="Adding or Removing an Application"><a href="appup_cookbook.html#id80998">Adding or Removing an Application</a></li>
<li title="Restarting an Application"><a href="appup_cookbook.html#id81029">Restarting an Application</a></li>
<li title="Changing an Application Specification"><a href="appup_cookbook.html#id81074">Changing an Application Specification</a></li>
<li title="Changing Application Configuration"><a href="appup_cookbook.html#id81097">Changing Application Configuration</a></li>
<li title="Changing Included Applications"><a href="appup_cookbook.html#id81125">Changing Included Applications</a></li>
<li title="Changing Non-Erlang Code"><a href="appup_cookbook.html#id81387">Changing Non-Erlang Code</a></li>
<li title="Emulator Restart and Upgrade"><a href="appup_cookbook.html#id81485">Emulator Restart and Upgrade</a></li>
<li title="Emulator Upgrade From Pre OTP R15"><a href="appup_cookbook.html#id81570">Emulator Upgrade From Pre OTP R15</a></li>
</ul>
</li>
</ul>
</div></div>
<div id="content">
<div class="innertube">
<h1>5 Supervisor Behaviour</h1>
  
  <p>This section should be read with the
    <span class="bold_code"><a href="../man/supervisor.html">supervisor(3)</a></span> manual page
    in STDLIB, where all details about the supervisor
    behaviour is given.</p>

  <h3><a name="id69652">5.1 
        Supervision Principles</a></h3>
    
    <p>A supervisor is responsible for starting, stopping, and
      monitoring its child processes. The basic idea of a supervisor is
      that it is to keep its child processes alive by restarting them
      when necessary.</p>
    <p>Which child processes to start and monitor is specified by a
      list of <span class="bold_code"><a href="#spec">child specifications</a></span>.
      The child processes are started in the order specified by this
      list, and terminated in the reversed order.</p>
  

  <h3><a name="id69676">5.2 
        Example</a></h3>
    
    <p>The callback module for a supervisor starting the server from
    <span class="bold_code"><a href="gen_server_concepts.html#ex">gen_server Behaviour</a></span>
    can look as follows:</p>
    <a name="ex"></a>
    <div class="example"><pre>
-module(ch_sup).
-behaviour(supervisor).

-export([start_link/0]).
-export([init/1]).

start_link() -&gt;
    supervisor:start_link(ch_sup, []).

init(_Args) -&gt;
    SupFlags = #{strategy =&gt; one_for_one, intensity =&gt; 1, period =&gt; 5},
    ChildSpecs = [#{id =&gt; ch3,
                    start =&gt; {ch3, start_link, []},
                    restart =&gt; permanent,
                    shutdown =&gt; brutal_kill,
                    type =&gt; worker,
                    modules =&gt; [cg3]}],
    {ok, {SupFlags, ChildSpecs}}.</pre></div>
    <p>The <span class="code">SupFlags</span> variable in the return value
      from <span class="code">init/1</span> represents
      the <span class="bold_code"><a href="#flags">supervisor flags</a></span>.</p>
    <p>The <span class="code">ChildSpecs</span> variable in the return value
      from <span class="code">init/1</span> is a list of <span class="bold_code"><a href="#spec">child
      specifications</a></span>.</p>
    

  <h3><a name="id73161">5.3 
        Supervisor Flags</a></h3>
    
    <a name="flags"></a>
    <p>This is the type definition for the supervisor flags:</p>
    <div class="example"><pre>
sup_flags() = #{strategy =&gt; strategy(),         % optional
                intensity =&gt; non_neg_integer(), % optional
                period =&gt; pos_integer()}        % optional
    strategy() = one_for_all
               | one_for_one
               | rest_for_one
               | simple_one_for_one</pre></div>
    <ul>
      <li>
	<p><span class="code">strategy</span> specifies
	  the <span class="bold_code"><a href="#strategy">restart
	  strategy</a></span>.</p>
      </li>
      <li>
	<p><span class="code">intensity</span> and <span class="code">period</span> specify
	  the <span class="bold_code"><a href="#max_intensity">maximum restart
	  intensity</a></span>.</p>
      </li>
    </ul>
  

  <h3><a name="id73232">5.4 
        Restart Strategy</a></h3>
    <a name="strategy"></a>
    

    <p> The restart strategy is specified by
      the <span class="code">strategy</span> key in the supervisor flags map returned by
      the callback function <span class="code">init</span>:</p>
    <div class="example"><pre>
SupFlags = #{strategy =&gt; Strategy, ...}</pre></div>
    <p>The <span class="code">strategy</span> key is optional in this map. If it is not
      given, it defaults to <span class="code">one_for_one</span>.</p>

    <h4>one_for_one</h4>
      
      <p>If a child process terminates, only that process is restarted.</p>
      <a name="sup4"></a>
      <img alt="IMAGE MISSING" src="../design_principles/sup4.gif"><br>
        <em>Figure
        5.1:
         
        One_For_One Supervision</em>
      
    

    <h4>one_for_all</h4>
      
      <p>If a child process terminates, all other child processes are
        terminated, and then all child processes, including
        the terminated one, are restarted.</p>
      <a name="sup5"></a>
      <img alt="IMAGE MISSING" src="../design_principles/sup5.gif"><br>
        <em>Figure
        5.2:
         
        One_For_All Supervision</em>
      
    

    <h4>rest_for_one</h4>
      
      <p>If a child process terminates, the rest of the child
        processes (that is, the child processes after the terminated
        process in start order) are terminated. Then the terminated
        child process and the rest of the child processes are restarted.</p>
    

     <h4>simple_one_for_one</h4>
      
      <p>See <span class="bold_code"><a href="#simple">simple-one-for-one
	  supervisors</a></span>.</p>
    
  

  <h3><a name="id73357">5.5 
        Maximum Restart Intensity</a></h3>
    <a name="max_intensity"></a>
    
    <p>The supervisors have a built-in mechanism to limit the number of
      restarts which can occur in a given time interval. This is
      specified by the two keys <span class="code">intensity</span> and
      <span class="code">period</span> in the supervisor flags map returned by the
      callback function <span class="code">init</span>:</p>
    <div class="example"><pre>
SupFlags = #{intensity =&gt; MaxR, period =&gt; MaxT, ...}</pre></div>
    <p>If more than <span class="code">MaxR</span> number of restarts occur in the last
      <span class="code">MaxT</span> seconds, the supervisor terminates all the child
      processes and then itself.</p>
    <p>When the supervisor terminates, then the next higher-level
      supervisor takes some action. It either restarts the terminated
      supervisor or terminates itself.</p>
    <p>The intention of the restart mechanism is to prevent a situation
      where a process repeatedly dies for the same reason, only to be
      restarted again.</p>
    <p>The keys <span class="code">intensity</span> and <span class="code">period</span> are optional in the
      supervisor flags map. If they are not given, they default
      to <span class="code">1</span> and <span class="code">5</span>, respectively.</p>
  

  <h3><a name="id73434">5.6 
        Child Specification</a></h3>
    <a name="spec"></a>
    
    <p>The type definition for a child specification is as follows:</p>
    <div class="example"><pre>
child_spec() = #{id =&gt; child_id(),       % mandatory
                 start =&gt; mfargs(),      % mandatory
                 restart =&gt; restart(),   % optional
                 shutdown =&gt; shutdown(), % optional
                 type =&gt; worker(),       % optional
                 modules =&gt; modules()}   % optional
    child_id() = term()
    mfargs() = {M :: module(), F :: atom(), A :: [term()]}
    modules() = [module()] | dynamic
    restart() = permanent | transient | temporary
    shutdown() = brutal_kill | timeout()
    worker() = worker | supervisor</pre></div>
    <ul>
      <li>
        <p><span class="code">id</span> is used to identify the child
          specification internally by the supervisor.</p>
	<p>The <span class="code">id</span> key is mandatory.</p>
	<p>Note that this identifier occasionally has been called
	  "name". As far as possible, the terms "identifier" or "id"
	  are now used but in order to keep backwards compatibility,
	  some occurences of "name" can still be found, for example
	  in error messages.</p>
      </li>
      <li>
        <p><span class="code">start</span> defines the function call used to start
          the child process. It is a module-function-arguments tuple
          used as <span class="code">apply(M, F, A)</span>.</p>
        <p>It is to be (or result in) a call to any of the following:</p>
	<ul>
	  <li><span class="code">supervisor:start_link</span></li>
	  <li><span class="code">gen_server:start_link</span></li>
	  <li><span class="code">gen_fsm:start_link</span></li>
	  <li><span class="code">gen_event:start_link</span></li>
	  <li>A function compliant with these functions. For details,
	  see the <span class="code">supervisor(3)</span> manual page.</li>
	</ul>
	<p>The <span class="code">start</span> key is mandatory.</p>
      </li>
      <li>
        <p><span class="code">restart</span> defines when a terminated child process is to
          be restarted.</p>
        <ul>
          <li>A <span class="code">permanent</span> child process is always restarted.</li>
          <li>A <span class="code">temporary</span> child process is never restarted
          (not even when the supervisor restart strategy
          is <span class="code">rest_for_one</span> or <span class="code">one_for_all</span> and a sibling
          death causes the temporary process to be terminated).</li>
          <li>A <span class="code">transient</span> child process is restarted only if it
	  terminates abnormally, that is, with another exit reason than
          <span class="code">normal</span>, <span class="code">shutdown</span>, or <span class="code">{shutdown,Term}</span>.</li>
        </ul>
	<p>The <span class="code">restart</span> key is optional. If it is not given, the
	  default value <span class="code">permanent</span> will be used.</p>
      </li>
      <li>
        <a name="shutdown"></a>
        <p><span class="code">shutdown</span> defines how a child process is to be
          terminated.</p>
        <ul>
          <li>
<span class="code">brutal_kill</span> means that the child process is
           unconditionally terminated using <span class="code">exit(Child, kill)</span>.</li>
          <li>An integer time-out value means that the supervisor tells
           the child process to terminate by calling
          <span class="code">exit(Child, shutdown)</span> and then waits for an exit
           signal back. If no exit signal is received within
           the specified time, the child process is unconditionally
           terminated using <span class="code">exit(Child, kill)</span>.</li>
          <li>If the child process is another supervisor, it is to be
           set to <span class="code">infinity</span> to give the subtree enough time to
           shut down. It is also allowed to set it to <span class="code">infinity</span>,
          if the child process is a worker. See the warning below:</li>
        </ul>
        <div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
          <p>Be careful when setting the shutdown time to
          <span class="code">infinity</span> when the child process is a worker. Because, in this
          situation, the termination of the supervision tree depends on the
          child process; it must be implemented in a safe way and its cleanup
          procedure must always return.</p>
        </p></div>
</div>
	<p>The <span class="code">shutdown</span> key is optional. If it is not given,
	  and the child is of type <span class="code">worker</span>, the default value
	  <span class="code">5000</span> will be used; if the child is of type
	  <span class="code">supervisor</span>, the default value <span class="code">infinity</span> will be
	  used.</p>
      </li>
      <li>
        <p><span class="code">type</span> specifies if the child process is a supervisor or
          a worker.</p>
	<p>The <span class="code">type</span> key is optional. If it is not given, the
	  default value <span class="code">worker</span> will be used.</p>
      </li>
      <li>
        <p><span class="code">modules</span> are to be a list with one element
          <span class="code">[Module]</span>, where <span class="code">Module</span> is the name of
          the callback module, if the child process is a supervisor,
          gen_server or gen_fsm. If the child process is a gen_event,
          the value shall be <span class="code">dynamic</span>.</p>
        <p>This information is used by the release handler during
          upgrades and downgrades, see
          <span class="bold_code"><a href="release_handling.html">Release Handling</a></span>.</p>
	<p>The <span class="code">modules</span> key is optional. If it is not given, it
	  defaults to <span class="code">[M]</span>, where <span class="code">M</span> comes from the
	  child's start <span class="code">{M,F,A}</span>.</p>
      </li>
    </ul>
    <p><strong>Example:</strong> The child specification to start the server
    <span class="code">ch3</span> in the previous example look as follows:</p>
    <div class="example"><pre>
#{id =&gt; ch3,
  start =&gt; {ch3, start_link, []},
  restart =&gt; permanent,
  shutdown =&gt; brutal_kill,
  type =&gt; worker,
  modules =&gt; [ch3]}</pre></div>
    <p>or simplified, relying on the default values:</p>
    <div class="example"><pre>
#{id =&gt; ch3,
  start =&gt; {ch3, start_link, []}
  shutdown =&gt; brutal_kill}</pre></div>
    <p>Example: A child specification to start the event manager from
      the chapter about
      <span class="bold_code"><a href="events.html#mgr">gen_event</a></span>:</p>
    <div class="example"><pre>
#{id =&gt; error_man,
  start =&gt; {gen_event, start_link, [{local, error_man}]},
  modules =&gt; dynamic}</pre></div>
    <p>Both server and event manager are registered processes which
      can be expected to be always accessible. Thus they are
      specified to be <span class="code">permanent</span>.</p>
    <p><span class="code">ch3</span> does not need to do any cleaning up before
      termination. Thus, no shutdown time is needed, but
      <span class="code">brutal_kill</span> is sufficient. <span class="code">error_man</span> can
      need some time for the event handlers to clean up, thus
      the shutdown time is set to 5000 ms (which is the default
      value).</p>
    <p>Example: A child specification to start another supervisor:</p>
    <div class="example"><pre>
#{id =&gt; sup,
  start =&gt; {sup, start_link, []},
  restart =&gt; transient,
  type =&gt; supervisor} % will cause default shutdown=&gt;infinity</pre></div>
  

  <h3><a name="id73869">5.7 
        Starting a Supervisor</a></h3>
    <a name="super_tree"></a>
    
    <p>In the previous example, the supervisor is started by calling
      <span class="code">ch_sup:start_link()</span>:</p>
    <div class="example"><pre>
start_link() -&gt;
    supervisor:start_link(ch_sup, []).</pre></div>
    <p><span class="code">ch_sup:start_link</span> calls function
    <span class="code">supervisor:start_link/2</span>, which spawns and links to a new
    process, a supervisor.</p>
    <ul>
      <li>The first argument, <span class="code">ch_sup</span>, is the name of
       the callback module, that is, the module where the <span class="code">init</span>
       callback function is located.</li>
      <li>The second argument, <span class="code">[]</span>, is a term that is passed
       as is to
       the callback function <span class="code">init</span>. Here, <span class="code">init</span> does not
       need any indata and ignores the argument.</li>
    </ul>
    <p>In this case, the supervisor is not registered. Instead its pid
      must be used. A name can be specified by calling
      <span class="code">supervisor:start_link({local, Name}, Module, Args)</span> or
      <span class="code">supervisor:start_link({global, Name}, Module, Args)</span>.</p>
    <p>The new supervisor process calls the callback function
      <span class="code">ch_sup:init([])</span>. <span class="code">init</span> shall return
      <span class="code">{ok, {SupFlags, ChildSpecs}}</span>:</p>
    <div class="example"><pre>
init(_Args) -&gt;
    SupFlags = #{},
    ChildSpecs = [#{id =&gt; ch3,
                    start =&gt; {ch3, start_link, []},
                    shutdown =&gt; brutal_kill}],
    {ok, {SupFlags, ChildSpecs}}.</pre></div>
    <p>The supervisor then starts all its child processes according to
      the child specifications in the start specification. In this case
      there is one child process, <span class="code">ch3</span>.</p>
    <p><span class="code">supervisor:start_link</span> is synchronous. It does
      not return until all child processes have been started.</p>
  

  <h3><a name="id73986">5.8 
        Adding a Child Process</a></h3>
    
    <p>In addition to the static supervision tree, dynamic child
    processes can be added to an existing supervisor with the following
    call:</p>
    <div class="example"><pre>
supervisor:start_child(Sup, ChildSpec)</pre></div>
    <p><span class="code">Sup</span> is the pid, or name, of the supervisor.
    <span class="code">ChildSpec</span> is a
    <span class="bold_code"><a href="#spec">child specification</a></span>.</p>
    <p>Child processes added using <span class="code">start_child/2</span> behave in
      the same way as the other child processes, with the an important
      exception: if a supervisor dies and is recreated, then
      all child processes that were dynamically added to the supervisor
      are lost.</p>
  

  <h3><a name="id74030">5.9 
        Stopping a Child Process</a></h3>
    
    <p>Any child process, static or dynamic, can be stopped in
      accordance with the shutdown specification:</p>
    <div class="example"><pre>
supervisor:terminate_child(Sup, Id)</pre></div>
    <p>The child specification for a stopped child process is deleted
      with the following call:</p>
    <div class="example"><pre>
supervisor:delete_child(Sup, Id)</pre></div>
    <p><span class="code">Sup</span> is the pid, or name, of the supervisor.
      <span class="code">Id</span> is the value associated with the <span class="code">id</span> key in
      the <span class="bold_code"><a href="#spec">child specification</a></span>.</p>
    <p>As with dynamically added child processes, the effects of
      deleting a static child process is lost if the supervisor itself
      restarts.</p>
  

  <a name="simple"></a>
  <h3><a name="id74088">5.10 
        Simplified one_for_one Supervisors</a></h3>
    
    <p>A supervisor with restart strategy <span class="code">simple_one_for_one</span> is
      a simplified <span class="code">one_for_one</span> supervisor, where all child
      processes are dynamically added instances of the same process.</p>
    <p>The following is an example of a callback module for a
    <span class="code">simple_one_for_one</span> supervisor:</p>
    <div class="example"><pre>
-module(simple_sup).
-behaviour(supervisor).

-export([start_link/0]).
-export([init/1]).

start_link() -&gt;
    supervisor:start_link(simple_sup, []).

init(_Args) -&gt;
    SupFlags = #{strategy =&gt; simple_one_for_one,
                 intensity =&gt; 0,
                 period =&gt; 1},
    ChildSpecs = [#{id =&gt; call,
                    start =&gt; {call, start_link, []},
                    shutdown =&gt; brutal_kill}],
    {ok, {SupFlags, ChildSpecs}}.</pre></div>
    <p>When started, the supervisor does not start any child processes.
      Instead, all child processes are added dynamically by calling:</p>
    <div class="example"><pre>
supervisor:start_child(Sup, List)</pre></div>
    <p><span class="code">Sup</span> is the pid, or name, of the supervisor.
      <span class="code">List</span> is an arbitrary list of terms, which are added to
      the list of arguments specified in the child specification. If
      the start function is specified as <span class="code">{M, F, A}</span>,
      the child process is started by calling
      <span class="code">apply(M, F, A++List)</span>.</p>
    <p>For example, adding a child to <span class="code">simple_sup</span> above:</p>
    <div class="example"><pre>
supervisor:start_child(Pid, [id1])</pre></div>
    <p>The result is that the child process is started by calling
      <span class="code">apply(call, start_link, []++[id1])</span>, or actually:</p>
    <div class="example"><pre>
call:start_link(id1)</pre></div>
    <p>A child under a <span class="code">simple_one_for_one</span> supervisor can be
    terminated with the following:</p>
    <div class="example"><pre>
supervisor:terminate_child(Sup, Pid)</pre></div>
    <p><span class="code">Sup</span> is the pid, or name, of the supervisor and
    <span class="code">Pid</span> is the pid of the child.</p>
    <p>Because a <span class="code">simple_one_for_one</span> supervisor can have many
      children, it shuts them all down asynchronously. This means that
      the children will do their cleanup in parallel and therefore the
      order in which they are stopped is not defined.</p>
  

  <h3><a name="id74216">5.11 
        Stopping</a></h3>
    
    <p>Since the supervisor is part of a supervision tree, it is
      automatically terminated by its supervisor. When asked to
      shut down, it terminates all child processes in reversed start
      order according to the respective shutdown specifications, and
      then terminates itself.</p>
  
</div>
<div class="footer">
<hr>
<p>Copyright © 1997-2016 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div></body>
</html>
