<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../../otp_doc.css" type="text/css">
<title>Erlang -- Event Handling</title>
</head>
<body bgcolor="white" text="#000000" link="#0000ff" vlink="#ff00ff" alink="#ff0000"><div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../../js/erlresolvelinks.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function getWinHeight() {
                var myHeight = 0;
                if( typeof( window.innerHeight ) == 'number' ) {
                  //Non-IE
                  myHeight = window.innerHeight;
                } else if( document.documentElement && ( document.documentElement.clientWidth ||
                                                         document.documentElement.clientHeight ) ) {
                  //IE 6+ in 'standards compliant mode'
                  myHeight = document.documentElement.clientHeight;
                } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
                  //IE 4 compatible
                  myHeight = document.body.clientHeight;
                }
                return myHeight;
              }

              function setscrollpos() {
                var objf=document.getElementById('loadscrollpos');
                 document.getElementById("leftnav").scrollTop = objf.offsetTop - getWinHeight()/2;
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //--></script><div id="leftnav"><div class="innertube">
<img alt="Erlang logo" src="../../erlang-logo.png"><br><small><a href="users_guide.html">User's Guide</a><br><a href="index.html">Reference Manual</a><br><a href="release_notes.html">Release Notes</a><br><a href="common_test.pdf">PDF</a><br><a href="../../index.html">Top</a></small><p><strong>Common Test</strong><br><strong>User's Guide</strong><br><small>Version 1.12</small></p>
<br><a href="javascript:openAllFlips()">Expand All</a><br><a href="javascript:closeAllFlips()">Contract All</a><p><small><strong>Chapters</strong></small></p>
<ul class="flipMenu" imagePath="../../js/flipmenu">
<li id="no" title="Introduction" expanded="false">Introduction<ul>
<li><a href="introduction.html">
              Top of chapter
            </a></li>
<li title="Scope"><a href="introduction.html#id61477">Scope</a></li>
<li title="Prerequisites"><a href="introduction.html#id61932">Prerequisites</a></li>
</ul>
</li>
<li id="no" title="Common Test Basics" expanded="false">Common Test Basics<ul>
<li><a href="basics_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="basics_chapter.html#id56619">General</a></li>
<li title="Test Suite Organisation"><a href="basics_chapter.html#id59157">Test Suite Organisation</a></li>
<li title="Support Libraries"><a href="basics_chapter.html#id67513">Support Libraries</a></li>
<li title="Suites and Test Cases"><a href="basics_chapter.html#id56610">Suites and Test Cases</a></li>
<li title="External Interfaces"><a href="basics_chapter.html#id64806">External Interfaces</a></li>
</ul>
</li>
<li id="no" title="Getting Started" expanded="false">Getting Started<ul>
<li><a href="getting_started_chapter.html">
              Top of chapter
            </a></li>
<li title="Introduction for Newcomers"><a href="getting_started_chapter.html#id63529">Introduction for Newcomers</a></li>
<li title="Test Case Execution"><a href="getting_started_chapter.html#id69403">Test Case Execution</a></li>
<li title="A Simple Test Suite"><a href="getting_started_chapter.html#id64054">A Simple Test Suite</a></li>
<li title="A Test Suite with Configuration Functions"><a href="getting_started_chapter.html#id62519">A Test Suite with Configuration Functions</a></li>
<li title="Questions and Answers"><a href="getting_started_chapter.html#id69030">Questions and Answers</a></li>
</ul>
</li>
<li id="no" title="Installation" expanded="false">Installation<ul>
<li><a href="install_chapter.html">
              Top of chapter
            </a></li>
<li title="General Information"><a href="install_chapter.html#id75238">General Information</a></li>
</ul>
</li>
<li id="no" title="Writing Test Suites" expanded="false">Writing Test Suites<ul>
<li><a href="write_test_chapter.html">
              Top of chapter
            </a></li>
<li title="Support for Test Suite Authors"><a href="write_test_chapter.html#id68804">Support for Test Suite Authors</a></li>
<li title="Test Suites"><a href="write_test_chapter.html#id68868">Test Suites</a></li>
<li title="Init and End per Suite"><a href="write_test_chapter.html#id68917">Init and End per Suite</a></li>
<li title="Init and End per Test Case"><a href="write_test_chapter.html#id74324">Init and End per Test Case</a></li>
<li title="Test Cases"><a href="write_test_chapter.html#id74622">Test Cases</a></li>
<li title="Test Case Information Function"><a href="write_test_chapter.html#id74809">Test Case Information Function</a></li>
<li title="Test Suite Information Function"><a href="write_test_chapter.html#id75006">Test Suite Information Function</a></li>
<li title="Test Case Groups"><a href="write_test_chapter.html#id76177">Test Case Groups</a></li>
<li title="Parallel Property and Nested Groups"><a href="write_test_chapter.html#id76612">Parallel Property and Nested Groups</a></li>
<li title="Parallel Test Cases and I/O"><a href="write_test_chapter.html#id76648">Parallel Test Cases and I/O</a></li>
<li title="Repeated Groups"><a href="write_test_chapter.html#id76702">Repeated Groups</a></li>
<li title="Shuffled Test Case Order"><a href="write_test_chapter.html#id76856">Shuffled Test Case Order</a></li>
<li title="Group Information Function"><a href="write_test_chapter.html#id76921">Group Information Function</a></li>
<li title="Information Functions for Init- and End-Configuration"><a href="write_test_chapter.html#id76963">Information Functions for Init- and End-Configuration</a></li>
<li title="Data and Private Directories"><a href="write_test_chapter.html#id77038">Data and Private Directories</a></li>
<li title="Execution Environment"><a href="write_test_chapter.html#id77195">Execution Environment</a></li>
<li title="Timetrap Time-Outs"><a href="write_test_chapter.html#id77232">Timetrap Time-Outs</a></li>
<li title="Logging - Categories and Verbosity Levels"><a href="write_test_chapter.html#id77433">Logging - Categories and Verbosity Levels</a></li>
<li title="Illegal Dependencies"><a href="write_test_chapter.html#id77745">Illegal Dependencies</a></li>
</ul>
</li>
<li id="no" title="Test Structure" expanded="false">Test Structure<ul>
<li><a href="test_structure_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="test_structure_chapter.html#id77938">General</a></li>
<li title="Skipping Test Cases"><a href="test_structure_chapter.html#id77957">Skipping Test Cases</a></li>
<li title="Definition of Terms"><a href="test_structure_chapter.html#id78036">Definition of Terms</a></li>
</ul>
</li>
<li id="no" title="Examples and Templates" expanded="false">Examples and Templates<ul>
<li><a href="example_chapter.html">
              Top of chapter
            </a></li>
<li title="Test Suite Example"><a href="example_chapter.html#id78347">Test Suite Example</a></li>
<li title="Test Suite Templates"><a href="example_chapter.html#id78400">Test Suite Templates</a></li>
</ul>
</li>
<li id="no" title="Running Tests and Analyzing Results" expanded="false">Running Tests and Analyzing Results<ul>
<li><a href="run_test_chapter.html">
              Top of chapter
            </a></li>
<li title="Using the Common Test Framework"><a href="run_test_chapter.html#id78595">Using the Common Test Framework</a></li>
<li title="Automatic Compilation of Test Suites and Help Modules"><a href="run_test_chapter.html#id78638">Automatic Compilation of Test Suites and Help Modules</a></li>
<li title="Running Tests from the OS Command Line"><a href="run_test_chapter.html#id78832">Running Tests from the OS Command Line</a></li>
<li title="Running Tests from the Erlang Shell or from an Erlang Program"><a href="run_test_chapter.html#id79514">Running Tests from the Erlang Shell or from an Erlang Program</a></li>
<li title="Test Case Group Execution"><a href="run_test_chapter.html#id79690">Test Case Group Execution</a></li>
<li title="Running the Interactive Shell Mode"><a href="run_test_chapter.html#id80196">Running the Interactive Shell Mode</a></li>
<li title="Step-by-Step Execution of Test Cases with the Erlang Debugger"><a href="run_test_chapter.html#id80419">Step-by-Step Execution of Test Cases with the Erlang Debugger</a></li>
<li title="Test Specifications"><a href="run_test_chapter.html#id80547">Test Specifications</a></li>
<li title="Running Tests from the Web-Based GUI"><a href="run_test_chapter.html#id81528">Running Tests from the Web-Based GUI</a></li>
<li title="Log Files"><a href="run_test_chapter.html#id81639">Log Files</a></li>
<li title="HTML Style Sheets"><a href="run_test_chapter.html#id82115">HTML Style Sheets</a></li>
<li title="Repeating Tests"><a href="run_test_chapter.html#id82293">Repeating Tests</a></li>
<li title="Silent Connections"><a href="run_test_chapter.html#id82658">Silent Connections</a></li>
</ul>
</li>
<li id="no" title="External Configuration Data" expanded="false">External Configuration Data<ul>
<li><a href="config_file_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="config_file_chapter.html#id82894">General</a></li>
<li title="Syntax"><a href="config_file_chapter.html#id82937">Syntax</a></li>
<li title="Requiring and Reading Configuration Data"><a href="config_file_chapter.html#id82961">Requiring and Reading Configuration Data</a></li>
<li title="Using Configuration Variables Defined in Multiple Files"><a href="config_file_chapter.html#id83093">Using Configuration Variables Defined in Multiple Files</a></li>
<li title="Encrypted Configuration Files"><a href="config_file_chapter.html#id83118">Encrypted Configuration Files</a></li>
<li title="Opening Connections Using Configuration Data"><a href="config_file_chapter.html#id83181">Opening Connections Using Configuration Data</a></li>
<li title="User-Specific Configuration Data Formats"><a href="config_file_chapter.html#id83252">User-Specific Configuration Data Formats</a></li>
<li title="Examples of Configuration Data Handling"><a href="config_file_chapter.html#id83469">Examples of Configuration Data Handling</a></li>
<li title="Example of User-Specific Configuration Handler"><a href="config_file_chapter.html#id83524">Example of User-Specific Configuration Handler</a></li>
</ul>
</li>
<li id="no" title="Code Coverage Analysis" expanded="false">Code Coverage Analysis<ul>
<li><a href="cover_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="cover_chapter.html#id83651">General</a></li>
<li title="Use"><a href="cover_chapter.html#id83685">Use</a></li>
<li title="Stopping the Cover Tool When Tests Are Completed"><a href="cover_chapter.html#id83800">Stopping the Cover Tool When Tests Are Completed</a></li>
<li title="The Cover Specification File"><a href="cover_chapter.html#id83861">The Cover Specification File</a></li>
<li title="Cross Cover Analysis"><a href="cover_chapter.html#id83925">Cross Cover Analysis</a></li>
<li title="Logging"><a href="cover_chapter.html#id84152">Logging</a></li>
</ul>
</li>
<li id="no" title="Using Common Test for Large-Scale Testing" expanded="false">Using Common Test for Large-Scale Testing<ul>
<li><a href="ct_master_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="ct_master_chapter.html#id84240">General</a></li>
<li title="Use"><a href="ct_master_chapter.html#id84318">Use</a></li>
<li title="Test Specifications"><a href="ct_master_chapter.html#id84511">Test Specifications</a></li>
<li title="Automatic Startup of Test Target Nodes"><a href="ct_master_chapter.html#id84762">Automatic Startup of Test Target Nodes</a></li>
</ul>
</li>
<li id="loadscrollpos" title="Event Handling" expanded="true">Event Handling<ul>
<li><a href="event_handler_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="event_handler_chapter.html#id84972">General</a></li>
<li title="Use"><a href="event_handler_chapter.html#id85113">Use</a></li>
</ul>
</li>
<li id="no" title="Dependencies between Test Cases and Suites" expanded="false">Dependencies between Test Cases and Suites<ul>
<li><a href="dependencies_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="dependencies_chapter.html#id86232">General</a></li>
<li title="Saving Configuration Data"><a href="dependencies_chapter.html#id86369">Saving Configuration Data</a></li>
<li title="Sequences"><a href="dependencies_chapter.html#id86542">Sequences</a></li>
</ul>
</li>
<li id="no" title="Common Test Hooks" expanded="false">Common Test Hooks<ul>
<li><a href="ct_hooks_chapter.html">
              Top of chapter
            </a></li>
<li title="General"><a href="ct_hooks_chapter.html#id86749">General</a></li>
<li title="Installing a CTH"><a href="ct_hooks_chapter.html#id86809">Installing a CTH</a></li>
<li title="CTH Scope"><a href="ct_hooks_chapter.html#id86991">CTH Scope</a></li>
<li title="Manipulating Tests"><a href="ct_hooks_chapter.html#id87353">Manipulating Tests</a></li>
<li title="Synchronizing External User Applications with Common Test"><a href="ct_hooks_chapter.html#id87717">Synchronizing External User Applications with Common Test</a></li>
<li title="Example CTH"><a href="ct_hooks_chapter.html#id87794">Example CTH</a></li>
<li title="Built-In CTHs"><a href="ct_hooks_chapter.html#id87855">Built-In CTHs</a></li>
</ul>
</li>
<li id="no" title="Some Thoughts about Testing" expanded="false">Some Thoughts about Testing<ul>
<li><a href="why_test_chapter.html">
              Top of chapter
            </a></li>
<li title="Goals"><a href="why_test_chapter.html#id88055">Goals</a></li>
<li title="What to Test"><a href="why_test_chapter.html#id88075">What to Test</a></li>
</ul>
</li>
</ul>
</div></div>
<div id="content">
<div class="innertube">
<h1>12 Event Handling</h1>
  

  <h3><a name="id84972">12.1 
        General</a></h3>
    <a name="event_handling"></a>
    
    <p>The operator of a <span class="code">Common Test</span> system can receive
    event notifications continuously during a test run. For example, 
    <span class="code">Common Test</span> reports when a test case starts and stops, 
    the current count of successful, failed, and skipped cases, and so on. 
    This information can be used for different purposes such as logging progress 
    and results in another format than HTML, saving statistics to a database 
    for report generation, and test system supervision.</p>

    <p><span class="code">Common Test</span> has a framework for event handling based on
    the OTP event manager concept and <span class="code">gen_event</span> behavior. 
    When the <span class="code">Common Test</span> server starts, it spawns an event manager. 
    During test execution the manager gets a notification from the server 
    when something of potential interest happens. Any event handler plugged into 
    the event manager can match on events of interest, take action, or
    pass the information on. The event handlers are Erlang modules
    implemented by the <span class="code">Common Test</span> user according to the <span class="code">gen_event</span> 
    behavior (for details, see module
    <span class="bold_code"><a href="../../man/gen_event.html"><span class="code">stdlib:gen_event</span></a></span> and
    section
    <span class="bold_code"><a href="../../design_principles/events.html"><span class="code">gen_event Behaviour</span></a></span>
    in OTP Design Principles in the System Documentation).
    </p>

    <p>A <span class="code">Common Test</span> server always starts an event manager. 
    The server also plugs in a default event handler, which only
    purpose is to relay notifications to a globally registered <span class="code">Common Test</span> 
    Master event manager (if a <span class="code">Common Test</span> Master server is running in the system). 
    The <span class="code">Common Test</span> Master also spawns an event manager at startup.
    Event handlers plugged into this manager receives the events from 
    all the test nodes, plus information from the <span class="code">Common Test</span> Master server.
    </p>

    <p>User-specific event handlers can be plugged into a <span class="code">Common Test</span> event
    manager, either by telling <span class="code">Common Test</span> to install them before the test
    run (described later), or by adding the handlers dynamically during the test
    run using
    <span class="bold_code"><a href="../../man/gen_event.html#add_handler-3"><span class="code">stdlib:gen_event:add_handler/3</span></a></span> or 
    <span class="bold_code"><a href="../../man/gen_event.html#add_sup_handler-3"><span class="code">stdlib:gen_event:add_sup_handler/3</span></a></span>.
    In the latter scenario, the reference of the <span class="code">Common Test</span> event manager is
    required. To get it, call 
    <span class="bold_code"><a href="../../man/ct.html#get_event_mgr_ref-0"><span class="code">ct:get_event_mgr_ref/0</span></a></span> 
    or (on the <span class="code">Common Test</span> Master node) 
    <span class="bold_code"><a href="../../man/ct_master.html#get_event_mgr_ref-0"><span class="code">ct_master:get_event_mgr_ref/0</span></a></span>.</p>
  
  <h3><a name="id85113">12.2 
        Use</a></h3>
    <a name="usage"></a>
    
    <p>Event handlers can be installed by an <span class="code">event_handler</span> start flag 
    (<span class="bold_code"><a href="../../man/ct_run.html"><span class="code">ct_run</span></a></span>) or option 
    <span class="bold_code"><a href="../../man/ct.html#run_test-1"><span class="code">ct:run_test/1</span></a></span>, where the
    argument specifies the names of one or more event handler modules.</p>

    <p><strong>Example:</strong></p>
    <p><span class="code">$ ct_run -suite test/my_SUITE -event_handler handlers/my_evh1 
    handlers/my_evh2 -pa $PWD/handlers</span></p>

    <p>To pass start arguments to the event handler init function, use option 
    <span class="code">ct_run -event_handler_init</span>  instead of
    <span class="code">-event_handler</span>.</p>

    <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>All event handler modules must have <span class="code">gen_event</span> behavior.
    These modules must be precompiled and their locations must be
    added explicitly to the Erlang code server search path (as in the previous
    example).</p></p></div>
</div>

    <p>An event_handler tuple in argument <span class="code">Opts</span> has the following definition 
    (see <span class="bold_code"><a href="../../man/ct.html#run_test-1"><span class="code">ct:run_test/1</span></a></span>):</p>

    <div class="example"><pre>
 {event_handler,EventHandlers}

 EventHandlers = EH | [EH]
 EH = atom() | {atom(),InitArgs} | {[atom()],InitArgs}
 InitArgs = [term()]</pre></div>

    <p>In the following example, two event handlers for the <span class="code">my_SUITE</span> test are installed:</p>
    <div class="example"><pre>
 1&gt; ct:run_test([{suite,"test/my_SUITE"},{event_handler,[my_evh1,{my_evh2,[node()]}]}]).</pre></div>
    <p>Event handler <span class="code">my_evh1</span> is started with <span class="code">[]</span> as argument to the init function. 
    Event handler <span class="code">my_evh2</span> is started with the name of the current node in the init argument list.</p>

    <p>Event handlers can also be plugged in using one of the following
    <span class="bold_code"><a href="run_test_chapter.html#test_specifications">test specification</a></span> 
    terms:</p>
    <ul>
    <li><span class="code">{event_handler, EventHandlers}</span></li>
    <li><span class="code">{event_handler, EventHandlers, InitArgs}</span></li>
    <li><span class="code">{event_handler, NodeRefs, EventHandlers}</span></li>
    <li><span class="code">{event_handler, NodeRefs, EventHandlers, InitArgs}</span></li>
    </ul>
  
    <p><span class="code">EventHandlers</span> is a list of module names. Before a test 
    session starts, the init function of each plugged in event handler 
    is called (with the <span class="code">InitArgs</span> list as argument or <span class="code">[]</span> if
    no start arguments are specified).</p>

    <p>To plug in a handler to the <span class="code">Common Test</span> Master event manager, specify 
    <span class="code">master</span> as the node in <span class="code">NodeRefs</span>.</p>

    <p>To be able to match on events, the event handler module must
    include the header file <span class="code">ct_event.hrl</span>. An event is a record with the
    following definition:</p>

    <p><span class="code">#event{name, node, data}</span></p>

    <dl>
      <dt><strong><span class="code">name</span></strong></dt>
         <dd><p>Label (type) of the event.</p></dd>
      <dt><strong><span class="code">node</span></strong></dt>
         <dd><p>Name of the node that the event originated from 
	 (only relevant for <span class="code">Common Test</span> Master event handlers).</p></dd>
       <dt><strong><span class="code">data</span></strong></dt>
         <dd><p>Specific for the event.</p></dd>
    </dl>


    <a name="events"></a>
    <h4>General Events</h4>
      

      <p>The general events are as follows:</p>

    <dl>
      <dt><strong><span class="code">#event{name = start_logging, data = LogDir}</span></strong></dt>
      <dd>
        <p><span class="code">LogDir = string()</span>, top-level log directory for the test run.</p>
        <p>This event indicates that the logging process of <span class="code">Common Test</span>
	has started successfully and is ready to receive I/O
	messages.</p>
</dd>

      <dt><strong><span class="code">#event{name = stop_logging, data = []}</span></strong></dt>
      <dd>
        <p>This event indicates that the logging process of <span class="code">Common Test</span>
	was shut down at the end of the test run.
	</p>
</dd>

      <dt><strong><span class="code">#event{name = test_start, data = {StartTime,LogDir}}</span></strong></dt>
      <dd>
        <p><span class="code">StartTime = {date(),time()}</span>, test run start date and time.</p>
        <p><span class="code">LogDir = string()</span>, top-level log directory for the test run.</p>
        <p>This event indicates that <span class="code">Common Test</span> has finished initial preparations
	and begins executing test cases.
	</p>
</dd>

      <dt><strong><span class="code">#event{name = test_done, data = EndTime}</span></strong></dt>
      <dd>
        <p><span class="code">EndTime = {date(),time()}</span>, date and time the test run finished.</p>
        <p>This event indicates that the last test case has been executed and 
	<span class="code">Common Test</span> is shutting down.	
	</p>
</dd>

      <dt><strong><span class="code">#event{name = start_info, data = {Tests,Suites,Cases}}</span></strong></dt>
      <dd>
        <p><span class="code">Tests = integer()</span>, number of tests.</p>
        <p><span class="code">Suites = integer()</span>, total number of suites.</p>
        <p><span class="code">Cases = integer() | unknown</span>, total number of test cases.</p>
        <p>This event gives initial test run information that can be interpreted as: 
	"This test run will execute <span class="code">Tests</span> separate tests, in total containing
	<span class="code">Cases</span> number of test cases, in <span class="code">Suites</span> number of suites".
	However, if a test case group with a repeat property exists in any test, 
	the total number of test cases cannot be calculated (unknown).
	</p>
</dd>

      <dt><strong><span class="code">#event{name = tc_start, data = {Suite,FuncOrGroup}}</span></strong></dt>
      <dd>
        <p><span class="code">Suite = atom()</span>, name of the test suite.</p>
        <p><span class="code">FuncOrGroup = Func | {Conf,GroupName,GroupProperties}</span></p>
        <p><span class="code">Func = atom()</span>, name of test case or configuration function.</p>
        <p><span class="code">Conf = init_per_group | end_per_group</span>, group configuration function.</p>
        <p><span class="code">GroupName = atom()</span>, name of the group.</p>
        <p><span class="code">GroupProperties = list()</span>, list of execution properties for the group.</p>
        <p>This event informs about the start of a test case, or a group configuration
	function. The event is sent also for <span class="code">init_per_suite</span> and <span class="code">end_per_suite</span>,
	but not for <span class="code">init_per_testcase</span> and <span class="code">end_per_testcase</span>. If a group
	configuration function starts, the group name and execution properties
	are also specified.
	</p>
</dd>

      <dt><strong><span class="code">#event{name = tc_logfile, data = {{Suite,Func},LogFileName}}</span></strong></dt>
      <dd>
        <p><span class="code">Suite = atom()</span>, name of the test suite.</p>
        <p><span class="code">Func = atom()</span>, name of test case or configuration function.</p>
        <p><span class="code">LogFileName = string()</span>, full name of the test case log file.</p>
        <p>This event is sent at the start of each test case (and configuration function
	  except <span class="code">init/end_per_testcase</span>) and carries information about the
	  full name (that is, the file name including the absolute directory path) of
	  the current test case log file.
	</p>
</dd>

      <dt><strong><span class="code">#event{name = tc_done, data = {Suite,FuncOrGroup,Result}}</span></strong></dt>
      <dd>
	<a name="tc_done"></a>
        <p><span class="code">Suite = atom()</span>, name of the suite.</p>
        <p><span class="code">FuncOrGroup = Func | {Conf,GroupName,GroupProperties}</span></p>
        <p><span class="code">Func = atom()</span>, name of test case or configuration function.</p>
        <p><span class="code">Conf = init_per_group | end_per_group</span>, group configuration function.</p>
        <p><span class="code">GroupName = unknown | atom()</span>, name of the group 
	      (unknown if init- or end function times out).</p>
        <p><span class="code">GroupProperties = list()</span>, list of execution properties for the group.</p>
        <p><span class="code">Result = ok | {auto_skipped,SkipReason} | {skipped,SkipReason} | {failed,FailReason}</span>,
	  the result.</p>
	<a name="skipreason"></a>
        <p><span class="code">SkipReason = {require_failed,RequireInfo} | 
	                   {require_failed_in_suite0,RequireInfo} | 
	                   {failed,{Suite,init_per_testcase,FailInfo}} | 
                           UserTerm</span>, 
	      why the case was skipped.</p>
	<a name="failreason"></a>
        <p><span class="code">FailReason = {error,FailInfo} | 
	                   {error,{RunTimeError,StackTrace}} | 
                           {timetrap_timeout,integer()} | 
			   {failed,{Suite,end_per_testcase,FailInfo}}</span>, reason for failure.</p>	
        <p><span class="code">RequireInfo = {not_available,atom() | tuple()}</span>, why require failed.</p>
        <p><span class="code">FailInfo = {timetrap_timeout,integer()} | 
	                 {RunTimeError,StackTrace} | 
			 UserTerm</span>, 
	      error details.</p>
        <p><span class="code">RunTimeError = term()</span>, a runtime error, for example, 
	<span class="code">badmatch</span> or <span class="code">undef</span>.</p>
        <p><span class="code">StackTrace = list()</span>, list of function calls preceding a runtime error.</p>
        <p><span class="code">UserTerm = term()</span>, any data specified by user, or <span class="code">exit/1</span> information.</p>
        <p>This event informs about the end of a test case or a configuration function (see event 
	<span class="code">tc_start</span> for details on element <span class="code">FuncOrGroup</span>). With this event 
	comes the final result of the function in question. It is possible to determine on the 
	top level of <span class="code">Result</span> if the function was successful, skipped (by the user), 
	or if it failed.</p>
	<p>It is also possible to dig deeper and, for example, perform pattern matching 
	on the various reasons for skipped or failed. Notice that <span class="code">{'EXIT',Reason}</span> tuples 
	are translated into <span class="code">{error,Reason}</span>. 
	Notice also that if a <span class="code">{failed,{Suite,end_per_testcase,FailInfo}</span>
	result is received, the test case was successful, but 
	<span class="code">end_per_testcase</span> for the case failed.
	</p>
</dd>

      <dt><strong><span class="code">#event{name = tc_auto_skip, data = {Suite,TestName,Reason}}</span></strong></dt>
      <dd>
	<a name="tc_auto_skip"></a>
        <p><span class="code">Suite = atom()</span>, the name of the suite.</p>
        <p><span class="code">TestName = init_per_suite | end_per_suite |
	                 {init_per_group,GroupName} | {end_per_group,GroupName} |
	                 {FuncName,GroupName} | FuncName</span></p>
	<p><span class="code">FuncName = atom()</span>, the name of the test case or configuration function.</p>
        <p><span class="code">GroupName = atom()</span>, the name of the test case group.</p>
        <p><span class="code">Reason = {failed,FailReason} |
	               {require_failed_in_suite0,RequireInfo}</span>, 
	      reason for auto-skipping <span class="code">Func</span>.</p>
        <p><span class="code">FailReason = {Suite,ConfigFunc,FailInfo}} | 
	                   {Suite,FailedCaseInSequence}</span>, reason for failure.</p>	
        <p><span class="code">RequireInfo = {not_available,atom() | tuple()}</span>, why require failed.</p>
        <p><span class="code">ConfigFunc = init_per_suite | init_per_group</span></p>
        <p><span class="code">FailInfo = {timetrap_timeout,integer()} | 
	                 {RunTimeError,StackTrace} |
			 bad_return | UserTerm</span>, 
	      error details.</p>
	<p><span class="code">FailedCaseInSequence = atom()</span>, the name of a case that failed in a sequence.</p>
        <p><span class="code">RunTimeError = term()</span>, a runtime error, for example <span class="code">badmatch</span> or
	<span class="code">undef</span>.</p>
        <p><span class="code">StackTrace = list()</span>, list of function calls preceeding a runtime error.</p>
        <p><span class="code">UserTerm = term()</span>, any data specified by user, or <span class="code">exit/1</span> information.</p>
        <p>This event is sent for every test case or configuration function that <span class="code">Common Test</span>
	has skipped automatically because of either a failed <span class="code">init_per_suite</span> or 
	<span class="code">init_per_group</span>, a failed <span class="code">require</span> in <span class="code">suite/0</span>, or a failed test case
	in a sequence. Notice that this event is never received as a result of a test case getting
	skipped because of <span class="code">init_per_testcase</span> failing, as that information is carried with
	event <span class="code">tc_done</span>. If a failed test case belongs to a test case group, the second
	data element is a tuple <span class="code">{FuncName,GroupName}</span>, otherwise only the function name.
	</p>
</dd>

      <dt><strong><span class="code">#event{name = tc_user_skip, data = {Suite,TestName,Comment}}</span></strong></dt>
      <dd>
	<a name="tc_user_skip"></a>  
        <p><span class="code">Suite = atom()</span>, the name of the suite.</p>
        <p><span class="code">TestName = init_per_suite | end_per_suite |
	                 {init_per_group,GroupName} | {end_per_group,GroupName} |
	                 {FuncName,GroupName} | FuncName</span></p>
	<p><span class="code">FuncName = atom()</span>, the name of the test case or configuration function.</p>
        <p><span class="code">GroupName = atom()</span>, the name of the test case group.</p>
        <p><span class="code">Comment = string()</span>, why the test case was skipped.</p>
        <p>This event specifies that a test case was skipped by the user. 
	It is only received if the skip is declared in a test specification. 
	Otherwise, user skip information is received as a <span class="code">{skipped,SkipReason}</span> 
	result in event <span class="code">tc_done</span> for the test case. If a skipped test case belongs
	to a test case group, the second data element is a tuple <span class="code">{FuncName,GroupName}</span>,
	otherwise only the function name.
	</p>
</dd>

      <dt><strong><span class="code">#event{name = test_stats, data = {Ok,Failed,Skipped}}</span></strong></dt>
      <dd>
        <p><span class="code">Ok = integer()</span>, current number of successful test cases.</p>
        <p><span class="code">Failed = integer()</span>, current number of failed test cases.</p>
        <p><span class="code">Skipped = {UserSkipped,AutoSkipped}</span></p>
        <p><span class="code">UserSkipped = integer()</span>, current number of user-skipped test cases.</p>
        <p><span class="code">AutoSkipped = integer()</span>, current number of auto-skipped test cases.</p>
        <p>This is a statistics event with current count of successful, skipped, 
	and failed test cases so far. This event is sent after the end of each test case,
	immediately following event <span class="code">tc_done</span>.
	</p>
</dd>
      </dl>
  
    
     <h4>Internal Events</h4>
       

     <p>The internal events are as follows:</p>

     <dl>
      <dt><strong><span class="code">#event{name = start_make, data = Dir}</span></strong></dt>
      <dd>
        <p><span class="code">Dir = string()</span>, running make in this directory.</p>
        <p>This internal event says that <span class="code">Common Test</span> starts compiling
	modules in directory <span class="code">Dir</span>.
	</p>
</dd>

      <dt><strong><span class="code">#event{name = finished_make, data = Dir}</span></strong></dt>	
      <dd>
        <p><span class="code">Dir = string()</span>, finished running make in this directory.</p>
        <p>This internal event says that <span class="code">Common Test</span> is finished compiling
	modules in directory <span class="code">Dir</span>.
	</p>
</dd>

      <dt><strong><span class="code">#event{name = start_write_file, data = FullNameFile}</span></strong></dt>
      <dd>
        <p><span class="code">FullNameFile = string(), full name of the file.</span></p>
        <p>This internal event is used by the <span class="code">Common Test</span> Master process to 
	synchronize particular file operations.
	</p>
</dd>

      <dt><strong><span class="code">#event{name = finished_write_file, data = FullNameFile}</span></strong></dt>
      <dd>
        <p><span class="code">FullNameFile = string(), full name of the file.</span></p>
        <p>This internal event is used by the <span class="code">Common Test</span> Master process to 
	synchronize particular file operations.
	</p>
</dd>

     </dl>
     
     <h4>Notes</h4>
       
  
    <p>The events are also documented in <span class="code">ct_event.erl</span>. This module
    can serve as an example of what an event handler for the <span class="code">Common Test</span> event 
    manager can look like.</p>

    <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>To ensure that printouts to <span class="code">stdout</span> (or printouts made with
    <span class="bold_code"><a href="../../man/ct.html#log-2"><span class="code">ct:log/2,3</span></a></span> or 
    <span class="bold_code"><a href="../../apps/ct/pal-2.html"><span class="code">ct:pal,2,3</span></a></span>) get written to the test case log
    file, and not to the <span class="code">Common Test</span> framework log, you can synchronize
    with the <span class="code">Common Test</span> server by matching on evvents <span class="code">tc_start</span> and <span class="code">tc_done</span>.
    In the period between these events, all I/O is directed to the
    test case log file. These events are sent synchronously to avoid potential
    timing problems (for example, that the test case log file is closed just before
    an I/O message from an external process gets through). Knowing this, you
    need to be careful that your <span class="code">handle_event/2</span> callback function does not
    stall the test execution, possibly causing unexpected behavior as a result.</p></p></div>
</div>
     

</div>
<div class="footer">
<hr>
<p>Copyright © 2003-2016 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div></body>
</html>
