<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../otp_doc.css" type="text/css">
<title>Erlang -- appup</title>
</head>
<body bgcolor="white" text="#000000" link="#0000ff" vlink="#ff00ff" alink="#ff0000"><div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../js/erlresolvelinks.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function getWinHeight() {
                var myHeight = 0;
                if( typeof( window.innerHeight ) == 'number' ) {
                  //Non-IE
                  myHeight = window.innerHeight;
                } else if( document.documentElement && ( document.documentElement.clientWidth ||
                                                         document.documentElement.clientHeight ) ) {
                  //IE 6+ in 'standards compliant mode'
                  myHeight = document.documentElement.clientHeight;
                } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
                  //IE 4 compatible
                  myHeight = document.body.clientHeight;
                }
                return myHeight;
              }

              function setscrollpos() {
                var objf=document.getElementById('loadscrollpos');
                 document.getElementById("leftnav").scrollTop = objf.offsetTop - getWinHeight()/2;
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //--></script><div id="leftnav"><div class="innertube">
<img alt="Erlang logo" src="../erlang-logo.png"><br><small><a href="../apps/sasl/users_guide.html">User's Guide</a><br><a href="../apps/sasl/index.html">Reference Manual</a><br><a href="../apps/sasl/release_notes.html">Release Notes</a><br><a href="../apps/sasl/sasl.pdf">PDF</a><br><a href="../index.html">Top</a></small><p><strong>System Architecture Support Libraries (SASL)</strong><br><strong>Reference Manual</strong><br><small>Version 2.7</small></p>
<br><a href="javascript:openAllFlips()">Expand All</a><br><a href="javascript:closeAllFlips()">Contract All</a><p><small><strong>Table of Contents</strong></small></p>
<ul class="flipMenu">
<li title="sasl (App)"><a href="sasl_app.html">sasl (App)
                </a></li>
<li id="no" title="alarm_handler " expanded="false">alarm_handler<ul>
<li><a href="alarm_handler.html">
                  Top of manual page
                </a></li>
<li title="clear_alarm-1"><a href="alarm_handler.html#clear_alarm-1">clear_alarm/1</a></li>
<li title="get_alarms-0"><a href="alarm_handler.html#get_alarms-0">get_alarms/0</a></li>
<li title="set_alarm-1"><a href="alarm_handler.html#set_alarm-1">set_alarm/1</a></li>
</ul>
</li>
<li id="no" title="overload " expanded="false">overload<ul>
<li><a href="overload.html">
                  Top of manual page
                </a></li>
<li title="request-0"><a href="overload.html#request-0">request/0</a></li>
<li title="get_overload_info-0"><a href="overload.html#get_overload_info-0">get_overload_info/0</a></li>
</ul>
</li>
<li id="no" title="rb " expanded="false">rb<ul>
<li><a href="rb.html">
                  Top of manual page
                </a></li>
<li title="filter-1"><a href="rb.html#filter-1">filter/1</a></li>
<li title="filter-2"><a href="rb.html#filter-2">filter/2</a></li>
<li title="grep-1"><a href="rb.html#grep-1">grep/1</a></li>
<li title="h-0"><a href="rb.html#h-0">h/0</a></li>
<li title="help-0"><a href="rb.html#help-0">help/0</a></li>
<li title="list-0"><a href="rb.html#list-0">list/0</a></li>
<li title="list-1"><a href="rb.html#list-1">list/1</a></li>
<li title="log_list-0"><a href="rb.html#log_list-0">log_list/0</a></li>
<li title="log_list-1"><a href="rb.html#log_list-1">log_list/1</a></li>
<li title="rescan-0"><a href="rb.html#rescan-0">rescan/0</a></li>
<li title="rescan-1"><a href="rb.html#rescan-1">rescan/1</a></li>
<li title="show-0"><a href="rb.html#show-0">show/0</a></li>
<li title="show-1"><a href="rb.html#show-1">show/1</a></li>
<li title="start-0"><a href="rb.html#start-0">start/0</a></li>
<li title="start-1"><a href="rb.html#start-1">start/1</a></li>
<li title="start_log-1"><a href="rb.html#start_log-1">start_log/1</a></li>
<li title="stop-0"><a href="rb.html#stop-0">stop/0</a></li>
<li title="stop_log-0"><a href="rb.html#stop_log-0">stop_log/0</a></li>
</ul>
</li>
<li id="no" title="release_handler " expanded="false">release_handler<ul>
<li><a href="release_handler.html">
                  Top of manual page
                </a></li>
<li title="check_install_release-1"><a href="release_handler.html#check_install_release-1">check_install_release/1</a></li>
<li title="check_install_release-2"><a href="release_handler.html#check_install_release-2">check_install_release/2</a></li>
<li title="create_RELEASES-4"><a href="release_handler.html#create_RELEASES-4">create_RELEASES/4</a></li>
<li title="install_file-2"><a href="release_handler.html#install_file-2">install_file/2</a></li>
<li title="install_release-1"><a href="release_handler.html#install_release-1">install_release/1</a></li>
<li title="install_release-2"><a href="release_handler.html#install_release-2">install_release/2</a></li>
<li title="make_permanent-1"><a href="release_handler.html#make_permanent-1">make_permanent/1</a></li>
<li title="remove_release-1"><a href="release_handler.html#remove_release-1">remove_release/1</a></li>
<li title="reboot_old_release-1"><a href="release_handler.html#reboot_old_release-1">reboot_old_release/1</a></li>
<li title="set_removed-1"><a href="release_handler.html#set_removed-1">set_removed/1</a></li>
<li title="set_unpacked-2"><a href="release_handler.html#set_unpacked-2">set_unpacked/2</a></li>
<li title="unpack_release-1"><a href="release_handler.html#unpack_release-1">unpack_release/1</a></li>
<li title="which_releases-0"><a href="release_handler.html#which_releases-0">which_releases/0</a></li>
<li title="which_releases-1"><a href="release_handler.html#which_releases-1">which_releases/1</a></li>
<li title="upgrade_app-2"><a href="release_handler.html#upgrade_app-2">upgrade_app/2</a></li>
<li title="downgrade_app-2"><a href="release_handler.html#downgrade_app-2">downgrade_app/2</a></li>
<li title="downgrade_app-3"><a href="release_handler.html#downgrade_app-3">downgrade_app/3</a></li>
<li title="upgrade_script-2"><a href="release_handler.html#upgrade_script-2">upgrade_script/2</a></li>
<li title="downgrade_script-3"><a href="release_handler.html#downgrade_script-3">downgrade_script/3</a></li>
<li title="eval_appup_script-4"><a href="release_handler.html#eval_appup_script-4">eval_appup_script/4</a></li>
</ul>
</li>
<li id="no" title="systools " expanded="false">systools<ul>
<li><a href="systools.html">
                  Top of manual page
                </a></li>
<li title="make_relup-3"><a href="systools.html#make_relup-3">make_relup/3</a></li>
<li title="make_relup-4"><a href="systools.html#make_relup-4">make_relup/4</a></li>
<li title="make_script-1"><a href="systools.html#make_script-1">make_script/1</a></li>
<li title="make_script-2"><a href="systools.html#make_script-2">make_script/2</a></li>
<li title="make_tar-1"><a href="systools.html#make_tar-1">make_tar/1</a></li>
<li title="make_tar-2"><a href="systools.html#make_tar-2">make_tar/2</a></li>
<li title="script2boot-1"><a href="systools.html#script2boot-1">script2boot/1</a></li>
</ul>
</li>
<li title="appup"><a href="appup.html">appup</a></li>
<li title="rel"><a href="rel.html">rel</a></li>
<li title="relup"><a href="relup.html">relup</a></li>
<li title="script"><a href="script.html">script</a></li>
</ul>
</div></div>
<div id="content">
<div class="innertube">
<!-- refpage --><center><h1>appup</h1></center>
  
  <h3>FILE</h3>
<div class="REFBODY">appup</div>
  <h3>FILE SUMMARY</h3>
<div class="REFBODY">Application upgrade file</div>
  <h3>DESCRIPTION</h3>
<div class="REFBODY"><p>
    <p>The <strong>application upgrade file</strong> defines how an application
      is upgraded or downgraded in a running system.</p>
    <p>This file is used by the functions in 
    <span class="bold_code"><a href="systools.html"><span class="code">systools</span></a></span> 
    when generating a release upgrade file <span class="code">relup</span>.</p>
  </p></div>

  <h3><a name="id75549">File Syntax</a></h3>
<div class="REFBODY">
    
    <p>The application upgrade file is to be called
      <span class="code">Application.appup</span>, where <span class="code">Application</span> is the
      application name. The file is to be located in the <span class="code">ebin</span>
      directory for the application.</p>
    <p>The <span class="code">.appup</span> file contains one single Erlang term, which
      defines the instructions used to upgrade or downgrade
      the application. The file has the following syntax:</p>
    <div class="example"><pre>
{Vsn,
  [{UpFromVsn, Instructions}, ...],
  [{DownToVsn, Instructions}, ...]}.</pre></div>
    <dl>
      <dt><strong><span class="code">Vsn = string()</span></strong></dt>
        <dd><p>Current application version.</p></dd>
      <dt><strong><span class="code">UpFromVsn = string() | binary()</span></strong></dt>
        <dd><p>An earlier
          application version to upgrade from. If it is a
          string, it is interpreted as a specific version
          number. If it is a binary, it is interpreted as a
          regular expression that can match multiple version
          numbers.</p></dd>
      <dt><strong><span class="code">DownToVsn = string() | binary()</span></strong></dt>
        <dd><p>An earlier
          application version to downgrade to. If it is a
          string, it is  interpreted as a specific version
          number. If it is a binary, it is interpreted as a
          regular expression that can match multiple version
          numbers.</p></dd>
      <dt><strong><span class="code">Instructions</span></strong></dt>
        <dd><p>A list of <strong>release upgrade instructions</strong>, see
          <span class="bold_code"><a href="#Release%20Upgrade%20Instructions">Release
          Upgrade Instructions</a></span>. It is recommended to use
          high-level instructions only. These are automatically
          translated to low-level instructions by <span class="code">systools</span> when
          creating the <span class="code">relup</span> file.</p></dd>
    </dl>
    <p>To avoid duplication of upgrade instructions, it is
      allowed to use regular expressions to specify <span class="code">UpFromVsn</span>
      and <span class="code">DownToVsn</span>. To be considered a regular expression, the
      version identifier must be specified as a binary. For example,
      the following match all versions <span class="code">2.1.x</span>, where <span class="code">x</span> is
      any number:</p>
    <div class="example"><pre>
&lt;&lt;"2\\.1\\.[0-9]+"&gt;&gt;</pre></div>
    <p>Notice that the regular expression must match the complete
      version string, so this example works for, for example,
      <span class="code">2.1.1</span>, but not for <span class="code">2.1.1.1</span>.</p>
  </div>

  <h3><a name="id75696">Release Upgrade Instructions</a></h3>
<div class="REFBODY">
    <a name="Release%20Upgrade%20Instructions"></a>
    
    <p>Release upgrade instructions are interpreted by the release
      handler when an upgrade or downgrade is made. For more
      information about release handling, see
      <span class="bold_code"><a href="../design_principles/release_handling.html">OTP
      Design Principles</a></span> in <strong>System Documentation</strong>.</p>
    <p>A process is said to <strong>use</strong> a module <span class="code">Mod</span> if
      <span class="code">Mod</span> is listed in the <span class="code">Modules</span> part of the child
      specification used to start the process, see
      <span class="bold_code"><a href="supervisor.html"><span class="code">supervisor(3)</span></a></span>.
      In the case of 
      <span class="bold_code"><a href="gen_event.html"><span class="code">gen_event</span></a></span>, 
      an event manager process is said to use <span class="code">Mod</span> if <span class="code">Mod</span> 
      is an installed event handler.</p>

    <h4>High-Level Instructions</h4>
<div class="REFBODY">
    
    <div class="example"><pre>
{update, Mod}
{update, Mod, supervisor}
{update, Mod, Change}
{update, Mod, DepMods}
{update, Mod, Change, DepMods}
{update, Mod, Change, PrePurge, PostPurge, DepMods}
{update, Mod, Timeout, Change, PrePurge, PostPurge, DepMods}
{update, Mod, ModType, Timeout, Change, PrePurge, PostPurge, DepMods}
  Mod = atom()
  ModType = static | dynamic
  Timeout = int()&gt;0 | default | infinity
  Change = soft | {advanced,Extra}
    Extra = term()
  PrePurge = PostPurge = soft_purge | brutal_purge
  DepMods = [Mod]</pre></div>
    <p>Synchronized code replacement of processes using module
      <span class="code">Mod</span>.</p>
    <p>All those processes are suspended using 
      <span class="bold_code"><a href="sys.html#suspend-1"><span class="code">sys:suspend</span></a></span>,
      the new module version is loaded, and
      then the processes are resumed using 
      <span class="bold_code"><a href="sys.html#resume-1"><span class="code">sys:resume</span></a></span>.</p>
    <dl>
    <dt><strong><span class="code">Change</span></strong></dt>
      <dd><p>Defaults to <span class="code">soft</span> and defines the type of
      code change. If it is set to <span class="code">{advanced,Extra}</span>, implemented
      processes using 
      <span class="bold_code"><a href="gen_server.html"><span class="code">gen_server</span></a></span>, 
      <span class="bold_code"><a href="gen_fsm.html"><span class="code">gen_fsm</span></a></span>, or
      <span class="bold_code"><a href="gen_event.html"><span class="code">gen_event</span></a></span> 
      transform their internal state by calling the callback function
      <span class="code">code_change</span>. Special processes call the callback
      function <span class="code">system_code_change/4</span>. In both cases, the term
      <span class="code">Extra</span> is passed as an argument to the callback
      function.</p></dd>
    <dt><strong><span class="code">PrePurge</span></strong></dt>
      <dd><p>Defaults to <span class="code">brutal_purge</span>. It controls
      what action to take with processes executing old code
      before loading the new module version. If the value
      is <span class="code">brutal_purge</span>, the processes are killed. If the value is
      <span class="code">soft_purge</span>, 
      <span class="bold_code"><a href="release_handler.html#install_release-1"><span class="code">release_handler:install_release/1</span></a></span>
      returns <span class="code">{error,{old_processes,Mod}}</span>.</p></dd>
    <dt><strong><span class="code">PostPurge</span></strong></dt>
      <dd><p>Defaults to <span class="code">brutal_purge</span>. It controls
      what action to take with processes that are executing old code
      when the new module version has been loaded. If the value
      is <span class="code">brutal_purge</span>, the code is purged when the release is
      made permanent and the processes are killed. If the value is
      <span class="code">soft_purge</span>, the release handler purges the old code
      when no remaining processes execute the code.</p></dd>
    <dt><strong><span class="code">DepMods</span></strong></dt>
      <dd><p>Defaults to <span class="code">[]</span> and defines other modules that
      <span class="code">Mod</span> is dependent on. In the <span class="code">relup</span> file, instructions 
      for suspending processes using <span class="code">Mod</span> come before
      instructions for suspending processes using modules in
      <span class="code">DepMods</span> when upgrading, and conversely when downgrading.
      In case of circular dependencies, the order of the instructions in
      the <span class="code">appup</span> file is kept.</p></dd>
    <dt><strong><span class="code">Timeout</span></strong></dt>
      <dd><p>Defines the time-out when suspending processes.
      If no value or <span class="code">default</span> is specified, the default value for
      <span class="bold_code"><a href="sys.html#suspend-1"><span class="code">sys:suspend</span></a></span> 
      is used.</p></dd>
    <dt><strong><span class="code">ModType</span></strong></dt>
      <dd><p>Defaults to <span class="code">dynamic</span>. It specifies if
      the code is "dynamic", that is, if a process using the module
      spontaneously switches to new code, or if it is "static".
      When doing an advanced update and upgrade, the new version of a
      dynamic module is loaded before the process is asked to change
      code. When downgrading, the process is asked to change code before
      loading the new version. For static modules, the new version is
      loaded before the process is asked to change code, both in
      the case of upgrading and downgrading. Callback modules are
      dynamic.</p></dd>
    </dl>
    <p><span class="code">update</span> with argument <span class="code">supervisor</span> is used when
      changing the start specification of a supervisor.</p>
    <div class="example"><pre>
{load_module, Mod}
{load_module, Mod, DepMods}
{load_module, Mod, PrePurge, PostPurge, DepMods}
  Mod = atom()
  PrePurge = PostPurge = soft_purge | brutal_purge
  DepMods = [Mod]</pre></div>
    <p>Simple code replacement of the module <span class="code">Mod</span>.</p>
    <p>For a description of <span class="code">PrePurge</span> and <span class="code">PostPurge</span>,
      see <span class="code">update</span> above.</p>
    <p><span class="code">DepMods</span> defaults to <span class="code">[]</span> and defines which other modules
      <span class="code">Mod</span> is dependent on. In the <span class="code">relup</span> file, instructions for
      loading these modules come before the instruction for loading
      <span class="code">Mod</span> when upgrading, and conversely when downgrading.</p>
    <div class="example"><pre>
{add_module, Mod}
{add_module, Mod, DepMods}
  Mod = atom()
  DepMods = [Mod]</pre></div>
    <p>Loads a new module <span class="code">Mod</span>.</p>
    <p><span class="code">DepMods</span> defaults to <span class="code">[]</span> and defines which other modules
      <span class="code">Mod</span> is dependent on. In the <span class="code">relup</span> file, instructions
      related to these modules come before the instruction for
      loading <span class="code">Mod</span> when upgrading, and conversely when
      downgrading.</p>
    <div class="example"><pre>
{delete_module, Mod}
{delete_module, Mod, DepMods}
  Mod = atom()</pre></div>
    <p>Deletes a module <span class="code">Mod</span> using the low-level instructions
      <span class="code">remove</span> and <span class="code">purge</span>.</p>
    <p><span class="code">DepMods</span> defaults to <span class="code">[]</span> and defines which other modules
      <span class="code">Mod</span> is dependent on. In the <span class="code">relup</span> file, instructions
      related to these modules come before the instruction for
      removing <span class="code">Mod</span> when upgrading, and conversely when
      downgrading.</p>
    <div class="example"><pre>
{add_application, Application}
{add_application, Application, Type}
  Application = atom()
  Type = permanent | transient | temporary | load | none</pre></div>
    <p>Adding an application means that the modules defined by
      the <span class="code">modules</span> key in the <span class="code">.app</span> file are loaded using
      <span class="code">add_module</span>.</p>
    <p><span class="code">Type</span> defaults to <span class="code">permanent</span> and specifies the start type
      of the application. If <span class="code">Type = permanent | transient | temporary</span>,
      the application is loaded and started in the corresponding way, see
      <span class="bold_code"><a href="application.html"><span class="code">application(3)</span></a></span>.
      If <span class="code">Type = load</span>, the application is only loaded.
      If <span class="code">Type = none</span>, the application is not loaded and not
      started, although the code for its modules is loaded.</p>
    <div class="example"><pre>
{remove_application, Application}
  Application = atom()</pre></div>
    <p>Removing an application means that the application is stopped,
      the modules are unloaded using <span class="code">delete_module</span>, and then
      the application specification is unloaded from the application
      controller.</p>
    <div class="example"><pre>
{restart_application, Application}
  Application = atom()</pre></div>
    <p>Restarting an application means that the application is
      stopped and then started again, similar to using the instructions
      <span class="code">remove_application</span> and <span class="code">add_application</span> in sequence.</p>
    </div>

    <h4>Low-Level Instructions</h4>
<div class="REFBODY">
    
    <div class="example"><pre>
{load_object_code, {App, Vsn, [Mod]}}
  App = Mod = atom()
  Vsn = string()</pre></div>
    <p>Reads each <span class="code">Mod</span> from directory <span class="code">App-Vsn/ebin</span> as
      a binary. It does not load the modules. The instruction is to be
      placed first in the script to read all new code from the file
      to make the suspend-load-resume cycle less time-consuming.</p>
    <div class="example"><pre>
point_of_no_return</pre></div>
    <p>If a crash occurs after this instruction, the system cannot
      recover and is restarted from the old release version.
      The instruction must only occur once in a script. It is to be
      placed after all <span class="code">load_object_code</span> instructions.</p>
    <div class="example"><pre>
{load, {Mod, PrePurge, PostPurge}}
  Mod = atom()
  PrePurge = PostPurge = soft_purge | brutal_purge</pre></div>
    <p>Before this instruction occurs, <span class="code">Mod</span> must have been loaded
      using <span class="code">load_object_code</span>. This instruction loads the module.
      <span class="code">PrePurge</span> is ignored. For a description of <span class="code">PostPurge</span>,
      see the high-level instruction <span class="code">update</span> earlier.</p>
    <div class="example"><pre>
{remove, {Mod, PrePurge, PostPurge}}
  Mod = atom()
  PrePurge = PostPurge = soft_purge | brutal_purge</pre></div>
    <p>Makes the current version of <span class="code">Mod</span> old.
      <span class="code">PrePurge</span> is ignored. For a description of <span class="code">PostPurge</span>,
      see the high-level instruction <span class="code">update</span> earlier.</p>
    <div class="example"><pre>
{purge, [Mod]}
  Mod = atom()</pre></div>
    <p>Purges each module <span class="code">Mod</span>, that is, removes the old code.
      Notice that any process executing purged code is killed.</p>
    <div class="example"><pre>
{suspend, [Mod | {Mod, Timeout}]}
  Mod = atom()
  Timeout = int()&gt;0 | default | infinity</pre></div>
    <p>Tries to suspend all processes using a module <span class="code">Mod</span>. If a
      process does not respond, it is ignored. This can cause
      the process to die, either because it crashes when it
      spontaneously switches to new code, or as a result of a purge
      operation. If no <span class="code">Timeout</span> is specified or <span class="code">default</span> is
      specified, the default value for 
      <span class="bold_code"><a href="sys.html#suspend-1"><span class="code">sys:suspend</span></a></span> 
      is used.</p>
    <div class="example"><pre>
{resume, [Mod]}
  Mod = atom()</pre></div>
    <p>Resumes all suspended processes using a module <span class="code">Mod</span>.</p>
    <div class="example"><pre>
{code_change, [{Mod, Extra}]}
{code_change, Mode, [{Mod, Extra}]}
  Mod = atom()
  Mode = up | down
  Extra = term()</pre></div>
    <p><span class="code">Mode</span> defaults to <span class="code">up</span> and specifies if it is an
      upgrade or downgrade. This instruction sends a <span class="code">code_change</span>
      system message to all processes using a module <span class="code">Mod</span> by
      calling function 
      <span class="bold_code"><a href="sys.html#change_code-4"><span class="code">sys:change_code</span></a></span>, 
      passing term <span class="code">Extra</span> as argument.</p>
    <div class="example"><pre>
{stop, [Mod]}
  Mod = atom()</pre></div>
    <p>Stops all processes using a module <span class="code">Mod</span> by calling
      <span class="bold_code"><a href="supervisor.html#terminate_child-2"><span class="code">supervisor:terminate_child/2</span></a></span>. 
      This instruction is useful
      when the simplest way to change code is to stop and restart the
      processes that run the code.</p>
    <div class="example"><pre>
{start, [Mod]}
  Mod = atom()</pre></div>
    <p>Starts all stopped processes using a module <span class="code">Mod</span> by calling
      <span class="bold_code"><a href="supervisor.html#restart_child-2"><span class="code">supervisor:restart_child/2</span></a></span>.</p>
    <div class="example"><pre>
{sync_nodes, Id, [Node]}
{sync_nodes, Id, {M, F, A}}
  Id = term()
  Node = node()
  M = F = atom()
  A = [term()]</pre></div>
    <p><span class="code">apply(M, F, A)</span> must return a list of nodes.</p>
    <p>This instruction synchronizes the release installation with other
      nodes. Each <span class="code">Node</span> must evaluate this command with the same
      <span class="code">Id</span>. The local node waits for all other nodes to evaluate
      the instruction before execution continues. If a node goes
      down, it is considered to be an unrecoverable error, and
      the local node is restarted from the old release. There is no
      time-out for this instruction, which means that it can hang
      forever.</p>
    <div class="example"><pre>
{apply, {M, F, A}}
  M = F = atom()
  A = [term()]</pre></div>
    <p>Evaluates <span class="code">apply(M, F, A)</span>.</p>
    <p>If the instruction appears before instruction
      <span class="code">point_of_no_return</span>, a failure is caught.
      <span class="bold_code"><a href="release_handler.html#install_release-1"><span class="code">release_handler:install_release/1</span></a></span> 
      then returns <span class="code">{error,{'EXIT',Reason}}</span>, unless <span class="code">{error,Error}</span> 
      is thrown or returned. Then it returns <span class="code">{error,Error}</span>.</p>
    <p>If the instruction appears after instruction
      <span class="code">point_of_no_return</span> and the function call fails, the
      system is restarted.</p>
    <div class="example"><pre>
restart_new_emulator</pre></div>
    <p>This instruction is used when the application <span class="code">ERTS</span>,
      <span class="code">Kernel</span>, <span class="code">STDLIB</span>, or <span class="code">SASL</span> is
      upgraded. It shuts down the current emulator and starts a new
      one. All processes are terminated gracefully, and the new
      version of <span class="code">ERTS</span>, <span class="code">Kernel</span>, <span class="code">STDLIB</span>, and
      <span class="code">SASL</span> are used when the emulator restarts.
      Only one <span class="code">restart_new_emulator</span> instruction is allowed
      in the <span class="code">relup</span> file, and it must be placed first.
      <span class="bold_code"><a href="systools.html#make_relup-3"><span class="code">systools:make_relup/3,4</span></a></span>
      ensures this when the <span class="code">relup</span> file is generated. The rest of the
      instructions in the <span class="code">relup</span> file is executed after the
      restart as a part of the boot script.</p>
    <p>An info report is written when the upgrade is completed.
      To programmatically determine if the upgrade is complete,
      call <span class="bold_code"><a href="release_handler.html#which_releases-0">
      <span class="code">release_handler:which_releases/0,1</span></a></span> and check if the
      expected release has status <span class="code">current</span>.</p>
    <p>The new release must still be made permanent after the upgrade
      is completed, otherwise the old emulator is started if there is
      an emulator restart.</p>
    <div class="warning">
<div class="label">Warning</div>
<div class="content"><p>
      <p>As stated earlier, instruction <span class="code">restart_new_emulator</span>
        causes the emulator to be restarted with new versions of
        <span class="code">ERTS</span>, <span class="code">Kernel</span>, <span class="code">STDLIB</span>, and <span class="code">SASL</span>.
        However, all other applications do at startup run their old
        versions in this new emulator. This is usually no problem,
        but every now and then incompatible changes occur to the
        core applications, which can cause
        trouble in this setting. Such incompatible changes (when
        functions are removed) are normally preceded by a deprecation
        over two major releases. To ensure that your application is not
        crashed by an incompatible change, always remove any call to
        deprecated functions as soon as possible.</p>
    </p></div>
</div>
    <div class="example"><pre>
restart_emulator</pre></div>
    <p>This instruction is similar to <span class="code">restart_new_emulator</span>,
      except it must be placed at the end of the <span class="code">relup</span> file.
      It is not related to an upgrade of the emulator or the core
      applications, but can be used by any application when a complete
      reboot of the system is required.</p>
    <p>When generating the <span class="code">relup</span> file,
      <span class="bold_code"><a href="systools.html#make_relup-3"><span class="code">systools:make_relup/3,4</span></a></span>
      ensures that there is only one <span class="code">restart_emulator</span>
      instruction and that it is the last instruction in the
      <span class="code">relup</span> file.</p>
    </div>
  </div>

  <h3><a name="id76643">See Also</a></h3>
<div class="REFBODY">
    
    <p><span class="bold_code"><a href="release_handler.html"><span class="code">release_handler(3)</span></a></span>,
      <span class="bold_code"><a href="relup.html"><span class="code">relup(4)</span></a></span>,
      <span class="bold_code"><a href="supervisor.html"><span class="code">supervisor(3)</span></a></span>,
      <span class="bold_code"><a href="systools.html"><span class="code">systools(3)</span></a></span></p>
  </div>
</div>
<div class="footer">
<hr>
<p>Copyright © 1997-2016 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div></body>
</html>
